Add section getting started, 91820777, 1, 1, 1
remove _config.yml, 91820777, 1, 1, 1
Set theme jekyll-theme-minimal, 91820777, 1, 1, 1
Set theme jekyll-theme-slate, 91820777, 1, 1, 1
Set theme jekyll-theme-minimal, 91820777, 1, 1, 1
move package, 91820777, 1, 1, 1
first commit, 91820777, 1, 1, 1
Remove maven central badge from README.md.  It does not work reliably., 27149168, 40, 14, 40
Switch to shields.io Maven Central badge.  The jirutka/maven-badges badge seems to have been down for several days now., 27149168, 40, 14, 40
Update version or maven artifact in README.md., 27149168, 40, 14, 40
[maven-release-plugin] prepare for next development iteration, 27149168, 40, 14, 40
[maven-release-plugin] prepare release acai-1.0, 27149168, 40, 14, 40
Reformat code with google-java-format 1.2. (#12), 27149168, 40, 14, 40
Stop using some newly deprecated methods in Guava. (#11)  Also starts using some Java 8 features after having upgraded to that in commit 2b47e812., 27149168, 40, 14, 40
Switch to Java 8 and update dependencies and plugins. (#10)  Dependencies updated using 'mvn versions:use-latest-releases'. Plugins updated following suggestions made by 'mvn versions:display-plugin-updates'., 27149168, 40, 14, 40
Reorder sections in README.md. (#9)  Test scoped bindings are more commonly used than @DependsOn so put their documentation first., 27149168, 40, 14, 40
Update dependency versions.  Change generated by running 'mvn versions:use-latest-releases'., 27149168, 40, 14, 40
Use https link for style guide., 27149168, 40, 14, 40
Update Google Style Guide links.  The style guide is now hosted on GitHub., 27149168, 40, 14, 40
Fix MoreObjects.firstNonNull import., 27149168, 40, 14, 40
Stop using deprecated Objects#firstNonNull method., 27149168, 40, 14, 40
Upgrade truth dependency to version 0.26.  * Dependencies updated with 'mvn versions:use-latest-releases' * Fixed Truth usage to work with current version., 27149168, 40, 14, 40
Fix incomplete sentence in javadoc., 27149168, 40, 14, 40
Throw appropriate exception type.  We were throwing IllegalStateException when removeEdge was called with a non existent edge; we should throw IllegalArgumentException in that case., 27149168, 40, 14, 40
Mention Java Style Guide in contributing docs., 27149168, 40, 14, 40
Update plugin versions.  Updating to versions suggested by 'mvn versions:display-plugin-updates'. Adds specification of minimum maven version to pom.xml., 27149168, 40, 14, 40
Update maven dependencies using version plugin.   * Add version-rules to avoid updating to beta versions  * Versions updated with 'mvn versions:use-latest-releases'  * Fix Truth usage to work with latest version., 27149168, 40, 14, 40
Remove duplicate compiler plugin from pom.xml., 27149168, 40, 14, 40
Add test to clarify behaviour of static methods.  Static methods in testing services annotated with @BeforeSuite etc will not be invoked by Acai., 27149168, 40, 14, 40
Allow for ITE cause to be null.  Seems unlikely to happen in practice but just to be pedantic rethrow the ITE itself if the cause is null., 27149168, 40, 14, 40
Fix handling of ITE from module constructor.  Adds a couple of test to make sure we throw the appropriate exception., 27149168, 40, 14, 40
Tiny cleanup of README file., 27149168, 40, 14, 40
Add maven cental version badge to README.md.  More info at https://github.com/jirutka/maven-badges, 27149168, 40, 14, 40
Tiny punctuation fix to README.md., 27149168, 40, 14, 40
Add details about contributing to README.md., 27149168, 40, 14, 40
Add coveralls badge to README.md., 27149168, 40, 14, 40
Add instructions for fetching from Maven Central., 27149168, 40, 14, 40
Enable coveralls on travis continuous build.  Hopefully will work this time as the project is now actually enabled at https://coveralls.io/r/google/acai, 27149168, 40, 14, 40
Move GPG plugin into profile.  This should fix the travis build by not using this plugin unless maven is called with -DperformRelease=true., 27149168, 40, 14, 40
[maven-release-plugin] prepare for next development iteration, 27149168, 40, 14, 40
[maven-release-plugin] prepare release acai-0.1, 27149168, 40, 14, 40
Add various release options to pom.xml., 27149168, 40, 14, 40
Specify packaging type jar explicitly., 27149168, 40, 14, 40
Add some missing metadata to pom.xml., 27149168, 40, 14, 40
Remove coveralls configuration.  It doesn't seem to work. See the error in https://travis-ci.org/google/acai/builds/54798136, 27149168, 40, 14, 40
Pass TRAVIS_JOB_ID explicitly to coveralls.  Allegedly this should not be required but the configuration currently doesn't work and a quick web search suggests this as a fix for the error we see on https://travis-ci.org/google/acai/builds/54796953, 27149168, 40, 14, 40
Try out coveralls and covertura for code coverage., 27149168, 40, 14, 40
Enable Error Prone build plugin., 27149168, 40, 14, 40
Test that @TestScope works with parallel tests.  Checks that we support test runners which execute multiple tests in parallel. Note that the current TestScope implementation only allows use of the injector from the main test thread. This means individual test cases which are multi-threaded will need to inject instances up-front and then pass them down to other threads on their own. This change does not alter this behaviour but hopefully the additional test clarifies the intent of the existing code., 27149168, 40, 14, 40
Small rewording of comment., 27149168, 40, 14, 40
Exit test scope even when setup or injection fail.  This fixes #1., 27149168, 40, 14, 40
Rethrow exception type thrown by TestingService.  Previously we propagated the InvocationTargetException inside a RuntimeException. Instead we now extract the ITE cause and throw that if it's a RuntimeException or wrap it in a RuntimeException if it's a checked exception., 27149168, 40, 14, 40
Fix typo in code example., 27149168, 40, 14, 40
Remove pointless comment., 27149168, 40, 14, 40
Fix incorrect exception message., 27149168, 40, 14, 40
Use javax.inject annotations where available., 27149168, 40, 14, 40
Delete unused ExpectedException @Rule., 27149168, 40, 14, 40
Use maven processor plugin.  Fixes problem where 'mvn test' fails if not preceded by 'mvn clean'. Hopefully this should also fix the build on travis-ci., 27149168, 40, 14, 40
Cleanup of Acai tests.  Splits out a test which uses Acai as a JUnit rule to AcaiFunctionalTest and leaves more detailed assertions in AcaiTest which now calls Acai directly rather than using it via a JUnit rule.  Calling Acai directly in the unit tests also removes the need to use @FixMethodOrder., 27149168, 40, 14, 40
Forbid sudo in travis config.  This allows travis-ci to run our build on new faster docker based infrastructure.  See: http://blog.travis-ci.com/2014-12-17-faster-builds-with-container-based-infrastructure/, 27149168, 40, 14, 40
Leave out access modifiers in docs for simplicity., 27149168, 40, 14, 40
Turn off email notifications from travis-ci., 27149168, 40, 14, 40
Specify Maven Compiler Plugin version in pom.xml., 27149168, 40, 14, 40
Add .travis.yml config for travis-ci.org.  Also adds build status indicator to README.md., 27149168, 40, 14, 40
Add some missing license headers., 27149168, 40, 14, 40
Document how to use @TestScoped in README.md., 27149168, 40, 14, 40
Add support for @TestScoped scoped bindings.  Adds a new @TestScoped annotation which can be used to scope bindings to a single test case., 27149168, 40, 14, 40
Search for methods recursively up class hierarchy.  This fixes problems seen by some clients who constructed TestingService instances using a dynamic proxy., 27149168, 40, 14, 40
Set sourceEncoding to UTF-8 in pom.xml., 27149168, 40, 14, 40
Initial commit of Acai a Java library for dependency injection in JUnit tests.  Acai makes it easy to:  - Inject the instances you need into tests  - Start any heavy-weight services needed by your tests once  - Setup and tear down services for each test case  - Declare dependencies between services and start them in order, 27149168, 40, 14, 40
Bump version #., 52811542, 23, 5, 23
Tweak text, 52811542, 23, 5, 23
Add a version history file., 52811542, 23, 5, 23
Code cleanup., 52811542, 23, 5, 23
Fix all IDE warnings, 52811542, 23, 5, 23
Comment, 52811542, 23, 5, 23
Improve "sync tree" by performing a 3rd pass  If a node can't be found after the first two passes (simple dfs search refresh jvm list + simple dfs search) a third pass has been added. It looks for the top level window owning the node belongs to and forces a refreh of that node so that the children will be refreshed all the way down to the node.  This is useful when the list of children of a given node changes over time (for example a "page tab list" where a new page has just been activated)., 52811542, 23, 5, 23
Revert "Wrap NULL handles a null JavaObjectHandle references"  This reverts commit b9c5fb15d6279438f3bebe60ee7f626e853928f4., 52811542, 23, 5, 23
Minor code cleanup., 52811542, 23, 5, 23
Add advanced option to log (or not) tree sync errors  The option is disabled by default because there is currently no 100% reliable way to find an arbitrary node in the Accessibility Tree (because parent/child relationships in the accessibility API are not as strict as parent/child relationships in Swing components)., 52811542, 23, 5, 23
Code cleanup, 52811542, 23, 5, 23
Make "NodePath" class generic., 52811542, 23, 5, 23
Rename NodePath class., 52811542, 23, 5, 23
Prevent displaying error message if node if found on 2 pass., 52811542, 23, 5, 23
Prevent out of range exception  Sizes are sometimes returned as "-1" by the access bridge to indicate a catastrophic failure (e.g. timeout)., 52811542, 23, 5, 23
Sync tree view only when receiving Access Bridge events., 52811542, 23, 5, 23
Synchronize tree with a delay to improve UI responsiveness, 52811542, 23, 5, 23
Add option to synchronize tree view with active node, 52811542, 23, 5, 23
Wrap NULL handles a null JavaObjectHandle references  * This makes for a more natural API., 52811542, 23, 5, 23
Codegen: Preserve full XML doc comment contents., 52811542, 23, 5, 23
Add more XML doc comments., 52811542, 23, 5, 23
CodeGen: Sort reflection members by name  * This ensure the generated code is orthogonal to the order of   elements returned by the reflection API., 52811542, 23, 5, 23
CodeGen: Generate XML doc comments for functions/events., 52811542, 23, 5, 23
Minor code cleanup., 52811542, 23, 5, 23
Expose option for system key hooks  * Ctrl-\ to capture the component at mouse location  * Ctrl-Shift-\ to enable/disable component overlay, 52811542, 23, 5, 23
Don't return invalid rectangle, 52811542, 23, 5, 23
Fix issue with using "TopMost" property  Allow to hide both overlay windows instead of moving them to an invisible location., 52811542, 23, 5, 23
Cleanup code dealing with overlay/tooltip display., 52811542, 23, 5, 23
Improve support for multi-monitor setups., 52811542, 23, 5, 23
Create option to control auto releasing of inactive Java objects, 52811542, 23, 5, 23
Display # of active java handles in status bar  * Also display the amount of GC memory used  * Also expose a new option to set the size of the buffer used   for various calls to the Windows Access Bridge API., 52811542, 23, 5, 23
Keep a record of active java object handles., 52811542, 23, 5, 23
Don't create a bool setting for the default [Flags] enum value  Since the default value is "0" there is no corresponding bit to change so we should not create a bool setting for that value., 52811542, 23, 5, 23
Bugfix: Stop using weak event handlers  They don't quite work with all case of handlers defined as lambda functions. Some "OnChanged" events were not fired to all components after some GC activity. For example OverlayActivationSetting would not get notifications from boo settings., 52811542, 23, 5, 23
Add menu item to reset all options to their default values.  * This simply deletes the user settings file., 52811542, 23, 5, 23
Make event handlers weak reference other minor tweaks., 52811542, 23, 5, 23
Centralize user settings event handling, 52811542, 23, 5, 23
Improve handling of enabled/disable overlay setting., 52811542, 23, 5, 23
Store values of enum user settings as string, 52811542, 23, 5, 23
Store flags as separate boolean settings.  * This makes the settings file more user-hackable., 52811542, 23, 5, 23
Display "text" in tooltip if component supports AccessibleText., 52811542, 23, 5, 23
Disable menu items associated to "Enable Overlay"., 52811542, 23, 5, 23
Fix bug where text would have "..." incorrectly  * Specifically the text contents of a single line text component   (equivalent to a single line JText component) would always have   the "..." prefix because the line never ended with '\n'., 52811542, 23, 5, 23
Code cleanup., 52811542, 23, 5, 23
Ensure overlay is not displayed if overlay is disabled, 52811542, 23, 5, 23
Add a user setting+menu to enable/disable overlay, 52811542, 23, 5, 23
Create user setting for access bridge event handlers, 52811542, 23, 5, 23
Create 3 user settings for collection limits, 52811542, 23, 5, 23
Make settings inner classes., 52811542, 23, 5, 23
Make PropertyOptionsSetting an inner class, 52811542, 23, 5, 23
Move code to AutoDetectApplicationsSetting, 52811542, 23, 5, 23
Refactor user settings., 52811542, 23, 5, 23
Make PropertyOptions a UserSetting, 52811542, 23, 5, 23
Inline methods., 52811542, 23, 5, 23
Make "OverlayActivation" a UserSetting<OverlayActivation>., 52811542, 23, 5, 23
Make "automaticallyCheckForUpdates" a UserSetting<bool>., 52811542, 23, 5, 23
Minor code cleanup., 52811542, 23, 5, 23
Make "OverlayDisplayType" a UserSetting instance.  This simplifies the way the value is managed as a user setting., 52811542, 23, 5, 23
Initial stab at having persistent user-settings., 52811542, 23, 5, 23
Add option for enabling overlay on component selection, 52811542, 23, 5, 23
Options for setting overlay and/or tooltip display, 52811542, 23, 5, 23
Bump version #, 52811542, 23, 5, 23
Improved options on when to display overlay, 52811542, 23, 5, 23
Improve highlight overlay on focus gained  * Hide the overlay + tooltip after 100 msec if no focus gained   event is received.  * Add handler for "ActiveDescendantChanged" event to match the way   NVDA consider what are focus events., 52811542, 23, 5, 23
Tweak tooltip ui, 52811542, 23, 5, 23
Add new options to show overlay window on FocusGained events, 52811542, 23, 5, 23
bufix: use "index in parent" as fallback only when looking for a node, 52811542, 23, 5, 23
Tweak labels, 52811542, 23, 5, 23
Minor code cleanup., 52811542, 23, 5, 23
Bugfix: Node surface size was incorrectly computed., 52811542, 23, 5, 23
Adding feature ideas file., 52811542, 23, 5, 23
Improve dealing with cached values and UI., 52811542, 23, 5, 23
Ensure AccessBridge calls are all made on the same (UI) thread.  This is trying to alleviate stability issues (i.e. hangs in IsJaveWindow calls) that seem to be related to multi-threading issues., 52811542, 23, 5, 23
Move method., 52811542, 23, 5, 23
Bugfix: Don't use the UI message queue if posting from UI thread  The reason is that Control.Invoke will process pending messages before invoking the posted delegate. This can cause reentrancy issues if a background thread post a message concurrently., 52811542, 23, 5, 23
Change error font., 52811542, 23, 5, 23
Minor code cleanup., 52811542, 23, 5, 23
Comments., 52811542, 23, 5, 23
Minor refactoring., 52811542, 23, 5, 23
Minor UI tweak, 52811542, 23, 5, 23
Bugfix., 52811542, 23, 5, 23
Make TreeListView generic  Removed a lot of casts!, 52811542, 23, 5, 23
Refactory PropertyListView to use TreeListView., 52811542, 23, 5, 23
Comments., 52811542, 23, 5, 23
Make TreeListView more generic using TreeLiveViewModel., 52811542, 23, 5, 23
Minor code cleanup., 52811542, 23, 5, 23
Add new window to display exception details., 52811542, 23, 5, 23
Auto-refresh JVMS, 52811542, 23, 5, 23
Make EnumJvms extensible., 52811542, 23, 5, 23
Minor code cleanup, 52811542, 23, 5, 23
Update refresh tree logic to avoid caching issues  * The "GetInfo()" of AccessibleNode is cached meaning that sometimes   the accessibility tree would display out of date window titles   even when auto-refresh is enabled.  * Workaround this issue by updating the tree nodes' tag with the   newly acquired accessible nodes when automatically refreshing.  * This does not impact performance as the "GetInfo()" value is   computed on a tread pool thread when the "EnumJvms" method is   called., 52811542, 23, 5, 23
Comments small code cleanup., 52811542, 23, 5, 23
Move files to "Utils" folder., 52811542, 23, 5, 23
Improve error handling auto-refresh of active applications/windows  * Improve error handling of PropertyList/Group by catching and logging   exception in the event LogErrorEvent  * Improve auto-refresh of active applications and windows by   performing a full enumeration of active Java windows then   an incremental update on the top level list of JVM and their   active windows., 52811542, 23, 5, 23
Add new option to auto detect applications, 52811542, 23, 5, 23
Tweak display of component properties  Go back to more active fetching of sub-trees so that we don't overload the UI with nodes that expand to empty contents., 52811542, 23, 5, 23
Fix typo., 52811542, 23, 5, 23
Tweak table celle enumerations  Instead of limiting proportionally to the number of rows/columns use a square. This is useful to navigate tables with 1000000 rows and 1024 cells for example (e.g. a worksheet)., 52811542, 23, 5, 23
Fixup highlight code to always match selected property., 52811542, 23, 5, 23
Improve performance of component propoerties list view Refresh  * More property groups are expanded on demand  * Fixed issue in property list view where nodes where never   updated (always added/removed)  * Improved performance of updating list view items by updating   only the properties that need to be updated hence decreasing the   amount of interop with User32.dll., 52811542, 23, 5, 23
Fix bug in limit calculation for (row count column count) pair, 52811542, 23, 5, 23
Display row/column headers  Also fix table enumeration limits to go row by row if column count is small., 52811542, 23, 5, 23
Look for rectangle to highlight inside children of property groups., 52811542, 23, 5, 23
Bump version #., 52811542, 23, 5, 23
Highlight occurrences of rectangles in property list view., 52811542, 23, 5, 23
Use AccessibleRectInfo to store Rectangle boundaries., 52811542, 23, 5, 23
Minor tweak: Don't clear list view before updating it  This allows the scroll location to remain the same when switching nodes in the accessibility tree., 52811542, 23, 5, 23
Remove using., 52811542, 23, 5, 23
Display list of children in the component properties list view.  This is useful for tables when browsing through complex cells that are only accessible via the "Select Cells" sub-node., 52811542, 23, 5, 23
Add ability to retrieve table cell info though selection.  The Access Bridge returns incomplete information when accessing table cells though the regular list of children. The only way to work around that limitation is to first update the table selection so that a cell is selected then retrieve the accessible context of the selection.  This change introduces a "Select Cells" property group in tables that does exactly that when expanded. Note that expanding this node will affect the running java application in the sense that the table selection will change as nodes are expanded., 52811542, 23, 5, 23
Menu Options for limiting text length and line length., 52811542, 23, 5, 23
Update release checklist., 52811542, 23, 5, 23
Remove debug code., 52811542, 23, 5, 23
Fix flickering issue on Win7 when using capture tool, 52811542, 23, 5, 23
Move method., 52811542, 23, 5, 23
Change interfaces to abstract classes., 52811542, 23, 5, 23
Codegen: Remove intermediate event forwarder class rename classes, 52811542, 23, 5, 23
Add group with focused element for a given window., 52811542, 23, 5, 23
Codegen: simplify code, 52811542, 23, 5, 23
Rename a few classes to better reflect purpose., 52811542, 23, 5, 23
Doc comment on generate code., 52811542, 23, 5, 23
Split native and legacy generated source file.  Also make native classes/structs internal., 52811542, 23, 5, 23
Split generated file into public and internal classes., 52811542, 23, 5, 23
Bump version #., 52811542, 23, 5, 23
Codegen optimization: don't generate wrapper classes if not needed., 52811542, 23, 5, 23
Fixup namespace names., 52811542, 23, 5, 23
Move files into WindowsAccessBridgeInterop assembly., 52811542, 23, 5, 23
Prepare moving WindowsAccessBridge code into separate assembly., 52811542, 23, 5, 23
Moving source files into separate directory under "src"., 52811542, 23, 5, 23
Display full text contents from AccessibleText components., 52811542, 23, 5, 23
Codegen: convert big interop structs to classes., 52811542, 23, 5, 23
Make AccessibleContextInfo a class instead of a struct., 52811542, 23, 5, 23
Codegen: [Out] classes are passed using "out" keyword.  This is more natural than the pinvoke version that requires the caller to pass a valid instance., 52811542, 23, 5, 23
Pass model to more methods (needed for next change), 52811542, 23, 5, 23
Codegen: Replace "ToBool" with "Succeeded"  This is merely for code clarity., 52811542, 23, 5, 23
Codegen: don't wrap out java object handle in case of API failure.  This is to ensure we never wrap an invalid java object handle into a JavaObjectHandle class that would eventually call ReleaseObject on an invalid handle and causes a crash in the JVM., 52811542, 23, 5, 23
Extract reflection code into separate class., 52811542, 23, 5, 23
Tweak hyper text info retrieval., 52811542, 23, 5, 23
Improve performance of lazy loading of children of context node  * Don't load children of group nodes until they are expanded.  * Only count # of visible children when node group is expanded.  * Re-order method declarations to match method usage in caller., 52811542, 23, 5, 23
Initial stab at loading sub-property group lazily.  This should improve responsiveness while navigating the Accessibility Tree., 52811542, 23, 5, 23
Bump version #., 52811542, 23, 5, 23
Set about box min size., 52811542, 23, 5, 23
Fix crash related to access bridge events.  * When we hookup event handlers using delegates we need to keep   the delegate alive on the managed side to avoid a crash. When the   delegate is not kept alive on the managed side (e.g. referenced by   a managed variable) the delegate can be GC'ed at any time which   would incur a crash in the JAB native DLL when trying to invoke   the delegate via its native function pointer., 52811542, 23, 5, 23
Better handle recovery of initialization failure., 52811542, 23, 5, 23
Make enumeration size limit configurable via options menu item., 52811542, 23, 5, 23
Re-throw initial exception., 52811542, 23, 5, 23
Ensure collections are limited in size  This is to avoid handing on large collections., 52811542, 23, 5, 23
Limit # of children to enumerate to 256., 52811542, 23, 5, 23
Add "Legacy" info in about form., 52811542, 23, 5, 23
Fix about box resizing., 52811542, 23, 5, 23
Codegen: Generate code to deal with failure path  * Do not copy/wrap output parameters if an access bridge entry points   returns a failure code. This is because output parameters usually   contain invalid data in failure cases. If we don't ignore failure   cases we create JavaObjectHandle containing invalid handle values.   When releasing those handles the host JVM usually crashes., 52811542, 23, 5, 23
Codegen: WIP prepare code to handle success/failures return codes., 52811542, 23, 5, 23
Fully support loading legacy access bride DLL., 52811542, 23, 5, 23
Make event interface IDispoable to avoid using concrete implementation, 52811542, 23, 5, 23
Codegen: More WIP wrt generating legacy DLL classes., 52811542, 23, 5, 23
WIP: Support for legacy access bridge (JOBJECT32 instead of JOBECT64), 52811542, 23, 5, 23
Codegen: minor tweaks, 52811542, 23, 5, 23
Codegen: re-order classes, 52811542, 23, 5, 23
Minor code cleanup., 52811542, 23, 5, 23
Codegen: Add GC.KeepAlive calls to avoid early finalization.  Early finalization was never observed but better safe than sorry., 52811542, 23, 5, 23
Code gen: Fix issue with array marshaling  Access Bridge returns garbage values for array elements past the returned counts. This creates a problem for arrays that contains Java Object Handles as we don't want to consider those values as handles to release later as those release calls tend to crash the JVM after some non deterministic amount of time., 52811542, 23, 5, 23
Code Gen: copy and wrap native struct to managed structs., 52811542, 23, 5, 23
Small perf. tweak., 52811542, 23, 5, 23
Code gen: dynamic event hook-up  Instead of hooking up to every access bridge event during initialization we hook up only to the specific events the applications wants to hook-up to at the time the application does the hook-up., 52811542, 23, 5, 23
Use built-in types., 52811542, 23, 5, 23
Generate adapter function code., 52811542, 23, 5, 23
Forward native events to managed events, 52811542, 23, 5, 23
Generate native event types., 52811542, 23, 5, 23
Rename class., 52811542, 23, 5, 23
WIP: Event handler delegate types., 52811542, 23, 5, 23
Rename class., 52811542, 23, 5, 23
WIP: Code cleanup remove redundant non-generated code., 52811542, 23, 5, 23
WIP: Code generation, 52811542, 23, 5, 23
Adding release checklist., 52811542, 23, 5, 23
Accessibility., 52811542, 23, 5, 23
Add accidentally removed code., 52811542, 23, 5, 23
Accessibility., 52811542, 23, 5, 23
Improve error handling and error description., 52811542, 23, 5, 23
Bump version #., 52811542, 23, 5, 23
Fix issue with 32-bit systems  * Replace usage of SafeHandle with a custom class because the   Java Access Bridge DLL use 64-bit handles for both 64-bit and   32-bit processes (because this allows 32-bit JAB clients to   inspect 64-bit Java applications). The built-in SafeHandle class   only allows wrapping IntPtr values which are 32-bit in 32-bit   processes.  * Also create 2 new output configurations (Release-x86 and Debug-x86)   so that there are 2 variants of AccessBridgeExplorer.exe:   One for "AnyCPU" which means 64-bit on 64-bit systems   One for "x86" which means 32-bit on 64-bit systems.   This is useful for people using a 32-bit version of the JRE   and don't want to install a 64-bit version just to be able   to use AccessBridgeExplorer., 52811542, 23, 5, 23
Implement automatic update check.  * Look for latest version information at a github url * Display URL of newest version if a more recent version is available., 52811542, 23, 5, 23
Tweak notification expiration code., 52811542, 23, 5, 23
Rename window => jvm to reflect what the code does., 52811542, 23, 5, 23
Add ability for notifications to expire automatically., 52811542, 23, 5, 23
Set minimum size., 52811542, 23, 5, 23
Add notifications related to access bridge  * If the Access Bridge DLL cannot be loaded for some reason   display an error notification to ensure JRE is installed.  * If there are no running application detected display an   informational notification that maybe JAB needs to be enabled., 52811542, 23, 5, 23
Move methods., 52811542, 23, 5, 23
Tweak UI and behavior for real notification support., 52811542, 23, 5, 23
Tweak UI location of notification area., 52811542, 23, 5, 23
WIP: Notification area., 52811542, 23, 5, 23
Add more details in README.md., 52811542, 23, 5, 23
Fix error reporting if access bridge DLL not available., 52811542, 23, 5, 23
Add screenshot in README.md., 52811542, 23, 5, 23
Tweak about box form sizes., 52811542, 23, 5, 23
Tweak tab order., 52811542, 23, 5, 23
Add url and disclaimer., 52811542, 23, 5, 23
Create about dialog., 52811542, 23, 5, 23
Display manage descendants child in italic  Also disable the workaround used to fetch table cells locations., 52811542, 23, 5, 23
Minor tweaks., 52811542, 23, 5, 23
Minor refactorings., 52811542, 23, 5, 23
Rename property., 52811542, 23, 5, 23
Rename a couple of classes., 52811542, 23, 5, 23
Extract main form UI into IExplorerFormView interface., 52811542, 23, 5, 23
Tweak menus move all options to "Options" top level menu item, 52811542, 23, 5, 23
Readme typo., 52811542, 23, 5, 23
Improve readme doc., 52811542, 23, 5, 23
Limit # of navigation entries to 20., 52811542, 23, 5, 23
Implement navigation drop down click behavior., 52811542, 23, 5, 23
WIP: Implement drop downs for forward/backward navigation., 52811542, 23, 5, 23
Implement Navigation behavior  WIP: Drop down behavior, 52811542, 23, 5, 23
Rename form and controllers.  WIP: Navigation (back/forward buttons)., 52811542, 23, 5, 23
Display active descendent information., 52811542, 23, 5, 23
Tweak options., 52811542, 23, 5, 23
ADd options for controlling object depth/hyper text display., 52811542, 23, 5, 23
Display information related to AccessibleHyperText., 52811542, 23, 5, 23
Display "Object Depth", 52811542, 23, 5, 23
Display window handle for window accessible context., 52811542, 23, 5, 23
Special case table for accessing children (see comments), 52811542, 23, 5, 23
Minor refactoring., 52811542, 23, 5, 23
Add contributing and header., 52811542, 23, 5, 23
Add disclaimer., 52811542, 23, 5, 23
Add copyright headers., 52811542, 23, 5, 23
Add license file., 52811542, 23, 5, 23
Add readme., 52811542, 23, 5, 23
Fix error when starting 2 instances., 52811542, 23, 5, 23
Initial commit., 52811542, 23, 5, 23
Updates for version 2.1., 42338931, 74, 22, 74
Adding StringBuilderUtils., 42338931, 74, 22, 74
Final tweaks for 2.0 to build., 42338931, 74, 22, 74
Update pom add StringBuilderUtils., 42338931, 74, 22, 74
Merge up to CL 92962597/, 42338931, 74, 22, 74
Again remove reference to protos., 42338931, 74, 22, 74
Add 2.0 preset., 42338931, 74, 22, 74
Fix README., 42338931, 74, 22, 74
Adding files omitted from previous commit and needed for 2.0., 42338931, 74, 22, 74
Removing references to proto buffers., 42338931, 74, 22, 74
Preparing for 2.0 release., 42338931, 74, 22, 74
Updating license. Header was missing., 42338931, 74, 22, 74
One more license update., 42338931, 74, 22, 74
Adding and updating licenses in source., 42338931, 74, 22, 74
Adding header to file that was missing it., 42338931, 74, 22, 74
Add license., 42338931, 74, 22, 74
Sync to Google3 CL 80737562., 42338931, 74, 22, 74
Working library for 1.0., 42338931, 74, 22, 74
Merge pull request #4 from toxtli/master  CONFIG.md instructions were updated with the new Cloud Platform interface., 37750224, 35, 14, 35
New changes, 37750224, 35, 14, 35
New changes, 37750224, 35, 14, 35
New changes, 37750224, 35, 14, 35
New changes, 37750224, 35, 14, 35
New changes, 37750224, 35, 14, 35
New changes, 37750224, 35, 14, 35
New changes, 37750224, 35, 14, 35
Update index.html, 37750224, 35, 14, 35
Initial commit, 37750224, 35, 14, 35
Merge pull request #61 from google/timeout  Remove context deadline for manual challenges, 46423194, 239, 27, 239
Remove context deadline for manual challenges, 46423194, 239, 27, 239
Merge pull request #49 from uncompiled/uncompiled-fix-readme  Update README.md for readability, 46423194, 239, 27, 239
Update README.md for readability  Fix minor spelling errors and reword phrasing for readability., 46423194, 239, 27, 239
Merge pull request #48 from trhall/patch-1  Minor typo, 46423194, 239, 27, 239
Minor typo  Changed one reference of ~/.config.acme to ~/config/acme, 46423194, 239, 27, 239
Bump version: solaris/amd64 support, 46423194, 239, 27, 239
Merge pull request #47 from siepkes/solaris_support  Add support for building Illumos (Solaris) binary., 46423194, 239, 27, 239
Add support for building Illumos (Solaris) binary., 46423194, 239, 27, 239
readme: mention release binaries as an alt install, 46423194, 239, 27, 239
civersion: add statically linked versioned binary  The release binaries are also uploaded to GitHub releases page., 46423194, 239, 27, 239
all: upgrade to go1.7  Note that golang.org/x/crypto/acme is still using x/net/context., 46423194, 239, 27, 239
all: remove x/crypto/acme copy; move up cmd/acme  Now that golang.org/x/crypto/acme is public there's no reason to keep the copy of the package here.  So we only left with command line tool: move up to the root. Go-gettable binary can now be built with:      go get -u github.com/google/acme, 46423194, 239, 27, 239
Merge pull request #41 from titanous/dns  Add support for DNS challenge to `acme cert`, 46423194, 239, 27, 239
Add support for DNS challenge to `acme cert`  Signed-off-by: Jonathan Rudenberg <jonathan@titanous.com>, 46423194, 239, 27, 239
Clean up manual http-01 challenge in `acme cert`  Signed-off-by: Jonathan Rudenberg <jonathan@titanous.com>, 46423194, 239, 27, 239
Sync x/crypto/acme package  Synched at https://go.googlesource.com/crypto/+/b13fc1fd382d01861b16b2e6474487d3d4d27f20, 46423194, 239, 27, 239
Sync x/crypto/acme package  Synched at https://go.googlesource.com/crypto/+/b35ccbc95a0eaae49fb65c5d627cb7149ed8d1ab  Also adjusted acme commands to work with the latest acme.Client., 46423194, 239, 27, 239
Merge pull request #38 from titanous/ecdsa  cmd/acme: Add support for ECDSA private keys, 46423194, 239, 27, 239
cmd/acme: Generate ECDSA P-256 keys instead of RSA 2048-bit  ECDSA is much faster and compatible with the vast majority of clients., 46423194, 239, 27, 239
cmd/acme: Add support for ECDSA private keys, 46423194, 239, 27, 239
Merge pull request #39 from titanous/cmd-auth-valid  cmd/acme: Add support for valid authorizations, 46423194, 239, 27, 239
cmd/acme: Add support for valid authorizations  If a domain has been recently authorized the API may return a valid authorization instead of a pending one. In this case no work is required., 46423194, 239, 27, 239
Sync x/crypto/acme package  Synched at https://github.com/golang/crypto/commit/9fbab14f903f89e23047b5971369b86380230e56  Also adjusted acme command to use context-aware Client methods., 46423194, 239, 27, 239
Sync x/crypto/acme package  Synced at https://go.googlesource.com/crypto/+/6575f7ea326e67d12b77872ff66f5ea15f8aefad, 46423194, 239, 27, 239
Sync x/crypto/acme package  Synched at https://go.googlesource.com/crypto/+/6c932297e16070bd20e9384ea78e8afabaa3fae2  Also adjusted acme commands to work with the latest acme.Client. Refactor work will follow., 46423194, 239, 27, 239
Merge pull request #36 from ikellenberger/patch-1  Update README.md, 46423194, 239, 27, 239
Update README.md  Small typo fixed., 46423194, 239, 27, 239
Merge pull request #35 from hkjn/update-docs  Update acme cmd readme docs, 46423194, 239, 27, 239
Describe 'reg -gen' command, 46423194, 239, 27, 239
Correct flag for `acme update` command, 46423194, 239, 27, 239
Update docs  Changes the following:  0. Changes key name to account.key (not account.pem) 1. Mentions that a key needs to be generated if it doesn't exist 2. Updates path to ~/.config/acme 3. Increases key size to 4096 bytes (why not)  Regarding item 1 previous docs seems to imply that `acme` will generate a key for the user but this doesn't seem to happen if running the `acme reg` command just after `go get`:  ``` $ acme reg mailto:me@domain.com account key: open /home/me/.config/acme/account.key: no such file or directory ```, 46423194, 239, 27, 239
Correct output of acme <cmd> -h  Fixes a bug where "acme <cmd> -h" output usage was not parsed and executed using internal template.  Both "acme help <cmd>" and "acme <cmd> -h" now produce the same result., 46423194, 239, 27, 239
Readme rewrite, 46423194, 239, 27, 239
Rename everything goacme to acme  This includes the command line tool which is now called simply "acme" instead of "goacme"., 46423194, 239, 27, 239
Fix golint using type in variable declaration  This fixes:      main_test.go:25:9: should omit type discoAliasFlag from     declaration of var a; it will be inferred from the right-hand side  Closes #29, 46423194, 239, 27, 239
no promises, 46423194, 239, 27, 239
README formatting  [skip ci], 46423194, 239, 27, 239
Update README with basic usage instructions  This pull request adds / begins to add instructions on how to use the tool so that it is more accessible to new users.  Closes #27, 46423194, 239, 27, 239
goacme manual challenge response in cert command., 46423194, 239, 27, 239
Merge pull request #24 from google/better-errors  Better errors, 46423194, 239, 27, 239
Better errors, 46423194, 239, 27, 239
Merge pull request #23 from mbwalas/get-challenge  Add GetChallenge method, 46423194, 239, 27, 239
Fix year, 46423194, 239, 27, 239
Merge branch 'get-challenge' of https://github.com/mbwalas/goacme into get-challenge, 46423194, 239, 27, 239
Add GetChallenge method, 46423194, 239, 27, 239
Add GetChallenge method, 46423194, 239, 27, 239
Merge pull request #21 from google/errors  Predefined ACME error types, 46423194, 239, 27, 239
Define errors as structs, 46423194, 239, 27, 239
Predefined ACME error types  Example usage:      err := client.Register(url a)     if err ok := err.(*Error); ok && err.Type == ErrBadCSR {       // handle urn:acme:error:badCSR error     }, 46423194, 239, 27, 239
Merge pull request #20 from mbwalas/fix-status  Fixing status code for GetAuthz - StatusAccepted is also valid Fixes #17, 46423194, 239, 27, 239
Fixing status code for GetAuthz - StatusAccepted is also valid, 46423194, 239, 27, 239
Merge pull request #19 from google/expose-jwk-thumb  Expose jwkThumbprint as JWKThumbprint, 46423194, 239, 27, 239
Expose jwkThumbprint as JWKThumbprint  Useful for solving challenges other than http-01., 46423194, 239, 27, 239
Support ACME_CONFIG env var in cli  As an alternative to -c argument., 46423194, 239, 27, 239
A couple mini tests for -d disco cli arg, 46423194, 239, 27, 239
Refactory cli args and docs  The -c argument now specifies account dir not a file., 46423194, 239, 27, 239
goacme cert command + needed changes, 46423194, 239, 27, 239
Merge pull request #12 from google/update  goacme update command, 46423194, 239, 27, 239
Merge pull request #11 from google/whoami  goacme whoami command, 46423194, 239, 27, 239
Merge pull request #13 from google/unbroken  Unbreak the broken branch, 46423194, 239, 27, 239
doc nits, 46423194, 239, 27, 239
goacme update command, 46423194, 239, 27, 239
goacme whoami command, 46423194, 239, 27, 239
Unbroken broken branch, 46423194, 239, 27, 239
In-progress major refactoring. Completely broken atm., 46423194, 239, 27, 239
Merge pull request #10 from google/ok-resp  Accept all 2xx response code as OK, 46423194, 239, 27, 239
Accept all 2xx response code as OK  Letsencrypt staging responds with 202 Accepted on GetReg. Plus 2xx is always a good response anyway., 46423194, 239, 27, 239
Merge pull request #9 from google/get-update-reg  Add GetReg and UpdateReg methods, 46423194, 239, 27, 239
Add GetReg and UpdateReg methods, 46423194, 239, 27, 239
Merge pull request #8 from google/key-auth  Don't need config for keyAuthorization, 46423194, 239, 27, 239
Don't need config for keyAuthorization  Also rename keyAuthorization to keyAuth., 46423194, 239, 27, 239
Merge pull request #7 from google/new-cert  Add newCert method, 46423194, 239, 27, 239
Add newCert method, 46423194, 239, 27, 239
Merge pull request #5 from google/poll-auth  Adding method to check the current status of an authorization., 46423194, 239, 27, 239
Adding method to check the current status of an authorization., 46423194, 239, 27, 239
Merge pull request #4 from google/more-tests  Adding some more tests for existing methods, 46423194, 239, 27, 239
Adding some more tests for existing methods, 46423194, 239, 27, 239
Upgraded drone config  Change-Id: Id5d870a107a27a8f11d6ff02fb27f46e483b9cd5, 46423194, 239, 27, 239
Merge pull request #3 from google/accept-challenge  Add function to accept a CA challenge, 46423194, 239, 27, 239
Add function to accept a CA challenge, 46423194, 239, 27, 239
Remove go-jose dependency  Using only std packages.  Change-Id: Ieb0b838292f981f3a0a0e7c8b9babd7b79f225cf, 46423194, 239, 27, 239
Merge pull request #2 from google/thumbprint  Adding JWK thumbprint utility method, 46423194, 239, 27, 239
Adding JWK thumbprint utility method, 46423194, 239, 27, 239
Merge pull request #1 from google/jose-update  Temp. fix for go-jose upstream changes, 46423194, 239, 27, 239
Temp. fix for go-jose upstream changes  Their Signer Sign signature has changed. This is a temporary fix until we permanently get rid of go-jose package.  Change-Id: Ibebabc973d635e733fab50f64522c473b6d2a54c, 46423194, 239, 27, 239
Add CI integration  Change-Id: Ia7706f1e4b87de22a53db3dd71b29535727e1dc0, 46423194, 239, 27, 239
Update import paths  Change-Id: I3055c5c11b3a1607acdb08d304c58fa745621e33, 46423194, 239, 27, 239
Pull remaining changes from elsewhere., 46423194, 239, 27, 239
Update readme  Change-Id: I90a63149168c5e85fe673e75db7e91488eb5eac5, 46423194, 239, 27, 239
Adding initial authorization request  Change-Id: Id727de39c8338485869ba694ab9b78bccfa26e75, 46423194, 239, 27, 239
cmd: first take on real registration  Using user config  Change-Id: I84f18a2aa43621ad21a14f4de16920486f8d3072, 46423194, 239, 27, 239
License headers  Change-Id: If15a5265bf60da89c6e34af3d7ca578326ffddd7, 46423194, 239, 27, 239
cmd: user config read/write  The config mentioned in http://legit/15814  Change-Id: I701f1ea1979547b7914502a7d178c42208542c88, 46423194, 239, 27, 239
cmd: goacme sub commands  There's now userConfig (but empty for now) in cmd/goacme decoupled from Config and thus suitable for storing cli user configurations. I will populate it in a following CL.  The old PoC command code is currently commented out. Will be reinstated later probably with a working userConfig.  Change-Id: I513c2263290224515ad1f9adc6cc44c4bfe3de44, 46423194, 239, 27, 239
Add CI  Change-Id: I310a5e828f40d0d31057b0518d03a9ad759bc29a, 46423194, 239, 27, 239
Rename cli to 'goacme'  Change-Id: I02b4d23a4439c90f7b5fdf2b21f97230a4d52002, 46423194, 239, 27, 239
Initial sketch  Change-Id: I176bf043fdafb23eca14b90c93d069307d9e648a, 46423194, 239, 27, 239
Init  Change-Id: Ibf439b54d675d1882ac8a606c6139c44c8880c0e, 46423194, 239, 27, 239
First commit to Github, 77634620, 1, 2, 1
Added licensing header to JS file, 77634620, 1, 2, 1
Added licensing copyright and CONTRIBUTING.md, 77634620, 1, 2, 1
Added Google disclaimer, 77634620, 1, 2, 1
Scrubbed UA ID from example.json, 77634620, 1, 2, 1
Initial commit, 77634620, 1, 2, 1
adb-sync: Allow syncing symlinks (#4)  It is artificial limitation and actually works with adb (though it might not work with absolute links same as with rsync), 23320304, 309, 44, 309
Fix the suggested ProxyCommand for adb-channel.  Thanks to duckdalbe for noticing!  Fixes #6., 23320304, 309, 44, 309
Merge caching and listing directory contents.  This also removes reliance on Android version specific "ls" arguments fixing things for both N and M., 23320304, 309, 44, 309
adb-sync: Fix listdir() with Android N., 23320304, 309, 44, 309
Fix some accidental Unicode/Binary string mistakes from b28ba49., 23320304, 309, 44, 309
Merge pull request #3 from qezt/qezt  now it will be compatible with N's ls output format, 23320304, 309, 44, 309
now it will be compatible with N's ls output format, 23320304, 309, 44, 309
More py2/3 fixes., 23320304, 309, 44, 309
adb-sync: Stop assuming the encoding of the input files matches the current locale.  Instead treat all file names as binary EVEN for output., 23320304, 309, 44, 309
adb-channel: In fact safely exit also on SIGINT SIGTERM and SIGALRM as all these usually intend a "clean" exit., 23320304, 309, 44, 309
adb-channel: also delete temps on SIGHUP., 23320304, 309, 44, 309
Make adb-channel able to start/stop a SSH server app automatically., 23320304, 309, 44, 309
Add a separate adb-channel tool., 23320304, 309, 44, 309
Fix path appending to not append /. or /.. components., 23320304, 309, 44, 309
If there is no path component at all do append it to the destination., 23320304, 309, 44, 309
Implement wildcard support on the source side. Now we're rsync equivalent!, 23320304, 309, 44, 309
Add a TODO section., 23320304, 309, 44, 309
Document rsync-like path munging., 23320304, 309, 44, 309
Implement rsync-like path munging., 23320304, 309, 44, 309
Add trailing slash to sources; this is more rsync-like., 23320304, 309, 44, 309
Add an easy shortcut to add some adb flags., 23320304, 309, 44, 309
Fix links., 23320304, 309, 44, 309
first commit, 23320304, 309, 44, 309
hook up CI, 62048325, 61, 9, 61
initial import, 62048325, 61, 9, 61
Init Commit, 88582010, 3, 0, 3
Merge pull request #13 from blschatz/master  Fix ZIP64 implementation for large ZIP files., 30086744, 59, 23, 59
Fix ZIP64 implementation for large ZIP files.  Remove single parent class assumption., 30086744, 59, 23, 59
Merge pull request #12 from blschatz/master  Fix gtest dependency, 30086744, 59, 23, 59
Fix gtest dependency, 30086744, 59, 23, 59
Merge pull request #11 from blschatz/master  AFF4 Standard v1.0 C/C++ support, 30086744, 59, 23, 59
Update README, 30086744, 59, 23, 59
Update README, 30086744, 59, 23, 59
Update install instructions, 30086744, 59, 23, 59
Restore gtest dependency, 30086744, 59, 23, 59
Merge branch 'master' of https://github.com/google/aff4.git, 30086744, 59, 23, 59
AFF4 Standard v1.0 C/C++ support, 30086744, 59, 23, 59
Merge pull request #9 from blschatz/master  Zip fixes Blake2 hashing backwards compatibility, 30086744, 59, 23, 59
Merge remote-tracking branch 'upstream/master', 30086744, 59, 23, 59
Update setup., 30086744, 59, 23, 59
Add backwards compatibility for PMEM created images., 30086744, 59, 23, 59
Fix Zip64 Extended Information Extra Field parsing to be Zip standard compliant with backward compatibility for former behaviour., 30086744, 59, 23, 59
Merge pull request #8 from blschatz/master  AFF4 Standard v1.0 RC1 (Python read & verify support), 30086744, 59, 23, 59
v1.0-rc1, 30086744, 59, 23, 59
Merge pull request #1 from google/master  Update to current, 30086744, 59, 23, 59
New bugfix release 0.24.post3.  BUG=  Review URL: https://codereview.chromium.org/2681823004 ., 30086744, 59, 23, 59
Pin dependencies to avoid breakage., 30086744, 59, 23, 59
Merge pull request #7 from hillu/master  Re-add path normalization to URN parser, 30086744, 59, 23, 59
Re-add path normalization to URN parser, 30086744, 59, 23, 59
Small fix to setup.py.  Release 0.24.post1  BUG=  Review URL: https://codereview.appspot.com/297530043 ., 30086744, 59, 23, 59
* Removed versioneer. * Added a cloud AFF4 volume to support imaging to the cloud.  BUG=  Review URL: https://codereview.appspot.com/296370043 ., 30086744, 59, 23, 59
Fixed an off by one bug in C++ library.  This was already fixed here https://github.com/google/aff4/commit/ce976f6a708a0b79b9b767748d80a01ff68069d0 for the python library but seemed to miss the C++ one., 30086744, 59, 23, 59
Updated the C++ library to suppress only certain attributes. This syncs it up with the python library which already implemented this.  BUG=  Review URL: https://codereview.appspot.com/295220043 ., 30086744, 59, 23, 59
Check return status of file writes to catch disk full errors early., 30086744, 59, 23, 59
Small bugfixes.  * Fix integer truncation issue on windows: size_t is only 32 bits. * Added caching for URL parsing in python. This seems quite slow with the default implementation., 30086744, 59, 23, 59
Fixed a bug in URN->File conversion that affected Windows., 30086744, 59, 23, 59
Messed up snappy dependency., 30086744, 59, 23, 59
Remove locally build python-snappy as an external dependency.  Review URL: https://codereview.appspot.com/287030043 ., 30086744, 59, 23, 59
Various Bugfixes.  BUG=  Review URL: https://codereview.appspot.com/283290043 ., 30086744, 59, 23, 59
Merge pull request #3 from tweksteen/master  Fix versioneer source file path, 30086744, 59, 23, 59
Fix versioneer source file path, 30086744, 59, 23, 59
Updated python implementation for streaming interfaces and directory volume support.  R=amoser@google.com  Review URL: https://codereview.appspot.com/279880043 ., 30086744, 59, 23, 59
Added AFF4Directory volume for storing objects in a directory.  Review URL: https://codereview.appspot.com/273340043 ., 30086744, 59, 23, 59
Optimized memory use in the C++ AFF4 library. Added Streaming APIs to make imagers more efficient.  Review URL: https://codereview.appspot.com/277870043 ., 30086744, 59, 23, 59
Added a specialized zip implementation.  * Ported the C++ implementation to python. We no longer use the python zipfile.py module.  * Improved memory use on read by mapping ZIP_STORED members directly instead of   reading them into memory at once. This means that bevies are not pre-read into   memory at once - rather chunks are decompressed from the bevy as required.  Review URL: https://codereview.appspot.com/271260043 ., 30086744, 59, 23, 59
Fixed another off by one bug in AFF4 Image.  BUG=  Review URL: https://codereview.appspot.com/261010043 ., 30086744, 59, 23, 59
Updated snappy in third party so it can be compiled on MSVS 2012  BUG=  Review URL: https://codereview.appspot.com/262150043 ., 30086744, 59, 23, 59
Removed direct mapping of uncompressed segments since the python zipfile implementation might use a non zip64 file header even when the file is already stored with zip64. This leads to inconsistancies and corruptions when the zip file is large.  BUG=  Review URL: https://codereview.appspot.com/262030043 ., 30086744, 59, 23, 59
Force include of snappy.h from local directory.  BUG=  Review URL: https://codereview.appspot.com/262950043, 30086744, 59, 23, 59
Added a version of python-snappy which builds without needing external library support.  Review URL: https://codereview.appspot.com/260090044, 30086744, 59, 23, 59
Added AFF4_STREAM_ORIGINAL_FILENAME attribute to ensure original filenames are preserved.  BUG=  Review URL: https://codereview.appspot.com/252700043, 30086744, 59, 23, 59
Fixed a couple of bugs:  - Off by one bug in aff4_image would raise when extracting a stream of exact chunk size because it wanted to read an additional chunk past the end.  - Bug in aff4_map would try to pad a read into an unmapped region by the full unmapped range which could cause a huge over allocation of memory., 30086744, 59, 23, 59
Optimized AFF4 Image python implementation.  BUG=  Review URL: https://codereview.appspot.com/233250043, 30086744, 59, 23, 59
Made Snappy optional., 30086744, 59, 23, 59
Updated to version 0.12, 30086744, 59, 23, 59
Fixed os.path bugs on windows., 30086744, 59, 23, 59
- Implement Globing for unix. - Add --debug flag as distinct from --verbose flag. - file URNs are forced to absolute on unix since uriparser does not handle relative filenames properly., 30086744, 59, 23, 59
Remove debugging conditions left over from last push., 30086744, 59, 23, 59
Added error checking for write operations like disk full errors.  Implemented file globbing for windows.  --input flag now uses a zip segment for small files.  Fixed bugs in AFF4ObjectCache flushing.  BUG=  Review URL: https://codereview.appspot.com/209650043, 30086744, 59, 23, 59
Added error checking for write operations like disk full errors.  BUG=  Review URL: https://codereview.appspot.com/210500044, 30086744, 59, 23, 59
Added a progress api to CopyToStream(). This can be used to abort the imager and still maintain the sane state of the output file., 30086744, 59, 23, 59
General linting.  Implemented urn_from_member_name() and member_name_for_urn() in pyaff4., 30086744, 59, 23, 59
Fixed a bug in the zip implementation which did not allow it to work with zip files concatenated to other files., 30086744, 59, 23, 59
* Added windows support for building under windows.  * Added a windows specific FileBackedObject() implementation using the CreateFileAPI.  * More rigorous filename -> URL handling. This is different on windows and linux.  * More rigorous implementation of _urn_from_member_name() and _member_name_for_urn().  BUG=  Review URL: https://codereview.appspot.com/210920043, 30086744, 59, 23, 59
Added snappy support to pyaff4. Added memory forensic terms to lexicon., 30086744, 59, 23, 59
Added snappy and none compression. Fixed a performance bug in AFF4Image::Write., 30086744, 59, 23, 59
* Updated URNs to parse file paths relative to the current working dir. * Changed internal APIs to use off_t instead of size_t., 30086744, 59, 23, 59
* Removed included tclap since its already available in ubuntu. * refactored imager so there is a basic imager class which can be easily extended for more complex imagers., 30086744, 59, 23, 59
Added an AFF4 Map implementation to pyaff4 based on interval trees., 30086744, 59, 23, 59
Moved gtest dependency to third_party path., 30086744, 59, 23, 59
Completed implementation of AFF4Map., 30086744, 59, 23, 59
Initial commit of Map range merge algorithm., 30086744, 59, 23, 59
Modified imager to accept a list of input files to image., 30086744, 59, 23, 59
Added initial implementation of the pyaff4 python binding., 30086744, 59, 23, 59
Implemented limited size cache.  * Ensure in use items are not trimmed.  * implement a cache protocol - Items can be taken from cache but AFF4ScopedPtr   ensures they are properly returned., 30086744, 59, 23, 59
Cleaned up internal zip file member names by introducing a well defined escaping scheme for representing the URNs., 30086744, 59, 23, 59
* Added third party command line parsing library tclap. * Added a command line imager tool., 30086744, 59, 23, 59
* Refactored the code: - AFF4FactoryOpen moved as a method of the DataStore since it now requires it. - All pointers returned by AFF4FactoryOpen are now AFF4ScopedPtr. This ensures that ownership of the pointer is maintained in the data store. - Added more tests., 30086744, 59, 23, 59
* Added a test for AFF4Image. * Fixed a bug in AFF4Image. * Added gflags., 30086744, 59, 23, 59
Added more tests using gtest. Converted logging to glog., 30086744, 59, 23, 59
Added gtest submodule., 30086744, 59, 23, 59
Added documentation and comments.  Updated build scripts to use autoconf., 30086744, 59, 23, 59
Removed global oracle so resolver is passed to each AFF4Object uniquely., 30086744, 59, 23, 59
Updated API to use internal AFF4FactoryOpen<AFF4Stream> methods., 30086744, 59, 23, 59
Added an imager.  Added AFF4Image., 30086744, 59, 23, 59
* Added parsing of the Turtle files.  * Added an RDFValue class registry to invoke the correct class based on the type URN., 30086744, 59, 23, 59
Reorganized the files and added licensing information README etc., 30086744, 59, 23, 59
More Raptor Serialization., 30086744, 59, 23, 59
* Added raptor RDF serialization. * Added read support for zip files. * Structured error status return values., 30086744, 59, 23, 59
Added ability to read zip files to ZipFile class., 30086744, 59, 23, 59
c++ string classes are null terminated making them unsuitable for buffer manipulations. Moved to use vector<char>.   Initial implementation of AFF4Image., 30086744, 59, 23, 59
* Added YAML serialization to data store. * More refactoring., 30086744, 59, 23, 59
Initial commit of POC., 30086744, 59, 23, 59
Initial commit, 30086744, 59, 23, 59
Dependencies/setup explained in readme, 54163195, 4, 2, 4
README > README.md + fuller instructions, 54163195, 4, 2, 4
First agata commit; ready for review, 54163195, 4, 2, 4
Changed bin version to 1.4.0-SNAPSHOT, 48175620, 6594, 609, 6594
Tagged 1.4.0-alpha4, 48175620, 6594, 609, 6594
RepoPresenter/RepoAdapter: fine-grained events support (#158)  * Allow RepoPresenter subclasses to handle fine-grained events.  No DiffUtil is used but the ListUpdateCallback interface is used to simplify any case where a DiffResult is easily accessible by the RepoPresenter implementation.  * Add fine-grained event support to compiled repository presenters  The compiled repository presenters use DiffUtil. With flashing light warnings about the main thread performance hit.  Copying the test helper classes over from rvadapter to rvdatabinding. I have insufficient gradle knowledge to make cross-project test class dependency work. Also fixed the package line of the existing copied test class HasPrivateConstructor., 48175620, 6594, 609, 6594
RepoAdapter: allow static items presented with 0 or more item views (#157)  This commit fixes how stable IDs are calculated for static items. Also: - used a different internal structure in RepoAdapter for better readability; - polished the code and tests a bit., 48175620, 6594, 609, 6594
Fixed minor README issues, 48175620, 6594, 609, 6594
Changed bin version to 1.4.0-SNAPSHOT, 48175620, 6594, 609, 6594
Tagged 1.4.0-alpha2, 48175620, 6594, 609, 6594
Fixed testapp sanity test, 48175620, 6594, 609, 6594
Added forCollection and collection binding (#156), 48175620, 6594, 609, 6594
Simplified repository presenter compilers (#155), 48175620, 6594, 609, 6594
Added support for static id for item repo presenters (#154), 48175620, 6594, 609, 6594
Simplified repo presenter compilers (#153), 48175620, 6594, 609, 6594
Changed bin version to 1.4.0-SNAPSHOT, 48175620, 6594, 609, 6594
Tagged 1.4.0-alpha1, 48175620, 6594, 609, 6594
Added item/result/list conversion functions (#152), 48175620, 6594, 609, 6594
Fixed lint warnings updated to support lib 25.2.0 (#151), 48175620, 6594, 609, 6594
Added layout presenter (#149), 48175620, 6594, 609, 6594
Added Result#asList method (#148), 48175620, 6594, 609, 6594
Added nullBinder and nullReceiver (#147), 48175620, 6594, 609, 6594
Added data binding repository presenter recycling config (#146), 48175620, 6594, 609, 6594
Added forItem to RepositoryPresenter(s) (#145), 48175620, 6594, 609, 6594
Resource leak fix in test app (#143)  * Added close request in database extention and test app  * Clean up  * Use database supplier to close database, 48175620, 6594, 609, 6594
Changed bin version to 1.4.0-SNAPSHOT, 48175620, 6594, 609, 6594
Tagged 1.3.0, 48175620, 6594, 609, 6594
Changed bin version to 1.3.0-SNAPSHOT, 48175620, 6594, 609, 6594
Tagged 1.3.0-alpha3, 48175620, 6594, 609, 6594
Changed support lib to 25.1.1 (#141), 48175620, 6594, 609, 6594
Documented the data binding repo presenter compiler (#139), 48175620, 6594, 609, 6594
Changed bin version to 1.3.0-SNAPSHOT, 48175620, 6594, 609, 6594
Tagged 1.3.0-alpha2, 48175620, 6594, 609, 6594
Added explicit action filtering to BroadcastObservable (#104), 48175620, 6594, 609, 6594
Changed bin version to 1.2.0-SNAPSHOT (#103), 48175620, 6594, 609, 6594
Tagged 1.2.0-beta2, 48175620, 6594, 609, 6594
Changed DBColumn columns' value to be nullable (#101)  Prior to this the column does not support null value leading us have to use NonNull column value and in fact we may need Nullable value in DB and the puts method of ContentValues support Nullable value Maybe you'll say emptyColumn can do it but actually it's hard to use it. So I use Nullable instead of Nullable for the value argument. It will be convenient., 48175620, 6594, 609, 6594
Reused function compiler instance per thread (#100), 48175620, 6594, 609, 6594
Add configurable disposer for e.g. Closeable handling (#92), 48175620, 6594, 609, 6594
Added support for more sql content values (#99)  Fixes #97, 48175620, 6594, 609, 6594
Added a few missing unit tests (#98), 48175620, 6594, 609, 6594
Added basic IdentityMultimap unit tests (#96), 48175620, 6594, 609, 6594
Added missing final in AsyncUpdateDispatcher (#94), 48175620, 6594, 609, 6594
Changed implementations of Observable to extend BaseObservable (#93), 48175620, 6594, 609, 6594
Changed gradle plugin version to 2.1.2 (#91), 48175620, 6594, 609, 6594
Updated sdk/support library version to 24 (#89), 48175620, 6594, 609, 6594
Add 'attempt or continue' directive (#87), 48175620, 6594, 609, 6594
Changed bin version to 1.2.0-SNAPSHOT (#88), 48175620, 6594, 609, 6594
Tagged 1.1.0, 48175620, 6594, 609, 6594
Added link to the Agera codelab, 48175620, 6594, 609, 6594
Updated to latest support lib (#84), 48175620, 6594, 609, 6594
Fixed a few static analysis warnings (#83), 48175620, 6594, 609, 6594
Added link to retrofit adapter, 48175620, 6594, 609, 6594
Added links to unofficial translations to README (#82)  Fixes #33 Fixes #81, 48175620, 6594, 609, 6594
Changed bin version to SNAPSHOT, 48175620, 6594, 609, 6594
Tagged 1.1.0-beta2, 48175620, 6594, 609, 6594
Removed storing of nonsense stack-trace in Result default failures (#79), 48175620, 6594, 609, 6594
Changed sort not to mutate input list (#78), 48175620, 6594, 609, 6594
Fixed a bug causing low pass filter not to work (#74), 48175620, 6594, 609, 6594
Changed Result#failure to return absent given the absent failure (#75)  Can potentially happen when directly wrapping a throwable in .attemptX .orEnd (for instance .orEnd(Result::failure)), 48175620, 6594, 609, 6594
Changed bin version to SNAPSHOT (#77), 48175620, 6594, 609, 6594
Tagged 1.1.0-beta1, 48175620, 6594, 609, 6594
Added clarifying comment in CompiledRepository maybeStartFlow, 48175620, 6594, 609, 6594
Fixed restart racing condition in repo compiler (#73), 48175620, 6594, 609, 6594
Update theme configuration to fix a compatible issue (#70). (#72), 48175620, 6594, 609, 6594
Fixed some problems in update scheduling (#69), 48175620, 6594, 609, 6594
Added repo adapter API doc clarification, 48175620, 6594, 609, 6594
Added whileVisible/whileActive to RepositoryAdapter (#67), 48175620, 6594, 609, 6594
Changed observable activated to be called immediately (#58)  When adding an updatable observableActivated is now called immediately if the updatable is added from the same looper as the observable is operating on, 48175620, 6594, 609, 6594
Removed unnecessary pendingUpdate update in BaseObservable (#68), 48175620, 6594, 609, 6594
Added sort and thenSort directives to FunctionCompiler (#66)  * Added sort and thenSort directives to FunctionCompiler  Although can use `morph (SortList<T> new)` to achieve the same function but I think sort is a very common function should not let each person alone to achieve a SortList Function. So I added the sort directives to make it more convenient.  * Added some @NonNull/final and  checkNotNull for the sort directives  * Added final to the apply method of SortFunction, 48175620, 6594, 609, 6594
Changed gradle files to minSdkVersion for each lib (#65), 48175620, 6594, 609, 6594
Tidied up BaseObservable and improved performance (#59)  Changed BaseObservable to use a private lock Changed BaseObservable to sendUpdate to read more easily  Use a boolean and multimap to track update from/to observable/updatable instead of using the much slower handler.hasMessage method  Also removed the check for myLooper() in sendUpdate that slows down updates (especially from other threads). This makes an update execute faster but one cycle later instead of slower but this cycle, 48175620, 6594, 609, 6594
Changed BaseObservable to throw NPE if adding/removing null updatable (#60)  Fixes #51, 48175620, 6594, 609, 6594
Improved performance on SimpleRepository (#57)  Excluded the update from the lock around reference, 48175620, 6594, 609, 6594
Made a slight perf improvement of single repository (#55)  Removed checkNotNull but kept the behaviour of throwing NullPointerException, 48175620, 6594, 609, 6594
Consolidated system observables (#53), 48175620, 6594, 609, 6594
Added ability to bind to failures in Result (#54), 48175620, 6594, 609, 6594
Added databinding extension library (#50), 48175620, 6594, 609, 6594
Added RepositoryPresenter compiler (#45), 48175620, 6594, 609, 6594
Collapsed testapp with retrolambda, 48175620, 6594, 609, 6594
Added a few more corner case tests to core, 48175620, 6594, 609, 6594
Added test of illegal add/remove from non looper thread, 48175620, 6594, 609, 6594
Added missing tests to (non)absent send result methods, 48175620, 6594, 609, 6594
Added func compiler unit tests, 48175620, 6594, 609, 6594
Added another network unit test, 48175620, 6594, 609, 6594
Added some additional unit tests, 48175620, 6594, 609, 6594
Added sql request compiler tests, 48175620, 6594, 609, 6594
Replaced manual equals tests with equalsverifier, 48175620, 6594, 609, 6594
Added more HttpRequest unit tests, 48175620, 6594, 609, 6594
Added unit testing of rvadapter, 48175620, 6594, 609, 6594
Added support for sqlite conflict algorithms (#48)  Fixes #43, 48175620, 6594, 609, 6594
Added .ifFailed(Non)AbsentSendTo to Result (#47)  Most commonly absent is simply a value that hasnt arrive yet. For error handling its useful to easily be able to filter out these errors. Also similarly absent can be filtered out., 48175620, 6594, 609, 6594
Added coverage badge, 48175620, 6594, 609, 6594
Added travis cache, 48175620, 6594, 609, 6594
Adding codecov support to travis, 48175620, 6594, 609, 6594
Changed travis conf. to use jdk8, 48175620, 6594, 609, 6594
Added bintray upload plugin, 48175620, 6594, 609, 6594
Added missing nonnull/finals, 48175620, 6594, 609, 6594
Added headers missing from extracted inner classes, 48175620, 6594, 609, 6594
Extracted inner classes from test app activity, 48175620, 6594, 609, 6594
Removed penaltyDeath from test app  To make life easier for potential Huawei users of the test app, 48175620, 6594, 609, 6594
Added more observable tests  Testing: Deduping of updates within loop Keep observables activated on quick reactivation, 48175620, 6594, 609, 6594
Tidied up unit tests, 48175620, 6594, 609, 6594
Exposed onViewRecycled to RepositoryPresenter, 48175620, 6594, 609, 6594
Tidied up RepositoryAdapter, 48175620, 6594, 609, 6594
update gradle version from 2.1.0-rc1 to 2.1.0, 48175620, 6594, 609, 6594
Pulled Common.WorkerHandler to package level  Fixes #41, 48175620, 6594, 609, 6594
Minor gradle file restructuring, 48175620, 6594, 609, 6594
Added a function that wrap a Throwable in a Result  When ending an attemptXYZ operation with .orSkip the failure is not stored in the repository (as is the intention). To route the failure back into a repository of Result .orEnd needs to be used and the Throwable needs to be wrapped in a Result. This function does exactly that., 48175620, 6594, 609, 6594
Added missing Repository bindWith unit test  Also bumped coverage of Result, 48175620, 6594, 609, 6594
Tidied up some unused test code, 48175620, 6594, 609, 6594
Changed BaseObservable to survive rotation  If LAST_REMOVED is sent when FIRST_ADDED is queued both are instead removed. Re-activating a repository within the same loop have no value and in this way a global repository can survive device rotation., 48175620, 6594, 609, 6594
Revert "Changed WorkerHandler to make Observables survive rotation"  This reverts commit 459cb702e686c0e013458059672048ba4c694953., 48175620, 6594, 609, 6594
Changed WorkerHandler to make Observables survive rotation  If LAST_REMOVED is queued when FIRST_ADDED is processed do nothing. If FIRST_ADDED is queued when LAST_REMOVED is processed do nothing., 48175620, 6594, 609, 6594
Changed version to 1.1.0-SNAPSHOT  Master will be used for 1.1.0 features 1.0.0 fixes (including the pending 1.0.0) to be done on the 1.0.x branch  Versioning scheme as follows; Major version for compatibility break (prey we never need it) Minor version for new features Incremental version for bug fixes, 48175620, 6594, 609, 6594
update gradle plugin to 2.1.0, 48175620, 6594, 609, 6594
Changed logo to raw content source, 48175620, 6594, 609, 6594
Changed version to 1.0.0-SNAPSHOT, 48175620, 6594, 609, 6594
Bumped version to rc2, 48175620, 6594, 609, 6594
Revert "Turned on no longer flaky concurrency interrupt test"  This reverts commit 77fee57c2b5f8d6cab41a8103dc8d2c34f0f6cfa., 48175620, 6594, 609, 6594
Turned on no longer flaky concurrency interrupt test, 48175620, 6594, 609, 6594
Bumped external dependencies, 48175620, 6594, 609, 6594
Optimised imports, 48175620, 6594, 609, 6594
Disabled flaky thread interrupt test, 48175620, 6594, 609, 6594
Improved performance by reducing redundant updates  Resolves #31, 48175620, 6594, 609, 6594
Added travis build config, 48175620, 6594, 609, 6594
Added gradle wrapper, 48175620, 6594, 609, 6594
Change the default charset of HTTP responses to UTF-8.  It's the right thing to do. https://googleblog.blogspot.ch/2012/02/unicode-over-60-percent-of-web.html, 48175620, 6594, 609, 6594
Changed version to 1.0.0-SNAPSHOT, 48175620, 6594, 609, 6594
Add RxJava issue to README, 48175620, 6594, 609, 6594
Added agera, 48175620, 6594, 609, 6594
Merge pull request #68 from proppy/grpc  switch to google-assistant-grpc, 88889137, 204, 92, 204
externalize auth helpers, 88889137, 204, 92, 204
Use "raspberry" instead of "pi" as power keyword (#73)  The speech recognition wasn't very good at recognizing "pi" but "raspberry" seems to work better.  Fixes #69., 88889137, 204, 92, 204
Use the Assistant Library for OK Google hotwording (#64)  * Add a new option: --assistant-always-responds  This allows the user to configure responses on IFTTT so that local actions have an IFTTT response with the Assistant's voice.  * Use the Assistant Library for OK Google hotwording  This requires installation of the wheel for the Google Assistant Library which includes a closed-source hotword implementation.  * Update after review  * Make library optional for Pi 0/1 users, 88889137, 204, 92, 204
switch to google-assistant-grpc  - remove auth_helpers dep - add google_auth_oauthlib dep  Fixes #67, 88889137, 204, 92, 204
Merge pull request #65 from drigz/tts-gain  Reduce the gain by 4dB on the TTS equalizer, 88889137, 204, 92, 204
Reduce the gain by 4dB on the TTS equalizer  This avoids resonance on both Chris's and my Voice Kits.  The voice still sounds tinnier because of the removal of the bass frequencies. It may be possible to make the filter less aggressive while still avoiding resonance - I will investigate this once I have more kits for testing., 88889137, 204, 92, 204
Added shutdown and reboot commands (#30)  * Added shutdown and reboot commands  * added pi to the keyword, 88889137, 204, 92, 204
Merge pull request #33 from bazwilliams/hue-support  Add Philips Hue action type, 88889137, 204, 92, 204
Add philips hue support, 88889137, 204, 92, 204
Improve sound confirmation code (#62)  * Fix spacing of log message in Player.play_wav  * Allow for trigger-sound path to start with ~  Expand '~' in the trigger-sound argument so a user can pass in '~/test.wav' Calling os.path.expanduser on a string that doesn't start with ~ results in a no-op.  Add a log message when the trigger-sound argument is present but does not exist according to os.path.exists to help with debugging., 88889137, 204, 92, 204
Add trigger sound confirmation (#60)  Add an optional trigger sound confirmation useful to know when it's actually listening when not using the voice hat hardware or any other led light., 88889137, 204, 92, 204
Use virtualenv for running the status-led service (#55)  This fixes #54 caused by breakage introduced when I moved configargparse from a system install (which required the stretch package) to the virtualenv (#16)., 88889137, 204, 92, 204
Add tests for actionbase.py (#53), 88889137, 204, 92, 204
Merge pull request #52 from ensonic/master  Add badges for trvis and codecov., 88889137, 204, 92, 204
Add badges for trvis and codecov., 88889137, 204, 92, 204
Determine the owner of the directory with `ls` (#51)  This fixes #38 by making sure we create the virtualenv with the right owner., 88889137, 204, 92, 204
Use the right location for the pidfile (#50)  We try /run/user/<uid>/ and /tmp/ in that order. This should ensure functionality across a wide range of distros., 88889137, 204, 92, 204
Merge pull request #49 from ensonic/master  Add coverage reports., 88889137, 204, 92, 204
Add coverage reports., 88889137, 204, 92, 204
Merge pull request #48 from ensonic/master  Also install required python packages when running on travis., 88889137, 204, 92, 204
Also install required python packages when running on travis.  Extract pip dependencies into requirements.txt. Manually install some packages via apt that are listed in install-deps.sh., 88889137, 204, 92, 204
Implement follow-on queries (#41)  Fixes #12. This is based on Glen's change but refactored a little., 88889137, 204, 92, 204
Document the parameters to say() (#40)  Document the parameters to say(), 88889137, 204, 92, 204
Merge pull request #42 from drigz/remove-audio-errors  Stay silent when we don't recognize a command, 88889137, 204, 92, 204
Merge pull request #44 from ensonic/test  Decode the shell output from bytestring to utf-8., 88889137, 204, 92, 204
Decode the shell output from bytestring to utf-8.  Add a test for the ShellCommandOutput. See #9, 88889137, 204, 92, 204
Stay silent when we don't recognize a command  This is important with the Assistant as it doesn't always give you an audio response even when it handles the command (eg for changing the volume). It also helps when using the Cloud Speech API as false triggers aren't as noticeable if they don't trigger a command., 88889137, 204, 92, 204
Merge pull request #37 from DRSDavidSoft/patch-1  Added the direct link, 88889137, 204, 92, 204
Merge pull request #36 from axilleas/update-hacking-info  Update info on HACKING.md, 88889137, 204, 92, 204
Merge pull request #35 from axilleas/add-missing-deps  Add missing deps needed for vanilla Raspbian, 88889137, 204, 92, 204
Added the direct link  The project setup instructions for API credentials are located in: https://aiyprojects.withgoogle.com/voice#users-guide-1-1--connect-to-google-cloud-platform, 88889137, 204, 92, 204
Add missing deps needed for vanilla Raspbian  `python3-rpi.gpio` is required 'python3-pysocks' just gets rids of a warning., 88889137, 204, 92, 204
Update info on HACKING.md  - Add a reference to HACKING.md in README.md for better discoverability. - Add new subsection on installing the dependencies: `git` needs to be   explicitly installed and the directory under which the repository must   be cloned needs to be specific as it is hardcoded in some scripts., 88889137, 204, 92, 204
Merge pull request #32 from ensonic/checks  Update reference for fixing the audio driver for the VoiceHAT., 88889137, 204, 92, 204
Update reference for fixing the audio driver for the VoiceHAT.  Fixes #19, 88889137, 204, 92, 204
Merge pull request #31 from ensonic/travis  Add a very basic travis config., 88889137, 204, 92, 204
Add a very basic travis config.  We only run pep8 and the tests., 88889137, 204, 92, 204
Merge pull request #28 from ensonic/scripts  Update setup scripts., 88889137, 204, 92, 204
Update setup scripts.  Add UID checks. Remove extra sudo calls. Add copyright header., 88889137, 204, 92, 204
Merge pull request #22 from drigz/fix-10  Add defaults for config file locations, 88889137, 204, 92, 204
Merge pull request #20 from drigz/install-config  Install config files along with deps, 88889137, 204, 92, 204
Install config files along with deps  Currently a user who follows the instructions in HACKING.md won't install the config files so they'll run into the crash described in issue #10. This avoids them being affected by the crash., 88889137, 204, 92, 204
Add defaults for config file locations  Fixes #10 by avoiding a crash when no config file is present., 88889137, 204, 92, 204
Merge pull request #21 from drigz/sudo-services  Use sudo for install-services.sh, 88889137, 204, 92, 204
Use sudo for install-services.sh, 88889137, 204, 92, 204
Merge pull request #16 from drigz/cut-stretch-deps  Remove stretch instructions, 88889137, 204, 92, 204
Merge pull request #17 from cyrilloo/patch-2  Fix permission in install-alsa-config.sh, 88889137, 204, 92, 204
Fix permission in install-alsa-config.sh  Add sudo to mv and cp command, 88889137, 204, 92, 204
Remove stretch instructions  These are no longer necessary now the 4.9 kernel is available., 88889137, 204, 92, 204
Merge pull request #11 from drigz/hardcoded-path  Don't hardcode the path to the repo, 88889137, 204, 92, 204
Don't hardcode the path to the repo  This means things aren't broken if the user clones into ~/aiyprojects-raspbian for example., 88889137, 204, 92, 204
Merge pull request #9 from timonvo/patch-1  Properly encode UTF-8 input passed to pico2wave, 88889137, 204, 92, 204
Properly encode UTF-8 input passed to pico2wave  Without this fix the following issue occurs when a non-ASCII input is passed to the "say" method. In this case I told the device "stop" after which the Google Assistant API returns "I don\u2019t know how to answer that" (note the \u2019 i.e. the "right single quotation mark"). With the fix it works properly.  It seems that subprocess.call ends up calling native CPython code where all arguments are passed to PyUnicode_FSConverter which tries to encode each string using the PyUnicode_EncodeFSDefault() encoding. In this case that encoding seems to be ASCII which then causes the error. When we do the encoding to bytes ourselves ahead of time then PyUnicode_FSConverter will just return those bytes as is thereby avoiding the error.  Logs showing the error: [2017-05-06 18:22:51403] INFO:trigger:clap detected [2017-05-06 18:22:51405] INFO:main:listening... [2017-05-06 18:22:51406] INFO:main:recognizing... [2017-05-06 18:22:54058] INFO:speech:event_type: 1 [2017-05-06 18:22:54060] INFO:main:thinking... [2017-05-06 18:22:54063] INFO:speech:transcript: stop [2017-05-06 18:22:54114] WARNING:main:'stop' was not handled Exception in thread Thread-2: Traceback (most recent call last):   File "/usr/lib/python3.4/threading.py" line 920 in _bootstrap_inner     self.run()   File "/usr/lib/python3.4/threading.py" line 868 in run     self._target(*self._args **self._kwargs)   File "src/main.py" line 269 in _recognize     self._handle_result(self.recognizer.do_request())   File "src/main.py" line 285 in _handle_result     self.say(_("I don\u2019t know how to answer that."))   File "/home/pi/voice-recognizer-raspi/src/tts.py" line 83 in say     print(words) UnicodeEncodeError: 'ascii' codec can't encode character '\u2019' in position 5: ordinal not in ran ge(128), 88889137, 204, 92, 204
Don't recommend to run rpi-uodate.  This will bring in the latest kernel which can be unstable. Fixes #1, 88889137, 204, 92, 204
Initial commit, 88889137, 204, 92, 204
Merge pull request #20 from google/compile_with_java_9  Update to latest maven build plugins so we can build with JDK 9., 30677439, 202, 41, 202
Update to latest maven build plugins so we can build with JDK 9., 30677439, 202, 41, 202
Merge pull request #19 from google/new_branch  Update to latest versions of Guava and ASM., 30677439, 202, 41, 202
Update to latest versions of Guava and ASM., 30677439, 202, 41, 202
Support cloning multidimensional object arrays when one of the dimensions has been nulled out.  This isn't quite right in that we use arr[0] to estimate the size of that dimension and arr[0] could be null when arr[1] isn't but we've been getting away with it for 9 years and no one has complained., 30677439, 202, 41, 202
Update latest release version number in README, 30677439, 202, 41, 202
Merge pull request #16 from remkop/master  Fix for issue #15 (NullPointerException in shutdown hook), 30677439, 202, 41, 202
https://github.com/google/allocation-instrumenter/issues/15 added javadoc for new parameter, 30677439, 202, 41, 202
https://github.com/google/allocation-instrumenter/issues/15 simpler fix to prevent the NullPointerException from occurring, 30677439, 202, 41, 202
https://github.com/google/allocation-instrumenter/issues/15 prevent the NullPointerException from occurring  - During shutdown set the instrumentation field to the NULL_INSTRUMENTATION instance to prevent NullPointerExceptions from occurring when other shutdown hooks allocate new objects - Remove the (now superfluous) null check on the instrumentation field, 30677439, 202, 41, 202
https://github.com/google/allocation-instrumenter/issues/15 Added null implementation of the Instrumentation interface, 30677439, 202, 41, 202
Merge pull request #11 from google/copyright-header  Fix copyright header on AllocationClassAdapter., 30677439, 202, 41, 202
Fix copyright header on AllocationClassAdapter., 30677439, 202, 41, 202
Merge pull request #10 from google/readme-update  Add release info to README.md, 30677439, 202, 41, 202
Add release info to README.md  Also add a link to the Getting Started wiki page., 30677439, 202, 41, 202
Merge pull request #9 from google/gpg-plugin  Add maven-gpg-plugin configuration to build., 30677439, 202, 41, 202
Add maven-gpg-plugin configuration to build., 30677439, 202, 41, 202
Merge pull request #8 from google/pom-cleanup  pom.xml cleanup., 30677439, 202, 41, 202
Merge pull request #7 from google/gitignore  Spell .gitignore correctly., 30677439, 202, 41, 202
pom.xml cleanup.  - Add copyright header. - Add some whitespace and rearrange sections a little. - Update build plugins to most recent versions. - Update Guava dependency to 18.0., 30677439, 202, 41, 202
Spell .gitignore correctly., 30677439, 202, 41, 202
Merge pull request #6 from google/javadoc-cleanup  javadoc cleanup., 30677439, 202, 41, 202
javadoc cleanup., 30677439, 202, 41, 202
Merge pull request #5 from google/remove-ant-build  Remove the Ant build and associated jars., 30677439, 202, 41, 202
Merge pull request #4 from google/gitignore  Add .gitignore ignoring common IDE/build output files., 30677439, 202, 41, 202
Remove the Ant build and associated jars., 30677439, 202, 41, 202
Add .gitignore ignoring common IDE/build output files., 30677439, 202, 41, 202
Merge pull request #3 from google/pom  Updates to pom.xml, 30677439, 202, 41, 202
Updates to pom.xml  - Change version to 3.0-SNAPSHOT. - Update URLs for everything but issues (will change that later). - Add a profile that prevents JDK8's doclint from causing the build to fail., 30677439, 202, 41, 202
Merge pull request #2 from google/readme-1  Minor alignment fix to README., 30677439, 202, 41, 202
Minor alignment fix to README., 30677439, 202, 41, 202
Merge pull request #1 from google/readme  Add README.md, 30677439, 202, 41, 202
Add README.md, 30677439, 202, 41, 202
Add an option to allow invoking samplers on subclasses of the given class.  When "subclassesAlso" is specified traverse upward the class hierarchy to  search for registered samplers. We stop at the first superclass with  registered samplers (and invoke them). If necessary we can additionally  allow traversing the whole hierarchy., 30677439, 202, 41, 202
Update to ASM 5.0.3, 30677439, 202, 41, 202
Update pom.xml to build correct allocation.jar  - Makes sure that the output file works as a standalone javaagent.  - Makes sure that class name rewriting happens correctly.  - Updates version to 8.0 because we now support Java 8.  Why not?  - Updates Guava to 17.0, 30677439, 202, 41, 202
Updating Maven build's ASM version to 5.0.3, 30677439, 202, 41, 202
Enforce use of the ASM5+ APIs so that we don't forget to do so in the future., 30677439, 202, 41, 202
Clean up some warnings from the ASM5 transition., 30677439, 202, 41, 202
Missed a few classes from update to Guava 17.0, 30677439, 202, 41, 202
Update to a less ancient version of Guava., 30677439, 202, 41, 202
Update to support ASM5.  ASM5 requires us to pass a boolean that indicates whether we are  invoking on an interface to visitMethodInsn presumably for  invocation of default methods.  This commit should enable full JDK8 support., 30677439, 202, 41, 202
Fix Issue 21: Inefficient regex in the instrumentation path, 30677439, 202, 41, 202
Fixed compilation breakage from previous commit., 30677439, 202, 41, 202
A few changes:   - Some whitespace fixes.   - Be more aggressive about nulling out instrumenter-inserted     local variables at the expense of somewhat more computation.     This has caused heap leaks in some code.   - Make AllocationRecorder.recordAllcoation less ridiculously expensive     by using the char based overloads of String.replace., 30677439, 202, 41, 202
Fix for broken remove operation, 30677439, 202, 41, 202
Adding support for removing samplers., 30677439, 202, 41, 202
[maven-release-plugin] prepare for next development iteration, 30677439, 202, 41, 202
[maven-release-plugin] prepare release java-allocation-instrumenter-2.1, 30677439, 202, 41, 202
Updated maven pom.xml to fix agent manifest (contributions by Andrei Pozolotin). Also updated maven versions for various plugins and dependencies., 30677439, 202, 41, 202
Migrate to ASM4, 30677439, 202, 41, 202
Add Can-Retransform-Classes attribute to Manifest., 30677439, 202, 41, 202
Doc fix: javadoc points to incorrect method for instrumentation., 30677439, 202, 41, 202
Major feature integration.  1) Change allocation instrumenter to compute stackmaps.  We previously  output broken stackmaps but verifiers prior to the JDK7 Hotspot didn't care.  Computing stackmaps using ASM requires computation of the nearest superclass for a pair of classes.  The problem is that some of these superclasses may not be loaded yet.  ASM assumes that all necessary classes have been loaded.  As a result we need a version of ASM's ClassWriter that grovels through the classpath for superclasses where necessary.  2) Add the ability to instrument the constructors of individual classes., 30677439, 202, 41, 202
We need to recompute stackmaps.  Apparently Java 7 is less forgiving of  stackmaps being wrong., 30677439, 202, 41, 202
This removes an extra copy of a multidimensional array that is on the stack  after cloning it.  You need that copy to invoke invokeRecordAllocation but  calculateArrayLengthAndDispatch generates that copy itself so the DUP on  that code path was extraneous., 30677439, 202, 41, 202
Being more explicit about copyright notices., 30677439, 202, 41, 202
Fix to breakage caused to build.xml by shuffling the directory structure.  new review: owner: inder123 summary: Would like to make sure my changes are the "right way to do this", 30677439, 202, 41, 202
Fixing incorrect Array.clone() handling, 30677439, 202, 41, 202
Remove errant println, 30677439, 202, 41, 202
[maven-release-plugin] prepare for next development iteration, 30677439, 202, 41, 202
[maven-release-plugin] prepare release java-allocation-instrumenter-2.0, 30677439, 202, 41, 202
changing to 2.0-SNAPSHOT to follow the maven blessed way to release a version., 30677439, 202, 41, 202
revised version number to 2.0 to match the version of current download, 30677439, 202, 41, 202
Created Maven configuration for java-allocation-instrumenter and moved all of the source-code under src/main/java The eclipse project can be created with mvn eclipse:eclipse, 30677439, 202, 41, 202
Adding support for array and multidimensional array clone., 30677439, 202, 41, 202
Add (expensive) support for reflective instance creation (Class.newInstance() Constructor.newInstance() Object.clone())  Update support libraries to use ASM 3.3 Guava instead of Google Collections, 30677439, 202, 41, 202
Initial Checkin, 30677439, 202, 41, 202
Remove TODOs from README (into GitHub issues), 85561766, 16, 4, 16
Merge pull request #4 from matharden/readme  Friends don't let friends link with 'here', 85561766, 16, 4, 16
Merge pull request #11 from plegner/fix-cmd-click  Fix shift/cmd click on links., 85561766, 16, 4, 16
Fix shift/cmd click on links., 85561766, 16, 4, 16
Merge pull request #10 from plegner/fix-scroll  Always scroll page to top before navigating., 85561766, 16, 4, 16
Always scroll page to top before navigating., 85561766, 16, 4, 16
Merge pull request #7 from tonyruscoe/fix_app_icon_path  Fix path to static app icon., 85561766, 16, 4, 16
Merge pull request #8 from matharden/logo-align  Keep logo aligned with content at all widths, 85561766, 16, 4, 16
Merge pull request #9 from tonyruscoe/fix_analytics  Fix analytics tracking code in app shell., 85561766, 16, 4, 16
Fix analytics tracking code in app shell., 85561766, 16, 4, 16
Keep logo aligned with content at all widths, 85561766, 16, 4, 16
Link to project resources with descriptive text, 85561766, 16, 4, 16
Fix path to static app icon., 85561766, 16, 4, 16
Merge pull request #3 from tonyruscoe/fix_bar_americain_link  Fix broken link to Bar Americain article., 85561766, 16, 4, 16
Merge pull request #2 from tonyruscoe/fix_install_serviceworker  Add mapping for /_/install_serviceworker page., 85561766, 16, 4, 16
Fix broken link to Bar Americain article., 85561766, 16, 4, 16
Merge pull request #1 from theefer/patch-1  Fix typo and link add a few reference links, 85561766, 16, 4, 16
Add mapping for /_/install_serviceworker page., 85561766, 16, 4, 16
Fix typo and link add a few reference links, 85561766, 16, 4, 16
Fix app shell bugs., 85561766, 16, 4, 16
Add sample articles and some more article CSS., 85561766, 16, 4, 16
Update README file with more details., 85561766, 16, 4, 16
Initial commit, 85561766, 16, 4, 16
Change image to static link hosted on ampproject.org (#9607)  * Change image to static link hosted on ampproject.org  * Update amp-cors-requests.md  Remove exclamation since it doesn't render correctly in ampproject.org., 51965089, 104, 29, 104
Include additional experiment ID on Doubleclick Fast Fetch requests. (#9612)  * Include experiment id on all Doubleclick Fast Fetch Requests  * fix test coverage, 51965089, 104, 29, 104
Re-skip bind integration tests (#9611), 51965089, 104, 29, 104
amp-bind: Handle attributes on input elements that sometimes only specify initial values (#9584), 51965089, 104, 29, 104
Tidy up doc for amp-3q-player for consistency w/ other components (#9606)  * Tidy up doc for amp-3q-player for consistency w/ other components  * Update amp-3q-player.md, 51965089, 104, 29, 104
Tidy up doc for amp-timeago - consistency w/ other components (#9605), 51965089, 104, 29, 104
amp-ima-video: Markdown README for project (#9336)  * Added README for amp-ima-video.  Fixed IMA SDK link.  Really fixed IMA SDK link.  Fixed again.  Added space  Fixed overvie wheader.  Removed slash file.  * Fixed closing tag.  * Updated to resolve comments.  * Updated to address missed comments  * Updated to resolve comments.  * Fix comma -> period., 51965089, 104, 29, 104
Add missing actions to "all elements" table (#9562)  All elements get not only `show` but also `hide` and `toggleVisibility` as documented in an earlier section of this file., 51965089, 104, 29, 104
Fixed typo in amp-img closing tag (#9604), 51965089, 104, 29, 104
Add unit test for ad concurrent load. (#9599)  * Add unit test for ad concurrent load.  * Add unit test for ad concurrent load., 51965089, 104, 29, 104
Enable _ga cookie for googleanalytics doubleclick and adsense. (#9586)  * Enable _ga cookie for googleanalytics doubleclick and adsense.  * fix test, 51965089, 104, 29, 104
Whitelist check-links.js from cdn URL presubmit check (#9600), 51965089, 104, 29, 104
Whitelist expected non-working links for link checker (#9596), 51965089, 104, 29, 104
Allow tests to access local version of web worker. (#9475)  * opt_minified  * fix arg for localDev  * pr comments  * pr comments  * revert  * pr comments  * revert changes to test-server and test-bind-impl  * cleanup, 51965089, 104, 29, 104
Origin trials (#8944), 51965089, 104, 29, 104
XHR#fetchText now returns Response (#9567)  * XHR#fetchText now returns Response  Partial for #9448.  * Lint  * Fix test error, 51965089, 104, 29, 104
remove instruction to add .max (#9592), 51965089, 104, 29, 104
turn on hidden-v3 (#9589), 51965089, 104, 29, 104
Allow for functional links in amp-accordion headers (#9335), 51965089, 104, 29, 104
Allow option attribute for children of amp-selector in templates (#9585), 51965089, 104, 29, 104
Improve CORS documentation (#9583), 51965089, 104, 29, 104
Should show amp-app-banner in non-embedded firefox ios (#9573), 51965089, 104, 29, 104
Revert "update minimum version of node from 4.0.0 to 6.10.3 (#9537)" (#9560)  This reverts commit e363fae0705a9dcd52639ea7aab0ca471974b794.  Most ES6 features are supported in Node v4 you just need to put `"use strict"` at the top of the file., 51965089, 104, 29, 104
Move custom middleware before Karma's builtin middleware. (#9561)  * Move custom middleware before Karma's builtin middleware.  * Fix validator test, 51965089, 104, 29, 104
admanmedia ad network type added (#8052)  * admanmedia ad network type added  * Render start implemented and demo playing ad introduced  * Solve ESLint 80 chars line limit  * Fix indentation and encodeURI id  * add encodedId in search pattern, 51965089, 104, 29, 104
Animations: width height and rand functions (#9539)  * Animations: width height and rand functions  * cleanup  * tests fixed  * review fixes  * test fixes, 51965089, 104, 29, 104
ES6xize node server code. (#9578)  * ES6xize node server code.  * ES6xize node server code., 51965089, 104, 29, 104
amp-bind: Reference I/O codelab in docs (#9570)  * Reference I/O codelab in amp-bind docs  * indentation, 51965089, 104, 29, 104
Fix most amp-bind integration tests (#9577), 51965089, 104, 29, 104
skip bind tests to unbreak master (#9572), 51965089, 104, 29, 104
Animations: minor spec references (#9554), 51965089, 104, 29, 104
Order element-specific actions lexicographically (#9569)  amp-carousel is the only item that's out of place; the rest of the items in the element-specific action list are sorted by lexicographical order., 51965089, 104, 29, 104
Add comment to applylayout method for SSR (#9551)  * Add comment to applylayout method for SSR  * Scream louder  Increase size of warning.  * Further comment clarification  Indicate that the first block applies to server-side rendering documents and then the code after does not run if server-side rendering was done on the document.  * trailing spaces removed, 51965089, 104, 29, 104
Wait for document ready before search for element in #getElement (#9486), 51965089, 104, 29, 104
add missing glob dep (#9564), 51965089, 104, 29, 104
Report when XHR are issued before viewer is visible (#9350)  * Report when XHR are issued before viewer is visible  * Lint  * Review comments  * Do not log same-origin requests  * Fix tests  * Lint  * Fix tests  * Undo location.origin changes  * Do not log in test mode, 51965089, 104, 29, 104
Fix gitignore (#9510), 51965089, 104, 29, 104
Increase amp-bind integration test timeout (#9558)  * Set amp-bind integration test timeout to 10s  * Remove timeout, 51965089, 104, 29, 104
add chalk dev dep (#9555), 51965089, 104, 29, 104
Filter out script links from .md files during check-links and make failures PR blocking (#9552), 51965089, 104, 29, 104
Fix render-delaying-extension false error report (#9382)  * Fix false timeout reports when using timeoutPromise  If the `opt_racePromise` resolved before the time we would still get a timeout error since we never cancel it.  * Lint  * Fix broken tests, 51965089, 104, 29, 104
allow all z-index to be overridable (#9538), 51965089, 104, 29, 104
update minimum version of node from 4.0.0 to 6.10.3 (#9537)  According http://node.green/ node has good support of ES6 since 6.10.3LTS (except the ES6 modules :-().  Updating the minimum version of node allows us to use ES6 features to simplify our gulp and server code., 51965089, 104, 29, 104
Add a simple meta description tag to the AMP Validator Web UI. (#9549)  * Add a simple meta description tag to the AMP Validator Web UI.  Since there is no actual text on the document search results currently show an ugly snippet of: "Clear filter. {{e.message}}. {{e.category}}. line {{e.line}} column {{e.col}}. [[_charCounterStr]]. [[label]] [[errorMessage]]. [[_text]]. {{text}}. AMP AMP4ADS Validate."  * Update description to reflect the correct acronym `#bikeshedding`., 51965089, 104, 29, 104
holdout experiment to 5% (#9550), 51965089, 104, 29, 104
changing amp-auto-ads ad height to 250px (#9543), 51965089, 104, 29, 104
Print detailed error message in pr-check.js if PRs are out of sync (#9545)  A few people on the team have hit this error due to an out of sync local branch so make the error message clear and provide recovery steps., 51965089, 104, 29, 104
Add keyboard support to amp-accordion (#9204), 51965089, 104, 29, 104
amp-bind: Local data for amp-list (#9376), 51965089, 104, 29, 104
Track more performance metrics: long tasks and battery. (#9408)  * Track more performance metrics: long tasks and battery.  * Fix presubmit  * Report bad frame cnt  * Report bad frame cnt  * address comments  * Add a unit test., 51965089, 104, 29, 104
Fix nodisplay SSR (#9540), 51965089, 104, 29, 104
try2 (#9534), 51965089, 104, 29, 104
Show amp-app-banner only when viewer support navigateTo (#9533), 51965089, 104, 29, 104
Filter bad first-paint values. (#9532)  Chrome sometimes reports 1 or 0 but those values are never realistic so lets throw them away.  PR does some light refactoring for readability., 51965089, 104, 29, 104
Don't do a dist for integration_tests for PRs (#9530), 51965089, 104, 29, 104
Fix the _ga cookie parsing regression. (#9525)  * Fix the _ga cookie parsing regression.  * Add a unit test., 51965089, 104, 29, 104
Restore test timeouts for local and travis runs (#9527)  This reverts commit 12ee5f23fb075c19d8544459ec838687573d581e., 51965089, 104, 29, 104
turn on (#9511), 51965089, 104, 29, 104
Corrects 'isc' URL parameter to 'art'. (#9503)  * Changes url param 'isc' -> 'art'.  * Removed test file.  * Removed debug-experiment-flag from url params.  * Fixed grammar in comments + made tests more consistent by using regexp., 51965089, 104, 29, 104
Link to the Great First Issue label instead of milestones (#9520)  * Switch to using GFI label.  * Change to using GFI label  * Change to GFI label, 51965089, 104, 29, 104
Move validator tests to pre_build_checks build shard (#9519), 51965089, 104, 29, 104
get rid of unconfirmedViewerOrigin_ in amp-viewer-integration (#9507)  * fix  * check-types  * cleanup  * test fix, 51965089, 104, 29, 104
Enable printState in development not just local dev (#9460), 51965089, 104, 29, 104
Move test-bind-integration.js to test/integration. (#9477), 51965089, 104, 29, 104
PWA: API for shadow dom streaming (#9495)  * PWA: API for shadow dom streaming  * review fixes  * review fixes  * lints, 51965089, 104, 29, 104
Animations: apply calc/var transforms to keyframes and timing (#9496)  * Animations: apply calc/var transforms to keyframes and timing  * reviw fixes  * lints, 51965089, 104, 29, 104
Add minor clarification to Getting Started Quick Start guide. (#9494)  * clarify where to run git remote add  * fix typo  * change wording, 51965089, 104, 29, 104
amp-app-banner open url directly in non-embedded chrome ios (#9509), 51965089, 104, 29, 104
Add Bringhub support to amp-embed (#9439)  * adding bringhub support to amp-embed  * finished implementation of bringhub msf into amp-ad/amp-embed  * removing uneccessary id from bringhub's h2, 51965089, 104, 29, 104
Assert slide parent is connected (#9432)  * add assert to check that slides wrapper is connected + new dom functions  * add comment  * fix lint  * fix types justin's comment, 51965089, 104, 29, 104
Implement SpotX as Ad provider (#9253)  * Implement SpotX as Ad provider  * Implement renderStart  * Redo Ad Example page to match new format  * Fix example page indentation  * Add TODO for improving renderStart in spotx.js, 51965089, 104, 29, 104
Remove obsolete TODO in viewport-impl. (#9505), 51965089, 104, 29, 104
Update googleanalytics-alpha CID config. (#9499)  * Update googleanalytics-alpha CID config.  * fix  * fix test, 51965089, 104, 29, 104
Only error report request's origin for privacy (#9446)  Since user private data can appear anywhere in the URL's request let's only report the origin of the request when an error happens.  Also converts this to an expected error since there's really nothing we can do about a network failure., 51965089, 104, 29, 104
Add support for Nielsen analytics (#9356)  * Added support for Nielsen analytics  * Added Nielsen test  * Added Nielsen example  * Update analytics-vendors.amp.html  * Update analytics-vendors.amp.html  * Added missing bracket  * cosmetic changes  * Removed unnecessary vars  * Updated Nielsen test  * Fixed typo, 51965089, 104, 29, 104
Set up randomizing for test run order (#8779)  * Set up randomizer  * Shouldn't have included changes to gulpfile  * Added option to test  * Add option to read in testing list from file  * Made change and added example test failure files  * Removed unneeded import  * Removed changes to package.json  * Added glob to options list  * Add file-reader to package.json, 51965089, 104, 29, 104
Apply caption to lightbox 2.0 (#9476), 51965089, 104, 29, 104
Clean state from ad uiHandler (#9278), 51965089, 104, 29, 104
Error doc update: viewport.js -> viewport service (#9246), 51965089, 104, 29, 104
Make local "gulp test" 100% green by changing the test timeout for local and travis runs (#9498), 51965089, 104, 29, 104
Distinguish between element-provided and extension provided services (#9386)  Extension-provided services are automatically registered by the extension (eg CID). Element-provided services are registered by an some configuration element (not the extension script).  For extension-provided scripts we can depend on a service promise if the extension is registered (amp-analytics being registered guarantees CID).  But for element-provided we cannot depend on the service promise just because the extension is included. Instead we have to wait for the `<body>` to be ready and see if it's there (not guaranteed)., 51965089, 104, 29, 104
Implement debounced input action (#9277)  * Implement debounced input action  * Use common util debounce function  * Change signature of rate-limit fns to accept arguments  * Access event target property synchronously  * Clone the event object to prevent async misbehavior  * Create DeferredEvent and ActionEventDef.  * Test DeferredEvent. Throw on function calls.  * Explicitly test common event methods. Use addChangeDetails for input too.  * Experiment protect and test input-debounced  * Fix accidental find-and-replace, 51965089, 104, 29, 104
Implement first paint and first contentful paint metrics based on new standard (#9488)  Details are here https://github.com/WICG/paint-timing  This is currently in Chrome behind a flag. The legacy mechanism (only covering first-paint not first-contentful-paint) is left intact until this reaches Chrome stable., 51965089, 104, 29, 104
Add a vendor filter to analytics-vendors.amp.html for easier testing. (#9389)  * Add a vendor filter to analytics-vendors.amp.html for easier testing.  * make it valid amp  * Add baiduanalytics  * address comments  * address comments, 51965089, 104, 29, 104
Update amp-form.md (#9456), 51965089, 104, 29, 104
Removed test file., 51965089, 104, 29, 104
Changes url param 'isc' -> 'art'., 51965089, 104, 29, 104
Add space between markdown header # and text (#9452)  These are the last bad headers., 51965089, 104, 29, 104
Add hand icon (#9492)  * Updating tests not yet finished  * Added hand icon when hovering on selector, 51965089, 104, 29, 104
Update validator release changelog. (#9485), 51965089, 104, 29, 104
Update path prefix check to include 'a' (#9474)  * adding 'a'  * test, 51965089, 104, 29, 104
Add Google Adsense as support AMP ad server (#9367), 51965089, 104, 29, 104
update configuration for Baidu stats (#9409)  * add baidu analytics config  * change name  * Put the config in the front  * change doubleuote to singlequote  * Add trailing comma  *  update vendor-requests.json  * change '$timestamp' to '_timestamp_'  * move `/hm.gif?` to base  * reduced len - -!  * update vendor-requests.json  * update  * update vendor.js for Baidu stats  * update: add example for baidu stats  * update vendor-requests.json  * Fix the typo, 51965089, 104, 29, 104
amp-carousel: optional aria-label for navigation buttons (#9431), 51965089, 104, 29, 104
cleanup (#9466), 51965089, 104, 29, 104
Support a template-enabled [submitting] element (#9442)  * Support a template-enabled [submitting] element  * Simplify form data logic and use JSON  * Update validator for [submitting], 51965089, 104, 29, 104
Animations: CSS var/calc polyfill calculations (#9400)  * Animations: CSS var/calc polyfill calculations  * review fixes, 51965089, 104, 29, 104
Enable live-list in shadow mode (#9444)  * Enable live-list in shadow mode  * lints, 51965089, 104, 29, 104
Logging fixes for pr-check.js (#9463), 51965089, 104, 29, 104
Fix incorrectly-rendered headers (#9451)  There needs to be a space between `#` `##` etc. and the header text for the header to render correctly in Markdown. Currently the hash characters are rendered literally and header text isn't properly styled., 51965089, 104, 29, 104
Clean up node-style done callbacks in mocha it tests (#9450), 51965089, 104, 29, 104
Remeasure amp-app-banner after built (#9388), 51965089, 104, 29, 104
[amp-social-share] Add SMS configuration and fix for iOS (#9365), 51965089, 104, 29, 104
Rename keycodes.js to key-codes.js (#9443), 51965089, 104, 29, 104
AmpAd Fast Fetch: Ensure separate pings are sent for AdSense vs Doubleclick SRA delay measurement (#9420)  * CSI measure potential SRA delay does not take type into account  * Ensure separate CSI pings are sent for AdSense vs Doubleclick SRA delay metrics  * revert resources-impl.js changes, 51965089, 104, 29, 104
Fixes #9383 maybe (#9440), 51965089, 104, 29, 104
Fix Issue #9411 - rename Keycodes enum to KeyCodes (#9437), 51965089, 104, 29, 104
only re-parent slide to connected parent (#9426), 51965089, 104, 29, 104
Stop resources for crawling build ancestors in SD polyfill (#9429), 51965089, 104, 29, 104
amp-facebook-*: support different languages #9264 (#9310)  * amp-facebook-*: support different languages #9264  * amp-facebook-*: support different languages #9264  * amp-facebook-*: support different languages #9264  * amp-facebook-*: support different languages #9264  * Change " to '  * Update amp-facebook-comments.js  * Update amp-facebook-like.js  * Update amp-facebook.js  * Update facebook.js  * Update amp-facebook-comments.js  * Update amp-facebook-like.js  * Update amp-facebook.js  * Update amp-facebook-like.js  * add dashToUnderline func in src/string.js and facebook sdk locale support  * fix lint error, 51965089, 104, 29, 104
Add Yandex and Adfox ad networks integration for amp-ad. (#8898), 51965089, 104, 29, 104
Correct doc about data-amp-replace delimiter (#9418)  The earlier section mentions that the data-amp-replace attribute value is space-delimited but later sections and code samples says it's comma-separated., 51965089, 104, 29, 104
add  to csp (#9401), 51965089, 104, 29, 104
Update a4a-readme.md (#9419)  Fixed some typos and updated 'AMP ads' to 'AMP Ads'., 51965089, 104, 29, 104
Speed up travis build (#9403)  The travis build is now sharded into 4 parts: pre_build_checks integration_tests unit_tests and validator_tests each run in parallel. This should halve the total build time for PRs and pushes to master., 51965089, 104, 29, 104
Introduce ad network filter in ads.amp.html for easier testing. (#9391)  * Introduce ad network filter in ads.amp.html for easier testing.  * Make it valid amp., 51965089, 104, 29, 104
Cleanup isProtocolValid and apply it in url-replacements (#9402), 51965089, 104, 29, 104
AMP Ad Fast Fetch: FIE do not remove creative in unlayoutCallback (#9396)  * Do not execute unlayoutCallback if FIE  * test coverage, 51965089, 104, 29, 104
Add baidu analytics config (#9363)  * add baidu analytics config  * change name  * Put the config in the front  * change doubleuote to singlequote  * Add trailing comma  *  update vendor-requests.json  * change '$timestamp' to '_timestamp_'  * move `/hm.gif?` to base  * reduced len - -!  * update vendor-requests.json  * update, 51965089, 104, 29, 104
Deflake integration tests (#9398), 51965089, 104, 29, 104
FlexOneHARRIER amp-ad support (#9257)  * FlexOneHarrier amp-ad support  * Google AMP for F1H - Update  * FlexOneHarrier amp-ad support - fixed erros  * Google AMP for F1H - fixed bugs (Trailing spaces not allowed)  * Modified F1H CustomKey Sample  * Google AMP for F1H - fixed JavaScript code & modified the usage example.  * Google AMP for F1H fixed JavaScript code removed cd.git files undo package.json, 51965089, 104, 29, 104
Fix total engaged time doc link (#9399), 51965089, 104, 29, 104
Add NETLETIX to amp-ads plugins (#9211), 51965089, 104, 29, 104
Move percy keys from encrypted .travis.yml entries to travis config (#9314), 51965089, 104, 29, 104
Update CSP example (#9394)  Allow https://cdn.ampproject.org/rtv/ for style-src., 51965089, 104, 29, 104
Deflake amp-form tests (#9384), 51965089, 104, 29, 104
Fix formatting mistakes in analytics example page (#9381)  * Fix formatting mistakes in analytics example page  * more fix  * fix, 51965089, 104, 29, 104
Animations: CSS calc/var polyfill parser (#9287)  * Animations: CSS calc/var polyfill parser  * review fixes  * fix concat and assert url, 51965089, 104, 29, 104
Analytics: customEvent trigger add support to selector (#9285), 51965089, 104, 29, 104
make master green again (#9380), 51965089, 104, 29, 104
amp-pinterest: render should always a promise (#9377), 51965089, 104, 29, 104
Experiment delaying Fast Fetch ad request by renderOutsideViewport (#9318)  * add experiment delaying ad request until within renderOutsideViewport  * remove unnecessary field  * rework to use GWS diverted experiment selection  * move to GWS diverted control/experiment  * fix type error  * fix build error  * fix/add test coverage  * resource test coverage  * PR feedback  * fix test failure, 51965089, 104, 29, 104
Fast Fetch add RegExp to verify SafeFrame version header format (#9373)  * Allow for specifying safeframe version via header  * PR feedback  * add regexp to ensure proper safeframe version format  * fix lint error, 51965089, 104, 29, 104
slow down loader line (#9366), 51965089, 104, 29, 104
disable SRA get url measure in prod (#9374), 51965089, 104, 29, 104
Validator Initial Release Changelog (#9372), 51965089, 104, 29, 104
Remove Pan-y config (#9369), 51965089, 104, 29, 104
Refactor exec commands in build-system into their own library (#9348), 51965089, 104, 29, 104
undefined check (#9361), 51965089, 104, 29, 104
AMP-Ad Fast Fetch: Allow for specifying safeframe version via header (#9360)  * Allow for specifying safeframe version via header  * PR feedback, 51965089, 104, 29, 104
Skip check-links test for deleted markdown files (#9364), 51965089, 104, 29, 104
Adding a4a support to GMOSSP amp-ads (#8606)  * Adding a4a support to GMOSSP amp-ads  * Fixed indent.  * Fixed bug.  * Fix berow  https://github.com/ampproject/amphtml/pull/8606/files/d93d9feccfd576d3397d69652d004e9dd026a822  * Refactor, 51965089, 104, 29, 104
Start Doubleclick Fast Fetch potential SRA delay measure experiment (#9298)  * start a4a-measure-get-ad-urls exp  * revert experiments.js change as unneeded, 51965089, 104, 29, 104
Improve docs with embedded examples (#9293), 51965089, 104, 29, 104
amp-bind: Cleanup of integration tests (#9316), 51965089, 104, 29, 104
Cleanup old experiments and flags (#9357)  * Cleanup Selector experiment amp-sortable-table  * Cleanup Accordion state experiment  * Cleanup config  * Fix gulp file.  * Skip MD link check, 51965089, 104, 29, 104
Flags (#9359), 51965089, 104, 29, 104
Fix racy layout=nodisplay (#9354), 51965089, 104, 29, 104
Validate amp-app-banner url in ios (#9351), 51965089, 104, 29, 104
Fix legacy iOS viewport for body scrolling (#9349), 51965089, 104, 29, 104
Add amp-ad support for PolymorphicAds (#7199)  * polymorphicAds added to amp-ad  * remove trailing space  * renderStartImplemented option added and code style modified  * parameter name modified  * adUnitId modified all place using it  * double space removed  * LF commit  * parameter name edit back  * remove placeholder and fallback  * add comma, 51965089, 104, 29, 104
Introduce examiner.js to use LongTask API to detect long running javascript in 3p frames (#9260)  * Introduce examiner.js  * fix lint  * fix presubmit, 51965089, 104, 29, 104
Allow custom cookie name for Ad CID. (#9281)  * Allow custom cookie name for Ad CID.  * nit  * nit  * fix type checks.  * address comments and fix tests  * remove DONOTSUMIT  * fix lint, 51965089, 104, 29, 104
AmpAd Fast Fetch: Do not send public key request until out of prerender state (#9340)  * Do not send public key request until out of prerender state  * PR review  * move to buildCallback fix tests, 51965089, 104, 29, 104
Patch #7984 - extended snowplow analytics (#8227)  * extend snowplow tracker #7984  * remove eid from tracking request needs a valid uuid, 51965089, 104, 29, 104
Service cleanup: Require a constructor for all services (#9212), 51965089, 104, 29, 104
updated to be consistent with AMP Ads branding (#9339), 51965089, 104, 29, 104
Disallow v0.js for amp4ads documents. (#9347), 51965089, 104, 29, 104
fixing tests (#9346), 51965089, 104, 29, 104
Service cleanup: Replace all instances of getService* with a third argument (#9248), 51965089, 104, 29, 104
Bump Google SafeFrame version to 1-0-8 (#9342), 51965089, 104, 29, 104
Hide checks for working links from Travis logs (#9344), 51965089, 104, 29, 104
Restore state of amp-ima-video experiment after video players test (#9317)  * Restore state of amp-ima-video experiment after video players test  * Move toggle to test-video-players-helper.js  * Import toggleExperiment  * Move experiment to an optional parameter sent to the helper  * Remove unnecessary import  * removing a few extra before/after each  * different approach, 51965089, 104, 29, 104
Implement form verification (async form validation) (#9054), 51965089, 104, 29, 104
Validator Rollup (#9323)  * Remove ValidationError::detail it hasn't been used for a long while * Allow style attributes in SVG tags., 51965089, 104, 29, 104
Remove colombia example since it's broken for long time. (#9320), 51965089, 104, 29, 104
Debounce (#9252)  * tmp  * Test debounce  * lint  * Rename file, 51965089, 104, 29, 104
Update for extension amp-nexxtv-player (#9297), 51965089, 104, 29, 104
Fix headings markdown on amp-app-banner (#9299), 51965089, 104, 29, 104
Update unbuilt CONTAINER element styling (#9282)  They should not have their children `display: none`d since thatd cause a jump when they become built., 51965089, 104, 29, 104
Change availability status (#9309)  from "in development" to "stable", 51965089, 104, 29, 104
GumGum Ads integration (#9109)  * Initial GumGum integration  * Changes requested by reviewer, 51965089, 104, 29, 104
Section on writing tests in validator contribution doc. (#9304)  * Add section on writing tests to the validator rules contribution document.  * Remove copy of minimum_valid_amp., 51965089, 104, 29, 104
Navegg + DFP integration Ads (#8889)  * Navegg + DFP integration  * fix  * fix data-acc=XXXX and navegg.md  * fix  * no-content ad note  * no-content fix, 51965089, 104, 29, 104
Update to Index Exchange amp-ad tags to reduce dependency on AMP core (#8627)  * Update to Index Exchange amp-ad tags to reduce dependency on AMP core  * Update to Index Exchange amp-ad tags to reduce dependency on AMP core  * Update to Index Exchange amp-ad tags to reduce dependency on AMP core, 51965089, 104, 29, 104
Remove TODO in url.js for IE11 (#9271), 51965089, 104, 29, 104
Don't print Percy token in logs (#9296), 51965089, 104, 29, 104
Add a visual-diff test for amp-by-example (#9233)  Integrates Percy visual diff testing with Travis. Runs only for push builds., 51965089, 104, 29, 104
layoutCallback should properly cancel if unlayoutCallback was called (#9147)  * Added checkStillCurrent checks to layoutCallback  * Addressed feedback  * Added tests  * Fixed lint issues  * Address some feedback  * Addressed feedback  * Changed test to use sandbox  * Addressed feedback  * Revert style changes, 51965089, 104, 29, 104
Update amp-selector markdown (#9269)  Headers need a space after the `#`., 51965089, 104, 29, 104
Fix ALP dependencies for PWA (#9284)  * Fix ALP dependencies for PWA  * fix linter, 51965089, 104, 29, 104
disable todo-format (#9286), 51965089, 104, 29, 104
add warning for non conforming TODO's (#9102), 51965089, 104, 29, 104
amp-bind: Integration test for amp-state looping (#9218), 51965089, 104, 29, 104
amp-ima-video: restore experiment flag after test (#9259), 51965089, 104, 29, 104
holdout experiment for AdSense amp-auto-ads (#9261), 51965089, 104, 29, 104
amp-bind: Remove web-worker fallback code (#8956)  * clean up web-worker experiment  * use testLocation for amp-worker  * fix tests  * fix amp-worker test  * fix lint  * fix tests remove unused stubs  * justin's comment, 51965089, 104, 29, 104
IMA SDK Extension for Video Ads (#8782), 51965089, 104, 29, 104
Animations: support selector and multiple targets (#9217)  * Animations: support selector and multiple targets  * allow either selector or target but not both, 51965089, 104, 29, 104
Doubleclick Fast Fetch: Measure potential delay of waiting for all ad urls to be constructed (#9244)  * Create experiment to ping time to build all doubleclick slot urls  * fix lint errors  * include populated url count  * refactor to use CSI sampling to decide whether to initialize promise  * move promise resolver  * fix type error and add fix for #9227  * fix type error  * fix type error  * add query selector generated count to ping  * PR review, 51965089, 104, 29, 104
Add keyboard support to amp-social-share (#9215), 51965089, 104, 29, 104
Feature SDK versioning for caajainfeed (#9203), 51965089, 104, 29, 104
Dynamically insert content into anchor href on click (#9086)  * Adding dynamic URL params to the link URL  * Adding dynamic URL params to the link URL  * Adding dynamic URL params to the link URL, 51965089, 104, 29, 104
fix (#9176), 51965089, 104, 29, 104
A task to search and report TODOs associated with closed issues (#9182)  * A task to search and report TODOs associated with closed issues  * better cache  * docs, 51965089, 104, 29, 104
Iframe destruction: protect against missing ownerDocument as well (#9242)  * Iframe destruction: protect against missing ownerDocument as well  * additional protection, 51965089, 104, 29, 104
Allow specifying cookie name for CID. (#9239)  * Allow specifying cookie name for CID.  * fix type check, 51965089, 104, 29, 104
Implemented video-interface and autoplay for amp-brid-player (#8632), 51965089, 104, 29, 104
Lowering heavier embed's viewport score (#9224), 51965089, 104, 29, 104
Add launch flags to invert A4A experiment flags - AdSense (#9199)  * Add launch flags to invert A4A experiment flags - AdSense  * Removes controlMeasureOnRender branch., 51965089, 104, 29, 104
truncate up to new line to not cause server stack parsing to break (#9240), 51965089, 104, 29, 104
Ramp client-side experiments to 50% (#9234), 51965089, 104, 29, 104
scrollbound amp-animation (#9194), 51965089, 104, 29, 104
Cleanup closed TODOs (#9241), 51965089, 104, 29, 104
Fix cannot apply fromCharCode in old chrome (#9237), 51965089, 104, 29, 104
Position Observer Impl First Version (#8940), 51965089, 104, 29, 104
remove $$ (#9236), 51965089, 104, 29, 104
Kixer ads: Fire ad viewability when ad is in viewport (#8289)  * Changed setInterval for setTimeout  * Changed var names to camel case and code clean up  * Added comments  * Fixed condition and added comment on timer  * Added comment to run test again  * Clear the timeout when the ad is not in view. Moved the view call to a separate function.  * Add comment to restart tests, 51965089, 104, 29, 104
always initialize bind evaluator (#9229), 51965089, 104, 29, 104
amp-bind: verify warning improvements (#9103), 51965089, 104, 29, 104
amp-bind: manually add custom functions to bind whitelist (#9223), 51965089, 104, 29, 104
Documented a few more gulp commands (#9121), 51965089, 104, 29, 104
amp-accordion peek-a-boo bug (#9221), 51965089, 104, 29, 104
Change link checker to warning-only (#9219), 51965089, 104, 29, 104
Implement replaceUrl protocol for safe URL replacements (#9175)  * Implement replaceUrl protocol for safe URL replacements  * linter  * more tests, 51965089, 104, 29, 104
Closed TODO cleanup for viewport (#9183), 51965089, 104, 29, 104
Cleanup TODOs for closed bugs. (#9181), 51965089, 104, 29, 104
Additional protection for destroyed iframes (#9214), 51965089, 104, 29, 104
Split information about OWNERS out of GOVERNANCE.md (#9205)  * initial split of owners doc  * initial split of owners doc  * fix some links  * fix some links  * fix some links  * add comma, 51965089, 104, 29, 104
Trigger timing request when gclid is present (#9173)  Now every time a gclid parameter is present in the page URL an additional hit with page load timing information will be sent across., 51965089, 104, 29, 104
Do not check document links during push builds (#9213)  * Add visual-diff test for amp-by-example  * Do not check document links during push builds  * Remove stray file, 51965089, 104, 29, 104
Improve localhost link filtering in markdown during pr-check.js (#9207)  * Improve localhost link filtering in markdown during pr-check.js  * Add TODO, 51965089, 104, 29, 104
Add a PR check test to catch dead links during docs changes (#9099), 51965089, 104, 29, 104
Investigate viewport signal failures for elements in dead FIE (#9179)  * Investigate viewport signal failures for elements in dead FIE  * also elements in dead iframes are not displayed, 51965089, 104, 29, 104
amp-bind: Fetch ww.js via RTV URL (#9172)  * fetch ww.js via rtv url  * unit test  * fix lint, 51965089, 104, 29, 104
Schedule with owner blocked on build (#9169)  * Fix scheduling with owner blocked on build  * review fixes, 51965089, 104, 29, 104
Sticky ad: wait for fixed layer to complete before loading an ad (#9171)  * Sticky ad: wait for fixed layer to complete before loading an ad  * lints, 51965089, 104, 29, 104
Make some analytics call conditional (#9061)  * AMP Analytics: Make the aip parameter changeable to false #7983  * Added tests  * Ability to disable trigger  * rolled back indentation changes  * Renamed some tests  * lint fixes  * lint errors  * lint fixes  * fixed type declarations  * fixed comments  * updated jsdoc  * updated jsdoc  * lint  * Falsey values  * jsdoc updated  * code review changes  * code review changes  * rolled back indentation  * rolled back indentation, 51965089, 104, 29, 104
Print a clearer error message when flag-config and non-flag-config files are in the same PR (#9166), 51965089, 104, 29, 104
Add info on overflow element for ad resizing (#9160)  * Add info on overflow element for ad resizing  * Added subheading per feedback, 51965089, 104, 29, 104
Allow more than one sidebar on the page (#9165), 51965089, 104, 29, 104
Minor docs fix - correct sample indentation (#9158), 51965089, 104, 29, 104
Add fluct SSP support for amp-ad (#8176)  Remove placeholder and fallback  https://github.com/ampproject/amphtml/pull/8176#discussion_r112777719  Add required param description  https://github.com/ampproject/amphtml/pull/8176#discussion_r112778128  Use encodeURIComponent  https://github.com/ampproject/amphtml/pull/8176#discussion_r112778206 https://github.com/ampproject/amphtml/pull/8176#discussion_r112778759  indent, 51965089, 104, 29, 104
Force layout of elements used in animations (#9150)  * Force layout of elements used in animations  * cleanup  * fixed tests  * check measure/display after build  * deflake tests, 51965089, 104, 29, 104
Really run Saucelab tests on latest version browsers (#9133)  * Really run Saucelabs on latest browser versions.  * Skip a test failure on FF53  * unskip test, 51965089, 104, 29, 104
Add info on data-param-quote for Facebook social share (#9159), 51965089, 104, 29, 104
Add embedded examples to amp-img (#9116), 51965089, 104, 29, 104
amp-state: Prevent update cycles from [src] mutation (#9104)  * prevent cycles due to amp-state[src] mutations  * kevin's comments  * remove default action for amp-state  * restore default action w/ user error  * update var name, 51965089, 104, 29, 104
Fix amp-pixel integration test on Saucelabs. (#9130)  * Fix amp-pixel integration test on Saucelabs.  * Remove amp-pixel unit test case for no-referrer since it's well coverred by integration test.  * Use local compiled file for test!  * fix lint  * lint  * presubmit, 51965089, 104, 29, 104
Use amp-carousel in lightbox viewer (#8865), 51965089, 104, 29, 104
Update a4a-readme.md (#7987)  * Update a4a-readme.md  * Updating with Dianomi  * Fix minor typos, 51965089, 104, 29, 104
Split off iframeMessagingClient to a service for inabox. (#9051)  * Split off iframeMessagingClient to a service for inabox.  * address comments  * fix type checks  * fix test, 51965089, 104, 29, 104
Validator Rollup (#9152)  * Revision bump.  * Revision bump.  * Revision bump.  * Revision bump.  * Allow <meta name=amp-experiment-token content=>.  * Revision bump., 51965089, 104, 29, 104
Don't require amp-state in amp-bind pages (#9146)  * don't require usage amp-state  * Remove satisfies: "amp-state", 51965089, 104, 29, 104
amp-selector code cleanup, 51965089, 104, 29, 104
Force upgrade sticky ad to 1.0 (#9042), 51965089, 104, 29, 104
Fix unit test serve mode (#9148), 51965089, 104, 29, 104
Add support for enter and space on amp-selector (#9083), 51965089, 104, 29, 104
Update detectJsEngineFromStack (#9134)  * Update detectJsEngineFromStack  * lint  * lint, 51965089, 104, 29, 104
Formatting nits for amp-selector protoascii (#9139)  - alphabetize attributes names and values - more than one child put on separate lines, 51965089, 104, 29, 104
A4A: Remove CSI pings from DOM (#9117)  * Update CSI pings to not modify DOM.  * Update CSI pings to not modify DOM.  * Lint fixes., 51965089, 104, 29, 104
Sticky-ad: Wait for 1s if ad is not stubbed (#9127), 51965089, 104, 29, 104
Duplicate errors that are un-writable (#9046)  * Duplicate errors that are un-writable  Certain errors (`DOMException`s really) have un-writable error messages. This mucks with our code since we rewrite it to signal user errors give context etc.  If an error's message isn't writable duplicate the error with one that is.  * Lint  * Fix tests  * lint  * lint  * Fix error, 51965089, 104, 29, 104
Escape cdata_regex (#9122)  * Escape cdata_regex  `\` needs to be escaped for regex updated cdata_regex to `\\w+`.  * Updated regex  Added comments as well.  * Add test html file.  * Add test out file  * Update regex  * Additional symbols  Might be used in i18n/l10n dates, 51965089, 104, 29, 104
amp-bind: Autoplay video with mutated 'src' should still autoplay (#9088), 51965089, 104, 29, 104
Cleanup getPageLayoutBox availability (#9112)  * Cleanup getPageLayoutBox availability  * fix tests  * types and additional cleanup, 51965089, 104, 29, 104
Fix tests on travis (#9119), 51965089, 104, 29, 104
Throttle A4A CSI pings in prod. (#9118), 51965089, 104, 29, 104
cleanup (#9110), 51965089, 104, 29, 104
Implementation of amp-timeago component. (#8557)  * Implementation of amp-timeago component.  * Adding copyright message to all files.  * Remove extension_unused_unless_tag_present field.  * Validation updates as requested by honeybadgerdontcare.  * Updates for open source compliance as requested by cramforce.  * If no locale is specified then fallback to the document lang property rather than en.  * Ensure textContent is not left empty.  * Only allow layout to be Container or NoDisplay.  * Updated validator file with supported layouts.  * Revert "Only allow layout to be Container or NoDisplay."  This reverts commit 38b750b95500816c822371070d69e415b39926b2.  * Revert "Updated validator file with supported layouts."  This reverts commit 820a853f7a36975e7308ae5d9e2175d174be98f1.  * Only allow fixed layout. Also now create time element inside amp-timeago element.  * Added example to readme.  * Allow responsive and fixed-height layouts which are both fixed-sized and can't cause relayout  * Ensure initial text content is not empty through regex in validation  * Documentation updates.  * Licence updates to timego.js.  * Move timeagojs to main third_party directory and add to dep-check-config.js and compile.js.  * Ensure all locale files a whitelisted in dep check.  * Moving all timeagojs locales into a single file.  * Restrict the attribute to ISO date format  * Tweak to value_regex for restricting the attribute to ISO date format., 51965089, 104, 29, 104
Update amp-3q-player protoascii (#9111)  * Update amp-3q-player protoascii  * Update test output spec_url, 51965089, 104, 29, 104
Use describes for form validator tests. (#9105), 51965089, 104, 29, 104
Disable invalid CID reporting (#9100), 51965089, 104, 29, 104
Viewer host example (#7203)  * rough PR  * fix  * fix  * fix  * erwin  * fix  * fix  * in progress  * in progress  * fix  * fix  * fix  * logging  * fix  * this  * fix  * fix  * cleanup  * cleanup  * fix  * presubmit fix  * jsdocs  * review fixes  * merge fix  * remove viewer-integr-messaging.js  * support webview  * enable iframe handshake poll  * comments fix, 51965089, 104, 29, 104
Don't use ES6 syntax in gulp task definitions (#9107)  * Don't use ES6 syntax in gulp task definitions  * More ES6 fixes  * Remove template strings and arrow functions, 51965089, 104, 29, 104
AMP Fast Fetch: Attempt to revert resize changes within unlayoutCallback (#9066)  * Attempt to revert resize changes within unlayoutcallback  * review feedback  * fix lint error  * fix type error  * fix test failures, 51965089, 104, 29, 104
Update release-schedule.md (#9092), 51965089, 104, 29, 104
Extension amp-3q-player added (#7999), 51965089, 104, 29, 104
Update the placeholder and fallback example in amp-ad.md (#9097), 51965089, 104, 29, 104
Service Registration: url-replace (#9079), 51965089, 104, 29, 104
Revert "Enable old chrome saucelabs testing (#9071)" (#9089), 51965089, 104, 29, 104
adding data-captioned to amp-instagram sample code (#9094), 51965089, 104, 29, 104
Fast Fetch non-AMP creatives remove remove load promise requirement for removing loader (#9056)  * Remove load promise constraint for loader removal if Fast Fetch non-AMP creative  * refactor  * review comments  * fix test failures  * fix test failure  * fix test failure  * fix test failure, 51965089, 104, 29, 104
document csp error for web workers (#9090), 51965089, 104, 29, 104
Update amp-video doc for click-to-play pattern (#9031)  * Update amp-video doc for click-to-play pattern  * review comments  * review comments, 51965089, 104, 29, 104
Clean up amp-app-banner bug warning in md (#8579), 51965089, 104, 29, 104
Add tests for amp-state prerender case (#9065)  * unit test for cors prerender issue  * fix lint, 51965089, 104, 29, 104
only apply mode to html (#9081), 51965089, 104, 29, 104
Fix PWA-related code for min/max transition (#9080)  * Fix PWA-related code for min/max transition  * linter, 51965089, 104, 29, 104
Percy visual diff tests (#9052)  * Add a gulp task for visual diff tests.  * Flesh out the visual-diff gulp task.  * Whitelist console error reporting  * Correct CSS widths for iPhone and Pixel  * More percy snapshot default args  * Address code review feedback  * Move hardcoded consts to the top, 51965089, 104, 29, 104
storage should use registration code path (#9076), 51965089, 104, 29, 104
make viewers have unversioned files (#9075), 51965089, 104, 29, 104
Add `keyboard-select-mode` to amp-selector (#8835), 51965089, 104, 29, 104
make viewer have unversioned code (#9073), 51965089, 104, 29, 104
Enable old chrome saucelabs testing (#9071), 51965089, 104, 29, 104
Fix flaky log test (#8999), 51965089, 104, 29, 104
Throttle: avoid duplicate function allocations (#8867)  * Throttle: avoid duplicate function allocations  * Ensure throttled function is re-entrant  * Rewrite test  Thanks!, 51965089, 104, 29, 104
Allow amp-ad data-loading-strategy attribute to take a float value. (#9003)  * Allow amp-ad data-loading-strategy attribute to take a float value.  * Address comments., 51965089, 104, 29, 104
Adds Git workflow scripts (#9029)  * add git_helpers.sh  * use rebase when pulling to master branch, 51965089, 104, 29, 104
Minor fix of attribute description (#8454)  On the description for `sizes` attribute where read:  > **sizes** >  > Same as `srcset` attribute on the `img` tag. For more information see the [common `sizes` attribute docs](../spec/amp-html-layout.md#sizes).  should read:  > **sizes** >  > Same as `sizes` attribute on the `img` tag. For more information see the [common `sizes` attribute docs](../spec/amp-html-layout.md#sizes)., 51965089, 104, 29, 104
Fast Fetch after swipe back does not send ad request (#9039)  * Handle swipe back case  * Fix insertAnalyticsElement not returning element  * Fix lint error  * Add test ensuring amp analytics element field is populated  * review changes  * fix lint error  * fix type error  * fix presubmit error, 51965089, 104, 29, 104
Fixing CustomEvent polyfill for IE11 (#9053)  * Fixing CustomEvent polyfill for IE11  * Lint, 51965089, 104, 29, 104
Gulp serve only serve either compiled or uncompiled version (#8559), 51965089, 104, 29, 104
Limit saucelabs concurrent browsers launched (#9041), 51965089, 104, 29, 104
Add Facebook like button support: amp-facebook-like (#8989), 51965089, 104, 29, 104
amp-bind: Delay init until viewer first visible (#9033)  * make bind wait until viewer visible  * fix lint  * fix tests, 51965089, 104, 29, 104
Allow carousel next and prev buttons to be reachable and usable by keyboard (#8960), 51965089, 104, 29, 104
Tap events for keyboard navigation (#8879), 51965089, 104, 29, 104
add padding hack (#9037), 51965089, 104, 29, 104
Really really disable SL Chrome 45 (#9034), 51965089, 104, 29, 104
Validator rollup (#9027)  * Revision bump.  * Revision bump.  * Revision bump.  * Revision bump.  * Revision bump.  * Update spec_urls to flattened URL schema., 51965089, 104, 29, 104
Disable SauceLab's Chrome 45 Environment (#9028)  It's sooooo slow it's killing our Travis builds., 51965089, 104, 29, 104
Add default aria-live attributes to amp-live-list and amp-fresh (#8988), 51965089, 104, 29, 104
Add keycodes utility, 51965089, 104, 29, 104
Simple doc fix (#9024)  The height is set at 100vh not 100vw, 51965089, 104, 29, 104
Turn off "hidden-v3" (#9026), 51965089, 104, 29, 104
Widespace: Amp code version in request url as query param (#8609)  * Widespace: amp code version in query param  * Widespace: changing example page adspace to get random ad, 51965089, 104, 29, 104
AMP Analytics: Make the aip parameter changeable to false #7983 (#8972)  * AMP Analytics: Make the aip parameter changeable to false #7983  * Added tests, 51965089, 104, 29, 104
Log if slide index is not a number (#8982)  * Log if slide index is not a number  * Review changes  * Review changes  * Fixing tests  * lint, 51965089, 104, 29, 104
Fix flaky xorigin-iframe-handler embed-size test (#9013)  * Fix flaky xorigin-iframe-handler embed-size test  * lint, 51965089, 104, 29, 104
Fix flaky amp-ad-3p-impl preconnect test (#9011)  * Fix flaky amp-ad-3p-impl preconnect test  * fix stupid sinon  * Fix babel-helper stub, 51965089, 104, 29, 104
amp-auto-ads: Ad placement configuration errors are user errors (#9001)  * Ad placement configuration errors are user errors  * Fix type checks, 51965089, 104, 29, 104
Investigate if old CID format is used (#9020), 51965089, 104, 29, 104
Rename googleanalytics-v2 to googleanalytics-alpha (#9007), 51965089, 104, 29, 104
Listen to messages before iframe append (#8981), 51965089, 104, 29, 104
Print full list of files in PR when pr-check fails flag-config test (#9014)  * Print full list of files in PR when pr-check fails config file test.  * Make a test change to a flag-config file. This should fail.  * Formatting fix plus another flag-config file. This should fail.  * Add a message about syncing to master.  * Clean up error messages remove test changes., 51965089, 104, 29, 104
actually use sort time when making a decision where to append the items (#9015), 51965089, 104, 29, 104
added test (#9010), 51965089, 104, 29, 104
message fix (#9008), 51965089, 104, 29, 104
Support Cloudflare Fast Fetch Ad Signing for Celtra #8973 (#8974), 51965089, 104, 29, 104
Skip test on old chrome (#8968), 51965089, 104, 29, 104
ignore any error that has stop_youtube (#8914), 51965089, 104, 29, 104
Add more details on allowed tags + minor improvements (#8990), 51965089, 104, 29, 104
Allow referrerpolicy for amp-pixel (#8991)  Per [spec](https://github.com/ampproject/amphtml/blob/master/builtins/amp-pixel.md#attributes) referrerpolicy is optional with only allowed value of "no-referrer"., 51965089, 104, 29, 104
amp-bind: Add function to print bind's scope (#8876), 51965089, 104, 29, 104
amp-bind: When applying expression results only mutate elements with changed attributes (#8773), 51965089, 104, 29, 104
Revert "Add encrypted tokens to .travis.yml for Percy access (#8957)" (#8983)  This reverts commit 553cf59aec96f1dfff92e1f76bed268012a35339.  Reason for revert: Adding the Percy tokens under matrix has the unintended side effect of running tests twice against each PR., 51965089, 104, 29, 104
Ad test failures (#8969)  * Fix amp-ad-3p-impl preconnectCallback  * Fixup createIframeWithMessageStub  * lint  * lint  * Simplfy expectMessageFromParent callback, 51965089, 104, 29, 104
changing the analytics API host name (#8888), 51965089, 104, 29, 104
Added client id scope to ezoic ad config. (#8909), 51965089, 104, 29, 104
Small change to ad placeholder tag design (#8953), 51965089, 104, 29, 104
Update experiment branch IDs (#8967), 51965089, 104, 29, 104
Allow href for all SVG tags that allow xlink:href (#8964)  * Allow href for all SVG tags that allow xlink:href  Per issue #8928 `xlink:href` has been deprecated since SVG2 in favor of `href`.  * Use alternative_names instead of new attribute  It's unlikely AMP will deprecate xlink:href even though it is deprecated in SVG. Because of that we don't need to have it as a separate attribute spec and instead use alternative_names on xlink:href., 51965089, 104, 29, 104
Report A4A experiment to CSI. (#8958)  * Report A4A experiment to CSI.  * Address comments improve test asserts., 51965089, 104, 29, 104
Remove visibility-v2 flag (#8959), 51965089, 104, 29, 104
amp-bind: Improve e-commerce example (#8924)  * first pass on prettifying ecommerce sample  * more progress on ecommerce sample  * add more sizes  * inline material design lite css  * fix initial value issues  * kevin's comments  * elaborate comment, 51965089, 104, 29, 104
Add support for change events on `<select>` elements (#8943), 51965089, 104, 29, 104
amp-nexxtv-player extension bugfix postmessages  (#8932), 51965089, 104, 29, 104
Clean up experiment flags. (#8952), 51965089, 104, 29, 104
Add encrypted tokens to .travis.yml for Percy access (#8957), 51965089, 104, 29, 104
clean experiment tag (#8840), 51965089, 104, 29, 104
Updated yarn.lock to allow development on Goobuntu. (#8949), 51965089, 104, 29, 104
Service Registration: Cleanup of service.js (#8698), 51965089, 104, 29, 104
amp-bind: Fix [class] verify bug (#8938)  * fix  * unit tests, 51965089, 104, 29, 104
splitting re-usable functionality out of traffic-experiments.js (#8374), 51965089, 104, 29, 104
Fix mistake in bindable attribute list (#8937)  `amp-list` does have a `src` attribute. Removed note that suggested otherwise., 51965089, 104, 29, 104
Fix raw sourcecode markdown (#8912), 51965089, 104, 29, 104
add missing arg instantiate immediately (#8927), 51965089, 104, 29, 104
Ensure that viewport is instantiated ASAP as other services depend on it (#8923), 51965089, 104, 29, 104
Add missing closing bracket in amp-iframe docs. (#8890), 51965089, 104, 29, 104
better error message (#8913)  * better error message  * error, 51965089, 104, 29, 104
Validator Rollup (#8884)  * Remove validation of amp-ad-metadata.  * Tweak assertion to correctly handle case-sensitive matching of custom-element and custom-template attribute values., 51965089, 104, 29, 104
add note about alt design review times (#8904), 51965089, 104, 29, 104
Ensure animation auto-starts no matter where amp-animation tag is defined (#8911), 51965089, 104, 29, 104
Remove P2R blocker from inabox (#8866), 51965089, 104, 29, 104
Add custom-element test case (#8907), 51965089, 104, 29, 104
Fix late-upgrading measuring issues (#8905)  * Fix late-upgrading measuring issues  * lint, 51965089, 104, 29, 104
Clarify the new issue template (#8667)  * Update ISSUE_TEMPLATE.md  * fix minor typos, 51965089, 104, 29, 104
Make test-custom-element hermetic via describes (#8885)  * Make test-custom-element hermetic via describes  * lints  * fix non-hermetic dom-fingerprint test  * deflaking test-amp-ad-network-adsense-impl, 51965089, 104, 29, 104
Adopt ClickHandler for FIE (#8864)  * Adopt ClickHandler for FIE  * restrict parseUrlWithA  * fixed types  * whitelist presubmits, 51965089, 104, 29, 104
Document support for waitFor  (#8718), 51965089, 104, 29, 104
Measure owned element by request (#8815), 51965089, 104, 29, 104
Simplify parseQueryString (#8877)  * Simplify parseQueryString  https://jsperf.com/parsing-query-string  * Remove unused import, 51965089, 104, 29, 104
Remove timer dependency from event-helpers (listen listenOnce) (#8472)  * Remove opt_timeout from loadPromise  Its unused  * Allow caller to call internal unlisten  This inverts the responsibility of calling the unlistener. Now the caller can be given access the `unlisten` by passing a closure. The closure is called with `unlisten` as the param giving the caller access. When the caller determines it is time to stop listening (due to timeout etc) it can manually cleanup.  * lint  * fix merge conflict  * fix test  * Fix tests, 51965089, 104, 29, 104
amp-bind: Only get form service if needed (#8868)  * only get form service if needed  * move to separate method  * justin's comment  * lazy instantiate mutation obs, 51965089, 104, 29, 104
Forbid bad startsWith and endsWith replacements (#8870)  * Forbid bad startsWith and endsWith replacements  We have helpers for these methods lets make sure we use them. This is especially valuable for long strings since our helpers are optimized to avoid whole string searches.  Oh and I moved parseQueryString into a separate module to avoid a circular dependency TODO.  * Update presubmit-checks.js, 51965089, 104, 29, 104
amp-bind: Support changing `src` on amp-list (#8735), 51965089, 104, 29, 104
amp-bind: Function invocations on null should return null  (#8763), 51965089, 104, 29, 104
Fix signals invocation as a function not a property (#8869), 51965089, 104, 29, 104
Minor doc fixes: typo and link (#8857), 51965089, 104, 29, 104
temporary fix to amp-pixel test (#8862), 51965089, 104, 29, 104
Update allowed SVG tags (#8861), 51965089, 104, 29, 104
Measure step times in pr-check.js (#8845)  * Measure step times in pr-check.js  * Require performance library  * Require performance library  * Require performance library  * Require performance library  * Use Date instead of performance  * Use Date instead of performance  * Use Date instead of performance  * Use Date instead of performance  * Bug fixes color output  * Bug fixes  * Remove colored output  * Clean up  * Address feedback  * Test by running all commands. To be removed in next commit.  * Test by running all commands. To be removed in next commit.  * More granular timing.  * Bug fix  * Colorize output.  One more try at colorizing output.  runAllCommands test successful. Reverting.  Merge branch '2017-04-17-StepTiming' of github.com:rsimha-amp/amphtml into 2017-04-17-StepTiming  Move all logs to execOrDie. Much cleaner. Also test with all commands.  Looking good. Removing all-steps test., 51965089, 104, 29, 104
Skip amp-pixel integration test (#8859), 51965089, 104, 29, 104
Adds method to allow implementing networks to execute custom reset logic. (#8774)  * Added public method to AmpA4a that is called within unlayoutCallback to allow implementing networks to perform custom reset logic.  * Fixed duplicate expectations.  * Removed unused import.  * Reverting to overriding unlayoutCallback.  * Fixed doubleclick test.  * Forgot to call super.unlayoutCallback()...  * Iframe removed through parentElement; actually removing ampAnalyticsConfig rather than just nulling it out.  * Realized that ampAnalyticsConfig != amp analytics element.  * Added asserts and extra checks.  * Lint fix.  * Assert shuffle.  * Using removeElement., 51965089, 104, 29, 104
Add missing param (#8858), 51965089, 104, 29, 104
Add CSI Pings for visibility (#8796)  * Added initial vis.listenElement calls  * Moved code into impls out of amp-a4a  * Added vis stuff to xoriginiframehandler  * Moved logic into googleAdLifecycleReporter  * Refactor all pings into performance.js  * Finished refactoring  * Fixed presubmit issues  * Fix lint issues  * Fixed failing tests addressed comments  * Update google-data-reporter.js  * Update google-data-reporter.js  * No need to pass signals in, 51965089, 104, 29, 104
Correct table formatting and article formatting & organization (#8821)  * Correct table formatting and article formatting & organization  * Minor fix per Will's suggestion, 51965089, 104, 29, 104
Introduce metric "content layout delay" as opposed to "ad layout delay" (#8789)  * Introduce metric "content layout delay" as composed to "ad layout delay"  * fix  * nit  * apply rate limit  * fix lint  * address comments  * fix check-types, 51965089, 104, 29, 104
Create experiment branch to measure impact of Delayed Fetch when counted on rendered (#8816)  * Set up a4a:3 to do count on render  * Extracted COUNT_ON_RENDER flags out to adsense/doubleclick config files  * Changed null arg to existing tests  * Refactor previous CL of same branch to move controlMeasureOnRender into external ExperimentInfo  * Fix test's 'it' string  * Linter fixes  * Fix TravisCL issue  * Fix closure type of controlMeasureOnRender to indicate it is optional  * Continuing to fix TravisCL closure type issue, 51965089, 104, 29, 104
Support referrerpolicy in amp-pixel. (#8597)  * Support referrerpolicy in amp-pixel.  * typo  * add tests.  * fix linter  * address comments  * fix  * fix type checks  * address comments  * add TODO for missing integration test.  * fix linter  * Add integration test.  * Fix CSP issue.  * errr  * fix presubmit, 51965089, 104, 29, 104
Support 'hidden' trigger for visibility-v3 (#8805), 51965089, 104, 29, 104
change config (#8839), 51965089, 104, 29, 104
enable web-worker in prod (#8846), 51965089, 104, 29, 104
Observe max URL length in App Engine for error reports. (#8834)  * Observe max URL length in App Engine for error reports.  In practice this only cuts off the "accumulated errors" and referrers. Critical parts typically fit.  Fixes #8799  Originally submitted as #8800 reverted from x-platform failures.  * Made test robust across all browsers., 51965089, 104, 29, 104
Focus on sidebar after open is complete (#8832), 51965089, 104, 29, 104
youtube no longer sends onready - and is not needed (#8831), 51965089, 104, 29, 104
manually revert 8800 (#8830), 51965089, 104, 29, 104
Tick first paint time where available. (#8823)  Introduces new `fp` performance metric., 51965089, 104, 29, 104
Only flush the pre-render metric if the page was eventually used. (#8808)  The way we tick zero if loading completed before a page is used doesn't make any sense for the case where it is never used so we exclude that from the metric., 51965089, 104, 29, 104
Observe max URL length in App Engine for error reports. (#8800)  In practice this only cuts off the "accumulated errors" and referrers. Critical parts typically fit.  Fixes #8799, 51965089, 104, 29, 104
Document debugging with ngrok (#8820)  * Document debugging with ngrok  * reshuffle, 51965089, 104, 29, 104
Move history trace into a single enqueuer (#8817), 51965089, 104, 29, 104
Don't depend on formatting args in error message in amp-list#layoutCallback (#8818), 51965089, 104, 29, 104
Provide ad position in the page. (#8811), 51965089, 104, 29, 104
Correct table formatting and links + general cleanup (#8412), 51965089, 104, 29, 104
Add proper deregistering of events & removal of elements for amp-youtube component (#8014), 51965089, 104, 29, 104
Using Array#includes instead Array#indexOf when needed (#8743)  * All indexOf > -1 rmeoved  * Removed all indexOf >= 0  * Replacing indexOf != -1 and == -1  * All indexOf replaced to includes  * Fixing lint errors  * Only arrays should use includes  * Conditions more concise and easier to read  * Revert yarn.lock  * Last char  * Condition more readable  * Removing all includes from strings  * Removing the last string include, 51965089, 104, 29, 104
Add a test case with real hash value (instead of mocking out the crypto lib) for test-cid.js (#8801)  * Add a test case with real hash value (instead of mocking out the crypto lib) for test-cid.js  * one more test case., 51965089, 104, 29, 104
Viewport: delay setting overscroll on iOS to avoid rendering bugs (#8803), 51965089, 104, 29, 104
amp-slides deprecation warning (#8797)  * Remove a small todo.  * Add a deprecation message for anyone still using amp-slides., 51965089, 104, 29, 104
Cleanup amp gist experiment (#8652), 51965089, 104, 29, 104
Add dianomi as supported ad tag (#8262), 51965089, 104, 29, 104
Reconcile API provided by AmpContext with current usage (#8790), 51965089, 104, 29, 104
Resolve more flake test in error logging (#8742), 51965089, 104, 29, 104
Analytics: expose visibility API (#8787)  * Expose visibility API  * Analytics: expose visibility API, 51965089, 104, 29, 104
Add OWNERS.yaml for many directories (#8783)  * adding a lot of OWNERS  * adding more OWNERS  * adding more OWNERS  * adding more OWNERS  * adding more OWNERS, 51965089, 104, 29, 104
Trace history API to investigate common failures (#8786)  * Trace history API to investigate common failures  * fixed types, 51965089, 104, 29, 104
Monitor duplicate pixels (#8781), 51965089, 104, 29, 104
Protect from invalid intersectioRatio values (#8772)  * Protect from invalid intersectioRatio values  * tests, 51965089, 104, 29, 104
Update AMP4ADS start document for validator.ampproject.org. (#8769), 51965089, 104, 29, 104
fix typo remove space (+2 squashed commits) (#8744), 51965089, 104, 29, 104
Update amp4ads validator test cases to replace usage of v0.js with (#8766)  amp4ads-v0.js., 51965089, 104, 29, 104
amp-bind: Expose encodeURI and encodeURIComponent in bind (#8723), 51965089, 104, 29, 104
Don't deep merge an object with itself in object util function (#8749), 51965089, 104, 29, 104
Unflake the error.js test (#8760), 51965089, 104, 29, 104
Update name from A4A to AMP ad where applicable (#8758), 51965089, 104, 29, 104
Extension analytics to load immediately (#8759)  * Extension analytics to load immediately  * fix types  * tests, 51965089, 104, 29, 104
Enable CORS so disable3pfallback works locally as well (#8753), 51965089, 104, 29, 104
amp-bind: Allow binding to amp-state[src] (#8729)  * support binding to amp-state[src]  * comments  * only allow https urls  * add unit tests  * origin trial hack for bind  * update docs  * kevin's comments  * fix types, 51965089, 104, 29, 104
Fix validation for duplicate attribute names on dispatch keys (#8748)  * Add a test involving duplicate attribute values.  * Re-merge duplicate attribute tests and move duplicate dispatch key check earlier in validation.  * Fix up instances of == and != that have cropped up in the validator javascript code., 51965089, 104, 29, 104
Adds centering logic for AdSense/DoubleClick FF. (#8724)  * Added centering logic for AdSense/DoubleClick.  * a4a.iframe is now public; added tests.  * Fixed lint/type checks.  * Test update.  * Yet another test update.  * Fixed comment added asserts reseting this.iframe.  * Fixed test breakage.  * Removed asserts split css styling., 51965089, 104, 29, 104
Add launch flags to invert A4A experiment flags (#8674)  * Initial implementation of launch flags. Not complete but pushing to GH to expedite review in parallel  * Addressed some PR feedback but not all  * Added unit tests for DoubleClick  * More unit tests  * Removed ternary operator switched from hasLaunched to isExperimentOn  * Splitting config files into separate PR because flag-config and non-flag-config files are not allowed in same PR.  * Fix linter errors  * Fix linter errors  * More linter fixes  * Partial implementation of review feedback  * Refactor due to review feedback  * Mostly nits  * Refactor tests into loop  * Minor formatting  * Resolve linter issues  * Resolve linter issues  * Remove 2 unused lines, 51965089, 104, 29, 104
Added isc--isCanary--as a URL param attached to outgoing AdSense/DoubleClick ad requests. (#8707)  * Added isc--isCanary--as a URL param attached to outgoing AdSense/DoubleClick ad requests.  * Lint fix.  * Only include param if canary. Added test to force canary on/off.  * Test update.  * Minor test tweaks., 51965089, 104, 29, 104
Update documentation to allow autoplay video in amp-carousel (#8623), 51965089, 104, 29, 104
Fixes amp-analytics debug pings to include additional information. (#8722)  * Fixes amp-analytics debug pings to include additional information.  * Using window.performance when available.  * Removed unused import.  * PR feedback: Broke apart regexp matches added dt param minor edits.  * Lint.  * Changed 0 to -1 exposed getDetalTime().  * Updated test-utils.  * Added ad type experiments and runtime version., 51965089, 104, 29, 104
Prevent 'forEach is not defined' in installActionHandler (#8702) (#8712), 51965089, 104, 29, 104
Clarify the adding of target= to anchors. (#8734)  AMP caches will add a target= attribute to anchor tags and that target may change depending if there is a `<base target=...>` on the document., 51965089, 104, 29, 104
amp-bind: Fix [class] verification (#8717)  * fix class verification in amp-bind  * kevin's comment, 51965089, 104, 29, 104
Fix race condition between amp-bind's scan and amp-form (#8661), 51965089, 104, 29, 104
Activate pump-early-frame experiment for canary. (#8705)  This should be activated with the next canary release., 51965089, 104, 29, 104
Resolve flake when reported flag is applied to an error in test (#8732), 51965089, 104, 29, 104
Enable CORS on test A4A requests (#8726)  * Enable CORS on test A4A requests  * fallback, 51965089, 104, 29, 104
Fix initialization of lifecycle reporter for delayed fetch slots. (#8706)  * Fix initialization of lifecycle reporter for delayed fetch slots.  * Pass Delayed Fetch pings uniformly through emitLifecycleEvent.  * Type check fixes.  * Type check fixes.  * Type check fixes.  * Add a dt= param.  * Rename param for clarity., 51965089, 104, 29, 104
Create config flags to be used in invert_a4a_doubleclick_flags branch (#8728), 51965089, 104, 29, 104
Updated the host of Hulu Player (#8721), 51965089, 104, 29, 104
amp-bind: Documentation Updates (#8660), 51965089, 104, 29, 104
Fix race condition in service registration (#8720), 51965089, 104, 29, 104
check for iframe (#8714), 51965089, 104, 29, 104
Add CORS note for amp-call-tracking docs (#8563), 51965089, 104, 29, 104
Presubmit checks for catching bad merge conflicts (#8711)  Catch stuff like #8710., 51965089, 104, 29, 104
Fix bad merge removes analytics vendors from main amp-analytics doc page (#8710), 51965089, 104, 29, 104
enable web-worker in canary (#8704), 51965089, 104, 29, 104
Update action documentation to include new input data (#8633), 51965089, 104, 29, 104
Optimize and fix pump-early-frame experiment. (#8669)  - use timeout instead of vsync. It turns out that is enough to get a pending paint. - execute "high priority" extensions (mainly viewer integration) before the paint. Otherwise the page isn't actually visible in the viewer case.  I'm a bit sad about the code duplication for the latter but given the complex filtering difference I think it is fine., 51965089, 104, 29, 104
Add support for "waitFor" in visibility-v3 (#8650), 51965089, 104, 29, 104
Fix image-lightbox resize issue in ios 10.3 (#8687), 51965089, 104, 29, 104
Decrease time until SW installation from 20s to 10s. (#8679)  We want to only do this when users really engaged with a page but feedback was that 20s may be too long.  Fixes #8376, 51965089, 104, 29, 104
Only allow setting cookies on AMP cache domains when explicitly allowed. (#8690)  Otherwise throw an error so instances of this can be debugged., 51965089, 104, 29, 104
amp-state: Allow fetch on page load (#8574)  * squash amp-state fetch on load  * carlos's comments, 51965089, 104, 29, 104
fix bind text integration (#8689), 51965089, 104, 29, 104
Add cdnProxyRegex to AMP_CONFIG so it can be overriden externally (#8684), 51965089, 104, 29, 104
amp-bind: Remove key-value setState syntax (#8595)  * remove old set-state syntax and error instead  * fix unit test, 51965089, 104, 29, 104
Tighten amp-state script validation. (#8686), 51965089, 104, 29, 104
Adds links to "join project" form & better places to ask questions (#8676)  * adds links to join project form + other forums  * shorten the "join" section, 51965089, 104, 29, 104
Unblocking the master on Edge (#8680), 51965089, 104, 29, 104
Add links to doc/codelab/video for creating an AMP component (#8670)  * Add doc/codelab/video links for adding components  * fix doc link, 51965089, 104, 29, 104
Service Registration: Parallax (#8662), 51965089, 104, 29, 104
Allow amp-animation custom-element for validation. (#8664), 51965089, 104, 29, 104
remove unnecessary test files (#8663), 51965089, 104, 29, 104
Experiment with new ad default placeholder design (#8629), 51965089, 104, 29, 104
AMP Ad Fast Fetch: ensure onCreativeRender fires after iframe append for xdomain flow (#8651)  * Ensure onCreativeRender fires after iframe append for xdomain flow  * fix presumbit error, 51965089, 104, 29, 104
Service Registration: Viewer (#7896), 51965089, 104, 29, 104
Support Cloudflare Fast Fetch Ad Signing for Yieldmo #8619 (#8620), 51965089, 104, 29, 104
Split-up of amp-bind-integrations.html for p-tag (#8435)  * Split-up of amp-bind-integrations.html for p-tag  * Split-up of amp-bind-integrations.html for p-tag added split test for p-tag  * Split-up of amp-bind-integrations.html for p-tag added split test for p-tag  * Fixed indentation errors  * Fixed indentation errors  * Changed import location, 51965089, 104, 29, 104
remove usage of #injectActiveViewAmpAnalyticsElement function (#8628), 51965089, 104, 29, 104
Changes how ifi param is created for FF AdSense/DoubleClick. (#8624)  * Starts amp-ad slot counter at 1; each impl network gets their own counter.  * AdSense and DoubleClick now share an ifi counter which increments from 1 rather than 0.  * Stash.  * Added tests.  * Removed unneccessary timeout adjustment., 51965089, 104, 29, 104
Performance: add messaging-ready tick (#8642), 51965089, 104, 29, 104
CSI: ensure that 0 ticks are always passed as 1 (#8645)  * CSI: ensure that 0 ticks are always passed as 1  * comments, 51965089, 104, 29, 104
Cleanup misspelled fistVisibileTime (#8646), 51965089, 104, 29, 104
Analytics: selector attributes and interpretation for visibility triggers (#8354)  * Analytics: selector attributes and interpretation for visibility triggers  * cleanup  * review fixes  * reset  * sync, 51965089, 104, 29, 104
temporary fix (#8644), 51965089, 104, 29, 104
AMP Access to ampdoc-level service (#8600)  * AMP Access to ampdoc-level service  * linter  * type fixes  * make performance optional  * cleanup  * test fixes, 51965089, 104, 29, 104
Revert "don't queue more than one schedule call (#8475)" (#8639)  This reverts commit 0885e2c18ece3e061a9172010341297fa0b11545., 51965089, 104, 29, 104
Minor: cleanup dangling spaces (#8640), 51965089, 104, 29, 104
Launch visibility v3 (#8637), 51965089, 104, 29, 104
Fix locally failing test. (#8636)  Related to #8635, 51965089, 104, 29, 104
Fix github.com link (#8622), 51965089, 104, 29, 104
Service Registration: Ampdoc (#7878), 51965089, 104, 29, 104
Service Registration: History (#7885), 51965089, 104, 29, 104
Remove external font reference from test. (#8631)  All the fonts do is make the tests slower and non-hermetic.  Also blackhole the host because some ads test use it for font in ads testing., 51965089, 104, 29, 104
amp-bind: Add TOC and debugging info to docs (#8621)  * first pass on error docs  * kevin's comments, 51965089, 104, 29, 104
amp-bind: Support range checkbox and radio inputs  (#8569), 51965089, 104, 29, 104
Fix race condition in evaluating pre-render performance. (#8630)  We need to wait for AMP to be fully initialized (and e.g. actual custom elements to be registered) before attempting to measure them.  Fixes #8490, 51965089, 104, 29, 104
Contributing document describing the basics of how to contribute validator rules for amp components. (#8599)  * Add a new contributing document describing the basics of how to contribute validator rules for amp components.  * Fixes propopsed by @mrjojo.  * Move closing } to previous section., 51965089, 104, 29, 104
Extend webview rules to Android (#8626), 51965089, 104, 29, 104
Service Registration: Viewport (#7897), 51965089, 104, 29, 104
Fix service.js "...orNull" functions to instantiate services if needed #8616 (#8618)  * fixed functions mentioned on issue  * add test for ampdoc services  * typo  * types  * dima's comments, 51965089, 104, 29, 104
Service Registration: Input (#7886), 51965089, 104, 29, 104
amp-bind explicitly name copyAndSplice (#8614), 51965089, 104, 29, 104
Clean up experiment flag (#8615), 51965089, 104, 29, 104
Amp-Gist: Have links open in new tab (#8587) (#8603), 51965089, 104, 29, 104
add link to #release Slack channel (#8598), 51965089, 104, 29, 104
Flips dc-use-attr-for-format experiment on. (#8596)  * Flipping on {asdc}-use-attr-for-format experiment on.  * Only activating AdSense., 51965089, 104, 29, 104
Implement Rakam (#8443)  * Implement Rakam  * Fix indentation error  * Fix mismatch in parameters  * Fix typo  * Fix string formatting  * Do not use slash in URL  * Fix typo  * Fix typo  * Added Rakam to amp-analytics.md  * Fix merge bug  * Activate beacon & xhrpost  * Addressed requested changes  * Add trailing comma, 51965089, 104, 29, 104
CSS and other minor fixes for Fast Fetch (#8533)  * We now check that height & width are numbers in adsense-impl and centering css is applied on all FF rendered creatives.  * Removing debug statement.  * Iframe height/width now set in onCreativeRender to match height/width passed in ad request. Fixed CSS selectors. Fixed impl tests.  * Added experiment flag.  * Added data attribute to test element in order to trigger css styling.  * Explicitly converting height/width to Number and adding check that they are positive.  * Reverted location of viewerForDoc.  * Changing approach to set iframe size before it is rendered rather than applying CSS after the fact.  * removed test file  * Reintroducing css.  * Removed frame height/width styling in impls.  * Lint fixes.  * Fixed amp-a4a test.  * Made test description more accurate.  * Removing exp flag file. Will reintroduce in separate PR.  * Added tests for impls.  * Reverted example page.  * Lint fix.  * Fixed DoubleClick test.  * Removed file that apparently came out of thin air.  * amp-a4a refactor + comments.  * Type annotation fix.  * Split experiment into two: one for DoubleClick (dc) and one for AdSense (as).  * Restructured DoubleClick exp logic.  * Removed dep-check whitelists.  * Removed no longer relevant comment.  * Removed debugger statement.  * Fixed DoubleClick test., 51965089, 104, 29, 104
Allow multiple callbacks for same response type in IframeMessagingClient (#8591), 51965089, 104, 29, 104
Fix some spec_urls and update others. (#8593), 51965089, 104, 29, 104
Service Registration: Templates (#7893), 51965089, 104, 29, 104
amp-bind: Cleanup game and Turing examples, 51965089, 104, 29, 104
Clean up form and url-replace experiments from config (#8547), 51965089, 104, 29, 104
Service Registration: Action (#7891), 51965089, 104, 29, 104
Enhance AmpContext for parity with window.context (#8469)  * Expose clientId  * types  * add hidden  * add note  * Fix type for context.location  * Make AmpContext abstract  * Create concrete implementation of AmpContext for integration.js binary  * Use specific impl of AmpContext for integration.js binary  * Enhance AmpContext to reach parity with window.context  * add externs  * lint  * Whitelist use of sendMessage (uses iframe messaging client)  * Make sure that attributes are being parsed for both context modes  * Disable tests since they're wrong  * Address comments  * Remove unused import  * Use observable  * Allow 3p to use Observable  * Use Observable for intersection observer  * Types  * Change visibility change api  * Only assert frame name if needed  * Update tests to match new behavior  * Add notes  * Set embed type from constructor  * Move masterSelection, 51965089, 104, 29, 104
Send navigateTo message to viewer in app banner in ios embed (#8291), 51965089, 104, 29, 104
Deflake form integration tests (#8577), 51965089, 104, 29, 104
pass argv value through process.env (#8578), 51965089, 104, 29, 104
Updating to remove "draft". (#8362)  * Updating to remove "draft".  * Updating meta tags as well, 51965089, 104, 29, 104
Enable animations for page opt-in (#8573), 51965089, 104, 29, 104
amp-bind: Deep merge state updates (#8458), 51965089, 104, 29, 104
Added test file for AmpContext.js (#8502)  * Fixed ampcontext  * Added test-amp-context file  * Added test-amp-context.js, 51965089, 104, 29, 104
Use nodemon to watch server change. (#8496)  * use nodemon  * add nodemon to package  * refactor file  * rename file, 51965089, 104, 29, 104
Validator error codes: make sure that we are storing the correct number of (#8518)  error parameters in the error response for clients that are parsing the parameters., 51965089, 104, 29, 104
Remove explicitly set language mode the default is now ES6 (aka EcmaScript 2015). (#8516), 51965089, 104, 29, 104
Cleanup make-body-relative experiment (#8512), 51965089, 104, 29, 104
Validatorrollup (#8513)  * Intern TagSpec::mandatory_alternatives.  * Avoid instantiating regexes for AttrSpec unless they're actually run.  * Even more laziness for ParsedAttrSpec (ParsedValueProperties and triggers).  * In light mode return earlier if the combined blacklist matches.  * Insert some comments around the disallowed_domains parameters in the validator rules.  * Allow any whitespace in script tags. Previously we only allowed '\n'.  * Revision bump  * Remove unnecessary spec_name and other validator clean up  * Cache the regex objects precompute the combinedBlacklistedCdataRegex some simplications.  * Revision bump  * Improve error for non-whitespace text inside tags and assign it to the DISALLOWED_HTML category.  * Rearrange how/when line/col information is stored in matchers by introducing a DOCUMNENT_START constant.  * Revision bump.  * Revision bump.  * Remove i-amp-access-id from amp-access & amp-access-laterpay.  * Revision bump to match #8457 and #8353, 51965089, 104, 29, 104
amp-bind: Validate brightcove youtube and iframe integrations (#8353)  * add validator support for brightcove youtube and iframe  * remove srcdoc when applying [src] binding  * missing 'name' key in brightcove attrs  * require src for [src], 51965089, 104, 29, 104
Add max size limit for amp-state (#8429)  * add amp-state max size limit  * fix spec url, 51965089, 104, 29, 104
fix (#8508), 51965089, 104, 29, 104
Adds URL params to CSI ping generated from amp-analytics. (#8509)  * Adding params to amp-analytics CSI ping.  * Fixed adsense test.  * Removed test file.  * Fixed types., 51965089, 104, 29, 104
Delayed rendering via safeframe in Fast Fetch should support AmpContext (#8487)  * Pass metadata into safeframe and ampcontext should handle it  * Safeframe now works with ampcontext  * Added extern  * Added test coverage and addressed comments  * Check for object consolidate duplicate code  * Added todos  * sf_.cfg is a string not object, 51965089, 104, 29, 104
Revert back to the new prerenderComplete calculations (#8506), 51965089, 104, 29, 104
rephrase width/height rule for amp-ad (#8497), 51965089, 104, 29, 104
amp-ad type=outbrain (#8441)  * Initial Commit Implement logic Add Service Registration and Documentation  * Remove Intersection Observer set js to outbrain domain  * Use minified file  * Fix linting issues and update height on amp-embed  * Update docs change use back to multiple widgetids per amp-embed update widgetdata defaults  * Update docs fix prefetch update required valid input data  * update implementation to namespace object assignment instead of function call when script is ready  * change back script domain  * alphabetic order on amp_embed_allowed  * update example attributes to follow indentation rule, 51965089, 104, 29, 104
Service Registration: Video Manager (#7895), 51965089, 104, 29, 104
Service Registration: Amp Worker (#7898), 51965089, 104, 29, 104
Service Registration: Timer (#7894), 51965089, 104, 29, 104
carve-out doubleclick Fast Fetch if useSameDomainRenderingUntilDeprecated (#8503), 51965089, 104, 29, 104
Service Registration: Preconnect (#7888), 51965089, 104, 29, 104
Service Registration: Resources (#7889), 51965089, 104, 29, 104
Proofread amp-list (#7342)  * Proofread amp-list  * Fix nit: and -> an, 51965089, 104, 29, 104
Fixing WhatsApp social share on iOS 10.3 (#8486), 51965089, 104, 29, 104
amp-gist: Implement support for optional `data-file` attribute. (#8494)  * Build gist URL before passing it as param (#8489)  * Optionally specify a single file (#8489)  * Add single file example (#8489)  * Add example of displaying only one file. (#8489)  * encode URI parameters to be safe (#8489)  * Update amp-gist docs to be easier to read (#8489)  * fix required script custom-element name (#8489)  * add new attribute to validator file (#8489), 51965089, 104, 29, 104
Fix iOS 10.3 specific code leaking to older versions (#8498), 51965089, 104, 29, 104
Adds CSI pingbacks to amp-analytics config. (#8492)  * Added CSI pingbacks to amp-analytics config.  * Removed console.log statement., 51965089, 104, 29, 104
Remove adtest param from Google Fast Fetch when not set (#8438), 51965089, 104, 29, 104
Whitelist certain eventType and scope selector for analytics in scope (#8389)  * black list eventType and replace selector selectionMethod  * remove blocker  * rename  * use whitelist, 51965089, 104, 29, 104
Limit the number of elements to build during prerender (#8364)  This significantly reduces the amount of CPU needed for very large documents during prerender. The count of elements to build was chosen arbitray as "big enough that it typically should be enough to render stuff in the first viewport".  This seems to work quite well and it suggests we do have quite the opportunity to optimize things with a chunking scheduler.  The document I was testing with (http://www.refinery29.com/amp/best-pizza-nyc) does get much better with this although it doesn't get into good shape since it is simply too big for a browser (let alone a mobile browser) to reasonably render., 51965089, 104, 29, 104
Treat sticky position as fixed for the purpose of ads. (#8444)  Since `sticky` position can be effectively `fixed`. `amp-sticky-ad` continues to be available to do the behavior in a compliant way.  Fixes #8371, 51965089, 104, 29, 104
amp-bind: Deprecate key-value syntax for AMP.setState()  (#8457)  * change examples to use new syntax add warning  * fix presubmit  * fix typo, 51965089, 104, 29, 104
Fix amp-a4a-format.md format (#8488), 51965089, 104, 29, 104
don't queue more than one schedule call (#8475), 51965089, 104, 29, 104
Don't call listeners with explicit context (#8482), 51965089, 104, 29, 104
The final pre-cleanup round of i-amphtml- prefixes (#8483), 51965089, 104, 29, 104
fix spacing in documentation (#8481), 51965089, 104, 29, 104
Adds 'act' 'ea' 'dff' and 'pfx' URL parameters. (#8417)  * Adds 'act' 'ea' 'dff' and 'pfx' URL parameters.  * Using computedStyle from style.js + minor tweaks.  * Using git add -A instead of || false.  * Fixed Doubleclick impl tests.  * Lint fix + minor tweak to pfx.  * Removing code that somehow bled in from a separate branch...  * Removing test file.  * Using dom.closest in lieu of explicit loop.  * Reverted to using loop; cleaned up a comment.  * Shortened variable name for readability., 51965089, 104, 29, 104
amp-bind: Don't depend on template location to locate dynamic elements (#8367), 51965089, 104, 29, 104
Encode output of svgo to fix carousel arrow SVG in IE (#8449), 51965089, 104, 29, 104
Use listen in listenOnce (#8456)  * Use listen in listenOnce  Fixes #7591.  * lint  * Add comments  * Fix nullable type, 51965089, 104, 29, 104
Remove Timer#promise opt_result param (#8465)  It's unused., 51965089, 104, 29, 104
amp-viewer-integration documentation replace placeholder images (#8473)  * update images  * replace image placeholders  * making the images smaller, 51965089, 104, 29, 104
Remove redundant code from amp-list (#8466), 51965089, 104, 29, 104
remove css from amp-embed (#8422)  * remove css from amp-embed  * add amp-embed iframe css, 51965089, 104, 29, 104
Reflect default experiment state (based on AMP_CONFIG) on experiments page (#8342)  Fixes #7890, 51965089, 104, 29, 104
Major overhaul to i-amphtml- internal prefix (#8470), 51965089, 104, 29, 104
Fix flaky amp-ad-xorigin-iframe-handler test (#8363)  * fix flaky test  * sync, 51965089, 104, 29, 104
Amp-gist: Implement GitHub Gist embed. (#8263), 51965089, 104, 29, 104
Remove whitelisting of 'i-amp-' prefix. (#8468)  This is no longer necessary as the AMP Runtime has been updated for all instances of `i-amp-` to `i-amphtml-`., 51965089, 104, 29, 104
Service Registration: Document Info (#7883), 51965089, 104, 29, 104
Service Registration: Platform (#7887), 51965089, 104, 29, 104
Fix broken internal link in doc (#8335), 51965089, 104, 29, 104
create contributing OWNERS (#8471), 51965089, 104, 29, 104
amp-viewer-integration images for documentation (#8462)  * smashed images for documentation  * name fix, 51965089, 104, 29, 104
Change access internal names to i-amphtml- prefix (#8461)  * Change access internal names to i-amphtml- prefix  *   attrs: { name: i-amp-access-id }  * reverted back validator files, 51965089, 104, 29, 104
Pixel: empty src should not fire or throw errors (#8460), 51965089, 104, 29, 104
A4A: report fallback w/o stack (#8459), 51965089, 104, 29, 104
Defer Layout Assertions till Upgrade (#8229)  * Remove attached and upgrade duplication  They had very tangled state depending on the state of the element:  - Stubbed - `#attachedCallback` - sync `#firstAttachedCallback`  (on a stub!) - sync `amp:stubbed` - `#upgrade` - deferred "full" upgrade - deferred `#firstAttachedCallback` - deferred `amp:attached` - deferred `Resources#build` - BaseElement sync "full" upgrade - `#attachedCallback` - sync "full" upgrade - sync `#firstAttachedCallback` - sync `amp:attached` - sync `#firstAttachedCallback` (twice!) - sync `Resources#build` - BaseElement async "full" upgrade - `#attachedCallback` - sync `#firstAttachedCallback` (on nothing useful!) - sync `amp:stubbed` - `#upgrade` - deferred "full" upgrade - deferred `#firstAttachedCallback` - deferred `amp:attached` - deferred `Resources#build`  This moves all that code into the `#completeUpgrade` which is either called sync (if upgrade can be done sync) or async (if not). Thus we get all of the same behavior without mixing code between the two methods.  * Remove bogus first `#firstAttachedCallback`  It's either called on a stubbed element (useless) a sync upgraded element twice(!) or a deferred upgraded element (useless).  It will be called a second time after the upgrade is complete.  * Remove layout assertions from attachedCallback  We must wait until the element is fully upgraded.  * Make sure resources is added before it's upgraded  * Make sure resources is rebuilt if needed after being reparented  * Only mark the resoruce as upgraded when element is upgraded  * Fix tests  * Fix more tests, 51965089, 104, 29, 104
Use more descriptive aria-labels for carousel buttons (#8453), 51965089, 104, 29, 104
amp-viewer-integration documentation (#8419)  * test  * more  * fix  * fix  * fix  * more  * more  * smaller img placeholder  * more  * fix  * fix  * more  * more  * fix  * fix  * fix?  * fix  * more  * fix  * fix  * rename  * rename, 51965089, 104, 29, 104
Flying carpet: relax positioning constraints (#8373)  * Flying carpet: make container full viewport and center content  * Flying carpet: relax positioning constraints, 51965089, 104, 29, 104
Support AMP Cache URL Scheme Change. (#8424), 51965089, 104, 29, 104
Add section on rewriting `<meta>` tags. (#8421)  Given that some `<meta>` tags are important for AMP Components (e.g. amp-experiments-opt-in) move all `<meta>` tags to be the first children of `<head>`., 51965089, 104, 29, 104
Minor fix of attribute name per #406 (#8445), 51965089, 104, 29, 104
Prevent amp-carousel next/previous icons fade away on desktop (#8428), 51965089, 104, 29, 104
Turn on flag slidescroll-disable-css-snap (#8436), 51965089, 104, 29, 104
Revert "temporarily turn off yarn (#8356)" (#8384)  * Revert "temporarily turn off yarn (#8356)"  This reverts commit d79cf560515080ce7cf2a4c967e2d884dae08b1e.  * remove yarn check for now, 51965089, 104, 29, 104
initial commit (#8404), 51965089, 104, 29, 104
Upgrades for Index Exchange amp-ad tags to report load statistics (#8054), 51965089, 104, 29, 104
amp-bind validation tweak (#8414), 51965089, 104, 29, 104
Fix an amp-instagram race condition (#8192), 51965089, 104, 29, 104
Use whitelist to restrict urlReplacement for scoped analytics element (#8360)  * use whitelist when replace scoped url  * address comment  * shorten-whitelist  * rename, 51965089, 104, 29, 104
Report active experiments in error logs (#8108)  * Move URL experiment overrides into toggles  * Test that URL overrides cookies  * Add experiments to error reports  * Use custom format  * lint  * lint  * Fix tests  * Fix experiments hash  * Fix test  * Ensure AMP_EXP is reset when resetting toggles  * lint  * Move pump-early-frame into allow-url-opt-in, 51965089, 104, 29, 104
amp-bind: Catch exceptions in mutatedAttributesCallback (#8383)  * initial commit for callback guard  * fix typo, 51965089, 104, 29, 104
Fixing custom scroll-snap on IOS (#8391)  * Fixing custom scroll-snap on IOS  * More testing.  * Adding IOS_CUSTOM_SNAP_TIMEOUT  * Adding IOS_TOUCH_TIMEOUT  * Bring back experiments and test on all devices.  * lint fix, 51965089, 104, 29, 104
Add experiment for using AmpContext class in integration.js (#8348)  * Add experiment for using AmpContext class in integration.js  * Use 3p-specific experiment check  * Whitelist deps for 3p, 51965089, 104, 29, 104
add (#8349), 51965089, 104, 29, 104
swipe api (#8357)  * swipe api  * fix  * lint  * lint fix  * fix  * fix  * fix  * fix  * revert  * remove linter  * comment update  * updated documentation, 51965089, 104, 29, 104
skip 3 flaky tests (#8388), 51965089, 104, 29, 104
amp-bind: Expression complexity limit (#8321)  * initial commit for expr size constraint  * rename test-bind-expr.js to test-bind-expression.js  * unit test  * ignore constraint in localDev  * also ignore binding constraint in localDev  * don't skip constraints while testing  * improve error message, 51965089, 104, 29, 104
add margin-bottom (#8350), 51965089, 104, 29, 104
Flying carpet: make container full viewport and center content (#8292), 51965089, 104, 29, 104
Service Registration: Document Click (#7882), 51965089, 104, 29, 104
Add a8ad (#8036)  * Support ads A8 .  * Comment change.  * Add renderStartImplemented=true.  * Changed copyrights 2017. Cleaned indent. Add params description.  * Changed writing format., 51965089, 104, 29, 104
Introduce amp4ads-id meta tag in A4A format doc. (#8051)  * Introduce amp4ads-id meta tag in A4A format doc.  * fix  * Update  * address comments, 51965089, 104, 29, 104
Extract client ID from _ga cookie. (#8317)  * Extract client ID from _ga cookie.  * fix presubmit  * fix presubmit  * fix test, 51965089, 104, 29, 104
amp-form: add 'amp-form-submit' analytics event (#8212)  * Trigger 'amp-form-submit' analytics event when a form is submitted  * Ensure amp-form-submit analytics event is not triggered when POST request is non-XHR  * Fix linter errors  * Update amp-form docs with info about amp-form-submit event  * Remove a duplication from test-amp-form.js  * Improve description of amp-form-submit event in the amp-form docs  * amp-form-submit: use this.getFormAsObject_ function instead of FormData  * amp-form-submit: refactor the code; ensure the event is triggered after variables substitution  * amp-form-submit: rewrite the event description as proposed by a reviewer  * amp-form-submit: improve the formatting of the event description  * amp-form-submit: improve the formatting of the event description, 51965089, 104, 29, 104
Add CustomEvent constructor polyfill (#8345)  * initial commit for CustomEvent fix  * justin's comments  * rename to createCustomEvent()  * move fn to src/event-helper.js  * unit test, 51965089, 104, 29, 104
Update amp-bind.md (#8309), 51965089, 104, 29, 104
Service Registration: Crypto (#7881), 51965089, 104, 29, 104
Create srcset in #layoutCallback (#8361)  Each srcset takes ~.2ms (for 2 possibles selections) to parse and create. Moving this into `#layoutCallback` saves us from doing that when we parse _every_ image on the page., 51965089, 104, 29, 104
Make ios major version default null (#8332), 51965089, 104, 29, 104
temporarily turn off yarn (#8356), 51965089, 104, 29, 104
Added newly appearing host for Twitter preconnect (#8339)  And changed preload into order they are required., 51965089, 104, 29, 104
meta tag attribute values are case-insensitive (#8324)  Updates the whitelist for meta tag removal that the attribute values are case-insensitive., 51965089, 104, 29, 104
Refactor AmpContext dependencies for building (#8258)  * Fix types for AmpContext  * Move and split dependencies for ampcontext-lib  * Enable type checks for ampcontext-lib, 51965089, 104, 29, 104
Sticky ad behavior changes (#8336)  - Remove item about how sticky ad will only load after 1 viewport is scrolled (no longer true) - Add item to reflect that container collapses if no ad is filled, 51965089, 104, 29, 104
Add ini-load to trigger list (#8337), 51965089, 104, 29, 104
Changes the way AdSense slot format is computed in FF and adds creative centering. (#8012)  * For AdSense FF changed format computation to rely on when available the slot width/height attributes. Also added creative centering.  * Forgot import statement + removed extraneous space.  * Using slot width and height.  * Fixes #getAdUrl test.  * Lint error.  * Lint error.  * Added three additional tests.  * Added trailing commas to placate linter.  * Added expectations on tag dimensions for new tests + linter fix.  * Missed merge issue.  * Removed unused import.  * Using querySelector.  * Moved styling into css file; removed tests.  * Re-added the tests which now check for the presence of the correct computed styles.  * Unused import.  * Removed some test code.  * Cleaned up tests., 51965089, 104, 29, 104
fixing bug in attemptChangeSize code (#8250), 51965089, 104, 29, 104
Cache SW: Ensure any failure is always logged. (#8328)  * Ensure any failure is always logged.  * lint  * Tell closure compiler it'll be alright., 51965089, 104, 29, 104
Cache SW: Revamp purging logic (#8325)  * Introduce helper to get environment from RTV  * Revamp pruning logic  * Fix #8207  Fixes #8207  * Test requesting new diversion from page  * Do not delete production version of another script  * lint, 51965089, 104, 29, 104
Update Cache SW manual test environment (#8326), 51965089, 104, 29, 104
add custom variables support for openx amp-ads (#7968)  * add custom variables support for openx amp-ads  * add bc param for the oxRequest implementation  * inlined custom vars on markdown, 51965089, 104, 29, 104
amp-bind: Validation (#8133)  * add bindable attrs to validator protoascii  * make [text] global  * fix validator-amp-bind test, 51965089, 104, 29, 104
variable density changes (#8293), 51965089, 104, 29, 104
ensuring ads are centred (#8255), 51965089, 104, 29, 104
Do not set Date header (#8320)  Stupidly ServiceWorkers do not allow mutations to the response headers. Actually only SWs do this every other type of Response would have allowed this., 51965089, 104, 29, 104
Make chrome ios create the correct viewport binding (#8203), 51965089, 104, 29, 104
Do not remove `meta` tags with `amp4ads-` prefix (#8302)  This is for issue #7730., 51965089, 104, 29, 104
Visibility: fix polyfill implementation for :root (#8299), 51965089, 104, 29, 104
Fix fontloader polyfill by comparing against one default font at a time. (#8281), 51965089, 104, 29, 104
Update managing user state based on link sub launch (#8305)  - Remove notice that link substitutions isn't launched since it's now available in production - A couple fixes to syntax to reflect required use of `data-amp-replace`, 51965089, 104, 29, 104
Increment SafeFrame version to current. (#8294), 51965089, 104, 29, 104
Workaround Chrome top=auto bug for position:sticky (#8303), 51965089, 104, 29, 104
Service Registration: Amp Fresh (#7874), 51965089, 104, 29, 104
Service Registration: Chunk (#7880), 51965089, 104, 29, 104
Service Registration: Performance (#7877), 51965089, 104, 29, 104
amp-auto-ads: documenting attributes field from config in .md file (#7956)  * changes  * Disallowing resize when vp not scrolled  * adding attribute documentation to amp-auto-ads.md  * changes, 51965089, 104, 29, 104
amp-bind: Add limit on # of bindings (#8301)  * initial commit for bindings limit  * unit test  * lint fix  * justin's comment, 51965089, 104, 29, 104
amp-bind: Support amp-iframe (#8270)  * initial commit for bindable iframes  * unit test  * integration test  * revert validator change  * pr comments  * simplify beforeEach() and whitelist amp-iframe[src], 51965089, 104, 29, 104
Cleanup nexxtv-player code (#8265), 51965089, 104, 29, 104
amp-bind: Restore canBind() (#8272)  * restore canBind()  * disallow binding to 'name'  * add brightcove and youtube  * update tests  * fix amp property rules, 51965089, 104, 29, 104
Clean up docs for new components (#8300), 51965089, 104, 29, 104
using closestByTag to check for disallowed ancestors of AMP-AD position (#8004), 51965089, 104, 29, 104
Put back link-url-replace on Canary config as well (#8298)  * Put back link-url-replace flag until code is in prod  * Put back link-url-replace on Canary as well, 51965089, 104, 29, 104
Use getService instead of getExistingServiceForWindow for batched-xhr (#8288), 51965089, 104, 29, 104
Put back link-url-replace flag until code is in prod (#8296), 51965089, 104, 29, 104
Service Registration: Extensions (#7858), 51965089, 104, 29, 104
Document allowpaymentrequest now that validator and viewer support it (#8287), 51965089, 104, 29, 104
Add caption support to amp-instagram and upgrade to current embed version (#8243)  Instagram v7 embeds with captions., 51965089, 104, 29, 104
Amp-bind Clarify bind expression errors (#8257), 51965089, 104, 29, 104
Allow extension to insert <amp-analytics> element to doc (#7940)  * create analytics element  * use element instead  * sync  * store config  * address comment  * fix presubmit  * address comment  * address comment, 51965089, 104, 29, 104
small fix to bind integration tests (#8267), 51965089, 104, 29, 104
Update amp-cache-modifications.md (#8283)  Image URL rewrites include the document's domain in the file path. E.g. https://example.com/foo.png gets rewritten as /i/s/example.com/foo.png., 51965089, 104, 29, 104
Fix link (#8286)  Switched relative link to absolute link., 51965089, 104, 29, 104
Part 2 of Reorganizing Analytics docs (#8273), 51965089, 104, 29, 104
Analytics: visibility time docs corrections. Misspelling fixes (#8260)  * Analytics: visibility time docs corrections. Misspelling fixes  * test fixes, 51965089, 104, 29, 104
Fix small typos (newInstance missing newline stray space). (#8278), 51965089, 104, 29, 104
Small tweaks put the Windows check back and bump revision so (#8276)  we can push to NPM. Also a comment for the DELETEME file., 51965089, 104, 29, 104
Better npm post-install for virtual machines (#8115), 51965089, 104, 29, 104
Force AMP pages to always paint once before installing extensions. (#8231)  This makes AMP draw roughly half way into the JS initialization which is quite significant perceptual speedup. This comes at  - overall larger CPU usage (due to extra paint and more style recalc) - and overall slightly longer start up (since waiting for frames to pass by)., 51965089, 104, 29, 104
Move remote.html existence check before predicate (#8249), 51965089, 104, 29, 104
In-a-box wrapper for localdev testing (#8222)  * Inabox wrapper  * offset  * cleanup  * reuse bootstrap  * review fixes, 51965089, 104, 29, 104
Validatorrollup (#8266)  * Use Object.create(null) to initialize sets/maps; see https://jsperf.com/object-set-contains/  * Allows animation-timing-function in keyframes.  * Revision bump  * Improve error message for `style` attributes and font tags.  * Intern the AttrSpec::mandatory_oneof values., 51965089, 104, 29, 104
Expand substitution documentation (#8234)  * Expand substitution documentation  More specifics on different features supporting substitutions and various restrictions. Full documentation on using link substitutions.  * Updates based on review  * Fix links from previous commit  * Add link for per-use opt-in  * Fix another per-use opt-in see below link, 51965089, 104, 29, 104
Amp-bind: Detect bindings in amp-live-list (#7990), 51965089, 104, 29, 104
Amp-bind: Move integration test from test-bind-impl to test-bind-integrations (#8010), 51965089, 104, 29, 104
Transport delta ticks via delta key. (#8224)  Removing the old and weird way to do it.  First item of  #8216, 51965089, 104, 29, 104
move #updateSize function to uiHandler (#8172)  * moce updateSize to uiHandler  * s  * address comment  * use error when promise reject, 51965089, 104, 29, 104
Remove a redundant CSI ping. (#8023), 51965089, 104, 29, 104
amp-viewer-integration parse messages correctly & ignore some messages (#8226)  * fix & test  * remove console.log  * remove only  * fixes  * fix  * type fix, 51965089, 104, 29, 104
fix paths (#8233), 51965089, 104, 29, 104
add amp-live-list owners (#8232), 51965089, 104, 29, 104
Implement batching of GET requests and fragment addressing of JSON (#7562), 51965089, 104, 29, 104
Support viewer initiated handshake for iframes (#8083)  * rename example viewer file for clarity  * enable polling when iframe & cap=handshakepoll  * check-types fix  * polling with iframes  * fix & test  * lint fix, 51965089, 104, 29, 104
Fix isLayoutSupported issue for unupgraded ads (#8221), 51965089, 104, 29, 104
Cleanup chunked-amp experiment. (#7361)  Code part of #5535, 51965089, 104, 29, 104
add parameters for Fusion (#7955)  * add parameters for Fusion  * formatting  * formatting  * formatting  * formatting  * formatting  * formatting  * formatting  * formatting, 51965089, 104, 29, 104
Restrict prerenderComplete to prerenderable elements only (#8220), 51965089, 104, 29, 104
Clean up `sentinel-name-change` experiment. (#8205)  * Clean up `sentinel-name-change` experiment.  * fix, 51965089, 104, 29, 104
Skip Old Chrome failing tests (#8208), 51965089, 104, 29, 104
Service Registration: User Notification (#7872), 51965089, 104, 29, 104
Make amp-selector mutateElement on user selection (#8211), 51965089, 104, 29, 104
Disable native snap point in slidescroll (#7966), 51965089, 104, 29, 104
Send "canary" along with CSI pings (#8142)  * Send "canary" as experiment ID along CSI so that we can slice performance stats by "canary".  * Fix tests.  * rename  * fix tests, 51965089, 104, 29, 104
Add responsive attribute to Sortable AMP ad slots. (#8005)  When data-repsonsive = 'true' this slot with be treated by Sortable as a responsive ad unit., 51965089, 104, 29, 104
remove from test owners dvoytenko and cramforce (#8113), 51965089, 104, 29, 104
Deactivate document preload for Safari (#8196)  It doesn't support it and it doesn't use the same cache for `as`-attribute-less preload and document fetches., 51965089, 104, 29, 104
Improve the example for inabox visibility tracking. (#8180), 51965089, 104, 29, 104
amp-bind: Use binary in test fixture (#8170)  * use amp-bind binary in integration test fixture  * lint and type fixes  * avoid storing getMode()  * don't rely on DCE'd methods  * add comments  * justin's comments  * don't stub getMode, 51965089, 104, 29, 104
Update amp-cache-modifications.md (#8200)  Remove section about `amp-access` with `type: server`.  While this is currently implemented it is not being used. Rather than have other caches also implement it we'll wait to see if it gets any adoption first., 51965089, 104, 29, 104
Remove meta name=amp-access-state tag. (#8198), 51965089, 104, 29, 104
Move scheduling for font-stylesheet timeout to earlier in the process. (#8175)  There is reason to believe that the link tag may sometimes block style installation so we should install the timeout before installing our styles., 51965089, 104, 29, 104
Skip InOb polyfill for old chrome test (#8194), 51965089, 104, 29, 104
Get ios version number in platform (#8173), 51965089, 104, 29, 104
Cache SW: Support Precent Diversions (#7914)  * Reduce Regex#exec calls  Returns a struct of all the data instead of issuing multiple `#exec` calls to grab a particular sub group.  * Split helpers into separate methods  This includes fetching JS from cache or network purging old versions and a new expired response helper.  * Support the /diversions endpoint  * Linting  * Update tests  * No need for global regex  * Remove expires header support  * Ensure diversions are not prod env  * Output statusCode in failed requests  * Avoid server/client time skew  * Fix tests  * Fix bug with batching fetch requests  They must each get there own clone of the response.  * Fetch diversions after 10 seconds  * Use exact date header strings from amp cache  * lint, 51965089, 104, 29, 104
Service Registration: Activity (#7860), 51965089, 104, 29, 104
Put back form-var-* experiment flags until code is in prod (#8186), 51965089, 104, 29, 104
Remove extra commands from config JSON (#8185), 51965089, 104, 29, 104
Fix Old Chrome test failure (#8179), 51965089, 104, 29, 104
turning amp-auto-ads experiment on (#7684), 51965089, 104, 29, 104
amp-viewer-integration support string messages from webview (#8165)  * stringify webview messages  * check-types fix  * in progress  * test fix  * cleanup  * cleanup  * fixes  * fix viewer2.html  * fixes  * remove console.log, 51965089, 104, 29, 104
Service Registration: Variable (#7871), 51965089, 104, 29, 104
update some owners files (#8181), 51965089, 104, 29, 104
Add fake cookie support to FakeWin (#8143)  * Add fake cookie support to FakeWin  * Add fake cookies to presubmit whitelist, 51965089, 104, 29, 104
Configure validator.ampproject.org to not set a GA cookie on ampproject.org. (#8169)  This was by accident sorry.  Looks like this is the way to set the cookie domain to none as opposed to auto which is probablly what's setting it to ampproject.org.  https://developers.google.com/analytics/devguides/collection/analyticsjs/field-reference#cookieDomain, 51965089, 104, 29, 104
Ensure that placeholder is not measured until ready (#8160)  * Ensure that placeholder is not measured until ready  * test fixes  * docs, 51965089, 104, 29, 104
avoid removal of object contents via map() (#8163), 51965089, 104, 29, 104
Add self to OWNERS file of amp-call-tracking extension (#8166), 51965089, 104, 29, 104
Add amp-call-tracking to gulpfile (#8161)  * Add amp-call-tracking to gulpfile  * Fix type checks, 51965089, 104, 29, 104
Add jridgewell to global owners (#8139), 51965089, 104, 29, 104
Fixes broken link for ad-type-custom (#8125), 51965089, 104, 29, 104
Update availability to stable for amp-izlesene (#8153), 51965089, 104, 29, 104
Fix for Index Exchange ad tags to wrap creative in iframe (#8138), 51965089, 104, 29, 104
Amp-bind: Cleanup removed bindings from bind evaluator (#8079), 51965089, 104, 29, 104
amp-bind: Support amp-youtube (#8067)  * support binding to amp-youtube's data-videoid  * unit test  * use loadVideoById instead of changing iframe src  * fix lint error  * add integration test, 51965089, 104, 29, 104
Service Registration: Live List Manager (#7876), 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt and size.csv (#8148), 51965089, 104, 29, 104
Validatorrollup (#8140)  * Fix typo: dumpSaxAsJson should correspond to provide.  * Revision bump  * Revision bump  * Update spec urls to more canonical location.  * Add a test case for `<amp-ad>`  * Emit one error per attribute rather than stop at the first error found for any attribute in an HTML tag.  * Allow `<iframe>` tag within `<noscript>` section suggesting `<amp-iframe>` in other contexts.  * Revision bump for `<amp-facebook-comments>`.  * Error categorization had a conditional branch which no longer could be reached due to changes to the way we generated errors. This CL removes that extra code.  * Revision bump  * Revision bump  * Blacklist meta name=(amp-.*|amp4ads-.*) and whitelist specific instances.  * Make extensions a first-class validator concept with a new ExtensionSpec.  * Fix validator-amp-mustache output file., 51965089, 104, 29, 104
amp-bind: Support amp-brightcove (#8068)  * support binding to amp-brightcove's src attrs  * add integration test, 51965089, 104, 29, 104
add moar owners (#8135), 51965089, 104, 29, 104
Cleanup level1 -amp-element classes (#8130), 51965089, 104, 29, 104
Clarify that amp-ad script is required for sticky ad (#8131), 51965089, 104, 29, 104
Fix form test flakiness (#8096), 51965089, 104, 29, 104
Toggle visibility-v3 via flag (#8123)  * Toggle visibility-v3 via flag  * allow for allow-doc-opt-in, 51965089, 104, 29, 104
Update amp-cache-modifications.md (#8127)  Clarify that removing `nonce` is only the attribute `nonce` and remove the confusion around the inserted `meta` tag for nonce., 51965089, 104, 29, 104
Send RTV version number along with CSI pings. (#8111)  * Send RTV version number along with CSI pings.  * fix tests, 51965089, 104, 29, 104
add owners for amp-bind (#8118), 51965089, 104, 29, 104
Update amp-nexxtv-player.md (#8081)  Under `attributes` prepend `data-` to the attribute names., 51965089, 104, 29, 104
add ext generator to whitelist of cdn check (#8119), 51965089, 104, 29, 104
Service Registration: Document State (#7857), 51965089, 104, 29, 104
Blacklist default CDN domain from appearing in source code. (#7717)  While there are some legit reasons to do this we should disallow this by default and point people to the config based option instead., 51965089, 104, 29, 104
Making dvoytenko a global owner (#8107), 51965089, 104, 29, 104
temporary owners in place of mkhatib (#8106), 51965089, 104, 29, 104
add src/ and test/ owners (#8109), 51965089, 104, 29, 104
InOb polyfill trigger new added element w/o tick (#8100)  * store last tick value  * fix type check  * remove opt-  * rename, 51965089, 104, 29, 104
Ensure that critical vsync tasks run when rAF is disabled. (#7639)    Add a backup timer for non-animation vsync tasks. This ensures that non-animation tasks still eventually (timer at 2.5X normal rAF time) execute when we somehow failed to detect that we aren't visible.  Fixes #7589, 51965089, 104, 29, 104
Update project governance. (#7668)  - Explain distributed ownership model based on OWNERS.yaml files. Enforcement for these launches soon. (Right @erwinmombay). - Made some text more straightforward. - Updated core committers list., 51965089, 104, 29, 104
rename OWNER.yaml to OWNERS.yaml (#8105), 51965089, 104, 29, 104
Add max size difference ratio to srcset select (#8055), 51965089, 104, 29, 104
Service Registration: Vsync (#7873), 51965089, 104, 29, 104
Notes on ini-load implementation (#8093), 51965089, 104, 29, 104
Cleanup amp-form-var-sub and amp-form-var-sub-for-post experiments (#8050), 51965089, 104, 29, 104
Analytics: visibility triggers for docs and embeds (#7655)  * Analytics: visibility triggers for docs and embeds  * review fixes  * lints  * force inabox for all cases  * Move cascading code to VisibilityManager levle  * docs  * Split modules for model and managers, 51965089, 104, 29, 104
Disallow relative origin (#8086), 51965089, 104, 29, 104
Update amp-bind docs (#8062)  * update bind docs  * pr comments  * kevin's comments, 51965089, 104, 29, 104
Fix cache modifications encoding example (#8064), 51965089, 104, 29, 104
Add accessibility suggestion to PR template (#7976), 51965089, 104, 29, 104
amp-bind: Validate duplicate expressions on each binding (#8032)  * make sure we validate cached expr results  * add unit test  * lint fixes  * kevin's comment  * add comment, 51965089, 104, 29, 104
Amp-bind: Rearrange grammar rules and regenerate parser (#8046), 51965089, 104, 29, 104
Monitor zero-dimension viewport (#8061)  * Monitor zero dimensions viewport  * cleanup, 51965089, 104, 29, 104
Move the title to the top (#8053)  The table of contents on top was bugging me..., 51965089, 104, 29, 104
Updated the Annotate Function declarations using lowercase 'function' instead of 'Function' (#7747), 51965089, 104, 29, 104
defer amp-image-lightbox build (#5601) (#7699), 51965089, 104, 29, 104
Service Registration: XHR (#7875), 51965089, 104, 29, 104
Fix JSE error variable (#8058), 51965089, 104, 29, 104
Add validation rules for amp-facebook-comments extension. (#8045)  * Add validation rules for amp-facebook-comments extension.  * Fix custom-element attribute value in test case., 51965089, 104, 29, 104
Extension amp-facebook-comments (#7629)  * Introduction of `amp-facebook-comments`  * Typo in the word extension  * Default values that matches docs  https://developers.facebook.com/docs/plugins/comments/  * Added comments to existing Facebook example  * Linter issue fixed  * Support colorscheme fix compiler issue add comments  * Remove unused function  * Documentation and test files  * Updated to right import reference  * Comment out test validation  * Mock iframe.context.tagName in test  * Mock iframe.context.tagName in test (2)  * Mock iframe.context.tagName in test (3)  * As commented by @Gregable in PR  * As commented by @Gregable in PR  Removed AMP4ADS support.  * Removed validator  * Removed validator (2), 51965089, 104, 29, 104
Updating support for Adwords Conversion tracking (#8047)  * Updating support for Adwords Conversion tracking  Doc update  * Fix typos, 51965089, 104, 29, 104
Assert valid URL (#8043), 51965089, 104, 29, 104
Remove unhandled code "setFlushParams". (#7817)  * Remove unhandled code "setFlushParams".  * fix lint  * fix tests, 51965089, 104, 29, 104
Improve the iframe resize example page. (#8041)  * Improve the iframe resize example page.  * address comments, 51965089, 104, 29, 104
fix build breakages (#8049), 51965089, 104, 29, 104
Add empty amp-sortable-table component (#8029), 51965089, 104, 29, 104
Service Registration: Instrumentation (#7870), 51965089, 104, 29, 104
Service Registration: Cid (#7859), 51965089, 104, 29, 104
Cleanup 'link-url-replace' experiment (#7969), 51965089, 104, 29, 104
Nexxtv player extension (#7816)  * initial setup for extension nexxtv-player  * added nexxtv player logic  * nexxtv player bugfixes cleanup tests docs  * added video interface changed attribute start to seek-to  * reworked video interface for nexxtv-player  * added message handler for nexxtv player and tests  * nexxtv player minor fixes & cleanup  * nexxtv player changed indents from 4 spaces to 2  * added unlayoutCallback for nexxtv player  * initial setup for extension nexxtv-player  * added nexxtv player logic  * nexxtv player bugfixes cleanup tests docs  * added video interface changed attribute start to seek-to  * reworked video interface for nexxtv-player  * added message handler for nexxtv player and tests  * nexxtv player minor fixes & cleanup  * nexxtv player changed indents from 4 spaces to 2  * added unlayoutCallback for nexxtv player  * fixed linting issues (#7673)  * initial setup for extension nexxtv-player  * added nexxtv player logic  * nexxtv player bugfixes cleanup tests docs  * added video interface changed attribute start to seek-to  * reworked video interface for nexxtv-player  * added message handler for nexxtv player and tests  * nexxtv player minor fixes & cleanup  * nexxtv player changed indents from 4 spaces to 2  * added unlayoutCallback for nexxtv player  * initial setup for extension nexxtv-player  * added nexxtv player logic  * nexxtv player bugfixes cleanup tests docs  * added video interface changed attribute start to seek-to  * reworked video interface for nexxtv-player  * added message handler for nexxtv player and tests  * nexxtv player minor fixes & cleanup  * fixed linting issues (#7673)  * nexxtv player review fixes (#7816)  * nexxtv player: updated validation rules (#7816)  * nexxtv player validator ordered alphabetical changed spec_url  * fire amp-dom-update event on insert and replace (#7819)  * temp  * trigger `amp-dom-update` event on insert and replace  * switch -amp-form to i-amp-form  * Validator Rollup (#7844)  * Revision bump.  * Revision bump for amp-playbuzz changes in #7450  * Revision bump.  * Allow filtering by HtmlFormat (AMP AMP4ADS) in the code generator.  * Revision bump.  * Revision bump due to Github pull.  * Code generation now driven by a variable LIGHT which is broader than the previous GENERATE_DETAILED_ERRORS distinction. LIGHT implies filtered for specific format (AMP or AMP4ADS and only amp.validator.validateSaxEvents and no detailed errors.  * Generate ValidatorRules.directAttrLists and globalAttrs and ampLayoutAttrs reducing overhead by indirection.  * Implement parallax effect extension (#7794)  * Do not set hidden attribute on hide/collapse (#7879)  * amp-bind: Support `Math` functions (#7797)  * initial commit for Math in amp-bind  * fix lint  * ali's comment  * avoid scope conflicts with built-in functions  * remove Math functions from documentation  * Measure 3P ad latency (#7902)  * Update spec URLs from github to ampproject. (#7901)  * Update github urls to ampproject urls  * test .out updated  * Too many slashes.  * Moved Developing.md and Design_Principles.md (#7908)  * Rename DEVELOPING.md to contributing/DEVELOPING.md  * Move files to new folder  * Renaming toggle to toggleVisibility because it was conflicting with sidebar and breaking it (#7855)  * disable scrollRestoration auto for embed case (#7899)  * Disable Fast Fetch for all ads when remote.html is used. (#7906)  * Fix DoubleClick Fast Fetch bugs around categoryExclusions and tagForChildDirectedTreatment (#7843)  * Fix incorrect parameter name for `tagForChildDirectedTreatment` in DoubleClick.  * Added unit test for tagForChildDirectedTreatment.  * Fixed the categoryExclusions bug in Fast Fetch DoubleClick.  * Removed parens in arrow functions to satisfy linter  * Adds two new experiment IDs (#7850)  * Adds two new experiment IDs to distinguish "any externally triggered" experiment from "any internally triggered".  Also updates tests to remove a number of assumptions that only a single eid will be populated.  * Use return val to detect "externally selected"; test updates.  * Updated network implementation guide. (#7862)  * Updated network impl guide.  * Changed 'validation' to 'verification'  * Cid timeout error should not be dev error (#7911)  * Fix amp-ad test (#7918)  * Update amp-install-serviceworker.md (#7932)  Fully escape javascript regex.  * Update amp-cache-modifications.md (#7933)  Add `data-no-service-worker-fallback-shell-url` as a URL to be rewritten as absolute.  * amp-fx-parallax Don't use global (#7942)  * Viewer integration: rewrite error message to indicate request name (#7923)  * rewrite error message  * update  * ticks  * Fix up links in DEVELOPING.md (#7944)  We moved DEVELOPING.md to the contributing folder but didn't update many of the relative links accordingly.  * Popin ad extension document updated. (#7674)  * Add popin ad extension.  * register popin.  * Add resizeable attribute.  * Remove resizable.  * Implemented the render-start and no-content APIs.  * Fixed lint.  * Remove quatation.  * Use tei@popin.cc  * Rebase old commit .  * Fixed document because tag was not closed.  * I replaced the removed double quotes.  * Add double quotes.  * Support for bind expressions in mustache templates (#7602)  * first pass at adding/removing subtrees  * tests passing  * Add ability to add and remove bindings in the subtree rooted at a specific node  * lint fixes  * merge conflict  * ci issues  * some cleanup  * pr comments  * pr comments new method of removing bindings for node and its children  * fix some lint warnings  * test and lint fixes  * mutation observer  * update comments  * add observer  * naive implementation  * cleanup  * clean  * cleanup bind impl  * very simple example of bind in a template  * pr comments  * lint errors  * pr comments  * cleanup  * lint errors  * pr comments  * pr comments and lint warnings  * typo  * comments  * more lint warnings  * pr comment  * change README  * cleanup  * pr comments  * pr comments 2  * lint warnings  * don't use foreach on Nodelist  * casting  * more ci warnings  * even more ci warnings  * even more ci warnings  * even more ci issues  * even more ci comments  * even more ci issues  * pr comments  * more pr comments  * fix refactoring oversight  * pr comments  * pr comments  * merge  * pr comments  * ci issues  * pr comments  * assertElement  * pr comments  * typo  * updating sanitizer  * fixing up sanitizer test  * pr comments  * pr comments  * expanded on amp-mustache tests  * pr comments  * remove class from whitelist  * restore whole sandbox  * update mustache validator test and output  * pr comments  * nexxtv player gulp check-types fixes (#7816)  * nexxtv player fix error gulp presumbit with postmessage (#7816)  * added dependency check for nexxtv player (#7816)  * nexxtv player minor fix in validator (#7816)  * nexxtv player fixed validator (#7816)  * fixed validator (#7816), 51965089, 104, 29, 104
amp-bind: Remove BindValidator.canBind (#8033)  * remove BindValidator.canBind  * lint fix  * remove amp-source-origin check from bind-validator fix array workaround for rewriteAttributeValue  * fix other tests, 51965089, 104, 29, 104
Removing step to add a label (#8039)  External contributors unfortunately cannot do this because GitHub doesn't allow granting this permission to everyone., 51965089, 104, 29, 104
Amp-Video Bind Integration Test (#7727), 51965089, 104, 29, 104
Distinguish installing a service and creating it (#7839), 51965089, 104, 29, 104
Remove typo in Nokta amp-ad documentation (#8027)  - Removes a typo in the Nokta's amp-ad documentation., 51965089, 104, 29, 104
Fix for Index Exchange ad tags to render creative in 'c' div rather than document body (#8013), 51965089, 104, 29, 104
amp-bind: Turing machine and game examples (#7742)  * initial commit for turing machine example  * initial commit for bind game example  * flip chance conditional tweak generation logic  * add win/loss message and new game button  * kevin's comments  * prettify games with mdl, 51965089, 104, 29, 104
Amp-Selector Bind Integration Test (#7725), 51965089, 104, 29, 104
add generator code (#7986)  * add generator code  * generate validator protoascii  * simplify test  * add validator  * apply validation spec changes, 51965089, 104, 29, 104
New ad network: sunmedia (#7367)  * cambios en pagina de test de amp  * fix script issues  * fix script issues  * fix script issues  * fix script issues  * fix script issues  * fix code issues 1.0  * fix code issues 2.0  * fix code issues 3.0  * fix code issues 4.0  * fix code issues 5.0  * final code checked and appoved  uploaded  * add renderStartImplemented: true in config.js  * adding example and documentation  * changing testing evironment and fixing bugs caused by that changes  * changes in 3p reverted and double quote all plugin set up parameters  * final code checked and appoved  uploaded  * remove blank lines and spaces  * reverting remote and frame max to original status  * removing trailing spaces in sunmedia.js  * removing trailing spaces in sunmedia.js  * removing trailing spaces in sunmedia.js  * removing trailing spaces in sunmedia.js, 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt and size.csv (#8015), 51965089, 104, 29, 104
Always collapse sticky-ad (#7832)  * force collapse sticky-ad  * use getAdContainer  * s  * store pre calculate value  * fix lint, 51965089, 104, 29, 104
Add data-ad-client parameter check to isValidElement ensure client formatted properly (#7977), 51965089, 104, 29, 104
Analytics: fix rect for ini-load scoping in FIE and inabox (#7973), 51965089, 104, 29, 104
Pass ampcontext file path down on iframe name with other attributes. (#7610)  * Pass ampcontext file path name down on name.  * Changed to use urls.cdn  * Consolidated strings to one line  * Concatenated strings, 51965089, 104, 29, 104
Update how creative agencies can get involved (#7687)  * Update how creative agencies can get involved  * Update a4a-readme.md, 51965089, 104, 29, 104
amp-auto-ads: preventing ad injection inside disallowed ancestors (#7948)  * changes  * Disallowing resize when vp not scrolled  * Ensuring amp-auto-ads doesn't inject ads inside disallowed ancestors, 51965089, 104, 29, 104
add raru=1 parameter (#7951), 51965089, 104, 29, 104
Amp-Img Bind Integration Tests (#7721), 51965089, 104, 29, 104
Revert to the old prerenderComplete reporting to re-baseline monitoring (#7996), 51965089, 104, 29, 104
Fix link to DEVELOPING.md in ads/README (#7945), 51965089, 104, 29, 104
Consolidated frame attribute assigning. (#7841)  * Consolidated frame attribute assigning.  * Fixed broken test infrastructure; Fixed attributes  * Add iframe-attributes.js to whitelist for getModeObject, 51965089, 104, 29, 104
Add TOC to CONTRIBUTING.md (#7988), 51965089, 104, 29, 104
Add TOC to E2E guide (#7989), 51965089, 104, 29, 104
Restrict prerenderComplete signal to only prerenderable elements (#7961), 51965089, 104, 29, 104
Prototype: Quick dirty implementation of ad lightboxes (#7934), 51965089, 104, 29, 104
Clarify param naming - data-param (#7958), 51965089, 104, 29, 104
Text and Amp-Carousel Bind Integration Tests (#7637)  * carousel test still in progress  * caorusel integration test working  * cleanup  * cleanup2  * lint errors  * made promises on bindimpl private  * lint error  * pr comment  * wrong path for closure annotation  * changing some type annotations  * pr comments  * lint errors  * retry  * cleanup  * cleanup  * don't access private property  * missing semicolon  * class binding test  * pr comments  * timeout for sauce labs  * title  * merge  * pr comment  * cleanup  * pr comments  * cleanup  * clean  * clean  * renaming to match other integration tests comment about setup of bind in beforeEach  * more commenting  * pr comment, 51965089, 104, 29, 104
Tighten URL parsing rules for ipv6 addresses (#7941), 51965089, 104, 29, 104
Support for bind expressions in mustache templates (#7602)  * first pass at adding/removing subtrees  * tests passing  * Add ability to add and remove bindings in the subtree rooted at a specific node  * lint fixes  * merge conflict  * ci issues  * some cleanup  * pr comments  * pr comments new method of removing bindings for node and its children  * fix some lint warnings  * test and lint fixes  * mutation observer  * update comments  * add observer  * naive implementation  * cleanup  * clean  * cleanup bind impl  * very simple example of bind in a template  * pr comments  * lint errors  * pr comments  * cleanup  * lint errors  * pr comments  * pr comments and lint warnings  * typo  * comments  * more lint warnings  * pr comment  * change README  * cleanup  * pr comments  * pr comments 2  * lint warnings  * don't use foreach on Nodelist  * casting  * more ci warnings  * even more ci warnings  * even more ci warnings  * even more ci issues  * even more ci comments  * even more ci issues  * pr comments  * more pr comments  * fix refactoring oversight  * pr comments  * pr comments  * merge  * pr comments  * ci issues  * pr comments  * assertElement  * pr comments  * typo  * updating sanitizer  * fixing up sanitizer test  * pr comments  * pr comments  * expanded on amp-mustache tests  * pr comments  * remove class from whitelist  * restore whole sandbox  * update mustache validator test and output  * pr comments, 51965089, 104, 29, 104
Fix up links in DEVELOPING.md (#7944)  We moved DEVELOPING.md to the contributing folder but didn't update many of the relative links accordingly., 51965089, 104, 29, 104
Viewer integration: rewrite error message to indicate request name (#7923)  * rewrite error message  * update  * ticks, 51965089, 104, 29, 104
amp-fx-parallax Don't use global (#7942), 51965089, 104, 29, 104
Update amp-cache-modifications.md (#7933)  Add `data-no-service-worker-fallback-shell-url` as a URL to be rewritten as absolute., 51965089, 104, 29, 104
Update amp-install-serviceworker.md (#7932)  Fully escape javascript regex., 51965089, 104, 29, 104
Fix amp-ad test (#7918), 51965089, 104, 29, 104
Popin ad extension document updated. (#7674)  * Add popin ad extension.  * register popin.  * Add resizeable attribute.  * Remove resizable.  * Implemented the render-start and no-content APIs.  * Fixed lint.  * Remove quatation.  * Use tei@popin.cc  * Rebase old commit .  * Fixed document because tag was not closed.  * I replaced the removed double quotes.  * Add double quotes., 51965089, 104, 29, 104
Cid timeout error should not be dev error (#7911), 51965089, 104, 29, 104
Updated network implementation guide. (#7862)  * Updated network impl guide.  * Changed 'validation' to 'verification', 51965089, 104, 29, 104
disable scrollRestoration auto for embed case (#7899), 51965089, 104, 29, 104
Adds two new experiment IDs (#7850)  * Adds two new experiment IDs to distinguish "any externally triggered" experiment from "any internally triggered".  Also updates tests to remove a number of assumptions that only a single eid will be populated.  * Use return val to detect "externally selected"; test updates., 51965089, 104, 29, 104
Renaming toggle to toggleVisibility because it was conflicting with sidebar and breaking it (#7855), 51965089, 104, 29, 104
Fix DoubleClick Fast Fetch bugs around categoryExclusions and tagForChildDirectedTreatment (#7843)  * Fix incorrect parameter name for `tagForChildDirectedTreatment` in DoubleClick.  * Added unit test for tagForChildDirectedTreatment.  * Fixed the categoryExclusions bug in Fast Fetch DoubleClick.  * Removed parens in arrow functions to satisfy linter, 51965089, 104, 29, 104
Moved Developing.md and Design_Principles.md (#7908)  * Rename DEVELOPING.md to contributing/DEVELOPING.md  * Move files to new folder, 51965089, 104, 29, 104
Update spec URLs from github to ampproject. (#7901)  * Update github urls to ampproject urls  * test .out updated  * Too many slashes., 51965089, 104, 29, 104
Disable Fast Fetch for all ads when remote.html is used. (#7906), 51965089, 104, 29, 104
Measure 3P ad latency (#7902), 51965089, 104, 29, 104
amp-bind: Support `Math` functions (#7797)  * initial commit for Math in amp-bind  * fix lint  * ali's comment  * avoid scope conflicts with built-in functions  * remove Math functions from documentation, 51965089, 104, 29, 104
Do not set hidden attribute on hide/collapse (#7879), 51965089, 104, 29, 104
Implement parallax effect extension (#7794), 51965089, 104, 29, 104
Validator Rollup (#7844)  * Revision bump.  * Revision bump for amp-playbuzz changes in #7450  * Revision bump.  * Allow filtering by HtmlFormat (AMP AMP4ADS) in the code generator.  * Revision bump.  * Revision bump due to Github pull.  * Code generation now driven by a variable LIGHT which is broader than the previous GENERATE_DETAILED_ERRORS distinction. LIGHT implies filtered for specific format (AMP or AMP4ADS and only amp.validator.validateSaxEvents and no detailed errors.  * Generate ValidatorRules.directAttrLists and globalAttrs and ampLayoutAttrs reducing overhead by indirection., 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt and size.csv (#7854), 51965089, 104, 29, 104
fire amp-dom-update event on insert and replace (#7819)  * temp  * trigger `amp-dom-update` event on insert and replace  * switch -amp-form to i-amp-form, 51965089, 104, 29, 104
Remove leftover visibility-v2 flags. (#7833)  * Remove leftover visibility-v2 flags.  * fix lint  * fix lint  * trigger travis  * trigger travis, 51965089, 104, 29, 104
cleanup from pr comments on #7599 (#7838), 51965089, 104, 29, 104
Remove invalid comments (#7851), 51965089, 104, 29, 104
Analytics: universal visibility helper (#7812)  * Analytics: universal visibility helper  * cleanup child  * review fixes  * review fixes, 51965089, 104, 29, 104
Add support for the Adhese adserver to amp-ad (#7631), 51965089, 104, 29, 104
Configure dianomi in cloudflare vendors #7808 (#7809), 51965089, 104, 29, 104
Analytics: fix for timing metrics based on window.onload event. (#7831)  * Analytics: fix for timing metrics based on window.onload event.  * cleanup  * Test  * lints  * test fixes, 51965089, 104, 29, 104
Remove mention of experimental for form Variable Substitutions since it has launched (#7609), 51965089, 104, 29, 104
Tiny indent fix in amp-sidebar.js (#7834), 51965089, 104, 29, 104
Fix IE11 media matching off by 1 (#7828), 51965089, 104, 29, 104
Prevent BindEvaluator from returning Error objects to web worker (#7599)  * Prevent BindEvaluator from returning error objects to web worker  * cleanup  * pr comments  * cleanup  * cleanup  * lint error  * added tests and addressed error from CI  * pr comments  * pr comments  * pr comments, 51965089, 104, 29, 104
Throw user error when upgrading to unknown amp-ad (#7729)  * Prevent unregistered AmpAds from upgrading  * Allow upgrade promises to resolve to null  When they do they fall back to the old implementation.  * Lint  * Lint  * Fix tests  * lint, 51965089, 104, 29, 104
README.md Update styling (#7829), 51965089, 104, 29, 104
Update PULL_REQUEST_TEMPLATE.md (#7827)  Change `Implements` to `Closes` so GitHub will automagically close issues referenced as such in new PRs. This will help new contributors resolve issues more seamlessly from their PRs.  See [relevant PR discussion](https://github.com/ampproject/amphtml/issues/4949#issuecomment-282834618), 51965089, 104, 29, 104
Integration test for using hidden (#7824), 51965089, 104, 29, 104
Disallowing resize of elements near top of viewport when viewport not scrolled (#5774)  * changes  * Disallowing resize when vp not scrolled  * preventing size changes at top of viewport before scrolling., 51965089, 104, 29, 104
Ensure that startup failures are not masked by makeBodyVisible (#7821), 51965089, 104, 29, 104
Implement show and toggle as standard actions (#7785), 51965089, 104, 29, 104
Simplify logic in getLengthNumeral (#7210), 51965089, 104, 29, 104
amp-instagram: Resizing in response to messages posted by iframe (#7705)  * Resizing in response to messages posted by Instagram iframe  * Fixing lint errors  * Adding listen/unlisten and use of getVsync  * Fixing type check, 51965089, 104, 29, 104
Fix validator inconsistency for amp-call-tracking (#7732), 51965089, 104, 29, 104
Disable scroll temporarily when entering sidebar mode (#7792), 51965089, 104, 29, 104
touch forwarding from ampdoc to viewer (#7563)  * touch forwarding  * touch_handler  * touch events  * another  * rename  * bla  * copy partial event  * process touch events  * fix  * bla  * type  * remove mouse events  * resolving merge conflicts  * register handlers + scroll locking  * remove console.log  * fixes  * file rename  * unit tests  * unit tests  * lint, 51965089, 104, 29, 104
Allowing attributes on inserted amp-ads to be specified in the config. (#7546), 51965089, 104, 29, 104
Spec file for amp-auto-ads (#7680), 51965089, 104, 29, 104
Remove direct access to AMP_CONFIG in test-traffic-experiments.js (#6799), 51965089, 104, 29, 104
Update CONTRIBUTING.md (#7796), 51965089, 104, 29, 104
Updated comment, 51965089, 104, 29, 104
Remove visibility v1 code. (#7760)  * Remove visibility v1 code.  * clean  * Fix linter  * fix test, 51965089, 104, 29, 104
Update and rename TICKEVENTS.md to extensions/amp-viewer-integration/TICKEVENTS.md (#7799), 51965089, 104, 29, 104
Tighten up further reading., 51965089, 104, 29, 104
Add link and remove useless paragraph., 51965089, 104, 29, 104
updating AdsNative documentation (#4729), 51965089, 104, 29, 104
Added new examples for manually testing AmpContext (#7605)  * Added new examples for testing ampContext  * Removed file and stopped using hardcoded absolute urls  * Use new endpoint remove unneccesary file, 51965089, 104, 29, 104
Add overflow:hidden to disable scroll temporarily (#7740), 51965089, 104, 29, 104
Update amp-bind.md (#7704)  * Update amp-bind.md  * Update amp-bind.md  * Update amp-bind.md, 51965089, 104, 29, 104
Remove amp-ad-loading-ux flag. (#7754)  * Remove amp-ad-loading-ux flag.  * add back config.  * Address comments  * fix test, 51965089, 104, 29, 104
Fix z-index tables (#7751), 51965089, 104, 29, 104
Doc tweaks for formatting & style + valid layouts on amp-call-tracking (#7722)  * Doc tweaks for formatting & style + valid layouts  * Update amp-call-tracking.md, 51965089, 104, 29, 104
Provide additional guidance on consulting vendors.js (#2432), 51965089, 104, 29, 104
Support object literal as AMP.setState() action arg (#7573)  * initial commit for exprs in actions  * refactor evaluator and clean up  * fix type errors  * add comments  * use separate param for arg expr  * more comments  * tweak example  * unit tests  * justin's comments  * fix types  * fix tests partially address comments  * change arg key to const add new token type  * minor fixes, 51965089, 104, 29, 104
Update amp-form.md (#7741)  The attribute target is mandatory. Added as such and updated the example., 51965089, 104, 29, 104
Rewrite viewport binding tests to describes (#7773), 51965089, 104, 29, 104
Fix various issues with error reporting integration tests (#7776)  * Fix various issues with error reporting integration tests  - Spying on `Image` (for some reason) breaks Safari - Firefox has a newline at the end of it's stack which is trimmed by   `parseQueryString` - Firefox and IE don't support `ancestorOrigins` so no `or` param  * Fix tests, 51965089, 104, 29, 104
Fix ongoing participation link. (#7778), 51965089, 104, 29, 104
Fix link, 51965089, 104, 29, 104
Support position:sticky viewport offset (#7767)  * Support position:sticky  * test fixes  * docs, 51965089, 104, 29, 104
s (#7763), 51965089, 104, 29, 104
A4A: log sampling of errors as dev-expected (#7726)  * A4A: log sampling of errors as dev-expected  * lints  * tests fixes, 51965089, 104, 29, 104
Cosmetic changes to make the main README more welcoming (#7775), 51965089, 104, 29, 104
Updates README to welcome new contributors and remove some redundancy (#7769), 51965089, 104, 29, 104
Clean up amp-inabox feature flag. (#7606)  * Clean up amp-inabox feature flag.  * add back config., 51965089, 104, 29, 104
Reorganize ads.extern.js file (#7745), 51965089, 104, 29, 104
Add computedStyle helper (#7733)  * Add computedStyle helper  This helper just enforces a nullable return type to account for Firefoxs buggy behavior.  * Return a map when getComputedStyle bugs out  * Ensure we don't treat computedStyle's return value as CSSStyleDeclaration  * update presubmit message  * Update tests, 51965089, 104, 29, 104
Revert "better update for document-register-element 1.4.1 (#7750)" (#7758)  This reverts commit 6af8a3b005e0c504e6f21f4e1af23a3c3dd58a86., 51965089, 104, 29, 104
Allow  attribute globally. (#7756), 51965089, 104, 29, 104
Add error reporting to web-worker.js (#7702)  * initial commit for error reporting in web worker  * add presubmit check for installWorkerErrorReporting  * kevin's comment, 51965089, 104, 29, 104
better update for document-register-element 1.4.1 (#7750), 51965089, 104, 29, 104
Use a higher-specificity CSS rule for amp-list overflow example (#7736), 51965089, 104, 29, 104
merge the prod-config for build testing (#7739), 51965089, 104, 29, 104
Send GFP (Good Frame Probability) on 200th frame. (#7711)  * Send GFP on 200th frame.  * Fix lint  * fix test  * fix type checks, 51965089, 104, 29, 104
Delete CONTRIBUTORS (#7718), 51965089, 104, 29, 104
Delete AUTHORS (#7719), 51965089, 104, 29, 104
Add documentation and a template for Great First Issues (#7671)  * first draft  * more changes  * more changes  * more changes  * more changes  * providing more details for template sections  * changing to milestone for Great First Issues, 51965089, 104, 29, 104
Update amp-cache-guidelines.md with adding a new cache to the AMP ecosystem (#7578), 51965089, 104, 29, 104
Add cache modifications of everything.amp.html (#7735)  * Add cache modifications of everything.amp.html, 51965089, 104, 29, 104
Detect JS Engine when reporting errors (#7708)  * Detect JS Engine when reporting errors  This should save us some time trying to determine what the real browser is not what the UserAgent is masquerading as.  * Fix IE detection  Also add comments  * linting  * JSDoc  * Add error tests to integrations suite  * Fix closure type check, 51965089, 104, 29, 104
Only use local storage if the API is declared and does not throw an exception (#7723)  * Only use local storage if the API is declared and does not throw an exception (#6633)  * Revert "Only use local storage if the API is declared and does not throw an exception (#6633)"  This reverts commit fb0f11fe7cc706d8f6a2a9c1900cdd43562761db.  * Only use local storage if the API is declared and does not throw an exception (#6633)  * Fix whitespace lint issue  * Ensure that getItem is not called when attempting to load an item from local storage when local storage is not supported., 51965089, 104, 29, 104
Pass nocurls as additional info to Viewer for latency tracking. (#7709)  * Pass nocurls as additional info to Viewer for latency tracking.  * Add test.  * use urls.cdn  * Add comment.  * ...  * ...  * rename experiment name  * fix test, 51965089, 104, 29, 104
Amp-analytics for AdSense/Doubleclick A4A Implementations (#7619)  * initial changes  * add test coverage  * remove dependency on createIframePromise causing type check failure  * build failures  * build fix  * fix test failure  * change AV config from urls to url  * PR review  * Add scoped attribute to amp-analytics  * fix lint error  * fix lint error  * fix presubmit error, 51965089, 104, 29, 104
Update Getting Started guides with release info (#7681)  * first draft  * added details inline; added quick start  * added a preface for doc/test/etc. changes  * minor fixes  * responding to review comments; adding README, 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt and size.csv (#7714), 51965089, 104, 29, 104
Update component availability + fix style and wording (#7696), 51965089, 104, 29, 104
Updated CSS for amp-selector so the outline is less specific. (#7713)  * Updated CSS for amp-selector so the outline is less specific. (Issue #7534)  * Added new line at end of file., 51965089, 104, 29, 104
Reconcile/clarify contribution & development docs (#7662), 51965089, 104, 29, 104
Add viewer integration script based on amp_js_v (#7703), 51965089, 104, 29, 104
Allow allowpaymentrequest attribute on amp-iframe (#7693), 51965089, 104, 29, 104
Send expected errors to expected bucket (#7650)  * Send expected errors to expected bucket  * Increment errortracker version, 51965089, 104, 29, 104
Replace CLICK_X and CLICK_Y in anchor href for amp-inabox. (#7660)  * Replace CLICK_X and CLICK_Y in anchor href for amp-inabox.  * Fix lint errors., 51965089, 104, 29, 104
Add copyright to managing user state doc (#7697)  Missed copyright in original PR, 51965089, 104, 29, 104
Fix typo make link relative (#7601), 51965089, 104, 29, 104
Omit the stack trace for user errors. (#7480)  Implements #4949, 51965089, 104, 29, 104
Information about issue-priorities.md & new folder (#7469), 51965089, 104, 29, 104
Workaround Worker same origin restriction (#7587)  * initial commit for worker blob  * fix type error  * malte's comments  * fix unit tests, 51965089, 104, 29, 104
Launch visibility-v2 (#7657), 51965089, 104, 29, 104
amp-bind: Only primitives for object literal keys  (#7582)  * initial commit to forbid exprs in obj keys  * also support numbers and other primitives, 51965089, 104, 29, 104
Add license to the Getting Started guides (#7663)  * adding license  * remove newline issue, 51965089, 104, 29, 104
Enable decreasing height above viewport (#7649)  * heroku-test  * best-effort  * update test  * cleanup, 51965089, 104, 29, 104
Link to server side filter for amp-live-list (#7648), 51965089, 104, 29, 104
Remove everything example from amp-cache-modifications (#7646), 51965089, 104, 29, 104
Added AdThrive ad support (#7584), 51965089, 104, 29, 104
Measure document height when necessary and send to viewer (#7327), 51965089, 104, 29, 104
AMP cache modification document update (#7611)  * update image url rewrite section  * update, 51965089, 104, 29, 104
Launch link-url-replace and amp-form-var-sub (#7647), 51965089, 104, 29, 104
Initial load analytics event (#7312)  * Initial load analytics event  * docs, 51965089, 104, 29, 104
Remove iframe throttling in 3p iframes (#7636)  All browsers now do this by default., 51965089, 104, 29, 104
turn on chunked-amp (#7645), 51965089, 104, 29, 104
Skip form integration tests (#7642)  * Skip form integration tests  They're timeout flakey on Saucelabs. Confirmed working correctly locally (at least most of the time).  * comments, 51965089, 104, 29, 104
Use local and YT WebDriver videos for integration tests (#7643), 51965089, 104, 29, 104
Allow multiple action handlers for the same event (#7560)  * Allow multiple action handlers for the same event  * Tighten types for action info arrays  * Add tests for multiple events/multiple actions mixed case  * Modified test for readability, 51965089, 104, 29, 104
Adjust ad no-content UI order (#7612)  * reverse-order  * add test, 51965089, 104, 29, 104
Make some ValidatorRulesMakeSense errors more verbose (#7620), 51965089, 104, 29, 104
Behavior triggered by mode=replace not override (#7634), 51965089, 104, 29, 104
Avoid allocating an array for the rarely used action queue. (#7592), 51965089, 104, 29, 104
Create end-to-end and quick start guides for new contributors (#7568), 51965089, 104, 29, 104
Fix incorrect service lookups for PWA/FIE (#7616)  * Fix incorrect service lookups for PWA/FIE  * revert src/error.js  * lints  * fix tests  * test fixes, 51965089, 104, 29, 104
Fixed route error (#7621), 51965089, 104, 29, 104
Created new endpoint for loading test pages in an iframe. (#7615)  * Created new endpoint for loading test pages in an iframe.  * Inlined function  * Changed .use to .get, 51965089, 104, 29, 104
Warn during expression soft-failures in amp-bind (#7345)  * bind warnings  * tweak warning example  * fix tests  * justin's comment, 51965089, 104, 29, 104
Fix undefined reportError (#7588)  * Fix undefined reportError  Fixes a bug from #7363. Because the extensions never see a call to `setReportError` in their own bundles `reportError` is probably `undefined`.  This fix makes `reportError` a global variable so we get the same requirements (entry-points must call `setReportError`). But now the extension bundles will use that global `reportError`.  * Treat setReportError like initLogConstructor  `setReportError` MUST be called from every entry point.  * Use simple console logs for 3p frame error reporting  Using the standard error reporter requires a tangle of dependencies that are not available to 3p frames. After #5527 we can use `reportError` like normal.  * Add comments, 51965089, 104, 29, 104
amp-form: wait on fetches in integration tests (#7614)  Fixes #7603., 51965089, 104, 29, 104
add url + sourceUrl to the channel_open message (amp-viewer-integration) (#7466)  * url + sourceUrl  * rename  * added test  * remove only  * fix  * test fix  * test, 51965089, 104, 29, 104
Add support for SlimCut Media amp-ad (#7265), 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt and size.csv (#7425), 51965089, 104, 29, 104
Amp-playbuzz item-id support  (#7450)  * Added amp-playbuzz item id support  * Fixed amp-playbuzz preconnect  * Added item-id to documentation  * Added important remark to documentation  * Refactored amp-playbuzz iframe src compose logic, 51965089, 104, 29, 104
Adding z-index for autoplay mask (#7565), 51965089, 104, 29, 104
An additional required file was added for Rambler&Co ad network (#7541)  * Additional required file was added  * Asynchronous scripts loading, 51965089, 104, 29, 104
Force cloudflare amp-ad to use absolute src.  fixes #7543. (#7556), 51965089, 104, 29, 104
myWidget Ad extension (#7471)  * myWidget Ad extension  * myWidget Ad extension - fix travis  * myWidget Ad extension - fix travis  * myWidget Ad extension - review fixes, 51965089, 104, 29, 104
Refactor local proxy server code so it supports Viewer style URL: /v/ (#7580)  * Refactor local proxy server code so it supports Viewer style URL: /v/  * address comment, 51965089, 104, 29, 104
Add the ability to add and remove bindings in subtrees rooted at a specified node (#7439)  * first pass at adding/removing subtrees  * tests passing  * Add ability to add and remove bindings in the subtree rooted at a specific node  * lint fixes  * merge conflict  * ci issues  * some cleanup  * pr comments  * pr comments new method of removing bindings for node and its children  * fix some lint warnings  * test and lint fixes  * update comments  * pr comments  * lint errors  * pr comments  * cleanup  * lint errors  * pr comments  * pr comments and lint warnings  * typo  * more lint warnings  * pr comment  * pr comment, 51965089, 104, 29, 104
Introduce a new attemptCollapse function (#7532)  * still need tests  * need to fix test  * fix lint  * nit  * add test coverage, 51965089, 104, 29, 104
Validator rollup (#7590)  * `<meta http-equiv=>` tags must have `<head>` as ancestor.  * Small javascript performance optimizations.  * Remove the unused errors_seen flag.  * Use requires/satisfies mechanism instead of also_requires_tag.  * Refactoring: Make getAttrsFor simpler and less forgiving (spec now req. $GLOBAL_ATTRS / $AMP_LAYOUT_ATTRS)  * Bugfix: Use hasOwnProperty to check whether the key is in the map.  * No need to copy over TagSpec.requires.  * Share empty arrays for the specification objects where possible.  * Allow form elements outside of form tags.  * Update amp-access-laterpay.  * Add string intern table and use it for simple attrs. The ids for interned strings are negative integers allowing us to effectively mix them in with ids for complex messages (AttrSpec in this case).  * Validate that amp-install-serviceworker[data-iframe-src] is an https URL (if present).  * Restrict AMP4ADS extensions.  * Allow empty `src` attribute for `amp-pixel`.  * Restrict AMP4ADS extensions (part two).  * Rely on the global class attr (w/ blacklist) instead of a locally defined one.  * html_format unnecessary for both AMP and AMP4ADS extensions.  * Elminate SimpleParsedAttrSpec class and use attr ids directly for simple attrs.  * Add additional SVG 2.0 elements.  * Add SVG filters to AMP Validator rules.  * revision bump for amp-call-tracking  * Use indexOf instead of startsWith for old Node.js version compat.  * Allow empty `config` attribute for `amp-analytics`.  * Refactoring: Move the parseAttrsFor method into the constructor of ParsedTagSpec.  * Remove `autoplay` attribute from `<amp-anim>` tag in validator. This attribute does nothing and is not mentioned in the spec.  * Change amp-audio[autoplay] from an enum to a boolean attribute. The spec indicates that it's an enum but the code just passes this through to the audio tag it creates which treats this as true/false  * In generated JS use ids to identify attr lists (instead of attr lists names).  * Remove the tagSpecId field from the TagSpec class.  * Replace requires and satisfied fields with interned strings.  * Update amp-bind validation rules  From PR 7127, 51965089, 104, 29, 104
Fix small typo in amp-audio[autoplay] documentation. (#7583), 51965089, 104, 29, 104
enable flag in canary (#7586), 51965089, 104, 29, 104
Load sticky ad after first viewport scroll (#7478)  * add experiment flag  * add cleanup issue  * address comment  * fix lint  * nit, 51965089, 104, 29, 104
Add more integration tests for amp-form (#7525), 51965089, 104, 29, 104
Turn on visibility-v2 in canary (#7576), 51965089, 104, 29, 104
Change the spec for amp-audio[autoplay] (#7574)  * Change the spec for `amp-audio[autoplay]` to correctly indicate that this is a boolean attribute rather than the enum mentioned today.  * Change amp-audio language to reference 'audio' rather than 'image'., 51965089, 104, 29, 104
Removes amp-tabs since we are doing it as an example using amp-selector (#7539), 51965089, 104, 29, 104
Release AMP cache modifications best practices (#7561)  * Publish AMP cache modifications best practices, 51965089, 104, 29, 104
Add AdSpeed ad server to amp-ad (#7219)  * Add AdSpeed ad server to amp-ad  * Change zid/oid to zone/client since oid is conflicting  * Implemented renderStart() and noContentAvailable() API in AdSpeed backend. Tested both scenarios., 51965089, 104, 29, 104
Add amp-izlesene extension to embed videos from izlesene.com (#6126), 51965089, 104, 29, 104
Kiosked ads (#7049)  * Kiosked ads  * Indentation fix  * lint error fix  * lint error fix  * lint error fix  * ads.amp.html script fix  * readme file change  * implemented renderStart API for Kiosked plugin  * indentation changes, 51965089, 104, 29, 104
Passes sentinel value as URL parameter in AdSense/DoubleClick Fast Fetch impls. (#7343)  * Added sentinel as URL parameter for Fast Fetch requests.  * Removed test file.  * Moved sentinel url param into impls; modified tests accordingly.  * Removed unneeded code in test file., 51965089, 104, 29, 104
Validator CLI: Bump version for release and add note to README. (#7559), 51965089, 104, 29, 104
Set the exit code correctly even for Node.js v0.10.25. The trick (#7558)  is to avoid using process.exitCode and instead use process.exit but do so inside the callback for process.(stdout or stderr).write., 51965089, 104, 29, 104
A4A: Ping network error (#7499), 51965089, 104, 29, 104
Relaxing some form requirements and errors (#7530), 51965089, 104, 29, 104
Assert fetch body is not equal to null (#7529), 51965089, 104, 29, 104
Fixing attribute checking (#7427), 51965089, 104, 29, 104
Update validator-amp-call-tracking.protoascii (#7551)  This is a new extension so we should make the script inclusion unique., 51965089, 104, 29, 104
Implement amp-call-tracking extension (#7493)  * Implement amp-call-tracking extension  * Use isLayoutSizeDefined  * Assert valid URL early  * Remove unnecessary length check  * Use firstElementChild to select anchor element  * Cross-reference design doc and PR for amp-call-tracking element, 51965089, 104, 29, 104
add SIZE.md readme for size.txt and size.csv (#7549), 51965089, 104, 29, 104
Fix locally failing tests. (#7535)  Most tests failed when executed together with other tests because they relied on custom elements being installed in the main test window instead of a per test iframe. This was fixed by using `describes.realWin` instead of ad hoc code in tests.  Made the `jsonEqual` chai method more robust by switching to a JSON stringify that is stable. Fixed one cause of side effects making the 3p-frame test flaky., 51965089, 104, 29, 104
Fix playbuzz test failure by toggleExperiment in beforeEach (#7526), 51965089, 104, 29, 104
Make Array `includes()` polyfill not enumerable (#7517), 51965089, 104, 29, 104
Add a small description of XSRF and link to more details (#7518), 51965089, 104, 29, 104
Make viewport getScrollLeft return 0 (#7492), 51965089, 104, 29, 104
Web worker for amp-bind (#7436)  * initial commit for bind worker  * move URL rewriting to bind service add promise api  * clean up fix lint and type errors  * install AmpWorker service  * add web-worker experiment  * add worker experiment fallback  * type check web-worker.js  * comments and tweaks  * mark postMessage with OK  * fix dep check and tests  * add tests for amp-worker.js  * malte's comments  * move typedefs to separate file to avoid browserify from bundling polyfills into worker  * fix test and type error  * justin's comments  * malte's comment  * increment counter first  * justin's comments  * fix unit test  * fix unit test in a different way, 51965089, 104, 29, 104
Upgrade amp-ad support for Index Exchange (#7074)  * Upgrade amp-ad support for Index Exchange  * Upgrade amp-ad support for Index Exchange  * Fix rendering bug  * Upgrade amp-ad support for Index Exchange  * Upgrade amp-ad support for Index Exchange, 51965089, 104, 29, 104
Initial revision of Cxense Display amp-ad integration (#7333)  * Initial revision of Cxense Display amp-ad integration  * Fixes based upon review-feedback  * Fix of another alphabetic order mishap  * Use validateData() for required ad-parameter + documentation-fixes, 51965089, 104, 29, 104
Do not initiate amp-ad Fast Fetch if height/width of slot is 0 (#7498)  * add height/width 0 check to onLayoutMeasure  * Re-execute check on later onLayoutMeasure calls  * code cleanup  * PR review  * PR review, 51965089, 104, 29, 104
Added a special param to measure activity on amp-hulu (#7322), 51965089, 104, 29, 104
Content.ad: CDN domain processing (#7316)  * Content.ad: CDN domain processing  * Changed let to const  Converted let variable to const since it is never changed.  * Updated to use parseUrl method, 51965089, 104, 29, 104
Ensure that it's not lost that amp-img supports sizes (#7496), 51965089, 104, 29, 104
Set experiments cookies on explicit hostname. (#7494)  This makes them available to sub domains which is important for the foo.cdn.ampproject.org style domains., 51965089, 104, 29, 104
Normalize jank rate to a likelihood metric. (#7490)  * introduce Good Frame Probability  * introduce Good Frame Probability, 51965089, 104, 29, 104
adds support for Eulerian Analytics (#7053)  * add support for Eulerian Analytics, 51965089, 104, 29, 104
Turned on sentinel-name-change in prod config. (#7485), 51965089, 104, 29, 104
html_format unnecessary for both AMP and AMP4ADS extensions (#7477)  * html_format unnecessary for both AMP and AMP4ADS extensions  * Update htmlformat test to test for amp4ads whitelist, 51965089, 104, 29, 104
Bind: Add Array.includes to bind (#7401)  * add array polyfill whitelist contains function  * install the polyfill  * debuggign test  * typos  * cleanup  * cleanup  * contains -> includes  * more cleanup  * forgot to update one contains to includes  * whitelist  * fix failing test  * pr comments  * added test  * fixed slight issue with the polyfill  * add test  * typo  * pr comments  * cleanup  * cleanup  * pr comments  * ci issues  * more ci issues  * even more ci issues  * update whitelist  * pr comments  * remove ban on includes  * pr comments, 51965089, 104, 29, 104
Forbid assignments inside a conditional (#7486)  Might fix #7476. Still investigating. Either way this is a bug., 51965089, 104, 29, 104
Make sure fragment to be updated does not have leading # (#7454), 51965089, 104, 29, 104
Allow variable substitution for whitelisted origins (#7344)  Fixes https://github.com/ampproject/amphtml/issues/6141  Allow for an additional domain (or list of domains) for which variable substitution is allowed in links., 51965089, 104, 29, 104
Restrict AMP4ADS extensions (#7474)  * Restrict AMP4ADS extensions  * update test, 51965089, 104, 29, 104
fix chunk from extensions for real (#7473), 51965089, 104, 29, 104
Adding sub-anchor support to placement.js (#7218), 51965089, 104, 29, 104
amp-custom-ads: require CORS (#7331)  * Updated custom ad documentation  Added description of how to use analytics removed incorrect complaint that responsive images were erratic.  * Fixed error when no ad present documentation update  When an ad was not present an attempt was still being made to find and render the template which was causing errors. Documentation now has an example on how to use amp-analytics and removed the wrong line about problems with image layout.  * Removed redundant line of code  Removed unnecessary line of code as well as id from amp-analytics example  * Issue #6758 - Require ampCors in custom ad  Change the flag to require CORS to true and update the ad documentation  * Removed unnecessary parameter to fetchJson, 51965089, 104, 29, 104
Revert "move min/max script URL composition logic from runtime to gulp server" (#7467), 51965089, 104, 29, 104
Bump up inabox error log severity level so that it will show up in StackDriver (#7468)  * Bump up inabox error log severity level so that it will show up in StackDriver  * address comments, 51965089, 104, 29, 104
Add managing user state docs (#7433)  * Add managing user state docs  * Adding image resources  * Delete placeholder for image folder  * Add amp-managing-user-state.md  * Delete cross-origin-tracking.md  The contents of this doc are discussed in much more detail in the new amp-managing-user-stage.md doc  * Change tables to HMTL specify language of code blocks  * Fix orig_user_id and user_id that didn't get updated  * Added TOC; added some more code block type indicators  * Add links for tasks, 51965089, 104, 29, 104
remove error msgs (#7464)  * remove error msgs  * fix, 51965089, 104, 29, 104
Fix scrolling of scrollable iframes in iOS (#7444)  Adds the magic `-webkit-overflow-scrolling: touch;`. It is actually very suprising that it works with this while it is broken without. And I'm pretty sure it worked with an older version of iOS.  Tested with http://output.jsbin.com/sopuji/quiet  Fixes #7400, 51965089, 104, 29, 104
Fix the bug that visible time is counted even after the page enters background (#7406)  * Fix the bug that visible time is counted even after the page enters background  * Fix type checks.  * Isolates tests using "describes". This is to fix a test failure in test-live-list-manager.  * Fix lint, 51965089, 104, 29, 104
Separate render-start and loaded phases for Ads (#7391)  * Separate render-start and loaded phases for Ads  * lints  * fixes  * Process bootstrap-start event  * fixes  * fixes  * remove visibility expectation from load promise  * lints  * review fixes  * lints  * sticky-ad-0.1, 51965089, 104, 29, 104
Launch amp-selector (#7460), 51965089, 104, 29, 104
Clean up ios-overflow-x flags (#7419), 51965089, 104, 29, 104
reinstate Amp-selector experiment to 100% on prod (the cleanup has not reached prod yet) (#7456), 51965089, 104, 29, 104
Revert "Revert "Turn on ad loading ux on prod. (#7315)" (#7410)" (#7455)  turn new flag back on  This reverts commit fa407ec064a0e5a45c9f1f64ae06698d5457a2d6., 51965089, 104, 29, 104
amp-ad and amp-video directly referenced to avoid RTV testing issues on Safari/Edge (#7448), 51965089, 104, 29, 104
Fix Pinterest reporting when unknown selector (#7447), 51965089, 104, 29, 104
amp-pinterest - fix responsive & cut off border (#7320), 51965089, 104, 29, 104
Generify cloudflare ad-network extensions.  Support general sources and attributes. (#7352), 51965089, 104, 29, 104
Avoid false-positive amp- messages in 3p (#7440)  * Avoid false-positive amp- messages in 3p  * lints, 51965089, 104, 29, 104
add id if not provided (#7441), 51965089, 104, 29, 104
webview hanshake+messaging between AMP docs and the viewer (#7173)  * in progress  * in progress  * in progress  * webview handshake working!  * working!  * fix  * in progress  * fix  * fix  * removing console.log  * bla  * fix  * test fix  * webview tests  * fixes  * tests  * fix  * event.type != 'message'  * fix  * fix  * spacing  * merge  * fix  * fix tests  * more tests  * fix  * fix, 51965089, 104, 29, 104
Fixes logic around null fetchResponses and ensures this.collapse_ is approp. set. (#7384)  * Changes logic around null fetchResponses and fixes issue pertaining to this.collapse_ never being set to true.  * PR feedback., 51965089, 104, 29, 104
Launch variable substitution for forms experiment (#7415), 51965089, 104, 29, 104
move min/max script URL composition logic from runtime to gulp server (#6826), 51965089, 104, 29, 104
Adds slot collapse condition and modifies how doubleclick-impl computes size (#7334)  * Changed how size info is collected in doubleclick-impl and added a content length 0 as a condition for ad slot collapse.  * Reverting example file.  * Added small comment.  * Fixed test., 51965089, 104, 29, 104
Ensure that parent is always set in FakeWindow (#7435), 51965089, 104, 29, 104
Update spec to include noscript tag as allowable (#7428), 51965089, 104, 29, 104
Fix all errors that we throw during tests that throw no errors. (#7409)  Makes it easier to identify problems in tests., 51965089, 104, 29, 104
Fix visibility test failed on browsers without IntersectionObserver (#7417), 51965089, 104, 29, 104
Document amp-selector's `select` event (#7411), 51965089, 104, 29, 104
Refactor spy/stub called expectations (#7412), 51965089, 104, 29, 104
Cleanup amp-form-custom-validations experiment (#7405), 51965089, 104, 29, 104
Split up variable substitutions in forms for POST submits (#7408), 51965089, 104, 29, 104
Visibility-v2: use IntersectionObserverPolyfill (#7383)  * Visibility-v2: use IntersectionObserverPolyfill  * Address comments, 51965089, 104, 29, 104
Revert "Turn on ad loading ux on prod. (#7315)" (#7410)  This reverts commit e63b410ac68ed9e748cab1c87756e1f6a1bad7e8., 51965089, 104, 29, 104
Fix history.pushState /undefined on Edge. (#7386), 51965089, 104, 29, 104
bump amphtml-validator version (#7407)  Fixes #7404, 51965089, 104, 29, 104
Launch make-body-relative (#7403), 51965089, 104, 29, 104
Directly report errors for browser events and timer. (#7363)  Part of #7353, 51965089, 104, 29, 104
Remove GPU rasterizaton reasoning for viewport (#7373), 51965089, 104, 29, 104
Fix Chunks in extensions (#7374)  * avoid referencing Chunks in extension  * fix unit test  * fix presubmit  * malte's comment, 51965089, 104, 29, 104
Docs add links for analytics vendors (#7375)  * Remove GPU rasterizaton reasoning for viewport  * Add links for remaining analytics vendors, 51965089, 104, 29, 104
Update CONTRIBUTING Weekly Status & Design Review sections with the latest details (#7385)  * updating weekly status and design doc sections  * Update CONTRIBUTING.md, 51965089, 104, 29, 104
Fix article-fixed-header example (#7356), 51965089, 104, 29, 104
Fix race condition within A4A verify (#6837)  * Address issue 6780  * Move crypto into its own service; add test coverage  * fix merge conflicts  * PR review  * Move amp analytics into crypto service  * PR review  * PR reviews  * test/presubmit fixes  * fix linter error, 51965089, 104, 29, 104
rename goToSlide event to slideChange (#7387), 51965089, 104, 29, 104
use source url instead of window.location (#7302), 51965089, 104, 29, 104
Rename messaging request string in history (#7382), 51965089, 104, 29, 104
Directly report logged errors instead of relying on rethrowing (#7358)   and then catching the `error` event.  Part of #7353, 51965089, 104, 29, 104
Remove amp-video from list of built-ins (#7311), 51965089, 104, 29, 104
Turn on ad loading ux on prod. (#7315), 51965089, 104, 29, 104
Throttle "Script error." reports. (#7371)  These contain zero information and so we only care about the count but not about getting every single one.  See #7353 for context., 51965089, 104, 29, 104
Only build shadow and inabox binaries when flag is given. (#7346), 51965089, 104, 29, 104
Rename brainy (#7224)  * Rename brainy  * fix alphabetic order  * Fix indent, 51965089, 104, 29, 104
Classify new domain scheme traffic as coming from CDN. (#7348)  Adds support for the new domain scheme: https://domain-com.cdn.ampproject.org  Fixes #7019, 51965089, 104, 29, 104
Limit URL replacement to secure origins. (#7347)  This is as designed and follows with web policy that powerful features are only available on HTTPS., 51965089, 104, 29, 104
trigger submit event in xhr action (#7278), 51965089, 104, 29, 104
Improve reporting of amp-bind user errors (#7335)  * render affected elements in bind runtime errors  * report evaluation and invalid [class] result errors  * replace expr->element lookup with map object add invalid css example  * comments  * fix unit tests  * tweak example, 51965089, 104, 29, 104
Update amp-analytics.js (#7318)  * Update amp-analytics.js  * review feedback.  * Update amp-analytics.js, 51965089, 104, 29, 104
Update forms docs to include submit action and inputs change event. (#7299), 51965089, 104, 29, 104
Fix hardcoded 3p.ampproject.net in frame.html #7323 (#7324), 51965089, 104, 29, 104
Revert "Using `playing` instead of `play` event" (#7321), 51965089, 104, 29, 104
Use Date.now() instead of performance.now(). The former is 10x faster. (#7319), 51965089, 104, 29, 104
Factor out jank meter code into separate file (#7309)  * Factor out jank meter code into separate file  * Rename jank-rate.js to jank-meter.js  * Makes this.win_ private  * address comment, 51965089, 104, 29, 104
Add support for "renderStart" and "noContentAvailable" for adup-tech ads (#7152), 51965089, 104, 29, 104
Add additional details for how community members can participate including design reviews (#7281), 51965089, 104, 29, 104
Update contributors. (#7313), 51965089, 104, 29, 104
add fine logging to bind (#7314), 51965089, 104, 29, 104
Clean up `amp-selector` experiment (#7305), 51965089, 104, 29, 104
TreeWalker in Bind & better variable names (#7288)  * rename 'bindings' to 'bound properties'  * rename 'evaluatee' to 'binding'  * use treewalker  * minor tweak  * justin's comments  * simplify scan helper func, 51965089, 104, 29, 104
Update documentation and examples for the amp-video script (#7235), 51965089, 104, 29, 104
Pass context down for a4a ad rendering to allow window.context to function (#7132)  * Created attributes.js  * Added context to direct frame rendering  * Added context to rendering via nameframe  * Removed unneeded files  * Fixed lint and naming  * Don't need to uriencode  * Modified tests  * Created generateSentinelAndContext and moved setStyle  * Fixed test breakages handled sentinel name change experiment  * Addressed comments; ampContext now checks for window var; added/modified tests  * Added docstring  * Addressed comments  * Added test  * Attach data-amp-3p-sentinel attribute to frame  * Fix a4a frames not having messages processed correctly  * Added examples for manual testing  * Addressed comments'  * Revert "Addressed comments'"  This reverts commit a61ddf8d4ec3bb6adbd8d24225386fe7639333c4.  * Changed name of function to hasSafeframeSentinel:  * Added todo  * Updated docstring and added todo  * Fixed getListenForEvents  * Collapse if block cases  * Undid change to getListenForEvents  * Fixed nameframe to keep context data on name  * Broke out isAmpMessage function to use for parsing  * Handle different ways of setting up AmpContext  * Make test page take up multiple viewports  * Fixed lint mistakes  * Inlined ampcontext-creative.js into html  * Addressed comments  * Addressed comments  * Add comments to explain setting of name on nameframe  * removed comment, 51965089, 104, 29, 104
Fix bug in rendering caused by minification (#7308), 51965089, 104, 29, 104
Fix test (#7304), 51965089, 104, 29, 104
Render-start analytics event for documents and embeds (#7220)  * Render-start analytics event  * resolve cyclical dependency  * restrict render-start  * tests and docs  * working on docs  * DOMReady  * redo via signals  * tests  * Revert  * Changes to the docs  * tests  * lints, 51965089, 104, 29, 104
Using `playing` instead of `play` event (#7279), 51965089, 104, 29, 104
Introduce an experiment to measure page jank via vsync. (#7293)  * Introduce an experiment to measure page jank via vsync.  * log info  * log info  * fix type checks  * pass presubmit check  * innerText -> textContent, 51965089, 104, 29, 104
Add scopedQuerySelector helper (#7260)  * Eliminate uses of childElement and childElements  * Forbid uses of buggy querySelector  Anytime you select a descendant of a descendant (`div div` or really `* *`) your matching against the entire document then filtering to elements inside the scope. This is **not** what you'd expect.  Fixes a selector bug in `<amp-analytics>`.  * Add tests  * Use `Date.now` to avoid `.` class selector conflict  * Merge latest master  * Linting  * Fix types  * Fix merge conflict  * Return NodeList  * Fix tests, 51965089, 104, 29, 104
Fix computation of blacklisted_cdata_regex as well as code which was hiding the error in our tests. (#7301), 51965089, 104, 29, 104
More liberal regex in form test (#7297), 51965089, 104, 29, 104
Add Swoop amp-ad support (#7292), 51965089, 104, 29, 104
Pass associated element directly to console (#7277), 51965089, 104, 29, 104
Update DEVELOPING.md (#7294)  We changed the label from 'Starter' to 'Great First Issues'  Also the link pointing here was not correct., 51965089, 104, 29, 104
Remove Safari 8 config (#7276), 51965089, 104, 29, 104
Make fetch "normal" (#7138)  * Revert "Use proper application/json response header instead of arraybuffer. (#7133)"  This reverts commit 27d6886a18634caa7c9d43295767bec7b2a0630d.  * Make fetch "normal"  Makes fetch a normal implementation. We implement `#arrayBuffer` by way of `utf8EncodeSync` like it should have been.  * Fix types  * Test UTF8 in XHR's ArrayBuffer  * Remove final uses of fetchJsonResponse, 51965089, 104, 29, 104
Rambler SSP ad network (#7179)  * New ad network added  * lint check done  * Required changes was implemented  * Implemented render API and requested changes  * Pre-commit checker was added  * Merge with master and remove pre-commit checker  * Minor changes, 51965089, 104, 29, 104
Specify a z-index for autoplay animation (#7280), 51965089, 104, 29, 104
Created attributes.js (#7129)  * Created attributes.js  * Whitelisted src/attributes for unconfirmed referrer url  * Renamed attributes.js to iframe-attributes.js  * Fixed name of file in presubmit-checks  * Add sentinel name change exp / add func to generate sentinel and context  * Refactored to use getContextMetadata  * Removed blank line  * Removed unneeded import  * Moved function to fix check-types and fixed docstring  * Made new test file / broke out tests  * Changed test name  * Revert "Changed test name"  This reverts commit a509951247d933cca14893eae11d1c46fc771a9a.  * Revert "Made new test file / broke out tests"  This reverts commit 19619239e50143458560a04a2abb1f921c4308e7.  * Added todo, 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt and size.csv (#7282), 51965089, 104, 29, 104
Implement Google AdWords specific tracking pixels (#7273), 51965089, 104, 29, 104
Form Submit Accepts JSON Responses (#7139)  Part 2 to fixing #7119 ([Part 1](https://github.com/ampproject/amphtml/pull/7138))., 51965089, 104, 29, 104
Apply unpausable animation work-around to all of iOS not just Safari (#7267), 51965089, 104, 29, 104
Implement mechanism for ensuring that all extensions share an AMP version with the main binary. (#7239)  For each extension this checks the version and if it is the wrong version will ignore the JS file and initiate a load of the correct version.  - experiment guarded. This is likely to break some stuff. - based on compiled-in version only. rtv is ignored because we only care about code here since config is only given in main binary.  Implements locking part of #7238, 51965089, 104, 29, 104
Wait for amp-selector to build before submitting (#7190), 51965089, 104, 29, 104
Support <amp-social-share type="system"> (#6688)  * Add "native" share type  * charset=utf8 -> charset=utf-8, 51965089, 104, 29, 104
Fix bug when changing amp-carousel slides before layout (#7268)  * avoid calling showSlide_ when not laid out yet  * fix lint and type errors  * add unit test  * comments for unit test, 51965089, 104, 29, 104
Remove 'experimental' for custom validation as it's now launched (#7226), 51965089, 104, 29, 104
Validator rollup (#7271)  * Move nonce test case to a more appropriate test file.  * Remove no longer needed dispatch key generation from validator.js.  * De-dupe all messages (subtrees of the rules object) and instantiate the parsed attr specs lazily.  * Revision bump for validator-amp-analytics.protoascii  * Update construction of blacklisted cdata regexp to no longer have a trailing `|` character.  * Add a Closure define for disabling CSS parsing / validating., 51965089, 104, 29, 104
Page-level visibility time for embed performance reporting (#7241)  * Page-level visibility time for embed performance reporting  * ping URL parameters and layout ping, 51965089, 104, 29, 104
Exposing play pause mute unmute actions and making integration tests run on iOS 10 (#7171), 51965089, 104, 29, 104
Ad type adverticum 3p script https/http support. (#7176)  * Ad type adverticum 3p script https/http support.  * example change, 51965089, 104, 29, 104
Ensure SVG data URIs use "charset=utf-8" (#7263), 51965089, 104, 29, 104
amp-iframe guideline to prefer existing components (#7264), 51965089, 104, 29, 104
Fix regex so that `/ads.amp.max.html?type=taboola` would work for amp-embed (#7256), 51965089, 104, 29, 104
add advance bidder support for openx amp ad (#7221)  * add advance bidder support for openx amp ad  * update ads.extern.js for openx amp ad  * add data.dfpSlot to ads.extern.js, 51965089, 104, 29, 104
Relap support for amp-ads (#7011)  * Add ads/relap  Partial commit  Update Relap  * Fix to pass CI build  * Add renderStart support  * Change attributes order  * Add double quotes around attribute values, 51965089, 104, 29, 104
Have option to check forbiddenTerms in test folders (#7234), 51965089, 104, 29, 104
amp-img: prpogate title (#7237), 51965089, 104, 29, 104
Document that amp-form supports amp-selector (#7242), 51965089, 104, 29, 104
Extract signals into its own class (#7240), 51965089, 104, 29, 104
chore(package): update autoprefixer to version 6.7.0 (#7147), 51965089, 104, 29, 104
chore(package): update gulp-uglify to version 2.0.1 (#7183), 51965089, 104, 29, 104
chore(package): update browserify to version 14.0.0 (#7191), 51965089, 104, 29, 104
chore(package): update watchify to version 3.9.0 (#7196), 51965089, 104, 29, 104
chore(package): update karma-browserify to version 5.1.1 (#7200), 51965089, 104, 29, 104
chore(package): update eslint to version 3.14.1 (#7204), 51965089, 104, 29, 104
Fix typo (#7207), 51965089, 104, 29, 104
Add link for analytics vendor - Yandex (#7232), 51965089, 104, 29, 104
Reduce URL entropy for preconnect polyfill. (#7227)  A single AMP page would already only connect to a given origin once ever 180 seconds. With this change the URL for doing this will not change within that time interval. That means that all AMP pages that run on computers with roughly correct clocks will request the same URL within a 180 seconds interval which should make it easier for CDNs to respond efficiently., 51965089, 104, 29, 104
More amp-bind examples in separate folder (#7127)  * move bind examples to bind/ folder  * add sandbox example  * add ecommerce example  * update titles  * replace shirt images  * move amp-state to <body>  * move <amp-state> to bottom of body  * fix amp-bind validator html and output, 51965089, 104, 29, 104
Added documentation for A4A (#7233), 51965089, 104, 29, 104
Add URL rewriting and `srcset` support to amp-bind (#7206)  * add srcset support  * fix types  * rewrite urls for cache  * ignore compiler warnings in third_party/caja  * whitelist amp-bind to depend on sanitizer.js  * ali's comments, 51965089, 104, 29, 104
Update amp-bind docs (#7216)  * update bind docs  * barb's comments, 51965089, 104, 29, 104
Support generic chunking and chunk Bind's DOM scan (#6967)  * Squash chunk-scan commits  * fix lint error  * rename chunk to startupChunk pass viewer from Chunks to StartupTask  * fix lint and type errors  * support timeRemaining in chunk tasks & misc clean up  * justin's comments  * dima's comments  * malte's comments  * style and lint fix  * fix unit tests  * missed a couple @private declarations  * fix scan iteration  * remove for..of  * more iteration on iteration  * move element scan to helper method, 51965089, 104, 29, 104
fix [slide]=0 bug (#7229), 51965089, 104, 29, 104
Update csa.md (#7148)  * Update csa.md  Add note to indicate that only multiple-format AFSh ads are supported.  * Update csa.md, 51965089, 104, 29, 104
Update docs for goToSlide (#7223)  * Update docs for goToSlide  * Update actions doc for goToSlide  * Update carouse.md with type="slides" note  * Update actions doc with type=slides, 51965089, 104, 29, 104
Add ValueCommerce support for amp-ad (#6962)  * 1st commit  * add preconnect ValueCommerce  add preconnect ValueCommerce  * remove extra space  remove extra space, 51965089, 104, 29, 104
Revert "Fix build breakage" (#6568), 51965089, 104, 29, 104
Rename installCidServiceForDocForTesting (#7209), 51965089, 104, 29, 104
margins on placements (#7153), 51965089, 104, 29, 104
AMP-ad supports Sklik.cz ad network (#7150), 51965089, 104, 29, 104
Element-level signals for lifecycle events (#7205)  * Element-level signals for lifecycle events  * fixing tests, 51965089, 104, 29, 104
Fix broken shadow embed test (#7213)  * Fix broken shadow embed test  * fix lint, 51965089, 104, 29, 104
Send link relations in documentLoaded message (#7142), 51965089, 104, 29, 104
Cloudflare ad network example (#6882)  * Local debug server changes to fake Cloudflare signing.  * Changes to support a new A4A ad network with Cloudflare Signing, 51965089, 104, 29, 104
Fix typo in validator-amp-analytics.protoascii (#7211), 51965089, 104, 29, 104
add yarn.lock file for deterministic builds (#7041)  * add yarn.lock file for deterministic builds  * switch travis to use yarn  * fix logic for package.json an yarn.lock check  * make sure that it also errors if only yarn.lock exists  * add back yarn.lock file  * update serving/building docs, 51965089, 104, 29, 104
Create a pull request template for the project. (#7193)  The template should help make pull requests easier to read and overall more uniform.  - Does not propose complicated syntax for titles (or rather forbids it). - Encourages referencing issues.  This is a bit of an RFC. Feedback is welcome. One thing I don't actually know (and the GH docs don't say) is how this template influences auto-generated PR text. It would be really annoying if that no longer happened., 51965089, 104, 29, 104
Analytics root to separate top-level vs embed analytics for FIE (#7172)  * Analytics root to separate top-level vs embed analytics for FIE  * test fixes  * more docs, 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt and size.csv (#7197), 51965089, 104, 29, 104
Launch amp-form-custom-validations experiment (#7185), 51965089, 104, 29, 104
Clarify that assertString/Number allow empty string and zero (#7202)  * Clarify that assertString/Number allow empty string and zero  * tests  * include NaN in doca, 51965089, 104, 29, 104
Adds way for Fast Fetch to collapse ads with 204 response code. (#7131)  * Added way for Fast Fetch to collapse ads with 204 response code.  * Addressing PR feedback.  * Update test-amp-a4a.js  * Added integration test for collapse behavior.  * Added additional tests for response and response.arrayBuffer being null.  * PR feedback.  * PR feedback.  * Removing test file.  * Bumping to retrigger travis.  * Travis., 51965089, 104, 29, 104
Clean up unused variables in viewport (#7195), 51965089, 104, 29, 104
Documentation about optout control (#7188)  * Documentation about optout control  * fixes, 51965089, 104, 29, 104
Turn on amp-ad-loading-ux on canary. (#7187)  * Turn on amp-ad-loading-ux.  * Turn off on prod., 51965089, 104, 29, 104
Apply opacity to the loading line. (#7189)  * Apply opacity to the loading line.  * Tweak color., 51965089, 104, 29, 104
Revert "Use max version on-demand loaded scripts in tests (#7110)" (#7181)  This reverts commit bb2768b08c3ee1feaa22c0115ee9f4e3c026cb28., 51965089, 104, 29, 104
Implementing a more comprehensive strategy for amp-auto-ads. (#7106), 51965089, 104, 29, 104
Shadow DOM v1 (#7059)  * Shadow DOM v1 API support  * Removed unintended code comment  * PR fixes Gives preference to Shadow DOM v1 over v0  * Fixed lint errors  * Fixes to closure-compiler errors Checks again for CE v0 so we don't disable native Shadow DOM in browsers that don't support CE v1  * Fix closure compiler error  * Added Shadow DOM v1 spec to Closure Compiler, 51965089, 104, 29, 104
Update ad loading UX. (#7167)  * Update ad loading UX.  * Address comment., 51965089, 104, 29, 104
Url link issue in documentation for analytics vendor Acquia (#7177), 51965089, 104, 29, 104
Add code language for codeblocks so render correctly (#7180), 51965089, 104, 29, 104
Enable "chunked-amp" in canary (#7182), 51965089, 104, 29, 104
Fix mention of "third party components" section (#7164), 51965089, 104, 29, 104
Limit form variable substitutions to canonical-origin actions (#7169)  * Limit form variable substitutions to canonical-origin actions  * refactor, 51965089, 104, 29, 104
Move Cid service to doc-scope and fixes to elements to work in shadow (#7113), 51965089, 104, 29, 104
Add an extra check for checkValidity on the element. (#7126), 51965089, 104, 29, 104
Clarify what Vsync does (#7165), 51965089, 104, 29, 104
Fix incorrect nesting of doublequote and square bracket that was breaking some tests on Safari (#7146)  * Add oid param to A4A-generated ad requests to enable ActiveView  * Fix incorrect nesting of doublequote and square bracket that was breaking some tests on Safari  * Undo adding blank line, 51965089, 104, 29, 104
Use proper application/json response header instead of arraybuffer. (#7133)  * Use proper application/json response header instead of arraybuffer.  * fix lints, 51965089, 104, 29, 104
Add amp-bind experiment (#7157)  * add amp-bind experiment  * add experiment check to amp-state  * fix unit test, 51965089, 104, 29, 104
Better English more consistent style (#7155), 51965089, 104, 29, 104
#7045 | Adding Acquia as vendor (#7103)  * Adding Acquia as vendor  * Remove wrong comment  * Fix comma-typo  * Fix comma-typo  * Adding tests to vendor-requests.json  * Typo in default causing test failures in the vendor test  * Removing unnecessary comment and plus-character  * change identity source to tracking and correct the default url  * update fixtures  * Revert to amp for identity source  * remove acquia specific example  * Removing json comments, 51965089, 104, 29, 104
Fix amp-hulu test flaky time out (#7135), 51965089, 104, 29, 104
Validator rollup (#7137)  * Make tagSpecById array; add comment about ids. Remove unused type decl.  * Allow SRI attributes for stylesheets.  * Object<number x> -> Array<x> and remove extensionUnusedUnless...  * Construct ParsedAttrSpec objects lazily.  * Generate a synthetic field ValidatorRules.dispatchKeyByTagSpecId and populate it.  * Make the ParsedTagSpec instantiation lazy.  * Reduce greediness of i-amphtml- blacklist regex.  * More disallowed id and name attribute values.  * Allow `nonce` attribute on <script> and <style> tags.  * Make validator protoascii usage more consistent.  * Allow async attr on font link tag.  * Allow <meta http-equiv=origin-trial ...>, 51965089, 104, 29, 104
Update where optout functionality can be used in amp-analytics. (#7134), 51965089, 104, 29, 104
Refector baseCid in viewer into cid-impl (#7111), 51965089, 104, 29, 104
add OWNERS.yaml to examples (#7098), 51965089, 104, 29, 104
Bump version of error tracker for deployment (#7124), 51965089, 104, 29, 104
Introduce field "runtime=inabox" in error reporting to differentiate errors generated from inabox JS. (#7099), 51965089, 104, 29, 104
Use max version on-demand loaded scripts in tests (#7110), 51965089, 104, 29, 104
Removed iframeContextInName flag for experiment (#7107)  * Removed flag for context in name experiment  * Removed flag from prod and canary config, 51965089, 104, 29, 104
Add base implementation getHTML (#6818)  * Add base implementation getHTML  * Fix codestyle  * CR fix  * fix linting error  * CR fix  * fix  * fix  * fix  * fix  * fix  * fix, 51965089, 104, 29, 104
Changed vid to cid. (#7095), 51965089, 104, 29, 104
removed trailling comma (#7108), 51965089, 104, 29, 104
Ramp up sentinel name change in canary config (#6991), 51965089, 104, 29, 104
update ampicon.png (#7097), 51965089, 104, 29, 104
Use local resources for integration tests (#7093), 51965089, 104, 29, 104
Removes multi-size carveout from Fast Fetch. (#7092)  * Removed multi-size carveout from Fast Fetch.  * Actually removed carveout this time.  * Removed unused element parameter., 51965089, 104, 29, 104
 Use resource.layoutBox instead of change.boundingClientRect to calculate elementX elementY in amp-analytics visiblity tracking. (#7089), 51965089, 104, 29, 104
Update ads/README.md to mention the container div. (#7090)  * Update ads/README.md to mention the container div.  * improve wording, 51965089, 104, 29, 104
use switch statement in mergeShadowHead and ignore other link relation values (#7069), 51965089, 104, 29, 104
<amp-apester-media> out of experiment  (#7055)  * feat(apester-media): apester out of experiments  This changes amp-apester-media status from experiments to stable also include update to apester  custom-loader (urgent fix)  * refactor: remove whitespace  * fix: removed unused line  * fix: lint change innerHTML to DOM api, 51965089, 104, 29, 104
Changed amp3pSentinel to sentinel with exp flag (#6922)  * Changed amp3pSentinel to sentinel with exp flag  * Fixed flagging all uses of amp3pSentinel to sentinel change  * Fixed presubmit issues  * Whitelisted dist.3p/current/integration.js for cookie related presubmit stuff  * Fixed dependency issue  * Properly test both cases of the experiment  * Added cleanup issue  * Fixed lint issue  * Addressed comments to test both cases of experiment  * Fixed toggling off exp and using correct win  * Removed unneeded complexity  * Reverted presubmit-checks, 51965089, 104, 29, 104
amp-lighbox: add docs for scrollable (#7087), 51965089, 104, 29, 104
Fix broken shields (#7051)  * Fix broken shields  Seems like issuestats has died :( Just removed the broken images and changed them to be shield.io shields and link to their respective tabs on github.  * Remove shields, 51965089, 104, 29, 104
Append CSA container to 'c' container (#7083)  * Set container style to absolute  * Append CSA container to 'c' element not body  * update unit tests to include c div, 51965089, 104, 29, 104
Make zid optional (#7071)  * make zid optional  * formatting, 51965089, 104, 29, 104
Putting installFormProxy in a TryCatch for now (#7079), 51965089, 104, 29, 104
Form Proxy: Support null EventTarget class (#7077)  Fixes https://github.com/ampproject/amphtml/issues/7075., 51965089, 104, 29, 104
Fix accidental null of amp-image-lightbox keyboard listener (#7052), 51965089, 104, 29, 104
Fix incorrect documentation for extended templates (#7068)  Extended templates are loaded by including a `<script>` tag with a `custom-template` attribute rather than a `custom-element` attribute., 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt and size.csv (#7084), 51965089, 104, 29, 104
Reuse resource when reparented for some extensions (#7035)  * Reuse resource when reparented for some extensions  * examples in docs, 51965089, 104, 29, 104
add a way to override hostname (#6972)  * add a way to override hostname  * rollback 3p url change  * org -> net, 51965089, 104, 29, 104
Changing the <amp-auto-ads> config URL code for AdSense to use the page's canonical URL (#6753), 51965089, 104, 29, 104
Update amp-selector.md (#7073), 51965089, 104, 29, 104
Add Carousel and Selector to Bind validator (#7067)  * fix missing bind validator support and other small fixes  * update test-bind-validator.js  * avoid early-out in amp-selector [selected] mutate when value == 0, 51965089, 104, 29, 104
Temporary solution for most common form-proxy failures (#7065)  * Temporary solution for most common form-proxy failures  * tests fixed, 51965089, 104, 29, 104
Overflow element must have position:relative style (#7061), 51965089, 104, 29, 104
Early implementation of amp-access-laterpay (#5920)  * Early implementation of amp-access-laterpay  * Remove unused amp-access-laterpay config params  * Code cleanup issues from PR  * Expose response in error object for assertSuccess  * Further work on amp-access-laterpay  - Remove unnecessary pingback skeleton - Add jsdoc annotations for existing code - Laterpay config retrieval based on draft spec - Improve rendering of the purchase overlay - Price formatting and localization  * Expose adapter config on AccessService  * Fix pingback detection in amp-access-vendor  * Allow amp-access login flow with url only  Create new methods loginWithType_ (similar to old login method) and loginWithUrl as entry points to old login method (now private).  * Fix exposure of amp access vendor config  * Add "already purchased" link  * Add CSS for amp-access-laterpay  * PR feedback fixes:  - add private tag - ensure assert comes first  * Add event label to loginWithUrl calls  * Also check if we're on localdev mode  * Fix amp-access login tests  * Fix amp-access-vendor tests  * Use id instead of custom element for amp-access-laterpay  * Override pingback in amp-access-laterpay  * Expose buildUrl in amp-access  * Add tests for amp-access-laterpay  * Simplify example page  * Apply labels properly based on purchase type  Also rename i18n keys for clarity.  * Add readme for amp-access-laterpay  * Typos cleanup linting  * Add option for scrolling to top after auth  * Add header/footer to amp-access-laterpay  * Fix some default styling issues  * Address PR feedback and update LaterPay description  * Address more PR feedback fixes  * Add validator info to amp-access-laterpay readme  * Add types for missing config options  * Add sandbox flag to LaterPay config options  * Fix some linting and rules issues  - add license to css file - rename property to avoid scrollTop check, 51965089, 104, 29, 104
Scroll the document when scrollTop message is sent from viewer (#6679), 51965089, 104, 29, 104
Update csa.md to remove non-required parameters (#6902)  * Update csa.md to remove non-required parameters   Removed non-required parameters (width layout) from the amp-ad tag.  * Updated csa.md to combine text in multiple lines, 51965089, 104, 29, 104
Add notes about requesting ads ATF and link to demo (#7037), 51965089, 104, 29, 104
Remove whitelist for lightbox scrollable validator (#7034), 51965089, 104, 29, 104
Delegate submit events until amp-form is loaded  (#6929), 51965089, 104, 29, 104
Moves closure sha384 into a new extension amp-crypto-polyfill for lazy load (#7006)  * Moves closure sha384 into a new extension amp-crypto-polyfill for lazy load.  * fix  * Update tests. Remove base64 polyfill from lib.  * Fix presubmit  * Address comments  * Fix test., 51965089, 104, 29, 104
Refactor observables in viewer-impl into a map object (#7004), 51965089, 104, 29, 104
resizing of margins (#6824), 51965089, 104, 29, 104
Use URL replacer from embed for pixel (#7029), 51965089, 104, 29, 104
adds support for Gemius analytics (#6558), 51965089, 104, 29, 104
Avoid duplicating server-layout (#7021)  * Avoid duplicating server-layout  * fixe  * pass the signal back to viewer  * ensure that sizer can be read immediately or later  * lints  * test fixes, 51965089, 104, 29, 104
Laterpay validator config (#6974)  * Laterpay validator config  * test files  * review fixes, 51965089, 104, 29, 104
Validator rollup (#7023)  * Disallow id="AMP" for all elements.  * More disallowed id and name attribute values.  * Remove old code for generating manufactured body tag warnings.  * Refactoring: Remove template_spec_url field from ParsedTagSpec; access validator rules via Context instance instead.  * Make the unused extension warning more descriptive.  * Revision bump for input change.  * `<amp-analytics>` is required by `<amp-access>`. Fix this warning message.  * Remove unused field., 51965089, 104, 29, 104
skeleton for amp-tabs (#7003)  * skeleton for amp-tabs  * lint fix  * fix  * added experiment, 51965089, 104, 29, 104
Upgrade post-css and related packages to latest (#7020), 51965089, 104, 29, 104
handle unload (#7001)  * handle unload  * fix+test, 51965089, 104, 29, 104
viewer-integr.js -> amp-viewer-integration (#6989), 51965089, 104, 29, 104
dev().info()->dev().fine() (#7017), 51965089, 104, 29, 104
Turned on experiment flag (#6774), 51965089, 104, 29, 104
Unlaunch ios-embed-wrapper for iOS8 to avoid scroll freezing issues (#7018), 51965089, 104, 29, 104
Add some A4A ad request parameters (#6643), 51965089, 104, 29, 104
Pixel re-implemented to trigger immediately on visibility (#6988)  * Pixel re-implemented to trigger immediately on visibility  * review fixes  * lints  * test fixes  * lints, 51965089, 104, 29, 104
update doc (#7016), 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt and size.csv (#6982), 51965089, 104, 29, 104
Expose move to slide method on slidescroll to enable flim-strip experience (#6914)  * testing gallery with amp-selector  * Plausible gallery experience  * Review changes  * Adding tests, 51965089, 104, 29, 104
Let all async gulp tasks return Promise. (#6844)  * Let all async gulp tasks return Promise.  * Fix buildSw.  * fix bad merge  * fix merge, 51965089, 104, 29, 104
Assorted Bind validator fixes (#7005)  * validator follow-up from ali's comments  * ali's comment, 51965089, 104, 29, 104
Add amp-bind support to amp-video (#6905)  * initial commit for bind support in amp-video  * type cast to mollify closure  * fix presubmit error api updates  * fix unit test, 51965089, 104, 29, 104
Add support for Bind's linked carousels use case (#6797)  * initial commit for linked carousels support  * fix lint and type errors  * PR comments  * more PR comments  * add unit tests  * PR comments and API updates  * add tag to warn(), 51965089, 104, 29, 104
Allow redirection after submission through AMP-Redirect-To header (#6958), 51965089, 104, 29, 104
Adding a4a support to TripleLift amp-ads (#6884), 51965089, 104, 29, 104
Use dots for closure compiling tasks in travis to avoid timeout (#6980), 51965089, 104, 29, 104
Update link to Custom Elements doc to v1 version (#6975), 51965089, 104, 29, 104
Introduces logic for A4A Multisize implementation. (#6677)  * Factored out multi-size logic into its own module.  * Added some debugging infrastructure.  * Debug code.  * Added frontend logic.  * Client now makes appropriate resize request of amp-ad element.  * Modified sz url parameter to accomodate multi-size.  * Code cleanup.  * Reverted example page.  * Added example page + logic for 3p case.  * Unit tests.  * Added some unit tests for a4a multisize.  * Rebased and fixed merges.  * Reintroduced a4a carveout for multisize until BOW release is unfrozen.  * Corrected comments.  * Fixed types which were broken when carve-out was carved out.  * Removed dead code.  * Addressing feedback.  * Removing accidentally added files.  * Changed how multiSizeValidation boolean is handled.  * Factored out existence check for creativeParts.  * Clarified doc string.  * Updated doc string & minor changes.  * Removed extraneous comment.  * Removed unneeded Number cast.  * Moved missing signature check upstream.  * Reinstated missing signature check downstream.  * Removed unnecessary call to handleResize., 51965089, 104, 29, 104
amp-viewer-integration handshake updates (#6845)  * example  * fix  * fix  * new message format  * fix  * tests  * typedef  * test fixes  * fixes  * tests  * error logging  * type fix  * type fix  * viewerorigin -> origin  * fixes  * amp-handshake-request -> channelOpen  * more fixes  * logging fixes  * error messaging  * more fixes  * test fix, 51965089, 104, 29, 104
Reverts #6952 but keep the removal of default-value (#6983)  * Revert #6952 but keep the removal of default-value, 51965089, 104, 29, 104
Ad type adverticumv.2 (#6493)  * adTypeAdverticum integration v2  * Mistakes were made. Fixed them.  * more type and code style fix  * example fix  * code style and typo fixes added validateData function  * Missing ; ...  * Removed IF by mistake  * Codestyle fix  * Update adverticum.js  * Update adverticum.js, 51965089, 104, 29, 104
Ensure that iframe is fully x-origin for 3p case (#6979), 51965089, 104, 29, 104
Bind validator (#6665)  * squash bind-validation commits  * fix inconsistencies after rebase  * externalize createRules to avoid dupe work  * lint and type errors  * one more lint error, 51965089, 104, 29, 104
Added initial version of amp-anlaytics variable filters. (#6560)  Closes #5621., 51965089, 104, 29, 104
Proxying the form to call the prototype methods/properties incl Chrome 45 (#6944)  * Proxying the form to call the prototype methods/properties incl Chrome 45 support  * Support legacy properties  * review fixes  * review fixes, 51965089, 104, 29, 104
Allow experiments being opted in at document level. (#6938)  * Allow experiments being opted in at document level.  * Update README.  * Update readme.  * Update README., 51965089, 104, 29, 104
 Scan used extension in HTML head instead whole document. (#6954)  *  Scan used extension in HTML head instead whole document.  * Fix test., 51965089, 104, 29, 104
Launch amp-selector (#6969), 51965089, 104, 29, 104
Import Gulp webserver as a middleware into Karma test server  (#6937)  * Reorganize karma config files.  * Remove unused code.  * Simplify logic.  * Some more improvements.  * Avoid using a karma config file. Put everything into a config object instead. This completely solves the hard-to-explain config overridden problem.  * Document hardcoded log level constants.  * Import gulp server into Karma server as a middleware, 51965089, 104, 29, 104
write out css files to build and dist folders (#6946)  * write out css files to build and dist folders  * temp, 51965089, 104, 29, 104
amp-bind: Refactor attribute mutation flow (#6779)  * Squash commits for bind mutation flow refactor  * extend amp css regexp to include i-amphtml-  * PR comments  * PR comments  * tweak mutate callback to pass non-string-cast result also ignore unused old value  * justin's comments  * fix type error  * fix rebase errors  * justin's comment fix callback triggering incorrectly for boolean attrs, 51965089, 104, 29, 104
Allow data-amp-replace on input[type=hidden]. (#6952), 51965089, 104, 29, 104
Default requireAmpResponseSourceOrigin to true. (#6744)  * Default requireAmpResponseSourceOrigin to true.  * Fix type checks., 51965089, 104, 29, 104
Fixing broken carousel snap on master (#6949), 51965089, 104, 29, 104
Fix structured return from key signing in a number of negative cases (#6917)  * Fix structured return from key signing in a number of negative cases.  Refactor for cleanliness.  Add tests., 51965089, 104, 29, 104
Launch amp-playbuzz experiment (#6947)  * Launch amp-playbuzz experiment  * notes, 51965089, 104, 29, 104
remove 2 vp length check (#6907), 51965089, 104, 29, 104
Fixed Carousel Arrow SVGs - Added IE11 Compatible Charset for SVGs (#6920)  * Added IE11 Compatible Charset for SVGs As the title States added IE11 compatible charset for CSS SVGs. Shorthands will break SVG support  * Made All utf8 svg's IE11 compatible, 51965089, 104, 29, 104
Add whatsapp to default config for amp-social-share and update pinterest (#6908), 51965089, 104, 29, 104
Use intermediary AST for Bind expression evaluation (#6840)  * initial commit for bind expression AST  * fix lint and type errors  * rename ASTType to ASTNodeType  * move try/catch to evaluator  * add some comments  * move other try/catch to evaluator  * PR comments  * change enum to number fix type errors  * justin's comments, 51965089, 104, 29, 104
Merges isDevChannel() and isDevChannelVersionDoNotUse_() to isCanary() (#6803)  * Merges isDevChannel() and isDevChannelVersionDoNotUse_().  * Update js doc  * Remove unnecessary dep-checks.  * fix, 51965089, 104, 29, 104
actually generate ampcontext-v0.js (#6919), 51965089, 104, 29, 104
doc change on amp-accordion (#6448)  * update doc  * small fix  * update  * nit, 51965089, 104, 29, 104
Update doubleclick.md to properly reflect the state of the "useSameDomainRenderingUntilDeprecated" feature. (#6924), 51965089, 104, 29, 104
Switched from vid to cid for adsense and doubleclick integrations (#6895)  The backends expect vid to be of a particular format: NNNNNN.NNNNNN. Whereas cid can be of arbitrary format (as is the case for AMP).  Fixes #6379, 51965089, 104, 29, 104
add integration test to 3p ad (#6789)  * wip  * first version test  * dispatch scroll event  * wip  * wip  * push to heroku  * make it work  * enable io for fake3pad example  * fix test  * fix  * add validateDate check to _ping_  * use platform isChrome  * nit, 51965089, 104, 29, 104
Revert "Proxying the form to call the prototype methods/properties" (#6911), 51965089, 104, 29, 104
Allow amp-form to update amp-state (#6820)  * initial commit for bind/form integration  * fix type error  * fix unit test  * PR comments, 51965089, 104, 29, 104
amp-youtube: Remove the layout wait issue seems to have been fixed by YT (#6915)  * Remove the layout wait issue seems to have been fixed by YT  * Lint, 51965089, 104, 29, 104
Tweak regex to allow \n in variable values. (#6896)  * Tweak regex to allow \n in variable values.  Fixes #6885, 51965089, 104, 29, 104
Remove whitelist for ooyala-player validator (#6904), 51965089, 104, 29, 104
Make the mask the child of the document body and not the fixed layer. (#6903), 51965089, 104, 29, 104
Pass down experiment toggles to 3p iframes. (#6801)  * Pass down experiment toggles to 3p iframes.  * Fix type checks.  * Fix tests.  * update test, 51965089, 104, 29, 104
Add amp.cloudflare.com to forms testcase. (#6899), 51965089, 104, 29, 104
Validator Rollup (#6898)  Validator Rollup, 51965089, 104, 29, 104
Fix an un-closed amp-ad tag in example. (#6889)  * Fix an un-closed amp-ad tag in example. Fix some bad indentation.  * style fixes  * single quote to double quote, 51965089, 104, 29, 104
Lazily allocate observables (#6839)  * fix  * fix  * fix  * size  * fix, 51965089, 104, 29, 104
Re-organize karma config files. (#6831)  * Reorganize karma config files.  * Remove unused code.  * Simplify logic.  * Some more improvements.  * Avoid using a karma config file. Put everything into a config object instead. This completely solves the hard-to-explain config overridden problem.  * Document hardcoded log level constants., 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt and size.csv (#6865), 51965089, 104, 29, 104
Update ads/README.md to inform 3P developer to add fake ad examples. (#6891)  * Update ads/README.md to inform 3P developer to add fake ad examples.  * Update ads/README.md to inform 3P developer to add fake ad examples., 51965089, 104, 29, 104
Explicitly loading the Max amp-video in manual tests (#6868), 51965089, 104, 29, 104
Added pv and prev_fmts to AdSense ad request URL. (#6531)  * Added SharedState to AdSense impl in order to generate correct ad request URL params.  * Refactored shared state into separate class.  * Added unit test for adsense impl getAdUrl.  * Addressing feedback.  * Cleaned up test and added reset function to SharedState.  * Added mechanism for a slot to remove its old format from the shared state space.  * Lint fix and other feedback addressed.  * Cleaned up multi-slot test.  * Applying suggested feedback.  * Feedback + amp_ct logic which I moved to this PR because of growing overlap.  * Merged unlayoutCallback definitions., 51965089, 104, 29, 104
Add overflow hidden to the slide item (#6880), 51965089, 104, 29, 104
Add a default outline to amp-selector (#6878)  * Add a default outline to amp-selector  * Adding 2017 copyright to the presubmit check, 51965089, 104, 29, 104
Add oid param to A4A-generated ad requests to enable ActiveView (#6816), 51965089, 104, 29, 104
Add link to Google JavaScript style guide to CONTRIBUTING.md (#6795), 51965089, 104, 29, 104
A4A CSI ping updates (#6505)  * Update ping API.  * Update ping API.  * Avoid bad actors.  * Enable URL substitutions.  * Pings for collapse and unhidden.  * Refactored state out of amp-a4a.  * Big refactor of what lives in lifecycle reporter.  * Added platform and ad slot type info.  * Responses to reviews.  * Responses to reviews.  * Responses to reviews.  * Responses to reviews.  * Lint fixes.  * Responses to reviews.  * Responses to reviews.  * Responses to reviews.  * Responses to reviews.  * Removed a now-redundant try/catch.  * Rebase and resolve conflicts.  * Fix some test failures.  * Renamed methods for better descriptiveness.  * Refactored to break dependency cycle.  * Type fixes.  * More type fixes.  * Presubmit fix.  * Test fix.  * Moved friendly iframe end event to listener on frame load.  * Add ping for load timing of A4A friendly iframe.  * Clean up ping default variables and move them into a network-specific initialization.  * Rebase + response to reviews.  * Lint type and dep fixes.  * Various test fixes.  * More test fixes.  * Response to review.  * Type fixes.  * Rename a ping., 51965089, 104, 29, 104
use translateX instead of left (#6841), 51965089, 104, 29, 104
toggle (#6872), 51965089, 104, 29, 104
Turn on amp-inabox to 100% on both canary and prod. (#6871), 51965089, 104, 29, 104
Revert "Remove old IO file" (#6864)  * Revert "Remove old IO file"  * use old io  * nit, 51965089, 104, 29, 104
make amp-video preconnect to video src (#6767)  * preconnect  * child <source> tag  * fix  * jsdocs  * test, 51965089, 104, 29, 104
Added amp-playbuzz documentation (#6838)  * Added amp-playbuzz documentation + experiment text  * Fixed amp-playbuzz documentation, 51965089, 104, 29, 104
Doc cleanup: formatting grammar consistency minor fixes (#6860)  * Doc cleanup: formatting grammar consistency minor fixes  * apply pbakaus feedback  * Added link to webkit bug from erwin, 51965089, 104, 29, 104
Show hidden elements inside accordion header upon expand/collapse. (#6862), 51965089, 104, 29, 104
Easing and warning on times (#6794)  * Easing and warning on times  * fixes  * lints, 51965089, 104, 29, 104
Fix hidden trigger continuousTimeMin condition. (#6821)  * Fix hidden trigger continuousTimeMin condition.  * Add example and more explanations to the spec., 51965089, 104, 29, 104
Added flag for name refactor to canary config (#6858), 51965089, 104, 29, 104
Update csa.md to add note about beta conditions (#6819)  * Update csa.md to add note about beta conditions  * Remove second "beta", 51965089, 104, 29, 104
Content.ad: Improved reliability and security (#6805)  Migrated API to a more robust environment., 51965089, 104, 29, 104
Add presubmit rule to disallow direct access to AMP_CONFIG. (#6800)  * Add presubmit rule to disallow direct access to AMP_CONFIG.  * Fix travis  * Fix test, 51965089, 104, 29, 104
Make travis build log less verbose. (#6836), 51965089, 104, 29, 104
Switch test report format to "dots". (#6834), 51965089, 104, 29, 104
debugging (#6832), 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt and size.csv (#6823), 51965089, 104, 29, 104
Defaults visiblePercentageMin to 0. (#6822), 51965089, 104, 29, 104
Implement "hidden" trigger for VisibilityV2 (IntersectionObserver based) (#6634)  * Implement "hidden" trigger for VisibilityV2 (IntersectionObserver based visibility tracking).  * Give test cases better names.  * Address comments.  * Address comment.  * Fix tests., 51965089, 104, 29, 104
Refactor the computation of experiment config. (#6709)  * Refactor the computation of experiment config.  * Removed cache for cookie toggles since it's only retrieved once.  * Fix type checks  * Fix tests  * Remove unnecessary change of AMP_CONFIG for local testing.  * Call resetExperimentToggleForTesting in _init_tests.js  * Remove directly access to AMP_CONFIG for toggling experiments.  * Add one more test case to make sure we have the right experiment status map.  * Revert changes in test-traffic-experiments.js, 51965089, 104, 29, 104
Add variable references in action method arg values (#6723)  * implement var dereferencing in action arg values  * fix type error  * add unit tests for applyActionInfoArgs()  * fix lint error  * PR comments  * fix lint errors, 51965089, 104, 29, 104
custom-element internal classes are switched to i-amphtml- form (#6796)  * custom-element internal classes are switched to i-amphtml- form  * fixes, 51965089, 104, 29, 104
[amp-inabox] Only request position when visibility-v2 is disabled or  (#6787)  * [amp-inabox] Only request position when visibility-v2 is disabled or native IntersectionObserver is not available.  * Fix lint, 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt and size.csv (#6768), 51965089, 104, 29, 104
Proxying the form to call the prototype methods/properties (#6720)  * TBD: proxying the form to call the prototype methods/properties  * tests  * FormProxy.prototype  * docs  * use Object.prototype.hasOwnProperty  * fixes, 51965089, 104, 29, 104
Update A4A spec to use amp4ads-v0.js instead of v0.js (#6152)  * Update A4A spec to use a4a-v0.js  * address comment, 51965089, 104, 29, 104
Add inabox example for nested friendly iframe. (#6785), 51965089, 104, 29, 104
Added reference to common attributes + minor improvements (#6772), 51965089, 104, 29, 104
Integrate Google AdSense for Search and Adsense for Shopping (on the Custom Search Ads protocol) with AMP (#6518)  * Initial commit for CSA AMP ad integration  * update ads example  * assign throwaway variable so compiler doesn't complain  * fix lint errors  * define _googCsa in backfill function  * Add link to CSA docs in AdSense docs  * fix test error  * fix type error  * feedback from jeff  * update css example  * create overflow on resize denied if it doesn't exist  * fix from jeff's comments  * initial stab at unit tests  * first stab at unit tests  * add test for backfill  * lint issues  * create helper functions and move to bottom  * hongfei's feedback  * use Object.assign and tryparsejson  * update tests  * code review changes  change some variable names mostly condense code  * change global.innerHeight back to initial height  global.innerHeight doesn't work because I need the height of the AMP container at the time of requesting the ads before the iframe is resized. Different browsers have different behaviors (some bust the iframe some don't). Changing to global.innerHeight broke the overflow implementation on iOS.  * force dom reflow after appending overflow  iOS9 appears to have a race condition and sometimes shows the overflow on top of the ads even though ALL containers and iframe appear to have the right height set .  Adding this to see if it fixes the issue.  This doesnt appear to be a problem for iOS10 or Android.  * Revert "force dom reflow after appending overflow"  This reverts commit 2040f76c5f501ad9b0e7b777d91aea2ace6ecd02.  * hide overflow of CSA iframe  Im adding this because on ios9 the ad content is visible underneath the overflow element even though the height of the container and iframe are being set correctly.  * Set iframe width to 100% to prevent ios9 from breaking the overflow implementation  * move code into functions  * Move resize handlers to own functions register in CSA function not resizeIframe  other minor refactoring as well  * nitpicks  * add forgotten breaks to switch statement  * Create two callback functions one for backfill and one without.  * Merge remote-tracking branch 'ampproject/master' into csa-integration  # Conflicts: #	ads/google/csa.js  * Inline backfill ads function  * Merge with adsense.md accidentally replaced HC link  * travis errors  * more travis errors, 51965089, 104, 29, 104
Cache SW: Forbid the "validator" extension (#6788)  Fixes #6778., 51965089, 104, 29, 104
Suppress requireAmpResponseSourceOrigin error message when ampCors=false. (#6784), 51965089, 104, 29, 104
Improve error message for missing layout. (#6777)  Also makes console output friendlier for element related errors.  Fixes #6776, 51965089, 104, 29, 104
amp-mustache script also_requires_tag_warning should be template (#6781)  * amp-mustache script also_requires_tag_warning should be template  * amp4ads testdata, 51965089, 104, 29, 104
add tag warning (#6775), 51965089, 104, 29, 104
Ensure that viewer handshake always happens quickly. (#6765)  This fixes #6728. THe problem was that chunking can delay the handshake with the viewer for a very long time. During this time the viewer cannot tell the doc that it is now visibleand visibility triggers chunking to go into fast mode. With this change the aggressive chunking mode is only triggered when the doc has gotten into a state where it can communicate with the viewer; and the viewer communication code itself is never delayed in a chunk., 51965089, 104, 29, 104
Refactored of passing frame attribute/context information (#6498)  * Moved context info to name object associated changes.  This commit may break functionality.  * Fixed broken tests  * Fixed function binding and addressed small comments  * Added dev message on context parsing failure  * Fixed param order for addNameToIframe  * Fixed count and fixed param order in docstring  * Added todo  * Added code pointer  * Fixed broken tests and naming of amp3pSentinel  * Fixed broken 3p-messaging tests  * Fixed lint issue  * Added comment to address use of name attr. for master  * Removed caching of window.name  * Removed line number from code pointer  * Redo caching of window.name  * Inlined adding name func  * Added experiment flag and fixed associated tests.  * Changed exp flag name; Undid change to amp3pSentinel name  * Added cleanup issue to exp flag; Fixed attaching of context  * Fixed jsdoc return type to eliminate presubmit issue  * Fixed typo  * Fixed exp id name add additional check before reading off hash, 51965089, 104, 29, 104
Core-only internal css classes refactored (#6766)  * Core-only internal classes refactored  * disable presubmit enforcement  * test fixes, 51965089, 104, 29, 104
make viewer-integration tests pass also when running locally (#6759)  * make test pass when running locally  * comment  * let's try this  * fix, 51965089, 104, 29, 104
AMP action target and goBack method (#6747)  * AMP action target and goBack method  * lints  * inv.target is Node  * target  * target is Node  * fixe, 51965089, 104, 29, 104
Store either "someexp" or "-someexp" in cookie never both.  (#6762)  * Store either "someexp" or "-someexp" in cookie never both. This is to fix the duplicated experiment entries in cookie.  * Fixes a bug related to opt_transient . Adds a test for it.  * Added one more test for transient.  * Export a xforTesting function instead of the original function., 51965089, 104, 29, 104
Restrict selection of srcset to the two closest values (#6741)  * Restrict selection of srcset to the two closest values  * review fixes  * lints  * removed width=undefined special case  * review fixes, 51965089, 104, 29, 104
Making amp-video an extension + backwards compatibility #TheLastOne #Hopefully (#6743)  * testing  * delete  * a  * git mv  * changes  * more  * a  * size  * integration test include script  * track_tag.out  * element stub unit test  * out messages  * test, 51965089, 104, 29, 104
 FlyingCarpet: Ensure unbuilt elements eventually layout (#6742)  *  FlyingCarpet: Ensure unbuilt elements eventually layout   Fixes https://github.com/ampproject/amphtml/issues/6735.  * Ensure only directly owned elements get layout  * Linting, 51965089, 104, 29, 104
amp-list: customize array location in the response (#6745)  * amp-list: customize array location in the response  * lints  * review fixes  * lints, 51965089, 104, 29, 104
Use #cloneNode to clone FixedLayer body (#6721)  * Use #cloneNode to clone FixedLayer body  Re: https://github.com/ampproject/amphtml/pull/6706#discussion_r92881310  Also removes a [temporary fix](https://github.com/ampproject/amphtml/issues/4097) that is [no longer necessary](https://github.com/ampproject/amphtml/pull/6033).  * Fix test, 51965089, 104, 29, 104
Validator Rollup (#6761)  * Revision bump for `<amp-ooyala>`  * Refactoring: Move the validation procedures out of ParsedAttrSpec.  * Separate the validateUrlAndProtocol routine from ParsedUrlSpec.  * Add uniqueness and matching tag checks to all extensions with a few exceptions.  * Separate the validation routine from ParsedUrlSpec.  * Allow anchor hrefs to be empty strings. Easy part of the github issue.  * Refactoring: Move validation routines out of ParsedTagSpec class  * Refactoring. Move the cdata matcher out of the context object and into the tagstack object.  * Move the Parsed* classes toward the top of the file.  * Combine methods into computeCssParsingConfig.  * Move `<amp-ooyala-player>` to correct path.  * Disallowed id and name values.  * Revision bump for RDF changes.  * Small changes to amp-auto-ads and amp-bind rules., 51965089, 104, 29, 104
Docs cleanup: formatting and wording (#6752), 51965089, 104, 29, 104
fix rendering of codeblocks (#6746), 51965089, 104, 29, 104
add expectedError method (#6581)  * add expectedError method  * add private helper method and tests  * add private annotation  * add createExpectedError method and fix xhr-impl, 51965089, 104, 29, 104
Fix json-ld mainEntityOfPage example (#6691), 51965089, 104, 29, 104
Add valid attribute entries for schema.org RDFa syntax (#6739)  * add valid attribute entries for schema.org RDFa syntax  * add tests for RDFa validation support  * check that adding RDFa did not break meta@content  * check that adding RDFa did not break meta@content  * add a rule for RDFa link, 51965089, 104, 29, 104
Explicitly specify requireAmpResponseSourceOrigin=false if missing (#6724), 51965089, 104, 29, 104
Add script tag to amp-selector .md (#6738), 51965089, 104, 29, 104
amp-app-banner ios mitigation warning (#6702), 51965089, 104, 29, 104
Fixed loading indicator dots over logo bug (#6692), 51965089, 104, 29, 104
Document variable substitutions in hidden fields in forms (#6486), 51965089, 104, 29, 104
Eliminate useless The play() request was interrupted by a call to pause() errors from being logged (#6680)  * Eliminate useless The play() request was interrupted by a call to pause() errors from being logged  * Eliminate useless The play() request was interrupted by a call to pause() errors from being logged, 51965089, 104, 29, 104
Make sidebar the highest z-index possible (#6711), 51965089, 104, 29, 104
Support wider styling set for fixed layer. Re-enable forceTransfer on sidebar (#6706)  * Support wider styling set for fixed layer. Re-enable forceTransfer on sidebar  * Review changes and tests, 51965089, 104, 29, 104
If page is an iframed test page use parent's location to determine script's location (#6710), 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt and size.csv (#6659), 51965089, 104, 29, 104
A4A Envelope for testing (#6698)  * A4A Envelope for testing  * wip  * lints  * docs, 51965089, 104, 29, 104
Force-disable flag in experiments via cookies (#6701)  * Force-disable flag in experiments via cookies  * minus prefix, 51965089, 104, 29, 104
Refactor postDocumentLoaded in viewer and refine viewer tests (#6638), 51965089, 104, 29, 104
Remove docs file until ready (#6704), 51965089, 104, 29, 104
Launch Apester extensions (#6703), 51965089, 104, 29, 104
Turn forced transfer-layer for side-bar temporarily (#6700), 51965089, 104, 29, 104
Switched param order for requestResize (#6697), 51965089, 104, 29, 104
Allow for fetch to not include __amp_source_origin so resources can be cached across pages (#6637)  * Initial commit  * Fix merge issues  * PR responses  * PR review  * PR responses  * PR responses, 51965089, 104, 29, 104
Using the configuration in <amp-auto-ads> to insert a single ad on the page. (#6443), 51965089, 104, 29, 104
Add runtime RTV version to post message (#6645)  * Add rtv version to AMP post messages.  * More test case  * Fix type checks  * Use function default value., 51965089, 104, 29, 104
Correct code blocks so they render properly in docs (#6672), 51965089, 104, 29, 104
Revert "make use of native IntersectionObserver in 3p iframe (#6503)" (#6685)  This reverts commit 7ff265721b3355317d58fd495674adf62f6195a3., 51965089, 104, 29, 104
Revert "small fix to fake function prototype" (#6683), 51965089, 104, 29, 104
Add endpoints to get public keys to verify Cloudflare signatures. (#6675), 51965089, 104, 29, 104
Dynamic update priority API w/rescheduling (#6654)  * Dynamic update priority API w/rescheduling  * more docs, 51965089, 104, 29, 104
Remove an accidental char in inabox-more.amp.html (#6682), 51965089, 104, 29, 104
Upgrade amp-ad support for Index Exchange (#6482)  * Upgrade amp-ad support for Index Exchange  * Upgrade amp-ad support for Index Exchange  * Upgrade amp-ad support for Index Exchange  * Upgrade amp-ad support for Index Exchange, 51965089, 104, 29, 104
A4A protect emitLifecycleEvent/onAmpRender from exiting promise chain; log signing service to stackdrive with service name (#6504)  * Initial commit  * Include serviceName in crypto key info to allow for better error logging; fix a4a integration test to be hermetic  * Fix test coverage  * PR feedback  * PR responses, 51965089, 104, 29, 104
Set charset (to match other share targets) (#6664), 51965089, 104, 29, 104
Fix typos (#6663), 51965089, 104, 29, 104
Update form-vars-sub to use data-amp-replace and value attrs (#6621), 51965089, 104, 29, 104
Apply rate limit to amp-inabox host event listeners (#6657)  * Add rate limit to position observer  * Add tests.  * Tweak debug messages.  * Fix typo., 51965089, 104, 29, 104
feat(changeHeight): allow apester units to resize (#6078), 51965089, 104, 29, 104
custom loader for <amp-apester> (#6627), 51965089, 104, 29, 104
Allows metadata string without quotes in tag. (#6651)  * Allows metadata string without quotes in tag.  While in code freeze this temporary solution allows us to parse the creative's metadata which is erroneously being delimited with a string missing quotes.  * Changed const to let.  * Fixed an issue and added a unit test.  * Another unit test., 51965089, 104, 29, 104
Hide amp-app-banner with a warning on iOS for temp fix (#6669), 51965089, 104, 29, 104
Do not preload the URL of a youtube player. (#6656)  This doesn't work for now because the responses aren't cacheable and preload can only preload uncacheable resources when the `as` type is correct. Unfortunately no browser supports the `document` value for as., 51965089, 104, 29, 104
Bind service and state component (#6449)  * initial commit for bind component/service  * make default value error more descriptive only fire in dev mode  * rename some methods/vars  * don't strict equality check for default verification  * hack support for on='tap:setState'  * remove null result check for expr eval  * use vsync for digest mutation add class and attr toggle  * first pass on amp-bind-state element  * add class change example  * add amp-img ex fix dumb sanitize attr bug  * move state to separate element per design doc  * document methods in bind-impl.js  * properly handle boolean attributes  * add framework for reacting to attr changes support size change fix comments  * propagate attrs in amp-img  * move bind service to /extensions skip digest for amp-bind-state  * clean up action-impl  * fix lint errors  * handle amp-bind not installed  * fix closure errors in compiled bind expr  * fix type annotations  * add amp-video support  * add amp-bind validator proto  * PR comments more types TODOs  * fix long line  * remove local assets in bind example  * fix typedef  * more type fixes  * fix lint error  * revert amp-video changes  * rename bind-state to state  * PR comments  * add unit tests  * check shallow equality during mutate more unit tests  * PR comments  * nit fix  * call attr changed callback for bool attrs  * more PR comments  * lint and style fixes  * PR comments class-ify bind-expr  * move expr eval to separate file  * fix lint and type errors  * PR comments, 51965089, 104, 29, 104
jw-player no longer unlayout on pause since #6483 is fixed now (#6629), 51965089, 104, 29, 104
Revert "Lazily allocate observables" (#6650), 51965089, 104, 29, 104
use line loader for ad (#6595)  * use line loader for ad  * remove important  * change left  * apply color height, 51965089, 104, 29, 104
AMP implementation of Media.net Contextual Monetization (#6479)  * AMP implementation of Media.net Contextual Monetization  * Readme Fixes for media.net, 51965089, 104, 29, 104
Validator Rollup (#6647)  * s/A4A/AMP4ADS/g everywhere. These are all comments or error strings so no functional changes.  * `<amp-selector>`  * Revision bump for amp-playbuzz.  * Revision bump for amp-access.  * Refactor. Rename some 'matcher' objects.  * Refactor reference point matching.  * Add new anchor schemes to the allowed list `line:` and `bbmi:`., 51965089, 104, 29, 104
apply default placeholder for ad (#6447)  * apply default placeholder for ad  * fix type check  * use win.document  * fix test  * use innerHTML  * nit  * apply color, 51965089, 104, 29, 104
add support for Fusion as server (#6148)  * add support for Fusion  * remove var and trailing spaces  * trailing space removal  * adding external types  * add new line at the end of the file  * fix fusion.js url  * use min version of fusion.js  * implement renderStart() and noContentAvailable()  * use single quote for string  * trailing spaces fix  * define external types  * define external types  * remove renderStart() due to passback issues, 51965089, 104, 29, 104
amp-ooyala (#6466), 51965089, 104, 29, 104
Cache SW FF: Use artificial referer (#6639)  * Construct an artificial referrer  * Fix Object.assign polyfill's jsdoc  * Grab all properties  The properties on a request instance aren't "own" properties so a real `Object.assign` wouldn't have found them., 51965089, 104, 29, 104
Do not trust Message Deliverer's Promise (#6640)  * Do not trust Message Deliverer's Promise  Google's viewer integration returns a Thenable for some requests which does not have a `#catch`. Thankfully `Promise.resolve` will cast the return value from their thenable into a trusted Promise.  Fixes https://github.com/ampproject/amphtml/issues/6631.  * Add comment, 51965089, 104, 29, 104
Set scrolling=no on playbuzz iframe to avoid sizing problems (#6636), 51965089, 104, 29, 104
Implement special viewport binding for amp-inabox (#6594)  * Implement special viewport binding for amp-inabox  * Fix type checks and closure compiler dependencies.  * Added tests and fixed presubmit.  * Add more test checks.  * Fix test.  * Address comment  * Remove inabox-viewer.js  * Move type annotation to constructor., 51965089, 104, 29, 104
Make `<script id=amp-access type=application/json>` unique. (#6630), 51965089, 104, 29, 104
Responsive animations with `media` property (#6623)  * Responsive animations  * tests  * lints  * docs, 51965089, 104, 29, 104
Moving video functionality to amp-video extension (#6622)  * skeleton for amp-video extension  * lint fix  * remove md file  * making an amp-video extension  * renaming from video->video2  * fix  * remove from example, 51965089, 104, 29, 104
Refactor methods in viewer into history-impl (#6599), 51965089, 104, 29, 104
Support AMP by CA A.J.A. Infeed (#6478)  * feature/amp-ad-ca-aja-infeed  * fix/indent-2-more-space  * fix/alphabetical  * fix/variable-camel-case, 51965089, 104, 29, 104
Allow credentials=omit (#6614)  * Allow credentials=omit  * fix existing cases, 51965089, 104, 29, 104
Launch ios-embed-wrapper experiment (#6616), 51965089, 104, 29, 104
A4A AMP creative early load extensions prior to layoutCallback (#6610)  * Add extension prefetch from AMP rendering path  * Test coverage  * PR responses, 51965089, 104, 29, 104
ban some es6 array instance methods that might be widely supported (#6559)  * ban some es6 array instance methods that might be widely supported  * make textproto run tests and type checks  * switch to extname  * add Array.from, 51965089, 104, 29, 104
Implementing amp-playbuzz extension (#6106) (#6351)  * Implementing amp-playbuzz extension (#6106)  * Improved current implementation of amp-playbuzz  * Fixed height issue  * Fixed CR issues for amp-playbuzz  * Change amp-playbuzz height + homemade overflow button (#6106)  * Fixed origin issue  * Fixed Height bug + Origin Check  * Updated validation files + unlisteners array  * Fixed scrolling events before overflow bug  * Fixed placeholder strech height bug  * Fixed scroll data + layout support + slow preconnect  * Removed debouncing from OnChange to receive all events, 51965089, 104, 29, 104
Added hasOwn helper. (#6592)  * Added hasOwn helper.  Branched from #6560  * Review feedback., 51965089, 104, 29, 104
Add Cache SW manual test infrastructure (#6532)  * Extract extensions-location from extensions-impl  For some god awful reason all of our polyfills were being pulled into the SW code because of the dependency chains.  * Create calculateEntryPointScriptUrl  * Ensure SW installs max code when asked  * Update pathname rewriting in SW  The old code prevented a base directory from being used like if we were serving from `http://localhost/dist`  * Add Cache SW manual test infrastructure  * Remove unused export  * Add tests  * Fix tests, 51965089, 104, 29, 104
Convert some markdown to HTML (#5978)  * Convert some markdown to HTML  It is in a Markdown file but inside a `<table>` so it needs to be written as HTML not as Markdown in order to render properly.  * Replace relative URL with absolute URL (needed because of main doc site import process), 51965089, 104, 29, 104
set to always fix (#6596), 51965089, 104, 29, 104
Fix Sidebar navigations being cancelled. (#6590), 51965089, 104, 29, 104
Embed and animation visibility (#6500)  * Visibility and animations  * cleanup  * restrict to body  * docs, 51965089, 104, 29, 104
Added amp-hulu example link to amp-hulu doc (#6584), 51965089, 104, 29, 104
skeleton for amp-video extension (#6580)  * skeleton for amp-video extension  * lint fix  * remove md file, 51965089, 104, 29, 104
Few changes in implementation and documentation (#6437)  * AMP integration with ZEDO adserver  * changes after running lint  * defined the external variables to fix the gulp check-types run  * fixed year in copyright and deleted the zedo example page  * fixed data attributes defined in validate and README  * added renderStartImplemented to config  * review fixes and added url to prefetch  * moved div location to fix on-click issue, 51965089, 104, 29, 104
Add XrostSSP support for amp-ad (#6435)  * Add XrostSSP support for amp-ad  * Fix indentation  * Reword parameter  * Remove space  * Add double quotation in amp-ad  * Update copyright  * Close <amp-ad> in example file  * Fixed indentation, 51965089, 104, 29, 104
Update amp-form.md (#6562)  Make it clearer that submit-(success|error) must be **direct** children of form.  From feedback on #6516, 51965089, 104, 29, 104
Revcontent support render-start (#5234) (#6332)  * Revcontent support render-start (#5234) Add configuration support for accessing renderStart() API. See #5234 for additional details.  * Travis CI Add trailing commas and newline.  * Validation Update  Update optional properties.  * Fix example  Use old placeholder and fallback tags.  * Debug Support  Add debug as optional data attribute.  * Validation  Allow use of amp-image to be optional., 51965089, 104, 29, 104
Destroy embed before iframe is removed (#6575)  * Destroy embed before iframe is removed  * cleanup, 51965089, 104, 29, 104
add some more banned API's (#6576), 51965089, 104, 29, 104
Move Viewer.isIframe out to dom.js as a util function. (#6564)  * Move Viewer.isIframe out to dom.js as a util function.  * Fix tests.  * lint fix  * Fix a bug, 51965089, 104, 29, 104
AMP versioning policy (#6094)   Fixes #5160, 51965089, 104, 29, 104
Distinguish sendMessage and sendMessageAwaitResponse in presubmit-checks (#6547), 51965089, 104, 29, 104
Target and listener in the event listener cannot be null (#6561)  * Target and listener in the event listener cannot be null  * fixes  * fixes, 51965089, 104, 29, 104
Share serializeMessage and deserializeMessage code between client and host (#6534)  * Share serializeMessage and deserializeMessage code between client and host.  * Don't catch errors for the caller.  * Don't wrap position in "data"  * minor variable renaming  * Fix linter  * Address comment  * Fix doc  * Merge MessageType enums.  * Fix type-checks  * Move the 2 methods from 3p/messaging.js to src/3p-frame.js.  * Imported a wrong polyfills.js.  * Make sure sentinel and type are not overridable by custom payload.  * substring -> substr  * No need for Object.assign. Fix tests., 51965089, 104, 29, 104
ban es2015 string methods (#6573), 51965089, 104, 29, 104
Do not extend backoff reporting useless errors (#6565)  These include already reported errors (which somehow got thrown again) cancelled loading messages and now a large majority of loading errors.  If we had a whole bunch of loading errors and then a real honest to god bug we'd almost never receive the bug because the "reported" loading errors would delay sending the message for so long., 51965089, 104, 29, 104
App-Banner: Do not use Array#find (#6567)  Also changes a few user errors to report to the user., 51965089, 104, 29, 104
Fix the regex used to detect name and argument part of a variable. (#6566)  Fix #6027, 51965089, 104, 29, 104
Amp Viewer Integration Messaging (#6087)  * gulpfile  * Open Sourcing the messaging protocol  * fix  * lint + type fixes  * fixes from messages  * some fixes  * some more fixes  * another  * some name changes  * more fixes  * moving extension to other files + bug fix  * return a promise  * some tests  * logs  * viewer example logs  * fixed test after method name change  * test fixes  * one more  * 1 more  * increased timeout hopefully will fix tests.  * maybe fix?  * merge fix  * comments fix  * fix  * adding docs  * jsdocs  * new tests + fixes  * bind  * fix, 51965089, 104, 29, 104
Content.ad: Utilize sourceUrl for validation (#6537)  * Content.ad: Utilize sourceUrl for validation  Updated the Content.ad logic to use the sourceUrl value for publisher domain validation.  * Expose sourceUrl to ads, 51965089, 104, 29, 104
Revert "Added initial version of amp-anlaytics variable filters." (#6542), 51965089, 104, 29, 104
Lazily allocate observables (#6496)  * Lazily allocate observables  * fix  * fix  * test fix, 51965089, 104, 29, 104
Customad1 (#6491)  * Updated custom ad documentation  Added description of how to use analytics removed incorrect complaint that responsive images were erratic.  * Fixed error when no ad present documentation update  When an ad was not present an attempt was still being made to find and render the template which was causing errors. Documentation now has an example on how to use amp-analytics and removed the wrong line about problems with image layout.  * Removed redundant line of code  Removed unnecessary line of code as well as id from amp-analytics example, 51965089, 104, 29, 104
Properly close example for amp-reach-player. (#6536), 51965089, 104, 29, 104
Fix regex git bwhile serving local ads examples for selected ad type. (#6545), 51965089, 104, 29, 104
Refactor methods in viewer into viewport-impl (#6544), 51965089, 104, 29, 104
Suppress viewer error messages in sendMessage (#6535), 51965089, 104, 29, 104
In progress: Error reporting for ServiceWorkers. (#6490)  * Error reporting for ServiceWorkers.  * Lint fixes, 51965089, 104, 29, 104
delay updateBorderPadding (#6529), 51965089, 104, 29, 104
Switch chunking to a slightly smarter strategy. (#6460)    Instead of taking any idle callback wait for a callback that provides a minimum work budget., 51965089, 104, 29, 104
small fix to fake function prototype (#6527)  * small fix  * remove comment  * address comment  * grammar, 51965089, 104, 29, 104
Reduce ForeignFetchEvent#clientId boilerplate (#6462)  https://github.com/ampproject/amphtml/pull/6446#discussion_r90569803, 51965089, 104, 29, 104
Added initial version of amp-anlaytics variable filters. (#5621)  * Added initial version of amp-anlaytics variable filters.  Fixes #2198, 51965089, 104, 29, 104
Concept of "expected" errors and throttled loading errors (#6519)  * Report throttled load errors  * storage too  * docs  * more docs  * docs updates, 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt and size.csv (#6528), 51965089, 104, 29, 104
normalize ampcontext-lib (#6524), 51965089, 104, 29, 104
Turns AmpContext and IframeMessagingClient into composite pattern (#6511)  * Turns AmpContext and IframeMessagingClient into composite pattern instead of inheritance.  * Add tests.  * Add some more test cases and fix presubmit checks., 51965089, 104, 29, 104
Only set owner in the scrollable case (#6521), 51965089, 104, 29, 104
make use of native IntersectionObserver in 3p iframe (#6503)  * use native io and disable io for test  * return unlisten func  * update comment  * s  * fix type check  * add comment  * fix type check, 51965089, 104, 29, 104
Advanced localhost check for amp-iframe (#6436)  * Advanced localhost check for amp-iframe  * Advanced localhost check for amp-iframe  * New HTTP test URL for amp-iframe  * Use isSecureUrl function instead.  * Fix for amp-iframe test  * Another test edit  * Final fix for amp-iframe tests, 51965089, 104, 29, 104
Refactor sendMessage and sendMessageAwaitResponse (#6508), 51965089, 104, 29, 104
Enable scrollale lightbox (#6398), 51965089, 104, 29, 104
FIE: first stub elements and then upgrade to ensure that static layout is immediately correct (#6499)  * FIE: first stub elements and then upgrade to ensure that static layout is immediately correct  * lints  * tests for custom-element  * extensions tests  * tests  * lints  * reset examples/a4a.amp.html  * fixes for review  * url replacements tests fixed  * lints and types, 51965089, 104, 29, 104
Setup 3p a4a via cross-origin domain (#6513), 51965089, 104, 29, 104
<amp-jwplayer> Temporarily unlayout on pause due to #6483 (#6509), 51965089, 104, 29, 104
Support for DistroScale ads in AMP (#6303)  * add distroscale ad support  * update distroscale example  * sanitize data tweak example  * add render-start and no-content-available api  * update copyright year  * indent and small stuff  * update indentation, 51965089, 104, 29, 104
Cache SW: Serve version with most responses (#6475)  * Cache SW: Serve version with most responses  I want to avoid the situation where `/v0/some-rarely-used-components.js` serves up a very old RTV when we have multiple files of the newer version that could be served.  This heavily weights the main binary places a small weight on the first requested file and treats all other responses as normal. The version with the max score is what well serve.  * Comments  * Update tests, 51965089, 104, 29, 104
Implement inabox-host.js (#6474)  * Implement inabox-host.  * Fix presubmit  * Address comments.  * Fix type checks., 51965089, 104, 29, 104
Initial support for popIn native ads via amp-ad plugin. (#6122)  * Add popin ad extension.  * register popin.  * Add resizeable attribute.  * Remove resizable.  * Implemented the render-start and no-content APIs.  * Fixed lint.  * Remove quatation.  * Use tei@popin.cc  * Rebase old commit ., 51965089, 104, 29, 104
Amp Carousel: Use class names for styles (#6315)  * move styling to css  * remove log  * fix  * lint fix  * describes  * change  * test fix  * nit: space  * try this  * and this, 51965089, 104, 29, 104
Update documents to include the Cloudflare cache location of "*.amp.cloudflare.com". (#6173)  Fixes #6167, 51965089, 104, 29, 104
Fix an infinite loop in send-intersections manual test (#6489), 51965089, 104, 29, 104
fix amp-accordion: always return non-null sessionState (#6488)  * check for null  * use ?  * tighten type check, 51965089, 104, 29, 104
gulp plugin for amphtml-validator (#6407)  * gulp plugin for amphtml-validator  * validates AMPHTML files * prints validation results to console * optionally fails builds on validation errors  * better error reporting  * add intro  * update tests  * Separate validation result for Validator errors  * Use correct plugin name for variables  * add script to execute sample  * update test  * fail build if validator fails  * add owners.yaml  * add license header  * status -> unknown + jsdoc fixes, 51965089, 104, 29, 104
Move analytics service getters to doc-scope. (#6442), 51965089, 104, 29, 104
Implement Visibility v2 duration conditions (#6399)  * Implement basic visibility tracking using IntersectionObserver  * Unify assert logic between V1 and V2 impl.  * Add tests.  * Add test for multiple triggers.  * Fix type-check  * Fix linter  * Update typedef.  * Support duration conditions in VisibilityV2.  * nit  * Fix potential bug caused by using old element index on mutated array.  * Only cancel scheduled check when the target leaves viewport. This saves unnecessary rescheduling.  * Cancel scheduled check when all conditions met.  * Address comments.  * Fix indentation  * Stub totalTime for testing., 51965089, 104, 29, 104
Validator rollup (#6485)  * Prefix `i-amphtml-` is not allowed in CSS/DOM.  * Revision Bump due to pull from Github  * Revision Bump due to pull from Github  * Revision Bump due to pull from Github, 51965089, 104, 29, 104
turn on throwOfNonErrorTypes conformance config (#6484), 51965089, 104, 29, 104
Adopt core embed window services (#6414)  * Adopt embed window services  * error.stack, 51965089, 104, 29, 104
Correct what layouts are supported for type=carousel (#6342)  * Correct what layouts are supported for type=carousel  * Correct per feedback  * Nit - moved sentence  * Add nodisplay as supported layout for type=carousel, 51965089, 104, 29, 104
bind when we need to only (#6325)  * bind when we need to only  * fix  * small change  * fix  * fix  * fix, 51965089, 104, 29, 104
add more owners (#6439), 51965089, 104, 29, 104
Enable custom ad to 100% in both prod & canary. (#6458)  * Enable custom ad to 100% in both prod & canary.  * Format readme., 51965089, 104, 29, 104
add README.md for configuration system (#6470), 51965089, 104, 29, 104
One more small tweak there's no need any more to say that this (#6473)  API is experimental., 51965089, 104, 29, 104
Attempt to update the link to the directory on Github. (#6472)  I'm hoping this fixes https://github.com/ampproject/amphtml/issues/6432 but not very optimistic. Unfortunately it's not possible to run 'npm publish' without rev'ing the version number there. While I'm at this also dropping the Beta! / experimental. I think this API is stable., 51965089, 104, 29, 104
Permanently fix jitters across all platforms - use no-scroll only on IOS (#6471), 51965089, 104, 29, 104
Allow `default-value` in amp-forms `input` (#6465), 51965089, 104, 29, 104
Generate fallback clientId for Foreign Fetch (#6446)  * Generate fallback clientId for Foreign Fetch  We use `clientId`s to distinguish between JS context windows ensuring that we serve one uniform AMP JS version to all requests from the client.  Foreign Fetch unfortunately does not provide a `clientId` so we must generate our own.  This lumps all requests from a referrer into 60 second "batches" generating a single `clientId` for those requests. After 60 seconds from the first request the batch's timer is invalidated and the next request will generate a new `clientId` from the same referrer.  60 seconds was arbitrarily chosen to prevent version lock happening when navigating back to the same page. We could have just used the referrer as the `clientId` but as long as the SW remains active there would be no way to distinguish between a navigation back. As we want to serve the newer JS when possible that seemed bad.  * lint, 51965089, 104, 29, 104
Allow SVG basic shape `ellipse` (#6461), 51965089, 104, 29, 104
Remove unused `animate` attribute on `amp-accordion` (#6450)  * Remove unused `animate` attribute on `amp-accordion`  * Update validator-main.protoascii, 51965089, 104, 29, 104
[amp-bind]: Remove (relatively) newer functions from the whitelist. (#6459), 51965089, 104, 29, 104
Cleaned up AmpContext and IframeMessagingClient. (#6441)  * Cleaned up AmpContext and IframeMessagingClient.  * Made generateWindow private  * Made getSentinel use a generator  * Broke out messaging to separate func fixed lint, 51965089, 104, 29, 104
Bind documentation (#6457)  * initial commit for amp-bind documentation  * PR comments  * use <code> instead of backticks in html, 51965089, 104, 29, 104
Fix dev channel check (#6451)  * coerce into boolean  * remove files that actually dont need to be whitelisted for isDevChannel method, 51965089, 104, 29, 104
Fix the build. Sinon can't stub methods that don't exist. (#6426), 51965089, 104, 29, 104
Bind expressions (#6201)  * initial bind expressions commit  * fix unary op bug started unit tests  * bug fixes unit tests for arrays  * more array tests  * add unary plus fix != add a lot more tests  * remove useless comments  * initial bind expressions commit  * fix unary op bug started unit tests  * bug fixes unit tests for arrays  * more array tests  * add unary plus fix != add a lot more tests  * remove useless comments  * throw error for non-whitelisted functions return null for nested undefined member access  * more unit tests  * minor formatting fixes  * ignore compiled bind-expr-impl.js during lint  * fix lint errors in test-bind-expr.js  * fix presubmit: remove ES6 startsWith/endsWith and whitelist test file  * add type check for function args and unit test  * expect specific error for unsupported function tests  * address PR comments  * more PR comments  * add test for prototype fns fix other tests  * fix broken string templating in parse errors  * use const/let instead of var  * use a function to create whitelist map  * fix lint errors  * add test for ternary op, 51965089, 104, 29, 104
Protect against undefined checkValidity (#6419), 51965089, 104, 29, 104
Removing Unknown Error (#6428)  * Removing Unknown Error  * fixes, 51965089, 104, 29, 104
Polyfill classList.toggle on IE (#6400), 51965089, 104, 29, 104
A4a bugfix for #6423 (#6438)  * Fixed the race condition but revealed a whole new problem.  *headdesk*  * Removed extra test code to unblock AMP project testing.  * Reverted .only; removed unnecessary return., 51965089, 104, 29, 104
travis java workaround (#6445), 51965089, 104, 29, 104
fix amp-anim placeholder toggle to false before `layoutCallback` (#6404)  * git diff HEAD~1  * fix anim placeholder  * fix typo  * address comment  * more change  * fix, 51965089, 104, 29, 104
Disable Visibility V2 tests due to saucelabs/integration problems (#6430)  * Disable Visibility V2 tests due to saucelabs problems  * tests fixed, 51965089, 104, 29, 104
Add #amp=1 fragment to iframe URLs (#6418), 51965089, 104, 29, 104
observe/unobserve multi elements in IntersectionObserver (#6403), 51965089, 104, 29, 104
Allow variable substitutions in hidden fields. (#6130), 51965089, 104, 29, 104
Move the iframe's box not the wrapping AMP Element's (#6248)  * Move the iframe's box not the wrapping AMP Element's  Imagine the iframe's box is smaller. If we moved the AMP Element's `box` we would have the wrong `width`/`height` because the iframe is smaller. So avoiding the allocation is the exact wrong thing to do.  * Use CustomElement#getLayoutBox  #getIntersectionElementLayoutBox isnt appropriate to get the bounding box.  * Add test cases  * Assert that the intersection is not the amp-iframe's size but the iframe's  * Comments  * Fix assertion  * Assert truthiness to pass type check  These will both pass since we're measuring the box just before.  * Fix presubmit error  * Move Ad3p test into 3p tests, 51965089, 104, 29, 104
Remove background page persistence (#6381), 51965089, 104, 29, 104
Move all creative rendering for A4A to layoutcallback (#6249)  * Initial modifications to move all creative rendering into layoutCallback; tests TBD  * Fix merge issues  * Test fixes  * Fix tests  * revert a4a examples  * PR review  * PR feedback  * PR review  * fix presubmit errors  * fix test failure, 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt and size.csv (#6406), 51965089, 104, 29, 104
amp-app-banner: add link to sample (#6405), 51965089, 104, 29, 104
Exit successfully if the shim is already what we want it to be. (#6416)  * Exit successfully if the shim is already what we want it to be.  * typo, 51965089, 104, 29, 104
convert back into bytes before putting into csv file (#6384), 51965089, 104, 29, 104
Update version number. (#6412), 51965089, 104, 29, 104
Implemented AmpContext and IframeMessagingClient (#6310)  * Added ampcontext.js ampcontext-lib and updated gulpfile.  * Changed how ampcontext-lib creates window.context  (for dev: cherry pick on to frizz-ampcontext)  * Split out PostMessenger as a parent class  * Changed name of class  * Made changes as per Hongfei. Had to expose getRandom().  * super() must be called before we can use this  * Fixed broken funtion documentation  * Fixed bug in lib and changed error thrown  * Made changes to fix presubmit failures  * Made fixes as per reviewers  * Fixed lint/style and presubmit errors., 51965089, 104, 29, 104
Fix SOVRN's ad example. (#6396), 51965089, 104, 29, 104
Punt if we can't find the amphtml-validator.cmd file. (#6402)  I couldn't find an environment variable to distinguish global and local install (other than parsing out the command line for npm) so this is a relatively simple but crude solution to cover a lot of cases., 51965089, 104, 29, 104
Migrate activity to doc-scope and fix instrumentation resolution (#6241), 51965089, 104, 29, 104
Implement basic visibility tracking using IntersectionObserver (#6318)  * Implement basic visibility tracking using IntersectionObserver  * Unify assert logic between V1 and V2 impl.  * Add tests.  * Add test for multiple triggers.  * Fix type-check  * Fix linter  * Update typedef.  * Merge to master head.  * Address comments.  * Address comments  * Use v2 when IntersectionObserver is supported., 51965089, 104, 29, 104
Errors might happen before the global AMP object is ever created. (#6397), 51965089, 104, 29, 104
Improve doc - wording examples format etc. (#6343), 51965089, 104, 29, 104
Move document-state to services (#6336)  * Move document-state to services  * fixes  * fixes, 51965089, 104, 29, 104
Use manifest and origin-manifest to look for banner source (#6388), 51965089, 104, 29, 104
Validator rollup (#6391)  * Update the set of characters which the javascript HTML parser allows in HTML tags after the first character in the tag.  * Update the set of characters which the javascript HTML parser allows in HTML tags after the first character in the tag.  * Avoid mutating the argument that's passed to validateSaxEvents.  * Fix a bug in the javascript HTML parser where we don't change the section when manufacturing a closing HEAD tag.  * Allow `amp-accordion` to have `disable-session-states` attribute., 51965089, 104, 29, 104
Switch to visibility API from viewer (#6337)  * Switch to visibility API from viewer  * more visibility states, 51965089, 104, 29, 104
A4A amp nameframe (#6099)  * First draft of nameframe.  Still needs tests and some gulp config.  * Added server rewrite rules for 3p .html files.  * Started test rig for nameframe.  * Changes to test rig but still not functional.  * Tests for nameframe itself in place.  * Tests for nameframe itself in place.  * Update gulp server rules to handle (optional) version number in nameframe URL.  * A4A promise chain changes in place.  * Moar tests.  * Lint fixes.  * Changes from reviews.  * Changes from reviews.  * Changes from reviews.  * Don't overwrite the rendering method if no header is present.  * Added preconnect.  * Updates in response to reviews.  * Updates in response to reviews.  * Rebase fixes.  * Fixes to tests.  Clear window.name in nameframe (b/c some browsers use it to identify the window internally leading to many string copies and serious garbage allocation if the name field is large and kept around).  * Remove rewrite rule from server.js.  * Updates in response to reviews.  * Updates in response to reviews.  * Rebase against master and resolve conflicts.  * Response to reviews.  * Response to reviews., 51965089, 104, 29, 104
Update Ligatus Ad Network Configuration (#6346)  Add "prefetch" and "renderStartImplemented", 51965089, 104, 29, 104
Explicitly load amp-ad tag in examples (#6382)  merging, 51965089, 104, 29, 104
Cleanup amp-fx-flying-carpet experiment (#6286)  * Remove "experimental" label from amp-fx-flying-carpet.md  * Remove amp-fx-flying-carpet experiment  Fixes #4003, 51965089, 104, 29, 104
Ensure that ios-embed mode is never triggered on a in-a-box iframe (#6373)  * Ensure that ios-embed mode is never triggered on a in-a-box iframe  * lints  * lints, 51965089, 104, 29, 104
AD README fix (#6374)  * git diff HEAD~1  * fix doc  * s, 51965089, 104, 29, 104
Expose sourceUrl to amp-ad iframe. (#6371)  * Expose sourceUrl to amp-ad iframe.  * Add a link to the spec., 51965089, 104, 29, 104
Remove old IO file (#6362), 51965089, 104, 29, 104
amp-accordion: add `store-state-opt-out` attribute to disable store state (#3852), 51965089, 104, 29, 104
Stop scrubbing hash (#6361), 51965089, 104, 29, 104
Do not require display:block on relative-body styles (#6365), 51965089, 104, 29, 104
add ignore globs for some validator paths like nodejs/node_modules and dist (#6366), 51965089, 104, 29, 104
remove make-body-relative flag on canary (#6364), 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt and size.csv (#6327), 51965089, 104, 29, 104
Cleanup 'pan-y' experiment (#6334)  * Cleanup 'pan-y' experiment  * fix tests, 51965089, 104, 29, 104
Prevent cancelled promises from reporting in console (#6335), 51965089, 104, 29, 104
Introduce expandStringAsync and expandStringSync in url-replacement (#6323), 51965089, 104, 29, 104
Fix minVisiblePercentage and maxVisiblePercentage (#6326)  * Fix minVisiblePercentage and maxVisiblePercentage  * Remove 'only', 51965089, 104, 29, 104
Allow URL rewrite on proxy origins (#6329), 51965089, 104, 29, 104
Sorry I forgot to add target="_blank" which we really want here (#6331)  to avoid clobbering the user's input into the text editor., 51965089, 104, 29, 104
For validator.ampproject.org add link to NPM package. (#6330), 51965089, 104, 29, 104
Ensure that sizer is no longer interfering after first height change (#6313)  * Ensure that sizer is no longer interfering after first height change  * review fixs  * fixes, 51965089, 104, 29, 104
Make `rectIntersection` accept an array (#6311)  * git diff HEAD~1  * change intersection-observer cae  * take multi arguments  * remove console log  * ...  * minor  * small change  * remove another dev().assert, 51965089, 104, 29, 104
Skip couple of jwt tests in Safari until #6292 (#6294), 51965089, 104, 29, 104
Copy edit doc per #6298 (#6309), 51965089, 104, 29, 104
Fix double submission using button[type=submit] (#6320), 51965089, 104, 29, 104
Check for win.performance before using it (#6316)  * git diff HEAD~1  * check performance  * also check for performance.now  * nit, 51965089, 104, 29, 104
Ensure that make-body-relative does not override the existing overflow style (#6319), 51965089, 104, 29, 104
An example of a "fake" a4a ad served as a 3p iframe (#6307)  * Trying to get fake 3p case working  * Serve a4a as an iframe  * revert 3p, 51965089, 104, 29, 104
Refactor methods in viewer into performance-impl (#6252), 51965089, 104, 29, 104
Update class/ID/tagname docs (#6302)  * Update class/ID/tagname docs  * review fixes, 51965089, 104, 29, 104
Fixes load time visibility. (#6291)  * Fixes load time visibility.  * remove unused local var.  * remove unused import, 51965089, 104, 29, 104
Allow *.cdn.ampproject.org as amp cache origin (#5901), 51965089, 104, 29, 104
AMP integration with Index Exchange (#5944)  * Add amp-ad support for Index Exchange  * fix alphabetical sorting of new ix config  * Updated alphabetical order using ix in ads.amp.html and corrected the year of copyright in ix.js.  * Add Index Exchange to amp-ad.md file, 51965089, 104, 29, 104
A4A non-AMP creative render defaults to safeframe for iOS (#6300)  * Set safeframe as default for ios  * remove console logs  * PR review  * PR comments, 51965089, 104, 29, 104
Fix amp-analytics tests to run in Safari (#6270), 51965089, 104, 29, 104
Carousel (#6295)  * revert change 4089  * set ariane-hidden to visible elements out of view  * remove checks  * removing aria-hidden, 51965089, 104, 29, 104
Update amp-app-banner.md to "stable" (#6278), 51965089, 104, 29, 104
Replace IntersectionObserver with IntersectionObserverPolyfill (#6227)  * use new intersectionobserverpolyfill for iframe and ad  * create getIntersectionChangeEntry func  * fix type check  * apply default threshold  * create intersectionobserverapi  * add test to getIntersectionChangeEntry function  * test  * refactor  * fix  * use fire  * nit, 51965089, 104, 29, 104
Force transfer sidebar to the Fixed 'transfer' layer. (#6155)  * Force transfer sidebar to the Fixed 'transfer' layer.  * review fix.  * Move to fixed layer before opening.  * Adding to fixed layer before dp block  * moving fl to build cb  * Make isFixed true for forceTransferElements  * Make isFixed true for forceTransferElements  * Review fixes, 51965089, 104, 29, 104
remove cached owner info (#6028)  * owner  * use getElementsByClassName, 51965089, 104, 29, 104
[amp-youtube] Move all the param logic to getVideoIframeSrc_()  (#6273), 51965089, 104, 29, 104
remove sticky-ad-better-ux experiment tag (#6296), 51965089, 104, 29, 104
FlexOneELEPHANT amp-ad support (#4924)  * FlexOneELEPHANT amp-ad support  * test  * delete test.txt  * FlexOneELEPHANT amp-ad support  * FlexOneELEPHANT amp-ad support  * FlexOneELEPHANT amp-ad support  * FlexOneELEPHANT amp-ad support  * fix f1e.js  * fix 3p/integration.js  * fix amp-ad.md  * no message  * FlexOneELEPHANT amp-ad support  * FlexOneELEPHANT amp-ad support  * FlexOneELEPHANT amp-ad support  * FlexOneELEPHANT amp-ad support  * FlexOneELEPHANT amp-ad support, 51965089, 104, 29, 104
revert init value (#6289), 51965089, 104, 29, 104
iOS Wrapper: enabled HTML-based selectors (#6276), 51965089, 104, 29, 104
Fix slidescroll tests for Safari (#6280), 51965089, 104, 29, 104
Validator Rollup (#6284)  * revision bump due to amp-hulu extension  * Support both v0.js and amp4ads-v0.js if the html_format is AMP4ADS  * Test in javascript that validator rules should make sense.  * Implement new validator logic that disallows the `<base href>` tag from appearing after any URL on the page.  * Test ValidationError in javascript.  * Allow this usage of startsWith to pass travis., 51965089, 104, 29, 104
switch boolean to number for canary flag (#6283), 51965089, 104, 29, 104
turn off all unsafe operations for cssnano (#6271)  * turn off all unsafe operations for cssnano  * add new size, 51965089, 104, 29, 104
amp-selector (#5975)  * amp select  * amp-seletor working solution!  * Documentation  * Add tests  * Lints and test fixes  * type check  * Refactored  * Refactored  * Fixing tests  * review fixes  * Lint  * Adding more tests and Lints  * experiment protection  * Lints  * Merge fix  * Review fixes  * Fix tests.  * Fix lint, 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt and size.csv (#6274), 51965089, 104, 29, 104
Introduce experiment flag for VisibilityV2 (IntersectionObserver based visibility tracking) (#6255)  * Introduce experiment flag for VisibilityV2 (IntersectionObserver based visibility tracking).  * Fix type checks  * linter fix  * Fix linter.  * Address comments, 51965089, 104, 29, 104
Animations: block animation until all resources are loaded (#6235)  * Animations: block animation until all resources are loaded  * review fixes  * review fixes, 51965089, 104, 29, 104
Skeleton of <amp-auto-ads> implementation (#6197), 51965089, 104, 29, 104
Ensure that the size changes are picked up between visible/invisible states (#6251), 51965089, 104, 29, 104
Create demo for amp-inabox with GPT (#6239)  * Create example page for amp-inabox in GPT  * Fix presubmit errors.  * Address comment., 51965089, 104, 29, 104
Content.ad: Domain handling bug fixes (#6247)  * Content.ad: Domain handling bug fixes  Fixed domain handling that denied serving ads to AMP publishers. A regex filters out the Google CDN and passes the resulting source URL for verification.  * Fixed Travis CI build errors    40:32  error  Strings must use singlequote   41:5   error  Keyword "if" must be followed by whitespace  space-after-keywords  * Updated based on suggestions/requests from @lannka  * Revert/remove ampSlotIndex * Changed 'h' const to 'host' * Changed 'd' const to 'domain' simplified ternary to or statement * Added comment  /* Identify and remove CDN path */ * Added line returns to if statement, 51965089, 104, 29, 104
First implementation of imagead (intent to implement #5541) (#5751)  * First implementation of imagead (intent to implement #5541)  This is fairly bare-bones: still needs converting the example ad server from one on pbl.bachtrack.com to one on the test server and still needs some tests implemented.  * Sample JSON for imagead now in examples directory  Previously there was a dependency on an external ad server for the example imagead to work. This is now gone.  * Fix Travis errors get rid of global  Uses of global.xxx changed to win.this.xxx as requested by @lannka at code review.  * Separate out the ad batch manager  The batch manager is now in a separate class.  * Moved getBatchManager into the batch manager file  This ensures that all batch manager related stuff is nicely separated out.  * Fix blatant errors in getBatchManager  * Add support for mustache templates cleaned up lint errors  * Several edits suggested by @lannka at code review  Scanning of the document now only done once. Redundant callback passing now removed. Batch manager is now more general. Experiment check now turned on. Example has placeholder and fallback. Stray yahoo config removed.  * Fixed lint errors  * Removed default template and accompanying data-target variable  * Latest batch of code review requests from @lannka  * First batch of changes for @jridgewell code review  * Got rid of use of e.win  * Don't pass the element to the batch manager constructor only its URL is needed  * Next batch of code review items mainly from @jridgewell  Still not done: investigate getting rid of data-slot use of timer module use of deferred XHR investigate further use of promises  * Code review changes: rewrite to use promises properly  amp-ad-batch-manager.js is no longer needed and has been deleted.  * Next batch of code review fixes from @jridgewell  * Rename imagead to custom  * Next batch of @lannka code review comments  * Implemented special case for ad slot not specified  * Eliminate stray console.log statement  * Implemented a unit test for getFullUrl_()  * Next batch of @lannka code review changes  In particular incorporate the new AmpAdUIHandler code plus tidying up of JSON examples.  * Added ad-type-custom to experiments.js  * Add file amp-ad-ui.js  * Add some types to the commenting  This is an attempt to get rid of some of the travis errors.  * Next Travis error: unlayoutCallback was missing a return statement  * Fixed some errors from gulp presubmit  * Minor fixes to custom.md and to template rendering, 51965089, 104, 29, 104
Fix local navigation history management by handling hash navigations (#5961), 51965089, 104, 29, 104
AdButler AMP Ad Implementation (#5736)  * AdButler Ad Implementation  * Fixed lint errors in AdButler integration files  * Added render-start to AdButler Ad Implementation  * Revert render-start implementation  Revert render-start addition for AdButler integration until more accurate calls can be performed.  * Update ads.amp.html, 51965089, 104, 29, 104
Fix gulp build rule for experiments.html. (#6232), 51965089, 104, 29, 104
Use scheme-relative Url so we can use https on Heroku/Firebase as well (#6226), 51965089, 104, 29, 104
Add felmat support for amp-ad (#6076)  * Add felmat support for amp-ad  * Add felmat support for amp-ad  * examples edit  * add renderStart  * add renderStart  * change param  * space-infix-ops  * change encode, 51965089, 104, 29, 104
Making amp-ad tests pass on Safari (#6193), 51965089, 104, 29, 104
Document form analytics events. (#6237), 51965089, 104, 29, 104
Update Pubmine amp-ad to implement render-start api (#6214)  * Implemented renderStart api and updated network call to head.js  Restoring example.  * Fix for linter error (network script requires variable), 51965089, 104, 29, 104
Makes viewer.sendMessageUnreliable reliably return promise of response. (#6191)  * Makes viewer.sendMessageUnreliable public.  * Make sendMessageUnreliable to return a real response promise. Also renamed it to sendMessageCancelUnsent  * Make sure new message is added to the tail.  * Add tests.  * nit  * Add TODOs.  * Address comments.  * Address comments, 51965089, 104, 29, 104
sync from internal configs (#6236), 51965089, 104, 29, 104
Migrate Instrumentation and Visibility to doc-scope service. (#5693), 51965089, 104, 29, 104
Remove amp-scrollable-carousel experiment flag (#6068), 51965089, 104, 29, 104
Small fixes. (#6220)  * Small fixes.  * Made coefficient of Math.random a constant.  * Made coefficient of Math.random a constant., 51965089, 104, 29, 104
Fix content-type on xhr error check (#6203), 51965089, 104, 29, 104
Update Experiments configs and remove launched gaurds. (#6224), 51965089, 104, 29, 104
fix doc (#6223), 51965089, 104, 29, 104
switch to self for cinsistency (#6146), 51965089, 104, 29, 104
Discourage JS-injected <link> tags (#6093), 51965089, 104, 29, 104
Add DOM fingerprint for ad requests (#5952)  * Add DOM fingerprint for ad requests.  * Whitelist ads/** dependencies on dom-fingerprint.ja.  * Handle review comments.  * More review comments.  * Add test file.  * Handle review comment.  * One more review comment.  * No longer need to account for generated ids., 51965089, 104, 29, 104
Remove the auto generated AMP element ID. (#6132), 51965089, 104, 29, 104
Rename the max script "a4a-host.js" to "amp-inabox-host.js". (#6129), 51965089, 104, 29, 104
Include the parent of iframe element when searching for closest selector (#6008)  * Include the parent of iframe element when searching for closest selector.  For #5657, 51965089, 104, 29, 104
AMP implementation of Media.net header bidder (#5872)  * AMP implementation of Media.net header bidder  * Update ads.amp.html  * Code clean-up and support for dfp param:ampSlotIndex  * Remove ampSlotIndex, 51965089, 104, 29, 104
Fix typo: s/permenantly/permanently/g (#6117), 51965089, 104, 29, 104
Simplify URL comparison for no-service-worker fallback (#6116)  * Simplify URL comparison for no-service-worker fallback  * minor, 51965089, 104, 29, 104
Add a note on response content-type and statuses. (#6114), 51965089, 104, 29, 104
Fixing more tests to they pass on Safari (#6113), 51965089, 104, 29, 104
Call installViewerForDoc and installViewportForDoc only in the entry point. Use viewerForDoc and viewportForDoc in other places. (#6090), 51965089, 104, 29, 104
AMP integration with Holder (#6024)  * Draft w/o lib  Draft w/o lib  * Fix  * Trying to setup local dev Signed-off-by: Anton Ornatskyi <a.ornatskyi@digital.umh.ua>  * Draft  Signed-off-by: Anton Ornatskyi <a.ornatskyi@digital.umh.ua>  * preconnect  Signed-off-by: Anton Ornatskyi <a.ornatskyi@digital.umh.ua>  * Dropbox  Signed-off-by: Anton Ornatskyi <a.ornatskyi@digital.umh.ua>  * config  Signed-off-by: Anton Ornatskyi <a.ornatskyi@digital.umh.ua>  * Worked simple version  Lint checked Banner received  * holderamp lib v1  Signed-off-by: Anton Ornatskyi <a.ornatskyi@digital.umh.ua>  * First PR candidate  * Final ready to PR  * Draft w/o lib  Draft w/o lib  * Fix  * Trying to setup local dev Signed-off-by: Anton Ornatskyi <a.ornatskyi@digital.umh.ua>  * Draft  Signed-off-by: Anton Ornatskyi <a.ornatskyi@digital.umh.ua>  * Dropbox  Signed-off-by: Anton Ornatskyi <a.ornatskyi@digital.umh.ua>  * config  Signed-off-by: Anton Ornatskyi <a.ornatskyi@digital.umh.ua>  * Worked simple version  Lint checked Banner received  * holderamp lib v1  Signed-off-by: Anton Ornatskyi <a.ornatskyi@digital.umh.ua>  * First PR candidate  * Final ready to PR  * Final ready to PR  * Draft w/o lib  Final version ready to PR  * Final version ready for PR  * holderamp lib v1  Signed-off-by: Anton Ornatskyi <a.ornatskyi@digital.umh.ua>  * PR candidate  * Final ready to PR  * Final ready to PR  * Cookie request removed  * var document - removed  * Syntax fixes  * ampSlotIndex removed, 51965089, 104, 29, 104
minor doc change (#6115), 51965089, 104, 29, 104
Clarify that nested values can be used for authorization response (#6112), 51965089, 104, 29, 104
Improve wording in experiment doc + link docs to consistent page per #4569 (#6107), 51965089, 104, 29, 104
Removed restriction on universal selector (#6111), 51965089, 104, 29, 104
Add how amp-live-list works (#5906)  * Add how amp-live-list works  * Update amp-live-list.md, 51965089, 104, 29, 104
<amp-iframe> Proper base64 encoding of srcdoc (#6101), 51965089, 104, 29, 104
Officially support Window event targets in loadPromise. (#6082), 51965089, 104, 29, 104
Corrected <html> tag types. (#6108), 51965089, 104, 29, 104
Enable default placeholder for amp-ad (#6002)  * default placeholder and fallback  * fix  * add to experiments  * fix tests  * import experiment string  * address comment  * remove layout fill  * use boolean  * nit, 51965089, 104, 29, 104
Skip chunk error handling tests for browsers that don't support unhandledrejection event (#6084), 51965089, 104, 29, 104
Forbid direct style manipulation (#6012)  * Forbid direct style manipulation  They must go through `setStyle` or `setStyles`.  * Lint  * Types  * Allow 3p to depend on style module  * Test fixes, 51965089, 104, 29, 104
Added ampSlotIndex to the whitelist of default allowed values. (#6079)  * Added ampSlotIndex to the whitelist of default allowed values.  * Removed 'container' as a default allowed value., 51965089, 104, 29, 104
Clear fragment by assigning a non-empty string. (#6071)  While we are in the dark about #6070 this would enable us to prove that this isn't a weird reload of the frame after the fragment cleared., 51965089, 104, 29, 104
Suppress errors from autoplay detection play call (#6083), 51965089, 104, 29, 104
Support booting users into app shell for browsers that do not support ServiceWorkers (#6074)  * No-service-worker url-rewriter  * review fixes  * do not prelaod non-https shell  * docs  * disable activation risk condition, 51965089, 104, 29, 104
Add test for error throwing in chunks. (#6069)  Also makes a small change to `makeBodyVisible` to ensure it never fails to make the body visible., 51965089, 104, 29, 104
Delete old AmpCarousel code (#6065), 51965089, 104, 29, 104
Add tests for scrollable carousel (#6064), 51965089, 104, 29, 104
Send form-submit success/error analytics events (#5868), 51965089, 104, 29, 104
Improve English and link to CORS JSON endpoints info (#6017), 51965089, 104, 29, 104
Force position:static on html tag for ios-embed viewport (#6060), 51965089, 104, 29, 104
refactor pr-check (#5924)  * refactor pr-check  * temp changes  * temp  * check readme  * test examples/html  * removing testing code, 51965089, 104, 29, 104
Clear sidebar open/close delays appropriately. (#6046)  * Clear sidebar open/close delays appropriately.  * tests  * Lints and fixes, 51965089, 104, 29, 104
Update Adsense network documentation link (#6049)  * Update Adsense network documentation link  * Update adsense.md, 51965089, 104, 29, 104
Fix tests so they pass on Safari (#6047), 51965089, 104, 29, 104
Adding Tumblr social sharing (#6014), 51965089, 104, 29, 104
Don't recalculate intersectionRatio (#6037), 51965089, 104, 29, 104
gulpfile (#6034), 51965089, 104, 29, 104
[amp-inabox] skeleton implementation (#5990), 51965089, 104, 29, 104
Add another way to detect whether a viewer is expected. (#6038), 51965089, 104, 29, 104
revert change 4089 (#6033), 51965089, 104, 29, 104
Wait for response in signin protocol (#6035), 51965089, 104, 29, 104
add more owners.yaml files (#5781), 51965089, 104, 29, 104
Skeleton for amp-viewer-integration extension (#6016), 51965089, 104, 29, 104
Further explain the details for the autoplay attribute (#6025), 51965089, 104, 29, 104
Adding marginwidth and marginheight attributes to A4A iframes. (#5998), 51965089, 104, 29, 104
Make embedded detection based on params more liberal. (#6026)  There is an ongoing bug where it appears the parent doesn't provide the origin even though it intends to. This is being worked around on the communication layer by using `location.ancestorOrigins` but we'd never initiate communication with the current state.  CC #4183, 51965089, 104, 29, 104
Fix error: "Can't find variable: TextDecoder"  (#6011)  * Update amp-ad-network-doubleclick-impl.md  * Reverting doc changes  The previous change was made in error (wrong branch).  * Initial changes need to update tests  * Start fixing tests  * Fix unit test coverage  * revert a4a examples  * Include self (window) when verifying TextDecoder/TextEncoder existence  * fix upstream conflict  * PR feedback  * PR feedback, 51965089, 104, 29, 104
Include the originalHash (#6020)  We remove the hash in embedding mode so the original code doesn't actually work., 51965089, 104, 29, 104
Improve error reporting (#6019)  - Include the current `location.hash`. We are missing it because it is not included in the referrer. - Include previously recorded errors so it is easier to identify follow on errors. - Kill the 2000 char limit as it isn't important for AMP's target browsers., 51965089, 104, 29, 104
add version parameter to AMP.extension signature (#5989)  * add version parameter to AMP.extension signature  * apply recommendations  * remove TODO, 51965089, 104, 29, 104
Combine amp-analytics var docs with var substitutions doc re: #1302 (#5576)  * Combine amp-analytics var docs with var substitutions doc re: #1302  * Updated non-supported vars + format changes for amp-analytics vars  * Updates per Avi's feedback  * Updated descriptions for amp-carousel vars, 51965089, 104, 29, 104
refactor amp-ad.css (#5992), 51965089, 104, 29, 104
Fix log calls without TAGNAME (#6005)  My presubmit was a bit too lenient and too strict at the same time., 51965089, 104, 29, 104
Other JS errors: Use startsWith (#6006)  Fixes https://github.com/ampproject/amphtml/pull/5994#discussion_r86412764., 51965089, 104, 29, 104
amp-sticky-ad close button new style (#5979)  * unit style  * fix css  * fix test  * rebase  * fix z-index, 51965089, 104, 29, 104
Fixes an issue where ads are not correctly centered on certain platforms. (#6003)  * Centralized creative centering in doubleclick.js and changed css 'transform' to a more commonly supported property.  * Added check for existence and changed to plain old 'transform'.  * Now asserting the existence of the container., 51965089, 104, 29, 104
A4A integration tests (#5812)  * First draft of full integration tests for A4A.  * First draft of full integration tests for A4A.  * Got tests of exception conditions working.  Refactored some common stuff to utils.js.  * Refactored XDom and friendly iframe tests to helpers.  * Added tests.  * Resolved merge conflicts.  * Centralized visibility check and updated visibility test.  * Moved all A4A tests to using central visibility test.  * Lint fixes.  * Changed custom expectations to local functions.  * Replaced stringToArrayBuffer with utf8Encode.  * Fixed visibility assertion.  * Lint fixes.  * Added a comment (partly in order to get Travis to re-run).  * Changes in response to reviews.  * Rebased and fixed small rebase error., 51965089, 104, 29, 104
Workaround for misbehaving webview viewer (#6001)  A webview viewer from Google is seing origins of the form `www.google.com`.  For the time being we accept these as they trigger errors in our error reporting that aren't useful. As this form of origins can only occur with webviews that have full control over the page via JS injection anyway this change should make no difference for normal web usage., 51965089, 104, 29, 104
Remove unsupported query selector feature (#5999), 51965089, 104, 29, 104
Allow for hosted testing to override where third party frame is retrieved from (#5890)  * Allow for hosted testing to override where third party frame is retrieved from  * test my own site  * fix ava tests, 51965089, 104, 29, 104
Only report 1% of errors if a page has non-AMP JS (#5994)  Fixes #5732, 51965089, 104, 29, 104
amp-live-list.md polling clarification (#5991), 51965089, 104, 29, 104
Introduce amp-auto-id attribute to AMP element. (#5973)  * Introduce amp-auto-id attribute to AMP element.  * Fix tests  * Address comments  * Address comments  * revert, 51965089, 104, 29, 104
Modify A4A AMP Creative to use ampRuntimeUtf16CharOffsets from validation rewrite (#5982)  * Update amp-ad-network-doubleclick-impl.md  * Reverting doc changes  The previous change was made in error (wrong branch).  * Initial changes need to update tests  * Start fixing tests  * Fix unit test coverage  * revert a4a examples, 51965089, 104, 29, 104
Base amp-analytics config for Google Conversion Tag. (#5672)  No docs yet while we are testing this.  - Example usage http://output.jsbin.com/xesehuf/quiet - Actually working (with inline config from this PR) demo http://output.jsbin.com/fikone/quiet, 51965089, 104, 29, 104
Introduce helper to make map-like objects. (#5880)  using `Object.create(null)`.  And use it in a few places where it should be used.  I haven't yet migrated all usages of `Object.create(null)`., 51965089, 104, 29, 104
Switch stylesheet replacement to cloneNode (#5930)  And ensure case insensitivity in test., 51965089, 104, 29, 104
Adding Mediavine to amp-ad (#5784)  * Adding Mediavine to amp-ad  * add missing trailing comma  * add sizes as an optional param to validateData  * extra spaces for fallover line  * update doc to indicate sizes is optional and remove required amp-ad parameters, 51965089, 104, 29, 104
make changes to sticky-ad 1.0 fix tests (#5984)  * force opacity remove amp-sticky-ad-loaded  * remove padding-top, 51965089, 104, 29, 104
Don't throw on sessionStorage non-availability. (#5968)  This is common (e.g. in private browsing mode) and completely fine.  Fixes #5964, 51965089, 104, 29, 104
Fix amp-forms sample in the docs (#5986), 51965089, 104, 29, 104
Bump package revision and add release notes. (#5985), 51965089, 104, 29, 104
Add a postinstall script for Windows. (#5983)  * Add a postinstall script for Windows.  The command line is executed both for cmd.exe and sh the Unix shell depending on where it runs. Note that cmd.exe is *really* different but there is a small subset that's common. So the postinstall command line works on both.  1) For Windows: /bin/sh doesn't exist so this is an error which we redirect to NUL (which is the Windows version of /dev/null). Then we try to delete NUL which won't work and give a non-zero exit status. But up to here it's all quiet. Now we get to || node postinstall-windows.js and this just runs the windows specific postinstall script. This script locates the Windows shim and modifies it so that it works. The shim that we put there just calls node with the name of the script file (index.sh) so we're skipping the index.sh dispatch script that we use for Debian-based (where node is called nodejs) and other Linux distros (where it's called node).  2) For Unix-like platforms /bin/sh \"exit 0\" will have exit status 0. NUL will be a temporary file which we then remove. This succeeds so we won't run the postinstall-windows.js script.  The index.sh script makes amphtml-validator work for both Ubuntu/Debian/etc. and other installations but this part isn't new.  * Forgot the -c argument for sh.  * Forgot the -c argument for sh.  * add some comments to the postinstall script  * make presubmit happy for console.log and console.error, 51965089, 104, 29, 104
Fixes error reporting for unsupported layout (#5976), 51965089, 104, 29, 104
create 1.0 version for amp-sticky-ad extension (#5923)  * add 1.0 folder  * add test  * test fixed by Dima  * fix tests  * fix share-tracking test, 51965089, 104, 29, 104
Cache SW: relax extension regex (#5974)  Extensions have a versioned `-0.1` which needs to be matched too., 51965089, 104, 29, 104
Revert #5960 which is a revert of #5887 (Clean up: Move viewport specific logic out from viewer.) (#5972), 51965089, 104, 29, 104
fix typos in documentation and call renderStart (#5644)  * call render-start when ad unit starts to load and fix typos in documentation  * minor documentation changes, 51965089, 104, 29, 104
Add Xlift AMP support (#5825)  * Add Xlift AMP support  * changed double quotes to single quotes  * Implemented window.context.renderStart and window.context.noContentAvailable on ads/xlift.js  * remove args e from loaded failure callback.  * remove tralling spaces.  * fixed some problems  * fix travis test errors.(  * fixed some issue  * remove trailling spaces.  * added line for initialize global.XliftAmpHelper  * remove trailling spaces, 51965089, 104, 29, 104
Avoid number assertion on undefined state[MIN_VISIBLE] (#5954), 51965089, 104, 29, 104
Don't calculate intersectRatio again. (#5965), 51965089, 104, 29, 104
Enable SauceLabs testing for iOS 8 9 & 10 (#5969)  Not sure what happened and I'm hoping we didn't just hit a lucky day but these tests now run just fine.  Needed to add the one `scrolling=no` change to `iframe.js` since this is required for our iOS embed mode to work., 51965089, 104, 29, 104
A4a 3p remove load from init (#5936)  * Update amp-ad-network-doubleclick-impl.md  * Reverting doc changes  The previous change was made in error (wrong branch).  * Remove load listener from AmpAdXOriginIframeHandler.init  * Correct conflict  * PR feedback, 51965089, 104, 29, 104
fix 3p ad (#5932), 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt (#5971), 51965089, 104, 29, 104
Add null check to amp-list response. (#5967)  Fixes #5962, 51965089, 104, 29, 104
Ensure that mode.getFullVersion_ falls back to the full version and not just major (#5946)  * Ensure that mode.getFullVersion_ falls back to the full version and not just major  * renames  * types  * update rtvVersion everywhere, 51965089, 104, 29, 104
Do not use new iOS viewport in iOS7 and lower. (#5959)  Because it doesn't allow overriding `document.body`., 51965089, 104, 29, 104
Cache SW: Do not cache experiments.js (#5893)  * Cache SW: Do not cache experiments.js  This explicitly disallows `v0/experiments.js` from being cached by our SW. This is necessary because we do not host an RTV version of this file which is required for anything that's cached. Plus why would we cache the experiments javascript?!  I've opted to de-duplicate a few areas into a single regex. Let me know if this is too complicated. This will allow us to easily support v1 v2 etc versions later on too.  * Tests should use pathnames, 51965089, 104, 29, 104
Revert "Clean up: Move viewport specific logic out from viewer." (#5960), 51965089, 104, 29, 104
Old Browser tests should run with compiled flag like other tests (#5957), 51965089, 104, 29, 104
Clean up: Move viewport specific logic out from viewer. (#5887), 51965089, 104, 29, 104
Build only first time lightbox is opened (#5941)  Build only first time lightbox is opened., 51965089, 104, 29, 104
Update docs to point to available templates; fixes #5620 (#5718)  * Update docs to point to available templates; fixes #5620  * Change wording for template vs template lang, 51965089, 104, 29, 104
Embed-level service overrides (#5925)  * Embed-level service overrides  * rename, 51965089, 104, 29, 104
Fix link to server-side filtering doc; issue 5904 (#5945), 51965089, 104, 29, 104
More SauceLabs flake fixes (#5943), 51965089, 104, 29, 104
Upgrade old chrome to 45 (#5938), 51965089, 104, 29, 104
Amp reddit extension (#5283)  * Add support for reddit comment and post embeds.  * Refactor preloading scripts.  * Add reddit embed tests.  * Add reddit extension documentation.  * Fix parameters and adding classes in reddit 3p script.  * Fix linter errors.  * Update which year it is.  * Fix type checks.  * Remove user log caching.  * Add extern values.  * Fix type check errors., 51965089, 104, 29, 104
Fix HTML block formatting and capitalization (#5905), 51965089, 104, 29, 104
Fix elementX & elementY in visibility tracking. (#5928)  * Fix elementX & elementY in visibility tracking.  * Update documentation., 51965089, 104, 29, 104
Creative signature validation keys are now cached in JavaScript. (#5922)  * Factored out signature verification into its own method. Added logic for caching in JS the validation keys and also for re-fetching the keys if the first attempt at verification fails.  * Fixed types.  * Accidentally reverted to lifecycleReporter when merging., 51965089, 104, 29, 104
Lifecycle Reporting Update (#5837)  * Modified CSI pings to now emit QEM (when available) and to use correlator.js for generating correlator.  * Factored out correlator/slotId creation from performance.js and made AmpAdLifecycleReporter GoogleAdLifecycleReporter.  * Changed how lifecycleReporter is constructed in 3p-impl.  * Refactored so that 3p-impl does not depend on any information from the lifecycleReporter.  * Removed unused code and added type annotation.  * Moved lifecycle reporting logic into callbacks within network impls.  * Removed unused code.  * Fixed type annotation.  * Last reference to NullLifecycleReporter.  * Resolved merge conflict.  * Fixed type annotations.  * Fixed lint issue.  * Added to dep-config whitelist a rule to allow performance.js to import a4a's lifecycle stages enum.  * Fixed performance.js tests to match new design.  * Lint issues.  * Fixed type check issue and fixed order of paramters in getLifecycleReporter to match the constructor of the reporter.  * Removed slotId as an argument to getCorrelator.  * Removed extraneous whitespace and also re-triggering Travis.  * Added some documentation and fixed types accordingly.  * Changed data-slot-id to data-amp-slot-id to reduce the chance that future ad networks might use this data tag.  * Changed data-amp-slot-id to data-amp-slot-index.  * Removed timerId., 51965089, 104, 29, 104
Introduce timeout for font stylsheets in AMP. (#5911)  All external stylesheets in AMP have the sole purpose of loading fonts. While browsers have a timeout for fonts (3s or lower) they don't have a similar timeout for stylesheets. Thus a user will often wait a long time for the stylesheet only to run into the next timeout for the font itself.  With this change if the page has not reached ready state 1s after the response started arriving on the client AMP will look for external stylesheets referenced in the doc and replace them with dynamically inserted stylesheets which do not block displaying the page.  As far as I know there is no way to tell whether a stylesheet has loaded. For this reason we use `document.readyState` as a signal since it is blocked by external stylesheets.  This change may have significant impact on AMP's 99%ile load performance., 51965089, 104, 29, 104
Fix A4A issues #5472 & #5273 (#5882)  * Update amp-ad-network-doubleclick-impl.md  * Reverting doc changes  The previous change was made in error (wrong branch).  * Address issues #5472 (ensure AmpAdXOriginIframeHandler.init promise is returned as part of layoutCallback) & #5273 (only increment 3p ad throttling when creative known not to be AMP)  * address PR feedback  * Fix lint errors  * fix type check errors  * Add tag to dev info, 51965089, 104, 29, 104
Fix link to amp-var-substitutions (#5903), 51965089, 104, 29, 104
Reflect tracking nature of iframes in priority. (#5913)  I've seen them being positioned at `fixed 00` and AMP prioritizing the load over actual user content., 51965089, 104, 29, 104
Pass the transient padding flag to FixedLayer to be in sync with viewport (#5900)  * Pass the transient padding flag to FixedLayer to be in sync with viewport  * docs, 51965089, 104, 29, 104
Add amp-image-lightbox screen reader close button (#5894), 51965089, 104, 29, 104
Don't use TextEncoder (#5902), 51965089, 104, 29, 104
`#setOwner` should rewrite `resource.owner_` value if it exist (#5898)  * fix  * add test  * add instance method to update owner value, 51965089, 104, 29, 104
Defer full upgrade until the element is connected (#5908)  * Defer full upgrade until the element is connected  * docs, 51965089, 104, 29, 104
Skeleton for an amp-animation component (#5891), 51965089, 104, 29, 104
Use upgrade callback to pick the correct carousel class. (#5899), 51965089, 104, 29, 104
Add alert role to user-notification by default (#5896)  * add role=alert by default  * grammar  * fix lint, 51965089, 104, 29, 104
Fix test-iframe-createIframeWithMessageStub failures on older browsers (#5895), 51965089, 104, 29, 104
Make screen readers announce changes in the slides carousel. (#5892)  Fixes #5485, 51965089, 104, 29, 104
Separate out implementaton of document-info and remove dependency of  (#5864)  Together this improves code size for `3p-frame` based and some other extensions.  Part of #5792, 51965089, 104, 29, 104
Fixed assertion in key fetch function. (#5854), 51965089, 104, 29, 104
Track impression on amp landing page (#5606)  * wip  * get response back from proxy server  * first impl  * another approach  * fix  * fix type check  * wip  * add getter  * add getter to sourceUrl  * address comments add timeout test  * test fix  * small fix  * use getter method, 51965089, 104, 29, 104
Backward compatible way of stringifying Uint8Array (#5881), 51965089, 104, 29, 104
Ensure that a friendly-iframe embed cancels any boilerplate when ready (#5863), 51965089, 104, 29, 104
Fix amp-forms broken and flakey tests. (#5835), 51965089, 104, 29, 104
Make SW test properly skip when Request == undefined (#5876), 51965089, 104, 29, 104
Add Preamble section to AMP Cache Guidelines (#5873), 51965089, 104, 29, 104
Adding Adverline to amp-ad (#5829)  * + Adverline amp-ads adapter  Signed-off-by: Benjamin Clot <benjamin.clot@gmail.com>  * fixed indentation  * no need to preconnect if the URL is in prefetch, 51965089, 104, 29, 104
Clarify cache guidelines (#5874)  - Turn compression change into example (not the only possible such change) - explain what `access` means in the context of AMP - clarify (previously only implied) that branding and attribution of articles may not be changed, 51965089, 104, 29, 104
Consider it as non-viewer mode if there is no "origin" in hash param. (#5867), 51965089, 104, 29, 104
[amp-youtube] autoplay and test suite to run across all video players that implement the video API (#5765), 51965089, 104, 29, 104
Update Forms Docs to reflect availability. (#5815), 51965089, 104, 29, 104
call viewport.updateFixedLayer when we display amp-live-list update button (#5865), 51965089, 104, 29, 104
Add documentation to slides analytics (#5724)  * Add documentation to slides analytics  * Review changes  * Review fixes  * review changes, 51965089, 104, 29, 104
Increase delay time for UI hint for carousel nav button (#5858)  * Increase delay time for UI hint for carousel nav button  * review fixes, 51965089, 104, 29, 104
Fix English uniform capitalization better changelog (#5842), 51965089, 104, 29, 104
Exposing input change event  and form.submit action (#5707), 51965089, 104, 29, 104
Image lightbox improvements (#5717), 51965089, 104, 29, 104
Run travis tests on latest Chrome (not Chromium) (#5843), 51965089, 104, 29, 104
Drop fieldset tests for user-invalid (#5861), 51965089, 104, 29, 104
Implement app banner new dismiss button UX (#5845), 51965089, 104, 29, 104
Add guideline for adding new experiment (#5853), 51965089, 104, 29, 104
Clean up experiment flag for amp-experiment (#5856), 51965089, 104, 29, 104
Remove extra inert line in de-check config. (#5857), 51965089, 104, 29, 104
Never include Closure Compiler polyfills in codebase. (#5832)  Never include Closure Compiler polyfills in codebase.  - they are pretty complex (relying on a symbol polyfill). - we actually had specific polyfills we need included ourselves duplicating the bytes., 51965089, 104, 29, 104
amp-sticky-ad: Force background-color alpha to be 1 (#5819)  * check background-color alpha  * s  * update JSdoc  * address comment 1  * refactor func to style.js  * fix test  * apply regular expression  * address comment  * add new test, 51965089, 104, 29, 104
Integration tests fix and forcing running tests when files in examples folder change (#5851), 51965089, 104, 29, 104
Update amphtml link rel to match file name in examples & fix comments (#5797)  * Update amphtml link rel to match file name in examples & fix comments  Just a few minor changes to the example within metadata:  * Formatting of the canonical comments in each example copied to stay consistent between all. Some had additional information that wasn't reflected across all examples. * Updated the `<link rel="amphtml">` href attributes to match file names for each. While the example URL does not function (404) it still serves to show that we are referring to the current file. * Updated the `sports-article-json-ld.amp.html` file's canonical to mirror the other example URLs (using `example.ampproject.org` domain).  * Remove duplicate comments from example, 51965089, 104, 29, 104
Fix grammar (recommend to recommended) (#5831), 51965089, 104, 29, 104
Fixes a4a should validate test failure (#5847), 51965089, 104, 29, 104
Replaced hardcoded dev key with dynamic fetch. (#5668)  * Replaced hardcoded dev key with dynamic fetch.  * Mocked out getSigningServiceNames so the dev key isn't fetched.  * Added assertion that no dev key is used in production.  * Using proprietary endsWith fucntion.  * Simplified stub.  * Trailing spaces.  * Stub has to come before initialization., 51965089, 104, 29, 104
Add default placeholder and fallback to all a4a examples. (#5553), 51965089, 104, 29, 104
Fix loadExtension tests (#5824), 51965089, 104, 29, 104
Make amp-iframe tolerant to string numbers in resize request (#5817), 51965089, 104, 29, 104
Launch Flying Carpets (#5800), 51965089, 104, 29, 104
Remove catch block (#5818)  `Resource#loadedOnce` can never be rejected., 51965089, 104, 29, 104
Docs: Correct link to Iframe origin policy (#5574), 51965089, 104, 29, 104
Force-override window.customElements (#5826), 51965089, 104, 29, 104
Allow owned elements to render in any viewport (#5814)  * Allow owned elements to render in any viewport  If the owner has told the element to prerender we'll do it (for now).  * Fix tests, 51965089, 104, 29, 104
Add ability for experiments to opt-into being toggled via the URL. (#5823)  This is useful for experiments where the referrer would like to actually experiment with the experiment.  Uses the feature with the chunking experiment., 51965089, 104, 29, 104
Use Date.now() everywhere it is appropriate. (#5830)  And forbid `#getTime()` for unwhitelisted use.  Aspect of #5792, 51965089, 104, 29, 104
Implement smartclip on Google AMP AdNetwork (#5443)  * implement smartclip on Google AMP Ads network  * updated smartclip publisher document  * smartclip publisher document changed link to mailto  * added missing protocol to loadScript  * changed prefetch url from smartclip.com to smartclip.net  * changed year to 2016 in copyright header  * preconnect is just a single url removed the array  * changed optional extra param to data-param  * added smartclip to examples  * added a link to the smartclip doc to the supported ad networks section  * added placeholder and fallback elements to the smartclip example  * removed duplicate params in allowed_data that are present in mandatory_data  * added plc sz and extra as data params to ads.extern  * sorted AMP_EMBED_ALLOWED in alphabetic order  * changed encodeURI to encodeURIComponent and added encodeURI to data.extra, 51965089, 104, 29, 104
Ensure that fixed transitions do not conflict and fix auto calc with padding (#5821)  * Ensure that fixed transitions do not conflict and fix auto calc with padding  * docs, 51965089, 104, 29, 104
Replace url fragment with outgoing share tracking fragment (#4762), 51965089, 104, 29, 104
remove process.env (#5805), 51965089, 104, 29, 104
remove `AMP.extension` calls in production binary (#5523)  * remove `AMP.extension` calls in production binary  * addExtension -> extension, 51965089, 104, 29, 104
Be tolerant to string numbers in iframe resizing request. (#5795), 51965089, 104, 29, 104
Validator Changes Rollup (#5813)  * Don't require the amp-form extension for label and/or input.  * gradientTransform attribute misspelled in validation  * Fixes to form action* attributes.  * Add saxAsJson format as validator input.  * Update to specfile from amp-reddit changes., 51965089, 104, 29, 104
Add `fake` ad network back for amp-ad example (#5785)  * Add `fake` ad network back for testing.  Also added amp-analytics in A4A example.  * Updated the signature and modified the example a bit., 51965089, 104, 29, 104
Restrict elements that can be tracked by amp-analytics tag inside a frame. (#5749)  Related to #5657, 51965089, 104, 29, 104
AMP integration with ZEDO adserver (#5591)  * AMP integration with ZEDO adserver  * changes after running lint  * defined the external variables to fix the gulp check-types run  * fixed year in copyright and deleted the zedo example page  * fixed data attributes defined in validate and README  * added renderStartImplemented to config  * review fixes and added url to prefetch, 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt (#5802), 51965089, 104, 29, 104
remove assert from a4a (#5791), 51965089, 104, 29, 104
Re-organize tests in test-amp-ad-xorigin-iframe-handler.js (#5790)  * Re-organize tests in test-amp-ad-xorigin-iframe-handler.js  * address a TODO  * nit  * address comments, 51965089, 104, 29, 104
Update vendors.js (#5578)  Added `ampdocHostname` `sourceHostname` `canonicalHostname`., 51965089, 104, 29, 104
Refactor awkward traversal and removal (#5636)  Because I was both traversing up and down the tree to figure out if it was the correct node to remove the node removed is possibly still on the post order traversal queue but parentless., 51965089, 104, 29, 104
Skip test that is continuously failing in Edge (#5782), 51965089, 104, 29, 104
Don't not negate a comparisson. (#5780)  Fixes #5779, 51965089, 104, 29, 104
Make sure viewer getFragment strip leading '#' (#5675), 51965089, 104, 29, 104
Pass sourceUrl to viewer via documentLoaded message. (#5753)  This can be used to confirm that the expected URL loaded., 51965089, 104, 29, 104
3pAd A4A sharing logic (#5356), 51965089, 104, 29, 104
Remove Timer promises catch clause (#5758)  * Remove Timer promises catch clause  Timer's promises can only fail because of being unable to schedule.  * Temp fix amp-form tests  Re: https://github.com/ampproject/amphtml/issues/5775, 51965089, 104, 29, 104
Adding Kixer ad network to amp-ad (#5690)  * Adding Kixer ad network to amp-ad  * Adding Kixer ad network to amp-ad  * Adding render-start  * Removed innetHTML  * Adding kargo link after merge, 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt (#5771), 51965089, 104, 29, 104
Iframe handler should NOT wait on ad response in special case A4A fallback (#5762), 51965089, 104, 29, 104
While serving ads.amp.html example page filter the ads by type if specified in URL query. (#5755), 51965089, 104, 29, 104
Allow dot character in CID fallback cookie (#5757), 51965089, 104, 29, 104
Laterpay access skeleton (#5735)  * Laterpay access skeleton  * fixing types  * docs, 51965089, 104, 29, 104
Give sidebar a default role of menu if not specified by author and focus on it on open (#5676), 51965089, 104, 29, 104
Implement 'amp-ad' type: 'ligatus' (#5715), 51965089, 104, 29, 104
Update instrumentation.js (#5759), 51965089, 104, 29, 104
Fix grammar add link. Obsoletes PR #2994. (#5706), 51965089, 104, 29, 104
Disallow certain amp-analytics triggers in iframes. (#5658)  * Disallow certain amp-analytics triggers in iframes., 51965089, 104, 29, 104
Improve error reporting to users. (#5737)  - Reduce severity of "task failed" messages that were confusing users. These errors get reported by themselves which is more helpful. - Don't report errors twice when in non-minified mode., 51965089, 104, 29, 104
Check log message usage in Presubmit (#5743)  Surprisingly (!) `Log#fine` `Log#info` `Log#warn` and `Log#error` take a Tag Name as the first parameter., 51965089, 104, 29, 104
Docs: formatting fixes for codeblocks badges remove empty table (#5610)  * Docs: formatting fixes for codeblocks badges remove empty table  * Correct lang for urls so syntax highlighter doesn't render red for non-correct syntax, 51965089, 104, 29, 104
Stream the presubmit checks (#5746)  Makes it feel much more responsive, 51965089, 104, 29, 104
add this.config to A4A (#5745), 51965089, 104, 29, 104
Align Segment's emphasis with other analytics providers (#5720), 51965089, 104, 29, 104
Yahoo amp-ad plugin (#5727)  * Adding Yahoo amp-ad plugin  * Removing use of global function  * Fixing url, 51965089, 104, 29, 104
Output the line/column of presubmit errors (#5742)  This makes fixing [much nicer](https://youtu.be/f6kUpnFcyDQ)., 51965089, 104, 29, 104
Support target protocol in templates (#5738)  * Support target protocol in templates  * cleanup  * linter  * fixing tests, 51965089, 104, 29, 104
allow extra globs for extensions deps (#5741), 51965089, 104, 29, 104
Fix typo and spacing (#5739), 51965089, 104, 29, 104
Fix A11Y issue on amp-list. (#5740), 51965089, 104, 29, 104
Gesture cleanup should clear the cached instance (#5656), 51965089, 104, 29, 104
Add manual test for 3P ad IntersectionObserver polyfill. (#5703), 51965089, 104, 29, 104
Don't report load errors to server. (#5733)  Fixes #5726, 51965089, 104, 29, 104
Add video ad serving instructions doc update (#5731), 51965089, 104, 29, 104
always use the latest release as the base for the diff (#5719), 51965089, 104, 29, 104
Fix AmpAdApiHandler type check (#5722), 51965089, 104, 29, 104
Vsync: protect tasks in the same pool from failing each other (#5709)  * Ensure that neighboring tasks do not fail the whole pool  * lints  * fixed types  * move try/catch in a non-inlinable function  * types fixed, 51965089, 104, 29, 104
SafeFrame mode for A4A (#5649)  * WIP: Early draft of SafeFrame mode for A4A.  * First draft of SafeFrame rendering.  Still needs tests.  * First draft of SafeFrame mode.  Still needs tests but works in standalone "eyeball" testing.  * Tests.  * Updates in response to reviews.  * Added tests for element visibility.  * Lint fixes.  * Updates in response to reviews.  * Moved shared iframe properties to common location.  * Minor fixes from review.  * Minor fixes from review., 51965089, 104, 29, 104
Add Flying Carpet to FixedLayer (#5701)  * Add Flying Carpet Container to FixedLayer  * Type check Flying Carpets  * Fix test, 51965089, 104, 29, 104
updated MediaImpact md file (#5655)  * updated MediaImpact md file  * updated MediaImpact md file, 51965089, 104, 29, 104
Ensure that an element is measured when resize is scheduled (#5708), 51965089, 104, 29, 104
Updates to amp-reddit validation rules (#5704), 51965089, 104, 29, 104
Allow Doubleclick publishers to force on A4A in beta-test mode (#5613)  * Draft of beta-tester override tag parameter.  * Made manual mode take precedence over publisher-override mode.  * Updates in response to reviews.  * Updates in response to reviews.  * Minor fixes from review., 51965089, 104, 29, 104
Better document Actions and Events in AMP (#5648), 51965089, 104, 29, 104
Remove unneeded styles from test iframe (#5652), 51965089, 104, 29, 104
Clean up updateViewerViewport method (#5680), 51965089, 104, 29, 104
Fix order of layout application. (#5694)  The old code potentially ran layout before initializing all custom elements leading to measurement errors.  The fix is simple: The nesting that led to this wasn't actually needed at all.  For the future: `pass.js` should actually schedule a chunk for immediate execution., 51965089, 104, 29, 104
Revert "Ensure that an element is measured when resize is scheduled" (#5696), 51965089, 104, 29, 104
Fix url rewritting to new version (#5669)  * Fix url rewritting to new version  Fixes #5575.  * Use hardcoded urls  Makes things MUCH clearer., 51965089, 104, 29, 104
[Video] Animated icon for auto playing videos (#5475), 51965089, 104, 29, 104
Calculate current absolute position of fixed-position elements (#5624)  * tmp  * Make layoutBox rects aware of fixed position movement  This makes the Resources `layoutBox` aware of fixed-position behavior. We now store the _relative_ position to the viewport for fixed-positions. When the element requests its current `layoutBox` well return the absolute position from (0 0) based on the current `scrollTop` and `scrollLeft`.  * Fix out of order assignment  * Re-add #layoutWidth. Accidental deletion.  * Fix const assignments  * Fix calcTaskScore_ tests for fixeds  * Fix setting initialLayoutBox_, 51965089, 104, 29, 104
Update amp-form docs to match validators and runtime updates. (#5671), 51965089, 104, 29, 104
Ensure that an element is measured when resize is scheduled (#5688), 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt (#5683), 51965089, 104, 29, 104
Fix broken tests on Chrome 54 (#5673)  * add document-register-element polyfill to testing iframe's win  * add DRE polyfill to describes.js, 51965089, 104, 29, 104
Output the URL of the current page in our start up message. (#5679)  This should be super helpful when debugging viewers that render multiple docs., 51965089, 104, 29, 104
amp-reddit validator rules (#5677), 51965089, 104, 29, 104
Sharethrough render-start support added (#5531), 51965089, 104, 29, 104
Position:relative on body (#5665)  * Position:relative on body  * reference bug, 51965089, 104, 29, 104
Fix for #5663 (#5664), 51965089, 104, 29, 104
Nokta Ad Server is added as an ad type (#5550), 51965089, 104, 29, 104
RFC: Separate the load phase of AMP into multiple chunks. (#5536)  The general idea is that AMP can be instructed to not block the UI thread during load phase for long if the document itself is not visible.  The change may be quite impactful. It does split up work into neat chunks (about 10-20ms on desktop longer on mobile) instead of one 400ms+ block. I validated that the number of style recalc doesn't change when the experiment is off.  - Current doesn't change `amp-shadow`. That will come in a follow up CL but might not make as much sense. - With the experiment not active the only thing this should change is that the initialization now goes through a bunch of micro tasks. This should behave as before in browsers with native promises., 51965089, 104, 29, 104
Add OWNERS files for A4A. (#5651), 51965089, 104, 29, 104
Update DEVELOPING.md, 51965089, 104, 29, 104
Call original event add/remove via interceptor (#5650)  * Call original event add/remove via interceptor  * wip  * minors, 51965089, 104, 29, 104
Fix wording on confusing steps to protect against CSRF. (#5646), 51965089, 104, 29, 104
Install runtime CSS for all amp tests (#5642), 51965089, 104, 29, 104
Implement outgoing link URL replacements. (#5628)  - Only exposes `QUERY_PARAM` and `CLIENT_ID` - Requires opt-in per `<a>` tag. - Only done for destinations going to the page's source or canonical origin.  Implements #4078, 51965089, 104, 29, 104
Wait for window to load before installing ServiceWorker. (#5638)  The WPT waterfalls in #5573 showed that the SW can interfere pretty heavily with the current page load which is bad in cases where it downloads a lot of stuff not currently needed., 51965089, 104, 29, 104
iOS wrapper viewport implementation (#5629)  * iOS wrapper viewport implementation  * minors  * tests and docs  * linter  * more tests for scrollWidth  * more tests, 51965089, 104, 29, 104
Do not use AMP Version as RTV Versions (#5474)  * Do not use AMP Version as RTV Versions  Fixes #5471.  * Fix tests, 51965089, 104, 29, 104
Purch Ad Support for Amp-Ads (#5464), 51965089, 104, 29, 104
A11Y fix for sticky ad close button. (#5640), 51965089, 104, 29, 104
Propagate ARIA attributes to real-elements (#5590), 51965089, 104, 29, 104
Ibillboard integration (#5392)  * + ibillboard integration  * call validateSrcPrefix always  * added rest of valid hosts  * + ibillboard ad example + valid hosts - one URL per line  * + ibillboard ad empty config  * Missing trailing comma reported by lint  * validateDataExists -> validateData  * unused example title removed shorter name for iBillboard better formatting, 51965089, 104, 29, 104
Add some keywords to the NPM description of the validator. (#5633), 51965089, 104, 29, 104
PWA: messaging and broadcast (#5588)  * PWA: refactor shadow-doc code into a subclass  * PWA: messaging and broadcasts  * type fixes, 51965089, 104, 29, 104
Carousel swipe not working well on Android Firefox (#5626)  * Remove no-scroll and test for effects.  * Fix for : Unable to navigate slides on Android FF., 51965089, 104, 29, 104
Type check social share (#5605), 51965089, 104, 29, 104
Skip SW Core tests on Browsers without Request (#5470)  * Skip SW Core tests on Browsers without Request  * Lint, 51965089, 104, 29, 104
Fix Element casting use assertElement (#5622), 51965089, 104, 29, 104
Type check amp-form and related files (#5604), 51965089, 104, 29, 104
Fix typo (#5616), 51965089, 104, 29, 104
Allow webviews to be set as trusted viewers (#5592)  * Allow webviews to be set as trusted viewers  Webviews can't set `ancestorOrigins` properly (maybe?) we can't use it to tell if we are in a trusted viewer context. Instead fall back to our "old browser" path which creates a `trustedViewerResolver_`. When the webview's integration script [sets the message deliverer](https://github.com/ampproject/amphtml/blob/f28e116/src/service/viewer-impl.js#L947) it [will resolve](https://github.com/ampproject/amphtml/blob/f28e116/src/service/viewer-impl.js#L961-L962) to the webview's passed origin.  Fixes #5563.  * Add tests  * Do not trust "webviews" that are really bad actor iframes  We treat them like normal iframes.  * Test for '1' explicitly  * Fix test, 51965089, 104, 29, 104
Turn on type checking for amp-lightbox and a tiny optimization. (#5602)  * Turn on type checking for amp-lightbox and a tiny optimization.  Do not force bringing up `localStorage` just to check whether it is supported in the Storage service.  * assertElement instead of cast., 51965089, 104, 29, 104
Forbid casting to !Element and encourage use of assert instead. (#5609)  * Forbid casting to !Element and encourage use of assert instead.  * Fix tests that did not pass the asserts., 51965089, 104, 29, 104
add validator owners (#5598), 51965089, 104, 29, 104
Update ads/README.md (#5552)  * Update ads/README.md  * Address comments, 51965089, 104, 29, 104
Trust the google.cat viewer domain (#5595)  * Trust the google.cat viewer domain  Confirmed this is the only exception to the usual domains that Google supports.  * Add tests, 51965089, 104, 29, 104
Validator Changes Rollup (#5596)  * Remove repeated `layout` attribute in `<amp-social-share>` example. * Allow custom validation attributes in forms. * Validate that submit-success/submit-error have templates. * Extract mapped attribute values in reverse order. * Allow AttrTriggerSpec to trigger when if_value_regex is not set. * Validator rules for `<amp-app-banner>` * Comment cleanup. * Handle non-quoted attribute values containing quotation characters. * Allow links to have target=_top. * Allow input and label without a form ancestor. * Add a value_casei option to AttrSpec, 51965089, 104, 29, 104
Allow rendering <input> and <textarea> inside amp-mustache (#5540), 51965089, 104, 29, 104
[A11Y] amp-image-lightbox set aria attributes (#5579), 51965089, 104, 29, 104
Owned resources may render to left or right of viewport (#5583)  * Owned resources may render to left or right of viewport  This allows owned resources to render when outside the viewport on the x-axis (only). This works because owned resources will never be prerendered until the owner explicitly allows it. So the owner knows better than Resources does at this point.  Fixes #5549.  * Add tests, 51965089, 104, 29, 104
PWA: refactor shadow-doc code into a subclass (#5526)  * PWA: refactor shadow-doc code into a subclass  * fixed types  * fix global sandbox leaks  * lints  * review fixes  * review fixes  * review fixes, 51965089, 104, 29, 104
Set aria-expanded on accordion controls not content (#5577)  * Set aria-expanded on accordion controls not content  * tests, 51965089, 104, 29, 104
[A11Y] Core Css class for visually invisible but screen-reader accessible elements (#5542), 51965089, 104, 29, 104
add myself as build-system owners. need it to test (#5581), 51965089, 104, 29, 104
Webediads - render-start support (#5462), 51965089, 104, 29, 104
Support .only in tests and remove default fake clock due to ambiguity (#5569)  * dot-only exclusive tests and timers  * cleanup  * presubmit fixes, 51965089, 104, 29, 104
Correctly report referrer of original page in error reporting. (#5562)  * Correctly report referrer of original page in error reporting.  Fixes #5561  * Store report URL in filename property (that is otherwise empty). This provides all available data for research purposes., 51965089, 104, 29, 104
Implementation and documentation of AdvertServe <amp-ad> tag (#5366)  * Implementation and documentation of AdvertServe <amp-ad> tag  * Implementation and documentation of AdvertServe <amp-ad> tag  * Removed changes that weren't needed  * Added the <fallback> tag  * Implemented renderStart, 51965089, 104, 29, 104
Criteo: Adding support to RTA tags besides passback (#5463)  * Adding support to RTA tags besides passback  * Fixing check types errors  * Simplifying code and fixing identation  * Adding RTA example  * Slot is not used in RTA  * Zone not used in RTA: fix example  * Fixing indentation  * Adding warning on targeting, 51965089, 104, 29, 104
sticky-ad: remove transparent overlay for ad support render-start (#5456), 51965089, 104, 29, 104
Minor change on hide/show viewer header (#5469), 51965089, 104, 29, 104
Update version for NPM push; update README. (#5556)  Also remove the unused version string from the command line tool. We have enough versions this is just confusing things too much., 51965089, 104, 29, 104
Add a newInstance method for creating a validator instance (#5534)  * Add a newInstance method for creating a validator instance which is synchronous and much simpler than the existing getInstance method (it's just a constructor call thus far).  * fix typo, 51965089, 104, 29, 104
use local gulp installed in node_modules in travis (#5554), 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt (#5543), 51965089, 104, 29, 104
Add compiler warning for dangerous use of `this` (#5244)  * add checkGlobalThisLevel(warn) to compiler opts  * malte's pr comment, 51965089, 104, 29, 104
Custom Elements V1 + ES6 class refactor (#5243)  * refactor base custom element from proto to es2015 class  * remove @interface from BaseCustomElement  * extract base class and start V1 port  * fix illegal invocation from using DOM APIs in custom element constructor  * some comment tweaks  * fix V1 implementation  * revert mv of implementation_ construction  * revert to use knownElements within base class to preserve upgrades  * fix some type errors and attempt to suppress others  * move type check suppression to correct places  * add some comments  * restore OK to collapse() call  * make init() private  * remove @this annotations  * revert @this removal restore caching via new subclass  * restore lines lost in bad merge  * subclass needs special constructor too for native V1  * fix isStub() param type  * justin's comment  * erwin's comments  * add V1 API to fake-dom.js, 51965089, 104, 29, 104
Make it clearer that the cache doesn't mediate the request (#5529), 51965089, 104, 29, 104
 mediaimpact: (#5420)  added loadHandler functionality to support startRender API  changed lib file url changed prefetch and extended preconnect settings, 51965089, 104, 29, 104
Use #getLayoutBox instead of confusing super call. (#5533), 51965089, 104, 29, 104
Cache the relative offsets of the ad's iframe. (#5271)  This is so we don't cache the iframe's layoutBox itself since it will change will scrolling inside fixed-position elements., 51965089, 104, 29, 104
Test flake intersection observer (#5528)  * Fix flakey intersection observer tests  https://github.com/ampproject/amphtml/issues/5359#issuecomment-253041688  * Add presubmit check for cross-domain iframe stubbing, 51965089, 104, 29, 104
Allow for white listed replacement of URL placements and use it in A4A. (#5275)  A more limited (to A4A) exposure of the work in #5053.  - Implements ability to provide a white list of replacements for a given operation. - Moves the click handler from a global position to A4A specific code. - Switches to simpler click position implementation (just `pageX/Y`)., 51965089, 104, 29, 104
Smart quotes begone (#5514), 51965089, 104, 29, 104
Installer for extensions for dev mode (#5459)  * Installer for extensions for dev mode  * notes  * minor  * review fixes  * minors  * pass AMP objecy, 51965089, 104, 29, 104
Allow data-attributes to pass through AMP sanitizer. (#5504), 51965089, 104, 29, 104
Add amp-experiment to extensions/README.md (#5510), 51965089, 104, 29, 104
Include accepted MIME types in amp-cache-guidelines.md (#5491)  * Include MIME types in amp-cache-guidelines.md  * Update amp-cache-guidelines.md  * Update amp-cache-guidelines.md, 51965089, 104, 29, 104
Send vars from carousel to amp-analytics (#5388)  * Send vars from carousel to amp-analytics  * Review comments.  * Type checks  * Fix tests., 51965089, 104, 29, 104
Rolling back pan-x on scrollable carousel. (#5490), 51965089, 104, 29, 104
Add context.library.name to Segment (#5467), 51965089, 104, 29, 104
Rollback pan-x on carousel as it does not work on android. (#5473), 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt (#5468), 51965089, 104, 29, 104
Added example of usage of carousel arrows (#5397)  * Added example of usage of carousel arrows  * Added type of markdown (html), 51965089, 104, 29, 104
ALP for A4A (#5430), 51965089, 104, 29, 104
Add Affiliate-B support for amp-ad (#5223), 51965089, 104, 29, 104
First cut of changes for New Type Inference (#5438), 51965089, 104, 29, 104
Lightbox 2.0: Use object-fit:cover for thumbnails, 51965089, 104, 29, 104
Upgrade Closure Compiler to v20160911 (Sep 11 2016) (#5457), 51965089, 104, 29, 104
Fake and real window fixtures for tests (#5425)  * Fake and real window fixtures for tests  * review fixes  * whitelist test vars  * flush vsync  * add storage API  * linter  * Always define sandbox and make fixtures reusable, 51965089, 104, 29, 104
Backgrounded Variable added to Timer Trigger (#5240)  * Added backgrounded variable to timer trigger.  * Inlined backgrounded field in vars object.  * Hoisted timer event function.  * Added BACKGROUNDED_STATE to url replacements.  Added support for BACKGROUNDED_STATE in amp-analytics.  Added documentation for BACKGROUNDED_STATE.  Added tests for BACKGROUNDED_STATE.  * Use correct set call for BACKGROUNDED_STATE call.  * Changed BACKGROUNDED_STATE to BACKGROUND_STATE  * Update instrumentation.js, 51965089, 104, 29, 104
make `touch-action: pan-x` on `amp-carousel` (#5391), 51965089, 104, 29, 104
Fix PR check on new branches (#5455), 51965089, 104, 29, 104
Do not rely on ampExtendedElements being created (#5454)  Fixes #5453., 51965089, 104, 29, 104
Turn type checking for 3p code back on. (#5452)  I accidentally it., 51965089, 104, 29, 104
Update ads/README.md with gulp lint tip (#5444), 51965089, 104, 29, 104
Migrate document-submit to doc scope (#5437), 51965089, 104, 29, 104
Link to Building an AMP Extension document. (#5451), 51965089, 104, 29, 104
Type check amp-app-banner (#5439), 51965089, 104, 29, 104
Move ad consent notification logic out from ad-cid to amp-ad. (#5290), 51965089, 104, 29, 104
Fix issue with multiple layouts causing error (#5449), 51965089, 104, 29, 104
Performance/profiling pings for A4A (#5373)  * Very early first steps.  * Progress on CSI pings for A4A and Amp Ad.  * Ping generator in place; tests mostly written.  * Full draft of perfomance monitoring ping generator with tests.  * Removed a spurious file that crept in.  * Fixed type check errors.  * Carve out down to control and experiment branches.  * Add global rate control via AMP_CONFIG vars.  * Resolved merge conflicts.  * Fixed tests; added styling to ping beacon img tags.  * Updated stage names.  Fixed lint errors.  * Factored common setup out of tests.  * More name refinement.  * Factor common test rig setup out of individual tests.  * Updated locations of ping probes.  * Fixed a test.  * Moved initialization to helper functions; fixed type checks.  * Updated ping names.  * Fixed dep rules to give performance.js access to experiment ID constants.  * Removed deprecated comment., 51965089, 104, 29, 104
make sure extension extern is included when compiling extensions (#5429), 51965089, 104, 29, 104
Unlayout Facebook and Twitter. (#5434), 51965089, 104, 29, 104
amp-carousel - slides - Fix desktop jitter (happening on certain graphics cards). (#5435), 51965089, 104, 29, 104
Add additional amp-sidebar validator tests (#4653), 51965089, 104, 29, 104
Refactor 3p ad unit test to remove dependency on amp-ad.js. (#5417), 51965089, 104, 29, 104
A few small optimizations (#5398)   - lazily init action map per element (most elements will never need it) - clean up promise resolve for element loading state - clean up elements from list of stubbed elements, 51965089, 104, 29, 104
PWA: visibility init parameters and dispose (#5403)  * PWA: visibility init parameters and dispose  * tests  * lints  * test fixes  * review fixes  * review fixes, 51965089, 104, 29, 104
Support for expansion of variables with params in parts of amp-analytics. (#4855)  * Support for expansion of variables with params in parts of amp-analytics config.  Specifically the `vars` and extraUrlParams` section encoded the variables with params before they could be expanded.  Fixes #4825, 51965089, 104, 29, 104
Experiment-protect form custom-validations. (#5424), 51965089, 104, 29, 104
Fix internal/local navigation links scrolling (#5381), 51965089, 104, 29, 104
Lighter way of detecting auto-play (#5412), 51965089, 104, 29, 104
Enable type checks for <amp-sidebar> (#5408), 51965089, 104, 29, 104
Modified A4A from shadow DOM to installFriendlyIframeEmbed (#5196)  * Update amp-ad-network-doubleclick-impl.md  * Reverting doc changes  The previous change was made in error (wrong branch).  * Initial integration with installFriendlyIframeEmbed  * Review comments  * Update amp-ad-network-doubleclick-impl.md  * Reverting doc changes  The previous change was made in error (wrong branch).  * Initial integration with installFriendlyIframeEmbed  * Review comments  * Change to stitching creative instead of removing portions  * Update unit tests  * Fix after merge with upstream/master; correct type failures within friendly-iframe-embed  * Fix lint errors  * remove console log, 51965089, 104, 29, 104
add assert that src or srcset should exist on resize (#5354)  * add assert that src or srcset should exist on resize  * retrieve Srcset instance in buildCallback, 51965089, 104, 29, 104
Add link for LOKA amp-ad (#5393), 51965089, 104, 29, 104
PWA: Migrate amp-dynamic-css-classes to ampdoc scope (#5358)  * Migrate amp-dynamic-css-classes to ampdoc scope  * linter, 51965089, 104, 29, 104
Add d_imp=1 to A4A Doubleclick Request (#5375)  * Update amp-ad-network-doubleclick-impl.md  * Reverting doc changes  The previous change was made in error (wrong branch).  * Enabled delayed impressions for doubleclick requests, 51965089, 104, 29, 104
enable type checks for <amp-accrodion> (#5389)  * enable type checks for <amp-accrodion>  * Review fixes, 51965089, 104, 29, 104
Prepare `BaseCustomElementProto` for Custom Elements V1 (#5348)  * move class additions to on-attached  * only add classes on first attach  * add unit test for adding classes on first attach  * remove unused var  * remove unused var  * remove unused var, 51965089, 104, 29, 104
Push amp-scrollable-carousel to 100% (#5363), 51965089, 104, 29, 104
Fix scroll position adjustment for viewer header (#5256)  * change function updatePaddingTop to hideViewerHeader/showViewerHeader respectively * in ios-embed mode no need to adjust scroll position we set the borderTop and paddingTop instead * in android mode no need to adjust scroll position nothing need to be done * rearrange the order of code execution   * hideHeader: update padding/border first then do animation   * showHeader: do animation first then update padding/border * the scroll message sent to viewer is continuous after hide/show header event * viewport.getLayoutRect(el) remains the same after hide/show header event, 51965089, 104, 29, 104
Fix indentation for scroll trigger. (#5355), 51965089, 104, 29, 104
Minor: Fix heading + Remove deprecated component (#5374), 51965089, 104, 29, 104
Trigger analytics events when carousel switches slides. (#5360)  * Trigger analytics events when carousel switches slides.  * Fix Build errors  * Review fixes.  * Lint fixes  * Review fixes  * Fix tests, 51965089, 104, 29, 104
Cache SW: Handle Foreign Fetches (#5007)  * Handle Foreign Fetches  Implementing based on https://developers.google.com/web/updates/2016/09/foreign-fetch. We still need to enable the Link Header:  ``` Link: </sw.js>; rel="serviceworker" ```  * Rewrite unversioned URLs to their versioned equivalent  * Review comments  * Type hint SW  * Ensure we never mix up an AMP version and an RTV version again  * Let's start testing!  * Tests  Also renames `ampVersion` to `rtvVersion` since it returns a `RtvVersion` not an `AmpVersion`.  * Final tests  * Use AMP_CONFIG.v  * Linting  * Add comment  * Convert from RtvVersion to AmpVersion  * Rename variable, 51965089, 104, 29, 104
PWA: VIewer as an ampdoc service (#5300)  * Make Viewer an ampdoc service  * review fixes  * lints, 51965089, 104, 29, 104
Refactor all buildImagePlaceholder_ to use createPlaceholderCallback (#5344), 51965089, 104, 29, 104
Compiler: --nti flag (#5378), 51965089, 104, 29, 104
Infrastructure for dynamically loading A4A validation keys (#5091)  * Update amp-ad-network-doubleclick-impl.md  * Reverting doc changes  The previous change was made in error (wrong branch).  * Clean up dynamic key loading.  * Fix test accounting for renaming.  * Fixed unit tests for amp-a4a and crypto-verifier.  * Removed debug statement and changed name of key set url from 'ampproject' to 'google'.  * Changed visibility of getSigningServiceNames to public.  * Clean up dynamic key loading.  * Fix test accounting for renaming.  * Fixed unit tests for amp-a4a and crypto-verifier.  * Removed debug statement and changed name of key set url from 'ampproject' to 'google'.  * Changed visibility of getSigningServiceNames to public.  * Clean up dynamic key loading.  * Fix test accounting for renaming.  * Fixed unit tests for amp-a4a and crypto-verifier.  * Removed debug statement and changed name of key set url from 'ampproject' to 'google'.  * Changed visibility of getSigningServiceNames to public.  * Clean up dynamic key loading.  * Fixed unit tests for amp-a4a and crypto-verifier.  * Removed debug statement and changed name of key set url from 'ampproject' to 'google'.  * Fixed issues left over from merge.  * Fixed type and lint issues.  * Minor fixes and restructuring as suggested in feedback.  * Reverted to using Uint16 instead of Uint8 in bytes.js.  * Removed need to convert from string to ArrayBuffer.  * Removed typehints unneeded else blocks and broke up ternary op.  * Replaced unneeded promise with just null.  * Yet another unneeded Promise removed.  * Fixed spacing issues removed unneeded return and moved typehints.  * Removed more annotations.  * Removed all type hints and another unneeded Promise.  * Fixed indentation changed throw to promise reject and added tests for utf8 en/de-coding.  * Fixed lint issues.  * Making use of  function for resolving nested promises in signature verification step.  * Fixed type annotation and replaced any with some function.  * Removed unneeded newline.  * Addressing feedback.  * Updated amp-ad-network-fake-impl import., 51965089, 104, 29, 104
kill slides and cleanup amp-slidescroll experiment (#5361), 51965089, 104, 29, 104
Fix layout references and example link, 51965089, 104, 29, 104
Dont make sidebar mask diaplay:none by default. (#5365)  Fixes Can't dismiss sidebar with click on main page content #5362, 51965089, 104, 29, 104
[Video] Move click handler out of video-manager (#5345), 51965089, 104, 29, 104
Fix all amp-ad related type errors and turn on type checking. (#5350)  * Fixed ads related unknown type errors.  * Fix all type errors  * Fix lint, 51965089, 104, 29, 104
fix amp-lightbox-image type issues (#5339)  * fix amp-lightbox-image type issues  * last rec, 51965089, 104, 29, 104
Fix social email share for iOS 10 (#5349), 51965089, 104, 29, 104
sticky-ad use `render-start` API (#5298), 51965089, 104, 29, 104
Remove repeated `layout` attribute in `<amp-social-share>` example. (#5341), 51965089, 104, 29, 104
<amp-img> Move property to constructor (#5338), 51965089, 104, 29, 104
<amp-video> Add constructor  (#5336), 51965089, 104, 29, 104
Fix all type errors in amp-analytics and activate type checking. (#5329)  Fixes a few real errors (badly named properties) that appear to have been inconsequential., 51965089, 104, 29, 104
PWA: migrate Preconnect to ampdoc scope (#5317)  * PWA: migrate Preconnect to ampdoc scope  * fixed types, 51965089, 104, 29, 104
Fix tests, 51965089, 104, 29, 104
lint, 51965089, 104, 29, 104
rename class to `-amp-make-body-block`, 51965089, 104, 29, 104
Moving the logic to viewport class., 51965089, 104, 29, 104
Experiment to make body - `display:block`, 51965089, 104, 29, 104
Updates to domain handling (#5315)  * Updates to domain handling  * Corrections to comply with Travis CI standards  * Additional Travis CI corrections, 51965089, 104, 29, 104
[Video] Detect autoplay (#5297), 51965089, 104, 29, 104
Update to documentation (#5316), 51965089, 104, 29, 104
Docs: Improve example links - link to ampbyexample.com (#5311)  * Docs: Improve example links per #196 * Remove empty examples row, 51965089, 104, 29, 104
Lightbox 2.0: item description detailed view (#5211), 51965089, 104, 29, 104
Fix borders on body after lightbox mode is enabled. (#5299), 51965089, 104, 29, 104
Fix amp img lightbox (#5279)  * ImageViewer class does not inherit `loadPromise`  * add simple test  * bind the function passed in since it is an instance method, 51965089, 104, 29, 104
PWA: Storage API refactored to ampdoc scope (#5289)  * PWA: Storage API refactored to ampdoc scope  * fixed tests  * tests fixed, 51965089, 104, 29, 104
amp-app-banner doc update (#5263), 51965089, 104, 29, 104
Corrected lang from none to html - breaks doc build (#5264), 51965089, 104, 29, 104
Migrate url-replacements to ampdoc scope (#5241)  * Migrate url-replacements to ampdoc scope  * linter  * fixing tests, 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt (#5277), 51965089, 104, 29, 104
remove toggleExperiment (#5192), 51965089, 104, 29, 104
Validator Updates (#5274)  * Allow SVG image tag with inline data but not with value image/svg+xml.  * Add some custom URI schemes for href and data-share-endpoint.  * Update icons and screenshots for extension.  * More work on a new URL parser for javascript. This change parses out everything in the authority section of the URL except for the host. That leaves host path query and fragment.  * More work on a new URL parser for javascript. This change parses the hostname.  * Allow resource hints in link elements.  * New URL parser for javascript more closely matching AMP Cache.  * Allow relative action URL in form tag.  * ump rev. due to Github pull.  * Rev bump due to protoascii change  * Add /*OK*/ for startsWith presubmit check.  * Add icon for Opera; update color scheme; update screenshots with new AMP icons., 51965089, 104, 29, 104
Update amp-form docs to document custom validations. (#5270), 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt (#5272), 51965089, 104, 29, 104
Attempt to move execution of gulp tasks into script. (#5157)  * Attempt to move execution of gulp tasks into script.  This makes it easier to skip tasks that are not relevant to the PR. The logic I made is pretty ad hoc thus far but I figure that it's a starting point for making this more sophisticated later - and even more fine grained. But for this change I'm already hoping that we no longer run the validator tests for runtime PRs and vice versa.  This change isn't tested except for fumbling a bit with the node interpreter hence it's in rough shape. Not sure how to best do this please advise.  * add TRAVIS_COMMIT_RANGE to command  * use synchronous execution in this script  * more comments  * do not require child_process  * one more try  * print stdout  * use spawn  * add OK to console.log and console.error to get past presubmit  * do not run gulp dist for validator targets  * process the return value of spawn  * add a failing test to validator_test.js  * introduce test that passes to validator_test.js  * Improve messages in pr-check and add failing runtime test.  * remove temporary tests now that we know pr-check works  * add missing closing curlies  * * hasPrefix/Suffix -> whitelisted {startsends}With + whitelist * remove console /*OK*/ -> console + whitelist * small bugfix in isValidatorFile (missing param for hasSuffix) * move npm run ava etc. into runtime only portion, 51965089, 104, 29, 104
Require a button instead of a link for better accessibility by default. (#5255), 51965089, 104, 29, 104
Fix URL Replacements bug (#5201)  * Force URL replacements to keep the same protocol  * Fix type annotations  * Make an assurance function  * Use parseUrl with a nocache parameter  * Assert protocol is not javascript  * Group sync expansion tests  * Dont' cache 'em dummy  * Test javascript protocol is rejected  * lint  * Fix types  * Fix test issues, 51965089, 104, 29, 104
Remove the no longer used gladeExp param. (#5119)  This functionality is now captured by gladeEids., 51965089, 104, 29, 104
Add common case variant of x-ua-compatible in validator (#5163), 51965089, 104, 29, 104
Corrected code block rendering (#5237), 51965089, 104, 29, 104
Bump `amp-slidescroll` 100% on prod. (#5253), 51965089, 104, 29, 104
version bump / relnotes for amphtml-validator NPM release (#5252), 51965089, 104, 29, 104
Assert that a node is in DOM before ampdoc can be queried (#5242)  * Assert that a node is in DOM before ampdoc can be queried  * fixes  * fixing tests  * check-types fixed  * fixing tests  * test fixing, 51965089, 104, 29, 104
Prefix transform in viewer.html to fix example on older iOS devices. (#5251), 51965089, 104, 29, 104
Support amp-ad for LOKA Research.inc (#4832)  * Support amp-ad on LOKA Research Inc.  * Use renderStart noContentAvailable API  * Fix for renderStart API  * Fix variable style  * Fix indent  * Fix example  * Remove wordy variable  * Modify event name, 51965089, 104, 29, 104
<amp-video> Switching from `canplay` to `loadstart` event (#5228), 51965089, 104, 29, 104
Viewport migrated to ampdoc scope (#5182)  * Viewport scoped as an ampdoc service  * references updated  * fixed viewport tests  * fixed test-fixed-layer  * annotate calls to global doc  * test-activity fixes  * fix for test-amp-app-banner  * fixed test-amp-live-list  * fixed test-amp-sticky-ad  * fix for test-amp-user-notif  * linter  * cleanuo  * Reverted article.amp.html  * fixed type def, 51965089, 104, 29, 104
AMP and Yandex.Metrica (#4565), 51965089, 104, 29, 104
Exposing amp-lite in getMode and not autoplaying videos in lite mode (#5180), 51965089, 104, 29, 104
Check the --format and --html_format command line arguments. (#5215)  Sadly the commander module isn't doing this and it can lead to confusing behavior to have these flags set to something that's not supported., 51965089, 104, 29, 104
amphtml-validator: Add --user-agent option and default user agent. (#5115)  * amphtml-validator: Add --user-agent option and default user agent.  * amphtml-validator: Removing version from user agent as asked in pull-request., 51965089, 104, 29, 104
Fix heroku origin regex. (#5209), 51965089, 104, 29, 104
refactor 3p ad test (#5193), 51965089, 104, 29, 104
twitter and instagram do not support src (#5183), 51965089, 104, 29, 104
don't remove side effect dist --fortesting (treated as dev) (#5202), 51965089, 104, 29, 104
Fix silent Shadow DOM failure (#5191)  * Fix silent Shadow DOM failure  Fixes silent Shadow DOM failure for compiled builds only in Safari. Both AMP PWA and Polymer PWA exhibit this bug.  `this` was incorrectly set to the window object within ShadowCSS which resulted in all self-referential functions inside ShadowCSS to fail. My guess is that Closure's DCE simply stripped all of these method calls which is why the failure was silent.  I'll survey the rest of the usages of `webcomponentsjs` within the AMP src to see if this is happening elsewhere and follow up with the `webcomponentsjs` team to see if they can switch to a less error-prone way of exporting objects.  * Fix lint errors and add comment  * Attempt to silence eslint's no-useless-call, 51965089, 104, 29, 104
listen to touchmove (#5155), 51965089, 104, 29, 104
remove whitelist from compile.js (#5114)  * remove whitelist from compile.js  * apply recs, 51965089, 104, 29, 104
remove items that are already live (#5175), 51965089, 104, 29, 104
Rollback: anchor href expand on document click (#5197)  This "rollsback" #5053 since it won't cleanly revert. To rollforward revert only this commit.  /cc @keithwrightbos, 51965089, 104, 29, 104
Document.contains polyfill for top and child windows (#5190)  * Document.contains polyfill for top and child windows  * added to fake modules  * check-types fixed and node=null tests, 51965089, 104, 29, 104
Remove infinite loop on attempts to rebuild (#5181)  * Remove infinite loop on attempts to rebuild  * to.be.calledOnce, 51965089, 104, 29, 104
Remove doc register element side effect (#5185)  * make sure document-register-element has no side effect in prod binary  this ensures that the lib dep can be tree shaken from any transitive dependencies.  * new size, 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt (#5184), 51965089, 104, 29, 104
flag yieldmo as renderStartImplemented (#5080)  Also update yieldmo readme to include gifs of resize behavior, 51965089, 104, 29, 104
Drop important statements for dismiss button for app banner and sticky ad (#5179), 51965089, 104, 29, 104
make sure to init instances extensions can use (#5161)  * make sure to init instances extensions can use  * add comments on why we do this, 51965089, 104, 29, 104
Revert "Update layout=fill CSS (#4977)" (#5176)  This reverts commit a19ec52b24420bc2300e99bd193aa77234f57845., 51965089, 104, 29, 104
Fix README renderStart related content (#5158), 51965089, 104, 29, 104
PWA: migrate document-click service to ampdoc scope (#5154)  * PWA: Migrate document-click to ampdoc scope  * minors  * fixed tests  * liter, 51965089, 104, 29, 104
Friendly iframes: a more precise document.ready signal (#5174)  * Friendly iframes: a more precise document.ready signal  * more docs, 51965089, 104, 29, 104
Friendly iframes: install registerElement polyfill (#5172), 51965089, 104, 29, 104
cleanup sticky-ad (#5169), 51965089, 104, 29, 104
Schedule pass after DOM mutation done by render delaying services. (#5148), 51965089, 104, 29, 104
Fixed issue for DFP resizing to override dimensions. (#5165)  * Update amp-ad-network-doubleclick-impl.md  * Reverting doc changes  The previous change was made in error (wrong branch).  * Fixed issue for DFP resizing to override dimensions.  * renderStart() should only be called with a specific size if that size matches one of the multi-size sizes., 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt (#5171), 51965089, 104, 29, 104
add missing cleanup issues (#5168), 51965089, 104, 29, 104
IntersectionObserver: Translate element coords into viewport coords (#5131)  * Translate element coords into viewport coords  I made a mistake in Fixes a mistake in #4826. The viewport we report moves with the scroll position while a real IntersectionObserver does not. And our elements didnt move with the scroll position while the real one did.  So this translates elements into their position relative to scroll and removes the scroll relative position from viewport.  Fixes #5090. /cc @jasti  * Skip reorienting owner  Saves a temp object  * Do not move a zero LayoutRect  * Fix tests  * Add todo about fixed position elements, 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt (#5162), 51965089, 104, 29, 104
Add Mixpo support for amp-ad (#5073), 51965089, 104, 29, 104
Increase revision for NodeJS API to push out the --html_format=AMP4ADS (#5159)  feature., 51965089, 104, 29, 104
Switch to new AMP logo. (#5136), 51965089, 104, 29, 104
Add missing dependencies. Not sure what happened here but (#5144)  this didn't build as checked in. It's possible I had some stale node_modules directory in my client., 51965089, 104, 29, 104
Bump amp-slidescroll to 100% on canary (#5153), 51965089, 104, 29, 104
amp-sticky-ad: add type check (#5057), 51965089, 104, 29, 104
Use window.document instead of window in loadPromise. (#4996)  * Use window.document instead of window in loadPromise.  window doesn't seem to have either .complete and .readyState that loadPromise needs to check if the document has loaded.  Fixes #4925  * Review feedback.  * Review feedback 2. Changed order of params added a test.  * Review Feedback 3. minor jsdoc fix., 51965089, 104, 29, 104
History migration to ampdoc (#5130)  * Migrade history to ampdoc  * fixed references  * fixed tests  * Global history binding is installed as global, 51965089, 104, 29, 104
Update document-register-element dependency (#5076)  * update to document-register-element 1+  switch to node build update patchRegisterElement code with new node path build Make the node document-register-element build work with closure compiler  * add missing trailing ;, 51965089, 104, 29, 104
<amp-iframe> proper box-sizing and defaulting frameborder to 0 (#5143), 51965089, 104, 29, 104
refactor test (#5133), 51965089, 104, 29, 104
Add Zucks to amp-ad supported adnetwork (#4724), 51965089, 104, 29, 104
Remove gfycat from error whitelists since validator is done (#5146), 51965089, 104, 29, 104
Add developer guidelines to ads/README.md (#5129), 51965089, 104, 29, 104
Update extension screenshots minor color changes. (#5135), 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt (#5138), 51965089, 104, 29, 104
Fixed login-dialog test with risk condition on micro-task (#5134), 51965089, 104, 29, 104
it used to be just a boolean we switched it to a timestamp (#5132), 51965089, 104, 29, 104
Update to latest AMP icons. (#5128)  * Update to latest AMP icons.  * versioning, 51965089, 104, 29, 104
Snap to the correct slide on orientationChange. (#5120)  * Snap to the correct slide on orientationChange.  * Add tests, 51965089, 104, 29, 104
Shadow DOM: Use the new getRootNode API (#5087)  * Use getRootNode API  * root node  * tests  * externs for getRootNode  * fixing tests  * minors, 51965089, 104, 29, 104
Remove internal only reference docs per issue #4965 (#5124)  * Remove internal only referenc docs per issue #4965  * Appending internal to file name so they aren't pulled into docs, 51965089, 104, 29, 104
Merge adType _ping_ & fakead3p (#5106), 51965089, 104, 29, 104
Roll forward: Implement anchor href expand on document click with X/Y support (#5053)  * Implement anchor href expand on document click with X/Y support  * Fixes after full stack testing: need to look at event path due to event target rewrite for shadowDom elements; was not binding whether capture to click handler properly.  Test coverage for fixes to be added shortly  * update tests; instead of looking for shadowRoot boundary to update x/y offset look for existence of event.path and use event.target which should match host element  * slight refactor for readability  * fix javadoc error  * Update amp-ad-network-doubleclick-impl.md  * Reverting doc changes  The previous change was made in error (wrong branch).  * changes in response to PR review  * update var substititions documentation  * make capture listener actually use capture!  * remove unnecessary else clause  * fix pull conflicts  * Fixes after full stack testing: need to look at event path due to event target rewrite for shadowDom elements; was not binding whether capture to click handler properly.  Test coverage for fixes to be added shortly  * update tests; instead of looking for shadowRoot boundary to update x/y offset look for existence of event.path and use event.target which should match host element  * slight refactor for readability  * fix javadoc error  * changes in response to PR review  * update var substititions documentation  * make capture listener actually use capture!  * remove unnecessary else clause  * fix test failure due to issue after merge  * address PR comments  * Implement anchor href expand on document click with X/Y support  * Fixes after full stack testing: need to look at event path due to event target rewrite for shadowDom elements; was not binding whether capture to click handler properly.  Test coverage for fixes to be added shortly  * update tests; instead of looking for shadowRoot boundary to update x/y offset look for existence of event.path and use event.target which should match host element  * slight refactor for readability  * fix javadoc error  * changes in response to PR review  * update var substititions documentation  * make capture listener actually use capture!  * remove unnecessary else clause  * fix pull conflicts  * Fixes after full stack testing: need to look at event path due to event target rewrite for shadowDom elements; was not binding whether capture to click handler properly.  Test coverage for fixes to be added shortly  * update tests; instead of looking for shadowRoot boundary to update x/y offset look for existence of event.path and use event.target which should match host element  * slight refactor for readability  * changes in response to PR review  * fix test failure due to issue after merge  * Revert "reenable history tests (#4758)"  This reverts commit 1375883e51e640a97590cf391e862648d19df8d1.  * Revert "Reverting doc changes"  This reverts commit 8d8c6dd858ae7d5d1e3962f4182fb3f91a60d295.  * Revert "Small Validator Updates including blacklisting __amp_source_origin for URLs. (#4781)"  This reverts commit bffeb2d15c946841653439846470bdca6e1d96e5.  * Revert "Remove video-id from the amp-youtube extension runtime. This attr had (#4507)"  This reverts commit 8d1799d4736f31f2a40ac79929aba55d714ac13f.  * Revert unintentionally added files.  * Revert unintentionally added file.  * Fix test failure from latest merge  * Fix conflict and lint errors  * Fix lint errors type check failures and test failures  * Fix test failures  * Remove Math.random override causing breakages in other tests  * PR comment feedback  * PR review changes  * PR code review  * PR review  * Address error in issue #5113  * PR review, 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt (#5126), 51965089, 104, 29, 104
Add Meg to amp-ad.md (#5123), 51965089, 104, 29, 104
Change waitForBody to use one MutationObserver for N calls (#4747), 51965089, 104, 29, 104
Refactor validation logic and introduce Custom Validators for forms (#5006), 51965089, 104, 29, 104
Meg Ad extension for AMP (#5022)  meg.js: Change var to const  Add `rendeStart` and `noContentAvailable`. Add `onerror` callback to the `loadScript`. Add simple test for `loadScript`  Fix lint error  Meg configs  Remove builtins/amp-ad.md  Fix year in header block  Tests for loadScript, 51965089, 104, 29, 104
Forbid Math.random assignments (#5056)  It **MUST** be stubbed., 51965089, 104, 29, 104
Add --htmlFormat option to the command line tool. (#5108)  * format -> htmlFormat / html-format since for the command line tool format is used for the output format of the tool. So I figure renaming this for consistency makes the world slightly less confusing and it's still easy to do now.  * foo  * run clang auto formatter  * add comment  * - fix min valid amp test - add a couple test for amp4ads including the command line flag, 51965089, 104, 29, 104
update experiments.html wording (#5081), 51965089, 104, 29, 104
Makes ads/_config.js contain full list of ad networks (#5084), 51965089, 104, 29, 104
PWA: Only initialize resources service when element is attached to DOM (#5086)  * Delay lookup of resources until ampdoc is known  * tests  * type fixes  * types fixed  * handle ampdoc as well  * tests for ampdoc  * expose AmpDoc in base element  * more docs and lints  * use cached instance of ampdoc  * test fixes, 51965089, 104, 29, 104
move (#5097), 51965089, 104, 29, 104
ad layoutCallback only layout once (#5060), 51965089, 104, 29, 104
format -> htmlFormat / html-format since for the command line tool (#5089)  format is used for the output format of the tool. So I figure renaming this for consistency makes the world slightly less confusing and it's still easy to do now., 51965089, 104, 29, 104
Rename ampdocFor to ampdocServiceFor (#5088), 51965089, 104, 29, 104
Validator Updates. (#5070)  * Validate the URLs in `data-show-if-href` and `data-dimiss-href` attributes of `<amp-user-notification>`  * Use slightly better / more specific help URLs for AMP4ADS messages.  * Point the CSS spec URL for AMP4ADS to the A4A spec.  * Initial work on a new URL parser for javascript.  * Use goog.string.startsWith, 51965089, 104, 29, 104
Fix elastic scroll criteria on slidescroll. (#5085), 51965089, 104, 29, 104
Added annotation to identify events as from AMP page (#5078), 51965089, 104, 29, 104
Revert "Standalone Doc: Only allow VISIBLE and HIDDEN visibility state (#4732)" (#5083)  This reverts commit 5240c6de0d2a7a8c0fc31d1d88d7d417cfe05c33., 51965089, 104, 29, 104
Re-organize ads/_config.js to reduce merge conflicts from 3P contributors. (#5068), 51965089, 104, 29, 104
Clean up AmpSlides tests (#5066), 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt (#5075), 51965089, 104, 29, 104
Support AMP4ADS in the webui (validator.ampproject.org) (#5064)  * Add a dropdown for AMP / AMP4ADS and feed the value to the validateString function. build.py needs a tweak to make it so that the vulcanize script will find the web-animations-js (which is a transitive dependency of paper-dropdown-menu).  * Support format url param Based on selection switch out the starter document Trigger revalidation when/after selecting the format, 51965089, 104, 29, 104
Add references to layout docs; fixes #173 (#5063), 51965089, 104, 29, 104
Friendly frames embeds (#4916)  * Friendly iframe embed system  * getFrameElement refactored to include parent tests, 51965089, 104, 29, 104
Type-check for <amp-viz-vega> (#5008), 51965089, 104, 29, 104
Dedup builtins/amp-ad.md and extensions/amp-ad/amp-ad.md (#4761), 51965089, 104, 29, 104
Adding server side filtering to amp-live-list docs (#4690)  * Create amp-live-list-server-side-filtering.md  * Update amp-live-list-server-side-filtering.md  * Update amp-live-list.md  * Update amp-live-list-server-side-filtering.md, 51965089, 104, 29, 104
Add ad container info to doc (#4907), 51965089, 104, 29, 104
Fix @visibleForTesting case (#5036), 51965089, 104, 29, 104
InMobi Ad extension for AMP (#4886)  * InMobi ad for amp  * Made changes for renderStart and noContentAvailable for NFR  * Fixed indentations and minor doc changes, 51965089, 104, 29, 104
https://ec-ns.sascdn.com not needed in preconnect through https://ec-ns.sascdn.com/diff/js/amp.v0.js prefetch (#5054), 51965089, 104, 29, 104
<amp-stiky-add> should call removeFromFixedLayer (#5034), 51965089, 104, 29, 104
Fix "it's" typos (#5047), 51965089, 104, 29, 104
Revert "Implement anchor href expand on document click with X/Y support (#4773)" (#5048)  This reverts commit fa582352e47fa5596d3fb9b7bf2e2ef3a0158771., 51965089, 104, 29, 104
Update Smart AdServer integration (#4990)  * Migrate Smart AdServer's AMP integration to the new AMP JS library.  * Fix the problem with the access to global "sas".  * Add support for renderStart to Smart AdServer integration  * Remove useless technical information  Removed information related to AMP noContentAvailable()/renderStart() from the documentation of Smart AdServer integration., 51965089, 104, 29, 104
Stub Math.random correctly (#5042), 51965089, 104, 29, 104
fix test-slides and test-style-installer (#5033), 51965089, 104, 29, 104
Pass exitCode for Karma runner done method. (#5039), 51965089, 104, 29, 104
Process curve string that is a cubic-bezier curve (#5001), 51965089, 104, 29, 104
Escape font family with single quotes for fontloader. (#5035), 51965089, 104, 29, 104
Increase tapping area to 48px for close buttons for banners more accessible (#5015), 51965089, 104, 29, 104
Implement anchor href expand on document click with X/Y support (#4773)  * Implement anchor href expand on document click with X/Y support  * Fixes after full stack testing: need to look at event path due to event target rewrite for shadowDom elements; was not binding whether capture to click handler properly.  Test coverage for fixes to be added shortly  * update tests; instead of looking for shadowRoot boundary to update x/y offset look for existence of event.path and use event.target which should match host element  * slight refactor for readability  * fix javadoc error  * Update amp-ad-network-doubleclick-impl.md  * Reverting doc changes  The previous change was made in error (wrong branch).  * changes in response to PR review  * update var substititions documentation  * make capture listener actually use capture!  * remove unnecessary else clause  * fix pull conflicts  * Fixes after full stack testing: need to look at event path due to event target rewrite for shadowDom elements; was not binding whether capture to click handler properly.  Test coverage for fixes to be added shortly  * update tests; instead of looking for shadowRoot boundary to update x/y offset look for existence of event.path and use event.target which should match host element  * slight refactor for readability  * fix javadoc error  * changes in response to PR review  * update var substititions documentation  * make capture listener actually use capture!  * remove unnecessary else clause  * fix test failure due to issue after merge  * address PR comments  * Implement anchor href expand on document click with X/Y support  * Fixes after full stack testing: need to look at event path due to event target rewrite for shadowDom elements; was not binding whether capture to click handler properly.  Test coverage for fixes to be added shortly  * update tests; instead of looking for shadowRoot boundary to update x/y offset look for existence of event.path and use event.target which should match host element  * slight refactor for readability  * fix javadoc error  * changes in response to PR review  * update var substititions documentation  * make capture listener actually use capture!  * remove unnecessary else clause  * fix pull conflicts  * Fixes after full stack testing: need to look at event path due to event target rewrite for shadowDom elements; was not binding whether capture to click handler properly.  Test coverage for fixes to be added shortly  * update tests; instead of looking for shadowRoot boundary to update x/y offset look for existence of event.path and use event.target which should match host element  * slight refactor for readability  * changes in response to PR review  * fix test failure due to issue after merge  * Revert "reenable history tests (#4758)"  This reverts commit 1375883e51e640a97590cf391e862648d19df8d1.  * Revert "Reverting doc changes"  This reverts commit 8d8c6dd858ae7d5d1e3962f4182fb3f91a60d295.  * Revert "Small Validator Updates including blacklisting __amp_source_origin for URLs. (#4781)"  This reverts commit bffeb2d15c946841653439846470bdca6e1d96e5.  * Revert "Remove video-id from the amp-youtube extension runtime. This attr had (#4507)"  This reverts commit 8d1799d4736f31f2a40ac79929aba55d714ac13f.  * Revert unintentionally added files.  * Revert unintentionally added file.  * Fix test failure from latest merge  * Fix conflict and lint errors  * Fix lint errors type check failures and test failures, 51965089, 104, 29, 104
Fix access test errors (#5030)  * Fix access test errors  * fixes, 51965089, 104, 29, 104
Merge amp-embed.md into amp-ad.md. (#5026), 51965089, 104, 29, 104
AMP Sidebar: Use `toggle` style helper (#5009), 51965089, 104, 29, 104
Change render-delaying-extensions to render-delaying-services. (#4983), 51965089, 104, 29, 104
Type check all entry points in a single run. (#5023)  - This is much faster and uses much less CPU and RAM (at least 2x faster) - Trade off is that it can hide some type issues that would be apparent with smaller compilation units but we already had that problem with extensions. - Disabled experiment testing for now because it currently relies on a prebuild step that seems unecessary for type checking purposes and makes it slow., 51965089, 104, 29, 104
add fetch and replace functionality to amp-fresh (#4827)  * add fetch and replace functionality  * temp  * apply recommendations  * apply recs  * fix lints  * apply recs, 51965089, 104, 29, 104
fix carousel types (#4989)  * [WIP] fix carousel types  * apply rec, 51965089, 104, 29, 104
Port the platform service to be globally installed. (#5012)  Avoids having its code in extensions., 51965089, 104, 29, 104
Fix custom-element double registration tests (#5014), 51965089, 104, 29, 104
Optimize YT loading (#5003)  - render some players outside the first viewport (but less than the 3 default viewports see comment) - preload the player HTML (this can now be done because we never preload in prerender where we don't allowed cookied domains like youtube.com)  Unrelated change: Remove long deprecated method in preconnect.js, 51965089, 104, 29, 104
Fix broken local runtime test. (#5010), 51965089, 104, 29, 104
Make our compilation O(extensions) instead of O(extensions**2) (#4978)  * Make our compilation O(extensions) instead of O(extensions**2)  Closure compiler parses all files in the glob for module ids and dependencies only to drop 99% on a typical compilation.  This change make extensions only glob themselves and not other extensions and additonally makes the glob area sparser (e.g. only `integration.js` globs the 3p code like it should be).  Significant additional work can be done to further reduce the files included in a given compilation but this should be a good first step.  * Handle file names starting with `./`  * No `!`, 51965089, 104, 29, 104
Lightbox 2.0 : gallery grid view (#4906), 51965089, 104, 29, 104
Video - Bail out if viewer is not visible (#4995), 51965089, 104, 29, 104
Validator Updates (#5002)  * Rev. bump due to pull; small fix to amp-audio test.  * a4a -> amp4ads  * Finish up the a4a -> ads4amp rename.  * Add AMP4ADS support to validator.js.  * Fix build.py (amp4ads-parse-css.js missing in file lists).  * Bump rev. due to Github pull., 51965089, 104, 29, 104
Update layout=fill CSS (#4977)  Fixes #4947., 51965089, 104, 29, 104
Video: common video API skeleton and muted autoplay for <amp-video> (#4786), 51965089, 104, 29, 104
Fix contentad link in amp-ad.md (#4992), 51965089, 104, 29, 104
Removing call to requestResize() (#4984)  * Update amp-ad-network-doubleclick-impl.md  * Reverting doc changes  The previous change was made in error (wrong branch).  * Fixed TODO item related to calling resizeRequest in doubleclick.js., 51965089, 104, 29, 104
Doc update to support multi-size ad requests (#4831)  * Doc update to support multi-size  * Doc update to support multi-size with corrections  * updated for clarity  * Minor updates for clarity, 51965089, 104, 29, 104
more type checks (#4975)  * more type fixes  * type fixes, 51965089, 104, 29, 104
Fix the base CID caching logic. (#4985), 51965089, 104, 29, 104
Better error message if amp-iframe resize request is less than 100px (#4981), 51965089, 104, 29, 104
just 2 slides (#4982), 51965089, 104, 29, 104
Update CORS add AMP-Same-Origin when Origin is missing on same origin requests (#4879), 51965089, 104, 29, 104
Fix render-delay-extension test which was asserting promise rejection incorrectly. (#4960), 51965089, 104, 29, 104
update z-index (#4979), 51965089, 104, 29, 104
Optimize A4A code size. (#4958)  * Optimize A4A code size.  - Avoid including `AmpAdApiHandler` in each A4A implementation. - Move load throttling code into common file with few deps. - Add a few forbidden deps tests to avoid regressions. - Stop building a4a as an extension as it is never loaded by itself.  * Update size, 51965089, 104, 29, 104
Pass optional obj to `#getIframe` (#4929), 51965089, 104, 29, 104
Insert ommitted `</p> </li> </dd> </dt>` tags in html parsing. (#4974), 51965089, 104, 29, 104
Move Storage service out of analytics and into core (#4944), 51965089, 104, 29, 104
Update video urls to be absolute (#4968), 51965089, 104, 29, 104
Ensure canary cuts always run Travis. (#4973)  Canary cuts are hard checkouts meaning they have no previous commit to compare against. Because there's no comparison the diff check would return an empty string. Because the empty string passes the "not anything that's not a doc change" check it would skip Travis., 51965089, 104, 29, 104
Cache SW: bad closure polyfills (#4934)  * Use endsWith and startsWith polys  * Type hint the cache  Hopefully thisll get rid of the stupid `Array#keys` and `Symbol` polyfills., 51965089, 104, 29, 104
Make Log DCEable. (#4963)  * Make Log DCEable.  - Makes it so that `user()` and `dev()` do not directly reference the log constuctor. Hence binaries that do not directly initialize it will not include the class itself. - A bit sad that one now has to be super careful to initialize the constructor in binaries that want it. - Also ensures (by caching instances in window instead of a module global) that there is only one instance per window., 51965089, 104, 29, 104
Rename the identifying attribute for the AMP4ADS style to (#4972)  amp4ads-boilerplate instead of amp-a4a-boilerplate for fewer naming variations of this thing., 51965089, 104, 29, 104
Expose loadPromise as method on BaseElement (#4964)  * Expose loadPromise as method on BaseElement  instead of importing the module. Almost all extensions use it and it is often their only substatial import.  Significant code size wins across the board.  * Remove testing only instance var now that we have a public member., 51965089, 104, 29, 104
Validator Updates (#4969)  * Revision bump due to Github Pull  * Rename the test files to -amp4ads- instead of -a4a- for consistency w/ format.  * Rename the HtmlFormat A4A -> AMP4ADS for consistency w/ HTML AMP4ADS tag., 51965089, 104, 29, 104
Migrate timer into shared service. (#4961)  Reduces most extensions by about 1KB., 51965089, 104, 29, 104
Include Content.ad in Supported ad networks list (#4966)  see #4835, 51965089, 104, 29, 104
fix amp-live-list types (#4959)  * fix amp-live-list types  * fix amp-live-list types, 51965089, 104, 29, 104
more type fixes (#4962)  * more type fixes  * more type fixes, 51965089, 104, 29, 104
Cleanup ios-overflow-x experiment. (#4922), 51965089, 104, 29, 104
Don't include closure compiler polyfills in secondary binaries. (#4950)  Small code size wins across the board., 51965089, 104, 29, 104
update doc (#4956), 51965089, 104, 29, 104
dep-check fix: extension must not depend on 3p (#4952), 51965089, 104, 29, 104
amp-ad file size fix : DO NOT import from integration.js (#4951), 51965089, 104, 29, 104
dce work on Log.prototype (#4911), 51965089, 104, 29, 104
Turn on type checking for a few more extensions. (#4939)  - `amp-audio` - `amp-brightcove` - `amp-twitter`, 51965089, 104, 29, 104
Switch to an opt-out model for extension compilation. (#4937), 51965089, 104, 29, 104
cron job from @erwinmombay to update size.txt (#4938), 51965089, 104, 29, 104
Validator Updates (#4936)  * Rename the directory to amp4ads and publish it to Github.  * Validator warning for missing `amp-ad-0.1.js`.  * Leftover from a previous push to Github: Fix up build.py so it runs the A4aParseCssTest., 51965089, 104, 29, 104
Type check first extension (amp-youtube) (#4931)  * Type check first extension (amp-youtube)  - Compiles together with main binary. While this may overlook some problems it avoid unknown type warnings. - Adds a dedicated extern for `AMP.BaseElement`. This is needed to get the inheritance hierarchy correct and not get unknown type warnings for other compilation units.  * Correctly pass up the element., 51965089, 104, 29, 104
Calculate optimal media budget., 91360018, 5, 1, 5
Debug random number generator and condense documentation of population segmentation constants, 91360018, 5, 1, 5
Changelog, 91360018, 5, 1, 5
Switch from integer to numeric data type., 91360018, 5, 1, 5
Delete tmp file., 91360018, 5, 1, 5
Initial commit, 91360018, 5, 1, 5
Add support for super ctors and improve error messages, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
fix gui, 25482136, 126, 28, 126
Merge branch 'master' of https://github.com/androguard/androguard, 25482136, 126, 28, 126
Add super support, 25482136, 126, 28, 126
Fix bug, 25482136, 126, 28, 126
fix useless import, 25482136, 126, 28, 126
add resources window, 25482136, 126, 28, 126
update the gui, 25482136, 126, 28, 126
update the GUI + parsing performance, 25482136, 126, 28, 126
move to QT5 + new stuff from qiew (https://github.com/mtivadar/qiew/), 25482136, 126, 28, 126
Modify detection of APK/DEX., 25482136, 126, 28, 126
Update, 25482136, 126, 28, 126
Fix androdd, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
Update, 25482136, 126, 28, 126
Merge pull request #143 from strazzere/master  Fix APK signature methods., 25482136, 126, 28, 126
Fix APK signature methods.  APKs can be signed using RSA DSA and EC keys. This change allows you to be able to see the EC key suffix when searching an APK. I've also added new methods to return a list of _all_ signatures found opposed to just the first.  The older methods are still available for backwards compatability. They have been refactored to select the first of the list which is how the previous functionality would have worked., 25482136, 126, 28, 126
Fix error, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
Update, 25482136, 126, 28, 126
Add offset for method analysis, 25482136, 126, 28, 126
Update, 25482136, 126, 28, 126
Remove tainted old stuff, 25482136, 126, 28, 126
Start to simplify the code, 25482136, 126, 28, 126
Fix issue with AST for some odex, 25482136, 126, 28, 126
Fix misc module, 25482136, 126, 28, 126
Fix decompile.py, 25482136, 126, 28, 126
Fix gui class xref, 25482136, 126, 28, 126
fix multiple bugs, 25482136, 126, 28, 126
Fix weird stuff in the decompiler :), 25482136, 126, 28, 126
fix field xref, 25482136, 126, 28, 126
Fix xref, 25482136, 126, 28, 126
Fix get_dex, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
fix version, 25482136, 126, 28, 126
Merge pull request #129 from leonid-s-usov/apk_resources  [apk] ARSC: fix config management and cover with tests, 25482136, 126, 28, 126
[apk] ARSC: fix config management and cover with tests, 25482136, 126, 28, 126
Merge pull request #125 from leonid-s-usov/apk_resources  Apk resources, 25482136, 126, 28, 126
[apk] get_android_resources: remove unnecessary try/catch.  Any exception should bubble up in this case, 25482136, 126, 28, 126
PEP-8 cleanup, 25482136, 126, 28, 126
Merge upstream master into apk_resources  Conflicts: 	androguard/core/bytecodes/apk.py 	tests/test_arsc.py, 25482136, 126, 28, 126
add landscape, 25482136, 126, 28, 126
Fix syntax, 25482136, 126, 28, 126
update auto code, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
Add the original get_dex function, 25482136, 126, 28, 126
Merge branch 'master' of https://github.com/androguard/androguard, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
Merge pull request #127 from subho007/patch-1  lgtm, 25482136, 126, 28, 126
Fixes #122  Thanks to @kvozon for the fix, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
[test] arsc: add app_name and app_icon tests, 25482136, 126, 28, 126
Merge upstream/master into apk_resources  Conflicts: 	androguard/core/bytecodes/apk.py, 25482136, 126, 28, 126
comments and some PEP-8 cleanup, 25482136, 126, 28, 126
fix tests, 25482136, 126, 28, 126
update session test, 25482136, 126, 28, 126
Add multidex support #123, 25482136, 126, 28, 126
Merge pull request #120 from lowks/patch-1  Update setup.py, 25482136, 126, 28, 126
Merge pull request #117 from guizos/patch-1  Update dvm.py, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
start to clean the code, 25482136, 126, 28, 126
add dad tests, 25482136, 126, 28, 126
update travis, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
start to support travis, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
[apk] StringBlock: Fix decoding and greately improve performance, 25482136, 126, 28, 126
Start a new way to RE, 25482136, 126, 28, 126
[apk] ARSCParser APK - improve arsc processing enable proper app_name and app_icon extraction  Conflicts: 	androguard/core/bytecodes/apk.py, 25482136, 126, 28, 126
Fix qt higlight, 25482136, 126, 28, 126
Update setup.py  Adding `description` to `setup.py` so that package does not show up as `UNKNOWN` on `pypi`, 25482136, 126, 28, 126
Update dvm.py  Extra '_' in get_instruction(). In its current state the method fails with:  File "./androguard/core/bytecodes/dvm.py" line 2918 in get_instruction     if self._code != None: AttributeError: 'EncodedMethod' object has no attribute '_code', 25482136, 126, 28, 126
Fix dey support, 25482136, 126, 28, 126
., 25482136, 126, 28, 126
Fix #114, 25482136, 126, 28, 126
Remove custombar, 25482136, 126, 28, 126
Fix bug in the gui for empty package name, 25482136, 126, 28, 126
Merge pull request #112 from dm4/fix-setup  Some scirpts no longer exist, 25482136, 126, 28, 126
Some scirpts no longer exist, 25482136, 126, 28, 126
fix error, 25482136, 126, 28, 126
Merge pull request #105 from zyrikby/api_permission_mappings  Api permission mappings, 25482136, 126, 28, 126
Merge pull request #103 from zyrikby/permission_api_modification  Permission api modification, 25482136, 126, 28, 126
Merge pull request #107 from zyrikby/deleting_aosp_permission_extractor_old_tool  Removed old tool for permission description extraction, 25482136, 126, 28, 126
Merge pull request #111 from zyrikby/vmanalysis_bug_correction  Correction of the bug #110, 25482136, 126, 28, 126
Correction of the bug #110, 25482136, 126, 28, 126
Fix setup + add the possibility to get the ast from the decompiler, 25482136, 126, 28, 126
Merge branch 'master' of github.com:androguard/androguard into permission_api_modification, 25482136, 126, 28, 126
Corrected a bug, 25482136, 126, 28, 126
Added api_permission_mappings selection module, 25482136, 126, 28, 126
Merge branch 'master' of github.com:androguard/androguard into api_permission_mappings, 25482136, 126, 28, 126
Merge branch 'permission_api_modification' into api_permission_mappings, 25482136, 126, 28, 126
Conflict resolved, 25482136, 126, 28, 126
Removed old tool for permission description extraction, 25482136, 126, 28, 126
Delete useless stuff, 25482136, 126, 28, 126
Add more information for class xref, 25482136, 126, 28, 126
Update xref window, 25482136, 126, 28, 126
Update readme, 25482136, 126, 28, 126
Update README, 25482136, 126, 28, 126
Merge pull request #102 from fredrikluo/master  Fix bug: wrong array length calculation in FillArray instruction., 25482136, 126, 28, 126
Merge pull request #106 from andrirad/bug-nonetype  Bug correction related to file types., 25482136, 126, 28, 126
Update the GUI, 25482136, 126, 28, 126
Bug correction related to file types.  Magic.from_buffer returns None when it cannot find a file type. This is never checked and causes an Exception when None is returned because the return value is  given as an argument to the APK._path_magic method.  	modified:   androguard/core/bytecodes/apk.py, 25482136, 126, 28, 126
Modified get_permissions_method, 25482136, 126, 28, 126
Modified get_permissions_method of TaintedVariable, 25482136, 126, 28, 126
Corrected get_permissions_method of TaintedPackages, 25482136, 126, 28, 126
Added modifications to get_permissions method of TaintedVariables, 25482136, 126, 28, 126
Modified get_permissions_method to work with api specific resources, 25482136, 126, 28, 126
Modified get_permissions method to work with api specific resources, 25482136, 126, 28, 126
Added functionality to load api specific resources to TaintedPackages, 25482136, 126, 28, 126
Added method to return api version, 25482136, 126, 28, 126
Added possibility to pass APK object to DalvikVM. Added new parameter to contructor specifing api version should be used for analysis, 25482136, 126, 28, 126
Added api specific api-permission mapping for API 22, 25482136, 126, 28, 126
Added api specific api-permission mapping for API 21, 25482136, 126, 28, 126
Added api specific api-permission mapping for API 19, 25482136, 126, 28, 126
Added api specific api-permission mapping for API 18, 25482136, 126, 28, 126
Added api specific api-permission mapping for API 17, 25482136, 126, 28, 126
Added api specific api-permission mapping for API 16, 25482136, 126, 28, 126
Added api specific api-permission mapping for API 15, 25482136, 126, 28, 126
Added api specific api-permission mapping for API 14, 25482136, 126, 28, 126
Added api specific api-permission mapping for API 10, 25482136, 126, 28, 126
Added api specific api-permission mapping for API 9, 25482136, 126, 28, 126
Reformatting output string, 25482136, 126, 28, 126
Added folder for api specific mappings, 25482136, 126, 28, 126
Added tool to extract permission mappings from PScout data, 25482136, 126, 28, 126
Added support for declared permissions into show() method, 25482136, 126, 28, 126
Added support for getting declared permissions, 25482136, 126, 28, 126
Renamed methods to get requested permissions, 25482136, 126, 28, 126
Added get_aosp_permissions method, 25482136, 126, 28, 126
Fix bug: wrong array length calculation in FillArray instruction., 25482136, 126, 28, 126
Merge pull request #101 from dweinstein/fix-rel-path  Relative path, 25482136, 126, 28, 126
Relative path, 25482136, 126, 28, 126
Merge pull request #86 from bl4ckh0l3z/master  Fix for is_android_raw in detecting *.apk files, 25482136, 126, 28, 126
Merge pull request #88 from shuxin/patch-1  Fix bugs of dex.save(), 25482136, 126, 28, 126
Merge pull request #93 from fredrikluo/master  The original readsleb128 has two major bugs., 25482136, 126, 28, 126
Merge pull request #89 from zyrikby/adding_api_specific_permissions  Adding api specific permissions, 25482136, 126, 28, 126
Merge pull request #90 from crozzy/feature/add-returning-functions  Added get_NativeMethods and get_ReflectionCode, 25482136, 126, 28, 126
Merge pull request #95 from fredrikluo/fix_array_length-1  Array-length has no type reference see the Dalvik document., 25482136, 126, 28, 126
Array-length has no type reference see the Dalvik document.  array-length vA vB  A: destination register (4 bits) B: array reference-bearing register (4 bits)    Store in the given destination register the length of the indicated array in entries, 25482136, 126, 28, 126
Add the limit of how many bytes to read leb128 would only takes 5 bytes maximum anyway., 25482136, 126, 28, 126
The original readsleb128 has two major bugs. - 1. result = unpack( '=b' buff.read(1) )[0]      if result <= 0x7f:         ...      Wont work with multi-bytes leb128 as the "result" will be read      as signed value and in multi-bytes the MSB of all but the last      byte are all set to 1.       Therefore the "result" which is read as the first byte of a      leb128 will always be negative hence this condition test will      always be true. Which means it really just reads one byte and      stops there for every signed leb128.  - 2. result = (result << 18) >> 18      ...       This  which I believe is to extend the sign bit won't work with      negative number neither as after bit operator result could become      positive from negative.  t = -624485 assert (t == dvm.readsleb128_1(bytecode.BuffHandle(dvm.writesleb128(t))))  Would show what happens., 25482136, 126, 28, 126
Modified code to show all requested permissions in show() method, 25482136, 126, 28, 126
Added code to Apk class to load api-specific permission module and get description of methods, 25482136, 126, 28, 126
Added code to load modules and default api version, 25482136, 126, 28, 126
Added aosp permissions for api 22, 25482136, 126, 28, 126
Added aosp permissions for api 21, 25482136, 126, 28, 126
Added aosp permissions for api 19, 25482136, 126, 28, 126
Added aosp permissions for api 18, 25482136, 126, 28, 126
Added aosp permissions for api 17, 25482136, 126, 28, 126
Added aosp permissions for api 16, 25482136, 126, 28, 126
Added aosp permissions for api 15, 25482136, 126, 28, 126
Added aosp permissions for api 14, 25482136, 126, 28, 126
Added aosp permissions for api 10, 25482136, 126, 28, 126
Added aosp permissions for api 9, 25482136, 126, 28, 126
Created folder for api specific aosp permissions, 25482136, 126, 28, 126
Created folder for api specific resource modules, 25482136, 126, 28, 126
Added tool to extract permissions from AOSP projects, 25482136, 126, 28, 126
Added get_NativeMethods and get_ReflectionCode, 25482136, 126, 28, 126
Fix bugs of dex.save()  1. StringDataItem + "\x00" 2. Fix CodeItem offset PS: bugs of DebugInfoItem still in process, 25482136, 126, 28, 126
Added method get_app_name  Added method get_app_name for retrieving the app name in just an invocation, 25482136, 126, 28, 126
Fix for is_android_raw in detecting *.apk files  The previous version of 'is_android_raw' is not able to detect some *.apk files in which the string 'PK' is not in the first block of 7 bytes.  So to correctly detect all *.apk files we need also to check some immutable resources which are absolutely present in their packages such as 'AndroidManifest.xml' and 'META-INF/MANIFEST.MF'., 25482136, 126, 28, 126
Merge pull request #78 from shuxin/patch-1  Update dvm.py (fix bug of data_off_obj & checksum), 25482136, 126, 28, 126
Merge pull request #56 from Nikoli/makefiles  Build system: respect CC CXX and LDFLAGS show compiler commands, 25482136, 126, 28, 126
Merge pull request #79 from shuxin/patch-2  Update sign.py (fix bug of _get_strings_pa), 25482136, 126, 28, 126
Merge pull request #85 from dweinstein/fix-for-missing-attribute-names  fix some manifest issues, 25482136, 126, 28, 126
remove unnecessary int(), 25482136, 126, 28, 126
fix some manifest issues  use dictionary for the resources instead of ini, 25482136, 126, 28, 126
Merge pull request #83 from google/temp2  Add unary postfix and compund assignment support simplify ast format, 25482136, 126, 28, 126
Add unary postfix and compund assignment support simplify ast format and fix write_inplace_if_possible behavior, 25482136, 126, 28, 126
Fix missing import, 25482136, 126, 28, 126
Merge pull request #81 from google/temp1  Fix case where Androguard tries to interpert None as a string literal for field initial values, 25482136, 126, 28, 126
Fix case where Androguard tries to interpert None as a string literal for field initial values, 25482136, 126, 28, 126
Merge pull request #80 from google/temp1  Change AST initial values behavior to match existing behavior, 25482136, 126, 28, 126
handle default case correctly, 25482136, 126, 28, 126
Change AST initial values behavior to match existing behavior modulo bugs, 25482136, 126, 28, 126
Update sign.py  fix bug of _get_strings_pa, 25482136, 126, 28, 126
Update dvm.py  fix bug of data_off_obj & checksum, 25482136, 126, 28, 126
Merge pull request #75 from google/temp1  Display condition of if statements where both branches jump to same location, 25482136, 126, 28, 126
Merge pull request #76 from google/temp2  Fix AST handling of Condition, 25482136, 126, 28, 126
Fix AST handling of Condition, 25482136, 126, 28, 126
Display condition of if statements where both branches jump to same location, 25482136, 126, 28, 126
Fix #72, 25482136, 126, 28, 126
Merge pull request #71 from ApplauseAQI/fix-android-21-compatibility-issue  Fixed #33: Androguard and android-21, 25482136, 126, 28, 126
Merge pull request #65 from kalenz/master  Small improvements and fix to androgui, 25482136, 126, 28, 126
Fixed #33: Android 21 compatibility, 25482136, 126, 28, 126
Fix code broken by 3a3d769bed51d8167967087a0fc22a0da2201df2, 25482136, 126, 28, 126
Merge pull request #64 from hgascon/master  Implemented get_src in analysis.PathVar. Fixes #62, 25482136, 126, 28, 126
Merge pull request #60 from zyrikby/master  Update analysis.py, 25482136, 126, 28, 126
Merge pull request #57 from Colbert337/patch-3  fix a zipmodule wrong in androrisk.py, 25482136, 126, 28, 126
Merge pull request #54 from Colbert337/patch-1  fix a format bug in api_permissions.py, 25482136, 126, 28, 126
androgui: hack to make xrefs work, 25482136, 126, 28, 126
androgui: No more files written to the disk, 25482136, 126, 28, 126
androgui: Reload is manual for now (no more scrolling when changing tab), 25482136, 126, 28, 126
androgui: fix bug not displaying class in tree when same name as namespace, 25482136, 126, 28, 126
androgui: add x n g i keyboard shortcuts, 25482136, 126, 28, 126
androgui: Implement closing of tabs with the mouse middle-click, 25482136, 126, 28, 126
Restore import path, 25482136, 126, 28, 126
Restore import path, 25482136, 126, 28, 126
Merge remote-tracking branch 'upstream/master'  A call in GVMAnalysis to the non-existent method get_src in analysis.PathVar causes an AttriuteError exception. The implemented method in this commit returns the class name and descriptor of the method referenced by idx in the same way that method get_dst returns the class name and descriptor of the method referenced by dst_idx., 25482136, 126, 28, 126
Implemented get_src in analysis.PathVar. Fixes #62, 25482136, 126, 28, 126
androgui: Auto select word under the cursor when clicking, 25482136, 126, 28, 126
androgui: add arguments to the xref window, 25482136, 126, 28, 126
androgui: Support loading and saving .ag from/to arbitrary locations, 25482136, 126, 28, 126
Use IPython pygments qt wrapper for androgui, 25482136, 126, 28, 126
androgui now uses a fixed-width font, 25482136, 126, 28, 126
Fix permission for androgui.py, 25482136, 126, 28, 126
Merge pull request #61 from google/temp1  Fix native methods not showing up in AST, 25482136, 126, 28, 126
Merge remote-tracking branch 'upstream/master', 25482136, 126, 28, 126
Fix native methods not showing up in AST, 25482136, 126, 28, 126
Merge pull request #1 from zyrikby/zyrikby-dynclassloading-patch  Update analysis.py, 25482136, 126, 28, 126
Update analysis.py  Update of analysis.py to get all cases of dynamic class loading (based on my research)., 25482136, 126, 28, 126
Merge pull request #59 from google/temp1  Fix unicode string printing (see commit da8083cd99918dd2ab31dfcc459aacf693925371), 25482136, 126, 28, 126
Merge remote-tracking branch 'upstream/master', 25482136, 126, 28, 126
fix a zipmodule wrong in androrisk.py  use zipmodule=2 in androrisk.pyfix the error:    File "/usr/lib/python2.7/zipfile.py" line 373 in _decodeExtra     tp ln = unpack('<HH' extra[:4]) struct.error: unpack requires a string argument of length 4, 25482136, 126, 28, 126
Fix unicode string printing (see commit da8083cd99918dd2ab31dfcc459aacf693925371), 25482136, 126, 28, 126
Merge pull request #55 from Nikoli/gui  Fix import in GUI, 25482136, 126, 28, 126
Build system: respect CC CXX and LDFLAGS show compiler commands, 25482136, 126, 28, 126
Fix import in GUI  Missed in commit 61ee7fd533182da67551ce3df2cd83802f65c013, 25482136, 126, 28, 126
fix a format bug in api_perssions.py  delete "\t\t\t" in "UPDATE_DEVICE_STATS\t\t\t"(in two place), 25482136, 126, 28, 126
Merge remote-tracking branch 'upstream/master', 25482136, 126, 28, 126
Merge pull request #47 from google/fix_this_params  Fix ast printing of ThisParam, 25482136, 126, 28, 126
Fix ast printing of ThisParam, 25482136, 126, 28, 126
Merge branch 'master' of https://github.com/androguard/androguard, 25482136, 126, 28, 126
Merge pull request #44 from google/fix_ast_condition  Fix minor mistake in conditional printing, 25482136, 126, 28, 126
Fix minor mistake in conditional printing, 25482136, 126, 28, 126
Fix unicode strings, 25482136, 126, 28, 126
Opcode should be shifted by 16 bits because const/high16 moves 16 bits into the high part of the register, 25482136, 126, 28, 126
Fix androlyze, 25482136, 126, 28, 126
Remove and move stuffs, 25482136, 126, 28, 126
Merge pull request #42 from google/add_ast_output  Disable some field ConstantValue types for now since they're not being parsed anyway, 25482136, 126, 28, 126
Disable some field ConstantValue types for now since they're not being parsed anyway, 25482136, 126, 28, 126
Merge pull request #41 from google/add_ast_output  Add ast output, 25482136, 126, 28, 126
Add AST output to DAD, 25482136, 126, 28, 126
Merge branch 'store_interfaces_as_list' into add_ast_output, 25482136, 126, 28, 126
Fix an issue with some loops, 25482136, 126, 28, 126
Move some methods out of Graph, 25482136, 126, 28, 126
Merge pull request #39 from google/remove_tuple_index_parens  Remove unnecessary parenthesis from dictionary tuple indexes, 25482136, 126, 28, 126
Remove unnecessary parenthesis from dictionary tuple indexes, 25482136, 126, 28, 126
Merge pull request #38 from google/temp1  fix extra space, 25482136, 126, 28, 126
Merge pull request #37 from google/fix_fake_type_descriptors  Fix fake type descriptors, 25482136, 126, 28, 126
Some fixes, 25482136, 126, 28, 126
fix extra space, 25482136, 126, 28, 126
Fix fake type descriptors, 25482136, 126, 28, 126
Merge pull request #36 from Fuzion24/master  Support DSA signatures, 25482136, 126, 28, 126
Support DSA signatures, 25482136, 126, 28, 126
Merge pull request #35 from google/temp1  Fix misspelling, 25482136, 126, 28, 126
Fix misspelling, 25482136, 126, 28, 126
Merge pull request #30 from google/methods_and_fields_as_list  Store fields and methods in list, 25482136, 126, 28, 126
Merge pull request #31 from google/remove_duplicate_androlyze  Remove duplicate androlyze, 25482136, 126, 28, 126
Merge pull request #27 from google/temp1  Use getter for consistency, 25482136, 126, 28, 126
Merge pull request #34 from bincker/patch-1  Update apk.py, 25482136, 126, 28, 126
Update apk.py  change the apk.py function of  "get_certificate()" bug that cat't use show_Certificate problem., 25482136, 126, 28, 126
Remove duplicate androlyze, 25482136, 126, 28, 126
Merge pull request #26 from google/delete_jvm  Remove unused bitrotted code, 25482136, 126, 28, 126
Merge pull request #28 from google/remove_unused_imports  Remove some unused imports, 25482136, 126, 28, 126
Store fields and methods in list, 25482136, 126, 28, 126
Store interfaces as list not string, 25482136, 126, 28, 126
Remove some unused imports, 25482136, 126, 28, 126
Use getter for consistency, 25482136, 126, 28, 126
Remove unused bitrotted code, 25482136, 126, 28, 126
Normalize colon style, 25482136, 126, 28, 126
Merge pull request #25 from androguard/revert-22-normalize_colon_style  Revert "Normalize colon style", 25482136, 126, 28, 126
Revert "Normalize colon style", 25482136, 126, 28, 126
Merge remote-tracking branch 'upstream/master', 25482136, 126, 28, 126
correct import path, 25482136, 126, 28, 126
Merge pull request #23 from google/ignore_pyo  Ignore .pyo files too (equivalent of .pyc when run with -O), 25482136, 126, 28, 126
Merge pull request #22 from google/normalize_colon_style  Normalize colon style, 25482136, 126, 28, 126
Ignore .pyo files too (equivalent of .pyc when run with -O), 25482136, 126, 28, 126
Normalize colon style, 25482136, 126, 28, 126
Merge pull request #7 from marco-gra/master  Bugfix for dexguard renamed class and method names which are not-ascii ..., 25482136, 126, 28, 126
added missing newline, 25482136, 126, 28, 126
added gitignore, 25482136, 126, 28, 126
Implemented better fix for strings and reverted the previous partial fix, 25482136, 126, 28, 126
Merge pull request #19 from hgascon/patch-1  Update androlyze.py, 25482136, 126, 28, 126
Merge pull request #18 from google/fix_oldstyle_classes  Fix remaining old style classes, 25482136, 126, 28, 126
Update androlyze.py  Correct IPython InteractiveShellEmbed import to avoid the warning: "The top-level `frontend` package has been deprecated. All its subpackages have been moved to the top `IPython` level.", 25482136, 126, 28, 126
Fix remaining old style classes, 25482136, 126, 28, 126
Merge pull request #17 from google/fix_strictfp  Fix strictfp appearing as strict, 25482136, 126, 28, 126
Fix strictfp appearing as strict, 25482136, 126, 28, 126
Merge pull request #15 from google/fix_extends_object  Fix extends Object, 25482136, 126, 28, 126
Merge pull request #16 from google/fix_file_closing  Wrap all file accesses in a with statement to ensure they are closed properly, 25482136, 126, 28, 126
Wrap all file accesses in a with statement to ensure they are closed properly, 25482136, 126, 28, 126
Fix extends Object, 25482136, 126, 28, 126
Merge pull request #14 from google/fix_get_source2  Fix get_source and get_source_ext so that they can be called more than once, 25482136, 126, 28, 126
Fix get_source and get_source_ext so that they can be called more than once, 25482136, 126, 28, 126
Fix missing code in some loops, 25482136, 126, 28, 126
Small fix for byte field encoding issue, 25482136, 126, 28, 126
Merge pull request #8 from google/master  Fix old style classes, 25482136, 126, 28, 126
Fix old style classes, 25482136, 126, 28, 126
Bugfix for dexguard renamed class and method names which are not-ascii and they were not compatible with python namespace, 25482136, 126, 28, 126
Add some tests., 25482136, 126, 28, 126
androgui collapse/expand treeview treeview more beautiful and source code cleanup, 25482136, 126, 28, 126
Remove a "not" that was missed in the merge, 25482136, 126, 28, 126
Merge branch 'saidelike-androgui', 25482136, 126, 28, 126
Merge branch 'androgui' of https://github.com/saidelike/androguard into saidelike-androgui  Conflicts: 	androguard/decompiler/dad/instruction.py 	androguard/decompiler/dad/writer.py, 25482136, 126, 28, 126
androgui files to add a GUI to androguard, 25482136, 126, 28, 126
decompiler hooks added to support mapping of objects in the output text, 25482136, 126, 28, 126
Merge pull request #2 from dweinstein/bugfix-use-android-namespaces  use getAttributeNS with android uri, 25482136, 126, 28, 126
Add elsim, 25482136, 126, 28, 126
use getAttributeNS with android uri  - this fixes issues with apps using a non-default android namespace   (e.g. com.opera.browser sha1   dcb769ca4489e00b7baa951e80f5e661fbfca18c versionCode: 1600561541)   where it uses 'ns0' instead of 'android' for prefixes on attributes   (see https://gist.github.com/dweinstein/c6ccd67e3ccbd2179955) for   example., 25482136, 126, 28, 126
., 25482136, 126, 28, 126
., 25482136, 126, 28, 126
Show missing Ifs, 25482136, 126, 28, 126
Some arrays are better displayed., 25482136, 126, 28, 126
Show the casts., 25482136, 126, 28, 126
Modify PO/RPO computation., 25482136, 126, 28, 126
Show the initialization value when a field has one. Order the modifiers of methods/class/..., 25482136, 126, 28, 126
Fix condition negation, 25482136, 126, 28, 126
Fix dominators computation., 25482136, 126, 28, 126
Small changes, 25482136, 126, 28, 126
., 25482136, 126, 28, 126
Slight modification of the def use pass., 25482136, 126, 28, 126
Fix ReachDef computation. Parameters were all defined at the same location of -1. They have now separate definitions (-1 -2 ...), 25482136, 126, 28, 126
Fix invoke-direct., 25482136, 126, 28, 126
Remove unused code., 25482136, 126, 28, 126
Write the name of the variable (vX_Y) instead of an irrelevant number, 25482136, 126, 28, 126
Hack to traverse the CFG when with some exception blocks, 25482136, 126, 28, 126
merge, 25482136, 126, 28, 126
Fix stuff, 25482136, 126, 28, 126
Add CheckCastExpression missing method, 25482136, 126, 28, 126
Fix a bug with invoke-super/range Split variables to separate each definition (not exactly SSA but sort of), 25482136, 126, 28, 126
Fix invoke-super/range bug, 25482136, 126, 28, 126
Added support for exceptions., 25482136, 126, 28, 126
Added support for types., 25482136, 126, 28, 126
Fix for the registers propagation., 25482136, 126, 28, 126
Reflects the way Smali decodes the strings in a dex file, 25482136, 126, 28, 126
Show native methods., 25482136, 126, 28, 126
Move the licence to Apache, 25482136, 126, 28, 126
Move the license to Apache, 25482136, 126, 28, 126
small changement, 25482136, 126, 28, 126
fix unresolved opcode handling, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
fix str/unicode bug, 25482136, 126, 28, 126
fix unresolved opcodes, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
fix color bug, 25482136, 126, 28, 126
fix odex get_buff, 25482136, 126, 28, 126
fix odex bug, 25482136, 126, 28, 126
fix several bugs, 25482136, 126, 28, 126
improve androdd fix issue 111, 25482136, 126, 28, 126
improve export, 25482136, 126, 28, 126
Fix issue 109., 25482136, 126, 28, 126
- Update: if both branches of a condition points to the same target generate a comment in the code to say so. - Refactoring, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
- Refactoring - Added some debug logging for the propagation pass - Fixed a bug with InvokeRangeInstruction - Fixed issue #102, 25482136, 126, 28, 126
fix bug, 25482136, 126, 28, 126
improve graphical export fix several issues, 25482136, 126, 28, 126
Update of the writer: some 'break' were missing in the loop/if structures. Fix of the graph: undesired non-determinism occured when structuring the graph. Removed the monitor-kind opcodes for now (threads/synchronized not yet supported)., 25482136, 126, 28, 126
- Fix for the propagation pass (check used variables only 1 time). - Fix for const4 (values are signed)., 25482136, 126, 28, 126
Integration of patch from issue 95, 25482136, 126, 28, 126
- Refactoring - Add tests, 25482136, 126, 28, 126
fix issue 98, 25482136, 126, 28, 126
fix issues, 25482136, 126, 28, 126
fix type issue 92, 25482136, 126, 28, 126
fix issue 92 fix syntax bug (strings), 25482136, 126, 28, 126
fix doc, 25482136, 126, 28, 126
add new arsc function, 25482136, 126, 28, 126
Added tag 1.9 for changeset 22ad3cf01e21, 25482136, 126, 28, 126
fix syntax, 25482136, 126, 28, 126
fix syntax, 25482136, 126, 28, 126
add sublime text plugin, 25482136, 126, 28, 126
fix arsc print, 25482136, 126, 28, 126
fix commande line arsc, 25482136, 126, 28, 126
fix for python 2.6, 25482136, 126, 28, 126
fix arsc format fix in auto analysis, 25482136, 126, 28, 126
remove networkx improve axml format support arsc format, 25482136, 126, 28, 126
Added `process_and_show` method in DvMachine for a better memory usage., 25482136, 126, 28, 126
Show log, 25482136, 126, 28, 126
Set the instructions of a method before creation to avoid to compute them each time. Update/Refactoring, 25482136, 126, 28, 126
Replacement of custom logging with python logging module, 25482136, 126, 28, 126
remove AndroguardS from decompiler, 25482136, 126, 28, 126
Temporary update for the opening of APK/DEX: DalvikVMFormat -> AndroguardS Small refactoring., 25482136, 126, 28, 126
compatibility with python2.6, 25482136, 126, 28, 126
fix bug with py 2.6, 25482136, 126, 28, 126
demo update, 25482136, 126, 28, 126
update.., 25482136, 126, 28, 126
fix string pb in decompiler, 25482136, 126, 28, 126
fix several issues, 25482136, 126, 28, 126
fix bug, 25482136, 126, 28, 126
fix issue 77, 25482136, 126, 28, 126
remove files, 25482136, 126, 28, 126
fix bug in dataflow, 25482136, 126, 28, 126
1.6 !, 25482136, 126, 28, 126
Added tag 1.6 for changeset 332db536fe86, 25482136, 126, 28, 126
fix paths, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
fix typo, 25482136, 126, 28, 126
Moved dad/ under androguard/decompiler/ for packaging., 25482136, 126, 28, 126
add automatic analysis module + script, 25482136, 126, 28, 126
1.5.1 release, 25482136, 126, 28, 126
Added tag 1.5.1 for changeset db62b5499056, 25482136, 126, 28, 126
fix bugs, 25482136, 126, 28, 126
prout, 25482136, 126, 28, 126
Update of the visitor pattern, 25482136, 126, 28, 126
Adding a template to implement new visitors in an easier way, 25482136, 126, 28, 126
Renamed the writing methods into visitor one (visitor pattern) so that it is easier to visit the blocks., 25482136, 126, 28, 126
Update the demo such that one can use the IRForm instructions in an easier way., 25482136, 126, 28, 126
fix bugs, 25482136, 126, 28, 126
Example to build IRForm instructions from dalvik instructions, 25482136, 126, 28, 126
`Fix` for the stack limit increase., 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
Fix of the propagation pass, 25482136, 126, 28, 126
Fix some bugs, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
fix return, 25482136, 126, 28, 126
Update of the decompiler. - Switches with fallthrough are handled. - Propagatation pass has been updated, 25482136, 126, 28, 126
fix various bugs, 25482136, 126, 28, 126
fix bug in modification, 25482136, 126, 28, 126
up setup, 25482136, 126, 28, 126
Added tag 1.5 for changeset c890f0c7a173, 25482136, 126, 28, 126
fix bug, 25482136, 126, 28, 126
remove useless file, 25482136, 126, 28, 126
Basic fix for the printing of switches. Switches with fallthrough still pose problems to print., 25482136, 126, 28, 126
integrate dad, 25482136, 126, 28, 126
add cache, 25482136, 126, 28, 126
Update of the decompiler. Beta version : it starts to be usable., 25482136, 126, 28, 126
add field modif, 25482136, 126, 28, 126
improve renaming, 25482136, 126, 28, 126
add renaming of methods/classes, 25482136, 126, 28, 126
fixed a bug in the control-flow analysis, 25482136, 126, 28, 126
up example for zost noob !;), 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
update doc, 25482136, 126, 28, 126
fix bug, 25482136, 126, 28, 126
update doc, 25482136, 126, 28, 126
update doc, 25482136, 126, 28, 126
add solution crackme, 25482136, 126, 28, 126
add documentation, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
add a function to change the offset of disasm, 25482136, 126, 28, 126
fix magic, 25482136, 126, 28, 126
fix bugs, 25482136, 126, 28, 126
fix bug add crypto, 25482136, 126, 28, 126
fix bug in packed/sparse, 25482136, 126, 28, 126
update odex, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
fix bug, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
Added tag 1.3 for changeset 1a43fd59b3bd, 25482136, 126, 28, 126
fix bug add note, 25482136, 126, 28, 126
add doc + write support, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
fix various bug improve analysis, 25482136, 126, 28, 126
fix bug, 25482136, 126, 28, 126
improve analysis, 25482136, 126, 28, 126
add color, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
update color windows, 25482136, 126, 28, 126
improve display, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
update dvm + apk, 25482136, 126, 28, 126
update modification of dalvik bytecodes, 25482136, 126, 28, 126
fix tests, 25482136, 126, 28, 126
add pack functions to instructions, 25482136, 126, 28, 126
add note + session, 25482136, 126, 28, 126
add note option, 25482136, 126, 28, 126
Adding comments for functions of APK, 25482136, 126, 28, 126
change dalvik bytecode parsing, 25482136, 126, 28, 126
fix #48, 25482136, 126, 28, 126
the doc directory does not exist any longer., 25482136, 126, 28, 126
fix bug in help, 25482136, 126, 28, 126
update zip functions, 25482136, 126, 28, 126
fix zip functions, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
update androsim to full python, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
fix bug in signature, 25482136, 126, 28, 126
update analysis, 25482136, 126, 28, 126
add idapipe + begin elg, 25482136, 126, 28, 126
fix bugs, 25482136, 126, 28, 126
fix, 25482136, 126, 28, 126
update to 1.0, 25482136, 126, 28, 126
fix various bug add new features, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
up readme, 25482136, 126, 28, 126
update setup, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
remove files, 25482136, 126, 28, 126
up elsim, 25482136, 126, 28, 126
fix signature update dalvik, 25482136, 126, 28, 126
update dvm, 25482136, 126, 28, 126
add regex strings, 25482136, 126, 28, 126
fix mac os, 25482136, 126, 28, 126
improve risk analysis, 25482136, 126, 28, 126
update kungfu, 25482136, 126, 28, 126
add andromercury tool, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
add new option: scan multiple files, 25482136, 126, 28, 126
add local/params registers, 25482136, 126, 28, 126
fix xml bug add new features, 25482136, 126, 28, 126
fix bug, 25482136, 126, 28, 126
fix signature bug, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
fix bug, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
fix various bugs, 25482136, 126, 28, 126
add data file, 25482136, 126, 28, 126
fix bug add moghava, 25482136, 126, 28, 126
fix bugs, 25482136, 126, 28, 126
fix bug in similarity, 25482136, 126, 28, 126
deleted shared libraries fix bugs to support 32/64 bits, 25482136, 126, 28, 126
fix path update db, 25482136, 126, 28, 126
fix bug update xref, 25482136, 126, 28, 126
fix apk bug, 25482136, 126, 28, 126
fix bug in apk, 25482136, 126, 28, 126
begin apk viewer, 25482136, 126, 28, 126
fix various bugs, 25482136, 126, 28, 126
fix bug add instruction throw-verification, 25482136, 126, 28, 126
update control flow, 25482136, 126, 28, 126
add logastrod signature, 25482136, 126, 28, 126
Decompiler update (add instructions...), 25482136, 126, 28, 126
add dad, 25482136, 126, 28, 126
not far from 1.0, 25482136, 126, 28, 126
update control flow reconstruction, 25482136, 126, 28, 126
fix various bugs, 25482136, 126, 28, 126
fix jvm bug add foncy signature, 25482136, 126, 28, 126
fix latest issue, 25482136, 126, 28, 126
fix bug in signature update database, 25482136, 126, 28, 126
add boxer signature, 25482136, 126, 28, 126
add boxer signature, 25482136, 126, 28, 126
add jad decompiler update libdvm, 25482136, 126, 28, 126
split libdvm, 25482136, 126, 28, 126
update libraries, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
Adds the useof <inttypes.h> to adjust the size of pointers on a 64-bit system. Also added a check in libsimularities ncd() to verify that s2 was not referencing a null pointer., 25482136, 126, 28, 126
patch to support 64 bits support ded decompiler, 25482136, 126, 28, 126
update graph analysis, 25482136, 126, 28, 126
fix issue #7, 25482136, 126, 28, 126
update graph analysis add nickybot signature, 25482136, 126, 28, 126
update signatures, 25482136, 126, 28, 126
update dbandroguard modify droidkungfu2 signature to detect lena, 25482136, 126, 28, 126
update visu, 25482136, 126, 28, 126
update graph analysis, 25482136, 126, 28, 126
update malwares database, 25482136, 126, 28, 126
add support of gexf, 25482136, 126, 28, 126
add new signatures, 25482136, 126, 28, 126
add ewalls, 25482136, 126, 28, 126
improve risk measure, 25482136, 126, 28, 126
add doc, 25482136, 126, 28, 126
update decompiler, 25482136, 126, 28, 126
update api, 25482136, 126, 28, 126
update api, 25482136, 126, 28, 126
add api, 25482136, 126, 28, 126
add new signatures (sndapps spitmo), 25482136, 126, 28, 126
add pjapps hipposms, 25482136, 126, 28, 126
add ggtracker signature, 25482136, 126, 28, 126
add droideluxe, 25482136, 126, 28, 126
add droideluxe, 25482136, 126, 28, 126
add lzma folder, 25482136, 126, 28, 126
add zsone signature add xz, 25482136, 126, 28, 126
fix bug found by zost !, 25482136, 126, 28, 126
add new signatures fix bug in androlyze, 25482136, 126, 28, 126
begin exploits signature with static string (can be useful ?), 25482136, 126, 28, 126
update engine, 25482136, 126, 28, 126
add basebridge/rogusppush signatures, 25482136, 126, 28, 126
improve detection engine, 25482136, 126, 28, 126
add new example, 25482136, 126, 28, 126
add yzhcsms signature, 25482136, 126, 28, 126
add crusewind, 25482136, 126, 28, 126
add plankton, 25482136, 126, 28, 126
add gingermaster fix method ratio, 25482136, 126, 28, 126
improve detection engine, 25482136, 126, 28, 126
update msign add tests, 25482136, 126, 28, 126
add makefile, 25482136, 126, 28, 126
update db, 25482136, 126, 28, 126
add golddream, 25482136, 126, 28, 126
add wat, 25482136, 126, 28, 126
update signature, 25482136, 126, 28, 126
change classsim threshold change geinimi signature, 25482136, 126, 28, 126
add libsign, 25482136, 126, 28, 126
add new android signatures, 25482136, 126, 28, 126
add msign update core, 25482136, 126, 28, 126
fix exceptions, 25482136, 126, 28, 126
python binding for libsign fix bug with dvmnative, 25482136, 126, 28, 126
update malwares signatures, 25482136, 126, 28, 126
add new signature, 25482136, 126, 28, 126
improve libdvm, 25482136, 126, 28, 126
improve permissions, 25482136, 126, 28, 126
improve permission by using google xml, 25482136, 126, 28, 126
fix different bugs improve similarity, 25482136, 126, 28, 126
add search packages/methods, 25482136, 126, 28, 126
up., 25482136, 126, 28, 126
change permissions, 25482136, 126, 28, 126
improve axml rename *_BCA, 25482136, 126, 28, 126
rename methods in APK improve permissions + names of classes, 25482136, 126, 28, 126
fix small bug, 25482136, 126, 28, 126
improve axml create apk module improve diff + similarity, 25482136, 126, 28, 126
improve diff + sim algorithm, 25482136, 126, 28, 126
Added some tests., 25482136, 126, 28, 126
update similarity update signature, 25482136, 126, 28, 126
reindent, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
begin androsim, 25482136, 126, 28, 126
up method2*, 25482136, 126, 28, 126
add more samples, 25482136, 126, 28, 126
improve diff algorithm improve database, 25482136, 126, 28, 126
fix bug with utf-8 in android binary xml, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
fix bug with struct add test for axml, 25482136, 126, 28, 126
add new pretty print fix bugs in dvm, 25482136, 126, 28, 126
add dot + png support, 25482136, 126, 28, 126
fix bug, 25482136, 126, 28, 126
Up, 25482136, 126, 28, 126
Added tests, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
remove Test invert args, 25482136, 126, 28, 126
fix invoke bugs, 25482136, 126, 28, 126
Added tests for numbers conversion, 25482136, 126, 28, 126
fix bug display, 25482136, 126, 28, 126
add snappy to libsimilarity, 25482136, 126, 28, 126
Up., 25482136, 126, 28, 126
Up, 25482136, 126, 28, 126
fix bugs add basic dot support, 25482136, 126, 28, 126
Up, 25482136, 126, 28, 126
add test, 25482136, 126, 28, 126
add example, 25482136, 126, 28, 126
fix dvm + jvm with pretty show, 25482136, 126, 28, 126
add pretty print color, 25482136, 126, 28, 126
1er commit decompilo, 25482136, 126, 28, 126
add entropy, 25482136, 126, 28, 126
add libxz, 25482136, 126, 28, 126
change lib, 25482136, 126, 28, 126
fix bug, 25482136, 126, 28, 126
add more tests, 25482136, 126, 28, 126
add new tests, 25482136, 126, 28, 126
update, 25482136, 126, 28, 126
find android permissions in dex file, 25482136, 126, 28, 126
add link between permissions + packages, 25482136, 126, 28, 126
add cPickle support, 25482136, 126, 28, 126
fix export bug, 25482136, 126, 28, 126
export classes/methods/classes into python namespace, 25482136, 126, 28, 126
remove matplot import needed libraries, 25482136, 126, 28, 126
update method analysis add external calls to androxgmml, 25482136, 126, 28, 126
add methods, 25482136, 126, 28, 126
update dalvik code, 25482136, 126, 28, 126
add androaxml, 25482136, 126, 28, 126
update docs, 25482136, 126, 28, 126
add external tool : AXMLPrinter2 add axml support in python, 25482136, 126, 28, 126
fix some errors, 25482136, 126, 28, 126
add androxgmml, 25482136, 126, 28, 126
begin xgmml support update protection, 25482136, 126, 28, 126
add test + remove private variables, 25482136, 126, 28, 126
update analysis + protection, 25482136, 126, 28, 126
update cfg, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
update analysis, 25482136, 126, 28, 126
update analysis + dvm + protection, 25482136, 126, 28, 126
update dvm operands, 25482136, 126, 28, 126
add android test case, 25482136, 126, 28, 126
remove ida add dex2java, 25482136, 126, 28, 126
up, 25482136, 126, 28, 126
add new test, 25482136, 126, 28, 126
update xml, 25482136, 126, 28, 126
update wm, 25482136, 126, 28, 126
improve watermark algorithm, 25482136, 126, 28, 126
update wm, 25482136, 126, 28, 126
update ants algorithm, 25482136, 126, 28, 126
update vm, 25482136, 126, 28, 126
update classification, 25482136, 126, 28, 126
update ncd with a cache, 25482136, 126, 28, 126
improve speed of signatures, 25482136, 126, 28, 126
update libncd, 25482136, 126, 28, 126
add signature class update ncd, 25482136, 126, 28, 126
update dalvik format, 25482136, 126, 28, 126
add zlib to libncd add pysco into bytecodes, 25482136, 126, 28, 126
add example of geinimi analysis, 25482136, 126, 28, 126
update libncd, 25482136, 126, 28, 126
remove raise ;), 25482136, 126, 28, 126
update doc, 25482136, 126, 28, 126
add disassembler example, 25482136, 126, 28, 126
fix bug with descriptor, 25482136, 126, 28, 126
update pretty show for java + dalvik, 25482136, 126, 28, 126
correct bug, 25482136, 126, 28, 126
update dalvik + jvm analysis, 25482136, 126, 28, 126
add links of instructions, 25482136, 126, 28, 126
update dex add bz2, 25482136, 126, 28, 126
add basic file for classification, 25482136, 126, 28, 126
remove gui files add ida files, 25482136, 126, 28, 126
begin package, 25482136, 126, 28, 126
add new attributes to jvm, 25482136, 126, 28, 126
add new samples + obfucated samples, 25482136, 126, 28, 126
update examples, 25482136, 126, 28, 126
update analysis, 25482136, 126, 28, 126
fix dvm bug, 25482136, 126, 28, 126
update jvm + dvm, 25482136, 126, 28, 126
add aapt update apk format, 25482136, 126, 28, 126
switch to ipython begin apk support, 25482136, 126, 28, 126
update analysis + add Lookup/Table switch in jvm module, 25482136, 126, 28, 126
update analysis and jvm code generation, 25482136, 126, 28, 126
update stack analysis, 25482136, 126, 28, 126
update analysis, 25482136, 126, 28, 126
update code analysis, 25482136, 126, 28, 126
add stack analysis, 25482136, 126, 28, 126
add basic androjdb update wm_l2, 25482136, 126, 28, 126
insert field more easily update watermark algorithm, 25482136, 126, 28, 126
update jvm analysis + watermarks, 25482136, 126, 28, 126
update wm l2, 25482136, 126, 28, 126
update analysis, 25482136, 126, 28, 126
update analysis fields + local variables, 25482136, 126, 28, 126
begin dependency fields, 25482136, 126, 28, 126
improve wm by using networkx, 25482136, 126, 28, 126
fix some bugs improve wm by testing new methods add CFG for jvm, 25482136, 126, 28, 126
update wm, 25482136, 126, 28, 126
update wm, 25482136, 126, 28, 126
clean wm, 25482136, 126, 28, 126
update wm, 25482136, 126, 28, 126
comment lupa, 25482136, 126, 28, 126
update doc, 25482136, 126, 28, 126
improve wm, 25482136, 126, 28, 126
update analysis jvm + dvm, 25482136, 126, 28, 126
improve wm, 25482136, 126, 28, 126
minor fix, 25482136, 126, 28, 126
add a simple test for watermark begin watermark algorithms, 25482136, 126, 28, 126
remove pylua (see lupa !), 25482136, 126, 28, 126
add basic lua binding, 25482136, 126, 28, 126
add androdump, 25482136, 126, 28, 126
Added tag alpha_0-update2 for changeset 5db0286ca849, 25482136, 126, 28, 126
improve the analysis speed of DVM, 25482136, 126, 28, 126
fix bugs in dalvik VM, 25482136, 126, 28, 126
improve DVM, 25482136, 126, 28, 126
add basic gui tests, 25482136, 126, 28, 126
fix bug in dvm instructions (thx sbz), 25482136, 126, 28, 126
fix bug into Field, 25482136, 126, 28, 126
fix bug into VM, 25482136, 126, 28, 126
obfuscation of names(fields/methods) works fix various bugs, 25482136, 126, 28, 126
add field/method names obfuscation into androguard, 25482136, 126, 28, 126
fix ugly thing with CONSTANT_Long/Double ...., 25482136, 126, 28, 126
add new Attribute, 25482136, 126, 28, 126
change android test, 25482136, 126, 28, 126
remove old java demos add java crypt demo to test androguard improve dvm, 25482136, 126, 28, 126
change java test improve dvm with more information into instructions, 25482136, 126, 28, 126
Added tag alpha_0-update1 for changeset bf266045550e, 25482136, 126, 28, 126
version aplha 0 update 1, 25482136, 126, 28, 126
improve wm, 25482136, 126, 28, 126
improve watermarking, 25482136, 126, 28, 126
fix bugs in API, 25482136, 126, 28, 126
change watermarks to android, 25482136, 126, 28, 126
move directory begin ant implementation add new functions, 25482136, 126, 28, 126
add VM into androlyze, 25482136, 126, 28, 126
add examples to test watermarks, 25482136, 126, 28, 126
add specs of dvm/jvm, 25482136, 126, 28, 126
fix demos, 25482136, 126, 28, 126
Added tag alpha_0 for changeset a5969b4fc301, 25482136, 126, 28, 126
first commit and it's the alpha 0, 25482136, 126, 28, 126
initial commit, 55993624, 492, 41, 492
Update README.md, 44109745, 3771, 502, 3771
Merge pull request #151 from google/manifest-inspection  Manifest inspection, 44109745, 3771, 502, 3771
updated system actions  * Updated system actions * Refactored table code, 44109745, 3771, 502, 3771
refactoring, 44109745, 3771, 502, 3771
cleaning, 44109745, 3771, 502, 3771
fixed manifest, 44109745, 3771, 502, 3771
added ascii map to APK dashboard, 44109745, 3771, 502, 3771
removed jack support  As jack was deprecated, 44109745, 3771, 502, 3771
added license, 44109745, 3771, 502, 3771
documentation fixes, 44109745, 3771, 502, 3771
tool versions, 44109745, 3771, 502, 3771
minor typo fix, 44109745, 3771, 502, 3771
merge fixes, 44109745, 3771, 502, 3771
Merge branch 'master' into manifest-inspection  # Conflicts: # ClassySharkWS/src/com/google/classyshark/silverghost/translator/apk/ApkT ranslator.java # ClassySharkWS/src/com/google/classyshark/silverghost/translator/apk/dash board/ApkDashboard.java, 44109745, 3771, 502, 3771
Merge pull request #150 from google/robustness-fixes  Robustness fixes, 44109745, 3771, 502, 3771
added another scenario for custom dex loading, 44109745, 3771, 502, 3771
non existing manifest elements, 44109745, 3771, 502, 3771
Merge branch 'master' into manifest-inspection, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge branch 'master' into manifest-inspection, 44109745, 3771, 502, 3771
Merge pull request #148 from google/daily-activations  Added activation tracking, 44109745, 3771, 502, 3771
implementation, 44109745, 3771, 502, 3771
Merge pull request #147 from bootstraponline/distZip  Add distZip task for creating releases, 44109745, 3771, 502, 3771
Add distZip task for creating releases, 44109745, 3771, 502, 3771
wording for Intent Service, 44109745, 3771, 502, 3771
Merge branch 'master' into manifest-inspection, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge branch 'master' into manifest-inspection, 44109745, 3771, 502, 3771
Merge pull request #146 from bootstraponline/build_gradle_ws  Add build.gradle for ClassySharkWS, 44109745, 3771, 502, 3771
Add build.gradle for ClassySharkWS, 44109745, 3771, 502, 3771
more BG services checks, 44109745, 3771, 502, 3771
added more approved actions, 44109745, 3771, 502, 3771
full implementation, 44109745, 3771, 502, 3771
Merge branch 'master' into manifest-inspection, 44109745, 3771, 502, 3771
Merge pull request #142 from google/jayce  Jayce format support, 44109745, 3771, 502, 3771
init drop, 44109745, 3771, 502, 3771
plumbing method pie view, 44109745, 3771, 502, 3771
updated the version number, 44109745, 3771, 502, 3771
init drop, 44109745, 3771, 502, 3771
bumped Android tool versions, 44109745, 3771, 502, 3771
Merge pull request #138 from google/sun-internal-inspections  implementation, 44109745, 3771, 502, 3771
drop, 44109745, 3771, 502, 3771
Merge pull request #136 from google/unsafe-inspection  Unsafe inspection, 44109745, 3771, 502, 3771
Delete ClassySharkPRD.pdf, 44109745, 3771, 502, 3771
Merge branch 'master' into unsafe-inspection, 44109745, 3771, 502, 3771
added unsafe inspection, 44109745, 3771, 502, 3771
Merge pull request #135 from dandv/patch-1  Fix typos improve lead paragraph, 44109745, 3771, 502, 3771
Fix typos improve lead paragraph, 44109745, 3771, 502, 3771
condition fix, 44109745, 3771, 502, 3771
added view pager indicator, 44109745, 3771, 502, 3771
Merge pull request #134 from vanniktech/add_moshi  Add Moshi to JavaDependenciesInspector  Thanks a lot @vanniktech, 44109745, 3771, 502, 3771
Add Moshi to JavaDependenciesInspector, 44109745, 3771, 502, 3771
Merge pull request #133 from google/duplicate-dependencies-inspector  Java dependencies inspector, 44109745, 3771, 502, 3771
naming fixes, 44109745, 3771, 502, 3771
small fixes, 44109745, 3771, 502, 3771
additional inspections, 44109745, 3771, 502, 3771
init drop, 44109745, 3771, 502, 3771
fixed command line build error, 44109745, 3771, 502, 3771
Merge pull request #132 from google/search-in-manifest  Search in manifest & APK dashboard fixes, 44109745, 3771, 502, 3771
code cleaning, 44109745, 3771, 502, 3771
custom dex loading: custom classes.dex shown in the APK dashboard view, 44109745, 3771, 502, 3771
added dex entries iterator, 44109745, 3771, 502, 3771
refactoring for dex iterator, 44109745, 3771, 502, 3771
minor fix for an un used variable, 44109745, 3771, 502, 3771
fix classes.dex numbering on the APK translator page, 44109745, 3771, 502, 3771
fix go to line bug & cleaning, 44109745, 3771, 502, 3771
fix null conditions, 44109745, 3771, 502, 3771
changed UX display for manifest searches, 44109745, 3771, 502, 3771
refactoring search in manifest changes, 44109745, 3771, 502, 3771
go to a selected line in manifest, 44109745, 3771, 502, 3771
fix empty lines clicks, 44109745, 3771, 502, 3771
fixed colouring, 44109745, 3771, 502, 3771
cleaning the manifest search additions, 44109745, 3771, 502, 3771
fix error for missing method, 44109745, 3771, 502, 3771
init drop, 44109745, 3771, 502, 3771
added ClassyShark PRD, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge pull request #123 from pedronveloso/patch-1  Update README.md, 44109745, 3771, 502, 3771
Update README.md  I've made a package to make it easy to install ClassySkark on Arch linux. Updating the Readme if you find it OK., 44109745, 3771, 502, 3771
Merge pull request #120 from google/synthetic-accessors  Synthetic accessors, 44109745, 3771, 502, 3771
variables naming fixes, 44109745, 3771, 502, 3771
API and cosmetic fixes, 44109745, 3771, 502, 3771
formatting the output of the synthetic accessors part, 44109745, 3771, 502, 3771
moved the multidex reading to one class, 44109745, 3771, 502, 3771
init drop + classes.dex names fixes, 44109745, 3771, 502, 3771
added custom dex condition + next version, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge pull request #116 from google/display-area-plugin  display area plug in, 44109745, 3771, 502, 3771
display area plug in, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge pull request #115 from google/classes-dex-file-size  fix https://github.com/google/android-classyshark/issues/110, 44109745, 3771, 502, 3771
fix https://github.com/google/android-classyshark/issues/110, 44109745, 3771, 502, 3771
Merge pull request #114 from andreban/tree-fix  Fix last package not making to list, 44109745, 3771, 502, 3771
Fix last package not making to list, 44109745, 3771, 502, 3771
bumped version number, 44109745, 3771, 502, 3771
Merge pull request #112 from google/custom-standard-multidex  added custom dex checking for mulitdex, 44109745, 3771, 502, 3771
added custom dex checking for mulitdex, 44109745, 3771, 502, 3771
Merge pull request #111 from google/soname-textrel-elf  fix bug https://github.com/google/android-classyshark/issues/109, 44109745, 3771, 502, 3771
fix bug https://github.com/google/android-classyshark/issues/109, 44109745, 3771, 502, 3771
fixed RetroLambda support and added case for manually stripped APK, 44109745, 3771, 502, 3771
Merge pull request #108 from google/is-multi-dex-api  Is multi dex api, 44109745, 3771, 502, 3771
added isMultiDex for APK, 44109745, 3771, 502, 3771
Merge branch 'master' into is-multi-dex-api, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge pull request #107 from google/priv-libs-flagger  native libs looking inspector, 44109745, 3771, 502, 3771
native libs looking inspector, 44109745, 3771, 502, 3771
Merge pull request #106 from google/all-native-depedendencies  ClassyShark shows all native dependencies in the APK page fixes bug  fix bug https://github.com/google/android-classyshark/issues/103, 44109745, 3771, 502, 3771
fix bug https://github.com/google/android-classyshark/issues/103, 44109745, 3771, 502, 3771
removed previous tokens mapper, 44109745, 3771, 502, 3771
Merge pull request #104 from google/plugins-full  implemented plugin system, 44109745, 3771, 502, 3771
implemented plugin system, 44109745, 3771, 502, 3771
Merge pull request #101 from chthai64/update-gradle-version  update gradle from 2.1.0-beta1 to 2.1.0, 44109745, 3771, 502, 3771
update gradle from 2.1.0-beta1 to 2.1.0, 44109745, 3771, 502, 3771
Merge pull request #100 from tiwiz/autoupdate_v2  Autoupdate v2, 44109745, 3771, 502, 3771
Fixes bug preventing the build of the app, 44109745, 3771, 502, 3771
Removes the GUI flag from the MessageRunnable  As the class is now only related to the GuiDownloader so it doesn't need to check for the GUI flag, 44109745, 3771, 502, 3771
Adds comments, 44109745, 3771, 502, 3771
Adds the cli changelog message  so that the users can decide if to avoid or not the update, 44109745, 3771, 502, 3771
Wires up the UpdateManger  so that it uses the new downloaders, 44109745, 3771, 502, 3771
Adds the command line downloader, 44109745, 3771, 502, 3771
Refactors the downloader  So that it can obtain also the filename when the file is downloaded, 44109745, 3771, 502, 3771
Starts refactoring updater so that it can have two algohrithms  One for GUI and one for CLI, 44109745, 3771, 502, 3771
Adds the update to the list of available params  for launching the jar, 44109745, 3771, 502, 3771
Changes error message, 44109745, 3771, 502, 3771
removed non null annotation for dependencies, 44109745, 3771, 502, 3771
minor fixes to auto uploader, 44109745, 3771, 502, 3771
Merge pull request #99 from tiwiz/autoupdate  Autoupdate, 44109745, 3771, 502, 3771
Makes a clearer update message, 44109745, 3771, 502, 3771
Skips the download if the same file is already present, 44109745, 3771, 502, 3771
Adds explanations on UpdateManager, 44109745, 3771, 502, 3771
Adds comments on Release file, 44109745, 3771, 502, 3771
Adds comments on GitHubApi file, 44109745, 3771, 502, 3771
Refactors names  so that they are clearer, 44109745, 3771, 502, 3771
Renames variable, 44109745, 3771, 502, 3771
Removes unused imports, 44109745, 3771, 502, 3771
Adds copyright, 44109745, 3771, 502, 3771
Adds easier way to track release, 44109745, 3771, 502, 3771
Code refactoring, 44109745, 3771, 502, 3771
Adds the new way of naming files  So that now they are downloaded directly as ClassyShark_YYYY_MM_DD.jar, 44109745, 3771, 502, 3771
Fixes message  When a new version has been downloaded, 44109745, 3771, 502, 3771
Adds a dialog informing the user about the updated  DO NOT MERGE - Dialog does not do anything yet, 44109745, 3771, 502, 3771
Hides the call to the update routine in the GuiMode and CliMode  so that the main class stays clear of the updates routines, 44109745, 3771, 502, 3771
Wires the things up for the autoupdate feature, 44109745, 3771, 502, 3771
Adds the callback for the release API, 44109745, 3771, 502, 3771
Fixes the visibility of GitHub API, 44109745, 3771, 502, 3771
Updates the model, 44109745, 3771, 502, 3771
Adds the update check in the main class, 44109745, 3771, 502, 3771
Adds networking APIs for retrieving the latest release version, 44109745, 3771, 502, 3771
Adds models for response, 44109745, 3771, 502, 3771
Adds networking libraries, 44109745, 3771, 502, 3771
Adds Gson and GsonConverter for Retrofit, 44109745, 3771, 502, 3771
Adds Retrofit library, 44109745, 3771, 502, 3771
Merge pull request #97 from andreban/res-fixes  Improve resources handling, 44109745, 3771, 502, 3771
Improve resources handling  - Improve highlighting - Fix bug of not showing the last resources   on the files tree, 44109745, 3771, 502, 3771
Merge pull request #96 from andreban/xml-res-highlight  Fix xmlDecompressor bug, 44109745, 3771, 502, 3771
Fix xmlDecompressor bug  - Decompressor had a bug for not using an unsigned byte when reading strlen. - Improved Highlighter for handling CDATA sections better., 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge pull request #95 from andreban/xml-resources  Xml resources, 44109745, 3771, 502, 3771
Fix CDATA Handling, 44109745, 3771, 502, 3771
Improve XML Resource parsing, 44109745, 3771, 502, 3771
Improved XML Parser, 44109745, 3771, 502, 3771
Add support for XML resources, 44109745, 3771, 502, 3771
Add references javadoc, 44109745, 3771, 502, 3771
Add support for XML resources, 44109745, 3771, 502, 3771
Add support for XML resources, 44109745, 3771, 502, 3771
Merge pull request #92 from google/integration-sherlock-hash  Integration sherlock hash, 44109745, 3771, 502, 3771
Merge branch 'master' into integration-sherlock-hash, 44109745, 3771, 502, 3771
updated the file search key, 44109745, 3771, 502, 3771
Merge pull request #91 from google/integration-sherlock-hash  Integration sherlock hash, 44109745, 3771, 502, 3771
UI panel fixes, 44109745, 3771, 502, 3771
integrated Sherlock hash, 44109745, 3771, 502, 3771
fix bug https://github.com/google/android-classyshark/issues/89, 44109745, 3771, 502, 3771
fix bug https://github.com/google/android-classyshark/issues/90, 44109745, 3771, 502, 3771
dark scheme fixes, 44109745, 3771, 502, 3771
minor fix setting toolbar colour be more contrast, 44109745, 3771, 502, 3771
next version preps, 44109745, 3771, 502, 3771
Merge pull request #87 from tiwiz/fixes-tree-node-theme  Fixes tree node theme, 44109745, 3771, 502, 3771
Fixes chart background, 44109745, 3771, 502, 3771
Fixes MethodsCount tree background, 44109745, 3771, 502, 3771
Merged branch master into master, 44109745, 3771, 502, 3771
Merge pull request #86 from tiwiz/dark-theme-fixes  Dark theme fixes, 44109745, 3771, 502, 3771
Fixes issue with light theme   as the right panel was showing a strange background on clss detail, 44109745, 3771, 502, 3771
Changes selection in Light theme mode, 44109745, 3771, 502, 3771
Adds cell renderer in order to show correctly the tree node colors, 44109745, 3771, 502, 3771
Merge pull request #4 from google/master  Updates repo, 44109745, 3771, 502, 3771
added bg default colour, 44109745, 3771, 502, 3771
Merge pull request #84 from tiwiz/theme-manager  Theme manager, 44109745, 3771, 502, 3771
Cleans up the code, 44109745, 3771, 502, 3771
Adds the possibility to change theme, 44109745, 3771, 502, 3771
Adds the Settings for the Theme  So that the user can change the theme from light to dark, 44109745, 3771, 502, 3771
minor fix, 44109745, 3771, 502, 3771
Merge pull request #83 from google/cli-refactoring  Cli refactoring, 44109745, 3771, 502, 3771
documenation, 44109745, 3771, 502, 3771
intro SilverGhostFacade so both CLI and Shark use the same apis, 44109745, 3771, 502, 3771
minor colors fix, 44109745, 3771, 502, 3771
Merge pull request #82 from google/proguard-integ  Proguard integ, 44109745, 3771, 502, 3771
revert dark colouring, 44109745, 3771, 502, 3771
Starts implementation of SettingsFrame, 44109745, 3771, 502, 3771
Adds callbacks for settings, 44109745, 3771, 502, 3771
Styles correctly the recent popup menu, 44109745, 3771, 502, 3771
Colors with a lighter gray the typing area, 44109745, 3771, 502, 3771
Adds setting button to the toolbar, 44109745, 3771, 502, 3771
Adds settings icon bindings, 44109745, 3771, 502, 3771
Adds settings icon, 44109745, 3771, 502, 3771
Changes background based on IntelliJ's, 44109745, 3771, 502, 3771
Colors the full UI, 44109745, 3771, 502, 3771
Colors methods count chart, 44109745, 3771, 502, 3771
Colors files tree, 44109745, 3771, 502, 3771
Colors text area for searches, 44109745, 3771, 502, 3771
Colors code area, 44109745, 3771, 502, 3771
Colors the toolbar, 44109745, 3771, 502, 3771
Adds Dark theme, 44109745, 3771, 502, 3771
Adds dark colors and icons, 44109745, 3771, 502, 3771
Fixes solarized syntax colors, 44109745, 3771, 502, 3771
Adds the ThemeManager to the package, 44109745, 3771, 502, 3771
Adds the possibility to apply the theme to a JComponent, 44109745, 3771, 502, 3771
Refactor code  Renames ThemeManager so that it better matches the idea of theme instead of theme manager, 44109745, 3771, 502, 3771
Fixes the LightThemeManager implementation  So that now everything depends on a generic ThemeManager, 44109745, 3771, 502, 3771
Changes visibility of the colors  So that they are only accessible from the LightThemeManager, 44109745, 3771, 502, 3771
Starts adding the theme manager  Changing the visibility of the direct implementations so that they are hidden from the main classes, 44109745, 3771, 502, 3771
Adds LightThemeManager  for managing correctly the colors, 44109745, 3771, 502, 3771
Merge branch 'master' into proguard-integ, 44109745, 3771, 502, 3771
Refactor code - 2  Renames the classes to better match the new system, 44109745, 3771, 502, 3771
Refactor code  So that icons and colors are in the theme, 44109745, 3771, 502, 3771
Adds ThemeManager interface  to start supporting the different themes of the UI, 44109745, 3771, 502, 3771
Merge pull request #3 from google/master  Updates repo, 44109745, 3771, 502, 3771
fixed typing area focus, 44109745, 3771, 502, 3771
Merge branch 'master' into proguard-integ, 44109745, 3771, 502, 3771
Merge pull request #81 from tiwiz/update-ui-proguard  Adds Proguard mapping icon, 44109745, 3771, 502, 3771
Adds Proguard mapping icon, 44109745, 3771, 502, 3771
Merge pull request #2 from google/master  Updates the repo, 44109745, 3771, 502, 3771
init dark colour scheme, 44109745, 3771, 502, 3771
Merge branch 'master' into proguard-integ, 44109745, 3771, 502, 3771
added proguard mapping class names init support, 44109745, 3771, 502, 3771
Merge pull request #80 from google/proguard-integ  Proguard integ, 44109745, 3771, 502, 3771
Merge branch 'master' into proguard-integ, 44109745, 3771, 502, 3771
Merge pull request #79 from google/proguard-integ  merge fixes + clean interfaces to SilverGhost, 44109745, 3771, 502, 3771
merging fixes for icons inside jar, 44109745, 3771, 502, 3771
Merge branch 'master' into proguard-integ, 44109745, 3771, 502, 3771
Merge pull request #78 from tiwiz/native-look-and-feel  Native look and feel, 44109745, 3771, 502, 3771
Merge pull request #1 from google/master  Updates repo from Google's version, 44109745, 3771, 502, 3771
Removes unused methods, 44109745, 3771, 502, 3771
Polishes Toolbar's border, 44109745, 3771, 502, 3771
Refines toolbar's typing area, 44109745, 3771, 502, 3771
Changes tabs names  so that they look more explicatives, 44109745, 3771, 502, 3771
Adds Solarized syntax highlight, 44109745, 3771, 502, 3771
Makes the history menu more native, 44109745, 3771, 502, 3771
Adds export button  and tooltip, 44109745, 3771, 502, 3771
Adds open button  and tooltip to explain the functionality, 44109745, 3771, 502, 3771
Adds next button  and tooltip text to show the functionality, 44109745, 3771, 502, 3771
Adds back button  and tooltip text, 44109745, 3771, 502, 3771
Adds Menu and History buttons  Taken from Material Design icons, 44109745, 3771, 502, 3771
names refactoring, 44109745, 3771, 502, 3771
optimised mappings reading, 44109745, 3771, 502, 3771
Cleans the UI  Removes customizations so that it looks more native, 44109745, 3771, 502, 3771
Replaces Metal Look & Feel  With system one so that on every platform the software looks more native, 44109745, 3771, 502, 3771
added UI flow, 44109745, 3771, 502, 3771
plumbing integration with pro guard, 44109745, 3771, 502, 3771
refactoring apis level, 44109745, 3771, 502, 3771
finished decoupling SilverGhost, 44109745, 3771, 502, 3771
Merge branch 'master' into proguard-integ, 44109745, 3771, 502, 3771
Merge branch 'master' into proguard-integ, 44109745, 3771, 502, 3771
decoupling SilverGhost from ClassySharkPanel, 44109745, 3771, 502, 3771
Merge pull request #76 from andreban/method-count-export  Add method count export, 44109745, 3771, 502, 3771
Add method count export  Method counts exportable though the Cli and on the Export button in the Gui, 44109745, 3771, 502, 3771
Merge pull request #75 from andreban/image-npe  Fix NPE for mouseMove without image, 44109745, 3771, 502, 3771
Fix NPE of mouseMove without image, 44109745, 3771, 502, 3771
Merge branch 'master' into proguard-integ, 44109745, 3771, 502, 3771
init drop, 44109745, 3771, 502, 3771
Merge pull request #74 from andreban/dex-magic  Handle large strings in XML Parser, 44109745, 3771, 502, 3771
Handle large strings in XML Parser, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge pull request #69 from google/dex-in-dex  Dex in dex, 44109745, 3771, 502, 3771
next version, 44109745, 3771, 502, 3771
added logic for viewing the inner classes.dex entry, 44109745, 3771, 502, 3771
init drop added reading and class showing  Missing dex parameters, 44109745, 3771, 502, 3771
Merge pull request #68 from google/drag-and-drop-file  Drag and drop file, 44109745, 3771, 502, 3771
cosmetic fixes, 44109745, 3771, 502, 3771
Merge branch 'master' into drag-and-drop-file, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge branch 'master' into drag-and-drop-file, 44109745, 3771, 502, 3771
Merge pull request #67 from andreban/chart-skip  Optimize chart to skip small packages, 44109745, 3771, 502, 3771
renaming, 44109745, 3771, 502, 3771
added test for un supported archives, 44109745, 3771, 502, 3771
Skipping very small packages, 44109745, 3771, 502, 3771
init drop, 44109745, 3771, 502, 3771
Merge pull request #66 from google/samples-plugins  Samples plugins, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge pull request #62 from keyboardsurfer/patch-1  Fix screenshot link, 44109745, 3771, 502, 3771
Fix screenshot link, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
init drop, 44109745, 3771, 502, 3771
add checks + error message on the command line, 44109745, 3771, 502, 3771
updated tools version, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
fixed typo in docs, 44109745, 3771, 502, 3771
Merge pull request #60 from google/programmable-api  Programmable api, 44109745, 3771, 502, 3771
changed API to Shark, 44109745, 3771, 502, 3771
implementation, 44109745, 3771, 502, 3771
updated command line reference usage, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
add command line reference, 44109745, 3771, 502, 3771
version 6.0 preps, 44109745, 3771, 502, 3771
Merge pull request #58 from andreban/chart-rover  Highlighting clickable pie chart areas, 44109745, 3771, 502, 3771
Highlighting clickable pie chart areas, 44109745, 3771, 502, 3771
back ported to Java 7, 44109745, 3771, 502, 3771
Merge pull request #56 from andreban/chart_click  Clicking on a class on the chart navigates to it, 44109745, 3771, 502, 3771
Clicking on a class on the chart navigates to it, 44109745, 3771, 502, 3771
version number 5.7, 44109745, 3771, 502, 3771
Merge pull request #55 from andreban/chart_quality  Optimize graphic rendering  quality, 44109745, 3771, 502, 3771
Optimize graphic rendering  quality, 44109745, 3771, 502, 3771
Merge pull request #54 from andreban/chart-hint  Added a hint on onMouseOver over the chart, 44109745, 3771, 502, 3771
Added a hint on onMouseOver over the chart, 44109745, 3771, 502, 3771
added so's file size and dex print for apis, 44109745, 3771, 502, 3771
version number for the next version, 44109745, 3771, 502, 3771
Merge pull request #53 from andreban/chart  Adds a method count chart, 44109745, 3771, 502, 3771
Adds a method count chart  Adds the method count chart to the right side of the methods count panel., 44109745, 3771, 502, 3771
Delete Intro.png, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
added version 5.5, 44109745, 3771, 502, 3771
Merge pull request #52 from google/method-dumper  Method dumper, 44109745, 3771, 502, 3771
added docs, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
init drop, 44109745, 3771, 502, 3771
minor fixes, 44109745, 3771, 502, 3771
cleaned git ignore, 44109745, 3771, 502, 3771
minor cleaning, 44109745, 3771, 502, 3771
moved reducer be part of UI, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge pull request #51 from google/all-dump-performance  implementation, 44109745, 3771, 502, 3771
implementation, 44109745, 3771, 502, 3771
Merge pull request #49 from google/doodles  added nice doodle support, 44109745, 3771, 502, 3771
init drop, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge pull request #48 from google/cli-fixes  Cli fixes, 44109745, 3771, 502, 3771
Rename GUIMode.java to GuiMode.java, 44109745, 3771, 502, 3771
added breaks to strings switch, 44109745, 3771, 502, 3771
fixes in cli mode, 44109745, 3771, 502, 3771
Merge pull request #47 from google/revert-46-chart  Revert "Added Chart to methods count", 44109745, 3771, 502, 3771
Revert "Added Chart to methods count", 44109745, 3771, 502, 3771
init drop, 44109745, 3771, 502, 3771
Merge pull request #46 from andreban/chart  Added Chart to methods count, 44109745, 3771, 502, 3771
Adjusted grpah panels to new class strutcture, 44109745, 3771, 502, 3771
First charts, 44109745, 3771, 502, 3771
First charts, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge pull request #45 from google/string-table-dump  String table dump, 44109745, 3771, 502, 3771
command line for dumping strings, 44109745, 3771, 502, 3771
implementation, 44109745, 3771, 502, 3771
fix https://github.com/google/android-classyshark/issues/43, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
update resources, 44109745, 3771, 502, 3771
quick fix file parsers selection, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge pull request #42 from google/aar-format  Aar format support, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
version number, 44109745, 3771, 502, 3771
fixed XML parsing and temp file removing, 44109745, 3771, 502, 3771
code cleaning, 44109745, 3771, 502, 3771
init drop, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge pull request #39 from google/click-on-lib  jar methods count, 44109745, 3771, 502, 3771
version cleaning, 44109745, 3771, 502, 3771
code and api cleaning, 44109745, 3771, 502, 3771
added methods counts per jar, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
ShellMode --> CliMode, 44109745, 3771, 502, 3771
repackaging Shell mode UI mode and SilverGhost, 44109745, 3771, 502, 3771
refactoring ==> consolidated binary formats to silverghost package, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge pull request #38 from google/so-viewing  elf browsing, 44109745, 3771, 502, 3771
licenses updated, 44109745, 3771, 502, 3771
Merge branch 'master' into so-viewing, 44109745, 3771, 502, 3771
added elf readers, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
added extract elf file, 44109745, 3771, 502, 3771
added 3rd party folder structure, 44109745, 3771, 502, 3771
Merge branch 'master' into so-viewing, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
basic flow implemented, 44109745, 3771, 502, 3771
created content reader, 44109745, 3771, 502, 3771
refactoring + Chirstmas edition, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Rename APKTranslator.java to ApkTranslator.java, 44109745, 3771, 502, 3771
Merge pull request #37 from google/apk-analyzer  Apk analyzer, 44109745, 3771, 502, 3771
page report design, 44109745, 3771, 502, 3771
init drop  added file read  avoid file name collisions  refactoring + libs inspection  Update README.md  Update README.md  Update README.md  moved to private files  Renamed packages tab  integrated APK analyser both command line and GUI  cleaning  versioning and cleaning, 44109745, 3771, 502, 3771
Merge pull request #35 from andreban/tabs  Tabs, 44109745, 3771, 502, 3771
Renamed packages tab, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Moved Analyzer to Tab, 44109745, 3771, 502, 3771
fixed wrong error handling from toolbar, 44109745, 3771, 502, 3771
Merge pull request #34 from andreban/analyzer  Added Analyzer, 44109745, 3771, 502, 3771
Changed Icon for Analyzer, 44109745, 3771, 502, 3771
Cleanup, 44109745, 3771, 502, 3771
Re-added LICENSE.txt, 44109745, 3771, 502, 3771
Added method count analyzer, 44109745, 3771, 502, 3771
Merge pull request #33 from google/file-in-ui-from-comand-line  File in ui from comand line, 44109745, 3771, 502, 3771
error s handling, 44109745, 3771, 502, 3771
minor cleaning, 44109745, 3771, 502, 3771
command line for dumping a specific class, 44109745, 3771, 502, 3771
added shell and ui modes, 44109745, 3771, 502, 3771
init drop, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
fix bug https://github.com/google/android-classyshark/issues/32, 44109745, 3771, 502, 3771
Merge pull request #31 from google/toolbar-ui-refactor  Toolbar ui refactor, 44109745, 3771, 502, 3771
added command line export, 44109745, 3771, 502, 3771
Merge pull request #30 from ReadmeCritic/master  Update README URLs based on HTTP redirects, 44109745, 3771, 502, 3771
Update README URLs based on HTTP redirects, 44109745, 3771, 502, 3771
cosmetic fix, 44109745, 3771, 502, 3771
cosmetic fix, 44109745, 3771, 502, 3771
cosmetic fix, 44109745, 3771, 502, 3771
added jar files data, 44109745, 3771, 502, 3771
cosmetic fixes, 44109745, 3771, 502, 3771
text processing cleaning, 44109745, 3771, 502, 3771
minor fixes, 44109745, 3771, 502, 3771
refactoring steamroller added controller interfaces, 44109745, 3771, 502, 3771
fix internal representation without class in the end, 44109745, 3771, 502, 3771
refactoring, 44109745, 3771, 502, 3771
refactoring, 44109745, 3771, 502, 3771
refactoring, 44109745, 3771, 502, 3771
refactoring, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
updated export functionality, 44109745, 3771, 502, 3771
updated animation, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
added export writer, 44109745, 3771, 502, 3771
updated animated gif, 44109745, 3771, 502, 3771
updated animated gif, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
refactoring +cleaning, 44109745, 3771, 502, 3771
updated ASM fallback and verifier, 44109745, 3771, 502, 3771
updated gitignore, 44109745, 3771, 502, 3771
cleaning, 44109745, 3771, 502, 3771
added (all file in archive dump) and (class dump), 44109745, 3771, 502, 3771
version number, 44109745, 3771, 502, 3771
swing updates for popup, 44109745, 3771, 502, 3771
cosmetic fix, 44109745, 3771, 502, 3771
robustness around open recents, 44109745, 3771, 502, 3771
refactoring, 44109745, 3771, 502, 3771
removed tabs, 44109745, 3771, 502, 3771
implementations, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge pull request #26 from dturner/master  Updated wording and added links, 44109745, 3771, 502, 3771
Updated wording and added links, 44109745, 3771, 502, 3771
fix https://github.com/google/android-classyshark/issues/24  added properties file, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
cleaned redundant folder, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
name changes, 44109745, 3771, 502, 3771
added dex hierarchical view, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge pull request #25 from googlesamples/multi-dex  Multi dex, 44109745, 3771, 502, 3771
cosmetic fix, 44109745, 3771, 502, 3771
added class description, 44109745, 3771, 502, 3771
minor fixes, 44109745, 3771, 502, 3771
added tree support + versioning, 44109745, 3771, 502, 3771
code cleaning, 44109745, 3771, 502, 3771
added dex info translator, 44109745, 3771, 502, 3771
updates, 44109745, 3771, 502, 3771
multi dex started to work, 44109745, 3771, 502, 3771
fixed bug https://github.com/googlesamples/android-classyshark/issues/22  updated gitignore, 44109745, 3771, 502, 3771
added Android manifest, 44109745, 3771, 502, 3771
Merge pull request #23 from andreban/truefalse  Improved XML parsing, 44109745, 3771, 502, 3771
Merge pull request #21 from andreban/ctrlc  Added ctrl+c cabability, 44109745, 3771, 502, 3771
Improved XML parsing  Correctly parsing 'true' 'false' and ints for attribute values on the binary Android manifest, 44109745, 3771, 502, 3771
Added ctrl+c cabability  Added capability to copy to text on the DisplayArea to be copied by using the ctrl/command + c shortcuts, 44109745, 3771, 502, 3771
added Android client, 44109745, 3771, 502, 3771
Merge pull request #19 from andreban/nopackage  Display classes without pkg, 44109745, 3771, 502, 3771
Display classes without pkg  Fixed not being able to display classes that live in the default package., 44109745, 3771, 502, 3771
Merge pull request #18 from andreban/xmldecompressor  Xmldecompressor, 44109745, 3771, 502, 3771
Merge branch 'master' of https://github.com/googlesamples/android-classyshark into xmldecompressor, 44109745, 3771, 502, 3771
Merge pull request #17 from andreban/xmlhighlighter  Added XmlHighligher, 44109745, 3771, 502, 3771
Added XmlDecompressor  Created a new XmlDecompressor that uses LittleEndianInputStream and reuses strings. It supports handling namespaces and CData. Also improved code readbility., 44109745, 3771, 502, 3771
Added XmlHighligher  Created a new regexp based XmlHighlighter that handles the highlighting independent from the formatting and allows to highlight attributes names and values, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Merge pull request #16 from googlesamples/controller  finished splitting the swing code into packages, 44109745, 3771, 502, 3771
sorting imports, 44109745, 3771, 502, 3771
fixed bug of default packages + new images, 44109745, 3771, 502, 3771
cosmetic fix, 44109745, 3771, 502, 3771
renaming fixes in Toolbar, 44109745, 3771, 502, 3771
added file name as title when the viewer is opened (without tabs), 44109745, 3771, 502, 3771
minor fix, 44109745, 3771, 502, 3771
full back scheme in experimental mode, 44109745, 3771, 502, 3771
default mode without tabs, 44109745, 3771, 502, 3771
refactoring repackaging + modules, 44109745, 3771, 502, 3771
fixing individual tab pane when opening file for a second time + version number update, 44109745, 3771, 502, 3771
renaming and cleaning, 44109745, 3771, 502, 3771
refactoring separating tree, 44109745, 3771, 502, 3771
added testing constructor per file, 44109745, 3771, 502, 3771
Merge pull request #15 from andreban/properencoding  Support for UTF-16, 44109745, 3771, 502, 3771
Support for UTF-16  Properly supporting UFT-16 when decoding the compressed XMLs., 44109745, 3771, 502, 3771
changed text of info button to " ? ", 44109745, 3771, 502, 3771
Merge pull request #14 from andreban/closeres  Improved closing resources on error, 44109745, 3771, 502, 3771
Improved closing resources on error  Resources were not being freed properly when issues reading the XML or the zipfile happened., 44109745, 3771, 502, 3771
renaming + fixes, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
updated the intro shot, 44109745, 3771, 502, 3771
Merge pull request #13 from andreban/xmlfix  Fixed support for large manifests, 44109745, 3771, 502, 3771
fixed issues around JTree packaging for jar and class files, 44109745, 3771, 502, 3771
Merge branch 'xmlfix' of https://github.com/andreban/android-classyshark into xmlfix, 44109745, 3771, 502, 3771
Fixed support for large manifests, 44109745, 3771, 502, 3771
Fixed support for large manifests, 44109745, 3771, 502, 3771
updates for next version, 44109745, 3771, 502, 3771
Merge pull request #12 from andreban/splitpane  Added JTree to make navigation easier, 44109745, 3771, 502, 3771
Cleaning up display area after load new file., 44109745, 3771, 502, 3771
Improvements o JTree displaying  Added a ToggleButton to hide the JTree. Changed the color of clicked buttons to gray. Updated the Font for the JTree., 44109745, 3771, 502, 3771
Better project navigation  Added a SplitPane and a JTree to improve the navigation inside the project., 44109745, 3771, 502, 3771
Merge pull request #11 from andreban/cdata  Fixed parsing CDATA on XML, 44109745, 3771, 502, 3771
Merge branch 'cdata' of https://github.com/andreban/android-classyshark into cdata, 44109745, 3771, 502, 3771
Fixed parsing CDATA sections  The parser was missing handling CDATA sections inside the AndroidManifest.xml. This patch fixes the parser but breaks the code highlighter for the AndroidManifest.xml. Removed the highlighter for the time being., 44109745, 3771, 502, 3771
Fixed parsing CDATA sections  The parser was missing handling CDATA sections inside the AndroidManifest.xml. This patch fixes the parser but breaks the code highlighter for the AndroidManifest.xml. Removed the highlighter for the time being., 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
added another fallback case for AndroidManifest, 44109745, 3771, 502, 3771
cleaning and setting next version number, 44109745, 3771, 502, 3771
Delete android-classyshark.iml, 44109745, 3771, 502, 3771
Merge pull request #10 from googlesamples/class-reader-jvm-fallback  fix bug https://github.com/googlesamples/android-classyshark/issues/5, 44109745, 3771, 502, 3771
finishing ASM and version, 44109745, 3771, 502, 3771
added methods, 44109745, 3771, 502, 3771
continue flashing the ASM filler, 44109745, 3771, 502, 3771
added meta object asm, 44109745, 3771, 502, 3771
added fallback for classes that can't be loaded due to dependencies in other archives, 44109745, 3771, 502, 3771
xml key colouring, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Delete Get Started.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
updated images to get started guide, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
cosmetic fix, 44109745, 3771, 502, 3771
fixed borders around toolbar, 44109745, 3771, 502, 3771
Merge pull request #6 from andreban/master  Added gap betwen DisplayArea and Toolbar, 44109745, 3771, 502, 3771
Added gap to DisplayArea, 44109745, 3771, 502, 3771
Merge pull request #1 from googlesamples/master  Rebasing from original repo, 44109745, 3771, 502, 3771
Merge pull request #4 from andreban/master  Resizing TabPane with the JFrame, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Resizing TabPane with the JFrame  The TabPane was not being resized so the content was centralized. Resizing makes it easier to see the content when lines are large on AndroidManifest.xml, 44109745, 3771, 502, 3771
Merge pull request #2 from sschuberth/patch-1  Minor typography improvements, 44109745, 3771, 502, 3771
Merge pull request #3 from rock3r/patch-1  Fix typos in README, 44109745, 3771, 502, 3771
Fix typos in README  Just a couple of minor fixes in the README file., 44109745, 3771, 502, 3771
Minor typography improvements, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
updated scenarious, 44109745, 3771, 502, 3771
Update Get Started.md, 44109745, 3771, 502, 3771
Update Get Started.md, 44109745, 3771, 502, 3771
Update README.md, 44109745, 3771, 502, 3771
first drop, 44109745, 3771, 502, 3771
Fix link in DSL docs for ExternalNativeBuildOptions, 40351551, 418, 71, 418
2.3.0 final, 40351551, 418, 71, 418
Add 2.3 docs, 40351551, 418, 71, 418
Final 2.2 docs, 40351551, 418, 71, 418
2.2 final docs, 40351551, 418, 71, 418
Add multidex-related items to the reference, 40351551, 418, 71, 418
Add new signing flags, 40351551, 418, 71, 418
Add 2.2 DSL and JavaDoc, 40351551, 418, 71, 418
Add a link for 2.1 javadoc, 40351551, 418, 71, 418
2.1 final, 40351551, 418, 71, 418
Add 2.1 DSL reference, 40351551, 418, 71, 418
Update HTML for "current" links, 40351551, 418, 71, 418
Update javadoc to 2.0 final, 40351551, 418, 71, 418
Change "current" to 2.0, 40351551, 418, 71, 418
Update 2.0 documentation to use final version number, 40351551, 418, 71, 418
Add a current link in javadoc/index.html, 40351551, 418, 71, 418
Add JavaDoc for 2.0, 40351551, 418, 71, 418
Add 2.0 DSL reference, 40351551, 418, 71, 418
Add links to javadoc, 40351551, 418, 71, 418
1.5.0 JavaDoc, 40351551, 418, 71, 418
Update "current" to be 1.5, 40351551, 418, 71, 418
1.5.0 DSL reference, 40351551, 418, 71, 418
misc fix to 1.5 javadoc., 40351551, 418, 71, 418
Fix main javadoc index file., 40351551, 418, 71, 418
remove transform-api folder., 40351551, 418, 71, 418
Update Javadoc for 1.5, 40351551, 418, 71, 418
Update Javadoc for 1.5, 40351551, 418, 71, 418
Update javadoc with beta4, 40351551, 418, 71, 418
Add 1.4.0 symlink., 40351551, 418, 71, 418
Update transform-api javadoc with HTML tags and more info., 40351551, 418, 71, 418
Update transform-api javadoc with updated Format enum., 40351551, 418, 71, 418
Update title to main javadoc page., 40351551, 418, 71, 418
Fix javadoc link and style., 40351551, 418, 71, 418
Javadoc for Transform-api 1.4, 40351551, 418, 71, 418
Don't use the micro version number.  This way links won't get out of date that easy., 40351551, 418, 71, 418
Fix 1.3 docs about custom runner args., 40351551, 418, 71, 418
1.4.0 docs., 40351551, 418, 71, 418
Add a link to index.html, 40351551, 418, 71, 418
Add README.md, 40351551, 418, 71, 418
Update after 1.3.0 release., 40351551, 418, 71, 418
Cleanup, 40351551, 418, 71, 418
Add LICENSE, 40351551, 418, 71, 418
Initial commit  DSL for 1.2.3 and 1.3.0-beta4 a "current" symlink and a very simple index page., 40351551, 418, 71, 418
Apply Apache 2.0 license to all source files using update-license.sh, 40154625, 7, 4, 7
Add Apache 2.0 license files, 40154625, 7, 4, 7
Updated to build tools 21.1.2 which is distributed with Android Studio 1.1 and also removed some unused dependencies and themes, 40154625, 7, 4, 7
Do not substract 1 because the number of nodes returned does not include the phone, 40154625, 7, 4, 7
Fix up override so it works with Void type, 40154625, 7, 4, 7
Center the registration code, 40154625, 7, 4, 7
Do not call await() if the connection to Play Services failed earlier, 40154625, 7, 4, 7
Reworked UI so that a code is generated and there is no need to enter an email address, 40154625, 7, 4, 7
Implement detection of Wear and the Android emulator, 40154625, 7, 4, 7
Clean up the layout and formatting, 40154625, 7, 4, 7
Removed unused features in the default provided template, 40154625, 7, 4, 7
Added rot13 generator for the email address entered, 40154625, 7, 4, 7
Generate basic Android Studio project, 40154625, 7, 4, 7
Initial repository, 40154625, 7, 4, 7
Remove internal reference.  PiperOrigin-RevId: 153614609, 41148494, 151, 30, 151
Open source emulated devices generation logic.  This change makes @android_test_support generate android_device rules for various emulator specifications as found in //tools/android/emulated_devices.  To use these devices from Bazel you will need to depend on the @android_test_support repository and then you can run a device like  bazel run @android_test_support//tools/android/emulated_devices/nexus_4:google_21_x86_qemu2  This will launch an x86 QEMU2 emulator with Android API 21 and the Google APIs.  PiperOrigin-RevId: 153522248, 41148494, 151, 30, 151
Make android_sdk_repository generate filegroups containing system image files for all android system images installed in the SDK. For system images that are not installed create genrule "poison pills" that print a helpful error message if you attempt to build them.  These filegroups are intended to be used as the system_image attribute of the android_device rule.  Example:  $ bazel build @android_test_support//tools/android/emulated_devices/pixel:android_25_x86 Extracting Bazel installation... . INFO: Found 1 target... ERROR: /usr/local/google/home/ajmichael/.cache/bazel/_bazel_ajmichael/efa32264346ef1fc4fec492202b88b31/external/androidsdk/BUILD.bazel:56:1: Executing genrule @androidsdk//:emulator_images_android_25_x86 failed: Process exited with status 1 [sandboxed]. This rule requires that the Android SDK used by Bazel has the following system image installed: emulator_images_android_25_x86. Please install this system image through the Android SDK Manager and try again.  RELNOTES: None  GOOGLE: These filegroups follow the naming convention in the existing //tools/android/emulated_devices/macros bzl files. PiperOrigin-RevId: 152889824, 41148494, 151, 30, 151
Switch to new syntax for loading BZL files in BZL files that will be open sourced.  Bazel's external repositories do not play well with the old path syntax.  PiperOrigin-RevId: 152876437, 41148494, 151, 30, 151
Cleanup: Migrate references from //net/util/python:portpicker to //third_party/py/portpicker.  The former is deprecated in favor of the latter.  Tested:     TAP --sample for global presubmit queue     http://test/OCL:151723549:BASE:151720709:1490897298229:377ff41e PiperOrigin-RevId: 152710874, 41148494, 151, 30, 151
Add NYCMR1DEV pastry.  PiperOrigin-RevId: 152468938, 41148494, 151, 30, 151
Fix xvfb filegroup dep on generated sdcard.  PiperOrigin-RevId: 152319525, 41148494, 151, 30, 151
Add google analystic for unified_launcher. Now it's very simple. Will try do add more dimensions later.  PiperOrigin-RevId: 152307277, 41148494, 151, 30, 151
Use the compressed sdcard image so that we don't have to checkin huge datafiles to version control. Unzip them on the fly using a genrule.  RELNOTES: None PiperOrigin-RevId: 152283388, 41148494, 151, 30, 151
Update adb.turbo binary.  PiperOrigin-RevId: 151898792, 41148494, 151, 30, 151
QEMU2 doesn't support "-gps" FLAG. Just remove it.  PiperOrigin-RevId: 151852979, 41148494, 151, 30, 151
Release new version of bootstrap.apk to include CR/151149157  PiperOrigin-RevId: 151783527, 41148494, 151, 30, 151
Include the files that are available in opensource otherwise these will be lost when we do a update next time around.  PiperOrigin-RevId: 151767531, 41148494, 151, 30, 151
Update the paths of adb.turbo, 41148494, 151, 30, 151
Delete unused file, 41148494, 151, 30, 151
Add the default sd card image file, 41148494, 151, 30, 151
Readd the deleted files, 41148494, 151, 30, 151
Don't disable hwcomposer module for API 25+. Otherwise emulator can't boot up.  PiperOrigin-RevId: 151733621, 41148494, 151, 30, 151
Create issue template, 41148494, 151, 30, 151
Adds "issues" to README, 41148494, 151, 30, 151
Merge pull request #1 from MichaelEvans/patch-1  Fix broken link to documentation page, 41148494, 151, 30, 151
Update README.md, 41148494, 151, 30, 151
Initial commit for master with license files and a README  Change-Id: I20610be37e79fdf330cd5af270558f748a6e405c, 41148494, 151, 30, 151
Initial empty repository, 41148494, 151, 30, 151
Data Binding List demo.  This demo shows how to use data binding to bind items to a ViewGroup so that Views are added and removed dynamically.  Change-Id: Ifeea44dce4f6b962a0967124243682897aa31652, 53449780, 983, 152, 983
Move transitions demo to Transitions/SimpleTransition  Change-Id: I0d59da6d898d7796bcafcf087637b71b00a39d99, 53449780, 983, 152, 983
Adding Support Library Transitions demo  Change-Id: Ia228184de8a594b5c1a2fca39b92ef3420aaa672, 53449780, 983, 152, 983
Initial checkin of InterpolatorPlayground  Change-Id: I170737f8bfd3a7a538b4a214c37cfc6835f6a01f, 53449780, 983, 152, 983
add more details to the readme., 53449780, 983, 152, 983
move readme into the app  Change-Id: I8919af092db2e409dbdbad59e1c82b96916b0a76, 53449780, 983, 152, 983
add data binding readme  Change-Id: I022595b9c6a726a1a03aa500226b55e4f8d8a30b, 53449780, 983, 152, 983
Introduce mixed adapter  Change-Id: Ib63cfeef21b7c5b0b41cd4e7c4b75e6a7a1fc3d7, 53449780, 983, 152, 983
WIP simple data bound adapter  Change-Id: I473a019481b45e389be1c4f5d0c21d3fae724b27, 53449780, 983, 152, 983
Add contributing.md  Change-Id: I314895d5483c2cc1fc3c7e30a70dad172ce79e56, 53449780, 983, 152, 983
Add license update README  Change-Id: I7b6dda59e61692c47d2067a4451aa72862dfc253, 53449780, 983, 152, 983
Add RecyclerViewAnimations demo  Change-Id: I0c361d573de043bec967b04d0106303c45bda5c1, 53449780, 983, 152, 983
added README, 53449780, 983, 152, 983
Create README for wear stitch script  Change-Id: I6883e17b92c161ca1438ce8d4c6c701857dce3de, 91617355, 1, 0, 1
Add go/wear-stitch to devrel git repo ready for open-sourcing  Wear stitch is a tool for capturing screenshots of watch UIs. It takes multiple screenshots and joins them together guessing a color for any pieces that were off-screen.  Change-Id: I21e7842a4901e29adbc0f18c721b0123c0d1ef61, 91617355, 1, 0, 1
Initial empty repository, 91617355, 1, 0, 1
WebGL2 Compat: having no 0 divisor is now valid  BUG=angleproject:TBD  Change-Id: Icb19a685290f4313ad567391cab5152eda91a346 Reviewed-on: https://chromium-review.googlesource.com/544545 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
GL: Don't call seamless cube cap on GLES.  This cap is only valid on desktop GL. There might be extensions where the feature is available as well so we should follow up and check for the extensions as well.  This fixes a Debug runtime warning in almost every end2end_test on GLES.  BUG=angleproject:2085  Change-Id: I5edc1c667b58230df903da82de2a8aceb0369c0c Reviewed-on: https://chromium-review.googlesource.com/546597 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix uint indices WebGL test to draw something.  This test was specifying a draw with two indices instead of six. This wasn't producing any error on most configurations but on Android it was producing a driver error that was only visible in Debug.  BUG=angleproject:2086  Change-Id: I7c3cee4cc10d6c37e3bac8ed9fbc16ecb2cb9e63 Reviewed-on: https://chromium-review.googlesource.com/546539 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Don't use constexpr pair constructor in translator.  Although this seems to compile and pass on our bots the std::pair constructor with arguments is not constexpr until c++14. Instead use a helper struct which achieves the same goal.  BUG=chromium:697758  Change-Id: I0f9873729485a5059f79af969cb56f84706e6c98 Reviewed-on: https://chromium-review.googlesource.com/545796 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add guards around dxgi_support_table.h.  BUG=angleproject:2082  Change-Id: I6f20502bac3c664d5ef8c6d65b244c37a5727f26 Reviewed-on: https://chromium-review.googlesource.com/545458 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Consolidate TypedResourceManager::isXGenerated.  BUG=angleproject:1458  Change-Id: Ib5c561610ab6dbcf0f65d915dfe8a8ca21ebe7f3 Reviewed-on: https://chromium-review.googlesource.com/544683 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Perform all glXMakeCurrent in DisplayGLX  This allows caching the current surface more efficiently than at the egl layer because we can take advantage of having only one backing context.  BUG=angleproject:1651  Change-Id: I62867b16ac5e06901a988dc41a3d4812accdb74c Reviewed-on: https://chromium-review.googlesource.com/543835 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Perform all wglMakeCurrent calls from DisplayWGL.  Display WGL is the best place to track the currently bound surfaces and contexts and cache them appropriately.  This results in a ~40% speed increase in the WebGL Aqarium demo because wglMakeCurrent is now only called once at initialization.  BUG=angleproject:1651  Change-Id: I61132bb4a0db8de592600173c20787c67d18e067 Reviewed-on: https://chromium-review.googlesource.com/543583 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Only use the last context for the texture completeness cache.  The frequency of contexts switches is very slow compared to draw calls. Instead of doing a map lookup only store the completeness cache for the last context used with the texture.  BUG=angleproject:2078  Change-Id: Ia24c891e1b5781b61fd463ce70e90d4b394c6f8a Reviewed-on: https://chromium-review.googlesource.com/542946 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
ES31: Add support for bindImageTexture on GL backend  This patch refers to https://chromium-review.googlesource.com/c/380636/  BUG=angleproject:1987  Change-Id: If621eed6ecaa7298214843a2a133801ca1487b03 Reviewed-on: https://chromium-review.googlesource.com/462088 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor uniform block binding  Remove mUniformBlockBindings and move its bindings to mUniformBlocks.  BUG=angleproject:1442  Change-Id: I62b4471990a44e626d2357c41cb914abc27cb18f Reviewed-on: https://chromium-review.googlesource.com/532834 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Only apply attachments that are written by the program  This works around a bug in the AMD driver that writes 0's to the first attachment if it isn't written by the pixel shader.  BUG=angleproject:2048  Change-Id: I384fd60c0e0a37fbc0fd7b69fe1ec74fe4ffac8f Reviewed-on: https://chromium-review.googlesource.com/531630 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Remove most of the remaining logic from glslang.y  Move most of the logic in glslang.y to ParseContext. This will make it easier to change the code in the future.  Only a few specific bits of logic are kept in glslang.y:  * Disabling a parsing rule when a given shading language version is   being parsed. This makes it easier to check the grammar against the   grammar in the GLSL ES specs. * Scoping calls that need to be paired with another call. It's much   easier to check these for correctness when the paired calls are next   to each other.  BUG=angleproject:911 TEST=angle_unittests  Change-Id: I52f42a1fc0f28463ca4b237dc6e88345e5173064 Reviewed-on: https://chromium-review.googlesource.com/539640 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Use the std::unordered_map::at method instead of operator[].  It is known that the entry exists in the map the at operator is slightly faster in this case.  BUG=angleproject:2079  Change-Id: I3a64212293fa0320f3df5327e92d11eb7ef28c4f Reviewed-on: https://chromium-review.googlesource.com/543683 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix invalid storage recovery on FL 9_3.  This problem was uncovered when I inadvertently changed TextureD3D to delete its storage before its images. Small mips of compressed textures must use a nullptr argument to CopySubResource otherwise the runtime complains about un-aligned sizes.  Also change the class to delete the Images before the Storage again so we don't wastefully recover the images before deleting them. Also change the Image pointers to use std::array and std::unique_ptr.  BUG=angleproject:1156 BUG=angleproject:2077  Change-Id: Idb2e53835b7a9b973285ff0781f70b25f05c77aa Reviewed-on: https://chromium-review.googlesource.com/543438 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix incorrect format set being used for destination copy formats.  This validation matches Chrome's.  BUG=angleproject:1932  Change-Id: I2dc75c21924231ab75000dff92ef92cbc12adf55 Reviewed-on: https://chromium-review.googlesource.com/538956 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Accept GL_FRAGMENT_SHADER_DERIVATIVE_HINT in ES3 contexts.  BUG=angleproject:2070  TEST=deqp/functional/gles3/shaderderivate_dfdx TEST=deqp/functional/gles3/shaderderivate_dfdy TEST=deqp/functional/gles3/shaderderivate_fwidth  Change-Id: I4e10343036a813c122ca41913324051b5c02e785 Reviewed-on: https://chromium-review.googlesource.com/538861 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix parsing GLSL loop conditions that declare a variable  Now the variable declaration is included in the AST so that the loop body may refer to the variable. The variable declaration is placed in a block that wraps the loop. This way we can still only have TIntermTyped loop conditions in the AST which keeps the code dealing with loops fairly simple and type safe.  This change includes reversing the return value of executeInitializer so that it returns true on success and false on error. This is more in line with other ParseContext member functions.  BUG=angleproject:2073 TEST=angle_end2end_tests  Change-Id: I5c4ecbf1b438d3fff6d6237c0dcf191e2a19664c Reviewed-on: https://chromium-review.googlesource.com/539639 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix missing return statement in VertexFormat validation.  BUG=angleproject:2063  Change-Id: Idc1c7b42ed0a2545d9ad4f3c645d0dea2c85c11e Reviewed-on: https://chromium-review.googlesource.com/533273 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Proliferate gl::Context everywhere.  This gives the D3D back-end access to the GL state almost anywhere. This uses the onDestroy hook for Textures to push errors up from destructors although they still don't quite make it to the Context.  There are places such as in EGL object (Context/Surface) destruction where we end up calling through to GL implementation internals without having access to a gl::Context. We handle this via a proxy Context to a Display basically a null context that has access to impl-side state like the Renderer pointer if necessary. It does not have access to the normal GL state.  Also Pass gl::Context to RefCountObject::release(). Since we're using destroy() methods now we should not ever call the destructor directly.  BUG=angleproject:1156  Change-Id: Ie4c32ad6bf6caaff0289901f30b5c6bafa2ce259 Reviewed-on: https://chromium-review.googlesource.com/529707 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Optimize builtin function emulator class.  This refactor uses a generator to produce static arrays instead of using a bunch of std::map inserting statements. It speeds up shader translation because every shader compile would create and tear down this table.  Currently it is implemented as a flat array but in the future we could use compile-time hashing to implement faster lookup.  BUG=chromium:697758  Change-Id: I689f7de4d9b2c8c76095bb313f4c040116fc61d2 Reviewed-on: https://chromium-review.googlesource.com/521226 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Allow '\' characters in shader source for WebGL2.  TEST=deqp/data/gles3/shaders/preprocessor.html  BUG=angleproject:2016  Change-Id: Ia5240a1ff65ebadc15604a5c3eb63042953c43a5 Reviewed-on: https://chromium-review.googlesource.com/540198 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
WebGL Compat: forbid client side arrays even unused  BUG=angleproject:2064  Change-Id: I9a9c2df9a158799dbdc490446352cdf30fb87ca6 Reviewed-on: https://chromium-review.googlesource.com/537812 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix kResourceTypeNames initialization  Due to a missing comma the kResourceTypeNames array contained a single long (concatenated) string instead of NumResourceTypes independent strings.  This incorrect initialization caused a crash in out-of-memory situations but this was only noticed on VC++ 2017 for some reason.  This fix adds the missing comma and uses a static_assert to ensure that the array is initialized correctly.  BUG=chromium:727671728226731089  Change-Id: I9f0f3d3725b9f773505506513afb6c349db3a7fb Reviewed-on: https://chromium-review.googlesource.com/539536 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't expose non-conformant multisampling modes on GL  Some NVIDIA GL drivers expose non-conformant multisampling modes. The conformance of multisampling modes can be queried using the extension NV_internalformat_sample_query. Use it to filter out the non-conformant modes from the modes that are exposed by ANGLE.  The MAX_SAMPLES value and other similar values stored in caps also need to be lowered to match the maximum number of samples exposed for required formats.  There seems to be an NVIDIA driver bug related to querying STENCIL_INDEX8 multisample format. Work around this by querying DEPTH24_STENCIL8 instead.  There's also some confusion around whether RGB9_E5 should be renderable. Once the floating point texture extensions got rolled into the core GL spec it was eventually made clear that RGB9_E5 is intended not to be renderable. The extension specs that predate float textures in the core spec do suggest that it would be renderable but in practice drivers that advertise the extension strings don't reliably implement RGB9_E5 as renderable. Solve this by disabling it as a renderable format and adding an explanatory comment.  BUG=chromium:682815 TEST=angle_end2end_tests      dEQP-GLES31.functional.state_query.internal_format.renderbuffer.*  Change-Id: I2218e3a23ea7b48a0615fea77a91897dc7d5fe9e Reviewed-on: https://chromium-review.googlesource.com/525515 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
D3D11: Fix mingw64 build.  Two small build errors were breaking ming64.  BUG=angleproject:2071  Change-Id: Ia5c8e629e77c09f151b888364e92475b4c3f1709 Reviewed-on: https://chromium-review.googlesource.com/539796 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Track LevelInfoGL per cube map face.  When transitioning between formats in cube maps tracking of luma workaround information would become incorrect because it was only tracked per-level.  There are no failing tests due to this because once the cube map is complete again the tracking is correct.  TEST=conformance/more/conformance/quickCheckAPI-S_V.html  BUG=angleproject:2074  Change-Id: If4e1e94061208f0cf3668b2bd6be59a9a21e42b6 Reviewed-on: https://chromium-review.googlesource.com/539956 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Proliferate gl::Context.  This enables a few small things: it will enable making the platform a property of the Display rather than a global. The same goes for the global logging annotator. Also it ensures all back-end implementations have access to the GL / EGL state when available.  Also introduces a smart pointer helper class to angleutils for objects that prefer to be destroyed with a context (gl::Context/egl::Display) parameter. We were using std::unique_ptr in a few places that would not work well with these objects.  BUG=angleproject:1156  Change-Id: I59e288a3d6f766ff8a0f4b48ff3a1fbf7489daba Reviewed-on: https://chromium-review.googlesource.com/529706 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Context: Bind current display/surface.  Looking at the EGL spec it says for eglGetCurrentDisplay:  "The display for the current context in the calling thread for the current rendering API is returned."  This implies that MakeCurrent binds a display to a Context. There's also pretty clear language for the read/draw Surface as well that they can only be bound to one Context/thread at a time. Hence we don't need to duplicate this storage in the egl::Thread structure merely storing a pointer to the current Context which has access to the read/draw Surface and current Display.  BUG=angleproject:1156  Change-Id: Ia3b99d50b3591012c43e851834c1af02ff62a33f Reviewed-on: https://chromium-review.googlesource.com/538865 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Clean up ValidateOutputs  Remove the validateOutputs method from Compiler and replace it with a static method alongside the traverser. This encapsulates the ValidateOutputs implementation better.  TEST=angle_unittests BUG=angleproject:2068  Change-Id: I1788cb9726db41ca35fd0e746f8d48ced7fee74f Reviewed-on: https://chromium-review.googlesource.com/535477 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Generate INVALID_OPERATION when the copy texture destination level is missing.  TEST=conformance2/textures/misc/tex-image-with-bad-args-from-dom-elements  BUG=angleproject:1932  Change-Id: I6e0e9213d86a72aa092131189ecaefa60afa4194 Reviewed-on: https://chromium-review.googlesource.com/538864 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement EGL_KHR_surfaceless_context for D3D GL and NULL backends.  Skip all config attributes that have the value of EGL_DONT_CARE.  From the EGL 1.5 spec: "If EGL_DONT_CARE is specified as an attribute value then the attribute will not be checked.".  BUG=angleproject:1651  Change-Id: I30c95a1970543fb6f1d4b02d2babf3df61cad543 Reviewed-on: https://chromium-review.googlesource.com/533937 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Rename EOpFaceForward to EOpFaceforward.  This mirrors the spec naming and makes auto-gen a little easier.  BUG=chromium:697758  Change-Id: I9bcbc2c874b9a93a6d542aedf2b239f01ee708ce Reviewed-on: https://chromium-review.googlesource.com/526393 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor ProgramBinary entry points.  These will need to set dirty bits for the program and this is best  done via the Context.  BUG=angleproject:747  Change-Id: I1379d2d4be0e94206c0aa7cb1546aa1a591f23ff Reviewed-on: https://chromium-review.googlesource.com/529767 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix scanForWantedComponents not ignoring attribute values of 0.  Slightly refactor scanForWantedComponents to not iterate over every attribute and only check the needed ones.  BUG=angleproject:2069  Change-Id: I77bab7764552093f79472809aad3594be351831a Reviewed-on: https://chromium-review.googlesource.com/537132 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Allow CHROMIUM_copy_texture to copy to non-zero mips.  Fix some errors in the GL backend related to source and destination mipmap targets.  BUG=angleproject:1356  Change-Id: I030529c8626f3bc30dbb4f7f859a02ba56e315e3 Reviewed-on: https://chromium-review.googlesource.com/527653 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make distinct header guards for anglebase.  BUG=angleproject:2065  Change-Id: I7783d4866a2e16e0cee79aecccb6d5ee1b74165d Reviewed-on: https://chromium-review.googlesource.com/533724 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Shunt more code to StateManager11.  Previously the Renderer11 would call directly into the state manager sync methods. Instead make a single updateState method and make several state sync methods private to the manager. Also rename them to clarify they're for syncing state not for direct use.  BUG=angleproject:1156  Change-Id: I94880a744e7ade3895fa2a312a2436ba4ef38dba Reviewed-on: https://chromium-review.googlesource.com/529705 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move the vk Serial class to renderer_utils.  This can be useful for other back-ends for various types of state management. Also redesign the class to use an opaque factory instead of an increment operator. The class maintains the property of being ordered. Also assume we don't overflow with 64-bit serials. We could maybe redesign this to use 32-bit serials for memory constrained situations and handle overflow more gracefully.  I plan to use the serials to track state revisions for the vertex array class to avoid doing redundant work.  BUG=angleproject:1156  Change-Id: I02c78b228bc6e2fb3ee786fe67a4e607baaca18e Reviewed-on: https://chromium-review.googlesource.com/529704 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Apply a non-null blendstate in masked depth clear.  In https://chromium-review.googlesource.com/c/453888/ we changed how blendstates were applied in masked clears. This change would apply a null blendstate when all color channels were disabled but this seems to have an issue on Intel Cherry View drivers. Work around this issue by restoring the prior functionality of making a simple masked blend state.  Also clean up some of the code style in the Clear11 class.  BUG=chromium:730126  Change-Id: I9a4044201b2f07e9483525513a59e19bb2a8bcd3 Reviewed-on: https://chromium-review.googlesource.com/533684 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
When validating image size use format for SubImage calls.  internalFormat is GL_NONE when validating these calls for glTexSubImage and leads to an expected minimum size of 0.  Add extra unsized formats that are never supported to the format tables. These are needed for determining the size of input data.  BUG=angleproject:2054  Change-Id: Ic827a279a246ff92c9f279232574521692b1c6f2 Reviewed-on: https://chromium-review.googlesource.com/526356 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Attempt to fix gyp build RangeChecks error.  This puts explicit dependencies from white_box_tests and perftests on libANGLE. There may be one or two other places where it is necessary.  BUG=None  Change-Id: Iaa7ea2cade8313c00a396a38f99b5bc8006105db Reviewed-on: https://chromium-review.googlesource.com/533676 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use HashingMRUCache in InputLayoutCache.  This simplifies the state management code inside this manager. Also it should improve the speed of lookups due to using hashing instead of a tree lookup.  BUG=angleproject:1156 BUG=angleproject:2044  Change-Id: I19ea8dbac6f2dfd7d30dd403d77b66ba0aa85d73 Reviewed-on: https://chromium-review.googlesource.com/527693 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove Shader::getSemanticIndex.  This method doesn't really belong to GL and was only used by the D3D back-end to compute some attribute indexes. Simplify the code by moving it into ProgramD3D. Also add the ability for the ShaderImpl to assert that any pending compiles have resolved.  BUG=angleproject:1156  Change-Id: I0af3d3082ff8c908e6a87b9734989efbefd28808 Reviewed-on: https://chromium-review.googlesource.com/526336 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Clean up coding style issues in InstancingTest.cpp  This patch intends to clean up all coding style issues in InstancingTest.cpp. 1. Replace SHADER_SOURCE by std::string 2. Use (expected actual) as the order of the parameters    in ASSERT_NE 3. Replace C-style type cast operators into C++ ones. 4. Use ANGLE_GL_PROGRAM to build shader programs 5. Use constexpr when necessary 6. Other format changes done by 'git cl format'  BUG=angleproject:2005  Change-Id: I37d866c5df681160a66226bf5927dd6e00a6d6b2 Reviewed-on: https://chromium-review.googlesource.com/528649 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Make VertexBinding's member variables private  The patch decorates all members in VertexBinding as private and limits access to them only through getters and setters. This makes it easier to debug and keep track of any assignments to the class members.  BUG=angleproject:2062 TEST=angle_end2end_tests  Change-Id: Iddd49063d060f136bc9cf11c313a5af0931d433c Reviewed-on: https://chromium-review.googlesource.com/530786 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Decouple ANGLETest functionality and test parameters  ANGLETest provides useful functionality for end2end tests but it cannot be used for tests which take other test parameters than the platform. The patch introduces another level of abstraction by moving all of ANGLETest's functionality to another class - ANGLETestBase - which does not inherit from ::testing::TestWithParam<>. New tests can either inherit from ANGLETest as before to have only platform parameters or they can inherit from ANGLETestBase and add handling of custom test parameters.  Example:  // The new parameter type must inherit from PlatformParameters. struct MyCustomParameters : PlatformParameters {     bool mWorkaroundState; };  class MyTest : public ANGLETestBase                public ::testing::TestWithParam<MyCustomParameters> {     protected:     void overrideWorkaroundsD3D(         angle::WorkaroundsD3D *workaroundsD3D) override     {         workaroundsD3D->myCustomWorkaround = GetParam().mWorkaroundState;     }  };  ANGLE_INSTANTIATE_TEST(MyTest MyCustomParameters(ES3_D3D11() false)                                MyCustomParameters(ES3_D3D11() true));  BUG=angleproject:2062 TEST=angle_end2end_tests  Change-Id: Ia36e429cff8c4c291fc87a286a1d1a3004d6fad6 Reviewed-on: https://chromium-review.googlesource.com/530945 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix RewriteElseBlocks using a non-prefixed struct name  RewriteElseBlocks used to have an issue where it could add an unprefixed struct name to the AST in a TIntermRaw node as opposed to the prefixed name that the struct would be defined with. Use a proper return statement node instead of a raw node to fix this issue and make the code more robust.  BUG=angleproject:2061 TEST=angle_unittests  Change-Id: I3993b5093646983f038268f3a5ffe26ccdae66e8 Reviewed-on: https://chromium-review.googlesource.com/530785 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Introduce MemoryProgramCache.  This class will manage GPU binary programs in memory. It will be owned by the Display and shared between Contexts. Currently this CL just refactors the Program binary saving and loading into static members of this new class.  BUG=angleproject:1897  Change-Id: I34f5afb2c02416f6fd80dd65ba3827a8637ce190 Reviewed-on: https://chromium-review.googlesource.com/522873 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Move LinkResult to the gl:: namespace.  This is a derived type from gl::Error so makes sense to be there. Also makes it more accessible than in ProgramImpl.h  BUG=angleproject:1897  Change-Id: Id41b13e5a072745d8c361057f5bef8f152e0452b Reviewed-on: https://chromium-review.googlesource.com/522872 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't allow for error in ProgramImpl::save.  Refactoring cleanup patch only.  BUG=angleproject:1897  Change-Id: I6d12de5dab16ead9684886a1cf15b570e3c98156 Reviewed-on: https://chromium-review.googlesource.com/522871 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Introduce SizedMRUCache.  This class is an MRU cache for sized objects like Textures or Program binaries. It is based on the base::HashingMRUCache type and evicts objects automatically.  BUG=angleproject:2044  Change-Id: I83859a0388f984e872fb9209e4c9efbf5d6c93f1 Reviewed-on: https://chromium-review.googlesource.com/517380 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ProgramD3D: only broadcast when the GL_EXT_draw_buffers is enabled  The behavior is undefined in GL ES when multiple attachments are used with gl_FragColor but WebGL clarifies that:  - If the extension is enabled broadcast happens  - If the extension isn't enabled only the first attachment is written  BUG=angleproject:2048  Change-Id: I6d85ba91df77d42fb8863a03f1faa006cd7817bf Reviewed-on: https://chromium-review.googlesource.com/523809 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Move murmurhash to src/common/third_party  Bug: chromium:697758 Change-Id: I8a3a990b14cde0fdd45319d593040bfc571abf3e Reviewed-on: https://chromium-review.googlesource.com/527602 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add WebGL test that draws to missing attachment.  In WebGL one can Clear DrawArrays and DrawElements to a framebuffer with a missing attachment with no error.  BUG=angleproject:1822  Change-Id: I4dece2fa8fad31c812e24ae18bdc380c2857a1f8 Reviewed-on: https://chromium-review.googlesource.com/502967 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
ES31: Add atomic counter for GLSL parsing  This makes shader compiler support the new basic type 'atomic_uint' and validate its layout qualifiers properly.  BUG=angleproject:1729 TEST=angle_unittests:AtomicCounterTest      angle_deqp_gles31_tests:dEQP-GLES31.functional.atomic_counter.layout.invalid*      angle_deqp_gles31_tests:dEQP-GLES31.functional.debug.negative_coverage.*.atomic*  Change-Id: Ia237eadf6ea72314f436a0abbb93a05598e71eba Reviewed-on: https://chromium-review.googlesource.com/500088 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Consolidate Vertex Buffer application.  With this change IASetVertexBuffers is only called from a single code site in StateManager11. All other classes call through to here. This will make adopting the dirty bits for InputLayouts and VBs much simpler.  BUG=angleproject:2052  Change-Id: I6e7b6146deb7f80f5f0e75dd0aff18eb4cc2bfc2 Reviewed-on: https://chromium-review.googlesource.com/524232 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor redefineImage and track dirty images properly.  Several issues showed up in testing with WebGL:  * Images should only be forcefully re-defined when there is no data to    upload.  * After an image is marked dirty a later call to subImage would cause    assertion failures because the texture storage would try to verify that    the image was not dirty don't try to copy directly to storage in this    case.  BUG=angleproject:1635  Change-Id: I9e5d83850d743b7d4d2db938312ee5c35a3a79ee Reviewed-on: https://chromium-review.googlesource.com/527348 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Improvements to the gl::Range class.  Make this a proper class fix the extends method (previously did not work as expected) add a contains method and add tests. Also add an iterator helper class so we can iterate over the range with range-for loops.  This also fixes the shader resource unsetting code which was not actually unsetting all the possible applied textures.  BUG=angleproject:2052  Change-Id: I2a6fa97f96ccb612ad01a5e3f24dc869c54c967b Reviewed-on: https://chromium-review.googlesource.com/527318 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Entry point refactoring Refactor texStorage2D and texStorage3D.  BUG=angleproject:747 Change-Id: Id5ab6bbff5ce6debc84318e28b12683bf8b106b1 Reviewed-on: https://chromium-review.googlesource.com/526371 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Consolidate base:: imports.  This merges the mrucache and numerics into one folder to prevent having to make two identical versions of logging.  BUG=angleproject:2044  Change-Id: Iba6dab05b21eb9ba0de44f27a90579c590a9a7fd Reviewed-on: https://chromium-review.googlesource.com/522870 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use ErrorStream everywhere  Eliminates one more usage of FormatString and its static initializer.  Add more ErrorStream types and replace gl::Error and egl::Error with them.  BUG=angleproject:1644  Change-Id: Ib498d0ae4b81a332ec71aed7cf709993b154e6bb Reviewed-on: https://chromium-review.googlesource.com/505429 Commit-Queue: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't discard the storage on forceRelease simply mark the image as dirty.  It was overkill to always destroy the storage especially for cube maps. Instead just make sure the image thinks it's dirty when robust resource init is enabled so that it is always copied to the storage after redefinition.  BUG=angleproject:1635  Change-Id: Ieba065d1873ca66a216bd05f4f8afa9c75349ff9 Reviewed-on: https://chromium-review.googlesource.com/526295 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D11: Don't dirty all uniforms on program change. (2/2)  Second patch for addressing missed comments.  BUG=angleproject:2053  Change-Id: I1268d571913f8ce7efa7b94a5d4e47cf9a80c3c0 Reviewed-on: https://chromium-review.googlesource.com/526275 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Consolidate input layout application.  This merges all calls to IASetInputLayout to a single place in StateManager11. This means we no longer have to invalidate the state for D3D11 and can always lazily apply the input layout state.  Introduces a new ResourceSerial class to replace the uintptr_t and DirtyPointer design.  BUG=angleproject:2052  Change-Id: I76b874218b754395f25a129967c769b1f8f82115 Reviewed-on: https://chromium-review.googlesource.com/523025 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Don't dirty all uniforms on program change.  Only dirty the uniforms if the uniforms are dirty. This gives about a 20% reduction in ANGLE overhead on a targeted micro-benchmark. It probably won't have that large of an impact on most real-world applications but it was strictly unnecessary work.  Something that came up when investigating the internal program binary cache in ANGLE D3D11.  BUG=angleproject:2053  Change-Id: I2d55c010c29ce9627a9001dd2abe6e549f0b7e8c Reviewed-on: https://chromium-review.googlesource.com/524297 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Minor optimizations to DynamicHLSL.  This makes us use std::ostringstream in more places instead of string concatenation.  BUG=chromium:697758  Change-Id: Ifdcaa2e7e119664fc9cfdc566ea13b519a294714 Reviewed-on: https://chromium-review.googlesource.com/521729 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Validate that structure names match when linking uniforms.  GLSL 1.017 4.2.4: Structures must have the same name sequence of type names and type definitions and field names to be considered the same type.  TEST=conformance/glsl/misc/shaders-with-uniform-structs BUG=angleproejct:2013  Change-Id: Ieedaaca2d28ef4e1cc0b5480f413ebd513c1dc1f Reviewed-on: https://chromium-review.googlesource.com/524036 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Force-release images on redefine when robust resource init is enabled.  If the user repreatedly calls glTexImage with null data and the same size it is expected that the texture would re-fill itself with zero'd data. TextureD3D and ImageD3D would no-op these calls when the texture is already the right size.  TEST=conformance2/rendering/blitframebuffer-filter-outofbounds BUG=angleproject:1635  Change-Id: I810b15922759a4acfc0ef7da198f068b81e9efc4 Reviewed-on: https://chromium-review.googlesource.com/524436 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: Reset the TF binding offsets when glBeginTransformFeedback is called.  BUG=angleproject:2051  Change-Id: I09e8548ef76b7d824743d06b0bba21633bc40a24 Reviewed-on: https://chromium-review.googlesource.com/523671 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Defer shader compiles when possible.  When using the program binary memory cache inside ANGLE this will give a potential fast path. If the user doesn't query the shader compile status or info log before calling LinkProgram then we can check the program cache before translating the program and if it finds a hit we don't even need to call the translator.  To preserve the shader settings at compile time a reference to the current shader translator is kept in a binding pointer on the call to compile. This mirrors a similar implementation in Chromium's command buffer. Also the compile options and source are cached at compile to preserve the correct shader state.  BUG=angleproject:1897  Change-Id: I3c046d7ac8c3b5c8cc169c4802ffe47f95537212 Reviewed-on: https://chromium-review.googlesource.com/517379 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
preprocessor: Check for line number overflow  Also remove dead code in Tokenizer.l  BUG=chromium:668842  Change-Id: Ice18313a64f0bb2242299993bfaa882a6578ad54 Reviewed-on: https://chromium-review.googlesource.com/435042 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
DisplayWGL: try all GL context version from the highest  The only way to get a core profile context of the highest version using CreateContextAttrib is to try creationg contexts in decreasing version numbers. It might look that asking for a core context of version (0 0) works on some driver but it create a _compatibility_ context of the highest version instead which might not be supported on some drivers.  BUG=angleproject:1994  Change-Id: Ic8a33243909c54ea5940ee81c9c866b141bea420 Reviewed-on: https://chromium-review.googlesource.com/480739 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Consolidate Query allocation.  This compiles the resource refactor for D3D11. The only remaining non-smart handles are for things like SwapChains and ID3D11Blob.  This might be more easily managed by using angle::ComPtr or similar smart pointers instead of the Resource Manager class.  BUG=angleproject:2034  Change-Id: I53c753a1c19b05c4e72859dd5046e3ed10866847 Reviewed-on: https://chromium-review.googlesource.com/506777 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Consolidate Shader allocation.  Similar to the InputLayout init this adds a small helper type to act as a wrapper around shader init data (binary and size).  This also adds error trapping to the blit shader compilation. It also removes the LazyResource2 class and the CompileXS helper methods.  BUG=angleproject:2034  Change-Id: I3fd718393c8a0250e4263890f00d0e9147ec9567 Reviewed-on: https://chromium-review.googlesource.com/506776 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Validate precision in uniform blocks for WebGL.  In WebGL mode turn on checking that precision qualifiers match in corresponding vertex/fragment uniform blocks.  Add test for this behavior.  BUG=angleproject:2015  Change-Id: Ie035138e8c46e430bdcf8fb5bbc3e0a3ab7d6391 Reviewed-on: https://chromium-review.googlesource.com/517724 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make gl::Compiler reference-counted.  This is helpful for implementing program binary caching in ANGLE.  in order to maintain the current behaviour in Chrome we will need to defer shader compilation until link time. Since WebGL allows the app layer to enable and disable extensions explicitly the app can enable or disable an extension between the calls to glCompileShader and glLinkProgram. Then if we're deferring shader compilation we will have to preserve the extension settings at the time of the call to compile not the current settings at the time of link. Making the compiler reference-counted gives us a pretty simple and robust solution.  This also changes the Context class to lazily init the shader compiler. Lazy init prevents any unexpected nulls and also ensures the releaseShaderCompiler does exactly that: just releases the shader compiler and does not immediately re-initialize it.  BUG=angleproject:2044  Change-Id: I0f0eeb4eb94dc4eee238f92482804a0921c77df0 Reviewed-on: https://chromium-review.googlesource.com/522868 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
compiler: Regenerate parser with latest flex and bison  Flex version is 2.6.4 Bison version is 3.0.4  BUG=chromium:668842  Change-Id: Ia05ae338c9b9e588534f8346ff5c59ed747c56bf Reviewed-on: https://chromium-review.googlesource.com/435553 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Consolidate InputLayout allocation.  This introduces a helper type to act as the initialization data type for input element arrays. A WrappedArray class acts as a helper class to wrap a C array and size into a C++ class similar to std::array but without the data storage.  Also move resource deallocation memory counting into a single code path.  BUG=angleproject:2034  Change-Id: I5e108254777f0df65f5f60fe26e760c71b95b542 Reviewed-on: https://chromium-review.googlesource.com/506775 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix format info for unsized RG texture formats.  The unsized GL_RED and GL_RG formats are only usable with the EXT_texture_rg extension and are always renderable.  BUG=720325  Change-Id: I813662f6c90f1a6a640be747ae40b81727e58cdc Reviewed-on: https://chromium-review.googlesource.com/523023 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Allow sized GL_RGB[A]_32F to be used for TexImage2D with the chromium extensions.  GL_CHROMIUM_color_buffer_float_rgb[a] allows these sized formats to be used in TexImage2D even in ES2.  With this patch the conformance/extensions/oes-texture-float and conformance/extensions/oes-texture-half-float tests now pass for WebGL1 and WebGL 2 contexts.  BUG=angleproject:1958  Change-Id: I568dea5da42ba310463d2690c3e764c48598311b Reviewed-on: https://chromium-review.googlesource.com/522349 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
WebGL compatibility: remove UB for draw buffers in the GL backend.  WebGL adds two rules:  - Fragment outputs declared but not written to should default to black.  - FBO attachments for outputs not declared in the shader should not be written to (it is UB in OpenGL ES).  Fix the first one by using the SH_INIT_OUTPUT_VARIABLES compiler options and the second one by messing with glDrawBuffers so that the enabled draw buffers are always a subset of the ones declared by the shader.  BUG=angleproject:2048  Change-Id: I1d851c190959c1acfc3e41d837e6990aec1d4086 Reviewed-on: https://chromium-review.googlesource.com/521682 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Mark the S3TC SRGB formats as requiring exact block sizes.  TEST=conformance/extensions/webgl-compressed-texture-s3tc-srgb BUG=angleproject:2049  Change-Id: I00d816299db914c078d140f791cd7c98c6428a54 Reviewed-on: https://chromium-review.googlesource.com/522762 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Validate that vertex shader input matches the vertex attribute types.  BUG=angleproject:2012 TEST=conformance2/rendering/attrib-type-match  Change-Id: Ic282e0933a5c3c377322dd484534fcc1dfcb3840 Reviewed-on: https://chromium-review.googlesource.com/517974 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
D3D11: Default init all textures.  The resource manager factory methods will use ClearView or zero-filled buffers to set initial data. It assumes there are no 3D depth/stencil textures. This will lead to some wasteful re-creation of RTVs in some cases.  This is a temporary measure until we can implement more efficient lazy resource init strategies.  BUG=angleproject:1635  Change-Id: I590e76587d3d96a359beedb79e21d24930e5f2e0 Reviewed-on: https://chromium-review.googlesource.com/503254 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Pass gl::Context to impl methods instead of ContextImpl.  In some cases we might have to call back into the GL layer passing the Context and if we just have a ContextImpl pointer this isn't possible. It also removes the need for SafeGetImpl.  BUG=angleproject:2044  Change-Id: I6363e84b25648c992c25779d4c43f795aa2866d6 Reviewed-on: https://chromium-review.googlesource.com/516835 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
WebGL: Validate shader entry point names do not contain invalid characters.  Section 6.20 of the WebGL spec states that all shader-related entry points that accept strings must validate that the string does not contain characters that are not valid in ESSL.  TEST=conformance/misc/invalid-passed-params BUG=2016  Change-Id: I220d9dd79c4b0e8e0195277093268b9e1e66f9d9 Reviewed-on: https://chromium-review.googlesource.com/519445 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Redesign robust resource init as a display extension.  Also correct the enum allocation to values that are available to ANGLE.  BUG=angleproject:1635  Change-Id: I443f5654aa6a5049b4a1ae4c253cd6473b4e446e Reviewed-on: https://chromium-review.googlesource.com/520002 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Call GetGlobalContext instead of GetValidGlobalContext for gl::GetError  If the context is lost due to an OUT_OF_MEMORY error it was impossible to check the error.  BUG=angleproject:1309  Change-Id: I50fbd46b139d44774dde804445f12b8d34d73e29 Reviewed-on: https://chromium-review.googlesource.com/521203 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
EGLDevice: Fix edge-case memory leak.  This could happen if there was an error on device init. Reported by Microsoft.  BUG=None  Change-Id: I059fd9308d0536b4120c28e684e37567d14b3fd5 Reviewed-on: https://chromium-review.googlesource.com/519642 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Validate that fragment shader output matches the draw buffer type.  TEST=conformance2/rendering/fs-color-type-mismatch-color-buffer-type BUG=angleproject:1688  Change-Id: I17848baf40b6d32b5adc1458fe2369b850164da3 Reviewed-on: https://chromium-review.googlesource.com/518246 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Add Program Binary test for reinitialization.  This test tears down and recreates GL and re-uses the binary in a new GL context. Was meant to reproduce a bug in ANGLE but the bug had been fixed previously.  BUG=angleproject:2010  Change-Id: Ic3a31ac044ef4d794dae14608877b6958452b55e Reviewed-on: https://chromium-review.googlesource.com/519463 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't store Renderer in RenderStateCache.  Instead pass it around via methods. This makes the code a bit nicer.  BUG=angleproject:2044  Change-Id: I721e190a2ecde2b1a65e57debf419ee06a5dce29 Reviewed-on: https://chromium-review.googlesource.com/516385 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Introduce MRUCache.  This library comes from Chromium's base and is useful for many use cases in ANGLE. It can replace the custom MRU code we use in the RenderStateCache. It will also be useful for implementing a program binary cache.  BUG=angleproject:2044  Change-Id: Iba166fe380d7ed4e3123428b0227b9d299f756d1 Reviewed-on: https://chromium-review.googlesource.com/516384 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
ES31: Implement binding layout for uniform blocks  The binding point of uniform blocks can be specified in shaders with this CL. See spec ESSL 3.10 section 4.4.4 page 58 for more info.  dEQP-GLES31.functional.ubo.* still can't completely pass as the missing of arrays-of-arrays feature. Neither can dEQP-GLES31.functional.layout_binding.ubo.* due to the incomplete implementation of program interface APIs.  TEST=angle_end2end_tests:UniformBufferTest BUG=angleproject:1442  Change-Id: If95d468fc109834a132b9b817730d3fdc3a615da Reviewed-on: https://chromium-review.googlesource.com/483848 Commit-Queue: Jie A Chen <jie.a.chen@intel.com> Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Initialize uninitialized globals in GLSL output  Initializing globals is done by the DeferGlobalInitializers AST transformation which makes sure that the global variable init proceeds in the correct order. This is important since some global variables may use other uninitialized globals in their initializers.  The global variable init is only done in case the WebGL shader spec is being followed. This avoids adding global initializers twice in case the same shader goes through multiple translations assuming only one of them is a WebGL shader translation.  BUG=angleproject:1966 TEST=angle_end2end_tests WebGL conformance tests  Change-Id: Iea701d3ae40edc906abd87303f2aa27fd23bf55a Reviewed-on: https://chromium-review.googlesource.com/509689 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Don't copy SharedSRVs around.  This was causing a very large performance regression in Texture re-binding. Instead pass by const & which should be fine since values in std::map (and unordered_map) are not reallocated when the map changes.  Also make the SharedResource type non-copyable and add an explicit makeCopy method for when we need to clone the shared pointer.  BUG=angleproject:2034 BUG=chromium:727318  Change-Id: I39508a6ca4b41e4da31fe68899caa4464138cada Reviewed-on: https://chromium-review.googlesource.com/517670 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Lift outdated NVIDIA test suppressions  Lift some test suppressions for bugs that have been fixed in the NVIDIA driver a good while ago.  Also improve code style in some suppressions - prefer IsOSX() and IsLinux() to using ifdefs.  BUG=angleproject:1305 TEST=angle_end2end_tests  Change-Id: Ia069f5b9696000c901956d2952801d5f5c339a11 Reviewed-on: https://chromium-review.googlesource.com/518168 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Re-use std::hash in RenderStateCache.  This will allow us to more easily take advantage of Chromium's MRUCache class.  BUG=angleproject:2044  Change-Id: I3fad82fc825861dc1c2095f25da83159da76e76b Reviewed-on: https://chromium-review.googlesource.com/517359 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Ensure gl State structs are zero filled.  In some cases we would hash or memcmp against structs with bools or other non-filled data. This could have implementation differences and may have been causing cache errors on Clang.  BUG=chromium:721648 BUG=angleproject:2044  Change-Id: I981a1e6e8d50a33f7fade568497b72b919accfce Reviewed-on: https://chromium-review.googlesource.com/516383 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Support CHROMIUM_copy_texture for all formats on D3D11.  Adds a CPU readback and conversion path when the destination texture is not renderable.  BUG=angleproject:1932  Change-Id: I71461ca991dc10dd636ff38e1ae20db2be0f8d63 Reviewed-on: https://chromium-review.googlesource.com/508308 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Platform: Fix initialization order in tests.  Because of the platform refactor in abf38572062b91 we broke the way the tests override the D3D workarounds for the tiny depth/stencil bug.  This change passes a pointer to the platform directly in the EGL init logic which solves this issue. It also removes all decltype code in the platform header which might fix the UBSAN problem we were seeing previously.  Also change a present mode selection error into a warning in the Vk back-end since this was being triggered on AMD but is safe.  BUG=angleproject:2042  Change-Id: Ibbd0c69ce11a840cf4b33c616f56020001e553aa Reviewed-on: https://chromium-review.googlesource.com/513519 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Consolidate state allocation.  This cleans up the allocation and deallocation of Blend DepthStencil Rasterizer and Sampler states.  This patch introduces a LazyResource2 class basically a replacement for LazyResource which will be removed once the refactor is done.  BUG=angleproject:2034  Change-Id: I4fa759ae479807ff69a629f89a08b01800ba3f66 Reviewed-on: https://chromium-review.googlesource.com/503627 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add missing completeness checks for texture attachments.  Texture attachments need to validate that the attached mip level is within the [baseLevelmaxLevel] range and that the texture is complete if the attached mip level is not the base level.  BUG=722684  Change-Id: I859766506b295638572b75a0e2e9fed168be047a Reviewed-on: https://chromium-review.googlesource.com/506928 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Initialize uninitialized locals in GLSL output  Guarantee that local variables are initialized before they are used in GLSL output. In HLSL output all variables were already being initialized.  Locals are initialized using an AST transform. The local variable init can only be run after some simplification of the AST so that it is able to handle complex cases like:  for (int i[2] j = i[0]; i[0] < 3; ++i[0]) { }  If we're dealing with ESSL 1.00 which lacks array constructors in this kind of case the uninitialized array initialization code needs to be hoisted out of the loop init statement and the code also needs to make sure that j's initializer is run after i is initialized.  Another complex case involves nameless structs. This can be an issue also in ESSL 3.00 and above:  for (struct { float f; } s; s.f < 1.0; ++s.f) { }  Since the struct doesn't have a name its constructor can not be used. We solve this by initializing the struct members individually similarly to how arrays are initialized in ESSL 1.00.  Initializing local variables is disabled on Mac and Android for now. On Mac invalid behavior was exposed in the WebGL 2.0 tests when enabling it. On Android the dEQP test runs failed for an unknown reason. Bugs have been opened to resolve these issues later.  BUG=angleproject:1966 TEST=angle_end2end_tests WebGL conformance tests  Change-Id: Ic06927f5b6cc9619bc82c647ee966605cd80bab2 Reviewed-on: https://chromium-review.googlesource.com/504728 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Consolidate Buffer allocation.  We now allocate and release all buffer resources from a single place allowing us to allocate junk memory clear on init and track the currently allocated buffer memory.  BUG=angleproject:2034  Change-Id: Id60b63a7f77bc369dfc494a7587ab06c8d34a8e2 Reviewed-on: https://chromium-review.googlesource.com/503253 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor multisample framebuffer completeness checks.  Re-land with protection against div-by-zero in samples compatibility check.  BUG=722684  Change-Id: I3d5c310d1f2cb4d8b92d80492435855c3c4ad807 Reviewed-on: https://chromium-review.googlesource.com/517427 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Support multiview in ESSL 1.00 shaders  Support is added according to the proposal for WEBGL_multiview. When the multiview extension is enabled in an ESSL 1.00 shader num_views can be specified using a layout qualifier. To support this enabling the multiview extension makes "layout" a keyword rather than an identifier in ESSL 1.00.  The type of gl_ViewID_OVR is also different in case of ESSL 1.00: it has to be a signed integer since unsigned integers are not supported in ESSL 1.00.  Some existing tests for multiview shaders are extended in this patch. The changes make sure that vertex shader "in" qualifier is still allowed in ESSL 3.00 multiview shaders since this patch adds code to disallow it in ESSL 1.00 multiview shaders.  BUG=angleproject:1669 TEST=angle_unittests  Change-Id: I65dbbbebabdb24cf0bb647d40aa80cebf713c4f7 Reviewed-on: https://chromium-review.googlesource.com/506088 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "Refactor multisample framebuffer completeness checks."  This reverts commit ff77c359221485886b8207e8afd23c11e0768cf4.  Reason for revert: Breaks FramebufferMixedSamplesTest on Android NVIDIA  BUG=angleproject:2045  Original change's description: > Refactor multisample framebuffer completeness checks. >  > BUG=722684 >  > Change-Id: Iebe6968ebd693e7f051394a040eac1cf6f539e6e > Reviewed-on: https://chromium-review.googlesource.com/508221 > Reviewed-by: Geoff Lang <geofflang@chromium.org> > Reviewed-by: Jamie Madill <jmadill@chromium.org> > Commit-Queue: Geoff Lang <geofflang@chromium.org> >   TBR=fjhenigman@chromium.orggeofflang@chromium.orgjmadill@chromium.org # Not skipping CQ checks because original CL landed > 1 day ago. BUG=722684  Change-Id: I1abab021ba73b218cbbe60d4e7bfdaae56955c64 Reviewed-on: https://chromium-review.googlesource.com/517390 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D11: Use TextureHelper11 everywhere.  This consolidates all texture allocation into ResourceManager11. It removes a lot of error checking and resource management code. In a few places we're storing some redundant information like in TextureStorage11 we might store the Format pointer in two places or the Texture's size.  BUG=angleproject:2034  Change-Id: I9369e76925a67632c444c662e5667c5ed7875547 Reviewed-on: https://chromium-review.googlesource.com/503252 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Mark some internal functions as not having side effects  Precision emulation rounding function calls and vector/matrix dynamic indexing function calls now get a flag that indicates that running the function body does not have side effects. This avoids triggering asserts in OutputHLSL when these internal function calls end up on the right hand side of a non-unfolded logical operator.  BUG=chromium:724870 TEST=angle_unittests  Change-Id: Id1a2b6b744f6a04c6cdb86a8f4109ccc12bc70b9 Reviewed-on: https://chromium-review.googlesource.com/516705 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Refactor multisample framebuffer completeness checks.  BUG=722684  Change-Id: Iebe6968ebd693e7f051394a040eac1cf6f539e6e Reviewed-on: https://chromium-review.googlesource.com/508221 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add missing dependencies on exe_and_shlib_deps (angle)  BUG=chromium:723069  Change-Id: I2b3c9be297c2b65955e31f393756ca266cc7c60b Reviewed-on: https://chromium-review.googlesource.com/514436 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use GetPlatformDisplay instead of GetPlatformDisplayEXT.  This will allow us to use EGLAttrib and pass pointers as Display init parameters if necessary.  BUG=angleproject:2042  Change-Id: Ib0f85d71bc9d3dff2db9453012f40303f3c3bd7c Reviewed-on: https://chromium-review.googlesource.com/513518 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Move CreateStagingTexture to Renderer11.  This will make staging texture tracking easier.  BUG=angleproject:2034  Change-Id: I2f0418cc5784100bf6fba59b4bda1b2dd9dc18d1 Reviewed-on: https://chromium-review.googlesource.com/503251 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement the new formats/features of the ES3 CHROMIUM_copy_texture.  Some non-renderable texture formats remain unimplemented.  BUG=angleproject:1932  Change-Id: Id206432d6e26a70fc0e84478a4e43e9eefadcf2f Reviewed-on: https://chromium-review.googlesource.com/491948 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Don't store device in InputLayoutCache.  We will need the Renderer pointer for resource allocation so pass it around instead of storing the device and context.  BUG=angleproject:2034  Change-Id: Iaf271913f88c5402895aa81de310aa22fcd72cc4 Reviewed-on: https://chromium-review.googlesource.com/509930 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix zero size buffer robust init crash.  We were not correctly checking for a zero-size buffer which should not trigger allocating a scratch buffer.  BUG=angleproject:1635  Change-Id: Iac0a3d8f1eeeb7b39c59eec411bec78a4f21bcd3 Reviewed-on: https://chromium-review.googlesource.com/513478 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix compound assignment precision emulation  Precision emulation for compound assignment used to set the wrong type for the compound assignment nodes which could cause an assert to trigger. The wrong rounding function was also being called in the lowp rounded compound assignment function.  BUG=chromium:699479 TEST=angle_unittests  Change-Id: I60b4cb3bf1830e8249511c13037348bb2423e5b9 Reviewed-on: https://chromium-review.googlesource.com/514045 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
D3D11: Consolidate SRV allocation.  This change also moves all SRV storage to use the custom smart pointer classes in ResourceManager11. Every single SRV is now allocated in ResourceManager11. For TextureStorage11 and RenderTarget11 we use a shared pointer type since the SRVs use shared ownership by both classes.  BUG=angleproject:2034  Change-Id: I90666fbbbc23ff10870b7401f3da09ef79258136 Reviewed-on: https://chromium-review.googlesource.com/503250 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Reduce warning spam for failed D3D shaders.  This prevents Chrome's about:gpu from being filled with bad shaders and instead only prints the relevant error lines.  BUG=None  Change-Id: I75fcd2ef920d2ed7b98e8668c487b0921faf4c0b Reviewed-on: https://chromium-review.googlesource.com/513417 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Wrap safe numerics library in namespace angle.  When ANGLE is used with Chromium having two copies of safe numerics code in namespace base causes ODR violations.  BUG=449754  Change-Id: I686049e7d8926373d00dd17ec8142fa3c508b9c5 Reviewed-on: https://chromium-review.googlesource.com/513434 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Reduce absolute paths in generated ninja files in angle  BUG=chromium:723856  Change-Id: I7481d3335111c697f77aa0ea673614e79b4a86f6 Reviewed-on: https://chromium-review.googlesource.com/513588 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Enable CopyTex(Sub)Image default FB on Mesa/GLX.  Allow CopyTexImageTest.SubDefaultFramebuffer and CopyTexImageTest.DefaultFramebuffer to work with Mesa and GLX back end by doing a clear before reading the framebuffer.  BUG=angleproject:2027  Change-Id: Ibb10369e3f5aceb60511fbed1d67a28132734b29 Reviewed-on: https://chromium-review.googlesource.com/507952 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Disallow structs as scalar/vector constructor arguments  The spec isn't very explicit about disallowing this but conversions from structs are not among the conversion constructors or specified in any other way either.  BUG=angleproject:2036 TEST=angle_unittests  Change-Id: I23f2ceda1d1348cec0d3bba38a7a013275ff84eb Reviewed-on: https://chromium-review.googlesource.com/514002 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Put global init code inside main() instead in a function  Otherwise we may run into a name conflict issue if the shader code is run through the translator twice since neither user-defined function names or internal function names are currently being prefixed in GLSL output. This could be fixed by prefixing user-defined variables in GLSL output but this solution is much simpler.  BUG=angleproject:1966 TEST=angle_end2end_tests WebGL conformance tests  Change-Id: I15c8de5a0a5e596fafe9f55e8d370345c790d5cc Reviewed-on: https://chromium-review.googlesource.com/509688 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Remove failure expectations for shader_random tests.  Apparently the current clang roll has fixed these already.  BUG=722345  Change-Id: I59f07f197fdfd1eb6e000390ee93d41938fe4d42 Reviewed-on: https://chromium-review.googlesource.com/510031 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Clean up ternary op validation  Use "?:" as the operator string to make the error message clearer.  Update some comments to refer to specific revisions of the spec since there have been some spec changes in this area.  BUG=angleproject:2032  Change-Id: Ic5d128391bfa46187ad335228077f5eab9eac349 Reviewed-on: https://chromium-review.googlesource.com/500270 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
D3D11: Consolidate DSV allocation.  This uses the new classes introduced in ResourceManager11. Smart pointers mean we can use ANGLE_TRY in more places and don't need to manually release these views. There is now a single point in the D3D11 back-end where depth stencil views are allocated.  BUG=angleproject:2034  Change-Id: If0de2529ece1298e8babf24c07cc4be9849cc4de Reviewed-on: https://chromium-review.googlesource.com/503249 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ES31: Refactor syncState in VertexArrayGL  This patch intends to solve several design issues by refactoring the process of syncState in VertexArrayGL before implementing ES3.1 feature Vertex Attrib Binding on the OpenGL back-end. 1. Use nullptr as the flag of using client memory pointer 2. Simplify comparisons in updateAttribPointer. 3. Put all code related to mFunctions->vertexAttrib*Pointer() into an individual function 4. Remove redundant mStateManager->bindVertexArray() in all update* functioins and only call it once in syncState().  BUG=angleproject:1593  Change-Id: I8f68534bb9291a601b9b77954d7281e5171c2b55 Reviewed-on: https://chromium-review.googlesource.com/465378 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Handle multiple AST insertions to the same parent in updateTree()  Multiple insertions to the same parent can be handled as long as the insertions don't have the same position as well. They're sorted in reverse order so that insertions to greater indices get processed first.  This helps to make some AST transformations faster - they don't need multiple tree traversals and updateTree() steps anymore. The SimplifyLoopConditions AST transformation is changed to only use a single traversal.  BUG=angleproject:1966 TEST=angle_unittests angle_end2end_tests      WebGL conformance tests      dEQP-GLES2.functional.shaders.*select_iteration_count*  Change-Id: I3183f2644ad58b282926093c77b204fb7e4e9b71 Reviewed-on: https://chromium-review.googlesource.com/506202 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Clean up ValidateMaxParameters  It doesn't need to use a traverser since all function definitions can be found simply by iterating over the children of the root node.  BUG=angleproject:2040 TEST=angle_unittests  Change-Id: I18a98eff9710485c0cdce73e7fffe124f7d7afb2 Reviewed-on: https://chromium-review.googlesource.com/508791 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix names of some crashing shader tests.  The names were wrong so the test expectations weren't applying.  BUG=722345  Change-Id: Ic64abf08e512dbf3c297ee89a74b614cd4590b58 Reviewed-on: https://chromium-review.googlesource.com/508166 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
D3D11: Add resource manager classes.  The resource manager tracks the allocations and deallocations of all D3D11 resources that have device memory: Buffers and Textures (which are either 2D or 3D). It also tracks the number of active Views (DSV RTV and SRV potentially UAV with ES 3.1).  A new smart pointer type will wrap the resource deallocation so that the object notifies the manager when ANGLE is done with the resouce. This allows us to track precisely how much GPU memory we think we're using at any point and will help prevent resource leaks for these object types. It also makes initialization and releasing much more trivial.  The base class for a resource uses a template template parameter so that we can use a unique or shared pointer depending on if the object in question needs unique or shared ownership. For some resources (in our case SRVs are shared between the TextureStorage11 and RenderTarget11 classes and Textures are shared in many places) we need to have the ability to have shared ownership. Unique ownership is a little bit more efficient so supporting both can be helpful.  In this patch RenderTargetView allocation is moved to use the unique smart pointer.  BUG=angleproject:2034  Change-Id: Idb1245c24cd66733b8b5ca524c727350b2d2c745 Reviewed-on: https://chromium-review.googlesource.com/503248 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Refactor checks for incomplete framebuffer attachments.  BUG=722684  Change-Id: I6f47d92b450a056a2344767bef28e96c4552f98e Reviewed-on: https://chromium-review.googlesource.com/506927 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Clean up AddDefaultReturnStatements  It doesn't need to use a traverser since all function definitions can be found simply by iterating over the children of the root node.  BUG=angleproject:2040 TEST=angle_end2end_tests  Change-Id: I380942f90a0e73152f296b98d1fb027762d913b0 Reviewed-on: https://chromium-review.googlesource.com/508689 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Skip rather than fail crashing functional_shaders_random tests.  BUG=722345 TBR=geofflang@chromium.org  Change-Id: Ie4c488b730ed2b51ce8f62d5bf7961dcc8ac0104 Reviewed-on: https://chromium-review.googlesource.com/508102 Reviewed-by: Kenneth Russell <kbr@chromium.org> Commit-Queue: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Correctly generate mipmaps for sRGB textures.  sRGB textures need to linearize their data before averaging this worked correctly on the GPU mipmap generation functions but not the CPU ones.  BUG=angleproject:2019  TEST=conformance/extensions/ext-sRGB  Change-Id: I554dac89b12acf5ebf5b7cab6f6faf0bce5168a6 Reviewed-on: https://chromium-review.googlesource.com/506241 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use fprintf(stderr) instead of std::cerr.  This allows us to include <ostream> instead of <iostream> to avoid including a static initializer.  BUG=angleproject:2037  Change-Id: Ib7e84a15018fa951bad1c87ffec4bfb0c896749f Reviewed-on: https://chromium-review.googlesource.com/507627 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
dEQP expectations: suppress failures caused by a clang roll  Hopefully this makes the bot green while we investigate whether the bug is in dEQP or clang and find a fix.  BUG=722345  Change-Id: I2813881addb4ebfe23443244d175b4c6db698a7d Reviewed-on: https://chromium-review.googlesource.com/507767 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Simplify DeferGlobalInitializers  It doesn't need to use a traverser it's simpler to just iterate over all statements in the global scope.  BUG=angleproject:1966 TEST=angle_unittests WebGL conformance tests  Change-Id: I11200f72842db86be2bcdd11934262da183cc3b4 Reviewed-on: https://chromium-review.googlesource.com/504727 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Apply clang-format to many files.  This cleans up the formatting in many places.  BUG=None  Change-Id: I6c6652ebc042f1f0ffecced53582d09d66b4f384 Reviewed-on: https://chromium-review.googlesource.com/487884 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ES31: Implement glDispatchCompute for D3D backend  BUG=angleproject:1955 TESTCASE=angle_end2end_tests  Change-Id: I69b4df83d67017d39df67753d6d17fc15ececebf Reviewed-on: https://chromium-review.googlesource.com/462067 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
EmulatePrecision: Round constructor args only when needed  Constructor arguments don't need to be rounded if the constructor result will be rounded to the same precision.  This will make precision emulated shaders slightly faster to execute in some cases.  BUG=angleproject:874 TEST=angle_unittests  Change-Id: I4220cd2289c97dcf5b7a25a4cbdd18487947c2d2 Reviewed-on: https://chromium-review.googlesource.com/500288 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Simplify AST transformations that need to find main  Share code for finding the main function from the AST between InitializeVariables DeferGlobalInitializers EmulateGLFragColorBroadcast and UseInterfaceBlockFields. This makes InitializeVariables simpler in particular as it doesn't need an AST traverser anymore.  BUG=angleproject:2033 TEST=angle_unittests WebGL conformance tests  Change-Id: I14c994bbde58a904f6684d2f0b72bd8004f70902 Reviewed-on: https://chromium-review.googlesource.com/501166 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Initialize currentValueAttrib->binding in updateCurrentValueAttribs  This patch intends to fix a crash issue in the win-clang build of ANGLE by adding the missing currentValueAttrib->binding assignment in StateManager11.cpp::updateCurrentValueAttribs(). In D3D11 all vertex attributes (VertexAttribute and its VertexBinding) should be treated as a whole so we should always ensure these two parts are availabe.  This patch also add ASSERTs before using *translated->attrib and *translated->binding to prevent a TranslatedAttribute object having a null attrib or binding.  BUG=chromium:721783 angleproject:1593  Change-Id: Id11d6f1d4c37daabad2265e01ea38eb51046b9cb Reviewed-on: https://chromium-review.googlesource.com/505928 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Check FunctionsEGL::terminatePtr before use.  FunctionsEGL::terminatePtr could be null if initialization failed so check it before use to avoid crashing.  Change-Id: Ide9378c8e26749ab9d58c01cb36cd923836cde98 Reviewed-on: https://chromium-review.googlesource.com/506627 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Use unused uniform blocks workarounds on Linux AMD.  The Linux AMD driver optimizes out uniform blocks where WebGL2 and maybe OpenGL ES 3 forbids it. Try to fix this by enabling the workaround that was made for the same problem on OSX.  BUG=  Change-Id: If3b18ec1f463582d7594221a6f2a08d25207e737 Reviewed-on: https://chromium-review.googlesource.com/506189 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Suppress default FBO CopyTexImage failure on Linux Intel  BUG=angleproject:2027  Change-Id: I337303c9f673558ed75826e96fc2cd75f6ec1441 Reviewed-on: https://chromium-review.googlesource.com/506070 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Make IGarbageObject's destructor virtual  This fixes a warning.  BUG=angleproject:1668  Change-Id: Idf063be9dde0bfbf5f088d69ef38fd97baa69df3 Reviewed-on: https://chromium-review.googlesource.com/495434 Commit-Queue: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Frank Henigman <fjhenigman@chromium.org> Reviewed-by: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
GLES2: Clean up entry points for auto-gen.  This cleans up a few things:  * refactors a few remaining missed EPs  * removes unnecessary includes  * rename one Context entry point  * moves some ES2 EP validation to validationES2  The last item makes for a significant diff but this is a refactor change only with no functionality change.  BUG=angleproject:747  Change-Id: I7860cc4b6260b6c22faa5f2885297333c0cdb4ed Reviewed-on: https://chromium-review.googlesource.com/483426 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update end2end tests to function without EXT_texture_storage.  This also exposed an issue in our glTexSubImage2D validation where the sized format would be used for the texture support check when the unsized format was provided.  The GL_ALPHA32F format is not valid unless EXT_texture_storage is present but using GL_ALPHA + GL_FLOAT is valid.  BUG=angleproject:1958  Change-Id: Ice0b7549c39559990942176481c5175df17aaf92 Reviewed-on: https://chromium-review.googlesource.com/491246 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
vulkan: assume secure_getenv().  Vulkan's cmake files check for the availability of secure_getenv() but we just assume it exists.  BUG=chromium:717558  Change-Id: I22054c3967f543d163dde37b9a6b13e896da7a50 Reviewed-on: https://chromium-review.googlesource.com/494126 Commit-Queue: Frank Henigman <fjhenigman@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
GLES2: Apply clang-format to entry points.  This will make the diff for the auto-gen patch easier to review.  BUG=angleproject:1309  Change-Id: I58526a29b7f538b45409c6ab48b75b41b3521321 Reviewed-on: https://chromium-review.googlesource.com/487883 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
GLES2: Use codegen for the entry point header.  This is a first step towards auto-generating more entry point files.  BUG=angleproject:1309  Change-Id: Ic75a627feb91c19b6bb398a6f9f1a37b603dea14 Reviewed-on: https://chromium-review.googlesource.com/483425 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disable Vulkan support on Linux  There are both compile error and missing build file dependencies in standalone builds.  BUG=angleproject:1668  Change-Id: I8741bd3dd20452c94921101bbf7c5be39fb463b7 Reviewed-on: https://chromium-review.googlesource.com/493608 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Take depth into account when checking for OOB in TexImage3D  BUG=angleproject:2017  Change-Id: Id75a8c0ddf4eda4b569509e2014c20db6f5c46ff Reviewed-on: https://chromium-review.googlesource.com/490848 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Suppress MipmapTestES3.BaseLevelTextureBug failures on 10.12.4.  BUG=705865  Change-Id: Ife59aaf009365a51b5362a00373d1efaceba9fb8 Reviewed-on: https://chromium-review.googlesource.com/490946 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix params.h compilation.  The ANGLE_PARAM_TYPE_INFO macro was referencing the TypeInfo static member that was only added when release asserts are enabled.  BUG=angleproject:747 BUG=chromium:716323  Change-Id: I0657dde69c62ab697b3c095fe19f38c130188cef Reviewed-on: https://chromium-review.googlesource.com/490687 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Clear11 Shader Optimizations and Shader Management Rework  - ClearShader made into a class that manages all required shaders and input layouts for clears - ClearShader reuses VS for all clear types. This reduces shader compilation time and memory usage significantly - Use constantBuffer for color/z values instead of VB to decouple VB & VS from clearType and allowing for the same VS to be used for multiple clear types - FL10+ Devices: Generate positions using SV_VertexID in VS to avoid having to bind VB. - FL93 Devices: Use an immutable VB containing only position data (SV_VertexID not supported) - Implement CB cache. Incoming color/Z values checked against cache and CB/cache only updated if there is a mismatch. Significantly reduces the frequency of expensive CB map/rename operations especially in common scenarios where most/all clears use the same color/z values  BUG=angleproject:1935  Change-Id: I2015fbdcc135ba08b65dbecbe9c62499c2801037 Reviewed-on: https://chromium-review.googlesource.com/453882 Commit-Queue: Shahmeer Esmail <shahmeer.esmail@intel.com> Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix params.h compilation.  Because our ASSERT macro always references the conditional expression not defining TypeInfo was causing a compile error on builders which had release asserts disabled.  BUG=angleproject:747 BUG=chromium:716323  Change-Id: I3b5f27e39235f26b8bef5921c2d398320eb0ebaf Reviewed-on: https://chromium-review.googlesource.com/490426 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix missing return values in bitset_utils.h  This patch adds the missing return value *this in the operator= of class BitSetT  BUG=angleproject:1814  Change-Id: I758d62e80e4ade92aac64315f1808ca1eabdc787 Reviewed-on: https://chromium-review.googlesource.com/487423 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
GLES2: Reformat entry point header.  This should simplify the diff with the auto-gen patch.  BUG=angleproject:1309  Change-Id: Ibea503f236e7dc07d0862e20f77e866d6ec1f316 Reviewed-on: https://chromium-review.googlesource.com/489081 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix workaround formats not being used when EXT_texture_storage is emulated.  This bug showed up on Mac which doesn't support the extension.  The internalFormat is correctly translated to the workaround format but the format and type are not.  BUG=angleproject:1958  Change-Id: I9b31f0491df1bb623bf59996cbb02d0276b6355c Reviewed-on: https://chromium-review.googlesource.com/488582 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update gl2.h and update entry points.  Some method signatures were updated. Types like GLclampf and GLvoid were replaced with other equivalents.  BUG=angleproject:1309  Change-Id: I05e8e2072c5a063d87ad96a855b907424661e680 Reviewed-on: https://chromium-review.googlesource.com/475011 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Apply release asserts config to all dependents.  Our test sets (e.g. angle_perftests) were not having the config applied.  BUG=angleproject:747  Change-Id: Idd3a2cba214d38a923c1936787f9dec4bd016326 Reviewed-on: https://chromium-review.googlesource.com/487730 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Expand the MipmapTestES3.BaseLevelTextureBug supression to all AMD OpenGL.  BUG=705865 BUG=715875  Change-Id: Ib4d83a8c9cb3f65ac8517bfd3ff7c38794dd0654 Reviewed-on: https://chromium-review.googlesource.com/488661 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use parameter cache to skip passing IndexRange.  For DrawElements et al. we can use a simple design to store entry point parameters and compute index ranges lazily. This allows us to compute the index range outside of the validation layer.  Fixing this will let us implement a few things such as the no error extension. It will also allow auto-generation of the entry points since we won't have to have special cases for certain entry points. It will also help fix the syncState layering problem. Now the cached parameter helper (which is owned by the Context) can make the impl layer calls instead of the validation layer calling the impl directly.  We use a small array in Context to gather parameters in a generic way without reallocation on call. We also check type safety by storing a type info struct which can handle inheritance between type classes. Optional variables for the cache determine when to re-compute values.  The intent with gatherParams is to call this in every entry point and have in most cases be a no-op. In some cases like for IndexRange we store some parameters for later use. The inheritance scheme enables auto-generation of the entry points by keeping signatures similar.  BUG=angleproject:747  Change-Id: I871e99e1334cf6e61ef8da62fde3ced094903f8a Reviewed-on: https://chromium-review.googlesource.com/474119 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Alias dirty buffer channel bindings.  The types for this were a bit disorganized. Clean this up.  BUG=angleproject:1635  Change-Id: I669d347697e0c7c5b06ed7165fa0997c375e876e Reviewed-on: https://chromium-review.googlesource.com/483315 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Support Vulkan on Linux as well as Windows.  Refactor display and surface classes into Win32 and Linux parts and add Linux parts to gn and gyp builds.  BUG=angleproject:1668  Change-Id: I2a7d29c35f4f42fa0035bd97938d3770f3627672 Reviewed-on: https://chromium-review.googlesource.com/412426 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Re-order the error generation for ES3 TexImage calls.  Explictly check if the internal format enum is ever valid before checking if it is valid in combination with other parameters. Some WebGL tests expect a certain order for generated errors.  BUG=angleproject:2009 TEST=conformance2/textures/misc/tex-input-validation  Change-Id: I31166a78d00629f8281ef53eced72575497ae448 Reviewed-on: https://chromium-review.googlesource.com/486099 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
TextureD3D: Mark images dirty after deleting the texture storage.  When a texture storage is deleted it copies its mip levels back into images and marks them clean.  Marking the images dirty before deleting the texture storage would have no effect.  BUG=705865  Change-Id: Ib4c0fc9bea1236fc31963d1b7db814785bc54abc Reviewed-on: https://chromium-review.googlesource.com/486107 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactoring: replace NULL by nullptr for pointers (3rd CL).  This CL mainly handles passing/returning NULL to/from a function.  BUG=angleproject:2001  Change-Id: I34802f792e710e3d7ff697cbe4701dc1bf5ab009 Reviewed-on: https://chromium-review.googlesource.com/485060 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move Vulkan layer json files.  Put the Vulkan layer JSON files in the same place as the gn build puts them for consistency.  Change-Id: I6294372ce34ed20da357a8b8ea83018c4e748c37 Reviewed-on: https://chromium-review.googlesource.com/475074 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Make ImageSibling inherit from FramebufferAttachment.  Only currently Renderbuffers and Textures can be bound with images. This makes the relationship explicit and also ensures that an image sibling can determine if it's been initialized or not which is important for the robust resource init extension with Textures and EGLImages.  BUG=angleproject:1635  Change-Id: Ie05319cfbfda50f1497cab3f0b9ca64e1bff8955 Reviewed-on: https://chromium-review.googlesource.com/469154 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Enable MSAA for texture client buffers  Enhancement to the EGL_ANGLE_d3d_texture_client_buffer extension to allow use of a shared D3D texture that can be multi-sampled.  BUG=angleproject:1917  Change-Id: Iaf59bbd575a5dfb29345f55b549bc4017bf2d7d0 Reviewed-on: https://chromium-review.googlesource.com/446907 Reviewed-by: Bryan Bernhart <bryan.bernhart@intel.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Tighten workaround on unary minus for Intel D3D drivers  This driver bug has been fixed in 20.19.15.4624.  BUG=chromium:644033  Change-Id: I6f621d7c4d4b823da29255f869af84097f4f7c2c Reviewed-on: https://chromium-review.googlesource.com/476118 Reviewed-by: Yunchao He <yunchao.he@intel.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix validation for compressed texture functions.   * No validation that the format matched the texture level's format for    SubImage calls.  * WebGL does not allow the base level to be smaller than the block size.  * ANGLE used to allow mips of size 3 when this is disallowed.  * Don't early-exit validation when dimensions are 0 imageSize validation    happens later.  TEST=conformance/extensions/webgl-compressed-texture-s3tc  BUG=angleproject:1998  Change-Id: I05f5a0b5180344d67b036fdecc17edd2256e85ab Reviewed-on: https://chromium-review.googlesource.com/480442 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
WebGL: Validate the read and write buffers for BlitFramebuffer are unique.  TEST=conformance2/rendering/blitframebuffer-test  BUG=angleproject:1990  Change-Id: I0caeaac824f1689867134f34f74e5ef2c2f1b016 Reviewed-on: https://chromium-review.googlesource.com/475990 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Only bind that native GL texture if it should be complete.  If extensions such as OES_texture_float_linear are not exposed but the native drive still supports them we don't want to bind the native texture and instead bind a texture that is known to sample like the incomplete texture.  BUG=angleproject:1959  Change-Id: I610dbd93bb566c8eb2166488a7494b74da4aa327 Reviewed-on: https://chromium-review.googlesource.com/465090 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix the zlib build on 64-bit Windows.  BUG=angleproject:2004  Change-Id: Ifb4f19abbbb1b6724d2af5b0a5dfb005b49ae3d1 Reviewed-on: https://chromium-review.googlesource.com/483906 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use a shared state for egl::Image.  This allows us to stop duplicating some information in the impl.  BUG=angleproject:1635  Change-Id: If8f7d2418571c3254729f48c463814ec18ed2644 Reviewed-on: https://chromium-review.googlesource.com/469153 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Refactor TextureStorage11  The CL includes below changes: 1. Change bool isAssociatedImageValid to void verifyAssociatedImageValid since we always required that the validation check should never be false. So ASSERT() is enough. Same to Image11::isAssociatedStorageValid->Image11::verifyAssociatedStorageValid. 2. Remove the unnecessary if checking after ASSERT 3. Use override instead of virtual if the function is virtual and is overriding a virtual function from the base class.  BUG=angleproject:2006  Change-Id: I036666ae1ed4bfcaa8cef9e0e9626d375cd81a27 Reviewed-on: https://chromium-review.googlesource.com/480015 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix zlib compile.  The zlib roll 50a8d0e0 broke the Window/gyp/ninja build. Suppress C4245.  BUG=angleproject:2004  Change-Id: Ifdac7a1ec3162c8a296f6d4919a2b6f83bdf1e50 Reviewed-on: https://chromium-review.googlesource.com/483802 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Refactoring: replace NULL by nullptr for pointers (2nd CL).  This CL mainly handles the pointer comparisons (== or !=).  BUG=angleproject:2001  Change-Id: I25ac3b61032e7ad91459a1c6541cadc87cf9b160 Reviewed-on: https://chromium-review.googlesource.com/483935 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Perform ANGLE_instanced_arrays validation for WebGL contexts.  TEST=conformance2/rendering/instanced-arrays  BUG=angleproject:1988  Change-Id: Ie513dcc7b1af540764fd5fe3790d3e6e3457f048 Reviewed-on: https://chromium-review.googlesource.com/475136 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Allow dynamically enabling shading language extensions.  GL_OES_standard_derivatives GL_EXT_shader_texture_lod and GL_EXT_frag_depth.  TEST=conformance2/extensions/promoted-extensions-in-shaders TEST=conformance/glsl/misc/shader-with-dfdx.frag  BUG=angleproject:1719  Change-Id: Ic0bd50c6a222940cc8de903f88f19a4f5ee08088 Reviewed-on: https://chromium-review.googlesource.com/476030 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
dEQP: Remove shader compile/link timing output.  This should reduce our log sizes significantly. Will upstream the fix to dEQP and then remove the custom workaround once we roll.  BUG=chromium:713196  Change-Id: I0ddb678bf5256bd5f05782ca40d49501e84e4cae Reviewed-on: https://chromium-review.googlesource.com/483047 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Stop using FramebufferAttachment::Target.  Target includes the binding (DEPTH/STENCIL/COLOR) which is not useful for many operations. Simplify this to just passing the mip/layer.  This allows us to stop using this internal struct in other classes.  BUG=angleproject:1635  Change-Id: Ic5a11781bf45fe7835437fa1e363c190b876d453 Reviewed-on: https://chromium-review.googlesource.com/469152 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix HLSL 3 generation of shaders with texture LOD.  BUG=angleproject:2002  Change-Id: If8e6bbaeb5769341f92f05025eafb6a202fec437 Reviewed-on: https://chromium-review.googlesource.com/481680 Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Roll zlib to fix a warning on Mac  BUG=  Change-Id: Iaef87582aba57632d5a696fdf9ff09c4fab5c75a Reviewed-on: https://chromium-review.googlesource.com/483619 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Code refactoring: replace NULL by nullptr for pointers.  This is the frist change to replace NULL by nullptr. It handles the initialization and assignment for pointers.  BUG=angleproject:2001  Change-Id: I6d4bb198a72e38b867cd2f65a6e6f2f61339a0b5 Reviewed-on: https://chromium-review.googlesource.com/481600 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix bug in updating vertex attribs with client memory pointers  In DEBUG version when using OpenGL back-ends ANGLE may meet an INVALID_OPERATION error from driver when attemping to update an attribute which is disabled and using a client memory pointer.  This patch fixes this bug by skipping such vertex attributes when updating them to driver. With this patch the process to update vertex attributes should be: (1) For enabled attributes using client memory pointer:     update by streaming mode in streamAttributes() (2) For disabled attributes using client memory pointer:     just label them dirty and skip them (3) For attributes using buffer objects:     update with vertexAttrib*Pointer  BUG=angleproject:1942  Change-Id: I57043e5904eb4a342fa22d449d98a957010170d6 Reviewed-on: https://chromium-review.googlesource.com/456747 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Key the format tables on internal format and type.  Keying the format tables on internal format alone is not enough to fully validate the unsized formats which require additional type information.  This CL has no functional changes it just splits the tables and updates the calls to GetInternalFormat info to provide type information when the format is not sized.  BUG=angleproject:1523 BUG=angleproject:1958 BUG=angleproject:1228  Change-Id: I37e5201e7f54fa8eca01b8a6e64b11a6b94484e7 Reviewed-on: https://chromium-review.googlesource.com/468449 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Never add declarations without children to the AST  When block nodes were being created for loop bodies that didn't have braces in the parsed source the code didn't check if the loop body was a declaration node without children. Always use appendStatement() for adding statements to a block so that declaration nodes without children don't end up in the AST.  Similarly make sure that loop init nodes aren't declarations without children.  BUG=chromium:712550 TEST=angle_end2end_tests  Change-Id: I5e79b700fe6158fa2422fcf4cd13818b2bd24863 Reviewed-on: https://chromium-review.googlesource.com/481660 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Vulkan: Defer command buffer submission.  This packs more rendering commands into fewer command buffers. Instead of using a single command buffer per-command create a buffer and record commands into it until we need to present the frame. More sophisticated management will be necessary in the future when we can do other types of copied and read-back from image data.  This also reduces the number of Fences we use for checking if the device is finished with resources. Instead of creating a Fence per-command-buffer it creates one per-swap.  BUG=angleproject:1898  Change-Id: I9c6033bc04289fd8f936c0df914afc51fc434b29 Reviewed-on: https://chromium-review.googlesource.com/445800 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Lazily initialize the D3D device in DisplayWGL.  Change-Id: I3afe4c0619128d7063f49ed8c295d4b814193f84 Reviewed-on: https://chromium-review.googlesource.com/476930 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Optimize angle::BitSetIterator.  Adds a new custom bitset template to handle packing as many bits as possible into a single variable. Intelligently select the right class depending on platform features and bit sizes.  For now always use a packed 64-bit set on 64-bit instead of using a 32-bit set for smaller bitsets.  BUG=angleproject:1814  Change-Id: I3ffef815c15515555833f6fc9302d8a4eee5423b Reviewed-on: https://chromium-review.googlesource.com/471827 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Validate that framebuffer attachments all have the same size for WebGL.  TEST=conformance2/rendering/draw-buffers  BUG=angleproject:1989  Change-Id: Ifcbc766dea99a8361261713fde7a6b6ad724fd55 Reviewed-on: https://chromium-review.googlesource.com/475083 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Texture: Add helper to query desc from index.  BUG=angleproject:1635  Change-Id: I0e4b57119bf23d656446a5ded76ba2f62ea74d7f Reviewed-on: https://chromium-review.googlesource.com/469151 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Framebuffer: Add an update attachment helper function.  This will allow us to set that certain attachments need to be initialized in a single place.  BUG=angleproject:1635  Change-Id: I98c10206ef27670847969c726a8620c4d26400d6 Reviewed-on: https://chromium-review.googlesource.com/469150 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add robust entry point for CompressedTex(Sub)Image  BUG=angleproject:1354  Change-Id: I925db827c4ccf4e6f037a058f8f6b960a56047e1 Reviewed-on: https://chromium-review.googlesource.com/474964 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D: Return an empty string when the translated shader source is empty.  TEST=conformance/extensions/webgl-debug-shaders  BUG=angleproject:1991  Change-Id: Id210ec43501c4e4f3db2c8a0aec25e1d20b18d33 Reviewed-on: https://chromium-review.googlesource.com/475992 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Code refactoring: remove unneeded variables  BUG=angleproject:1996  Change-Id: If635bf836251f90ec40d791b5f80d43f751aad9b Reviewed-on: https://chromium-review.googlesource.com/476079 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Reverse the order of array variable initialization  This works around a bug on Adreno 3xx in which array varying variables are assigned in the reverse order.  BUG=chromium:709317  Change-Id: I86a345747f293ca8a2cb9a281bd1b752e66dcd3a Reviewed-on: https://chromium-review.googlesource.com/475979 Commit-Queue: Kai Ninomiya <kainino@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor remaining GLES 2.0 entry points.  This will pave the way for several features like auto-generation.  BUG=angleproject:747  Change-Id: Ic390ac412f4e6b61346629093f185a4c07ea0284 Reviewed-on: https://chromium-review.googlesource.com/474118 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Update deqp expectations file for default fbo tests.  Deqp test case dEQP-GLES31.functional.fbo.no_attachments.maximums.all fails on nvidia driver.  BUG=angleproject:1594 TEST=dEQP-GLES31.functional.fbo.no_attachments.* TEST=dEQP-GLES31.functional.fbo.completeness.no_attachments  Change-Id: I31db12b10b4fb915135b12912738d9c14de1e585 Reviewed-on: https://chromium-review.googlesource.com/468649 Commit-Queue: Yizhou Jiang <yizhou.jiang@intel.com> Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
ES31: Add array element transformfeedback  This enhances the PackedVarying to be either one element of array or whole array. Correspondingly the VaryingPacking is expanded to pack it properly.  BUG=angleproject:1950  Change-Id: I0529d7ac4367d42b2b433410fbf08351412aada8 Reviewed-on: https://chromium-review.googlesource.com/459115 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
compiler: Prune literal statements when outputting ESSL  The ESSL output doesn't have a default precision for floats this causes float literal statements to not have any precision defined which is an error. We fix this by removing literal statements as they are dead code anyway.  BUG=angleproject:1967  Change-Id: I498f4f8495f854240ee8a2182415bf982c5166a4 Reviewed-on: https://chromium-review.googlesource.com/470268 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Don't allow deleting the 0 transform feedback.  BUG=709786  Change-Id: I956cae994241a650869cee45c471074d08e79a5d Reviewed-on: https://chromium-review.googlesource.com/475131 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix the texture completeness cache.  Two silly mistakes were landed in 9aded1:  * The cache was not updating the sampler state it was using to compare    against new ones.  * The SamplerCompletenessCache entry was being copied and not updated.  BUG=709980  Change-Id: I1914ed30e24b9e48c4504da164f013a637a0b6c2 Reviewed-on: https://chromium-review.googlesource.com/475752 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor Signal utils into template classes.  This will allow us to pass on extra information to the receiving end such as the specific texture levels that are dirty.  BUG=angleproject:1635  Change-Id: Idb7ca1d625499e50e7712c458b694f6e9bfc0595 Reviewed-on: https://chromium-review.googlesource.com/453382 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
ES31: Implement glDispatchCompute for OpenGL backend  This patch refers to https://chromium-review.googlesource.com/c/380639/  BUG=angleproject:1955 TESTCASE=angle_end2end_tests  Change-Id: Iafd7a6ba2d71c0b332d9267a1260d9dbd9800c02 Reviewed-on: https://chromium-review.googlesource.com/462089 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Yunchao He <yunchao.he@intel.com> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Vulkan: Don't finish on swap.  This will enable the next frame to render while the previous frame's command buffers are executing and rendering is happening. This should speed up the Vulkan perf test.  BUG=angleproject:1898  Change-Id: I0820300d7934ef280cf75628239fe40dc96b8242 Reviewed-on: https://chromium-review.googlesource.com/445799 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Obey the bufSize and write to the length parameter in glGetSynciv.  BUG=angleproject:1985  TEST=conformance2/state/gl-object-get-calls  Change-Id: Ic83c408b60d394ff5719beaedc5d4721b7811a47 Reviewed-on: https://chromium-review.googlesource.com/474551 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Need Vulkan stuff for unix too.  Copy the Vulkan-related dependencies into the 'unix' section of the file so we linux bots can build ANGLE's Vulkan backend.  BUG=angleproject:1668  Change-Id: I79e2895b525808072495c7cf18138facef6cc868 Reviewed-on: https://chromium-review.googlesource.com/475085 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor validation of glGetSynciv.  BUG=angleproject:1985  Change-Id: Idf1057e6d8d8c850643e3b2a22be5a881c8a2301 Reviewed-on: https://chromium-review.googlesource.com/474550 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Correctly initialize the condition of FenceSync objects.  The spec says that the initial condition of a FenceSync object should be GL_SYNC_GPU_COMMANDS_COMPLETE.  Make sure this is set in case the condition is queried before the fence is set.  TEST=conformance2/state/gl-object-get-calls.html BUG=602688  Change-Id: I8c0451fc996c175109541f337191cc1be4b813e3 Reviewed-on: https://chromium-review.googlesource.com/457452 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Blit9: Pass the dest rect to setViewportAndShaderConstants.  Using the sourceRect for calculating the viewport and texture coordinates was not enough when the source and destination rectangles were different sizes (generating mipmaps).  BUG=709232  Change-Id: I2704ddf6e3da0939ad77d278ab495e53a2d9bc7d Reviewed-on: https://chromium-review.googlesource.com/473266 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Remove unused declaration  isValidResourceIndex in Program.h is unused.  BUG=angleproject:1920  Change-Id: Ide097348fac7ed97a0e07f3d97d7944ac997f71d Reviewed-on: https://chromium-review.googlesource.com/474229 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix IsOzone() predicate.  ANGLE_USE_OZONE is not defined in tests but USE_OZONE is so use the latter.  BUG=angleproject:1423  Change-Id: Ib758fec6a1bb8d5cc66d0994cba2142e6a7f82b0 Reviewed-on: https://chromium-review.googlesource.com/474113 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Rename BitSetIterator.h to bitset_utils.h  BUG=angleproject:1814  Change-Id: I152ae13b6b7cf0ba72259967f0f124e199b20e07 Reviewed-on: https://chromium-review.googlesource.com/471826 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Vulkan: Fix Clang warning and fix build.  The data_deps section for angle_vulkan was referencing a variable that didn't exist (no warning for this). Fix the deps which also then exposes the build problem with the layers with Clang in 32-bit. Also fix not propagating the Win32 defines to the layer utils.  BUG=chromium:708835  Change-Id: I4a457bfabf1ca735d3f3f3d8b0f0823cfa834b84 Reviewed-on: https://chromium-review.googlesource.com/470087 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Temporarily disable Vulkan for the GN build.  BUG=709342  Change-Id: I980634700d364824af9f9b749fca0ec72abf68f8 Reviewed-on: https://chromium-review.googlesource.com/471507 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Create depth stencils for D3D texture EGL surfaces.  BUG=angleproject:1144  Change-Id: I42d80293c06e40197fe100bcac31a5c6bd414edf Reviewed-on: https://chromium-review.googlesource.com/469106 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Disable ValidationESTest.DrawElementsWithMaxIndexGivesError.  Temporarily until we have a proper fix.  BUG=chromium:708835  Change-Id: I9c1d63d8d1f831f2a4a168149b7ff805bc851def Reviewed-on: https://chromium-review.googlesource.com/469967 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
gpu_info_util: fix a DeviceInfo leak on Windows  BUG=angleproject:1874  Change-Id: I382e306ce0c27a81e0d746fb9922fa12988927d4 Reviewed-on: https://chromium-review.googlesource.com/469230 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Skip a couple end2end tests on Ozone.  Skip the following two end2end tests on Ozone pending investigation:   IndexedPointsTestUShort.VertexWithColorUnsignedShortOffsetChangingIndices/ES2_OPENGLES   SRGBTextureTest.SRGBDecodeTextureParameter/ES2_OPENGLES  BUG=angleproject:1423  Change-Id: Ied5b42903421ae9f388e8563814e3fe28eeb7b3e Reviewed-on: https://chromium-review.googlesource.com/469087 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Vulkan: Only re-create pipeline on state change.  This speeds up the simple perf test but it is a very simple optimization that does not have a cache of pipelines or anything sophisticated.  BUG=angleproject:1898  Change-Id: Iec126bc73bf28f8bb33662a2f70670588f010d72 Reviewed-on: https://chromium-review.googlesource.com/444850 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Allow the OpenGL ES backend to be used with dEQP on Windows.  Change-Id: I79e013ca2be57916affb167f5b348cc414d581ba Reviewed-on: https://chromium-review.googlesource.com/469189 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add IsOzone().  Add a function to check for the Ozone back end for use in skipping tests.  BUG=angleproject:1423  Change-Id: Ida3313e8cce5179422bdca85ba68f9765dfac840 Reviewed-on: https://chromium-review.googlesource.com/469068 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Invalidate completeness caches when enabling extensions.  Enabling extensions can cause framebuffers and textures to go from incomplete to complete.  No functional changes from the API surface.  BUG=angleproject:1523 BUG=angleproject:1958  Change-Id: Iff686e1c292f6cf4921d6fffd7eb98bedaba828b Reviewed-on: https://chromium-review.googlesource.com/468410 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Vulkan: Fix 32-bit Clang build.  We were getting a warning:  stdcall calling convention ignored on variadic function  BUG=None  Change-Id: I9165b285dfaf6bc238f946fda2d733292789390d Reviewed-on: https://chromium-review.googlesource.com/468373 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Clean up legacy code in VertexAttributeTest.cpp  This patch intends to clean up some coding style issues in VertexAttributeTest.cpp which is helpful to implement Vertex Attrib Binding. 1. Use std::string directly instead of macro SHADER_SOURCE 2. Use constexpr on constants 3. Use std::array instead of traditional C-style arrays  BUG=angleproject:1593  Change-Id: I5b6f6d4fe0e34e82a9fc38cb54932fbc39e19a80 Reviewed-on: https://chromium-review.googlesource.com/467406 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Clean up function name mangling code  Fix a few incorrect comments about mangled names and refactor generating mangled names from function call nodes.  BUG=angleproject:1490 TEST=angle_unittests  Change-Id: I3ee68c4c0982f1a9c28d8e87aafa19f19559bbf8 Reviewed-on: https://chromium-review.googlesource.com/465826 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Pass Context to VertexArray and Framebuffer syncstate.  This will enable more Vulkan-friendly idioms like clearing the vulkan pipeline caches correctly on GL state changes immediately because we have access to the ContextVk.  BUG=angleproject:1898  Change-Id: I16c848d8abdde8e26a38d384e565cec8548a66d0 Reviewed-on: https://chromium-review.googlesource.com/459079 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disable the EGLSyncControlTest  This test is very flaky on Windows bots.  TBR=stanisc@chromium.org BUG=angleproject:1402  Change-Id: Iddfc630113c33cb79a96b7882fe8fa0e7fbf17d7 Reviewed-on: https://chromium-review.googlesource.com/468026 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Output the number of columns and rows written for robust ReadPixels.  BUG=angleproject:1354  Change-Id: Ib78f74d7b1a449468e2c477955f6795dc5dbc811 Reviewed-on: https://chromium-review.googlesource.com/463786 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Support D3D texture share handles in the OpenGL backend on Windows.  BUG=angleproject:1144  Change-Id: Ideb0ed306ae8417f53b813745ced43002d028126 Reviewed-on: https://chromium-review.googlesource.com/461271 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use TLValueTrackingTraverser in ValidateLimitations  Use TLValueTrackingTraverser to determine whether a loop index is used as an l-value. This replaces custom logic in ValidateLimitations greatly simplifying the code. Also pass the symbol table to ValidateLimitations as a parameter which removes the need to store a global pointer to the current ParseContext.  BUG=angleproject:1960 TEST=angle_unittests WebGL conformance tests  Change-Id: I122c85c78bbea05833d7c787cd184de568c5c45f Reviewed-on: https://chromium-review.googlesource.com/465606 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Clear11 VerticesTransform RasterizerStates ScissorRect  - Skip clears if an empty scissor rect is set - Use rastStates to apply scissoring instead of recomputing the scissored positions and updating the VB and updating the VB for every clear - Use ComPtrs for VB and RasterizerStates  BUG=angleproject:1934  Change-Id: Ib4448d8568b465df5de57607be4985095f6bd014 Reviewed-on: https://chromium-review.googlesource.com/453881 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update dEQP gles3 tests expectations for Android  Mark tests that fail or hang on Nexus 5X as such.  BUG=angleproject:1532 TEST=gles3 tests pass on Nexus 5X  Change-Id: Id4c31884890bd48595a83be14e8d56342f7fbe59 Reviewed-on: https://chromium-review.googlesource.com/387148 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Re-land: Roll vulkan-validation-layers. (2/2)  https://android.googlesource.com/platform/external/vulkan-validation-layers.git/+log/bcb80d06bbdc09..f47c534fee2f26f  This CL re-enables Vulkan with the new build files.  In particular this roll contains a fix for a vs2017 signed/unsigned mismatch warning as error.  Re-land fixes build dependencies.  BUG=chromium:683729  Change-Id: If2b1bc7250037c33402965eae354ca550ecd36c0 Reviewed-on: https://chromium-review.googlesource.com/466106 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ES31: Add GL_SHADER_STORAGE_BUFFER_BINDING binding point  The affected APIs are below: getIntegeri_v getInteger64i_v BindBuffer BindBufferBase BindBufferRange  BUG=angleproject:1951 TEST=dEQP-GLES31.functional.state_query.integer.shader_storage_buffer_binding_*      dEQP-GLES31.functional.state_query.indexed.shader_storage_buffer_*  Change-Id: Ief7186b2ebe305f14e620c31841bc244f84429a5 Reviewed-on: https://chromium-review.googlesource.com/459093 Reviewed-by: Yunchao He <yunchao.he@intel.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
ES31: Add glGetProgramResourceName API  Add API entry and validation checks(GLES 3.1 section 7.3). Add the first 2 interfaces(PROGRAM_INPUT and PROGRAM_OUTPUT) implementation.  BUG=angleproject:1920  Change-Id: Ide7d5ad40a611a091c3dffab47fd31da57b69f1d Reviewed-on: https://chromium-review.googlesource.com/457523 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Store unmangled function names in the AST  This makes the code simpler across the board. There are a few cases where mangled names still need to be generated in AST traversers but they are outweighed by much leaner output code for all function nodes.  BUG=angleproject:1490 TEST=angle_unittests angle_end2end_tests  Change-Id: Id3638e0fca6019bbbe6fc5e1b7763870591da2d8 Reviewed-on: https://chromium-review.googlesource.com/461077 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Update deqp31 test expectations  Remove the following deqp cases from deqp_gles31_test_expectations.txt since they can pass now due to https://chromium-review.googlesource.com/c/430199/4/src/libANGLE/renderer/d3d/d3d11/renderer11_utils.cpp  BUG=angleproject:1442  TEST=dEQP-GLES31.functional.state_query.integer.max_compute_work_group_invocations_*      dEQP-GLES31.functional.state_query.integer.max_compute_uniform_blocks_*      dEQP-GLES31.functional.state_query.integer.max_compute_texture_image_units_*      dEQP-GLES31.functional.state_query.integer.max_compute_uniform_components_*      dEQP-GLES31.functional.state_query.integer.max_uniform_locations_*      dEQP-GLES31.functional.state_query.indexed.max_compute_work_group_count_*      dEQP-GLES31.functional.state_query.indexed.max_compute_work_group_size_*  Change-Id: I121588cdb5d5b67c5b1d76e8710b2f53f35ede15 Reviewed-on: https://chromium-review.googlesource.com/461732 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Yunchao He <yunchao.he@intel.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Prefer identifying functions by using symbol ids  The shader translator code is now structured in a way that ensures that all function definition function prototype and function call nodes store the integer symbol id for the function. This is guaranteed regardless of whether the function node is added while parsing or as a result of an AST transformation. TIntermAggregate nodes which include function calls and constructors can now only be created by calling one of the TIntermAggregate::Create*() functions to ensure they have all the necessary properties.  This makes it possible to keep track of functions using integer ids instead of their mangled name strings when generating the call graph and when using TLValueTrackingTraverser.  This commit includes a few other small cleanups to the CallDAG class as well.  BUG=angleproject:1490 TEST=angle_unittests angle_end2end_tests  Change-Id: Idd1013506cbe4c3380e20d90524a9cd09b890259 Reviewed-on: https://chromium-review.googlesource.com/459603 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Validate clear attachment formats match color clear types.  TEST=conformance2/rendering/clear-func-buffer-type-match.html  BUG=angleproject:1954  Change-Id: Iefeb38041608f11781f87aadb8611737ba2ee96f Reviewed-on: https://chromium-review.googlesource.com/461270 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Adjust the FBO invalidate attachment enums for emulated default FBOs.  BUG=angleproject:1953  Change-Id: I7f325e3b7400e12077cdf9106a83a747a318a299 Reviewed-on: https://chromium-review.googlesource.com/461297 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Strip null characters from the shader source when building translated source.  Some shaders had trailing null characters that caused the resulting translated source string to not output correctly.  BUG=angleproject:1144  Change-Id: I7cd725ee54c9e934fd3cc511de9c2a3c34ac3eec Reviewed-on: https://chromium-review.googlesource.com/461272 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
gpu_info_util: Implement GetSystemInfo on Windows  BUG=angleproject:1874  Change-Id: I97a02d2c8b1f7ecb530684464fc02f528d34de7c Reviewed-on: https://chromium-review.googlesource.com/458965 Reviewed-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Apply WebGL validation to glVertexAttribIPointer.  TEST=deqp/functional/gles3/shaderstatequery.html BUG=angleproject:1523 BUG=chromium:668223  Change-Id: I24230144f8529d84cdbde3d5a8ad9178481550a9 Reviewed-on: https://chromium-review.googlesource.com/458680 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
ES31: Implement Vertex Attrib Binding entry points  This patch intends to implement all entry points related to Vertex Attrib Binding.  (1) Add entry points and validation code on following APIs:    - VertexAttribFormat    - VertexAttribIFormat    - VertexAttribBinding    - BindVertexBuffer    - VertexBindingDivisor (2) Add queries on following parameters:    - VERTEX_ATTRIB_BINDING    - VERTEX_ATTRIB_RELATIVE_OFFSET    - VERTEX_BINDING_DIVISOR    - VERTEX_BINDING_OFFSET    - VERTEX_BINDING_STRIDE    - VERTEX_BINDING_BUFFER  BUG=angleproject:1593  TEST=angle_end2end_tests TEST=angle_unittests TEST=dEQP-GLES31.functional.state_query.integer.max_vertex_attrib_relative_offset_* TEST=dEQP-GLES31.functional.state_query.integer.max_vertex_attrib_bindings_* TEST=dEQP-GLES31.functional.state_query.integer.max_vertex_attrib_stride_* TEST=dEQP-GLES31.functional.state_query.vertex_attribute_binding.* TEST=dEQP-GLES31.functional.debug.negative_coverage.log.vertex_array.vertex_attrib_pointer TEST=dEQP-GLES31.functional.debug.negative_coverage.get_error.vertex_array.vertex_attrib_format TEST=dEQP-GLES31.functional.debug.negative_coverage.get_error.vertex_array.vertex_attrib_i_format  Change-Id: I4b477a82df6aad89b89b088580a06d66963e6666 Reviewed-on: https://chromium-review.googlesource.com/446124 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
ES31: Implement DrawElementsIndirect D3D part  The implementation of DrawElementsIndirect is similar with DrawArraysIndirect except that it needs to apply IndexBuffer.  BUG=angleproject:1595 TEST=dEQP-GLES31.functional.draw_indirect.draw_elements_indirect*      dEQP-GLES31.functional.draw_indirect.instancing.*      dEQP-GLES31.functional.draw_indirect.random.*  Change-Id: I5d2c8a7485b18b724fdda6fd964013c941e45b4f Reviewed-on: https://chromium-review.googlesource.com/455520 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Roll vulkan-validation-layers. (2/2)"  This reverts commit 2feaa5e0ac6b779e13254c84b41de436f5d14765.  Reason for revert: Broke the Chrome Windows builders.  Build: https://build.chromium.org/p/chromium/builders/Win/builds/53432 Error: src\third_party\vulkan-validation-layers\src\include\vulkan\vk_layer.h(39): fatal error C1083: Cannot open include file: 'vk_layer_dispatch_table.h': No such file or directory  Original change's description: > Roll vulkan-validation-layers. (2/2) >  > https://android.googlesource.com/platform/external/vulkan-validation-layers.git/+log/bcb80d06bbdc09..f47c534fee2f26f >  > This CL re-enables Vulkan with the new build files. >  > In particular this roll contains a fix for a vs2017 signed/unsigned > mismatch warning as error. >  > BUG=chromium:683729 >  > Change-Id: Id38e10f97702cac5a51ee194c81972861f15db21 > Reviewed-on: https://chromium-review.googlesource.com/457278 > Commit-Queue: Jamie Madill <jmadill@chromium.org> > Reviewed-by: Jamie Madill <jmadill@chromium.org> >   TBR=geofflang@chromium.orgjmadill@chromium.orgbungeman@chromium.orgcwallez@chromium.org # Not skipping CQ checks because original CL landed > 1 day ago. BUG=chromium:683729  Change-Id: Ic60f22496fc57904132d574a2fb2c1ca4d875b3e Reviewed-on: https://chromium-review.googlesource.com/461999 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
ES31: Add PROGRAM_SEPARABLE to ProgramParameter and GetProgram  BUG=angleproject:1939 TEST=angle_end2end_tests  Change-Id: I97ad11360f7c015947a2c0cc7d4a47f994726834 Reviewed-on: https://chromium-review.googlesource.com/454264 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Set sampler uniform values from binding qualifiers  The usual set uniform call is used to set initial sampler uniform values based on binding layout qualifiers. This is the simplest way to ensure that the uniform values are set correctly in both internal data structures of the Program class and on the different backends. This is done as one of the last steps of program linking.  TEST=dEQP-GLES31.functional.uniform_binding.sampler* BUG=angleproject:1442  Change-Id: I2f58c98e175f6a10a90042050f4fcbea77ad97ac Reviewed-on: https://chromium-review.googlesource.com/456597 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update CHROMIUM_copy_texture entry points to the ES3 versions.  BUG=angleproject:1932  Change-Id: Ia45f8522320af1d747fbfb57468e8b881b033543 Reviewed-on: https://chromium-review.googlesource.com/459101 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Re-land eglGetSyncValuesCHROMIUM extension.  This reverts commit 20c97cac2a15144b61ceec7404a9e6249c40f50a and adds a few trivial changes to make it build with the current version of ANGLE code.  Please see https://bugs.chromium.org/p/chromium/issues/detail?id=614147 for more details on how this extension will be used.  Original description:  This change adds implementation of eglGetSyncValuesCHROMIUM extension on D3D11 with Direct Composition. This should work on Windows 8.1 and above.  The implementation is based on IDXGISwapChain::GetFrameStatistics.  Extension documentation: https://chromium.googlesource.com/chromium/src/gpu/+/master/GLES2/extensions/CHROMIUM/EGL_CHROMIUM_get_sync_values.txt  BUG=angleproject:1402  Change-Id: I4b77899f31a4c4cf1fa7f20ab12de5a02ccf74d8 Reviewed-on: https://chromium-review.googlesource.com/459217 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Roll vulkan-validation-layers. (2/2)  https://android.googlesource.com/platform/external/vulkan-validation-layers.git/+log/bcb80d06bbdc09..f47c534fee2f26f  This CL re-enables Vulkan with the new build files.  In particular this roll contains a fix for a vs2017 signed/unsigned mismatch warning as error.  BUG=chromium:683729  Change-Id: Id38e10f97702cac5a51ee194c81972861f15db21 Reviewed-on: https://chromium-review.googlesource.com/457278 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor glVertexAttribIPointer validation.  BUG=angleproject:1523 BUG=chromium:668223  Change-Id: I51eca98ad14d8be6f5009149ed6c0daecf569178 Reviewed-on: https://chromium-review.googlesource.com/458106 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Roll vulkan-validation-layers. (1/2)  https://android.googlesource.com/platform/external/vulkan-validation-layers.git/+log/bcb80d06bbdc09..f47c534fee2f26f  Disables Vulkan in ANGLE temporarily - a second CL will follow with the updated build files once ANGLE is rolled into Chrome.  In particular this roll contains a fix for a vs2017 signed/unsigned mismatch warning as error.  BUG=chromium:683729  Change-Id: Ib23370d79f1359ab290f08e14a847eed75251660 Reviewed-on: https://chromium-review.googlesource.com/458531 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ES31: Add glGetProgramResourceIndex API  Add API entry and validation checks(GLES 3.1 section 7.3). Add the first 2 interfaces(PROGRAM_INPUT and PROGRAM_OUTPUT) implementation.  BUG=angleproject:1920  Change-Id: Ib2dedded9fd79b315e9f38de7c27a5e4ec4c6066 Reviewed-on: https://chromium-review.googlesource.com/453085 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Vulkan: Enable command queueing.  This adds the ability for rendering to happen asynchronously. If objects in-use are deleted as they are being accessed ownership is transferred to the Renderer and they are deleted when not in use. We determine they're ready for delete using a Fence object.  BUG=angleproject:1898  Change-Id: I4fcfd90ad0665d127bf01a10214a604f3407d9e4 Reviewed-on: https://chromium-review.googlesource.com/428353 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add support for EXT_YUV_target  Add new sampler type "__samplerExternal2DY2YEXT" to sample a YUV texture image and output color value without any color conversion new additional type to specify color space standard formula and built-in functions for yuv to rgb transformation.  Change-Id: I1780650fe84cd75191c1ca1e4118e89d585bfd92 Reviewed-on: https://chromium-review.googlesource.com/454697 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Roll gyp and use Windows 10 SDK by default.  We want to require use of the Windows 10 SDK in ANGLE - Chrome already uses a newer SDK.  A new gyp feature added by munyirik@microsoft.com allows us to use the latest Win 10 SDK installed on the system irrespective of the minor version number.  Also update the docs.  BUG=angleproject:1943  Change-Id: Iaafbba858fb7565ab09672eadc403dbb8abab3dd Reviewed-on: https://chromium-review.googlesource.com/458516 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
RenderstateCache and Clear11 Optimizations  - Unify DepthStencilState and BlendState caches in RenderStateCache with those in Clear11. This will increase cache hit rate and reduce memory usage. - Apply DepthStencilState and BlendState only when required to reduce state sets.  BUG=angleproject:1632  Change-Id: I244e3ba189f82814638fa90e2617aa5441024d0f Reviewed-on: https://chromium-review.googlesource.com/453888 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update testing documentation.  BUG=angleproject:1944  Change-Id: Iac643f896cfb4c8c23474c744fcb2a073207db26 Reviewed-on: https://chromium-review.googlesource.com/457430 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make sure the default framebuffer has enough draw buffer states.  Querying the draw buffer states of the default framebuffer would lead to crashes because it only had one state.  The spec says that all non-zero attachments default to GL_NONE and makes no mention of special cased errors for querying the default framebuffer.  Also fix the validation to check for extensions and ES version when querying draw buffer state.  BUG=703508  Change-Id: I7db5443141c65a3f9c638f07ba90f78d76e4e7b4 Reviewed-on: https://chromium-review.googlesource.com/457524 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ES31: Add workaround for illegal MAX_VERTEX_ATTRIB_STRIDE on Linux AMD  Query of MAX_VERTEX_ATTRIB_STRIDE on some Linux AMD OpenGL drivers returns 0 even if the context is OpenGL 4.4 and 4.5 which is against SPEC and will block the implementation of ES3.1 feature Vertex Attrib Binding.  This patch adds the workaround for this bug by choosing an emulated value (2048) as the value of MAX_VERTEX_ATTRIB_STRIDE on Linux AMD OpenGL drivers.  BUG=angleproject:1936  TEST=angle_end2end_tests  Change-Id: I831bda6cb94b2489d09735622150d35aa1948274 Reviewed-on: https://chromium-review.googlesource.com/457254 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
BUILD.gn: declare_args() use_lipci  This is the third stage of 05356e35d363355c9510f3ef9eb8e639db3900bc and is necessary for projects putting use_libpci in the gn args like headless Chrome.  BUG=angleproject:1874  Change-Id: I03a010ababf08f992f0fb26ff87ddc48afd5a237 Reviewed-on: https://chromium-review.googlesource.com/457277 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Preserve ImageIndex of texture attachments when committing.  When calling Framebuffer::commitWebGL1DepthStencilIfConsistent with textures attached to depth or stencil an invalid ImageIndex would be provided and later cause crashes when trying to index image arrays with a -1 mip level.  BUG=angleproject:1708  Change-Id: Iadd159ad740aa79561de823d8812c6b07454e5e5 Reviewed-on: https://chromium-review.googlesource.com/456840 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Allow enabling GL_EXT_texture_filter_anisotropic.  BUG=angleproject:1721  Change-Id: I7cbc734915cde7d09165a3fcfe9a6bc0d7149aff Reviewed-on: https://chromium-review.googlesource.com/445959 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D11: Work around compiler nested sampling bug.  We can potentially work around a bug in the HLSL compiler by omitting the const qualifier from some sampling operations.  BUG=angleproject:1923  Change-Id: I8a5d119707721e9c19f06be4ad808f87bfcdbee5 Reviewed-on: https://chromium-review.googlesource.com/454938 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove unused/unnecessary stuff.  Change-Id: Ib409fee5422765cc4124a59a690a93c0fb2de8e7 Reviewed-on: https://chromium-review.googlesource.com/456123 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Lift uniform packing test suppressions.  These were to be lifted in "Fix non-square matrix uniform packing."  BUG=angleproject:1923  Change-Id: I6c5cc973f9dff31ffefdfda9fe640b97d28799ad Reviewed-on: https://chromium-review.googlesource.com/455466 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix non-square matrix uniform packing.  This was broken in two places: the register count was using the non- transposed matrix row count. The block layout encoder was also not set to transpose matrices which was causing incorrect packing info to be calculated in link.  BUG=angleproject:1923  Change-Id: I89094aa116fad4bda15f018498f8637520f12bd4 Reviewed-on: https://chromium-review.googlesource.com/454876 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Refactor the staticUse checks for attribute and output  Remove these needless checks as GetActiveShaderVariables in Shader.cpp has filtered them already.  BUG=angleproject:1920  Change-Id: Ife85614a8f636768dd585a827bca81e2f15009c8 Reviewed-on: https://chromium-review.googlesource.com/454129 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
WebGL Compat: make sure to test the correct error  In ForbidsClientSideElementArrayBuffer we test that WebGL Compatibility returns a GL_INVALID_OPERATION but on NVIDIA Shield the pointer had the top bit set and caused a GL_INVALID_VALUE to be generated instead. Use a intptr_t(1) for indices to test the correct error.  BUG=angleproject:1523  Change-Id: I1497694264befa14b2b6df167b4f20fdbb707983 Reviewed-on: https://chromium-review.googlesource.com/452547 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix build failure in UniformLinker.cpp on Linux  This patch adds the declaration of libANGLE/features.h in UniformLinker.cpp to fix the build failure on Linux when you use gn to build ANGLE alone.  BUG=angleproject:1938  Change-Id: I19636df8f81b307e6d2e08fdac286cfb3f705eab Reviewed-on: https://chromium-review.googlesource.com/454083 Reviewed-by: Yunchao He <yunchao.he@intel.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ES31: Implement DrawArraysIndirect D3D part  There are four buffer types for vertex attribute storage in D3D11:   DIRECT   STATIC   DYNAMIC   CURRENT_VALUE  When drawing it will call applyVertexBuffer to bind the right type buffers in D3D11.  DIRECT uses the gl buffer directly without any translation.  CURRENT_VALUE uses a single value for the attribute.  STATIC translates the whole vertex buffer once. So it doesn't need the first count and instance informations since it always translates the whole buffer.  DYNAMIC translates the data every frame. To improve the performance in implementation it only translates 'count' vertexes from 'first' location in vertex buffer with one drawing for non-instanced vertices. 'first' and 'count' are got from draw parameter list. And for the translated vertex buffer when drawing the first vertex location is 0.  From above analysis we can see that if all attribute storages are non-dynamic we can directly use the indirect buffer to draw. But for dynamic storages we have to calculate the first count and instances from indirect buffer and apply them to translate the dynamic type buffers. Meanwhile we have to set the first to 0 (see above description)when drawing.  DrawArrysIndirect implementation is like below: 1. Check whether all vertex attributes are non-dynamic 2. If yes applyVertexBuffer and DrawInstancedIndirect 3. If no 1) calculate first count and instances from indirect buffer.           2) applyVertexBuffer with these parameters.           4) Use DrawInstanced instead of DrawInstancedIndirect.  BUG=angleproject:1595 TEST=dEQP-GLES31.functional.draw_indirect.draw_arrays_indirect*  Change-Id: I36431f416443279d51de523b07ce60727914cbbf Reviewed-on: https://chromium-review.googlesource.com/446690 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
RenderStateCache BlendState Hash Fix  Fix hash function for blendState cache  BUG=angleproject:1937  Change-Id: I0acd7dfcfb933b2b7ff0c1dc6854c7623ec57b3b Reviewed-on: https://chromium-review.googlesource.com/453887 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
RenderStateCache memory usage  Reduce RenderStateCache cache sizes from 4k to 2k. Saves 64kb of memory.  Change-Id: I9e92bbdf095f1e66cf9b84ba81899a8af59d6d86 Reviewed-on: https://chromium-review.googlesource.com/453886 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disable VertexAttributeTestES31.MaxVertexAttribStride on Linux AMD GL  Due to AMD driver bug.  BUG=angleproject:1593  Change-Id: Ic1fee717ffb55c67d3c4d0a43848d73ed6794732 Reviewed-on: https://chromium-review.googlesource.com/452940 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Reland "ES31: Add test on large strides"  In OpenGL 4.3 there is no limit on the maximum value of stride. This patch choose an emulated value for OpenGL 4.3 to fix the fyi failure on Linux AMD.  BUG=angleproject:1593  Change-Id: I83cecc2ed1a3734dc8b8df3edb48ecc16039ba6e Reviewed-on: https://chromium-review.googlesource.com/452746 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Move default-block uniform linking to a separate file  The code is easier to understand when it's encapsulated better.  This change is pure refactoring with no functional changes.  BUG=angleproject:1442 TEST=angle_end2end_tests  Change-Id: I6128fd72c65ca7a87af596cda4866c74c2a66c48 Reviewed-on: https://chromium-review.googlesource.com/452502 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement robust buffer initialization.  This uses the most simple implementation: on BufferData calls without explicit data arguments it will initialize the buffer data store to zero. This could be improved by deferring the init until needed and skipping it if the buffer store is cleared through other API calls but it is not a regression from current Chromium implementation.  BUG=angleproject:1635  Change-Id: I2fb1594851c5050dc2578736c3f74761555da267 Reviewed-on: https://chromium-review.googlesource.com/450921 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "ES31: Add test on large strides"  This is failing on Linux AMD: https://luci-logdog.appspot.com/v/?s=chromium%2Fbb%2Fchromium.gpu.fyi%2FLinux_Release__AMD_R7_240_%2F1729%2F%2B%2Frecipes%2Fsteps%2Fangle_end2end_tests%2F0%2Fstdout  ../../third_party/angle/src/tests/gl_tests/VertexAttributeTest.cpp:684: Failure Expected: (maxStride) >= (2048) actual: 0 vs 2048  This reverts commit 0ba963ef27d1d656986f2f4382391dd5da8c8104.  Reason for revert: <INSERT REASONING HERE>  Original change's description: > ES31: Add test on large strides >  > ES3.1 requires the implementation should define MAX_VERTEX_ATTRIB_STRIDE > which should be emulated when we use D3D11 backends. >  > This patch adds tests to verify this value required in ES3.1 are > supported to be used directly in glVertexAttribPointer for rendering. >  > BUG=angleproject:1593 >  > TEST=angle_end2end_tests >  > Change-Id: I1ac206e4f6c972b5748552177c787c0adcb66786 > Reviewed-on: https://chromium-review.googlesource.com/441308 > Commit-Queue: Yuly Novikov <ynovikov@chromium.org> > Reviewed-by: Yuly Novikov <ynovikov@chromium.org> >   TBR=ynovikov@chromium.orggeofflang@chromium.orgjmadill@chromium.orgcwallez@chromium.orgyunchao.he@intel.comqiankun.miao@intel.comjiawei.shao@intel.comyang.gu@intel.com NOPRESUBMIT=true NOTREECHECKS=true NOTRY=true BUG=angleproject:1593  Change-Id: I036da9d6d5633bcc055cc8cfbfde9a15ae67f59c Reviewed-on: https://chromium-review.googlesource.com/452743 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
end2end_tests: Adds more skips for new tests and testers  BUG=angleproject:1924  Change-Id: I3ca25545632c9884eb1a8dba5e8e402b14324f80 Reviewed-on: https://chromium-review.googlesource.com/451877 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement location layout qualifier for uniforms  This is a complete implementation of the uniform location layout qualifier. Uniform location set in the shader is plumbed to shader linking which does several link-time checks for conflicts and recursively applies the location to struct members.  Validate that location is consistent as specified in the table in section 9.2.1 of the ESSL 3.10.4 spec. The location set in the shader overrides the one set via the CHROMIUM_bind_uniform_location API.  Location conflicts must be checked even if the uniforms are not statically used. Because of this unused uniforms are now recorded during uniform linking. After linking checks are done unused uniforms are pruned from the program state.  Location is validated against the maximum number of uniform locations at compile time as specified in section 4.4.3 of the ESSL 3.10.4 spec.  All dEQP uniform location tests don't yet pass due to unrelated bugs.  BUG=angleproject:1442 TEST=angle_end2end_tests dEQP-GLES31.functional.uniform_location.*  Change-Id: I1f968e971f521fbc804b01e1a7c2b4d14f24d20f Reviewed-on: https://chromium-review.googlesource.com/447942 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
ES31: Add test on large strides  ES3.1 requires the implementation should define MAX_VERTEX_ATTRIB_STRIDE which should be emulated when we use D3D11 backends.  This patch adds tests to verify this value required in ES3.1 are supported to be used directly in glVertexAttribPointer for rendering.  BUG=angleproject:1593  TEST=angle_end2end_tests  Change-Id: I1ac206e4f6c972b5748552177c787c0adcb66786 Reviewed-on: https://chromium-review.googlesource.com/441308 Commit-Queue: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
WebGLCompatibility: Add test for "negative" offset in DrawElements  BUG=angleproject:1523 BUG=chromium:668223  Change-Id: I2d21c15b53fa204b3cb2b0be849cfe91ca63046b Reviewed-on: https://chromium-review.googlesource.com/435884 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11 FL9_3: Fix bug in R32F vertex format emulation.  We would allow direct storage when this format is emulated. Noticed this when making a test which used a single float vertex format.  BUG=angleproject:1635  Change-Id: Ia2164b0f311b27f24b6aa7760eb9f9a3834c6044 Reviewed-on: https://chromium-review.googlesource.com/451578 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Plumb robust resource init extensions.  This also cleans up a few minor glitches in the extension texts and renames the EGL extension for consistency.  It incidentally fixes a bug in our EGL init where we were checking the wrong client versions for KHR_create_context.  It also implements a new feature for tests which allow them to defer Context creation until the test body. This allows tests to check for EGL extension available before trying to create a context with certain extensions.  BUG=angleproject:1635  Change-Id: I9311991332c357e36214082b16f2a4a57bfa8865 Reviewed-on: https://chromium-review.googlesource.com/450920 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
WebGL validation of constant color & alpha blend.  In WebGL generate INVALID_OPERATION if constant color and constant alpha are used together as source and destination blend functions.  BUG=angleproject:1817  Change-Id: I9b2d05ab5017c013bb89c13256efbd80198de91b Reviewed-on: https://chromium-review.googlesource.com/448940 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Reduce the number of iterations of SwizzleTest.  KHR_debug from the GL drivers was generating a lot of spam.  BUG=angleproject:1925  Change-Id: I89568ea2bec3afb629f86c25d9e80aad1dbe79f8 Reviewed-on: https://chromium-review.googlesource.com/450857 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix translating dynamic indexing of swizzle to HLSL  This was broken due to a simple omission in deep copying swizzle AST nodes.  It was found that several if not most OpenGL drivers also have some issue related to this so the end2end test is suppressed on many OpenGL platforms. Intel Windows driver seems to be behaving correctly.  BUG=angleproject:1921 TEST=angle_end2end_tests  Change-Id: Ieefcedc2f2e36c3d8b607c28e449b696b8ad6892 Reviewed-on: https://chromium-review.googlesource.com/449717 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Make ScratchBuffer its own type.  This helper tool in Renderer11 can be useful in other back-ends or even in the front end.  BUG=angleproject:1635  Change-Id: I18ec19a891a9bdfa7b80dea1b8e308abf206906b Reviewed-on: https://chromium-review.googlesource.com/450919 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Buffer: Minor error macro cleanups.  Refactoring patch only.  BUG=angleproject:1635  Change-Id: I9b86fc77f8f62a0f67f9fc73debdc8fb5e379bcc Reviewed-on: https://chromium-review.googlesource.com/450918 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
BUILD.gn: do not redefine use_libpci if already present  We want to move the definition of use_libpci from gpu/config to ANGLE. To avoid breaking compilation we should do it in three steps:  - Make ANGLE not redefine use_libpci  - Remove definition of use_libpci from Chrome  - Make ANGLE define use_libpci unconditionnaly  This commit is the first step.  BUG=angleproject:1874  Change-Id: I08d0996ca536c51e1617f656171d696f05605725 Reviewed-on: https://chromium-review.googlesource.com/450037 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Validate invariance of built-in variables when linking  According to ESSL 1.00.17 paragraph 4.6.4  BUG=angleproject:1876  Change-Id: I61e142c31dce11eec28fe240a9bc9ce2c632daf6 Reviewed-on: https://chromium-review.googlesource.com/446870 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Code refactoring for getters and setters.  The entry point should call into Context at first for getters and setters.  BUG=angleproject:1922  Change-Id: Ibc8f726298cf334a6dafd6402e39c4dcd7e6d333 Reviewed-on: https://chromium-review.googlesource.com/450028 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implements ETC lossy decode for ETC2 formats.  This is the 2nd payload of GL_ANGLE_lossy_etc_decode feature. In this change RGB8 SRGB8 RGB8A1 and SRGB8A1 formats in ETC2 family can be converted to BC1.  BUG=angleproject:1285  Change-Id: I96fe2f07c62716a31d37f20a202b6cabbb4ebbd2 Reviewed-on: https://chromium-review.googlesource.com/447846 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
ES31:Check framebuffer status for multisample and default params  This patch implements FRAMEBUFFER_INCOMPLETE_MULTISAMPLE checking for checkFramebufferStatus and also modify conditions of FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENTS when setting default parameters to fbo.  BUG=angleproject:1594 TEST=angle_end2end_tests --gtest_filter=FramebufferTest_ES31* TEST=dEQP-GLES31.functional.texture.multisample.negative.fbo_attach_different_fixed_state_tex*  Change-Id: I86954056d3a5d89dca517b267bd16e17b70e5652 Reviewed-on: https://chromium-review.googlesource.com/437991 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Increment ANGLE_SH_VERSION after ShaderVars API change  This was accidentally left out of commit 547cbd461b9167f7df975ccc1ed4e7d469a3e751 "Validate uniform binding at link time".  BUG=angleproject:1893  Change-Id: I945608fd9aef8a605d69f1109ead2460aab0c228 Reviewed-on: https://chromium-review.googlesource.com/448456 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Avoid redundant INSERT_PROC_ADDRESS calls  PVS-Studio pointed out that seven GL functions were being initialized twice. This isn't critical but is slightly inefficient.  R=jmadill@chromium.org BUG=697659  Change-Id: I199bd06ae1136bc3b8efd519787d89f4447f326d Reviewed-on: https://chromium-review.googlesource.com/448639 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Validate uniform binding at link time  GLSL ES Spec 3.10.4 section 4.4.5 has the rules for linking uniforms with binding layout qualifiers. If a binding layout qualifier for a uniform variable is specified in both vertex and fragment shaders the qualifiers must match.  BUG=angleproject:1893 TEST=dEQP-GLES31.functional.layout_binding.*binding_contradictory*  Change-Id: I0ae6a1a8967df818be8136510c22daee848b9da7 Reviewed-on: https://chromium-review.googlesource.com/447557 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Unify and simplify shader variable collection  Instead of setting variable information in both CollectVariables and the GetVariableTraverser helper class it uses keep all of this functionality in CollectVariables. A single helper function handles setting variable information that doesn't depend on variable type and the rest is done in "record" functions that are implemented for each variable type.  This removes templates from the code making it leaner and easier to understand and will help with implementing future features like adding binding and location layout qualifiers for uniforms.  BUG=angleproject:1442 TEST=angle_unittests angle_end2end_tests      dEQP-GLES2.functional.shaders.*  Change-Id: I79148b7b3fa9cb46634a22bdcc9ce0c04f970384 Reviewed-on: https://chromium-review.googlesource.com/446838 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make ozone backend work if it can't display.  The ozone backend will no longer fail if it is unable to display on screen for any reason.  It no longer assumes it can control the first screen it finds.  BUG=angleproject:1423  Change-Id: I5d5274c54b1bc6de50e704903391bf6161efa487 Reviewed-on: https://chromium-review.googlesource.com/445805 Commit-Queue: Frank Henigman <fjhenigman@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix GCC build  Change-Id: I30e6e8d82821ed86cc7f53a48b1b23fc0cbf060c Reviewed-on: https://chromium-review.googlesource.com/446866 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
DisplayGLX: Create a highest version core profile context.  Previously the code was hitting a weirdness of glXCreateConfigAttrib where a compatilibility context was created even if the core profile bit was set.  BUG=chromium:694877  Change-Id: I17164d620b39a26d73e34e1fc8de0ef66aef80f4 Reviewed-on: https://chromium-review.googlesource.com/446673 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Vulkan: Initial command queueing implementation.  This removes the sychronous operation of the command buffers. It also introduces a serial type for assigning ids to queue operations. This gives us the ability to manage lifetimes of resources and track when they're no longer in use on the device.  BUG=angleproject:1898  Change-Id: I91a4836d3098f1d7bd06cd389d88601a3a4826ab Reviewed-on: https://chromium-review.googlesource.com/428352 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
ES31: Add GL_ATOMIC_COUNTER_BUFFER_BINDING binding point  BUG=angleproject:1729 TEST=dEQP-GLES31.functional.state_query.integer.atomic_counter*      dEQP-GLES31.functional.state_query.indexed.atomic_counter*      angle_end2end_tests:AtomicCounterBufferTest  Change-Id: I059c4e22e04cedec9134ec9f631de33f77b1fbe2 Reviewed-on: https://chromium-review.googlesource.com/430959 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
WebGL Compat: Add DEPTH_STENCIL attachments.  This is a special WebGL 1 binding point that does not correspond to any native functionality. Due to particularities in validation we need to represent this with additional state in the Framebuffer. WebGL 2 fixes this oddity by resolving to the GLES 3 native spec.  In order to pass the WebGL framebuffer objects test we will also need a chromium-side CL to work with the additional state tracking it does in the blink layer and an additional patch to ANGLE to clear the depth buffer before the first use (robust resource init).  BUG=angleproject:1708  Change-Id: I111f8f5a451cce7de6cf281a6bc335b92dd2daf2 Reviewed-on: https://chromium-review.googlesource.com/444095 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Check for getColorAttachment returning null before using it.  BUG=angleproject:1916  Change-Id: I98413198089081cc354e9e14dff95f233c3f34ff Reviewed-on: https://chromium-review.googlesource.com/446044 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ASTMetadataHLSL: handle WebGL2 gradient builtins  BUG=angleproject:1915  Change-Id: Id54e6dd417a1a288c71355e74184366d1492e92b Reviewed-on: https://chromium-review.googlesource.com/446521 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Make Framebuffer backbuffer constructor take Surface.  This allows the Framebuffer to initialize all the attachment info internally. This in turn will allow us to clean up the way we validate WebGL1 depth/stencil attachments.  BUG=angleproject:1708  Change-Id: I8871a9791dfce0ac806f4e1367a521610e5283ae Reviewed-on: https://chromium-review.googlesource.com/446130 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
gpu_info_util: Implement GetSystemInfo on OSX  Also adds a test that prints the gathered information for manual checking and to help know what the system is when looking at the logs.  BUG=angleproject:1874  Change-Id: Icb0cc390c9808fd8db0f966d667b94dde4b94e62 Reviewed-on: https://chromium-review.googlesource.com/443845 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Update Android instructions  How to get TestResults.qpa  BUG=angleproject:1607 angleproject:1690  Change-Id: Id1ea934fe4917baf4f9ba47d5d0b5d415077241e Reviewed-on: https://chromium-review.googlesource.com/445962 Commit-Queue: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Vulkan: Use Mailbox present mode when possible.  This is a hack to force an equivalent of eglSwapInterval(0) for perf testing on the bots. This isn't quite the same as Immediate but Immediate doesn't seem to be as widely available.  BUG=angleproject:1898  Change-Id: I3c5053e58969ba48f4f8595138e8fd38ea059bf6 Reviewed-on: https://chromium-review.googlesource.com/445798 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ES3.1: Move FramebufferParameteri and GetFramebufferParameteriv to context.  Follow-up of the cl implementing fmamebuffer parameters api (https://chromium-review.googlesource.com/c/412126/). Moving entry point function FramebufferParameteri and GetFramebufferParameteriv to context according to Jamie's commemts.  BUG=angleproject:1594 TEST=dEQP-GLES31.functional.state_query.framebuffer_default.framebuffer_default*  Change-Id: Ib8a286afe97716576cf5d0a5338eee6588a4e25c Reviewed-on: https://chromium-review.googlesource.com/444283 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Yunchao He <yunchao.he@intel.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Clarify code around setting uniform locations  Use the name "uniformLocationBindings" for location information set by the API instead of "uniformBindings" which can be easily confused with binding layout qualifiers that can be set for some types of uniforms. Also use more straightforward names throughout the indexUniforms function.  BUG=angleproject:1442  Change-Id: I47d504479b36def696305f060e9c9bd3de3ade48 Reviewed-on: https://chromium-review.googlesource.com/445236 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Restore Default Platform logging to stderr  Was lost in https://chromium-review.googlesource.com/434188  Also don't reset pre-set Platform to Default otherwise Chrome's platform gets reset.  BUG=angleproject:1660 angleproject:1892  Change-Id: I052c86c513c8d89d2420a4724a8bd0dc7446c7c2 Reviewed-on: https://chromium-review.googlesource.com/444928 Commit-Queue: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove unused parameters of StoreStaticAttrib  The parameters count and instances in VertexDataManager::StoreStaticAttrib are never used in the function body. So this patch will remove them.  BUG=none  Change-Id: Ic3fe21ae50e5016145bfd0c78542540c8ec76fd2 Reviewed-on: https://chromium-review.googlesource.com/445337 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Yunchao He <yunchao.he@intel.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't use GL_FRAMEBUFFER_SRGB unless available.  Don't try to enable or disable GL_FRAMEBUFFER_SRGB unless extensions.sRGBWriteControl is true.  For example if you try it with Mesa GLES2 you get a GL error.  BUG=angleproject:1896  Change-Id: I5f5b4e8ea4f5a7c6913f27761a6e2dc88aacc78c Reviewed-on: https://chromium-review.googlesource.com/443824 Commit-Queue: Frank Henigman <fjhenigman@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
WebGL Compat: Add DEPTH_STENCIL renderbuffers.  This special internal format was defined in the WebGL 1 spec as a special unsized format with at least 16 bits of depth and at least 8 bits of stencil. Intenally ANGLE will translate this to packed 24/8 depth/stencil.  The new test is adapted from the WebGL test: conformance/renderbuffers/framebuffer-object-attachment  BUG=angleproject:1708  Change-Id: I44b03e41889eed02481f603b8d52c530dcfed5ce Reviewed-on: https://chromium-review.googlesource.com/442094 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ES31: Refactor VertexArray for Vertex Attrib Binding  OpenGL ES3.1 feature Vertex Attrib Binding requires vertex arrays should be split into two arrays: 1. an array of vertex buffer binding points each of which specifies:   - a bound buffer object   - a starting offset for vertex attribute data in that buffer object   - a stride used by all attributes using that binding point   - a frequency divisor used by all attributes using that binding point. 2. an array of generic vertex attribute format information records each of which specifies:   - a reference to one of the new buffer binding points above   - a component count and format and a normalization flag for the     attribute data   - the offset of the attribute data relative to the base offset of each     vertex found at the associated binding point.  Current ANGLE implementation simply uses a struct to represent a vertex attribute object which does not meet the requirements above.  This patch aims to be the the basis of the implementation of all ES3.1 Vertex Attrib Binding APIs by refactoring the struct VertexAttribute and the class VertexArray to fit the new data layout and ensuring all current functionality is retained.  BUG=angleproject:1593  TEST=angle_unittests angle_end2end_tests gpu_unittests  Change-Id: Ieb41f1bf503f815fd0476d2ea045dcb863465254 Reviewed-on: https://chromium-review.googlesource.com/418880 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove unneeded ContextImpl::syncState parameter.  The 'state' parameter passed to ContextImpl::syncState() is already available in ContextImpl as mState.getState().  BUG=none  Change-Id: I13283664579fa04ae67b1d1bbc0cb4426a950b97 Reviewed-on: https://chromium-review.googlesource.com/444099 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Clean up EVENT() logging.  These don't need newlines or a severity prefix.  BUG=angleproject:1660  Change-Id: I8a01c55a7e3d8915f48c2a29f43ddc0a37eb64f3 Reviewed-on: https://chromium-review.googlesource.com/443353 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Set formats in Ozone configs.  The fields renderTargetFormat and depthStencilFormat are now required.  BUG=none  Change-Id: I8dff771fc8c28b297bc7d47f9aef7f78ba0f3f86 Reviewed-on: https://chromium-review.googlesource.com/443804 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Vulkan: Don't store device handles in wrapped objects.  BUG=angleproject:1684  Change-Id: I0ec11ec79f2e9893600a8ffd8cdbfc6040fb6f70 Reviewed-on: https://chromium-review.googlesource.com/426402 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Tweak platform method signatures.  This works around a limitation in UBSAN which can't handle decltype. Instead use void * and typedef where appropriate.  BUG=chromium:692274  Change-Id: I4eab796db3aa2e51c0fc558170eb2af61f07223d Reviewed-on: https://chromium-review.googlesource.com/443885 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ES3.1: Implement framebuffer parameters api for opengl part.  Add new framebuffer parameters that can be set with glFramebufferParameteri and queried with glGetFramebufferParameteriv. GL_FRAMEBUFFER DEFAULT WIDTH GL_FRAMEBUFFER_DEFAULT_HEIGHT GL_FRAMEBUFFER_DEFAULT_SAMPLES GL_FRAMEBUFFER_DEFAULT_FIXED_SAMPLE_LOCATIONS  BUG=angleproject:1594 TEST=angle_unittests TEST=angle_end2end_tests TEST=dEQP-GLES31.functional.state_query.framebuffer_default.framebuffer_default*  Change-Id: I425e73a6b798fc7c73841ab98d7c8aabc381133d Reviewed-on: https://chromium-review.googlesource.com/412126 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
CQ config: add gerrit CQAbility verifier.  Goal is to ensure that unreviewed and untrusted code isn't sent through CQ to try bots by accident or through malicious intent.  The following is the difference in CQ behavior after this CL lands: 1. CQ will start aborting CQ dry run triggered by contributors on somebody's else change. 2. CQ full run will abort immediately if there are unsubmitted dependencies. 3. CQ dry run by a non-change-owner will abort if there are unapproved (w/o CR+2) dependencies.  R=geofflang@chromium.orgjmadill@chromium.org BUG=692618692613 NOTRY=True  Change-Id: I433998def4b97e2bad90da5980bf3f2b40a2e6f9 Reviewed-on: https://chromium-review.googlesource.com/443070 Commit-Queue: Andrii Shyshkalov <tandrii@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
gpu_info_util: address comments for CL 438940  BUG=angleproject:1874  Change-Id: I6397d9141a7c25f818ce970212a4a8e8afbd5a27 Reviewed-on: https://chromium-review.googlesource.com/442676 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix incorrect indices being used when divisor is non-zero.  When streaming client data in the OpenGL backend incorrect vertex data was uploaded.  The 'first' parameter should be ignored when drawing with a non-zero divisor even when doing non-instanced draw calls.  BUG=angleproject:1894  Change-Id: If5a9ed4683f5c64eea1436eff28b2b2f86befcf4 Reviewed-on: https://chromium-review.googlesource.com/443067 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Vulkan: Make CommandPool a wrapped type.  This faciliatates an upcoming change to treat all handle types uniformly with respect to releasing.  BUG=angleproject:1684  Change-Id: I632262a57b3a447cf4999c28ab359fe931549576 Reviewed-on: https://chromium-review.googlesource.com/442674 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Vulkan: Run simple triangle perf test.  The most basic perf test possible.  BUG=angleproject:xxxx  Change-Id: I71b28098c0a1f2174a0177b08bddf74d337438e9 Reviewed-on: https://chromium-review.googlesource.com/427270 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add extensions to disable client arrays.  Chrome doesn't allow any client data in its command buffer.  Add an ANGLE extension to request a context that disallows client data.  BUG=602737  Change-Id: If9d5144daea3c629a73562396000df59a671aad3 Reviewed-on: https://chromium-review.googlesource.com/441986 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Parse binding layout qualifier for opaque types  This patch adds binding layout qualifier support for opaque types. Binding layout qualifier on blocks is not yet supported.  This includes support for GLSL output and some minor simplification of related functionality in ParseContext.  TEST=angle_unittests dEQP-GLES31.functional.layout_binding.* BUG=angleproject:1442  Change-Id: I53fb505b5a539bccee70613f3969fba81965ae84 Reviewed-on: https://chromium-review.googlesource.com/441586 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix multisample texture operations crashing HLSL generation  This includes a partial implementation of multisample texture operations on the HLSL backend. It can't be fully tested yet since the API side isn't implemented.  BUG=angleproject:1442 TEST=dEQP-GLES31.functional.shaders.builtin_functions.texture_size.*      (successfully compiles instead of crashing)  Change-Id: Ief782db28388a3f8fd8113cc86ce3c4f500f322a Reviewed-on: https://chromium-review.googlesource.com/443264 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
DisplayGL: remove getDriverVersion  It was unused and going forward angle_gpu_info_util will be used instead.  BUG=angleproject:1874  Change-Id: I262cc36066aa28805d50f3fc4442b08477f9e24d Reviewed-on: https://chromium-review.googlesource.com/442024 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix a couple forward declares in angletypes.h.  These were vestigal from previous code.  BUG=angleproject:1593  Change-Id: I1d9a8e6f60d1dadf8a8a598bdbddd98457eb559c Reviewed-on: https://chromium-review.googlesource.com/442651 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix initialization of Caps members.  sRGB was never initialized and maxTextureAnisotropy was initialized with a bool instead of a float.  BUG=602737  Change-Id: Ied7c27d1dbdbec96f8aead618132b4f59892bd99 Reviewed-on: https://chromium-review.googlesource.com/442668 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix checking image memory access  Checks for image memory access used to assume that image nodes are symbol nodes but they can also be array indexing nodes. In invalid shaders struct indexing nodes of an image type may also appear after error recovery.  TEST=angle_unittests dEQP-GLES31.functional.layout_binding.* BUG=angleproject:1442  Change-Id: Ib45728d38485cb78c594e080f3decec1233a0046 Reviewed-on: https://chromium-review.googlesource.com/442764 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add destroy hooks for several GL objects.  These hooks allow the back-end renderer to free object resources without having to store pointers to shared device handles for each and every object. This will allow us to save memory on back-ends that really care about memory overhead.  There is a downside in that there is more boilerplate in passing gl::Context handles around everywhere.  BUG=angleproject:1684  Change-Id: I89463bba8d23f92920e8956650cb73c7fc6d66b7 Reviewed-on: https://chromium-review.googlesource.com/426401 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove old C++ ANGLE platform.  Now that the new platform is in place we can remove the old methods. Must be landed after https://codereview.chromium.org/2697463003/  BUG=angleproject:1892 BUG=chromium:678870  Change-Id: Ia29a3b120cf3521fc0409019c2e64e4dbc6f460d Reviewed-on: https://chromium-review.googlesource.com/441274 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Update RenderbufferStorage EPs to new style.  This will facilitate changes for WebGL compatibility.  BUG=angleproject:747 BUG=angleproject:1708  Change-Id: I62e5d684ca10a843b5e958afe9954c1065bfeb19 Reviewed-on: https://chromium-review.googlesource.com/442093 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
WebGL validation for depthRange.  Generate INVALID_OPERATION for depthRange(zNear zFar) if zNear > zFar. Add corresponding test.  BUG=angleproject:1816  Change-Id: I28b5876a74c9765c0eef1e0f6e5e96d0380586d0 Reviewed-on: https://chromium-review.googlesource.com/441207 Commit-Queue: Frank Henigman <fjhenigman@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix D3DTextureTest.  This test was not releasing resource in the correct order.  BUG=chromium:691136  Change-Id: Ie95c4d595eac49da2707afde033eff744131fcbe Reviewed-on: https://chromium-review.googlesource.com/442684 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Release the global texture manager with the last referencing context.  This ensures that when the global texture manager is released there is a valid context.  BUG=angleproject:1639  Change-Id: I1b75885e9dc02b607bb1a386de394f6087429f5d Reviewed-on: https://chromium-review.googlesource.com/442074 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D11: Disable the RGB10A2 backbuffer format.  Chrome was using this format by accident for video decode surfaces resulting in a power usage regression.  BUG=angleproject:1662 BUG=691106  Change-Id: I3b9ac814f06c07490fceb88e8b087b235e5b25bf Reviewed-on: https://chromium-review.googlesource.com/441950 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add classification of image type enums  Implement classifying image enums in utilities and plumb the image type check to Uniform objects as well. This functionality will be used to add API support for images.  BUG=angleproject:1442  Change-Id: Idd2ee5ebacd38290aeeace1177165c740bc42c7e Reviewed-on: https://chromium-review.googlesource.com/441585 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix counting of the new platform methods.  The context pointer was throwing off the count by one. Also change the type to void * for ease of use.  BUG=angleproject:1892 BUG=chromium:678870  Change-Id: Iffac667f0aa896d9247e9ffddfeb3bc447a9692f Reviewed-on: https://chromium-review.googlesource.com/441931 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use a C API for the ANGLE platform.  The main purpose of this change is to fix a fuzzer bug where we would trigger undefined behaviour calling between Chrome and ANGLE. It's not specced how virtual function calls work if the shared objects are not directly linked together and ANGLE and Chrome are not linked. Replace the old class-style API with a C dispatch table.  Follow-up work will make the Platform owned by the Display instead of using global variables but fixing this is a bit tricky.  BUG=angleproject:1892 BUG=chromium:678870  Change-Id: Iad188bc2e50f2b5e4a03ce0de233d686f569c705 Reviewed-on: https://chromium-review.googlesource.com/441273 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
gpu_test_expectations: fix compile on OSX 10.8 and 10.9  OSX10.8 deprecates Gestalt but doesn't expose a replacement in the public interface so we forward declare it.  BUG=angleproject:1890  Change-Id: Ie4825c9191e81a5894dca4e394275c26a3e27853 Reviewed-on: https://chromium-review.googlesource.com/441309 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
gpu_info_util: Implement GetSystemInfo on Linux  BUG=angleproject:1874  Change-Id: Id39c26b806e6a7937517235afe0ca60f5087df5b Reviewed-on: https://chromium-review.googlesource.com/438940 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add artificial limits to the total memory allocated by the NULL backend.  Fuzzer tests were capable of allocating very large chunks of memory by calling glBufferData with a null pointer.  This sets a limit before the NULL backend starts returning out of memory GL errors.  BUG=602737  Change-Id: Ic53ebcf999f951b96c1df82e4db57e949d03c908 Reviewed-on: https://chromium-review.googlesource.com/441184 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Expose the CHROMIUM copy texture extensions on the NULL backend.  These extensions are required by the passthrough command decoder.  BUG=602737  Change-Id: Ifd04fca27ae35b30e4c8ab458904530e3dd44377 Reviewed-on: https://chromium-review.googlesource.com/441204 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix GL_MAX_SAMPLES query for ES3 when the extension is missing.  This query was added in both ES3 and ANGLE_framebuffer_multisample but the code was never updated to accept it for an ES3 context without the extension present.  Caught by the angle passthrough command decoder fuzzer.  BUG=602737  Change-Id: Ic9a8c67747777ef48e1dd227110482998fee75ce Reviewed-on: https://chromium-review.googlesource.com/440651 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Validate that the format is compressed before calculating data size.  glCompressedTexImage3D was missing a check that the format was valid before trying to compute the expected data size.  This lead to an assertion failure in the size computation code.  BUG=602737  Change-Id: I74e6ced082e78396a0af92317fb1c0098299a026 Reviewed-on: https://chromium-review.googlesource.com/441185 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor ResourceManagers.  This makes ResourceManagers use more common code. It uses static polymorphism to implement the various typed resource managers and unifies the FramebufferManager into a TypedResourceManager. The lack of virtual calls and inlining in the header should keep performance high.  This will make the upcoming refactor to add a destroy hook for Vulkan objects simpler to implement.  TEST=manual performance testing of BindingPerf. BUG=angleproject:1684 BUG=angleproject:1639  Change-Id: Ic2f102196020d1005e63a1b2cf0867577fc7c885 Reviewed-on: https://chromium-review.googlesource.com/439488 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Zero gl_Position in WebGL mode.  Set the SH_INIT_GL_POSITION bit in WebGL compatibility mode so gl_Position gets zeroed out.  Add corresponding test.  BUG=angleproject:1825  Change-Id: I47107804abaa83d6aee5cd46e6b69b532c08e6e8 Reviewed-on: https://chromium-review.googlesource.com/439784 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Add an extension to share textures at the display level.  BUG=angleproject:1639  Change-Id: If9140142ebce89f33921c13d9d212c17d1894162 Reviewed-on: https://chromium-review.googlesource.com/437618 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor shader state setting in the GL backend  This is needed in preparation of implementing DispatchCompute which will need to set some of the same state as draw calls but not everything.  Also move setTextureCubemapSeamlessEnabled to onMakeCurrent this way it doesn't need to be called on every draw call. Overall this patch doesn't have a measurable performance impact.  BUG=angleproject:1442 TEST=angle_perftests angle_end2end_tests  Change-Id: I9958bfe7bf895b3cd805e3146a8f74d28ff2835e Reviewed-on: https://chromium-review.googlesource.com/438349 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Skip TransformFeedbackLifetimeTest.DeletedBuffer on Win Intel OpenGL  Suspecting driver bug on Win10 Debug Intel HD 530.  BUG=angleproject:1879  Change-Id: I362ffd83694c7e222826cd3766fa57f785f3ea35 Reviewed-on: https://chromium-review.googlesource.com/438936 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
WebGL: Add 3D tex copying feedback loop detection.  When copying to and from the same texture we need to reject only the feedback loops formed with the same levels of the texture - copying between different unrelated layers and levels is fine.  This change also fixes a couple bugs in our D3D11 CopyTexSubImage3D implementation. We were missing some "!" operators and we actually would hit an ASSERT when trying to blit from a level of a 3D texture.  BUG=angleproject:1685  Change-Id: Id715bebafe8336cf8bb95d0d06275a8b95e522e1 Reviewed-on: https://chromium-review.googlesource.com/425494 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Make failure to create Debug D3D11 device a warning instead of error  Tests started failing after directing ERR to Platform  BUG=angleproject:1660 angleproject:1878  Change-Id: I3e6d99bee266c0e7fa541c6e19be7253dcc01cdf Reviewed-on: https://chromium-review.googlesource.com/438819 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Pass Context around to Texture::copyImage.  Passing this through the chain will allow us to have access to the platform methods as well as be useful in the future for Vulkan.  BUG=angleproject:1660  Change-Id: I819984fceeb5a2a299aa54e59ef3b428f5f9c91f Reviewed-on: https://chromium-review.googlesource.com/438684 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disable RobustClientMemoryTest.ReadPixels on Linux Intel OpenGL  Looks like a driver bug on Intel HD 530 uncovered by directing ERR to Platfrom.  BUG=angleproject:1660 angleproject:1877  Change-Id: I0b8cd1b2bacb2a95c7667be783801686bc8fdb7b Reviewed-on: https://chromium-review.googlesource.com/438679 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Fix compilation on mingw  BUG=angleproject:1795  Change-Id: Ic25805f99154395c9af28197ceb1218f9c5c3138 Reviewed-on: https://chromium-review.googlesource.com/434457 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
WebGL: Validate depth/stencil feedback loops.  BUG=angleproject:1685  Change-Id: I6019555af69800f07862a0038fd0c25a9bb5aab8 Reviewed-on: https://chromium-review.googlesource.com/425493 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Framebuffer: Remove ext check for depth/stencil textures.  The absence of the extension should not prevent depth/stencil textures in FBOs in ES3 since they are core. In fact it shouldn't be possible to make depth/stencil attachments at all without support so the check shouldn't be necessary.  BUG=angleproject:1828  Change-Id: Ibec1e95c78b79cec9654f06ba11beec447017f1c Reviewed-on: https://chromium-review.googlesource.com/438604 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Buffer: Pass Context to all impl methods.  This allows us to retrieve Device handles for Vulkan and could allow us to avoid storing some pointers for other back-ends.  BUG=angleproject:1684  Change-Id: Iccd5b97cf1c3a332d62a38ad0fcf21c352270439 Reviewed-on: https://chromium-review.googlesource.com/426400 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
translator: Fix ASSERT in array init corner case.  This ASSERT was benign and can be turned into an error check. The pattern in question is to initialize an array with another array as the first argument but dereferencing the array with "." instead of "[]". This would trip up our error handling.  BUG=chromium:662702  Change-Id: Ie0e44af7b9d1a66cad03cefae9bf931f8e216cd9 Reviewed-on: https://chromium-review.googlesource.com/437599 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add destroy handler to SurfaceImpl.  This allows the Vulkan back-end to avoid storing a reference to the VkDevice. This will extend to all the Vulkan object handle wrapper types.  BUG=angleproject:1684  Change-Id: I3a98e94bc171ca27f225ce57996c3fdf9581e6e1 Reviewed-on: https://chromium-review.googlesource.com/424229 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add alternative MSVS build path to perf_test_runner  If src/tests/tests.sln is built instead of gyp/ANGLE.sln the test executable is placed under src/tests/Release*.  TEST=perf_test_runner on Windows  Change-Id: I72ce55e2caa8270bef089c073840d5e2d6caa14d Reviewed-on: https://chromium-review.googlesource.com/438348 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Validate xoffset and yoffset are multiples of blocksize.  Affects glCompressedTexSubImage and glCopyCompressedTexSubImage calls.  BUG=668223  Change-Id: Ie71faa1fa7dac12cec51a2e29e0ce212ac54e411 Reviewed-on: https://chromium-review.googlesource.com/437605 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement EGL_KHR_surfaceless_context  BUG=angleproject:1651  Change-Id: I710df14c2bfa55db2fb9b9715001756d1c1a8f1b Reviewed-on: https://chromium-review.googlesource.com/434763 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Direct logging to Platform when available  All logging should be done via ERR() and WARN() which call angle::Platform's logError and logWarning if there is current Platform which supports logging. Otherwise ERR() is directed to std::cerr.  Misc fixes to keep tests passing.  BUG=angleproject:1660 angleproject:1644  Change-Id: I2bca33a021537185d0c236a3083789af3236b5f3 Reviewed-on: https://chromium-review.googlesource.com/434188 Commit-Queue: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Don't yeild after a successful call to GetData during glFinish.  ScheduleYield was always called after GetData regardless of it's result.  This meant that we would successfully get the data but still sleep the thread  BUG=667979  Change-Id: Iecba0ae5cacef64a1080bbd89ce352bc4f281359 Reviewed-on: https://chromium-review.googlesource.com/437636 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Vulkan: Implement a simple graphics pipeline.  BUG=angleproject:1580  Change-Id: Iceaed896db22dc9eefa3f1bee7d6142fcfb20368 Reviewed-on: https://chromium-review.googlesource.com/412267 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Change ERR to WARN in RendererD3D::skipDraw  For undefined behavior when point rendering without writing to gl_PointSize. Even the comment used to say "This is stictly speaking not an error".  BUG=angleproject:1660  Change-Id: Ic8b33689151c9812592dd6b22c83a3355b7d6756 Reviewed-on: https://chromium-review.googlesource.com/437746 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix error logging in ValidateBlitFramebufferANGLE  Bundle an error message about whole buffer copies inside gl::Error instead of delivering it to the Platform.  BUG=angleproject:1660  Change-Id: I13205b74529fbe40af05e7c1896c6315486e90e0 Reviewed-on: https://chromium-review.googlesource.com/437628 Commit-Queue: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D9: Write dummy output for depth/stencil only draw.  This prevents a spurious D3D runtime warning which was clogging up some of our test output.  BUG=angleproject:1660  Change-Id: I1a747ba7532323b989dbed1ee7c78b3b457768a6 Reviewed-on: https://chromium-review.googlesource.com/437724 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Vulkan: Disable layer deps for libANGLE in GYP.  This prevents a multiply defined symbol error in ninja. Unforunately I'm not aware of how to do the equivalent of GN's data_deps in GYP.  BUG=angleproject:1709  Change-Id: I9c616337c668a5fa652b6c084b2a64d83d526e4a Reviewed-on: https://chromium-review.googlesource.com/437646 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix missing trace_event header.  Noticed this while investigating the tracing code.  BUG=chromium:678870  Change-Id: I016c8532044b8f105ddda67f7e06c6b5ed9c61fb Reviewed-on: https://chromium-review.googlesource.com/437647 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Validate uniform sampler values.  Generate GL_INVALID_VALUE when setting a sampler uniform with a value outside the range [0 GL_MAX_COMBINED_TEXTURE_IMAGE_UNITS). Add a test for the new behavior. Remove TextureLimitsTest.DrawWithTexturePastMaximum which is made obsolete by the new test.  BUG=angleproject:1711  Change-Id: I9a4ea13b8cb47742816476689bd3932ce267fd0a Reviewed-on: https://chromium-review.googlesource.com/430196 Commit-Queue: Frank Henigman <fjhenigman@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
TimerQuery: Suppress flaky test on OSX AMD  BUG=angleproject:1866  Change-Id: I41f1e842b7f64e541f98d466d2b0875412161274 Reviewed-on: https://chromium-review.googlesource.com/437285 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "D3D11: Clean up blendState code."  This reverts commit 786ad3876730c72311c64cf2f297e671ced847a5.  Reason for revert:  Seems to have a bug with binding the BlendStates causing a crash on Intel.  https://luci-milo.appspot.com/buildbot/chromium.gpu.fyi/Win10%20Release%20%28Intel%20HD%20530%29/141  Failing WebGL 2 tests WebglConformance_conformance2_reading_read_pixels_from_fbo_test WebglConformance_deqp_functional_gles3_readpixel  Also generates D3D11 runtime warnings: D3D11 ERROR: ID3D11DeviceContext::Draw: The renderTarget bound to slot 0 has a format (R8_UINT) that does not support blending. The Pixel Shader output signature indicates this output could be written and the Blend State indicates blending is enabled for this slot. [ EXECUTION ERROR #376: DEVICE_DRAW_OM_RENDER_TARGET_DOES_NOT_SUPPORT_BLENDING]  BUG=angleproject:1632 BUG=chromium:688419  Original change's description: > D3D11: Clean up blendState code. >  > Masked Clear Draw Changes: > - Use universal blendstate object > - Eliminate blendState cache for masked clears > - Use rasterState and scissor rect for scissoring instead of adjusting vertex positions > - VB contains only static position data (per vertex color removed) > - Clear color(s) and depth clear values now passed in using a constant buffer > - MultiColorclear shader used for float clears to workaround alpha rounding issues > - Update shader compile script and shader source and bytecode headers > - Remove unused shaders (source and bytecode headers) > - Use com pointers where possible for D3D11 objects >  > BUG=angleproject:1632 >  > Change-Id: I98e38451bd453f53b772fe93ec9dcceb4196ea58 > Reviewed-on: https://chromium-review.googlesource.com/413736 > Reviewed-by: Geoff Lang <geofflang@chromium.org> > Reviewed-by: Jamie Madill <jmadill@chromium.org> > Commit-Queue: Shahmeer Esmail <shahmeer.esmail@intel.com> > Commit-Queue: Jamie Madill <jmadill@chromium.org> >   TBR=geofflang@chromium.orgjmadill@chromium.orgshahmeer.esmail@intel.com NOPRESUBMIT=true NOTREECHECKS=true NOTRY=true BUG=angleproject:1632  Change-Id: Iea537505d8cce7241edaba1f1d9f404abb1d9a10 Reviewed-on: https://chromium-review.googlesource.com/437306 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11/ES31: Fix unimplemented multitexture errors.  Although the functionality for these textures is unimplemented we still create zero textures for multisample in D3D11. Thus the constructor and destructor should be marked as implemented.  BUG=angleproject:1590 BUG=angleproject:1660  Change-Id: I44b51dd4e89d492f98c134b8f7dfd62dffc97015 Reviewed-on: https://chromium-review.googlesource.com/437304 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Vulkan: Move window re-init to test constructor.  Moving it from SetUp to the constructor allows the swapping to work even if the test decides to not call the SetUp base function. This fixes the Vulkan extension test which skips normal test init.  This requires us to change an ERR invocation into a print.  BUG=angleproject:1810  Change-Id: I3be4bdb6df8c02fc1c9bbc7834ba485054272b8e Reviewed-on: https://chromium-review.googlesource.com/437284 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add uniform1iv validation functions.  Add two new validation functions: ValidateUniform1iv() and ValidateProgramUniform1iv(). No functional change just hooks for additional sampler uniform validation that will come later. This also lets us skip the sampler test in the more generic ValidateUniformValue() function.  BUG=angleproject:1711  Change-Id: Ia6b7b45c22c2cf4b49a55fac62410ca4c91d09f4 Reviewed-on: https://chromium-review.googlesource.com/436884 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor and clean up uniform validation.  Move uniform value checking to two new functions: ValidateUniformValue() and ValidateUniformMatrixValue(). This reduces code duplication slightly and paves the way for further validation of sampler uniforms in a later change. The checking also becomes slightly more efficient by virtue of reording the tests to put cheap/common cases first.  ValidateUniformCommonBase() moves to the anonymous namespace and loses an unused parameter.  BUG=angleproject:1711  Change-Id: I6c4deeea27c54027f542500644636064167d5714 Reviewed-on: https://chromium-review.googlesource.com/431677 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add ESSL 3.10 ldexp/frexp builtins  This adds new built-ins found in ESSL 3.10 section 8.3 Common Functions.  This includes constant folding support for ldexp and support for both GLSL and HLSL output. In HLSL these functions need to be emulated.  BUG=angleproject:1730 TEST=angle_unittests  Change-Id: I1330e69978b0cf53efbc3416150194764414e96c Reviewed-on: https://chromium-review.googlesource.com/435342 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix StateChangeTestES3.FramebufferIncompleteWithCompressedTex  Was firing GL_DEBUG_TYPE_ERROR LogGLDebugMessage() on standalone Linux.  According to OpenGL ES 3.0.4 page 289: The number of bits that represent a 4x4 texel block is 64 bits if internalformat is given by COMPRESSED_RGB8_ETC2.  16x16 pixels are 16 blocks giving 128 bytes.  BUG=angleproject:1826  Change-Id: I367e5a1369e1da2906c2ffc5ca5d703b62baf578 Reviewed-on: https://chromium-review.googlesource.com/436824 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
WebGL: Add test for ES3 MRT feedback loops.  BUG=angleproject:1685  Change-Id: I0f1e24d7c27f0b3ef56f35debcd20f4c7cff8951 Reviewed-on: https://chromium-review.googlesource.com/425492 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
WebGL: Add test for MRT feedback loop detection.  BUG=angleproject:1685  Change-Id: Id5b1a9bfc33bada014a77ba2cbf4c2b92981df2a Reviewed-on: https://chromium-review.googlesource.com/425490 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ES: Don't expose EXT_draw_buffers if extension not present.  Emulation of this extension would potentially require rewriting ESSL 1.00 shaders as 3.00 when the extension is missing and we're on a GLES 3.0 context. For now it's easier to disable the extension when native support is lacking.  BUG=angleproject:1828  Change-Id: I8eabb8efccc2ddd5fafd3521657ea68cc9e1d1e0 Reviewed-on: https://chromium-review.googlesource.com/436144 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
D3D11: Clean up blendState code.  Masked Clear Draw Changes: - Use universal blendstate object - Eliminate blendState cache for masked clears - Use rasterState and scissor rect for scissoring instead of adjusting vertex positions - VB contains only static position data (per vertex color removed) - Clear color(s) and depth clear values now passed in using a constant buffer - MultiColorclear shader used for float clears to workaround alpha rounding issues - Update shader compile script and shader source and bytecode headers - Remove unused shaders (source and bytecode headers) - Use com pointers where possible for D3D11 objects  BUG=angleproject:1632  Change-Id: I98e38451bd453f53b772fe93ec9dcceb4196ea58 Reviewed-on: https://chromium-review.googlesource.com/413736 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Shahmeer Esmail <shahmeer.esmail@intel.com> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor Framebuffer management into a FramebufferManager class.  BUG=angleproject:1639  Change-Id: I03a0950f26557983c8dc816a27cb4038c60e5755 Reviewed-on: https://chromium-review.googlesource.com/415611 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Vulkan: Workaround NVIDIA not sharing with OpenGL window.  NVIDIA seems to have the limitation of not being able to work with a window handle on both OpenGL and Vulkan. Apparently this also happens with NVIDIA on Linux but doesn't happen with any other vendor. Work around this by opening a new OS window when switching between Vulkan and non-Vulkan.  BUG=angleproject:1810  Change-Id: Id6bfcc2229be5a0d97202dfc87944001b4ab7871 Reviewed-on: https://chromium-review.googlesource.com/430887 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
translator: Make TVector and TMap pool allocated  Their content was using the pool allocation but not the container object.  BUG=angleproject:1827  Change-Id: I3867023b3f0c4f612f2b82db7034ea3a3dde32a2 Reviewed-on: https://chromium-review.googlesource.com/436084 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add new ESSL 3.10 pack/unpack builtins  This adds new built-ins found in ESSL 3.10 section 8.4 Floating-Point Pack and Unpack Functions.  This includes constant folding support and support for both GLSL and HLSL output. In HLSL all of these functions need to be emulated.  BUG=angleproject:1730 TEST=angle_unittests TEST=dEQP-GLES31.functional.shaders.*pack*norm4x8*  Change-Id: Ibed60286a366cd35c4faafd405e79af562a02a06 Reviewed-on: https://chromium-review.googlesource.com/434170 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Vulkan: Implement shader compilation.  This hooks up the Vulkan GLSL decorated with locations to glslang and then pipes the SPIRV back to the Program implementation for later use when making pipelines to run draw calls.  The program compilation tests work now but don't really test anything other than not generating Vulkan validation layer errors during compilation and shader object generation.  BUG=angleproject:1576  Change-Id: I625e42219f4b4d1433dd3109b94e1a2f666ba4bd Reviewed-on: https://chromium-review.googlesource.com/408519 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
WebGLCompatibility: add tests for OOB in DrawElements' index buffer  Also add a small fix for a WebGL test where DrawElements with a count of 0 should skip OOB checks.  BUG=angleproject:1523 BUG=chromium:668223  Change-Id: I67fbe939f6c8b925551b658b6178dbbae982df89 Reviewed-on: https://chromium-review.googlesource.com/435279 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: Faster multisample depth resolve.  We can use a faster path to write out depth values. Previous attempts were foiled by a D3D quirk: we need to clear a new DSV before we write to it the first time.  Multisampled stencil resolve still requires a CPU readback.  BUG=angleproject:1710  Change-Id: I7a7d2f929644f61854d51dd096a8aa599ad648bd Reviewed-on: https://chromium-review.googlesource.com/435571 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a BlitFramebuffer perf test.  This microbenchmark targets a variety of blit use cases including color blit depth/stencil blit and multisample resolve blit.  BUG=angleproject:1710  Change-Id: Ia8b3eb40af29e809e803ed48a69f3975b97fd80b Reviewed-on: https://chromium-review.googlesource.com/435515 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Vulkan: Fix JSON generation in GYP.  This isn't tested on the bots but fails in standalone.  BUG=angleproject:1810  Change-Id: Ia1743352e236966abf321d312a8beb47a4cff336 Reviewed-on: https://chromium-review.googlesource.com/435012 Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: Add RGB10_A2 as a supported EGL pbuffer config format.  Update EGLWindow to select configs that exactly match the requested config.  Too many tests make assumptions about the default framebuffer's format.  BUG=angleproject:1662  Change-Id: I4cf8aedf51013ca0f3f40f6bbd40f24a4a90561f Reviewed-on: https://chromium-review.googlesource.com/419681 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move Vulkan layers data directory.  The zip-archive script was having trouble pulling in data from gen/. Instead use a separate 'angledata' folder.  BUG=angleproject:1810  Change-Id: I09eaf4766a8360c40af9335bed74a5dc347e05ad Reviewed-on: https://chromium-review.googlesource.com/435518 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix memory leak on multisample stencil resolve.  This would happen when checking the current resource vs the prior one. Calling GetResource would increment the reference count but we would not properly call Release.  BUG=angleproject:1710  Change-Id: Iefa9ee60929b9808985649c83f6322c1043fa5ed Reviewed-on: https://chromium-review.googlesource.com/434801 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix member variable masking in EGLSurfacelessContextTest  This fixes standalone build on MSVC and makes sure the test is cleaned up as intended.  BUG=angleproject:1651 TEST=build on MSVC  Change-Id: I057176529b57fc8610bdd67749efcef6a4441d33 Reviewed-on: https://chromium-review.googlesource.com/435379 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Make aggregate node creation more robust  Now aggregate nodes are always built with their return type op and arguments set. They'll determine their qualifier and precision automatically.  This fixes setting of gotPrecisionFromChildren in a few cases.  This will also make it easier to split TIntermAggregate further into specialized classes if that is desired.  BUG=angleproject:1490 TEST=angle_unittests  Change-Id: I1fbe0c75679c517a22d44dfc1ea160ad7a7fdfda Reviewed-on: https://chromium-review.googlesource.com/433468 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Implement GL_OES_surfaceless_context  BUG=angleproject:1651  Change-Id: I733ccedad7c7424cdb70e21ef8d48b2a15ccdfd7 Reviewed-on: https://chromium-review.googlesource.com/434762 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
WebGLCompatibility implement and add tests for section 6.4  The checks for VertexAttribPointer were already implemented in a previous patch so we only add the checks for DrawElements.  BUG=angleproject:1523 BUG=chromium:668223  Change-Id: I5da55f9a7e7479627099c7f77618353a63b75a8e Reviewed-on: https://chromium-review.googlesource.com/434958 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add tests for the surfaceless_context extensions  BUG=angleproject:1651  Change-Id: Ie486f2f2d0f9adad808265f7f3fbd46069265392 Reviewed-on: https://chromium-review.googlesource.com/434764 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Clean up unary node creation  When createUnaryNode() is called the child node is guaranteed to be non-null. This enables simplifying it.  BUG=angleproject:1490 TEST=angle_unittests  Change-Id: Ib1d021bbbeab99a6bf1b1be470181e9efbe301c6 Reviewed-on: https://chromium-review.googlesource.com/433467 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fold user-definedness of function nodes into TOperator  Whether a function call is user-defined is not orthogonal to TOperator associated with the call node - other ops than function calls can't be user-defined. Because of this it makes sense to store the user- definedness by having different TOperator enums for different types of calls.  This patch also tags internal helper functions that have a raw definition outside the AST with a separate TOperator enum. This way they can be handled with logic that is easy to understand. Before this function calls like this left the user-defined bit unset despite not really being built-ins either. The EmulatePrecision traverser uses this. This is also something that could be used to clean up built-in emulation in the future.  BUG=angleproject:1490 TEST=angle_unittests  Change-Id: I597fcd9789d0cc22b689ef3ce5a0cc3f621d4859 Reviewed-on: https://chromium-review.googlesource.com/433443 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix comment introduced in 02f075c85b5e16b6ca1bfc157f1d619ed255f75a  BUG=angleproject:1553 BUG=chromium:630498  Change-Id: I4c341e57f2e0439ffd7bdcf74e15ca0de4152c5d Reviewed-on: https://chromium-review.googlesource.com/435106 Commit-Queue: Kai Ninomiya <kainino@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Apply max draw buffer limit for WebGL shaders.  For WebGL using native caps incorrectly sets gl_MaxDrawBuffers. This change always applys the limit for compatible shaders.  BUG=angleproject:1523  Change-Id: Ie956f4b9fdd10bdf9276ae08eaeb49e65690185b Reviewed-on: https://chromium-review.googlesource.com/425477 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add EGL_EXT_pixel_format_float support enables float EGL surfaces.  Add floating point EGL configs for the D3D11 backend.  BUG=angleproject:1707  Change-Id: Ic84cd3a0d41e78cc39d0275d83e7695f55673ddf Reviewed-on: https://chromium-review.googlesource.com/428294 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
IntermTyped::CreateZero: handle non-basictypes  CreateZero is called in ParseContext so it should handle types which don't necessarily make sense to call it with.  BUG=chromium:680961  Change-Id: I8627850e49eb9a4f4ecde61ca2d68371ea6a8dd6 Reviewed-on: https://chromium-review.googlesource.com/431001 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix compilation of dEQP on OSX after a roll of EGL headers  dEQP assumes EGLNativeDisplayType is a pointer but EGL recently defined it to be an integer.  BUG=angleproject:1707  Change-Id: Ief68c763ce159db44f4008cced47e87d92342861 Reviewed-on: https://chromium-review.googlesource.com/434761 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Refactor ResourceManager into separate managers per resource type.  BUG=angleproject:1639  Change-Id: I943f553cfb0e0feb57953770784b48e22fccc875 Reviewed-on: https://chromium-review.googlesource.com/423172 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Vulkan: Implement new GLSL translator back-end.  The Vulkan GLSL translator back-end will handle validating and translating our WebGL/ESSL shaders into Vulkan-specific GLSL.  glslang (the Vulkan one) accepts both GLSL and GLSL ES shaders as inputs and both the desktop and ESSL back-ends give incompleteness warnings when used. For now use the desktop GL 450 as a target for Vulkan GLSL.  The Vulkan-specific changes are currently only to add locations to every vertex input and fragment output.  BUG=angleproject:1575  Change-Id: I7c3f32f522e9d18e5f8618eb7927336bf4fbdcf2 Reviewed-on: https://chromium-review.googlesource.com/412266 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Suppress ESSL 3.10 integer math failure on AMD Linux  Failure was seen on bots since the test was introduced.  BUG=chromium:686105 BUG=angleproject:1730  Change-Id: I60293f17bf5e2498cbfb61f86468c218d58df68d Reviewed-on: https://chromium-review.googlesource.com/434080 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor function call node creation  This makes function call node creation code simpler and more type safe. It also prepares for further simplification by removing usage of TFunction in places where the arguments node is sufficient.  BUG=angleproject:1490 TEST=angle_unittests  Change-Id: I75d9e059bb32c475487f0be24e40ac0d78012d86 Reviewed-on: https://chromium-review.googlesource.com/433217 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add ESSL 3.10 integer math built-ins  This adds built-ins found in ESSL 3.10 section 8.8 Integer functions.  This includes constant folding support for functions that may be constant folded and support for both GLSL and HLSL output. In HLSL several of the functions need to be emulated.  The precision qualification for the return value of some of these functions is determined by special rules that are now part of type promotion for TIntermUnary nodes and determining the type of TIntermAggregate nodes.  BUG=angleproject:1730 TEST=angle_unittests TEST=dEQP-GLES31.functional.shaders.builtin_functions.integer.*  Change-Id: Ib0056c17671c42b6496c2f0ef059b99f8f25c122 Reviewed-on: https://chromium-review.googlesource.com/431310 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix creating pbuffers on IDCompositionSurfaces.  IDCompositionSurfaces can't be bound as SRVs so don't try to create SRVs for them.  Also OMSetRenderTargets must have NumViews <= 1 if an IDCompositionSurface is being bound. MRT doesn't work with them and just having the remaining elements be null isn't enough.  BUG=678800  Change-Id: I76b28de7cbda772bff286eae2b83b70c9dcd2232 Reviewed-on: https://chromium-review.googlesource.com/431134 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: John Bauman <jbauman@chromium.org>, 23355681, 619, 169, 619
Vulkan: Simple buffer creation.  This is necessary to initialize vertex arrays.  BUG=angleproject:1579  Change-Id: Ic5a232d5cdfaa75b41241901de842e62ff3b173f Reviewed-on: https://chromium-review.googlesource.com/406645 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
GLES: Expose OES_mapbuffer in GLES2 on GLES3.  This extension is mandatory for EXT_map_buffer_range support. We can emulate it using GLES 3.0 core map functionality.  BUG=angleproject:1751  Change-Id: Idba09ce7276603d5556039f4a49aa0b87cae22aa Reviewed-on: https://chromium-review.googlesource.com/431826 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Reland "Replace gl::trace logging with Chromium style logging"  Removing one usage of FormatString() and its static buffer. And preparation for Platform logging.  Fix incorrect enabling of ERR() calls in UNIMPLEMENTED() and UNREACHABLE() resulting in increased code size and <iostream> adding 5 static initializers to chrome because of cerr referenced in statically linked translator.  BUG=angleproject:1660  Change-Id: I7caa18036118d532e0544f75278602559172ae04 Reviewed-on: https://chromium-review.googlesource.com/431457 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add support for 4-parameter functions to BuiltInFunctionEmulator  New entry points are needed to support built-ins with more parameters.  Also now that ops that are not function calls don't use the TIntermAggregate class any more it's easier to exclude nodes that are not candidates for built-in emulation using a simple blacklist rather than to use a whitelist.  Also includes function name style cleanup in BuiltInFunctionEmulator.  This will make it possible to add necessary emulation for built-ins from ESSL 3.10.  BUG=angleproject:1730 TEST=angle_unittests  Change-Id: If267fc68f5cb9b2ee6703cbcbbe4d157da44a7e0 Reviewed-on: https://chromium-review.googlesource.com/431297 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add symbol table function to get TFunction for a built-in op  Built-in function parameter qualifiers are stored in the symbol table. Some AST traversers need the qualifier information for ops to determine whether a node is being written to. Add an utility function that maps a TIntermAggregate node to a symbol table entry so that the traversers can get to this information in a convenient way.  This will be necessary for adding more built-ins that have out parameters from ESSL 3.10.  BUG=angleproject:1730 TEST=angle_unittests  Change-Id: I4bc622d70b2326a04cc858ff1258c22320c590dc Reviewed-on: https://chromium-review.googlesource.com/431109 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ES31: GetTexLevelParameter support for multisampled texture for GL renderer  BUG=angleproject:1679 TEST=dEQP-GLES31.functional.state_query.texture_level.texture_2d_multisample.*  Change-Id: Ic31f079c0c999d695eb695413271bd0ad10d05ba Reviewed-on: https://chromium-review.googlesource.com/429930 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update BUILD.gn to account for Android default linker script change  BUG=681557  Change-Id: I8fb4e50d241e3519b27d57a507d92cc3c15877ef Reviewed-on: https://chromium-review.googlesource.com/430877 Commit-Queue: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Clean up TIntermAggregate folding  The division between 2- and 3-parameter built-ins is superfluous and can be removed. Also folding support for ESSL 3.00 is complete so the comments about needing to add folding support for more functions can be removed.  BUG=angleproject:1730 TEST=angle_unittests  Change-Id: I5ca93a957a98a7740eca506e44af48e7b4b83bad Reviewed-on: https://chromium-review.googlesource.com/431108 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Use GetOperatorString in intermediate output  The special names for built-ins used in intermediate output are kept only where they add some significant value like clearly disambiguating between component-wise and non-component-wise ops. Otherwise intermediate output now relies on GetOperatorString to give names for ops.  This will make it easier to add new built-in functions.  This also fixes intermediate output for TIntermSwizzle dFdx dFdy and fwidth.  BUG=angleproject:1730 TEST=angle_unittests  Change-Id: Ifa06b886ad8e24b0820513adae8decd60d80a0e7 Reviewed-on: https://chromium-review.googlesource.com/431032 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Use GetOperatorString when initializing symbol table  This will make it easier to add more built-in functions.  BUG=angleproject:1730 TEST=angle_unittests  Change-Id: I5219a83e964b6ee15c690e108313960a873dd8e5 Reviewed-on: https://chromium-review.googlesource.com/431031 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Make AST path always include the current node being traversed  AST traversers tend to sometimes call traverse() functions manually during PreVisit. Change TIntermTraverser so that even if this happens all the nodes are automatically added to the traversal path instead of having to add them manually in each individual AST traverser.  This also makes calling getParentNode() return the correct node during InVisit.  This does cause the same node being added to the traversal path twice in some cases where nodes are repeatedly traversed like in OutputHLSL but this should not have adverse side effects. The more common case is that the traverse() function is called on the children of the node being currently traversed.  This fixes a bug in OVR_multiview validation which did not previously call incrementDepth and decrementDepth when it should have.  BUG=angleproject:1725 TEST=angle_unittests angle_end2end_tests  Change-Id: I6ae762eef760509ebe853eefa37dac28c16e7a9b Reviewed-on: https://chromium-review.googlesource.com/430732 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Refactor trifan and line loop parameters.  Use baseVertex as the parameter of drawLineLoop and drawTriangleFan. The old name is not clear for its usage.  BUG=angleproject:1724  Change-Id: I529a157f055eba9d62952093f37eabb8398697db Reviewed-on: https://chromium-review.googlesource.com/430255 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Buffer11: Fix use-after-free with system memory storage.  Certain use patterns could trigger a deallocation of the system memory storage as it was being initialized. Fix this by resetting the idle counter before we enter into the internal update which would trigger the deallocation check.  BUG=chromium:682020  Change-Id: Ic3dac78ffa778cbaf103820a23eea009ce439d5c Reviewed-on: https://chromium-review.googlesource.com/430304 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Add support to compile and link compute shaders  This is a reland of 2cd9d7e032fb412b539a907c58342060340387a1.  BUG=angleproject:1442 TEST=angle_end2end_tests  Change-Id: I5be0032b97617c31cdd4c66a823e8eb3b518867a Reviewed-on: https://chromium-review.googlesource.com/430199 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Validate main() prototype declarations with incorrect parameters  Instead of just validating definitions of main() do the validation for all function headers for functions named "main" including headers in prototype declarations.  BUG=angleproject:1712 TEST=angle_unittests  Change-Id: Ia34a2a756e1cc27b241b27e8c01c6ef09bffba71 Reviewed-on: https://chromium-review.googlesource.com/430010 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Refactor EGL config entry points to to separate validation.  BUG=angleproject:1707 BUG=angleproject:798  Change-Id: I34fefa9f9bbd42ef05f222c8caf856a22cf206a3 Reviewed-on: https://chromium-review.googlesource.com/428293 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Always store function headers in TIntermFunctionPrototype nodes  TIntermFunctionDefinition nodes now have a TIntermFunctionPrototype child that stores the function signature instead of having a separate type and an aggregate child that stores the parameters.  This makes parsing functions simpler and paves the way for further simplifications of function parsing like reducing conversions between symbol table structures and AST structures.  TIntermAggregate is now only used for function calls.  BUG=angleproject:1490 TEST=angle_unittests angle_end2end_tests  Change-Id: Ib56a77b5ef5123b142963a18499690bf37fed987 Reviewed-on: https://chromium-review.googlesource.com/427945 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add a perf test for binding buffers.  BUG=angleproject:1639  Change-Id: I42da2acdb7c99116c4418a2f71d65d72d328d641 Reviewed-on: https://chromium-review.googlesource.com/428572 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Vulkan: Configure a simple RenderPass for drawing.  BUG=angleproject:1319  Change-Id: I0668527a338a2f10ca74b43f2a8bd82534e732c0 Reviewed-on: https://chromium-review.googlesource.com/370805 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Roll EGL headers.  Update CGL backend to use new EGL types.  BUG=angleproject:1707  Change-Id: I165e81a758cad0a8036aef68c44a57bcc61e982d Reviewed-on: https://chromium-review.googlesource.com/428292 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix dot() signature to avoid an implicit copy constructor call.  That also fixes the build with Clang ToT compiler.  BUG=chromium:681912  Change-Id: I1449ee0f1f3f031d64af1a1f64f43808d2a8a1b1 Reviewed-on: https://chromium-review.googlesource.com/428903 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Manage preprocessor Macro objects with shared pointers  This ensures that pointers to Macros that are removed from the macro set stay valid. Pointers to undef'd macros may need to be referred to if reenabling the macros has been deferred.  BUG=chromium:681324 TEST=angle_unittests  Change-Id: Ibbbabbcbd6b0a84254cda717ae63712e6d404ebd Reviewed-on: https://chromium-review.googlesource.com/427948 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Split TIntermFunctionPrototype from TIntermAggregate  Function prototypes now have their own class TIntermFunctionPrototype. It's only used for prototypes not function parameter lists.  TIntermAggregate is still used for parameter lists and function calls.  BUGS=angleproject:1490 TEST=angle_unittests  Change-Id: I6e246ad00a29c2335bd2ab7f61cf73fe463b74bb Reviewed-on: https://chromium-review.googlesource.com/427944 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
ES31: Implement multisampled Textures.  Implement TexStorage2DMultisample and getMultisamplefv entry point. Also modify sample state for Textures and Framebuffers.  BUG=angleproject:1590 TEST=angle_unittests TEST=angle_end2end_tests TEST=dEQP-GLES31.functional.texture.multisample.samples_*.sample_position TEST=dEQP-GLES31.functional.texture.multisample.samples_*.use_texture_color_2d TEST=dEQP-GLES31.functional.texture.multisample.samples_*.use_texture_depth_2d TEST=dEQP-GLES31.functional.texture.multisample.negative.fbo_attach_different_sample_count_tex_tex TEST=dEQP-GLES31.functional.texture.multisample.negative.fbo_attach_different_sample_count_tex_rbo TEST=dEQP-GLES31.functional.texture.multisample.negative.fbo_attach_non_zero_level TEST=dEQP-GLES31.functional.texture.multisample.negative.texture_high_sample_count TEST=dEQP-GLES31.functional.texture.multisample.negative.texture_zero_sample_count TEST=dEQP-GLES31.functional.shaders.builtin_functions.texture_size.samples_1_texture_2d TEST=dEQP-GLES31.functional.shaders.builtin_functions.texture_size.samples_4_texture_2d  Change-Id: I8fa7bd4e73b95745858a3e16b1b92004b4a18712 Reviewed-on: https://chromium-review.googlesource.com/414309 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Yunchao He <yunchao.he@intel.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
OpenGL 4.2 is required when using ARB_compute_shader extension  BUG=angleproject:1702 TESTCASE=angle_end2end_tests  Change-Id: I45fe21bc14310b9c873e83004a8ac8766865fbb9 Reviewed-on: https://chromium-review.googlesource.com/428690 Reviewed-by: Yunchao He <yunchao.he@intel.com> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Skip DepthTexturesWithMipmaps on Win Intel.  BUG=angleproject:1706 TEST=Win Intel HD 530 Debug bot on GPU FYI waterfall  Change-Id: I9037e777f42654e7030bcf197e81d0c118bb792d Reviewed-on: https://chromium-review.googlesource.com/428221 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Vulkan: Implement basic Clear and ReadPixels.  This enables the simple operations clear test on Vulkan. The current implementation is very synchronous - it will block and finish the current command buffer if there is any possibility of a race.  BUG=angleproject:1319  Change-Id: If01fe9a19ed6f539639a38786193d3626164cada Reviewed-on: https://chromium-review.googlesource.com/367754 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Micro-optimize Uniform updates.  This saves a few re-computations of the same stuff.  BUG=angleproject:1671  Change-Id: I28f955cd880366a86c0bb22285a119e97661e2cb Reviewed-on: https://chromium-review.googlesource.com/427326 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
WebGL: Validate texture copying feedback loops.  This adds basic validation for catching CopyTex{Sub}Image calls whose source and destination textures overlap. It does not yet implement full support for ES3 types (3D textures array textures).  BUG=angleproject:1685  Change-Id: I83e7b1998df5575057fed8f99f7ee9970fb38df0 Reviewed-on: https://chromium-review.googlesource.com/425491 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Change remaining compile-time folding errors to warnings  The GLES working group has decided to amend the spec so that implementations are not allowed to generate compile errors on undefined values detected at compile time. Change the remaining folding errors to warnings to follow the newly clarified rules.  The end2end_tests covering this are removed since they're redundant with the more efficient unit test.  BUG=angleproject:1703 TEST=angle_unittests  Change-Id: I97d2fd532dbe5733581bdc4aa40a5d7d3734fc0d Reviewed-on: https://chromium-review.googlesource.com/427799 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
ES31: Implement glGetTexLevelParameter{i|f}v entry point  BUG=angleproject:1679 TEST=dEQP-GLES31.functional.state_query.texture_level.*  Change-Id: I36cc7406199fc0c3c1585ad48f010d7dba5fe9e4 Reviewed-on: https://chromium-review.googlesource.com/414250 Commit-Queue: Yunchao He <yunchao.he@intel.com> Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Vulkan: Update build files after roll.  They have consolidated to one helper script generator. Simplifies the GN build. This also re-enables the Vulkan back-end after the roll.  BUG=angleproject:1319  Change-Id: Ie98568ae5d1dc46932ea8d698809561da7591836 Reviewed-on: https://chromium-review.googlesource.com/427307 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add missing sampler types to shader_translator output  The types are organized as in the ESSL 3.10 spec.  BUG=angleproject:1681  Change-Id: If8e0ab2c604fcf9b61d3d89719e95854d494231c Reviewed-on: https://chromium-review.googlesource.com/427843 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
HLSL output: Fix nested dynamic indexing in an l-value  This fixes cases where a matrix is indexed and then the resulting vector is indexed in the same expression inside an l-value.  BUG=angleproject:1672 TEST=angle_end2end_tests  Change-Id: Ia0593d75da67e0aa582003e1c381f2a1c89f948c Reviewed-on: https://chromium-review.googlesource.com/427938 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "Replace gl::trace logging with Chromium style logging"  Failing Chromium static initializers check:  FAILED linux-release-64/sizes/chrome-si/initializers: actual 8 expected 7 better lower  Possibly due to the static initializer for std::array for the log severity types. We should change it to POD.  BUG=angleproject:1660  This reverts commit afcc41cee4ff63e7f6c9e60e55fc061adbba7dd4.  Change-Id: Ifb362a4af78542608397c7a0b19e6afe076f2cf3 Reviewed-on: https://chromium-review.googlesource.com/427235 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Roll Vulkan to bcb80d06b.  This includes a loader fix for systems with stale drivers.  BUG=angleproject:1319  Change-Id: I9ee726bd508c89b19508a5f3113f7b90593635d5 Reviewed-on: https://chromium-review.googlesource.com/427265 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Skip two unittests on Linux/Intel.  BUG=680631 TEST=angle_end2end_tests on Linux/Intel  Change-Id: I0823b5accc1c1962d7b498bf74d58edcc6971133 Reviewed-on: https://chromium-review.googlesource.com/427285 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "D3D11: Add support to compile and link compute shaders."  Fails https://build.chromium.org/p/chromium.gpu.fyi/builders/Linux%20Debug%20%28New%20Intel%29/builds/5769  BUG=angleproject:1442  This reverts commit 2cd9d7e032fb412b539a907c58342060340387a1.  Change-Id: Ic1610d20ba0449b423528fa9840aa951c012cf84 Reviewed-on: https://chromium-review.googlesource.com/427229 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Replace gl::trace logging with Chromium style logging  Removing one usage of FormatString() and its static buffer. And preparation for Platform logging.  BUG=angleproject:1660  Change-Id: I58192988ad16196706fe48d0c0ab0fd1a10c0210 Reviewed-on: https://chromium-review.googlesource.com/424173 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
WebGL: Validate simple rendering feedback loops.  This adds the most basic form of rendering feedback loop detection: when we're rendering to a texture that's also bound as an input. It doesn't filter by selected mipmap level or 3D texture slice or do depth attachment validation. It also is missing checks for feedback loops against the default Framebuffer.  BUG=angleproject:1685  Change-Id: Idb0ee2bfe1c35611544d132204c0da832c0f1c48 Reviewed-on: https://chromium-review.googlesource.com/425489 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Fbo attaching non-zero base level texture should be complete"  This reverts commit b293a2601d29a95c0716725e460b395fff29e8e5.  Failing as of: https://build.chromium.org/p/chromium.gpu.fyi/builders/Linux%20Release%20%28AMD%20R5%20230%29/builds/580 https://build.chromium.org/p/chromium.gpu.fyi/builders/Linux%20Release%20%28AMD%20R7%20240%29/builds/1258  zmo@ wants this reverted.  Change-Id: I457b6127e551c546ed861dd2d9b3f90b7bbab034 Reviewed-on: https://chromium-review.googlesource.com/427222 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove WebGL-CTS-known-failures.txt.  This file is no longer maintained.  BUG=None  Change-Id: Idc2d3986a94ee524d3b28a2697a08496862f10e0 Reviewed-on: https://chromium-review.googlesource.com/427338 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Expand Uniforms perf test.  This will run additional tests for redundant uniform sets on vec4 uniforms as well as matrix. Also rename the metrics slightly.  BUG=angleproject:1385  Change-Id: Ib9777ea38d3153cc0fb69658fcf96d75b03f3770 Reviewed-on: https://chromium-review.googlesource.com/427141 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Add support to compile and link compute shaders.  BUG=angleproject:1442  Change-Id: I13240e931e6f121d175d2cd6b41324d38bb39a5c Reviewed-on: https://chromium-review.googlesource.com/405831 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move ProgramGL's sampler bindings to gl::Program.  This saves code duplication and makes the sampler validation a bit simpler. In the future we might be able to use it to replace the custom D3D logic for caching sampler info but this relies on some shader-specific non-merged data.  This also introduces some code duplication in Uniform1iv.  BUG=angleproject:1685  Change-Id: I258607a21886ca20766607bddf958cd511fac3f1 Reviewed-on: https://chromium-review.googlesource.com/426781 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
translator_fuzzer: destroy translator cache on exit.  BUG=chromium:679725  Change-Id: I73b45b9ff2f1a270afce8c77a701e2659fd2b7c9 Reviewed-on: https://chromium-review.googlesource.com/426017 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Vulkan: Fix GYP layer dependencies.  The GYP project wasn't correctly depending on the various layer targets like the GN was.  BUG=angleproject:1319  Change-Id: I54794c71be899fe5ba40cb999ecf2ce7c4a972b5 Reviewed-on: https://chromium-review.googlesource.com/425941 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Vulkan: Introduce vk::Format.  BUG=angleproject:1319  Change-Id: I88bcc6caa5d29565728848bada1563e47e383b29 Reviewed-on: https://chromium-review.googlesource.com/367753 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix shader support of OVR_multiview  Fix up incorrect capitalization of gl_ViewID_OVR in a few places.  Also add extension macro test to compiler unit tests.  BUG=angleproject:1669 TEST=angle_unittests  Change-Id: Ia7fdd747ad08355cdc149db9e2e7911c2e673af5 Reviewed-on: https://chromium-review.googlesource.com/425851 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Tighten the workarounds on isnan for Intel drivers  This driver bug has been fixed in 21.20.16.4542.  BUG=chromium:650547  Change-Id: I2a5c7c01bf48d854bd6c4c6a380e57617e00529a Reviewed-on: https://chromium-review.googlesource.com/422992 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Vulkan: Enable validation layers on request.  Also adds the build files for the Vulkan layers.  The layers are enabled by default for the tests.  BUG=angleproject:1319  Change-Id: I0b442b36312a1299a932922e1c4e39f00801de49 Reviewed-on: https://chromium-review.googlesource.com/367751 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Roll Vulkan validation layers.  Includes fix for incorrectly guarded gcc-specific pragma. https://github.com/KhronosGroup/Vulkan-LoaderAndValidationLayers/pull/1301  BUG=angleproject:1668  Change-Id: Iee60d5f7fbfa7c6d35c0085f0905dcb2e0987188 Reviewed-on: https://chromium-review.googlesource.com/423266 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Suppress Intel program binary test on Win/OpenGL.  We might need to disable binaries on OpenGL Windows Intel at some point or make a workaround for this particular bug.  BUG=angleproject:1637  Change-Id: If9f73725a01f29f1148cff68d15b228e5841a2f8 Reviewed-on: https://chromium-review.googlesource.com/423234 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add GL_EXT_texture_compression_s3tc_srgb to GLES2/gl2ext.h  This extension is currently in draft; ANGLE will be the first implementation.  BUG=angleproject:1553 BUG=chromium:630498  Change-Id: I795caa36f722a347cb7924990b60452d51b1e177 Reviewed-on: https://chromium-review.googlesource.com/423435 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Kai Ninomiya <kainino@chromium.org>, 23355681, 619, 169, 619
Add varying packing validation for WebGL.  This CL moves the varying packing from the D3D layer up to Program. This is necessary for WebGL validation and gives us consistency for the various back-ends. There may be some additional cleanup work on the VaryingPacking class because it does some work that is D3D- specific.  WebGL requires strict varying packing. Instead of allowing success unconditionally it's an explicit error to succeed to pack a set of varyings that the sample algorithm would fail to pack.  Introduce a new packing mode option to the varying packing class to handle this different packing style while keeping our old more relaxed packing method for ES code.  BUG=angleproject:1675  Change-Id: I674ae685ba573cc2ad7d9dfb7441efa8cb2d55fc Reviewed-on: https://chromium-review.googlesource.com/423254 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Update GLES2/gl2ext.h to revision 33260 (2016-10-27)  From https://www.khronos.org/registry/gles/api/GLES2/gl2ext.h  BUG=angleproject:1553  Change-Id: I3a0e5ee77de3db02eace63d40df7db040a739f88 Reviewed-on: https://chromium-review.googlesource.com/423434 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disable the flaky expectation in TimerQueriesTest.TimeElapsed.  BUG=676689  Change-Id: I5cf6fe7573d69a52b1c33f70a78f081ee833d1b5 Reviewed-on: https://chromium-review.googlesource.com/423388 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add test for WebGL compatibility restriction on GL_FIXED and max stride  BUG=angleproject:1523  Change-Id: If3ab8fa9d7e80f7abb2f4ac864a936e93dfd902c Reviewed-on: https://chromium-review.googlesource.com/422963 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Generate errors when read buffers are missing in BlitFramebuffer.  The corresponding gl_tests has been updated too.  BUG=672719  Change-Id: Ief37bc397f7aa065bf99d6ebad0a1b50b1917dac Reviewed-on: https://chromium-review.googlesource.com/420469 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix program binary crash with UBO bindings.  This crash could occur when saving and loading a program with UBO bindings that was never used in a draw operation. The fix is to ensure the D3DLinkedUniforms are properly initialized before we save the program binary.  BUG=angleproject:1637  Change-Id: I9691e375d19dc628f34f351ae94b68bd0f2f76b8 Reviewed-on: https://chromium-review.googlesource.com/422665 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add shader translator support for OVR_multiview  The OVR_multiview and OVR_multiview2 extensions add gl_ViewID_OVR to shaders. gl_ViewID_OVR can be translated either as is in GLSL output or as a uniform by setting the SH_TRANSLATE_VIEWID_OVR_AS_UNIFORM compiler flag.  If WebGL output is selected the shaders will be validated according to proposed rules in the WEBGL_multiview spec.  BUG=angleproject:1669 TEST=angle_unittests  Change-Id: I19ea3a6c8b4edb78be03f1a50a96bfef018870d0 Reviewed-on: https://chromium-review.googlesource.com/422848 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
ProgramD3D: optimize Transpose/ExpandMatrix  BUG=angleproject:1390  Change-Id: I7e8eb1f7924014bbde38269ef0fd0f7d65639083 Reviewed-on: https://chromium-review.googlesource.com/420518 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
WebGL compatibility: add stencil mask and ref restriction  BUG=angleproject:1523 BUG=chromium:668223  Change-Id: I0726769c938fdfd50af0fad1cef1746d4af2a589 Reviewed-on: https://chromium-review.googlesource.com/422084 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove libEGL dependency on libANGLE  libEGL should use libGLESv2 for EGL implementation to prevent libANGLE global variables being duplicated.  BUG=angleproject:1660  Change-Id: I84c1e22fcce8f4a21acfb1fcde0c84ebd77204f8 Reviewed-on: https://chromium-review.googlesource.com/422574 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Revert "Supress failures for the 16.12.1 Windows AMD D3D11 driver."  This reverts commit e2d0e41fa30879fbd0bf3f2688936dc0293fd79d.  Reason for revert: The driver on these machines has been rolled back to the previous version so these tests are expected to pass again.  Original change's description: > Supress failures for the 16.12.1 Windows AMD D3D11 driver. >  > BUG=676333 >  > Change-Id: I2c29b3dd4ee00bb68575371fe3b1320aad087575 > Reviewed-on: https://chromium-review.googlesource.com/422479 > Reviewed-by: Geoff Lang <geofflang@chromium.org> >   TBR=geofflang@chromium.org BUG=676333 NOPRESUBMIT=true NOTREECHECKS=true NOTRY=true  Change-Id: Ia2952ef55002201dc8c34a4f45c2483bffbf6f43 Reviewed-on: https://chromium-review.googlesource.com/423126 Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Enable building angle_perftests on Linux.  BUG=chromium:675997  Change-Id: I3058892b80ccf61664d023419651fd4aa1dfec2a Reviewed-on: https://chromium-review.googlesource.com/423111 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Roll Vulkan validation layers.  Includes a fix for Clang call cast conversion warning.  BUG=chromium:676217  Change-Id: I1b8bf8698714f4280aea52415ae5f96272a2219a Reviewed-on: https://chromium-review.googlesource.com/422440 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
dEQP: Update documentation.  BUG=None  Change-Id: I07ebad06057671791c2e0524dc3af2da5f884582 Reviewed-on: https://chromium-review.googlesource.com/422910 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Supress failures for the 16.12.1 Windows AMD D3D11 driver.  BUG=676333  Change-Id: I2c29b3dd4ee00bb68575371fe3b1320aad087575 Reviewed-on: https://chromium-review.googlesource.com/422479 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Vulkan: Add display creation test and extension.  With this CL we have the ability to create Vulkan test configs and run basic tests although the only thing that works is creating a Vulkan Renderer using the extension.  BUG=angleproject:1319  Change-Id: I8ad17bba01241334be7da16e68fea38762ca6a20 Reviewed-on: https://chromium-review.googlesource.com/367750 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
FramebufferGL: fix a crash when there is no color buffer.  BUG=chromium:675819  Change-Id: I7d143ba51bb16f28b145aa2b0410929d29e0b464 Reviewed-on: https://chromium-review.googlesource.com/422493 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix cast warning in UniformsPerf.cpp.  BUG=None  Change-Id: I28af0d2be5ef545e78b8283d43d14078c0d1b62a Reviewed-on: https://chromium-review.googlesource.com/422491 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement the WebGL VertexAttribPointer restrictions  BUG=angleproject:1523 BUG=chromium:668223  Change-Id: Ic89c476a6c95824069772e22ede596ba85ac8859 Reviewed-on: https://chromium-review.googlesource.com/422347 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Manually write overflow checks for glDraw*  The usage of checked numerics showed has a big hotspot in ValidateDrawAttribs. BUG=angleproject:1671 BUG=chromium:674143  Change-Id: I96392e099b2257e465fb47e1c96f9aa1f54a89ba Reviewed-on: https://chromium-review.googlesource.com/422428 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
UniformsPerf: Properly limit maximum uniform vectors.  The uniforms check was not correctly validating vector count instead of uniform count. Fix this and reduce the maximum maxtrix uniforms to fix a crash on the perf bots.  BUG=angleproject:1385 BUG=angleproject:1390 BUG=angleproject:1671  Change-Id: I261477c33639ed516ff6a29b38ab87f89309a7f1 Reviewed-on: https://chromium-review.googlesource.com/422533 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix stale SRVs with tiny depth textures.  When the tiny depth texture would get re-created on change it was not freeing any cached SRVs which were pointing to the old tex. Fix this by erasing the cache entry if the texure is recreated.  Also include a test which hooks into the workarounds to force testing on every platform.  Also narrow the workaround to only apply to depth/stencil textures which use these mips in GL rather than D3D where we always create a full mip chain.  BUG=angleproject:1664  Change-Id: If0ac396b8847e1bf9b50165e5332da573e9bb3e4 Reviewed-on: https://chromium-review.googlesource.com/421567 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Rename MalformedShaderTest to ShaderValidationTest  Lots of these tests aren't actually testing malformed shaders so the name was misleading. ShaderValidationTest reflects the content of the tests better.  Some test classes that needlessly used different API spec versions are also merged.  BUG=angleproject:1673 TEST=angle_unittests  Change-Id: Ib842af153a09d3887f9bb857709fd0cd29bcc9c4 Reviewed-on: https://chromium-review.googlesource.com/422368 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Vulkan: Hook up loader code.  This integrates the build files for the loader SDK and tests the compilation by calling InitInstance. There's no current way to test the runtime behaviour since there's no way for the tests to initialize the Vulkan back-end that will come in the next CL.  BUG=angleproject:1319  Change-Id: Ia8bf96ca068eaf40744c9753b59ffaaa5ada8a73 Reviewed-on: https://chromium-review.googlesource.com/367519 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D: Ensure compiler is loaded in applyShaders.  We're finding that D3Dcompile is being called with a null compiler handle. This means at some point we successfully linked a program using a valid compiler handle and likely we went through some traumatic event like a GPU device lost. This unloaded the compiler DLL and hence leads to a null deref.  It's not clear how this is happening since a device lost should trigger a restart of the browser process in all cases with Chrome but this should fix the NULL deref and lead to a user-visible program link error.  BUG=chromium:671162  Change-Id: Ibf85f19d4f099d2f00921c230ee0a52b46bfd8cf Reviewed-on: https://chromium-review.googlesource.com/422553 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix up translator style.  Using git cl format.  BUG=angleproject:650  Change-Id: I7d3f98d2b0dcfb0a8de6c35327db74e55c28d761 Reviewed-on: https://chromium-review.googlesource.com/419059 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make the NPOT extension requestable. Fix NPOT validation in CopyTexImage.  BUG=angleproject:1523 BUG=668223 TEST=conformance/more/functions/copyTexImage2DBadArgs.html  Change-Id: I5fbf4f99fa941c356ecb57d67dd47a33741ce189 Reviewed-on: https://chromium-review.googlesource.com/418944 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
GLSLTest: test interaction of declaration splitting with other passes  In TranslatorHLSL a number of AST simplifications are done that must happen in a precise order for things to be correct:  - First for-loops must be split  - Then multideclarations must be split  - Finally comma operators must be split  This adds tests for interaction between this passes to make sure they are done in the right order.  BUG=668028  Change-Id: I306915b51011bb5467d117352becfd60cbe77be4 Reviewed-on: https://chromium-review.googlesource.com/417989 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
WebGL_compatibility: disallow client-side arrays  BUG=angleproject:1523  Change-Id: Icd207b2d94c1375c6f3189af42d55eac52b99603 Reviewed-on: https://chromium-review.googlesource.com/418398 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't load binaries across client versions.  BUG=angleproject:523  Change-Id: Id54033dce15f01a0f2891533172acd8b99896e12 Reviewed-on: https://chromium-review.googlesource.com/418240 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Tighten the validation for staying in array buffer bounds  BUG=angleproject:1523  Change-Id: I685a9b884e5de73b94900c5b6016ce914b9bfe7f Reviewed-on: https://chromium-review.googlesource.com/418458 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Work around unary minus operator float issue on Intel Mac 10.11  Result of -float is wrong on Intel Mac 10.11 drivers. Replace -float with 0.0 - float to work around this issue.  BUG=308366 BUG=672380  Change-Id: I53bc2eda7259fff5805bec39896fc7b7a6eaf665 Reviewed-on: https://chromium-review.googlesource.com/417169 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix angle_deqp_egl_tests compilation on Android  BUG=angleproject:1657  Change-Id: I5afb28485bd5ca7bdf7015f5fdcaa84ec3c02b95 Reviewed-on: https://chromium-review.googlesource.com/418710 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Fix compilation after dEQP roll  BUG=chromium:671021  Change-Id: Iee0e7b1b146b53c6324da8e51d70de42487092b5 Reviewed-on: https://chromium-review.googlesource.com/418510 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Roll dEQP.  Several months of updates. Does not change the build files - will mean the GPU.FYI bots temporarily break and possibly there's some flakiness on the ANGLE trybots and Optional GPU bots until the correct suppression set is instated.  BUG=chromium:671021  Change-Id: I207be11ed37a9173f53a06554880be6ebcaee5fa Reviewed-on: https://chromium-review.googlesource.com/418405 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Constant fold compute shader local work group size  gl_WorkGroupSize should be written into the AST as a constant node instead of a symbol node. In correct shaders local size is guaranteed to have been declared before any references to gl_WorkGroupSize - otherwise the shader translator was already generating an error.  This ensures that work group size can be used to size arrays as specified and also works around a crash issue on NVIDIA Linux OpenGL driver.  BUG=angleproject:1442 TEST=angle_unittests  Change-Id: I9b1a4bff16ecf2c3db1511c3702756346cdd2f6b Reviewed-on: https://chromium-review.googlesource.com/418735 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
dEQP-GLES3: Suppress two failing Win/AMD tests.  Might be flaky more suppressions might be needed.  BUG=angleproject:1633  Change-Id: Ic5665aadb7cbbae82639d206f29a2db859622451 Reviewed-on: https://chromium-review.googlesource.com/418399 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make minimum GLSL version for compute shaders GLSL 430  Compute shaders were added to the core OpenGL spec in version 4.3.  Also don't output GL_ARB_explicit_attrib_location extension directive for compute shaders. This extension is only relevant for vertex and fragment shaders.  BUG=angleproject:1442 TEST=angle_end2end_tests  Change-Id: I92021ac048b38ffbc5a61af408b37c387193389b Reviewed-on: https://chromium-review.googlesource.com/418657 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Output infinity and NaN literals correctly in shaders  Previously infinity and NaN resulting from constant folding would be clamped to finite 32-bit float range when they were written in shader output. Now they are written as a bit pattern in case the shader version allows it.  This does not guarantee that NaNs work but this is fine since ESSL 3.00.6 spec has very loose requirements when it comes to NaNs.  BUG=angleproject:1654 TEST=angle_end2end_tests  Change-Id: I9997000beeaa8ed22523c22d5cf6929cdfc93f60 Reviewed-on: https://chromium-review.googlesource.com/417301 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D: Fix overflow in varying packing.  Also add a more robust set of unit tests for this internal class. Because the GL spec allows for succeess when packing any set of varyings it's impossible to write negative end to end tests. This CL also rewrites our disabled varying packing GLSL tests as unit tests.  BUG=angleproject:1296 BUG=angleproject:1638  Change-Id: I78153742517d5c72ddb13ff59dc44ddc4af42fc2 Reviewed-on: https://chromium-review.googlesource.com/415555 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D: Move some HLSL-specific code to a new folder.  This code doesn't actually call any D3D runtime methods so it can be included in our cross platform unit tests. Just include the varying packing code for now.  BUG=angleproject:1296 BUG=angleproject:1638  Change-Id: I5c0ccccb00e1c13ca98448256be048f7cd0968ce Reviewed-on: https://chromium-review.googlesource.com/417116 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
dEQP: Update multiple test expectations.  Many tests were removed from mustpass at some point and a couple were expected to fail but passing. Also update some of the global skip settings to use DEBUG RELEASE as a catch-all.  BUG=angleproject:989 BUG=angleproject:998 BUG=angleproject:1017 BUG=angleproject:1018 BUG=angleproject:1019 BUG=angleproject:1020 BUG=angleproject:1025 BUG=angleproject:1027 BUG=angleproject:1028 BUG=angleproject:1033 BUG=angleproject:1034 BUG=angleproject:1051 BUG=angleproject:1108 BUG=angleproject:1143 BUG=angleproject:1335 BUG=angleproject:1418 BUG=angleproject:1655 BUG=angleproject:1656  Change-Id: I731d3adeed36509ce69f72e5fcc80d0adc89cb67 Reviewed-on: https://chromium-review.googlesource.com/418063 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
translator: separate declarations after rewriting loops  Otherwise when trying to add the declarations back things might fail because the loop initialization is a sequence and not a block.  BUG=668028  Change-Id: I8d84a25c25765e9655c16ce56604ae08f0f8176c Reviewed-on: https://chromium-review.googlesource.com/414305 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
dEQP-GLES2: Update test expectations.  Many test expectations listed were not in the mustpass list so weren't even necessary.  BUG=angleproject:989 BUG=angleproject:1015 BUG=angleproject:1016 BUG=angleproject:1020 BUG=angleproject:1025 BUG=angleproject:1027 BUG=angleproject:1029 BUG=angleproject:1030 BUG=angleproject:1128  Change-Id: Ia18796cb3388e8528b4351cb2c81ff9793a1d250 Reviewed-on: https://chromium-review.googlesource.com/417413 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add support for GL_DRAW_INDIRECT_BUFFER_BINDING binding point  BUG=angleproject:1595 TEST=dEQP-GLES31.functional.state_query.integer.draw_indirect_buffer_binding*  Change-Id: Ib8f712fdf10411ef0b7b63742d17c3caca99137b Reviewed-on: https://chromium-review.googlesource.com/416193 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Validate that line width is not NaN.  BUG=668223  Change-Id: I2f38b358dd4a6b9327562704dacce37f2b16acaa Reviewed-on: https://chromium-review.googlesource.com/417192 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Handle constant folding arithmetic involving infinity  Constant folding arithmetic operations that involve infinity are now handled correctly in the cases where the result is infinity or zero. The implementation mostly relies on C++ to implement IEEE float arithmetic correctly so that unnecessary overhead is avoided.  Constant folding arithmetic operations that result in overflow now issue a warning but result in infinity. This is not mandated by the spec but is a reasonable choice since it is the behavior of the default IEEE rounding mode.  Constant folding arithmetic operations that result in NaN in IEEE will generate a warning but the NaN is kept. This is also not mandated by the spec but is among the allowed behaviors.  There's no special handling for ESSL 1.00. ESSL 1.00 doesn't really have the concept of NaN but since it is not feasible to control generating NaNs at shader run time either way it should not be a big issue if constant folding may generate them as well.  TEST=angle_unittests BUG=chromium:661857  Change-Id: I06116c6fdd02f224939d4a651e4e62f2fd4c98a8 Reviewed-on: https://chromium-review.googlesource.com/414911 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Update ES 3.1 expectations from SKIP to FAIL.  Change "DEBUG RELEASE" modifier to "OPENGL D3D11" to be more specific.  Add D3D11 expectations.  BUG=angleproject:1442  Change-Id: If3a9704e7f16cc473fd6ea410d10eb01ae1a8008 Reviewed-on: https://chromium-review.googlesource.com/416960 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't require GL_ARB_gpu_shader5 in order to support ES 3.0.  ES 3.0 doesn't require non-constant sampler array indexing and we can't require it for ES 2 without breaking WebGL for some users.  BUG=671280  Change-Id: Ib04446284acc92410a90c683a3d222871de554a8 Reviewed-on: https://chromium-review.googlesource.com/416195 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Implement GL_CHROMIUM_sync_query for GL.  BUG=angleproject:1366  Change-Id: I9e44679754eb704b390191c28206dedc3dc7cc4f Reviewed-on: https://chromium-review.googlesource.com/367082 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Change dEQP ES 3.1 expectations from FAIL to SKIP.  UNIMPLEMENTED debug spam was causing the tests time time out.  We can mark them as FAIL again once the dEQP test setup/tear down code doesn't emmit so many messages.  Implement a couple validation cases for ES 3.1 to greatly reduce the spam.  BUG=angleproject:1647 BUG=angleproject:1442  Change-Id: Ie7b4ac8737a2df1c0ada6ad53154ddf2f37d9c3c Reviewed-on: https://chromium-review.googlesource.com/415520 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
common: Add a vector arithmetic helper classes  Change-Id: I2f96baedf10d346eaa150bab04f8f6ca3ba573b9 Reviewed-on: https://chromium-review.googlesource.com/414272 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Suppress flaky TransformFeedbackTest.MultiContext on Intel OSX.  BUG=angleproject:1645  Change-Id: If35d277705ce9f2882d9ba059bd56e494ca9d123 Reviewed-on: https://chromium-review.googlesource.com/415613 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Suppress flaky test on Intel D3D Windows.  PointSpritesTest.PointWithoutAttributesCompliance:  https://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Debug%20%28New%20Intel%29/builds/1741  Showing as failed now that flaky tests are not retried.  BUG=angleproject:1346  Change-Id: Ic0fce361f37394da8771fa82288b0a9206d3a347 Reviewed-on: https://chromium-review.googlesource.com/415448 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Pass the --deqp-egl-display-type= flag to dEQP tests.  BUG=angleproject:1442  Change-Id: I49299d2345f67b7ed3e2c80db0ec85589fc7583c Reviewed-on: https://chromium-review.googlesource.com/415526 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update bison/flex docs.  BUG=None  Change-Id: Id4b9674b6e98b8313c47f3fbc78cc93d137ec14c Reviewed-on: https://chromium-review.googlesource.com/415569 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Split WebGL compatibility into two extensions.  The mechanism for requesting extensions is now a separate extension. Added a way to query the extensions that support enabling.  BUG=angleproject:1523  Change-Id: I2efaa9f6d67b12ecae325f455404e34ba04d0e7c Reviewed-on: https://chromium-review.googlesource.com/414529 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Handle GL_READ_BUFFER being GL_NONE in getReadAttachment()  Change-Id: If3883de8f49a3fb33ecc598ba0b86c658cd3f0ca Reviewed-on: https://chromium-review.googlesource.com/415565 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use ComPtr references for D3D objects.  This is an work-in-progress CL to prototype using ComPtr.  It also has a new design for internal errors that doesn't use FormatString preferring a stream-based approach.  One thing to be aware of is that the address operator does not behave as expected with ComPtr - we should use ::AddressOf.  BUG=angleproject:530 BUG=angleproject:1644  Change-Id: If5643e9e5726fd9aa5cbd422fca12ae169eb5b1f Reviewed-on: https://chromium-review.googlesource.com/415027 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Refactor constant folding tests  The constant folding test classes are moved into a separate file in test_utils. This will enable adding multiple test files that use constant folding test classes so that constant folding tests can be organized better.  TEST=angle_unittests BUG=chromium:661857  Change-Id: I00bf25a4b941bdc1364ff5aa9bee2d571e4b0ea0 Reviewed-on: https://chromium-review.googlesource.com/414910 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix the coding style issue for validation code  Change-Id: I63aa1c1b3bbc52b0b522e4a703e6d20574eb21ad Reviewed-on: https://chromium-review.googlesource.com/414588 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix missing virtual destructor warning on OSX standalone  BUG=angleproject:422  Change-Id: I1a1c4551f2fc55b74afd66e7f18ea61e77250eb6 Reviewed-on: https://chromium-review.googlesource.com/414634 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement ES3.1 glProgramUniform* entry points  BUG=angleproject:1589 TEST=dEQP-GLES31.functional.program_uniform.*  Change-Id: I27fffa755fd277ed918746259cac88ab9e349c41 Reviewed-on: https://chromium-review.googlesource.com/412193 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Suppress flaky Win/AMD/GL end2end tests.  These tests became flaky when google test retries are turned off.  BUG=chromium:669196 BUG=angleproject:1643 BUG=angleproject:1541  Change-Id: I7cc10f532662928e5436a4e88a42fc109c00bfe8 Reviewed-on: https://chromium-review.googlesource.com/414216 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D: Implement multi-thread shader compilation.  Choose to use std::async for now to implement multi-threaded compiles. This should work across platforms and also be usable for other threading tasks. Note that std::async does not have a good way to wait for multiple std::futures. Also the Linux compile of std::async is broken due to a bug in an old STL version so disable it on this platform.  The implementation uses a static polymorphism approach which should have very good performance (no virtual calls).  This design leaves the door open for other future implementations such as a Win32 thread pool or one based on angle::Platform.  BUG=angleproject:422  Change-Id: Ia2f13c3af0339efaca1d19b40b3e08ecca61b8e8 Reviewed-on: https://chromium-review.googlesource.com/413712 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement EXT_discard_framebuffer for the GL backend.  BUG=angleproject:1634  Change-Id: I3822b99b59d4653e4d9a2c1d3dd16734f2050fae Reviewed-on: https://chromium-review.googlesource.com/414437 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
The return type of imageSize(gimageCube) is int2 not int3  BUG=angleproject:1442  Change-Id: I18bee163e7c7ce159cd23d6136486c49b7d9ec94 Reviewed-on: https://chromium-review.googlesource.com/414950 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add ES 3.1 version and enum to support dEQP ES 3.1 tests on Win  Change supported ES version to 3.1 on win.  Without GL_TEXTURE_2D_MULTISAMPLE enum it will reach UNREACHABLE() when running dEQP ES 3.1 tests on Win.  BUG=angleproject:1442  Change-Id: I55114854c4e9cba1caac10d3da5b416ef66a0d3e Reviewed-on: https://chromium-review.googlesource.com/414606 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Test shader built-in corner cases in constant folding tests  IEEE rules for generating zero or infinity are now checked for the constant folding of several built-in functions except for the cases where ESSL 3.00.6 explicitly states that the results are undefined.  BUG=chromium:661857 TEST=angle_unittests  Change-Id: I2ce427229a5583039694d060ea6db29c5bdace97 Reviewed-on: https://chromium-review.googlesource.com/414370 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add test for large UBO readback.  BUG=chromium:660670  Change-Id: I51c7e93f071041663f6b9a39ee75c0cca2264015 Reviewed-on: https://chromium-review.googlesource.com/414447 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a shader compile performance test.  BUG=angleproject:422  Change-Id: I10a2192c5c91360a1b7fe5e4d014bcf1fa84c96e Reviewed-on: https://chromium-review.googlesource.com/413713 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement CHROMIUM_copy_texture for OpenGL.  This also makes BlitGL work correctly on OpenGL ES (provided vertex arrays are available)  BUG=angleproject:1356  Change-Id: Icb7cef35bebfe6672220aa0b312ab89187dbf585 Reviewed-on: https://chromium-review.googlesource.com/412452 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ProgramGL: don't bindAttribLocation builtin attributes  BUG=angleproject:1636  Change-Id: Idea0e4f4a4415351b83e8f1a39b697139ff9ebe6 Reviewed-on: https://chromium-review.googlesource.com/414205 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Prevent stack overflow in macro expansion  Add a configurable limit for how many nested MacroExpander objects can be created in the preprocessor so that stack overflow can be prevented in case of malicious shaders. By default the limit is set to 1000. In unit tests the limit is set lower to make the test run faster.  Includes refactoring of most of the preprocessor tests so that they use utility functions provided by the test class instead of repeating the same code for initializing the preprocessor.  BUG=angleproject:1600 TEST=angle_unittests  Change-Id: I23b5140d9f2dc52df96111650db63150f7238494 Reviewed-on: https://chromium-review.googlesource.com/413986 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Set the return value in FenceSyncNULL::clientWait.  BUG=angleproject:1468  Change-Id: I3cf0d0a9486778b1d4384e00359034e08e425191 Reviewed-on: https://chromium-review.googlesource.com/414284 Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Check for misconfiguration of shader built-ins  Fail compiler initialization if the built-in resources are invalid. This avoids creating zero-sized arrays out of built-ins into the symbol table which could later lead to asserts when these built-ins were indexed by constants.  BUG=chromium:667468 TEST=angle_unittests  Change-Id: I9553c7c91ea355abb35b9cc6088ee14b40b0922b Reviewed-on: https://chromium-review.googlesource.com/413037 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Don't put newlines in macros that call ERR it already adds one.  BUG=angleproject:1442  Change-Id: Ia4b4a3f9dc870a53b6c793c6bfc07b76d6b19673 Reviewed-on: https://chromium-review.googlesource.com/413038 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add enough ES 3.1 enums to support initializing the dEQP ES 3.1 tests.  BUG=angleproject:1442  Change-Id: Iece3efb272fdcbe004d4136129ba7bfe74ba5265 Reviewed-on: https://chromium-review.googlesource.com/405530 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
translator: fix a typo in comment  Change-Id: Ibfd39bc478c4e9ddf40138ccf6bd37f247f83632 Reviewed-on: https://chromium-review.googlesource.com/413036 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
"Implement" more NULL backend objects.  BUG=angleproject:1468  Change-Id: I3c42872ba13dbf346722bc34b9415a4e79c9f82c Reviewed-on: https://chromium-review.googlesource.com/413328 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Initialize the default aliased line width ranges.  BUG=angleproject:1468  Change-Id: I1908821fc560bed0cb5427a23739d11b17fea227 Reviewed-on: https://chromium-review.googlesource.com/413327 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't require npot extensions in ES3 contexts.  BUG=angleproject:1468  Change-Id: I106f765e59b18de0659c85f31ce3fbac8016de95 Reviewed-on: https://chromium-review.googlesource.com/413329 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Suppress Win/AMD/D3D11 dEQP-GLES3 failures.  BUG=angleproject:1633  Change-Id: If8273747ade1cd3530b96006f2445e1dce0ccf00 Reviewed-on: https://chromium-review.googlesource.com/413231 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix infinite recursion in macro expansion  BUG=angleproject:1600 TEST=angle_unittests  Change-Id: I72bf81ec060f36255a0f13b132a4fd69b89672ff Reviewed-on: https://chromium-review.googlesource.com/412744 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Set the right size on the uniform bindings array.  BUG=angleproject:1468  Change-Id: I3d75a03fcf624fe7f9510e76edc4a8298d8c5a72 Reviewed-on: https://chromium-review.googlesource.com/412860 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add support for CHROMIUM_copy_texture with D3D9.  BUG=angleproject:1356  Change-Id: If63779e39609083deb6bb72dc8c29eaaa90c698c Reviewed-on: https://chromium-review.googlesource.com/339813 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add basic initialization code for ContextNULL so it can run some tests.  BUG=angleproject:1468  Change-Id: I8dfc9a3c71e5638de22bc9d9a5dadfb495ef23a7 Reviewed-on: https://chromium-review.googlesource.com/388846 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
BlitGL: add a ScopedGLState to separate our state from the app's  BUG=angleproject:1356  Change-Id: I19ec4efa37d142ac7370815b078f4ba79caa0bea Reviewed-on: https://chromium-review.googlesource.com/412451 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
"Implement" FramebufferNULL::getImplementationColorRead*  BUG=angleproject:1468  Change-Id: I2727602e66a4f4f2ca166948eebd9c975e315fe7 Reviewed-on: https://chromium-review.googlesource.com/412861 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
translator: remove code related to for-loop unrolling  For loop unrolling is not used and causes the translator fuzzer to find a hang when unrolling tons of nested loops (duh). Also remove MMap.h which was unused.  This is essentially a revert of https://codereview.appspot.com/4331048  BUG=chromium:665255  Change-Id: Id6940f7e306d4ed53bc992f751e9ffe733190f17 Reviewed-on: https://chromium-review.googlesource.com/412023 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
"Implement" TransformFeedbackNULL.  BUG=angleproject:1468  Change-Id: I1452b7d0f98d2e936ad16350a7ef5b01c45e76e9 Reviewed-on: https://chromium-review.googlesource.com/412862 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Allow the null backend to be used by dEQP.  BUG=angleproject:1468  Change-Id: Ife6f0001b9a6ae06c98385df47fc3887036f3a36 Reviewed-on: https://chromium-review.googlesource.com/412863 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Framebuffer: Fix getDepthStencilAttachment check.  The check should be using the newer operator== to check if attachments are the same - the id() method will hit an UNREACHABLE if it's called on a Surface attachment.  I noticed this when using this method in the Vulkan RenderPass implementation.  BUG=angleproject:1583  Change-Id: I387b35805893d04003b22a1c7c9c12fc41c726ce Reviewed-on: https://chromium-review.googlesource.com/412801 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use ShaderVars instead of ShaderLang in headers.  We only need the typed variable information in our header files. The entry point and other enum info can be encapsulated better in the cpp files that call through to the translator. The only tricky one is the compile options which we return from our implementation - put the typedef for these in the ShaderVars header to fix this.  This should partially work around the problem of shaderlang for Vulkan and ANGLE's translator (also ShaderLang) using some identifiers with the same names.  BUG=angleproject:1576  Change-Id: I43c530486498c210796b9e197a6780bf2f7b3afb Reviewed-on: https://chromium-review.googlesource.com/412423 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix GLSL float parsing corner cases  This fixes parsing floats that are out-of-range and floats that have more digits than the standard library float parsing functions can handle. In these cases we now fall back to a custom implementation of float parsing. The custom parsing path can correctly process floats with up to hundreds of millions of digits in their mantissa part.  Rounding behavior of the custom float parser may not be entirely consistent with the standard parser but the error should be at most a few ULP. This can be considered acceptable since floating point operations are not expected to be exact in GLSL in general. Settling for lower accuracy also enables the parser to run in constant memory instead of having to store all the significant digits of the decimal mantissa being parsed.  BUG=angleproject:1613 TEST=angle_unittests  Change-Id: I04a5d9ae5aaca48ef14b79cca5b997078614eb1c Reviewed-on: https://chromium-review.googlesource.com/412082 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
TextureGL: track the currently applied state.  Use it to implement lazy state setting methods for texture filters and swizzle that will be used in subsequent workarounds.  BUG=angleproject:1356  Change-Id: Ia58267c4f125262cf57fbd98438a6d8eb8a04b33 Reviewed-on: https://chromium-review.googlesource.com/412404 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Remove invariant qualifier for ESSL 3.0 on AMD driver  AMD driver in Linux requires invariant qualifier to match between shaders even for GLSL >= 4.2. This conflicts with ESSL 3.0 which disallows invariant qualifier in fragment shader. Remove invariant qualifier in vertex shader to workaround AMD driver bug.  BUG=chromium:639760 TEST=webgl2_conformance  Change-Id: Id5adf7e7032105486df90a1f200471ea81ee5c36 Reviewed-on: https://chromium-review.googlesource.com/411917 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix missing file license in HLSLCompiler.h.  BUG=angleproject:1576  Change-Id: I9fdd7a27944880383df53aa8468884ea2e99e670 Reviewed-on: https://chromium-review.googlesource.com/412422 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Program: Small cleanup to linkAttributes.  The comment here was incorrect and the signature passed some redundant arguments.  Noticed this when I was looking at the code for Vulkan/glslang.  BUG=angleproject:1576  Change-Id: Ie9e7eb7cbe4b65503901b2550e95cd818b7c28c0 Reviewed-on: https://chromium-review.googlesource.com/412324 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix up perf test runner script.  The missing check was a bit buggy and the paths were not updated to the new 'gyp' folder instead of 'build'.  BUG=angleproject:1569  Change-Id: I10408252851e90b79e306c8aea175ebe6a931b61 Reviewed-on: https://chromium-review.googlesource.com/412320 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
BlitGL: handle copyTexImage3D for the luma workaround  BUG=angleproject:1492  Change-Id: Ica9a7c72f0e463850dd93f4a15d9b572fb10a1f6 Reviewed-on: https://chromium-review.googlesource.com/412054 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Buffer11: Intel workaround for constant buffers.  This workaround avoids using inter-buffer copies involving constant buffers. Instead of copying from a staging storage to a constant buffer (or vice-versa) the Buffer memory managment will keep the system memory storage around permanently. This uses a bit more memory but should fix all the problematic cases where we have the canonical version of the buffer data inside GPU memory.  BUG=chromium:593024  Change-Id: I2ce0cfd22784aa43e819ce2df2d0da540d0a0cfe Reviewed-on: https://chromium-review.googlesource.com/412140 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Buffer11: Slight cleanup in copyFromStorage.  We can call setData internally to re-use the same code.  BUG=chromium:593024  Change-Id: I9f53bef1e86a11fc23799123937c354bf45de014 Reviewed-on: https://chromium-review.googlesource.com/411919 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Buffer11: Refactor constant buffer range getter.  This getter will now return the offset to bind along with the ID3D11Buffer pointer. This encapsulates the logic of the emulation so that we only actually check the capabilities of the driver in a single place. This solves the issue of needing to edit the code in multiple places when trying to force the caps for debugging and also encapsulates the offset calculation in the Buffer11 class.  BUG=chromium:593024  Change-Id: Idb09d560868ae12b98bcaf4ea031c4e0b6c82b4a Reviewed-on: https://chromium-review.googlesource.com/411918 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use 'gyp' dir in update_canary_angle.py.  The old 'build' dir was copying stale DLLs.  BUG=angleproject:1569  Change-Id: Ib11fb9f1e1e480fe32af3f291357e0fb92429318 Reviewed-on: https://chromium-review.googlesource.com/411389 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Clamp "count" in glUniform* before passing to the backend  The OpenGL spec allows "count" to overflow safely implemented but some drivers like the Intel Windows OpenGL driver don't handle this correctly and crash on overflow tests.  BUG=661413  Change-Id: I10de9292c75daa375f002850900bb5e1cbfce3b6 Reviewed-on: https://chromium-review.googlesource.com/411387 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Program: clamp the number of uniforms to be copied  Reland with a temporary test suppression.  BUG=661413  Change-Id: I552b64de754b326dcd499b84d9f337b9d015dc8e Reviewed-on: https://chromium-review.googlesource.com/411473 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add the ANGLEPlatform entry points to eglGetProcAddress  Reland with a Windows build fix.  We want to move the Chromium initialization of the ANGLE platform from being Windows-specific to being EGL-specific. Because the mechanisms by which the ANGLE library is loaded are OS-specific it is inconvenient to use dlsym and friends to get the ANGLEPlatform entry points. Instead we expose the through eglGetProcAddress which is readily available in the EGL-specific part of Chromium.  BUG=angleproject:1621  Change-Id: I022a39493756a3b5d1ed626fd05e74af3f043211 Reviewed-on: https://chromium-review.googlesource.com/410066 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Validate level exists for TexSubImage calls.  Before validating the texture format verify that the texture level already exists in glTexSubImage calls.  BUG=602737  Change-Id: I0d83c7d43c7b358abdb59583dc83265df70c13b5 Reviewed-on: https://chromium-review.googlesource.com/411361 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Program: clamp the number of uniforms to be copied"  This reverts commit 9863a3ef180edb17307665e0cc65a16603222103.  Change-Id: I840a735b49bc4f2319c8af5f620d7f52bb7eecf1 Reviewed-on: https://chromium-review.googlesource.com/411470 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Length returned from glGetUniform*RobustANGLE should be in values not bytes.  BUG=angleproject:1354  Change-Id: I805499c3514a8b323e9864b7cf9100814f3d5cc5 Reviewed-on: https://chromium-review.googlesource.com/411420 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Program: Make LinkResult use gl::ErrorOrResult.  This simplifies the error handling code and allows the use of the ANGLE_TRY macro (and friends).  BUG=angleproject:1576  Change-Id: I3142388b10d0dd67a7f49a5c8c3d11102996be93 Reviewed-on: https://chromium-review.googlesource.com/411201 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Program: clamp the number of uniforms to be copied  BUG=661413  Change-Id: I1a146dae0d01edeb272a58610355261b0e23dec1 Reviewed-on: https://chromium-review.googlesource.com/406745 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Refactor GLES2 Blend entry points.  BUG=angleproject:747  Change-Id: I775265a7494aedd19ca4f18019e3b3181bfb12e9 Reviewed-on: https://chromium-review.googlesource.com/410135 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Cleanup after merging translator_lib into translator  Rename a few references to translator_lib  BUG=angleproject:1596  Change-Id: Ib715fdd8a949dc46a5ef628ea2d7f71b1b771845 Reviewed-on: https://chromium-review.googlesource.com/410287 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
FramebufferGL: Fix blit workaround corner case  The SRGB blit workaround had to wrong assumptions:  - SRGB blits can have a multisample source.  - The woarkound is needed even when the filter is GL_LINEAR in the    case where we are doing a RGB -> SRGB or RGB -> SRGB blit.  BUG=angleproject:1492 BUG=chromium:658898  Change-Id: I1d89572565a4e23c1c97bdf985bb21a445e898b7 Reviewed-on: https://chromium-review.googlesource.com/409540 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Add the ANGLEPlatform entry points to eglGetProcAddress"  Produces a build warning in standalone might require build file updates:  > locally defined symbol ANGLEPlatformInitialize imported in function <snip>  At least in GYP libEGL does not have LIBANGLE_IMPLEMENTATION defined so it defines this API with __declspec(dllimport) which is incorrect since the function is local to the module. We should fix the layering and/or export defs.  BUG=angleproject:1621  This reverts commit 0504fcc17a173b1c1a3305931c159f519bbff97b.  Change-Id: Ida67db69eb64e4a8f2c13dcf129d40b332f2da9d Reviewed-on: https://chromium-review.googlesource.com/410065 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add the ANGLEPlatform entry points to eglGetProcAddress  We want to move the Chromium initialization of the ANGLE platform from being Windows-specific to being EGL-specific. Because the mechanisms by which the ANGLE library is loaded are OS-specific it is inconvenient to use dlsym and friends to get the ANGLEPlatform entry points. Instead we expose the through eglGetProcAddress which is readily available in the EGL-specific part of Chromium.  BUG=angleproject:1621  Change-Id: I7adbea003103d0331ec9eece7b881e27bd6b1a5d Reviewed-on: https://chromium-review.googlesource.com/410063 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Cleanup after translator component removal  - Unite translator with translator_lib - Remove flags and defines for shared library exports  BUG=angleproject:1596  Change-Id: Icd145a4b79e2472766a2b56017bb0f36f244482e Reviewed-on: https://chromium-review.googlesource.com/410261 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Add default compiler options to WebGL shaders.  Enforces default compiler options when compiling WebGL compatible shaders.  BUG=angleproject:1616  Change-Id: I18490db68b29981fab4817bdd61727752cf50997 Reviewed-on: https://chromium-review.googlesource.com/409016 Commit-Queue: Bryan Bernhart <bryan.bernhart@intel.com> Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Return a lift of a angle_end2end_tests on AMD.  BUG=angleproject:1622 TEST=angle_end2end_tests TBR=jmadill@chromium.org  Change-Id: Icd1f5fecc36621d70822c738da39d39d3bdb3ff6 Reviewed-on: https://chromium-review.googlesource.com/410037 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Add volatile coherent and restrict memory qualifiers  The patch adds support for the three remaining memory qualifiers: volatile coherent and restrict.  BUG=angleproject:1442  TEST=angle_unittests TEST=angle_end2end_tests  Change-Id: Ie662d304af2399468df1d976e04c38dada1e2cec Reviewed-on: https://chromium-review.googlesource.com/385876 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Encapsulate the thread local storage into an egl::Thread class.  Instead of having separate GetGlobal* functions interact with the global objects through a single Thread object.  This reduces the number of TLS lookups in many EGL functions and allows the Thread object to be passed down to other objects if needed.  BUG=angleproject:1618  Change-Id: I1f9a89e8899d637633f4e91fda0e38ac308dd020 Reviewed-on: https://chromium-review.googlesource.com/409637 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix linkage.html failures on Mac.  The failure is due to when we initialize variables to 0 we re-create the struct TType and it contains a different unique id from the original struct TType thus leading to a different hashed name.  BUG=chromium:641129 TEST=webgl_conformancewebgl2_conformance  Change-Id: I267b97fa496f55ea59dacee93af8f6a90f3e66cb Reviewed-on: https://chromium-review.googlesource.com/409602 Commit-Queue: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fixed incorrect multisample rendering when enable SAMPLE_COVERAGE on Win  In RendererD3D::createRenderTarget we use getNearestSamples(samples)'s result to assign D3D11_TEXTURE2D_DESC.SampleDesc.Count. However in renderer11::updateState we used the original samples to calculate mask by GetBlendSampleMask not the supported nearest samples. It would result that multisample rendering result was incorrect when enable AMPLE_COVERAGE and the samples is not in the suported list but less than max samples. At least on Intel Win platform we can reproduce it. The fixing is to use same samples in these two places.  BUG=angleproject:1610 TEST=MultisampleCompatibilityTest.DrawCoverageAndResolve  Change-Id: I255b12d1032317145adfcee94e65e88ae5307113 Reviewed-on: https://chromium-review.googlesource.com/408516 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove invariant declaration in vertex shader for translation from ESSL 3.00 to GLSL <= 4.1  This is a follow-up patch of https://chromium-review.googlesource.com/408569. This CL removes invariant declaration in ESSL 3.00 vertex shader such like: " out vec4 foo; invariant foo; "  This CL also adds the workarounds in libANGLE.  BUG=chromium:639760 TEST=webgl2_conformance  Change-Id: I568ab51a9a2f5da10d1aff0b63aae8805097e081 Reviewed-on: https://chromium-review.googlesource.com/409157 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Docs: fix reference to ANGLE.sln  BUG=angleproject:1569  Change-Id: I6eb8f5f93da1879038516b14f608ff4eb4fb658b Reviewed-on: https://chromium-review.googlesource.com/409177 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Don't ouput "invarant" and "centroid" in GLSL 4.1 or older.  BUG=chromium:639760chromium:641129 TEST=webgl2_conformance  Change-Id: I5fe87246eaea78888529d7b45b79399e6065daa9 Reviewed-on: https://chromium-review.googlesource.com/408569 Reviewed-by: Kenneth Russell <kbr@chromium.org> Commit-Queue: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Ozone: Only set angle_enable_gl=1 for the DRM/GBM platform.  Currently the load of DRM dependencies and definition of ANGLE_USE_OZONE are conditioned by ozone_platform_gbm in the GN build files. However angle_enable_gl is always turned on for use_ozone=1. As a consequence use_ozone=1 and ozone_platform_gbm=0 (default on Linux Desktop) produces the following error:      ../../third_party/angle/src/libANGLE/Display.cpp:52:9: error: Unsupported OpenGL platform.     #error Unsupported OpenGL platform.      ../../third_party/angle/src/libANGLE/Display.cpp:192:2: error: Unsupported OpenGL platform.     #error Unsupported OpenGL platform.  This CL turns off angle_enable_gl in that case to fix that build error.  Change-Id: I42578f30f3353c083f52d4bd345dbe33f3f5e12e Reviewed-on: https://chromium-review.googlesource.com/408100 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Frank Henigman <fjhenigman@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Fix constant folding right shift corner cases  Right-shifting the minimum signed integer needs to be handled as a special case since it can't go through the usual path that clears the sign bit.  Code for right-shifting by zero also had a typo that resulted in setting the wrong value to the result.  BUG=chromium:662706 TEST=angle_unittests  Change-Id: Ief24d738064906a72212242e0917ce30e45d6b25 Reviewed-on: https://chromium-review.googlesource.com/408158 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
dEQP: Add command-line parsing of back-end.  Also use the requested renderer to initialize expectations.  BUG=angleproject:1442  Change-Id: Idf54072dac5f7ad9deea70e97d65e36a6e883b1c Reviewed-on: https://chromium-review.googlesource.com/407802 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
SimplifyLoopConditions: handle empty for expressions  BUG=661558  Change-Id: I7a4af71fafacc31aeae0c52d79641ea5e61d6b24 Reviewed-on: https://chromium-review.googlesource.com/406545 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix EGL_D3D_TEXTURE_SUBRESOURCE_ID_ANGLE enum typo in extension spec.  BUG=angleproject:1332  Change-Id: I2c5aa9e155f175fea51af05fed40a55569e6745a Reviewed-on: https://chromium-review.googlesource.com/408813 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Rename the build/ directory.  GYP related files went in gypfiles/ and the gni went in gni/ this changes frees up the build/ directory name for Chromium's build/ directory.  BUG=angleproject:1569  Change-Id: I76fe343d569239c2732ba87986fcf7debc21d417 Reviewed-on: https://chromium-review.googlesource.com/403029 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make the gmock and gtest dirs match Chromium's  Making the dependencies' directories match Chromium's is needed if we want to use the same GN file for Chromium builds and standalone builds.  This also rolls the gtest and gmock dependencies to match Chromium.  BUG=angleproject:1569  Change-Id: I54ce9c9a29964abfddbea64a0f4466f2c9d48a33 Reviewed-on: https://chromium-review.googlesource.com/403028 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
translator: Fix style in CodeGen.cpp.  BUG=None  Change-Id: I321ec7af6779c6524b83959da21520a4fb09d8e2 Reviewed-on: https://chromium-review.googlesource.com/408317 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
translator: Scope all classes with "sh".  I was seeing an odd problem with our PoolAlloc conflicting with the glslang/Vulkan TIntermNode so the fix was to move everything to a separate namespace.  The bison grammars are also regenerated. No functional changes.  BUG=angleproject:1576  Change-Id: I959c7afe4c092f0d458432c07b4dcee4d39513f3 Reviewed-on: https://chromium-review.googlesource.com/408267 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Squashed commit of the following:  commit 0146dfeefa47b520e71f0e74230abd7dac163a79 Author: Stanislav Chiknavaryan <stanisc@chromium.org> Date:   Fri Nov 4 17:43:03 2016 -0700      Revert "Implementation of eglGetSyncValuesCHROMIUM extension."      This reverts commit 5d9f5df01ac5a384d9b7cbb49d9f98a76b62c7ad.  commit 0d920fe27bd8e73d831a9002548bde00fea78709 Author: Stanislav Chiknavaryan <stanisc@chromium.org> Date:   Fri Nov 4 17:23:11 2016 -0700      Revert "Fix EGLSyncControlTest.SyncValuesTest timeout on Windowse Server 2012 R2"      This reverts commit d258ca045f31eb43ec01b5501c84e9afd8e82cd6.  commit bde8defe53741855bb71fbf27bcb0a91cfafbd01 Author: Stanislav Chiknavaryan <stanisc@chromium.org> Date:   Fri Nov 4 17:22:58 2016 -0700      Revert "Disabling EGLSyncControlTest.SyncValuesTest"      This reverts commit a74183613955bd891f56f6a979a5391c16c64138.  commit f78e4b7e97b9d1259878f6902bb6ddeb0aeded87 Author: Stanislav Chiknavaryan <stanisc@chromium.org> Date:   Fri Nov 4 17:22:36 2016 -0700      Revert "Fix and re-enable EGLSyncControlTest.SyncValuesTest"      This reverts commit 138ec92f52da7c0fc8e6df08ac4e4e572bbf6b39.  commit f3933e6a04bd23473077d2fd74616023db3c9601 Author: Stanislav Chiknavaryan <stanisc@chromium.org> Date:   Fri Nov 4 17:20:26 2016 -0700      Revert "Handle nullptr mSwapChain in SwapChain11::getSyncValues"      This reverts commit af7f301f6ba9e5f31d1511142a936a9ba84169d0.  BUG=angleproject:1402  Change-Id: I99969e906e316574e9f739141de0e360d1edebd9 Reviewed-on: https://chromium-review.googlesource.com/408752 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Stanislav Chiknavaryan <stanisc@chromium.org>, 23355681, 619, 169, 619
translator: Remove deprecated HLSL output flags.  These flags were adding redundant configs to the fuzzer.  BUG=angleproject:1522  Change-Id: I49ad56f0d7aceaae326d2d4387c4c750866465f3 Reviewed-on: https://chromium-review.googlesource.com/408338 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
translator: Put ShaderLang APIs in "sh" namespace.  Working with glslang in Vulkan means we are static linking libANGLE with functions that have the same name as our translator APIs. We can fix this by scoping our APIs. We don't need to scope the types of the file since they don't conflict.  This will require a follow-up patch to remove the unscoped APIs once we switch over Chromium.  We also scope TCompiler and some related classes to avoid multiply defined link errors with glslang.  BUG=angleproject:1576  Change-Id: I729b19467d2ff7d374a82044b16dbebdf2dc8f16 Reviewed-on: https://chromium-review.googlesource.com/408337 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor all the Bind* GLES 2.0 entry points.  This requires storing a reference the the Context's Framebuffer map in the ValidationContext. Likely we'll need to do this as well for the other non-shared object types.  BUG=angleproject:747  Change-Id: I73ee8b0be3c3b9e54b7e48e49d6f738cf1d926dd Reviewed-on: https://chromium-review.googlesource.com/407843 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't use the bind SRV flag for MS textures in D3D11 FL 10.0.  With the latest Windows SDKs it is an error to create a multisampled texture with both bind SRV and DSV flags in feature level 10.0.  The error:  D3D11 ERROR: ID3D11Device::CreateTexture2D: If the feature level is less than D3D_FEATURE_LEVEL_10_1 a Texture2D with sample count > 1 cannot have both D3D11_BIND_DEPTH_STENCIL and D3D11_BIND_SHADER_RESOURCE. This call may appear to incorrectly return success on older/current D3D runtimes due to missing validation despite this debug layer message. [STATE_CREATION ERROR #99: CREATETEXTURE2D_INVALIDBINDFLAGS]  BUG=656989  Change-Id: Iedce65f6c877786e28b96c159abd7a5b2a32cfd5 Reviewed-on: https://chromium-review.googlesource.com/408339 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix 3D texture redefinition bug.  We would incorrectly check the storage type after we had redefined it. Thus we would allow old storages to persist for some cases of 3D texture. This bug did not affect 2D textures.  See WebGL 2 test: conformance2/misc/views-with-offsets.html  BUG=angleproject:1609  Change-Id: I7a04ff498740bb5d7daf2cee174c336f97a44c01 Reviewed-on: https://chromium-review.googlesource.com/408417 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fixed the bug using uniform block array  At the beginning of Program::defineUniformBlock getUniformBlockSize will call getUniformBlockIndex on MacOS to check if the block is an active block with giving blockName. However it didn't distinguish array and non-array situations and unified to use interfaceBlock.name as the blockName to call getUniformBlockIndex. It would result that INVALID_INDEX was returned when it's a block array. For example using 'blockName' not 'blockName[0]'.  In OpenGL 4.3 spec section 7.3.1 there are following descriptions: If name exactly matches the name string of one of the active resources for programInterface the index of the matched resource is returned. Additionally if name would exactly match the name string of an active resource if "[0]" were appended to name the index of the matched resource is returned. Otherwise name is considered not to be the name of an active resource and INVALID_INDEX is returned.  So for array block case we use blockName appending [0] to check the activity.  BUG=angleproject:1543  Change-Id: I8189b62066b779f7d392a7dba1cf5cb02a31936d Reviewed-on: https://chromium-review.googlesource.com/405830 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Introduce a gl::BufferState class.  This state can share vital pieces of information with the impl. The most elementary state is the buffer size which then the impl doesn't need to replicate.  BUG=angleproject:1579  Change-Id: I341393c64a6e49de65c1d53b1bad2fa143209862 Reviewed-on: https://chromium-review.googlesource.com/406644 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Check that implicitly sized array constructors have arguments  Array size must be greater than zero according to the ESSL 3.00.6 spec.  BUG=angleproject:1602 TEST=angle_unittests  Change-Id: I1fa54b143bc821583822cbc5139464cdd058b6c1 Reviewed-on: https://chromium-review.googlesource.com/407257 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Ignore .TMP files.  This seem to be everywhere on Windows.  BUG=None  Change-Id: I16b208edb88d57d4bea3ce6dcf22f6ae9ac9cb58 Reviewed-on: https://chromium-review.googlesource.com/406643 Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix undefined modulus in ExpressionParser  In constant folding of integer expressions this case is already being handled.  BUG=angleproject:1599  Change-Id: Ifb3ea0279467f216e1c93909647b79fca24fcaf2 Reviewed-on: https://chromium-review.googlesource.com/406868 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix handling bvec on the right hand side of a logical op  The vector/matrix size matching is not done for logical ops similarly to other binary ops. For that reason both left and right hand side need to be checked for being scalar.  BUG=angleproject:1601 TEST=angle_unittests  Change-Id: Ie87da68d6cb0d439f0e6273d374fc7d836c82309 Reviewed-on: https://chromium-review.googlesource.com/406988 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
D3D11: Enable previously crashing trig dEQP tests.  The newer Win SDK version seems to fix the crash.  BUG=angleproject:1252 BUG=chromium:568170  Change-Id: I9bac4a9978774ac0f8951a95ce920e8e5d6caed8 Reviewed-on: https://chromium-review.googlesource.com/358811 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove component translator target and keep static_library.  Rename translator_static to translator and use it everywhere.  BUG=angleproject:1596  Change-Id: I36c990d54979d2460b1513a65cca0b82f8d65c80 Reviewed-on: https://chromium-review.googlesource.com/406668 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Enable shader validation with WebGL compatibility extension.  The change configures shaders to be of a compatible spec upon creation.  BUG=angleproject:1523  Change-Id: Id345d0b8f0abad8ed3c4fb3117d0fdfeab9fea53 Reviewed-on: https://chromium-review.googlesource.com/405778 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix handling unsized arrays with incorrect initializer  In case the initializer of an unsized array is not an array the array size still needs to be set to some value > 0 in order to not hit asserts in the code that parses accessing the array. An error was already being generated in the case an unsized array has a non-array initializer but the variable will still have an array type in the symbol table.  BUG=chromium:661592 TEST=angle_unittests  Change-Id: I4a11527eab0404ba9e59ebb7227faef13dbea62c Reviewed-on: https://chromium-review.googlesource.com/407256 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
OSXWindow: ignore deprecated warnings  We can't fix them yet because our continuous testing doesn't compile with the updated definitions yet.  BUG=angleproject:1598  Change-Id: I40bdeaa6bafbd03b5e3e6c16ac8485e3f488fe59 Reviewed-on: https://chromium-review.googlesource.com/406452 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix EGL_D3D_TEXTURE_SUBRESOURCE_ID_ANGLE enum typo.  BUG=angleproject:1332  Change-Id: I69a5780521a4810ae93567fbe875a8c5e361850e Reviewed-on: https://chromium-review.googlesource.com/406632 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Properly check for debug and robust access context creation flags.  These flags can come from both attributes and bitfield flags.  Also move the robust access check to an UNIMPLEMENTED in Context dEQP ES 3.1 tests attempt to use this flag and it's convenient to be able test by disabling UNIMPLEMENTED assertions.  BUG=angleproject:1442  Change-Id: I1641fdb3afee308235351ebd60be680765b16b3b Reviewed-on: https://chromium-review.googlesource.com/405774 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Change UNIMPLEMENTED to not assert by default.  It is not feasible to run dEQP against ES 3.1 on the bots without removing this assertion.  Messages will still be logged and UNREACHABLE will still generate assertion failures when the behaviour is needed.  This matches the behaviour of Chromium's NOTIMPLEMENTED macro.  Remove the ANGLE_TEST_CONFIG macro it was not doing anything useful anymore.  BUG=angleproject:1442  Change-Id: I76376817a87e1a75ad1a938e1db1d7763e094372 Reviewed-on: https://chromium-review.googlesource.com/406928 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use safe math in ValidateCopyBufferSubData.  This should fix any potential out of bounds reads/writes.  BUG=chromium:660854  Change-Id: Iffa00e4551d7362115cbf023a09b1d0e15f724c8 Reviewed-on: https://chromium-review.googlesource.com/405816 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Clean up temporary variable usage in ScalarizeVecAndMatConstructorArgs  Use common helper functions instead of manually creating temporary variable nodes. Also clean up the interface provided by the traverser.  BUG=angleproject:1597 Test=WebGL conformance tests  Change-Id: Ifd8d3815ff9e75e1a2040d65db9d4b3d6a9a9273 Reviewed-on: https://chromium-review.googlesource.com/403950 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Prefix internal names in GLSL output  Prefixing internal names will avoid clashes with user-defined names. We use prefix webgl_angle_ so that the internal names are both reserved in WebGL on one hand and clearly separated from hashed names starting with just webgl_ on the other hand.  BUG=angleproject:1597 TEST=WebGL conformance tests  Change-Id: I7deef9c1a38105c8b57eda13c84eec13e515a91a Reviewed-on: https://chromium-review.googlesource.com/406247 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
ES3: Make copy conversion set a static switch.  This removes the global std::set initialization.  BUG=angleproject:1389 BUG=angleproject:1459  Change-Id: I6a7f4211905ea4a83e0e2337977e2f6fb375a7dd Reviewed-on: https://chromium-review.googlesource.com/405368 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor CopyBufferSubData entry point.  This brings it in line with the new style.  BUG=angleproject:747  Change-Id: Ie4b223d018999be18c3b19fae9cc825a78de09a9 Reviewed-on: https://chromium-review.googlesource.com/405815 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Replace the GLVersion class with gl::Version.  Update code to use gl::Version in as many places as possible to ease ES 3.1 support.  BUG=angleproject:1588  Change-Id: I3490b53a81027cf849dac551a9cc66ce04506144 Reviewed-on: https://chromium-review.googlesource.com/404946 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add finite check to lexer float constants.  The fuzzer was generating cases where floating point constants would someone return as valid when they were beyond max float. I was unable to reproduce this in a standalone test but confirmed this check fixes the fuzzer error.  BUG=660702  Change-Id: I9e6b883958013638ea509e38b30e812a9e74fbc1 Reviewed-on: https://chromium-review.googlesource.com/406268 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Enumerate dEQP ES 3.1 test expectations.  BUG=angleproject:1442  Change-Id: I9005a54d30988a472a3f512f394a4a352a4732e9 Reviewed-on: https://chromium-review.googlesource.com/405297 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix incorrect assertion in SwapChain11.cpp.  BUG=angleproject:1144  Change-Id: I6186381d1aad13bbb07af47b3cf94d6ec7cbb566 Reviewed-on: https://chromium-review.googlesource.com/405693 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D9: Make GetD3DFormatInfo constexpr.  This removes another static global map initializer.  BUG=angleproject:1389 BUG=angleproject:1459  Change-Id: I302f349ea4e95d079077866a07b0d57758c40892 Reviewed-on: https://chromium-review.googlesource.com/405488 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D11: Convert the FL 9_3 vertex format table to constexpr.  This removes a static global map initialization.  BUG=angleproject:1389 BUG=angleproject:1459  Change-Id: I6eb19f6649280e72682c6806ea0bf6eb70173984 Reviewed-on: https://chromium-review.googlesource.com/405487 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make ASSERT reference the conditional expression.  This should prevent further unexpected bot breakage due to unreferenced variables in the ASSERT expression.  Also remove the no longer needed variable referencing macro.  BUG=angleproject:1586  Change-Id: I127695165bdfe39c51fe8d17e00daf6bf2fa8252 Reviewed-on: https://chromium-review.googlesource.com/404948 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Buffer11: Keep system memory storage for large UBOs.  The system memory storage is needed to back UBOs larger than the max constant buffer size in D3D11 Windows 7. Because readback from UBOs can be tricky the system memory storage keeps the canonical copy of the data in this case.  We can also extend this to add a workaround to fix the outstanding failure cases of UBOs on Intel.  BUG=chromium:660670  Change-Id: Ia3119d3064d10c4262def4c5a967972b4de2d10f Reviewed-on: https://chromium-review.googlesource.com/405367 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
TranslatorGLSL: collect variables when flattening pramga invariant all  BUG=chromium:659472  Change-Id: Icfeada9f09fff5d28eb3f4fafb2c94d57598af1f Reviewed-on: https://chromium-review.googlesource.com/403849 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update GLES2 Mac expectations  BUG=  Change-Id: I7ca6e6c0fc4b178a1df6d6acc95dde3b6ed3c479 Reviewed-on: https://chromium-review.googlesource.com/403089 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Workaround clear issue on Intel Skylake D3D driver  On some Intel D3D drivers on Skylake calling clear may take no effect. To work around this bug we call clear() twice when we attempt to do clear on these platforms.  BUG=chromium:655534  Change-Id: I3b05892e80e5797d268861e8f52e080f5175855b Reviewed-on: https://chromium-review.googlesource.com/398522 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Reland "Remove invariant qualifier for input in fragment shader"  This relands https://chromium-review.googlesource.com/#/c/400005/.  ESSL and GLSL are not consistent on invariant matching in vertex shader and fragment shader. See the following rules: ESSL 1.00 - input and output must match ESSL 3.00 - only output inputs cannot be declared as invariant.  GLSL 1.10.59 - does not exist GLSL 1.20.8  - input and output must match GLSL 1.30.10 - input and output must match GLSL 1.40.8  - input and output must match GLSL 1.50.11 - input and output must match GLSL 3.30.6  - input and output must match GLSL 4.00.9  - input and output must match GLSL 4.10.6  - input and output must match GLSL 4.20.11 - input can omit invariant GLSL 4.30.8  - input can omit invariant GLSL 4.40.9  - input can omit invariant GLSL 4.50.5  - input can omit invariant  Since GLSL 4.20 invariant qualifier description were changed to: " Only variables output from a shader (including those that are then input to a subsequent shader) can be candidates for invariance. This includes user-defined output variables and the built-in output variables. As only outputs need be declared with invariant an output from one shader stage will still match an input of a subsequent stage without the input being declared as invariant. " It's not very clear if input in fragment can be declared as invariant. Mesa driver disallows use of input declared as invariant in fragment shader while other drivers may allow it. This CL removes invariant declaration for input in fragment shader except AMD driver in Linux. AMD's driver obviously contradicts the spec by forcing invariance to match between vertex and fragment shaders.  BUG=chromium:639760 chromium:659326 TEST=conformance/glsl/misc/shaders-with-invariance.html and conformance/glsl/bugs/invariant-does-not-leak-across-shaders.html  Change-Id: I0aa9be14f0cee7a11a249c91fba27c570c52ca1b Reviewed-on: https://chromium-review.googlesource.com/404228 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Buffer11: Ensure we don't overflow on setData.  When mapping uniform buffers for very large buffers we could end up copying past buffer bounds. This would trigger crashes on some configs. We can fix this by clamping the copy size correctly.  BUG=chromium:659892  Change-Id: I9d1af984da34867692d4c7b8908c016ebec7a63b Reviewed-on: https://chromium-review.googlesource.com/404931 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Put angle::Format table in a cpp file.  The best practice is to expose a non-constexpr query function and hide the constexpr table in a cpp so it won't be included verbatim in multiple other source files.  BUG=angleproject:1389  Change-Id: Ic4e19d14c832643be1552c5a14e441826c41970f Reviewed-on: https://chromium-review.googlesource.com/404478 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add buildtools to recursedeps.  The DEPS for buildtools changed to not recurse automatically. This change mirrors the change in Chromium.  See https://chromium.googlesource.com/chromium/buildtools/+/3d2e47bf14e4e67816a53e304dea422fa18f9180%5E%21/#F0  BUG=None  Change-Id: Ib15520324ad7894d4a640a0e2013c3823849e846 Reviewed-on: https://chromium-review.googlesource.com/404969 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix a compile error in SwapChain11.cpp  In function resetOffscreenColorBuffer the local variable 'result' is never used in its scope so when attempting to build a release version of Chromium with latest ANGLE on Windows ninja will report a compile warning and stop the compilation: 'result': local variable is initialized but not referenced. The build failure starts at: https://chromium-review.googlesource.com/#/c/316804/  Change-Id: I29c05653f0d2e4f34c2e0402848f403ec2af8e5a Reviewed-on: https://chromium-review.googlesource.com/404515 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Disable D3DTextureTest on Windows Intel OpenGL  BUG=angleproject:1585  Change-Id: I550750e0e94bd15c0b076f911d05f8dd92e4a202 Reviewed-on: https://chromium-review.googlesource.com/404499 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
D3D11: Make several format tables constexpr.  This should guarantee the best memory access patterns. It introduces some indirections for some format queries but most of these should be direct array lookups or used infrequently. We can optimize this later if necessary.  BUG=angleproject:1389  Change-Id: I5e2c8c530a07798494afd3ea36b6164d7564c02c Reviewed-on: https://chromium-review.googlesource.com/403314 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Implement GL_EXT_sRGB_write_control for GL.  BUG=angleproject:1547 BUG=655247  Change-Id: I3f04ddc7032e4a47eb21ff3b8586c5b47415bb64 Reviewed-on: https://chromium-review.googlesource.com/400958 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Check precision qualification for all declarations  Precision qualification is now checked properly also for declarations that don't have qualifiers.  BUG=angleproject:1574 TEST=angle_unittests  Change-Id: I3d186df0763e071614c1da9a355a6f6fefdc8091 Reviewed-on: https://chromium-review.googlesource.com/403949 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a EGL_ANGLE_d3d_texture_client_buffer extension.  Allows creation of pbuffers from D3D texture objects.  BUG=540829 BUG=angleproject:1144  Change-Id: If8ea717ef011608cd01357c217837133d726d3ea Reviewed-on: https://chromium-review.googlesource.com/316804 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add Platform Detection and Tighten the workarounds on Intel GPU  This patch intends to add platform detection to ANGLE and tighten the driver bug workarounds on Intel GPU.  BUG=angleproject:1548  Change-Id: I1ea57e174f688a175da8b658de4337295037fcab Reviewed-on: https://chromium-review.googlesource.com/399914 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Split TIntermDeclaration from TIntermAggregate  The new class TIntermDeclaration is now used for struct interface block and variable declarations. TIntermDeclaration nodes do not have a type - rather the type is stored in each child node. The types may differ in case the declaration is a series of array declarators with mismatching sizes.  TIntermAggregate is still used for function calls function prototypes function parameter lists and invariant declarations.  BUG=angleproject:1490 TEST=angle_unittests  Change-Id: I0457188f354481470855f61ac1c878fc2579b1d1 Reviewed-on: https://chromium-review.googlesource.com/400023 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix handling of null data pointers for robust tex image calls.  BUG=angleproject:1354  Change-Id: I596ebd6d8d4d500942eeb31629113b0686933531 Reviewed-on: https://chromium-review.googlesource.com/403537 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
MacroExpander: bump expansionCount before peeking for "("  BUG=658555  Change-Id: I578b8aff37a116fd7b2b387388311a27bb8a2809 Reviewed-on: https://chromium-review.googlesource.com/403848 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Disable the emulateTinyStencilTextures workaround in FL 10.0.  UpdateSubresource and CopySubresource cannot copy to depth stencil textures in feature level 10.0.  BUG=angleproject:1572  Change-Id: Ic9f8cbfb2c69de8502da7df34f1c5935144a9387 Reviewed-on: https://chromium-review.googlesource.com/402554 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix warnings in TransformFeedbackTest.  Introduced in cd2ed608719fbf.  BUG=angleproject:1570  Change-Id: I71ef8a06e379eca853e7729863976e868066df95 Reviewed-on: https://chromium-review.googlesource.com/403313 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix a couple global variable warnings.  The DynamicHLSL code was using global strings to find stubs. The math code was also using pow in a global which can be replaced with a simple bit shift.  BUG=angleproject:1459  Change-Id: Idb0602ab7640c221843385b0a0a4cfecd5fd3a26 Reviewed-on: https://chromium-review.googlesource.com/403289 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Remove invariant qualifier for input in fragment shader"  This reverts commit d842a6b2014447db0676c8a3f5a5e9ae4ce67d9a.  Because of WebglConformance_conformance_glsl_bugs_invariant_does_not_leak_across_shaders failure  BUG=chromium:659326  Change-Id: I0602e24f3d34ccf852cda865f673c5c7634f82a6 Reviewed-on: https://chromium-review.googlesource.com/403230 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Handle nullptr mSwapChain in SwapChain11::getSyncValues  There are 6 crashes in SwapChain11::getSyncValues on crash server. I looked at one of them and it is due to a nullptr mSwapChain which appears to be a valid state that is handled in other SwapChain11 methods.  This change adds a similar check / returning an error to SwapChain11::getSyncValues.  BUG=angleproject:1402  Change-Id: I9c17b884704b8aaaddf2d802911cd0ca961ae0b4 Reviewed-on: https://chromium-review.googlesource.com/402613 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Stanislav Chiknavaryan <stanisc@chromium.org>, 23355681, 619, 169, 619
Implement GL_EXT_texture_sRGB_decode for GL.  BUG=angleproject:1383 BUG=655247  Change-Id: I409b12e1ae418530576de5ec9ce26b7be5d91650 Reviewed-on: https://chromium-review.googlesource.com/400807 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Disallow samplers as ternary operands  Quoting the ESSL 1.00 spec section 4.1.7: "Except for parameters to texture lookup functions array indexing structure field selection and parentheses samplers are not allowed to be operands in expressions."  ESSL 3.00 has a similar passage related to opaque types.  Validate this correctly. Compatibility risk should be low since attempting to use samplers in ternary operators was already failing before this in most cases.  BUG=angleproject:1551 TEST=angle_unittests  Change-Id: I6cbb536f473ba9674d558b14a458f3799f9c7c9c Reviewed-on: https://chromium-review.googlesource.com/402694 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Remove invariant qualifier for input in fragment shader  ESSL and GLSL are not consistent on invariant matching in vertex shader and fragment shader. See the following rules: ESSL 1.00 - input and output must match ESSL 3.00 - only output inputs cannot be declared as invariant.  GLSL 1.10.59 - does not exist GLSL 1.20.8  - input and output must match GLSL 1.30.10 - input and output must match GLSL 1.40.8  - input and output must match GLSL 1.50.11 - input and output must match GLSL 3.30.6  - input and output must match GLSL 4.00.9  - input and output must match GLSL 4.10.6  - input and output must match GLSL 4.20.11 - input can omit invariant GLSL 4.30.8  - input can omit invariant GLSL 4.40.9  - input can omit invariant GLSL 4.50.5  - input can omit invariant  Since GLSL 4.20 invariant qualifier description were changed to: " Only variables output from a shader (including those that are then input to a subsequent shader) can be candidates for invariance. This includes user-defined output variables and the built-in output variables. As only outputs need be declared with invariant an output from one shader stage will still match an input of a subsequent stage without the input being declared as invariant. " It's not very clear if input in fragment can be declared as invariant. Mesa driver disallows use of input declared as invariant in fragment shader while other drivers may allow it.  In ESSL 3.00 inputs cannot be declared as invariant. ANGLE should follow this rule for GLSL >= 4.20.  BUG=chromium:639760  Change-Id: I7f7a07401381ac970488b69752f6d50d4f19d31f Reviewed-on: https://chromium-review.googlesource.com/400005 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
ProgramGL: correctly copy sampler uniforms  BUG=angleproject:1570  Change-Id: Ic39f5f1ff8f565b2876fdfc8d738a50f24b911b6 Reviewed-on: https://chromium-review.googlesource.com/402930 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
TransformFeedbackTest: Give enough vertex attributes  BUG=angleproject:1570  Change-Id: I6d148c6ce22f3b8266257b25c7f5b676a13c5c92 Reviewed-on: https://chromium-review.googlesource.com/402931 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
OSXWindow: Suppress a flaky crash when running end2end tests  For some reason while running the end2end tests when the application gets an NSAppKitDefinedEventType with subtype NSApplicationActivateEventType (and of course window = 0) a null dereference happens. The crash seems timing dependent since the root cause was not found and this is test code add an ugly suppression.  BUG=angleproject:1570  Change-Id: I3af2188ddae8ca3c0a4458e15a8af01e66215e3f Reviewed-on: https://chromium-review.googlesource.com/403049 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
VertexAttributeTest: don't copy too much data in the buffer  BUG=angleproject:1570  Change-Id: I199bb88042c3926cb05e27494bb6af9b2666cd00 Reviewed-on: https://chromium-review.googlesource.com/402932 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Enable GenerateMipmapBaseLevel test on NVIDIA  The issue is no longer reproducible on newest drivers.  TEST=angle_end2end_tests  Change-Id: I18728877ed9b936ecb469c44e3dae185ab4f08d3 Reviewed-on: https://chromium-review.googlesource.com/362950 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add support for images in the compiler  The patch adds support for GLSL ES 3.1 image types.  Internal format layout qualifiers for images are added.  Support for the readonly and writeonly qualifiers are added. The other memory qualifiers are omitted as to make the patch simpler.  Tests are added which check for correct and incorrect usage of images internal format layout and memory qualifiers.  BUG=angleproject:1442  TEST=angle_unittests TEST=angle_end2end_tests  Change-Id: Ie4d3acb2a195de11b405ad54110a04c4c1de0b7e Reviewed-on: https://chromium-review.googlesource.com/378855 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Roll buildtools.  This should fix the weird gn problem with git cl format.  BUG=None  Change-Id: I35d4cf110bda302b6336ef412613a80fcde8208b Reviewed-on: https://chromium-review.googlesource.com/402253 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix ASSERT in Buffer11::PackStorage::copyFromStorage.  This ASSERT was being overly restrictive when the code would work correctly when reading from system memory storage as well as staging.  BUG=angleproject:1555  Change-Id: Ib45185d8c127a1fb2ce54db9e96fe41d68d5ff2e Reviewed-on: https://chromium-review.googlesource.com/402269 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add documentation on cherry-picking changes to release branches.  BUG=none  Change-Id: I9ac61281dbfbde6dc285bc687734f6a0fb67034b Reviewed-on: https://chromium-review.googlesource.com/402230 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix style in the entire back-end.  BUG=None  Change-Id: I32cbcd4daa1f386654ea5e8f0a25d8635b5df731 Reviewed-on: https://chromium-review.googlesource.com/402016 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add stubs for EGL_EXT_swap_buffers_with_damage.  BUG=512090  Change-Id: I9413d6f5c13b9ea59ab9c923dc6c5d157f344166 Reviewed-on: https://chromium-review.googlesource.com/291652 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Forbid shared and packed layouts in WebGL  WebGL 2.0 spec section 5.25 specifies this.  BUG=angleproject:1542 TEST=WebGL 2 conformance tests  Change-Id: Ic5758bc0e767a8e6dd032e42c0a69bcae06381c4 Reviewed-on: https://chromium-review.googlesource.com/399682 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Remove unused function getInterpolationString  BUG=  Change-Id: I4135f4ae939043efa8ccab65ef1a5eb441370828 Reviewed-on: https://chromium-review.googlesource.com/401673 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement robust the GetIntegeri_v entry point.  BUG=angleproject:1354  Change-Id: I408d0e78064aa4e493d6ca66565384ac585040e1 Reviewed-on: https://chromium-review.googlesource.com/401400 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement robust the GetBufferPointerv entry point.  BUG=angleproject:1354  Change-Id: Id7dd8438224adb1e2729bcdc18a306e5dfc83a3b Reviewed-on: https://chromium-review.googlesource.com/401399 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement robust the GetInternalFormativ entry point.  BUG=angleproject:1354  Change-Id: Ib25fe4905fdd6c532c67de1d4ca1ba37932f8e0b Reviewed-on: https://chromium-review.googlesource.com/401149 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix pruning empty declarations from loop headers  Empty declarations are possible in loop init expressions. Make PruneEmptyDeclarations take this into account.  BUG=angleproject:1550 TEST=angle_unittests  Change-Id: If407babf9b6f7a26dfcf73ff345493d3e2af3f9a Reviewed-on: https://chromium-review.googlesource.com/401147 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove break after a return in switch block  BUG=  Change-Id: I5f36d5c51aa3eb6d498ff21733e67de418c26386 Reviewed-on: https://chromium-review.googlesource.com/401164 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Prevent fallback on default branch for case EbtSamplerCubeShadow  BUG=angleproject:1549  Change-Id: I8f003257b6f39282cb52ccdbacb73860ab37c919 Reviewed-on: https://chromium-review.googlesource.com/390271 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement robust GetBufferParameter entry points.  BUG=angleproject:1354  Change-Id: I979c8768975380dba7f0b256b2729b2147ff7984 Reviewed-on: https://chromium-review.googlesource.com/399042 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement the robust GetActiveUniformBlockiv entry point.  BUG=angleproject:1354  Change-Id: I2e8051910f50dc040f6be4922142364d36788c4e Reviewed-on: https://chromium-review.googlesource.com/399041 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement remaining robust TexImage entry points.  BUG=angleproject:1354  Change-Id: Ied04fa28387f3bef9f2bead7b60878b1a353c8bd Reviewed-on: https://chromium-review.googlesource.com/399039 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement robust GetQuery entry points.  BUG=angleproject:1354  Change-Id: Ic1aaab56d2313a19fb0362f280dbfbf804fb3fcc Reviewed-on: https://chromium-review.googlesource.com/399040 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
translator: Reject invalid combination of compile flags  ADD_AND_TRUE_TO_LOOP_CONDITION breaks loop unrolling because LoopInfo expects the loop condition to have been validated to be "symbol < constant" and stayed that way.  BUG=chromium:653454 BUG=chromium:653694  Change-Id: I2057fde3a308623bd2dd7571ee878dd42b1fdac3 Reviewed-on: https://chromium-review.googlesource.com/395306 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix typo EGL_PLATFORM_ANGLE_TYPE_NULL_ANGLE vs EGL_PLATFORM_ANGLE_DEVICE_TYPE_NULL_ANGLE  Change-Id: I192c4223e3fdefb7cecf96b50bc70529519ca650 Reviewed-on: https://chromium-review.googlesource.com/399678 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement remaining robust Get entry points.  BUG=angleproject:1354  Change-Id: I204962a7178d47a43034d0213c81b82d8f6a25be Reviewed-on: https://chromium-review.googlesource.com/399043 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
HandleAllocator: make HandleRange inclusive.  Previously part of the code saw it as [begin end) while others saw it as [begin end].  BUG=angleproject:1052 BUG=chromium:656485  Change-Id: Id8e9e26b167e02a07dfc5341569df53a14d0623d Reviewed-on: https://chromium-review.googlesource.com/399565 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Change comma nodes to TIntermBinary  Comma nodes always have just two parameters. If there's an expression with several commas in the middle it's parsed as a tree of comma operations. It makes more sense to represent it as a binary node rather than an aggregate node.  After this patch TIntermAggregate is still used for function prototypes function parameter lists function calls and variable and invariant declarations.  BUG=angleproject:1490 TEST=angle_unittests angle_end2end_tests  Change-Id: I66be10624bf27bcf25987b4d93958d4a07600771 Reviewed-on: https://chromium-review.googlesource.com/397320 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add switch and case node support to intermediate output  After this all node types are printed correctly in intermediate output.  BUG=angleproject:1544 TEST=shader_translator -i  Change-Id: I5c120b0ff69f66b00db88e8423a1c698d339af22 Reviewed-on: https://chromium-review.googlesource.com/397319 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Implement robust GetVertexAttrib entry points.  BUG=angleproject:1354  Change-Id: Ic71392555ae4212c4144bc67d7c5e53874af4d53 Reviewed-on: https://chromium-review.googlesource.com/398198 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Split TIntermFunctionDefinition from TIntermAggregate  This makes the code easier to understand. Function definition nodes always have just two children the parameters node and the function body node so there was no proper reason why they should be aggregate nodes.  As a part of this change intermediate output is modified to print symbol table ids of functions so that debugging function id related functionality will be easier in the future.  After this patch TIntermAggregate is still used for function prototypes function parameter lists function calls variable and invariant declarations and the comma (sequence) operator.  BUG=angleproject:1490 TEST=angle_unittests angle_end2end_tests  Change-Id: Ib88b4ca5d21abd5f126836ca5900d0baecabd19e Reviewed-on: https://chromium-review.googlesource.com/394707 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix and re-enable EGLSyncControlTest.SyncValuesTest  It looks like the problem was not making the OS Window visible. It turned out the previous version of the test succeeded only when I ran angle_end2end_tests.exe with --gtest_filter=EGLSyncControlTest.SyncValuesTest and failed when I ran all tests especially with --single-process-tests.  I tested the modified version of the test which repeated the measurement 50 times and couldn't get a reliable test execution until I figured out that back buffers were queueing and not swapping successfully with the window being invisible.  This version works reliably when running all angle_end2end_tests.exe on my workstation and on a test laptop both running Windows 10 with or without --single-process-tests.  BUG=angleproject:1402  Change-Id: I97764a86b20119cc586ea2a4fd1d94558c4e737e Reviewed-on: https://chromium-review.googlesource.com/397739 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Stanislav Chiknavaryan <stanisc@chromium.org>, 23355681, 619, 169, 619
Reland "Add workaround for unused std140 and shared uniform blocks on MacOS"  On some Mac drivers with shader version 4.1 they will treat unused std140 and shared uniform blocks' members as inactive. However WebGL2.0 based on OpenGL ES3.0.4 requires all members of a named uniform block declared with a shared or std140 layout qualifier to be considered active. The uniform block itself is also considered active.  This workaround is to reference all members of unused std140 and shared uniform blocks at the beginning of the vertex/fragment shader's main().  BUG=chromium:618464 TEST=UniformBufferTest.ActiveUniformBlockNumber  Change-Id: I18da4e2b61b0170068bf5ea38ce54667b0737780 Reviewed-on: https://chromium-review.googlesource.com/395648 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
FramebufferGL: only work around SRGB blits on Desktop GL  BUG=angleproject:1492  Change-Id: I6c210243dffb775efd61c33160dabcbf7406a757 Reviewed-on: https://chromium-review.googlesource.com/397798 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement robust TexParameter and SamplerParameter entry points.  BUG=angleproject:1354  Change-Id: I3aa2dcb8603a839f9c07cd9dd41cb695d2e699f2 Reviewed-on: https://chromium-review.googlesource.com/395529 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Separate function info from TIntermAggregate  This change will make it easier to split types of TIntermAggregate nodes representing functions and function calls into different node classes.  BUG=angleproject:1490 TEST=angle_unittests  Change-Id: I730aa7858fe31fda86218fc685980c6ad486f5e0 Reviewed-on: https://chromium-review.googlesource.com/394706 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix GCC 5.4 compilation error when parsing the __clang__ macro  The __clang__ macro cannot be directly used with an #if directive if it has not been defined. This causes a compilation error under GCC 5.4 Linux.  Change-Id: Ieca752cd9f0e90c82febc35e19e1c1f3c6096de1 Reviewed-on: https://chromium-review.googlesource.com/397220 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Clean up TSymbol initialization  Now TSymbol objects always get their id when they are constructed. The id cannot be changed after the TSymbol is created.  This makes it simpler to insert both mangled and unmangled versions of a function to the symbol table. These can now both share the same TSymbol object unlike before when inserting the same symbol twice would have changed its symbol id.  This requires changes to function definition parsing: function definition nodes now share any symbol created by previous prototype declarations of the function. The parameters on the symbol get set to the parameters in the function definition header.  BUG=angleproject:1490 TEST=angle_unittests  Change-Id: I8e600e9b5e5de27d64b85c5042cfd23ff02abe63 Reviewed-on: https://chromium-review.googlesource.com/396838 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix synchronization of workaround dirty bits in TextureGL.  The local dirty bits were sometimes not synced because gl::Texture doesn't know that they exist.  Also fix calculation of when the workaround dirty bits need to be set.  BUG=angleproject:1386  Change-Id: I3d9d1a01e5441be783190422093c485ea5da7aec Reviewed-on: https://chromium-review.googlesource.com/396542 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement robust GetUniform entry points.  BUG=angleproject:1354  Change-Id: I07dccc470c57aadd41cae8fce327e4aca58a0bea Reviewed-on: https://chromium-review.googlesource.com/395113 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Handle corner cases of shifting signed integers better  Right-shifting a negative number should sign-extend according to the ESSL 3.00.6 spec. Implement sign-extending right shift so that it doesn't hit any undefined behavior in the C++ spec. Negative lhs operands are now allowed for bit-shift right.  Also implement bit-shift left via conversion to unsigned integer so that it does not hit signed integer overflow. Negative lhs operands are now allowed also for bit-shift left as well.  BUG=chromium:654103 TEST=angle_unittests  Change-Id: Iee241de9fd0d74c2f8a88219bddec690bb8e4db2 Reviewed-on: https://chromium-review.googlesource.com/395688 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add missing override identifier for getSequence  Fixed the compiling error in Mac by adding missing override identifier for getSequence.  BUG=angleproject:1490 TEST=compile on macOS Sierra 10.12  Change-Id: I8f8d556c82885bbee1712e1b6e5f439b67906023 Reviewed-on: https://chromium-review.googlesource.com/396403 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement robust GetShaderiv entry points.  BUG=angleproject:1354  Change-Id: I994b7a596b5b67fadbd91ad0d64054c792523200 Reviewed-on: https://chromium-review.googlesource.com/395111 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add cross-platform Workarounds to Context.  These are distinct from the renderer-level workarounds.  Add the first workaround loseContextOnOutOfMemory. This is enabled when the application enables reset notifications via KHR_robustness and is intended for more robust handling of errors in key APIs for Chromium's correctness (in particular sync objects).  Change Context::getResetStatus to persistently return the "lost" status if it was set by calling Context::markContextLost. Previously if markContextLost was called but the implementation hadn't actually received an error like a lost device the "lost" reset status would be dropped. Returning it only once to the caller is also fragile. Tested this by manually injecting a failure in FenceSync11::clientWait and ensuring that Chromium detected it as expected.  BUG=chromium:650138  Change-Id: Ie53069eacd1754ad5d64936e3fef315af24605fa Reviewed-on: https://chromium-review.googlesource.com/394233 Commit-Queue: Kenneth Russell <kbr@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add missing virtual destructor on TIntermAggregateBase  BUG=angleproject:1490 TEST=build on Linux GCC  Change-Id: I64f53d636d4acee0469b6e9ba1201322087d5f65 Reviewed-on: https://chromium-review.googlesource.com/395732 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Split TIntermBlock from TIntermAggregate  The new TIntermBlock node class replaces TIntermAggregate nodes with the EOpSequence op. It represents the root node of the tree which is a list of declarations and function definitions and any code blocks that can be denoted by curly braces. These include function and loop bodies and if-else branches.  This change enables a bunch of more compile-time type checking and makes the AST code easier to understand and less error-prone.  The PostProcess step that used to be done to ensure that the root node is TIntermAggregate is removed in favor of making sure that the root node is a TIntermBlock in the glslang.y parsing code.  Intermediate output formatting is improved to print the EOpNull error in a clearer way.  After this patch TIntermAggregate is still used for function definitions function prototypes function parameter lists function calls variable and invariant declarations and the comma (sequence) operator.  BUG=angleproject:1490 TEST=angle_unittests angle_end2end_tests  Change-Id: I04044affff979a11577bc1fe75d747e538b799c8 Reviewed-on: https://chromium-review.googlesource.com/393726 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add linux_chromium_chromeos_ozone_rel_ng to CQ.  So ANGLE's Ozone backend gets compiled.  BUG=angleproject:1412  Change-Id: Id4b401f59cd9d3f4dd0b945af67ecc0c9e5d68a2 Reviewed-on: https://chromium-review.googlesource.com/395607 Commit-Queue: Frank Henigman <fjhenigman@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Andrii Shyshkalov <tandrii@chromium.org>, 23355681, 619, 169, 619
Disabling EGLSyncControlTest.SyncValuesTest  Disabling EGLSyncControlTest.SyncValuesTest for now until I can get it stable on Windows 8.  BUG=angleproject:1402  Change-Id: I21a770e0f8516916c6987ba66ec49762cd99b78a Reviewed-on: https://chromium-review.googlesource.com/395577 Reviewed-by: Stanislav Chiknavaryan <stanisc@chromium.org> Commit-Queue: Stanislav Chiknavaryan <stanisc@chromium.org>, 23355681, 619, 169, 619
Refactor some errors into ANGLE_TRY macros.  BUG=None  Change-Id: I00ff2523995cb49d1af60cae62c2bba0d020eed4 Reviewed-on: https://chromium-review.googlesource.com/395569 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor some entry point stuff.  BUG=angleproject:747  Change-Id: I80634b5e6de8bae1433c49a56a92d3b19c24e11d Reviewed-on: https://chromium-review.googlesource.com/395568 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement robust GetRenderbufferParameteriv entry points.  BUG=angleproject:1354  Change-Id: I073b75d416bd5184402b580bcebfca34f7cd28a8 Reviewed-on: https://chromium-review.googlesource.com/395110 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement robust ReadPixels entry points.  BUG=angleproject:1354  Change-Id: I70738d2f00e283ddc52b1545f8efda9022110487 Reviewed-on: https://chromium-review.googlesource.com/391090 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix EGLSyncControlTest.SyncValuesTest timeout on Windowse Server 2012 R2  The test does two buffer swaps and polls sync values waiting for sbc (swap buffer counter) value to first increase from 0 to 1 then from 1 to 2.  Looking the error log I see that sometimes it fails on the first wait and sometimes on the second wait. Also the total runtime varies between 1000 and 1600 ms. That makes me think that perhaps test doesn't poll long enough to run reliably on a test machine.  I've increased the number of poll iteration to 500 and the sleep between iterations - to 10 ms (I think in reality it was 10 ms already because the previously used 1 ms is only possible with high resolution system timer).  BUG=angleproject:1402  Change-Id: I8f6fe209756a1597e2739390352c90d893eaf940 Reviewed-on: https://chromium-review.googlesource.com/395506 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't write to the <length> parameter if an error is generated.  BUG=angleproject:1354  Change-Id: I9ed4a675b2be07b00c29d34e283280dc65238fea Reviewed-on: https://chromium-review.googlesource.com/395109 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix some format support entries.  On Intel these were seeingly missing or erroneous.  BUG=angleproject:1389 BUG=angleproject:1459  Change-Id: I4410407ce1171f420b275c7662896f5b26a949c2 Reviewed-on: https://chromium-review.googlesource.com/395168 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
translator: Return null uniform map if no HLSL.  This replaces the global empty map.  BUG=angleproject:1459  Change-Id: If7d824cbf4492e722cbf99d1045402a26535af5c Reviewed-on: https://chromium-review.googlesource.com/394236 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Constexpr-fy the ES3 effective format map.  This removes the global std::vector constructor here.  BUG=angleproject:1459  Change-Id: I407a7bda1f8f8a2dd8d5b0e847573f8594eccf39 Reviewed-on: https://chromium-review.googlesource.com/394235 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add dirty bits for internal texture state.  Synchronize TextureGL internal state using the dirty bits.  TexturesBenchmark scores: Before: 5051 After: 7639 Diff: +51.2%  BUG=angleproject:1386  Change-Id: Id04aef778a47175d1a284564495a646045855b4b Reviewed-on: https://chromium-review.googlesource.com/393866 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement CHROMIUM_copy_compressed_texture for D3D11.  BUG=angleproject:1356  Change-Id: Id563997d2921cf558c52a781ae66d8bde58d1f2f Reviewed-on: https://chromium-review.googlesource.com/339847 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make global ES3 formats STL map a switch.  This eliminates another global std::map and replaces it with a json generated switch. This should be better for threading better on memory use and faster.  BUG=angleproject:1389 BUG=angleproject:1459  Change-Id: I1d289637c00783690ec8ea743ea2aa17b0ab8e50 Reviewed-on: https://chromium-review.googlesource.com/394234 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix formatting of OutputHLSL::visitAggregate  Subsequent refactoring of this code will be easier to review if there won't be unrelated style changes that git cl format insists on doing.  BUG=angleproject:1490 TEST=angle_unittests  Change-Id: I102fd73bd92317ab438e1676422212f644d2859b Reviewed-on: https://chromium-review.googlesource.com/394649 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
D3D11: Fold mipmap gen caps into the support table.  This change is two-fold: first it allows us to remove the std::map for D3D11 format info which was only being used in a single place.  Secondly it fixed the support table to use the correct 9_3 caps for texture support determined by running the D3D11FormatTablesTest. This should reduce the number of format queries we need to run on 9_3 startup.  BUG=angleproject:1389 BUG=angleproject:1459  Change-Id: I2435a47fc221e73c96337bc7c1c4ed37b527bc1f Reviewed-on: https://chromium-review.googlesource.com/392210 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Split off DXGI component type query.  This query is currently a part of a std::map. Split it off to its own switch using auto-generation based on the format string.  Also introduce a DXGI-to-angle format map. This map is not totally complete because some more esoteric formats don't have corresponding ANGLE formats yet. We should add these other formats (EG NV12) if we need them.  BUG=angleproject:1389 BUG=angleproject:1459  Change-Id: I49e045bdc04a52166299c9e22a4c4d3f24069dbc Reviewed-on: https://chromium-review.googlesource.com/392209 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Clean up RecordConstantPrecision interaction with switch/case  There were two bugs here that were masking each other:  1. Case nodes were not being added to AST traversal path. 2. RecordConstantPrecision did not check if a constant was a child of    a case node.  Fix these.  BUG=angleproject:1490 TEST=WebGL 2 conformance tests  Change-Id: Ic6cb7942bf57870fa26eb6a011919a2d7951cc85 Reviewed-on: https://chromium-review.googlesource.com/394588 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Implementation of eglGetSyncValuesCHROMIUM extension.  This change adds implementation of eglGetSyncValuesCHROMIUM extension on D3D11 with Direct Composition. This should work on Windows 8.1 and above.  The implementation is based on IDXGISwapChain::GetFrameStatistics.  Extension documentation: https://chromium.googlesource.com/chromium/src/gpu/+/master/GLES2/extensions/CHROMIUM/EGL_CHROMIUM_get_sync_values.txt  BUG=angleproject:1402  Change-Id: I306434dd8d85d618b14edfa38fc2a22e50fddacc Reviewed-on: https://chromium-review.googlesource.com/390351 Commit-Queue: Stanislav Chiknavaryan <stanisc@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Change UNREACHABLE to use ASSERT.  The ASSERT macro is enabled with ANGLE_RELEASE_ASSERT so we should use the same behaviour as the normal ASSERT for the other debug macros.  Also remove UNREACHABLEs in the format validation code that were being hit silently.  Also make some EGL tests skip instead of fail since they were hitting UNIMPLEMENTED.  BUG=angleproject:1332 BUG=angleproject:1540 BUG=angleproject:1340  Change-Id: Ie3347f2bf2459a5831b66827871998d8fbe7d4b2 Reviewed-on: https://chromium-review.googlesource.com/392490 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
translator: Fail compilation if precision emu unsupported.  The fuzzer uncovered a case where we were trying to emulate precision on HLSL 3.0 causing an ASSERT crash.  BUG=chromium:653276  Change-Id: I2e666a1ff4f605541e25f04264146063559cb835 Reviewed-on: https://chromium-review.googlesource.com/394237 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
translator: Avoid divide-by-zero in error case.  In some code path found by a fuzzer we would have a zero sized array which would trigger a zero divide. I was unable to extract the failing shader from the fuzzer case trivially.  BUG=chromium:653274  Change-Id: Ia2558ae828fa73615c901fd1cda9ddaa3a72f1a9 Reviewed-on: https://chromium-review.googlesource.com/394238 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
GL: Emulate SRGB blits where needed.  Desktop OpenGL before 4.4 doesn't handle SRGB blits the same way OpenGL ES does. Emulate them by drawing a quad.  BUG=angleproject:1492 BUG=chromium:634525  Change-Id: I9f2992d9b373941b10f19f8a51564f0f756cc4df Reviewed-on: https://chromium-review.googlesource.com/389853 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Store channel bits info in angle::Format.  This allows us to delete some duplicated code in the D3D11-side.  BUG=angleproject:1389 BUG=angleproject:1459  Change-Id: Ifdcfcd4a56e06ff2ae8f5ca0bda72281d52c2964 Reviewed-on: https://chromium-review.googlesource.com/392208 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Skip TimerQueriesTest.TimeElapsedMulticontextTest on Win/AMD/GL/Debug.  This test appears to be flaky.  BUG=angleproject:1541  Change-Id: I2a91626f6dc309d2dc23098cbaf290adac7f4859 Reviewed-on: https://chromium-review.googlesource.com/394217 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Skip UniformBufferTest.VeryLarge on Intel D3D11.  This fails because of issues with Intel UBOs and copying.  BUG=chromium:651493 BUG=chromium:593024  Change-Id: Ia4c634ebecd29082927a9a812929c102d0d629b2 Reviewed-on: https://chromium-review.googlesource.com/394131 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Skip TimerQueriesTest.TimeElapsed on Win/AMD/GL/Debug."  The correct test was the multi-context version.  BUG=angleproject:1541  This reverts commit d0614b852154da7a9968e2f6b1a775fc469dc83b.  Change-Id: I4f4a9e3b1e0301eef34ce8c06cd649bff66fcdb1 Reviewed-on: https://chromium-review.googlesource.com/394216 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Skip TimerQueriesTest.TimeElapsed on Win/AMD/GL/Debug.  This test appears to be flaky.  BUG=angleproject:1541  Change-Id: I947dbc759e0fef505ce9b11e501f2dbe35ff1e5c Reviewed-on: https://chromium-review.googlesource.com/394329 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make the "FormatMap" a static switch.  This map lives in formatutils.cpp and maps from a {formattype} to an internal format. Convert this into generated code.  BUG=angleproject:1389  Change-Id: Ib12750d83d3f8cf8794d6668874cb025f856b5d4 Reviewed-on: https://chromium-review.googlesource.com/392207 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add an extension for requesting a NULL Display.  BUG=angleproject:1468  Change-Id: Ief4b0e7d7a0420e59e547cd24fde53deb3718ccb Reviewed-on: https://chromium-review.googlesource.com/388845 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add stubs for a NULL renderer.  BUG=angleproject:1468  Change-Id: I2ed2b65a4b6f6ea3dda61c0467aef95e407cd38c Reviewed-on: https://chromium-review.googlesource.com/388844 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Ensure that if-else branches are always sequence nodes  This mainly affects RewriteElseBlocks which was the only piece of code still adding TIntermIfElse nodes directly as children of other TIntermIfElse nodes.  BUG=angleproject:1490 TEST=angle_unittests  Change-Id: I5b25c2fb9c642424417cd6c29e37c20482c6ffaf Reviewed-on: https://chromium-review.googlesource.com/392847 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Re-land "Fix glGetIntegerv(GL_TEXTURE_BINDING_EXTERNAL_OES ...)"  BUG=angleproject:1332  Change-Id: Ie970466c4528cb80b2363d0c0683da2d9c23c4f4 Reviewed-on: https://chromium-review.googlesource.com/392267 Commit-Queue: John Bauman <jbauman@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix integer math overflows in the preprocessor  Evaluating integer expressions in the ESSL preprocessor may result in overflowing the signed integer range. Implement wrapping overflow for preprocessor expressions in a way that doesn't hit any undefined behavior.  In the ESSL spec preprocessor expressions are defined to have mostly the same semantics as in C++. Since C++ doesn't define what happens on signed integer overflow we choose to make most of the operators wrap on overflow for backward compatibility and consistency with the rest of the ESSL spec.  We reuse the existing wrapping overflow helpers that are used for constant folding. To be able to do this the type used in the preprocessor expression parser is changed from 64-bit to 32-bit.  Shifting negative numbers is implemented as a logical shift. This cannot be disallowed since dEQP requires shaders shifting negative numbers to pass compilation.  Undefined bitwise shifts where the offset is greater than 31 will now result in a compile-time error.  A couple of test cases are now covered by the preprocessor tests rather than full compilation tests. This isolates the tests better and they run faster.  BUG=chromium:652223 TEST=angle_unittests  Change-Id: I84be40d404c10ecd0846c5d477e626a94a2a8587 Reviewed-on: https://chromium-review.googlesource.com/392146 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix unreferenced XFB vars getting dropped.  Our for-loop logic was confused so that some unreferenced transform feedback varyings might get dropped.  BUG=chromium:651493  Change-Id: Id283230da0a47fc647b2a3862da60be5538e439e Reviewed-on: https://chromium-review.googlesource.com/391945 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
formatutils: allow reusing rowPitch computation for depthPitch  This should fix a null D3D11 backend draw call performance regression.  BUG=651101  Change-Id: I2eb10cddd15f0e7b25b886c89eccd2906e988c72 Reviewed-on: https://chromium-review.googlesource.com/392227 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Only expose the EGL robutness extensions when the native GL context has them.  On some drivers the WGL_ARB_create_context_robustness extension is present but the created context does not expose the extensions.  Be more defensive and only expose robustness if we're able to create contexts that have it.  BUG=angleproject:1538  Change-Id: I3d02b2071c7b2c576abe66cc283cee467e400fd3 Reviewed-on: https://chromium-review.googlesource.com/391833 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: John Bauman <jbauman@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix Buffer11::copyFromStorage and UBOs.  The change to initialize a constant buffer immediately after calling BufferData in D3D11 led to a bug where we would map the UBO for writing with the wrong map bits. Fix this by using the same map method as the rest of the code.  The D3D11 runtime seems to allow arbitrarily large constant buffers on Windows 10 but not Windows 7. Thus this CL also fixes a bug in our constant buffer size clamping to not copy more than the available buffer size for uniform buffers.  BUG=chromium:651493  Change-Id: I876767691d02db90ecb08a8fa78199f03339a35e Reviewed-on: https://chromium-review.googlesource.com/391167 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Ensure that all functions have a body node in the AST  Some traversers that insert code to main() assume that the main() function has a non-null body node in place. This assumption was previously wrong since functions could be missing the body node in case the function body was empty.  Fix possible invalid dereferencing of missing function body nodes by always adding an empty sequence node to represent the body of functions that have an empty body in the ESSL source. This also enables simplifying some tree traversers that used to take the possibility of missing function body nodes into account.  Also fix AddDefaultReturnStatements to check the last statement inside the function body for a return statement instead of checking the first statement.  BUG=angleproject:1539 TEST=angle_unittests angle_end2end_tests  Change-Id: I2fbd18c78653fa2f1a96dbd9a619accc4874030d Reviewed-on: https://chromium-review.googlesource.com/392046 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "Add workaround for unused std140 and shared uniform blocks on MacOS"  This reverts commit 9aa83fe302578d226f195fff5fb3f0e2fb723a4c.  The new test UniformBufferTest.ActiveUniformNumberAndName/ES3_OPENGL is failing on multiple platforms. Examples: https://build.chromium.org/p/chromium.gpu.fyi/builders/Mac%2010.10%20Release%20%28ATI%29/builds/12285 https://build.chromium.org/p/chromium.gpu.fyi/builders/Linux%20Release%20(ATI)  Change-Id: I78b1a4d58e9a291e40ad304eb32f990e0518f7ee Reviewed-on: https://chromium-review.googlesource.com/391049 Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Revert "Fix glGetIntegerv(GL_TEXTURE_BINDING_EXTERNAL_OES ...)"  This reverts commit ca40662aa81f7735d3510fa52e55d28503c7f9ec.  https://chromium.googlesource.com/angle/angle/+/ca40662aa81f7735d3510fa52e55d28503c7f9ec broke angle_end2end_tests on the Win Debug bots. Examples:   https://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Debug%20%28NVIDIA%29/builds/18718  https://build.chromium.org/p/chromium.gpu.fyi/builders/Win8%20Debug%20%28NVIDIA%29/builds/15905   Tests failing:  Texture2DTest.QueryBinding/ES2_D3D11  Texture2DTest.QueryBinding/ES2_D3D9  Texture2DTest.QueryBinding/ES2_D3D11_9_3  Change-Id: If9da864f49e0de3a134d43ae36c2a99e9b5a2a53 Reviewed-on: https://chromium-review.googlesource.com/391130 Reviewed-by: John Bauman <jbauman@chromium.org>, 23355681, 619, 169, 619
Test filling small mips of ETC textures.  BUG=angleproject:1510  Change-Id: I9ed7c877767909ba93e2ea5ef09c4735b0d0bcc7 Reviewed-on: https://chromium-review.googlesource.com/382652 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix glGetIntegerv(GL_TEXTURE_BINDING_EXTERNAL_OES ...)  BUG=angleproject:1332  Change-Id: I591b9520bc1122eb6232803ac86b6d0322f8c349 Reviewed-on: https://chromium-review.googlesource.com/390323 Commit-Queue: John Bauman <jbauman@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a GL_ANGLE_robust_client_memory extension.  This allows specifying data size to all GL functions that provide a pointer to client memory and a length parameter for all functions in which the driver writes to client memory.  BUG=angleproject:1354  Change-Id: Ia68be1576b957cb529c87b5e0d1bd638c7dbd371 Reviewed-on: https://chromium-review.googlesource.com/382012 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix ETC->DXT small mip transcode crash.  BUG=angleproject:1510  Change-Id: I42355607235a05fe276342084acd1eb359c16de4 Reviewed-on: https://chromium-review.googlesource.com/390414 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Split vector swizzle AST nodes into a different node class  This avoids creating a weird aggregate node with a sequence of constant union nodes to store the offsets. They're stored neatly inside a vector instead. This makes code that needs to iterate over the swizzle offsets much simpler.  BUG=angleproject:1490 TEST=angle_unittests  Change-Id: I156b95723529ee05a94d30295ffb6d0952a98564 Reviewed-on: https://chromium-review.googlesource.com/390832 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
D3D11: Add null check to Renderer11::testDeviceLost.  After experiencing a device loss Renderer11::resetDevice can fail to recreate mDevice leaving it null. In a following call to testDeviceLost mDevice will be dereferenced causing a segfault.  BUG=angleproject:1457  Change-Id: Ib5be64542929441ceb7088a328c3245ae7e52f17 Reviewed-on: https://chromium-review.googlesource.com/364120 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add workaround for unused std140 and shared uniform blocks on MacOS  On some Mac drivers with shader version 4.1 they will treat unused std140 and shared uniform blocks' members as inactive. However WebGL2.0 based on OpenGL ES3.0.4 requires all members of a named uniform block declared with a shared or std140 layout qualifier to be considered active. The uniform block itself is also considered active.  This workaround is to reference all members of unused std140 and shared uniform blocks at the beginning of the vertex/fragment shader's main().  BUG=chromium:618464 TEST=UniformBufferTest.ActiveUniformBlockNumber  Change-Id: I1d2c5e3e8da04786ac6a37fd26f7bb9c14cd76ed Reviewed-on: https://chromium-review.googlesource.com/387169 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Factor code between PixelUnpackState and PixelPackState  BUG=angleproject:1512  Change-Id: I4c60472d216bfc5198e635d70fd197a5738dde98 Reviewed-on: https://chromium-review.googlesource.com/390133 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Workaround isnan() on Intel drivers  On some Intel drivers calling function isnan() on highp float will get wrong answer. This patch work arounds this bug by using an expression to emulate this function.  BUG=chromium:650547  Change-Id: I5bc5e0352c434f42cd2c55103a74f9f7ba51a72c Reviewed-on: https://chromium-review.googlesource.com/389834 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Handle negation of minimum representable integer  Negating the minimum representable integer overflows so it has undefined behavior in C++. Handle this as a special case in the code.  BUG=chromium:637050 TEST=angle_unittests  Change-Id: Ic6e6d638faddad9b70b5d1637bb4b42ef4f43784 Reviewed-on: https://chromium-review.googlesource.com/390551 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix handling integer overflow in constant folding  Integer operations that overflow are defined to wrap in the ESSL 3.00.6 spec. Constant folding that happens inside the shader translator should also follow the wrapping rules.  The new implementations of wrapping integer addition and subtraction use unsigned integers to perform calculations. Unsigned integers are defined to implement arithmetic in modulo 2^n in the C++ spec. This behavior is also leveraged to implement wrapping unsigned integer multiplication.  The implementation of wrapping signed integer multiplication is slightly trickier. The operands are casted to a wider type to perform the multiplication in a way that doesn't overflow and then the result is truncated and casted back to the narrower integer type.  Incorrect tests that expected errors to be generated from integer overflow in constant folding are removed.  BUG=chromium:637050 TEST=angle_unittests  Change-Id: I0de7e25881d254803455fbf22907c192f49d09ff Reviewed-on: https://chromium-review.googlesource.com/390252 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
FramebufferGL: add readPixels workarounds  Implements workarounds for:  - The pack state making rows overlap in memory which causes crashes on    some drivers.  - The driver adding an extra last row padding when checking if the    pixel pack buffer is large enough for the readPixels.  BUG=angleproject:1512  Change-Id: I120ff58649bb523e8b01da6ef03d8fcadaf076b2 Reviewed-on: https://chromium-review.googlesource.com/388029 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a perf test for changing texture state.  BUG=angleproject:1386  Change-Id: I44da3a4cb2b23f98978349f26b80d6bb3a6dc8b5 Reviewed-on: https://chromium-review.googlesource.com/388784 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix integer division constant folding corner cases  ESSL has undefined behavior when the integer modulus operator is used on negative operands. Generate a warning and fold the result to zero in this case.  In case the minimum representable signed integer is divided by -1 the result is defined to be either the maximum or minimum representable value. We choose to fold the calculation to the maximum representable value in this case.  BUG=angleproject:1537 TEST=angle_unittests  Change-Id: I57fac6b54a3553b7a0f0e36cc6ba0ed59a88eea9 Reviewed-on: https://chromium-review.googlesource.com/390251 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add validation for the pack buffer in ReadPixels  BUG=angleproject:1512  Change-Id: Ia6bac628c35f04bc5d3adfde1569902475519698 Reviewed-on: https://chromium-review.googlesource.com/387668 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix folding shifts when operands have different signedness  The code used to incorrectly assert that the right-hand side of shift should have the same signedness as the left-hand side. Instead simply assert that both the lhs and rhs are integer typed and also don't rely on aliasing via union when accessing bit shift operands.  Also disallow constant folded bit shifts where the right hand side is greater than 31. Shifting with values greater than the width of the type has undefined results in both ESSL and C++.  BUG=chromium:648135 TEST=angle_unittests  Change-Id: I84a99abc55f0eeda549b4781e954d17ba7b87552 Reviewed-on: https://chromium-review.googlesource.com/389351 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
preprocessor: Miscellaneous cleanups  - Use full header paths in includes - Use ASSERT instead of assert - Use angle::NonCopyable instead of PP_DISALLOW_COPY_AND_ASSIGN - Use range-for in a couple places - Remove pp_utils.h  BUG=angleproject:1522  Change-Id: If107fef89e8465bca65cf664926d1051c5d1e232 Reviewed-on: https://chromium-review.googlesource.com/387212 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
BlitGL: orphan scratch textures when we are done.  This will allow the OpenGL driver to reclaim GPU memory.  BUG=angleproject:1512  Change-Id: If063e1ff9f4a544012ca78c37e198054cb4edcac Reviewed-on: https://chromium-review.googlesource.com/388771 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Disable DrawBuffersTest.Gaps on Windows AMD OpenGL  Fails on Win7 Release (AMD R7 240) bot  BUG=angleproject:1535  Change-Id: I5e8d0552867bfe0d81f3e189536c50b36f530089 Reviewed-on: https://chromium-review.googlesource.com/389233 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
D3D11: Restrict ES3 bits to FL 10.1.  We would advertise ES3 in some cases when we didn't support it.  BUG=angleproject:1381 BUG=chromium:649101  Change-Id: I2a5bbc1d6153cdfc6c9c577aa0b82caf8482a42d Reviewed-on: https://chromium-review.googlesource.com/388190 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Allow LINEAR filtering on OES_depth_texture formats.  The ES3 spec and this extension lead to some awkward interactions. The extension doesn't mention allowed filtering modes so be default it allows both linear and nearest. ES3 however very clearly restricts any depth texture (any texture with effective internal format which has depth or stencil bits) to only use nearest filtering. This then breaks compatibility with the legazy unsized formats.  Choose to be slightly non-conformant here and allow linear filtering for the older unsized formats. Although this could lead to problems down the line it is consistent with existing ES drivers in practice.  Other future options might be to override the behaviour of the filter to use nearest when using WebGL validation compatibility.  BUG=chromium:649200  Change-Id: I4ee7608dd04d1fd238385aefee32c8c9c1e80ca0 Reviewed-on: https://chromium-review.googlesource.com/388759 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Generate unique HLSL texture function names for external textures.  Because 2D and external textures have the same HLSL texture type they were generating texture functions with the same name.  This causes conflicts when both 2D and external textures are used in the same shader.  BUG=angleproject:1534 BUG=645532  Change-Id: I4b324014b7d9b4851d358730cf4e31fc8461584c Reviewed-on: https://chromium-review.googlesource.com/388551 Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add an extension to disable resource generation on bind.  BUG=angleproject:1518  Change-Id: I662f7b07da5c97831496f2617b0adadf9858bdc9 Reviewed-on: https://chromium-review.googlesource.com/386799 Reviewed-by: Antoine Labour <piman@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
ConstantUnion: Error on undefined shift.  BUG=chromium:648135  Change-Id: I41581f63af650564a0f61c1baeeb38017c8513ed Reviewed-on: https://chromium-review.googlesource.com/387470 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix warning in standalone in new validation.  BUG=angleproject:1512  Change-Id: Ifdb8d4c38e3c90e03eee42ba9fd6390dffd61363 Reviewed-on: https://chromium-review.googlesource.com/388611 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
preprocessor: add a limit to the number of token expanded  BUG=angleproject:1522 BUG=chromium:648074  Change-Id: Ibf0858aaeb81933dd221ac82a49160169b48a495 Reviewed-on: https://chromium-review.googlesource.com/387211 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix validation of ReadPixels format and type.  The validation for ReadPixels allows for two combations of format/type:   1. Based on the current framebuffer's component type.     * GL_RGBA/GL_UNSIGNED_BYTE if the framebuffer is a normalized (signed       or unsigned).     * GL_RGBA_INTEGER/GL_INTEGER if the framebuffer is an       integer format.     * GL_RGBA_INTEGER/GL_UNSIGNED_INTEGER if the framebuffer is an       unsigned integer format.     * GL_RGBA/GL_FLOAT if the framebuffer is any type of float       framebuffer (added in EXT_color_buffer_float).     * These combations are detailed in the ES2 spec on pg 105 or ES3 on pg       193.   2. The implementation read format/type returned from glGetIntegerv.     * These formats are added by specs OES_texture_float EXT_texture_rg       EXT_read_format_bgra etc.  Update the GL and D3D backends to perform the conversion from GL_HALF_FLOAT to GL_HALF_FLOAT_OES.  Continue allowing reading as BGRA_EXT to support Skia.  Should be removed in the future.  BUG=607283 BUG=angleproject:1478  Change-Id: I0312cad4d5f138ab036f383d221f8ccd19a77f6d Reviewed-on: https://chromium-review.googlesource.com/346232 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: Free buffer staging storage when idle.  Using the same policy as for system memory storage we release the staging buffer if it has been unmodified for several uses.  We could further extend this technique to other storage buffers using a nearly identical policy. We might need to mitigate the cost of iterating over all the storages of all the buffers.  BUG=angleproject:516  Change-Id: Ib24ef03cf4184ef6f0c24f83347538df82de5f58 Reviewed-on: https://chromium-review.googlesource.com/387200 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
translator: Refactor Constant Union shift ops.  In preparation for making them robust.  BUG=chromium:648135  Change-Id: I88fc87d8887064fda04087c56de05d8725a6fe5f Reviewed-on: https://chromium-review.googlesource.com/387469 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
preprocessor: Fix use after free when #undef the macro being invoked  BUG=chromium:648031 BUG=angleproject:1522  Change-Id: I825cea9e736a2c99133408249cfcd525431d31de Reviewed-on: https://chromium-review.googlesource.com/386853 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove redundant code in RewriteTexelFetchOffset  Remove useTemporaryIndex() in function RewriteTexelFetchOffset since no temporary variables will be created in this function.  BUG=angleproject:1469  Change-Id: Ibed56f0ba5c89b6ae1ab1611de39514c3fbb600f Reviewed-on: https://chromium-review.googlesource.com/387198 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement a separate last row texture unpack buffer upload workaround  When uploading textures from an unpack buffer some drivers expect an extra row paading causing them to think the pixel buffer is not big enough. We work around this by uploading the last row separately.  BUG=angleproject:1512  Change-Id: I52fb8b35dc450b957f1fafb0b405c81bf0504157 Reviewed-on: https://chromium-review.googlesource.com/385193 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Disable some DrawBuffersTest on Windows AMD OpenGL  DrawBuffersTest.FirstAndLast/ES2_OPENGL DrawBuffersTest.FirstHalfNULL/ES2_OPENGL Hang on Win7 Release (ATI) and Win7 Debug (ATI) bots.  BUG=angleproject:1533  Change-Id: I6e37893fbcdbcc7a2a76c1cab6e8ef1f7ebaec19 Reviewed-on: https://chromium-review.googlesource.com/387714 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Regenerate the preprocessor with the latest versions of flex and bison.  BUG=648063  Change-Id: Ia90d12c8cb4ae0a694227145267e78ca02dcc2b0 Reviewed-on: https://chromium-review.googlesource.com/387114 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Disallow bit-shifting when the left operand is negative.  BUG=648063  Change-Id: I82d9fbdaf8791a396dd71eeb57d93967ba5d65bf Reviewed-on: https://chromium-review.googlesource.com/387115 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
CallDAG: rewrite assignIndicesInternal as iterative  Since the CallDAG is needed to check for the call graph depth its creation code must be robust to very deep call graphs.  BUG=angleproject:1517  Change-Id: I753ab84ad4ced6363a212f0fe94a89aabf4e3c3e Reviewed-on: https://chromium-review.googlesource.com/385496 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add WebGL validation extensions to ANGLE.  BUG=angleproject:1523  Change-Id: I6fecb5055ed8087665aeee34b3a066ea8f38d51b Reviewed-on: https://chromium-review.googlesource.com/386281 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Antoine Labour <piman@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix base/numerics to not trigger upcoming Clang warning  Fix base/numerics to not trigger upcoming Clang warning regarding unsigned enum bitfields producing non-portable code.  For more details see the patch here: https://reviews.llvm.org/D24289  BUG=648462  Change-Id: I9aaa01e99f734ff927b5b1171706b2f49b437d0b Reviewed-on: https://chromium-review.googlesource.com/386887 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Workaround the unary minus operator issue on Intel  On some Intel D3D drivers evaluating unary minor operator on an integer variable may get wrong answer in vertex shader.  This patch works around this bug by replacing -(int) with ~(int)+1 on Windows Intel.  BUG=chromium:644033  Change-Id: I0af719e84d618a33f25bcb33bde0c381fb462a31 Reviewed-on: https://chromium-review.googlesource.com/381675 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add robust math to constant folding.  Previously our multiplication and other operators could do overflows which can lead to security bugs.  BUG=chromium:637050  Change-Id: Icee22a87909e205b71bda1c5bc1627fcf5e26e90 Reviewed-on: https://chromium-review.googlesource.com/382678 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
BUILD.gn: Disable pool alloc on all translator dependents when fuzzing  It contains defines that need to be consistent between the header and the implementation.  BUG=angleproject:1522 BUG=chromium:647807  Change-Id: Ica144c455b7366bd9939a07b171edffe5af8bf35 Reviewed-on: https://chromium-review.googlesource.com/386945 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Store Buffer SRVs in native storage.  This allows us to not store std::pairs to identify SRVs. Instead we can release the cached SRVs directly when we re-create the native buffer.  BUG=angleproject:1513  Change-Id: I6f6d5edc659aa843c9439b97661073415f1a772b Reviewed-on: https://chromium-review.googlesource.com/385818 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
BUILD.gn: make the translator fuzzer a source set  When we want to use GN standalone the fuzzer_test template won't exist. Instead make the fuzzer a source set that is used by a target in Chrome.  BUG=angleproject:1522  Change-Id: I347e633448d508eb124d0861b0fb28315923016c Reviewed-on: https://chromium-review.googlesource.com/386636 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Supress failures in end2end tests for new Intel OpenGL driver.  Change-Id: I442eac44212406b0fd9fb64b2e4e914bf61f8503 Reviewed-on: https://chromium-review.googlesource.com/386280 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
translator/Compiler.cpp: fixup includes  A stray iostream got introduced in 28b6528ca2119d6715bb5e9eafa5a2dc8c968361  BUG=angleproject:1522  Change-Id: Ib0b14b47d4786309ec2d39acb5531f3772b91f20 Reviewed-on: https://chromium-review.googlesource.com/386256 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Disallow layout+invariant combo on ESSL 3.00 variable declarations  This combination is not allowed by the formal grammar in the ESSL 3.00 spec and should still be disallowed in ESSL 3.00 shaders even though the shader parser now implements the more flexible ESSL 3.10 grammar.  BUG=angleproject:1507 TEST=angle_unittests  Change-Id: I766a468fd7314c7e60e020b5b204aa6950263633 Reviewed-on: https://chromium-review.googlesource.com/381933 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Rename TIntermSelection to TIntermIfElse  Now that ternary nodes are not represented by TIntermSelection any more TIntermIfElse is an easier name to understand for newcomers to the code.  BUG=angleproject:1490 TEST=angle_unittests  Change-Id: Ia1e04e356ab93409400245092a84533d7dfd129d Reviewed-on: https://chromium-review.googlesource.com/385416 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add a fuzzer for the shader translator.  BUG=angleproject:1522  Change-Id: Idbe8194ba478366e99c7460d403d03fe27dd89d0 Reviewed-on: https://chromium-review.googlesource.com/353153 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Work around For and While loop bugs on Intel Mac OSX  Condition calculation in for and while loops has bug on Intel Mac. Work around it by converting "CONDITION" to "CONDITION && true".  This CL also adds previous SH_EMULATE_ABS_INT_FUNCTION workaround to the ANGLE GL back-end on OSX  BUG=chromium:644669 TEST=deqp/functional/gles3/shaderloop_for/while.html  Change-Id: I910f662b054f259fcb601b9938841b3a2d066840 Reviewed-on: https://chromium-review.googlesource.com/381678 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Qiankun Miao <qiankun.miao@intel.com> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
RendererGL: enable GL_DEBUG_OUTPUT on Debug builds  The intent was already to enable it but without glEnable(GL_DEBUG_OUTPUT) the Linux NVIDIA driver doesn't output anything.  BUG=  Change-Id: Ia9a500c2e792ee7c4e2a7be60d478419eda617e1 Reviewed-on: https://chromium-review.googlesource.com/385278 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D11: Detect driver version before workaround init.  This is order-sensitive. The workarounds need the driver version to properly determine if workarounds should be used.  This fixes the WebGL 2 test invalidate/sub on NVIDIA.  BUG=angleproject:1246  Change-Id: I7ca4f44ec2874553f167214e937e918b49e69567 Reviewed-on: https://chromium-review.googlesource.com/385077 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix standalone tests failing to find angle_util.dylib on Mac  BUG=  Change-Id: I69bddf27c1b019f71382d69c03eba94a268d2025 Reviewed-on: https://chromium-review.googlesource.com/385497 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use 64-bits compile options  BUG=chromium:645071  Change-Id: I31825123bf4cb45fb37a93f538e8936487beb5ff Reviewed-on: https://chromium-review.googlesource.com/382712 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor TConstantUnion.  In preparation for constant folding fixes.  BUG=chromium:637050  Change-Id: I9ea49ce96b34c6ac3d2f0478b8fc6732c59e28be Reviewed-on: https://chromium-review.googlesource.com/373741 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Split ternary node class from TIntermSelection  Ternary operator nodes are typed parts of expressions they always have two children and the children are also guaranteed to be TIntermTyped. "If" selection nodes can't be a part of an expression they can have either one or two children and the children are code blocks. Due to all of these differences it makes sense to store these using two different AST node classes.  BUG=angleproject:1490 TEST=angle_unittests  Change-Id: I913ab1d806e3cdb5c21106f078cc9c0b6c72ac54 Reviewed-on: https://chromium-review.googlesource.com/384512 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Specialize GLTypeToGLEnum in headers  BUG=angleproject:1514  Change-Id: I1f95e985471ea7a2ea0242d8b48ceccca68edf42 Reviewed-on: https://chromium-review.googlesource.com/384891 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Remove SH_TIMING_RESTRICTIONS compiler flag  The timing restrictions code is not in use and not updated for ESSL3 so it is better to remove it to make refactoring the AST easier.  It can also be argued that perfect prevention of shader timing attacks is not feasible due to factors that are not under control of ANGLE such as fixed function color compression in GPUs. Such color compression may make the use of texture bandwidth and thus performance dependent on the content of a texture regardless of whether a compressed format is chosen through the API.  SH_DEPENDENCY_GRAPH flag that could only be active together with the timing restrictions flag is also removed along with all the code that was supporting it. The newer CallDAG code is used for different purposes and is kept.  BUG=angleproject:1490 TEST=angle_unittests  Change-Id: I2cd10e18df366e8e43f7c3af1ca12d2a4bfb2007 Reviewed-on: https://chromium-review.googlesource.com/384511 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add newlines to error messages.  Looks like this breaks parsing tests list in gtest runner which causes deqp_gles2 to fail on Nexus 5X swarmed bot.  Driveby fix of HowToMakeChanges md format.  BUG=angleproject:1471  Change-Id: I6cfa2d9287385aabf2aee47521e5e55e309831c0 Reviewed-on: https://chromium-review.googlesource.com/383813 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Disallow multiple locations on output variables  GLSL ES specs from version 3.00 to 3.20 all mention that output layout location qualifier may appear at most once within a declaration. Enforce this rule when parsing shaders.  Also set max draw buffers to 8 when compiling GLSL ES >= 3.00 in the qualification order tests and shader translator sample so that parsing locations > 0 will succeed.  BUG=angleproject:1505 TEST=angle_unittests  Change-Id: I50fe409041385f5e10e695f43dc3a572433e9772 Reviewed-on: https://chromium-review.googlesource.com/381211 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Promote unary nodes automatically  Unary nodes now get their type set automatically based on the operation and operand. The operand should only be changed to another of the same type after the node is constructed. The operation can't be changed on unary and binary nodes after they've been constructed.  BUG=angleproject:1490 TEST=angle_unittests  Change-Id: Ib1ea3dcb1162261966c02d5f03d8091cf647fac1 Reviewed-on: https://chromium-review.googlesource.com/378935 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Promote and fold indexing nodes similarly to other binary ops  Indexing nodes now get their type set in TIntermBinary::promote same as math and logic ops. They are also constant folded through TIntermBinary::fold() instead of having special functions for constant folding them in ParseContext.  Index nodes for struct and interface block member access now always have integer type instead of sometimes having the type of the field they were used to access.  Usage of TIntermBinary constructor is cleaned up so only the constructor that takes in left and right operands is used. The type of TIntermBinary nodes is always determined automatically.  Together these changes make the code considerably cleaner.  Note that the code for constant folding for array indexing is actually never hit because constant folding array constructors is still intentionally disabled in the code.  BUG=angleproject:1490 TEST=angle_unittests  Change-Id: Ifcec45257476cdb0d495c7d72e3cf2f83388e8c5 Reviewed-on: https://chromium-review.googlesource.com/377961 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
D3D11: Release SRV cache in Buffer11 destructor.  This was leading to a resouce leak with fast unpack.  BUG=angleproject:1513  Change-Id: I4ff6c6e3c889392e314654d63f2db8f671b6913c Reviewed-on: https://chromium-review.googlesource.com/383711 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add workaround for B5G6R5 format in Intel driver  In Intel driver the data with format DXGI_FORMAT_B5G6R5_UNORM will be parsed incorrectly. According to https://msdn.microsoft.com/en-us/library/windows/desktop/ff471324(v=vs.85).aspx DXGI_FORMAT_B5G6R5_UNORM should be equivalent to D3DFMT_R5G6B5. However the data will be treated as B5G6R5 not R5G6B5.  This workaroud will disable B5G6R5 support when it's Intel driver. By default it will use R8G8B8A8 format.  BUG=chromium:644610 TEST=dEQP-GLES3.functional.fbo.blit.default_framebuffer.rgb565*  Change-Id: I9d64a9bcedf9247de6950d345ed2d3fb00170d30 Reviewed-on: https://chromium-review.googlesource.com/380421 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Don't allow fast unpack from GL_ALPHA8.  This format is one that doesn't support buffer SRV creation. It seems like there is no equivalent dEQP test for this format.  BUG=angleproject:1503  Change-Id: I9ecdb9406ca0b62dd54b450d2b50341d76584b2b Reviewed-on: https://chromium-review.googlesource.com/381435 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Generate OUT_OF_MEMORY when compiler initialization fails.  INVALID_OPERATION implies that the error is recoverable.  Change-Id: Iaa13293168f66f46864e5e4c0ab7d7c53c97e8fd Reviewed-on: https://chromium-review.googlesource.com/383131 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Constant-qualify nodes in a consistent way  Rely on that constant qualification of binary and unary nodes comes from promote().  BUG=angleproject:1490 TEST=angle_unittests  Change-Id: Ie8d1d4df3c82ae5a2de8cc536e47016d13a4fd3d Reviewed-on: https://chromium-review.googlesource.com/377960 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Update dEQP test expectations with passing tests  BUG=angleproject:1017 BUG=angleproject:1097 BUG=angleproject:1323  Change-Id: I67754700c27041c99428857c48697fa11c0d34ab Reviewed-on: https://chromium-review.googlesource.com/382860 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix incorrect compressed internal format enum.  This error was not exposed since compressed formats use different validation paths.  Fixed for completeness.  BUG=angleproject:1511  Change-Id: I9b44a795b1e43f52555440f776e00bb4b92354ef Reviewed-on: https://chromium-review.googlesource.com/382653 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Clean up unary and aggregate math folding  Prefer asserts instead of adding internal errors to the compiler log when types of arguments are not as expected or the folding function runs into an operation it can't handle. Neither of these cases should be possible the checks for correct argument types are solid at this point.  In the future when new built-in functions are added constant folding support for them should be added as well.  foldUnaryWithDifferentReturnType and foldUnaryWithSameReturnType are renamed to foldUnaryNonComponentWise and foldUnaryComponentWise respectively. These names better reflect what these functions are doing.  The info sink member is removed from TIntermediate since TDiagnostics is now passed into the functions that may generate warnings instead.  BUG=angleproject:1490 TEST=angle_unittests  Change-Id: I6a08abbe29cf23f3a318032fdc46dd3dbaf4410e Reviewed-on: https://chromium-review.googlesource.com/377959 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix overflow in ImageIndexIterator::done.  The maxLayer() method was reading out of range for 2D arrays.  BUG=644846614178 BUG=angleproject:1493  Change-Id: I7cc4773d1ee9ff2d0a18cb0a8e916cf3687446db Reviewed-on: https://chromium-review.googlesource.com/382332 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
StateManagerGL: handle GL_DITHER  DITHER is on by default and dEQP precision tests turn this off to avoid dithering messing with the precision. The OpenGL backend didn't handle glDisable(GL_DITHER) causing precision to be wrong on RGB565 on Linux Intel.  BUG=angleproject:1492  Change-Id: I5e750fbe9df397e8b9a826979b14c84a2d72a00d Reviewed-on: https://chromium-review.googlesource.com/382111 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
TextureTest: suppress failure for newly added test.  BUG=angleproject:1493 BUG=chromium:638323  Change-Id: I5cab149c735158fe810f002e47cc3c5c75bc503b Reviewed-on: https://chromium-review.googlesource.com/381951 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix compiler allocations accidentally done outside memory pool  Qualifier data structures were being accidentally allocated on the regular heap and never being freed inside the compiler due to missing POOL_ALLOCATOR_NEW_DELETE macros. Add in the macros where needed.  Also fix up include directives in QualifierTypes.h/.cpp to use the full path of files from ANGLE.  BUG=angleproject:1442 TEST=angle_unittests  Change-Id: Ib54f3cd3ab0f768fed9f0215d795ff493be513e0 Reviewed-on: https://chromium-review.googlesource.com/380538 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove usage of std::log2 in tests.  For some reason this was giving a link error on Android. Change it to use the mathutil version to be sure.  BUG=angleproject:1493 BUG=chromium:638323  Change-Id: I454ba4609d7818f50c668bb7c1a3b684f9ca8444 Reviewed-on: https://chromium-review.googlesource.com/381671 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
compiler: Work around a HLSL compiler aliasing opt bug.  BUG=angleproject:1448  Change-Id: I7d5bcbd100069152cea0cb03bc4fa6af1044460b Reviewed-on: https://chromium-review.googlesource.com/376020 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D11: Work around small mipped stencil textures.  AMD has a bug with 2x2 and 1x1 mips of depth/stencil textures. Formats D24S8 and D32FS8 both seem to render black for the very small mips.  We can work around this by selectively caching a copy of the texture data that only has depth information since stencil isn't filterable in OpenGL ES.  BUG=angleproject:1493 BUG=chromium:638323  Change-Id: Iebef42c4680018d9854dbe789d677823167213dd Reviewed-on: https://chromium-review.googlesource.com/380037 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Generate uniqueId for all TStructure  If not present ASSERT error may happen in debug build.  BUG=chromium:643075  Change-Id: Ia57e3771ab4d2861aefc04287fbbce85232f1f4d Reviewed-on: https://chromium-review.googlesource.com/381315 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Rename TextureStorage swizzle invalidation.  Since we'll also be storing a cache of depth textures as well as swizzle info generalize the invalidation methods.  BUG=angleproject:1493 BUG=chromium:638323  Change-Id: I8fef049b01c81483fcf28196866a22d5cfed32a1 Reviewed-on: https://chromium-review.googlesource.com/380036 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix ImageIndexIterator termination.  There was an off-by-one error preventing proper iteration.  BUG=angleproject:1493 BUG=chromium:638323  Change-Id: I8a3907620a1503d16b039606a67fe3471f88e165 Reviewed-on: https://chromium-review.googlesource.com/380325 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
UniformBufferTest: add back suppressions for failing tests  296398571213608b99d12266d0ba218f99c87abf fixes most but not all UniformBuffer Wintel failures of the waterfall add back suppressions needed to make the waterfall green.  BUG=chromium:593024  Change-Id: I124666853e9943bcb71083e5563d02e65551f916 Reviewed-on: https://chromium-review.googlesource.com/381451 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Clean up qualification order checks  Move determining whether qualification order checks are relaxed to QualifierTypes.cpp. The ParseContext only needs to construct TTypeQualifierBuilder with the shader version as a parameter and it will make the decision based on that. ParseContext still passes diagnostics to the TTypeQualifierBuilder functions that return variable qualification to make it more explicit when errors are generated.  Also encapsulate looking for symbols in the AST inside compiler_test.cpp.  BUG=angleproject:1442 TEST=angle_unittests  Change-Id: I4190e6a680ace0cc0568a517e86353a95cc63c08 Reviewed-on: https://chromium-review.googlesource.com/380556 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix build failure in chrome due to unused function  Chrome build fails on a warning: "../../third_party/angle/src/compiler/translator/QualifierTypes.cpp:30:6: error: unused function 'IsInvariantCorrect' [-Werror-Wunused-function]"  BUG=angleproject:1442  Change-Id: If2fea0d90e9cd789c3a6449881794082f3e98afd Reviewed-on: https://chromium-review.googlesource.com/381201 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Work around unpackHalf2x16 emulation for Intel Mac  Negative operator is buggy in an expression on Intel Mac. Use abs(v) to replace -v for negative value.  BUG=chromium:644057 TEST=deqp/functional/gles3/shaderpackingfunction.html  Change-Id: I6182e7a00b162e36ed9278c0e5a2fdd8fb480959 Reviewed-on: https://chromium-review.googlesource.com/381152 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Relax checks when parsing type qualifiers in GLSL ES 3.10  The grammar in GLSL ES 3.10 does not impose a strict order on the qualifiers and also allows multiple layout qualifiers.  This patch relaxes the checks when parsing a type qualifier.  BUG=angleproject:1442  TEST=angle_unittests  Change-Id: Ib3653a1ed1bfced099a6b2cbf35a7cd480c9100a Reviewed-on: https://chromium-review.googlesource.com/379016 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: Work around Intel uniform buffers bug.  When copying from a staging buffer to a uniform buffer the first upload would be incorrect. Work around this by trying to upload directly to a uniform buffer on the first BufferSubData call.  BUG=chromium:593024  Change-Id: I0df3a1422b962bf3ece5d445f435df01e3544b67 Reviewed-on: https://chromium-review.googlesource.com/368774 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor type_specifier_nonarray parsing to reduce code repetition  When type_specifier_nonarray gets parsed the scope gets saved into TType and the code becomes repetitive. Setting of the scope is moved to type_specifier_no_prec as it occurs less times.  BUG=angleproject:911  TEST=angle_unittests TEST=angle_end2end_tests  Change-Id: I6da5fe7bc2d60ba2996221af71b719b818f5e9b1 Reviewed-on: https://chromium-review.googlesource.com/380535 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Clear the swizzle cache in TextureStorage11::setData.  BUG=angleproject:1494  Change-Id: I67471e4b961b3d8374c2da84394ead743939c225 Reviewed-on: https://chromium-review.googlesource.com/380095 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix standalone build.  BUG=angleproject:1471  Change-Id: I52aadeb58f75d5b944421bd0cd4a5dddead3f6d1 Reviewed-on: https://chromium-review.googlesource.com/379916 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Change grammar to support features from es31  The grammar has been changed so that ES31 grammar is followed more closely. The ES31 grammar is not fully supported only functionality related to qualifier enumeration is added.  The ParseContext is changed so that type qualifiers can be now joined together (i.e. like layout qualifiers). This will allow enumeration of multiple storage qualifiers (i.e. uniform readonly coherent) which is essential for support of ES31 features.  Some of the error checks had to be moved closer to the root of the parse tree since some of the information about the expression might be missing.  Unfortunately as there is no explicit ordering imposed by the grammar additional checks for proper order of qualifiers had to be added. I also included unit tests which test against malformed shaders.  BUG=angleproject:1442  TEST=angle_end2end_tests TEST=angle_unittests TEST=dEQP-GLES3.functional.shaders.*precision* TEST=dEQP-GLES3.functional.shaders.*function* TEST=dEQP-GLES2.functional.shaders.*  Change-Id: Ib3653a1ed1bfced099a6b2cbf35a7cd480c9100d Reviewed-on: https://chromium-review.googlesource.com/362940 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Remove stray reference to SH_EMULATE_BUILT_IN_FUNCTIONS.  BUG=chromium:642227  Change-Id: Ie1d74c0abd355a0bddc3c2b700390a3a2a9c4823 Reviewed-on: https://chromium-review.googlesource.com/379875 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove SH_EMULATE_BUILT_IN_FUNCTIONS which isn't used  The flag is not used in chrome. We decide to do per emulation per flag.  BUG=chromium:642227  Change-Id: I936d53e5015186e35e672d0cb51c853a941582d2 Reviewed-on: https://chromium-review.googlesource.com/379077 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
GL backend: add a workaround for bad default current vertex attributes  BUG=angleproject:1492 BUG=351528  Change-Id: Ie4b25b0106282c9f60d19053e5a320549887bc8b Reviewed-on: https://chromium-review.googlesource.com/379196 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Work around abs() issue in Intel Mac drivers  abs(i) where i is an integer returns unexpected result in Intel Mac. This works around the issue by emulating abs(i) manually.  BUG=chromium:642227 TEST=deqp/functional/gles3/shadercommonfunction.html  Change-Id: I2a41e0f4bcb0766109d651e663283b1760468017 Reviewed-on: https://chromium-review.googlesource.com/377628 Commit-Queue: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Remove CSS Shader related code  CSS shader has been removed from spec and chrome code base. Remove the code in ANGLE.  BUG=chromium:233383  Change-Id: I93a35437f540e51ce7af9d49f21ca60d7c0b156a Reviewed-on: https://chromium-review.googlesource.com/378739 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Enable texelFetchOffset re-writing for GLSL translator  Intel Mac has the same bug as Win. So the CL enables it in GLSL translator as well.  BUG=chromium:642605 TEST=deqp/functional/gles3/shadertexturefunction/texelfetchoffset.html  Change-Id: I30323ea3a6d4c07ff32e50bd7c574916b5b865f4 Reviewed-on: https://chromium-review.googlesource.com/378601 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Update dEQP gles2 tests expectations for Android  Mark tests that fail or hang on Nexus 5X as such.  BUG=angleproject:1471 TEST=gles2 tests pass on Nexus 5X  Change-Id: I3de8ce3e472f9c75bd18140bf9aa4d79a73cb22d Reviewed-on: https://chromium-review.googlesource.com/377703 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Change angle_util to be a shared library  So that there will be one instance of static thread synchronization variables in AndroidWindow. Previously there was one instance in lib_angle_deqp_gles2_tests__library and one in libangle_deqp_libgles2 resulting in AndroidWindow::initialize waiting forever.  Also make the change in GYP build to fix standalone build and fix rpath issues on Mac.  BUG=angleproject:1471 TEST=end2end and deqp tests on standalone Win10 and end2end on GN Mac 10.11  Change-Id: I731578459400bb47d269df129aabed9b67b555e6 Reviewed-on: https://chromium-review.googlesource.com/376202 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Fix constant folding non-square outerProduct  Use all the vector elements correctly when constant folding non-square outerProduct. Previously the code used to discard some elements of the smaller outerProduct operand. Also clear up confusion about matrix rows/columns in matrix constant folding code in general.  BUG=angleproject:1482 TEST=angle_unittests  Change-Id: I7cba8f97a92b875de01e57255d54258cdfd92a47 Reviewed-on: https://chromium-review.googlesource.com/377298 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Update dEQP GLES3 test expectations  BUG=angleproject:1097  Change-Id: Ib10ee930eb4d29bee3bc014c008a6b7420525e42 Reviewed-on: https://chromium-review.googlesource.com/377458 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add missing TexImage and CopyTexImage format combinations for ES3.   * Some unsized DEPTH_COMPONENT combinations were not added to the validation    tables for the ANGLE_depth_texture extension.  * The HALF_FLOAT_OES format was not validated in ES3 for RGB and RGBA formats    when the OES_texture_half_float extension is supported.  * BGRA->BGRA CopyTexImage validation was missing.  No more errors are generated within ANGLE when visiting http://alteredqualia.com/tools/webgl-features/  BUG=605754  Change-Id: If654c34adcebb4cd3eaa994ad7e912f6ffa4df55 Reviewed-on: https://chromium-review.googlesource.com/376281 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement GL_ARB_create_context_robustness on GLX and WGL  BUG=angleproject:1463  Change-Id: I5bdcfd757d6f7d6411558c368fa7a26c8a38c9ba Reviewed-on: https://chromium-review.googlesource.com/365971 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Disable compute shader tests on Intel  The compute shader tests in angle_end2end_tests fail on Intel Linux. The patch disables the tests for Intel.  TEST=angle_end2end_tests BUG=angleproject:1483  Change-Id: I303f0852ea3ccb65c1dd96a196a640c76cc519e4 Reviewed-on: https://chromium-review.googlesource.com/377318 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix splitting nested sequence operators  Make sure that only one sequence operator is split on one iteration of SplitSequenceOperator. This prevents multiple successive PostVisit calls to nested sequence operator nodes from adding duplicate nodes to the AST. The sequence operators are split starting from the outermost one to preserve execution order.  Note that the shader translator somewhat unexpectedly generates nested sequence operators in the AST when there is a sequence operator with more than two operands so this bug ended up affecting shaders in the wild. The code around parsing sequence operators could be clarified separately.  BUG=638313 TEST=angle_end2end_tests  Change-Id: Ic6400a484ceff0c790c2290f7b4b80980f87cd88 Reviewed-on: https://chromium-review.googlesource.com/376678 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add a workaround for Intel drivers on glsl function texelfetchoffset  GLSL function texelfetchoffset will be translated into texture.Load in ANGLE. In D3D there is a note that When one or more of the coordinates in Location exceeds the u v or w mipmap level dimensions of the texture Load returns zero in all components but in glsl there is no such restriction which will cause the WebGL 2 dEQP test deqp/functional/gles3/shadertexturefunction/texelfetchoffset.html fail on Windows with Intel GPU.  Adapted from ExpandIntegerPowExpressions.cpp this patch adds a translation from texelFetchOffset into texelFetch to work around this issue.  BUG=angleproject:1469  Change-Id: Iecfb9570472036acf5960789bdb1a63f191316be Reviewed-on: https://chromium-review.googlesource.com/367883 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Manually compute the mipmap size for the textureSize builtin.  There were two issues with the current implementation:  * The GetDimensions function already takes into account the base level of the    SRV.  * The GetDimensions function returns doesn't return valid sizes for levels    that don't exist in the SRV.  Instead manually do the lod offset.  BUG=angleproject:931 BUG=angleproject:1316  TEST=dEQP-GLES3.functional.shaders.texture_functions.texturesize.sampler2d_fixed_vertex  Change-Id: I63259b563a42b93b73949e0ef7ac412099a42f13 Reviewed-on: https://chromium-review.googlesource.com/376099 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't allow packed integer types in glVertexAttribIPointer.  They are only allowed in the glVertexAttribPointer call.  BUG=angleproject:1101  Change-Id: I85aae9e35b45e8b1296244756091271d01dd1533 Reviewed-on: https://chromium-review.googlesource.com/376719 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't accept sampler operands for unary operators  Unary plus and minus used to be accepted with sampler operands. Increment/decrement operators also now generate a clearer error message if a sampler operand is supplied.  TEST=angle_unittests BUG=angleproject:1480  Change-Id: I2c5165c4eaac7b023d96e46a177e36f6536b0125 Reviewed-on: https://chromium-review.googlesource.com/376319 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
ContextImpl: only expose getResetStatus for robustness  This will allow each backend to implement this method separately. The current set of ContextImpl methods used for robustness are slightly D3D-centric.  BUG=angleproject:1463  Change-Id: I101f8ada2c49de4cf110db48b1e8380c52b50fb2 Reviewed-on: https://chromium-review.googlesource.com/365829 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add compute program compilation and linking support  Compute shaders can be now compiled and linked to create programs. Some tests are added to verify successful and unsuccessful compute shader linking.  The patch also replaces std::array<int 3> with a custom struct WorkGroupSize.  BUG=angleproject:1442  TEST=angle_end2end_tests TEST=angle_unittests  Change-Id: I4ab0ac05755d0167a6d2a798f8d7f1516cf54d84 Reviewed-on: https://chromium-review.googlesource.com/366740 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Move the rest of the validation out of TIntermBinary::promote  TIntermBinary::promote now has a single purpose of determining the type resulting from a binary math operation. The TIntermBinary constructor taking the left and right nodes can now also call promote automatically and promote is made into a private member of TIntermBinary. Validation of binary math operand types is done inside ParseContext.  BUG=angleproject:952 TEST=angle_unittests  Change-Id: I52a409f680c8d4120b757193972d03aed34c6895 Reviewed-on: https://chromium-review.googlesource.com/372624 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "Revert "Cover vector dynamic indexing case in SplitSequenceOperator""  This reverts commit d2f59bb6dda4f3548e158a09540829f9ff56bba4.  Change-Id: If2842bce17a0c085e2bc913ff120083fbe90497c Reviewed-on: https://chromium-review.googlesource.com/376189 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add test for EGL_create_context_robustness  The test is disabled on non-Windows as Linux drivers seem to not be able to kill an in-flight warp and the whole computer locks down.  BUG=angleproject:1463  Change-Id: Iea3dcb1df323aa1341a4d26fe291b6abfae2aa3a Reviewed-on: https://chromium-review.googlesource.com/374166 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Check multiplication validity in ParseContext  This improves separation of responsibilities in the code: ParseContext should handle operand type validation while TIntermBinary::promote should ideally only determine the type of the node based on the operation and operands.  BUG=angleproject:952 TEST=angle_unittests  Change-Id: I9a8d8ede21cdf35de631623a62194c0da5c604d2 Reviewed-on: https://chromium-review.googlesource.com/372622 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fence11: When busy looping on a fence test for device loss  Previously the code only checked is the device had already seen as lost but never updating the lost status. Since checking for device loss can be expensive only do it every 128 loop iterations.  BUG=angleproject:1463  Change-Id: Ib481aebbb73d0f279e7ef835ac3a96c0a4663d58 Reviewed-on: https://chromium-review.googlesource.com/365736 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Change angle_util to be a shared library"  This reverts commit 2f9b5e6f79cd576bd3b7110272d58f143801bf0f.  Change-Id: I90a7ba0596e79795c9549bc268eabff69c96d572 Reviewed-on: https://chromium-review.googlesource.com/376079 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Move load functions table to renderer layer.  We will be able to use it for the Vulkan formats table.  BUG=angleproject:1455  Change-Id: Iddc09fe560b06880af72a6fa8eb03fa2792e2f8c Reviewed-on: https://chromium-review.googlesource.com/367454 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Replace DXGI with ANGLE format in the load tables.  BUG=angleproject:1455  Change-Id: I851848d8a28bd70ff921d76b19902f40a5e8b17d Reviewed-on: https://chromium-review.googlesource.com/367453 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
dEQP: Use GL ES display factory on Android  BUG=angleproject:1471  Change-Id: I11964fa36fa75841512c49eda4cd5947d6197cda Reviewed-on: https://chromium-review.googlesource.com/368985 Commit-Queue: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Frank Henigman <fjhenigman@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add dEQP search paths on Android devices  Including: test expectations and list dEQP data and test results. Hardcode chromium_tests_root for now to avoid adding a new API to pass the path from test runner to ANGLE.  BUG=angleproject:1471  Change-Id: I654fa4727c436d743b3d6344ad17cb030934cde2 Reviewed-on: https://chromium-review.googlesource.com/368984 Commit-Queue: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Replace std::map with switch in load functions.  BUG=angleproject:1455  Change-Id: Ica74ea5503efc0315bc4d98aa322da523a30b24c Reviewed-on: https://chromium-review.googlesource.com/367696 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Change angle_util to be a shared library  So that there will be one instance of static thread synchronization variables in AndroidWindow. Previously there was one instance in lib_angle_deqp_gles2_tests__library and one in libangle_deqp_libgles2 resulting in AndroidWindow::initialize waiting forever.  BUG=angleproject:1471  Change-Id: Ia529c91e34960eb352730c1bb89a91ce6336c8a0 Reviewed-on: https://chromium-review.googlesource.com/368983 Commit-Queue: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Check for OpenGL ES support when creating context  Support for an OpenGL ES version can come either through OpenGL ES OpenGL core or available extensions. The context creation should fail if the requested OpenGL ES version is not supported.  BUG=angleproject:1477  TEST=angle_end2end_tests  Change-Id: I810d004a1bd62f75f162d775d3cf92c4283252a3 Reviewed-on: https://chromium-review.googlesource.com/374338 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Compile deqp_gles2 on Android  Add some missing functions modify preprocessor conditions and build files to include some other missing functions when building for Android.  BUG=angleproject:1471  Change-Id: Iadc0a0b9fed2444b8bc9a894ee65c8b66ea7f3c9 Reviewed-on: https://chromium-review.googlesource.com/368982 Commit-Queue: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Misc minor WinRT fixes and cleanups  Change-Id: Ibf041e74d81ef266791e6b6a3bb43bf504b035b3 Reviewed-on: https://chromium-review.googlesource.com/374040 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add Vulkan to in-progress section of the landing page.  Change-Id: Ib1f911d1a30921e4d74d405b77f930754a647d17 Reviewed-on: https://chromium-review.googlesource.com/374048 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove Windows 8.1 (Store apps) and Windows Phone 8.1 support  ANGLE has moved onto the Windows 10 SDK and is using new compiler features that aren't supported by the old Windows 8.1 toolchain. Support for the 8.1 projects has been broken in master for some time now.  Since more and more developers are moving towards Windows 10 we are going to take a snapshot of ANGLE that includes 8.1 support and freeze it in a branch on github.com/microsoft/angle. If developers wish to compile for use ANGLE in 8.1 apps then they should use that branch going forward.  Change-Id: Ifee2d8a8cc0332500e0bd338911d831e7624fa82 Reviewed-on: https://chromium-review.googlesource.com/374039 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove DXGI_FORMAT_UNKNOWN cases from load table.  These cases were unreachable.  BUG=angleproject:1455  Change-Id: I5f3b969de3aca3862944ac9ed510c9f5e9fd77e2 Reviewed-on: https://chromium-review.googlesource.com/367695 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Simplify load functions table.  The indexing of the table data was mismatched with the table causing confusion with no appreciable gain. Fix this reducing the lines in the script and table at the same time.  BUG=angleproject:1455  Change-Id: I59095ba11a416575fd2310765eaac8d368b90cab Reviewed-on: https://chromium-review.googlesource.com/367694 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Check if conversion needed from load function.  The 'LoadToNative' copy is the only one that should be considered a non-conversion. For depth formats we should be clamping on SetData and CopyImage calls so this changes the flags for two of the depth formats but won't affect behaviour since the conversion bit is never check for depth/stencil formats.  This allows us to remove the 'requiresConversion' bit from the data.  BUG=angleproject:1455  Change-Id: I739ecc54406d65049caad7851ffd51d7cb777946 Reviewed-on: https://chromium-review.googlesource.com/367693 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move default ANGLE format map to shared location.  This default format mapping serves as a base for a Renderer format mapping. Any formats that require emulation or other representation in a Renderer can be overridden in the renderer layer.  BUG=angleproject:1455  Change-Id: I47f070c2ea132bada9cc0fc4353b89b74b8ee8f3 Reviewed-on: https://chromium-review.googlesource.com/367692 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Clean up buffer calls a bit.  BUG=None  Change-Id: I3b697c3b721b5be4888d039a5cefd160ab5b23f8 Reviewed-on: https://chromium-review.googlesource.com/367877 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add unittests to verify invariant doesn't leak  This is a followup CL of https://chromium-review.googlesource.com/366720. Unittests is added to check invariant status does not leak across shaders.  This CL also moves mInvariantVaryings and mGlobalInvariant from TSymbolTable to TSymbolTableLevel. So at the end of a compilation the levels pop and the settings will be cleared and will not affect the next compilation.  Change-Id: I1199fade7a637276ab149ab9a599621b9977298b Reviewed-on: https://chromium-review.googlesource.com/370844 Commit-Queue: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Refactor binary node creation  1. Simplify code by using asserts instead of adding internal errors to log.  2. Add a TIntermBinary constructor that takes left and right operand nodes as parameters.  3. Remove TIntermediate functions with trivial functionality.  BUG=angleproject:952 TEST=angle_unittests  Change-Id: I2e0e52160c9377d8efcf15f14fd59f01cb41bd83 Reviewed-on: https://chromium-review.googlesource.com/372720 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add error and warning helpers to Diagnostics  This will make it easier to generate errors and warnings with a consistent format outside of ParseContext for example in TIntermBinary::fold() which warns about division by zero.  BUG=angleproject:952 TEST=angle_unittests  Change-Id: I25999d7bdc77efafe77785a0d6f4d63417dfaab9 Reviewed-on: https://chromium-review.googlesource.com/372719 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix struct compound assignment being allowed in GLSL parsing  The shader translator used to accept some invalid struct operations like struct += struct and struct == struct with a different type. Fix this.  BUG=angleproject:1476 TEST=angle_unittests  Change-Id: Ia2303fc1f740da4d78242e094ee6004b07364973 Reviewed-on: https://chromium-review.googlesource.com/372718 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Flatten "#pragma STDGL invariant(all)" into varying variables.  This is implemented as a compiler option which is enabled by default when outputting to desktop GLSL version 130 and greater which does not support this #pragma in fragment shaders. As a workaround and for better compatibility on desktop OpenGL drivers this pragma is also flattened into the outputs of vertex shaders and the inputs of ESSL 1.00 fragment shaders.  TEST=conformance/glsl/misc/shaders-with-invariance.html with --enable-unsafe-es3-apis BUG=629622 angleproject:1293  Change-Id: Ib040230915e639971505ed496d26e804c9d64e68 Reviewed-on: https://chromium-review.googlesource.com/361792 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Revert "Cover vector dynamic indexing case in SplitSequenceOperator"  This CL was causing inverted rendering in a WebGL application.  This reverts commit 7da9850643f55335a13a4663d226c73d0ac4d3b1.  Vectors or matrices that are dynamically indexed as a part of an l-value generate new statements in the RemoveDynamicIndexing AST transformation step. SplitSequenceOperator needs to detect this case and split the sequence operator before statements are generated from its operands to ensure the correct order of execution.  BUG=angleproject:1341 TEST=angle_end2end_tests  Change-Id: I854f8cce2d46107afa62f48edf3d32c6d5c97eda Reviewed-on: https://chromium-review.googlesource.com/371643 Reviewed-by: Kenneth Russell <kbr@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Improve integer pow workaround.  A slight bug in the problem case detection applied the workaround overly-broadly. Also included a much more thorough test.  BUG=angleproject:851  Change-Id: I5c09d67eee3622c144401769af85958f23b60c57 Reviewed-on: https://chromium-review.googlesource.com/371380 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Suppress two new AMD failures.  These failures were exposed with the new R7 240 card.  BUG=chromium:637037  Change-Id: I1fe5add2fc08d5c93e338250efb2af62712d0e53 Reviewed-on: https://chromium-review.googlesource.com/371318 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor: Return true when checks succeed in ParseContext  Instead of returning false when a check succeeds in ParseContext return true. This is more intuitive and in line with conventions used elsewhere inside ANGLE.  Also includes some minor other cleanup in ParseContext like improved variable names and code structure especially when checking array element properties. This will make introducing arrays of arrays easier in the future.  BUG=angleproject:911 TEST=angle_unittests  Change-Id: I68233c01ccfbfef9529341af588f615efc2b503a Reviewed-on: https://chromium-review.googlesource.com/371238 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Invariant qualifier should not leak across shaders  Change-Id: I2a35899bffd28767b8bc638f415857636d4ad8ef Reviewed-on: https://chromium-review.googlesource.com/366720 Commit-Queue: Kenneth Russell <kbr@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Emulate gl_FragColor broadcasting behavior when GL_EXT_draw_buffers is enabled.  BUG=angleproject:1467635433 TEST=WebGL conformance angle_unittests  Change-Id: I9eb4ce715732087a3786da886f42243716f2b9b2 Reviewed-on: https://chromium-review.googlesource.com/367532 Commit-Queue: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Clarify error checking function names in the GLSL parser  Most error checking functions in ParseContext used to follow a format like <property>ErrorCheck. Sometimes this function would check that the node/value would have <property> sometimes it would check that the node/value would not have it which was confusing. Change most of these functions to use a lot more descriptive names which clearly communicate what they are checking for.  Also includes a bit of refactoring in constructorErrorCheck() so that the function only checks for errors rather than also setting the type of the constructor node.  Also make TType::arraySize unsigned and return a sanitized size from checkIsValidArraySize() instead of using an output parameter.  BUG=angleproject:911 TEST=angle_unittests  Change-Id: Id9767b8c79594ad3f782f801ea68eb96df721a31 Reviewed-on: https://chromium-review.googlesource.com/367070 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
D3D11: Remove unsized formats from the table.  These cases weren't actually ever hit within ANGLE.  BUG=angleproject:1455  Change-Id: I60da3fb9eae91598ddaed5572a4bab0a66345694 Reviewed-on: https://chromium-review.googlesource.com/367691 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move fast copy functions into angle::Format.  These tables were duplicated in D3D11 and D3D9 and would have to be further duplicated into Vulkan.  BUG=angleproject:1455  Change-Id: Ice1b81417d7b14f933b61861c4a9997c260ef72e Reviewed-on: https://chromium-review.googlesource.com/367690 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Improvements on ETC1 to BC1 transcode.  ETC1 data doesn't need to be fully decoded before encoding to BC1. Saves ~50% computation.  BUG=angleproject:1285  Change-Id: I0cb479a08159ccd0472e5fdf40dd84323151883c Reviewed-on: https://chromium-review.googlesource.com/361553 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Rename ANGLEFormatSet to Format.  BUG=angleproject:1455  Change-Id: I896b3ed2d5e4ff3ad72de9a3a4b554841129e4e9 Reviewed-on: https://chromium-review.googlesource.com/367093 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Merge d3d11::TextureFormat and ANGLEFormatSet.  BUG=angleproject:1455  Change-Id: I7fc2640ec9d73528feb526b4d8b89cabccda4d17 Reviewed-on: https://chromium-review.googlesource.com/367092 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Partially squash D3D11 format types.  d3d11::TextureFormat and d3d11::FormatSet don't really do different things so it would be best to merge them.  BUG=angleproject:1455  Change-Id: I8c09ae763e4cb284bb611fed9d74b9048fb9f13e Reviewed-on: https://chromium-review.googlesource.com/367091 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update the homepage support table.  Mention our good ES 3.0 support. Also mention our multiplatform and Vulkan support.  BUG=None  Change-Id: Ib2a3f94b56ecf3a3b20b960b3270ebbc8948a628 Reviewed-on: https://chromium-review.googlesource.com/367755 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
D3D11: Move the swizzle format set into ANGLEFormatSet.  The only piece of data left in the d3d11::TextureFormat is the initializer function which could just as easily be in the ANGLEFormatSet.  BUG=angleproject:1455  Change-Id: Iee8eb84f71807575c2a46bf4fcbf283aa1b7f565 Reviewed-on: https://chromium-review.googlesource.com/367090 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Clean up PackPixels.  BUG=angleproject:1455  Change-Id: I263719cc77ff80580a551683d062e862dee1bdab Reviewed-on: https://chromium-review.googlesource.com/365826 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D9: Use angle::Format when possible.  This will unify the way we call into PackPixels and also cleans u the code. It required adding a few D3D9-specific formats to the table.  BUG=angleproject:1455  Change-Id: Ic8282f40f52cabdb2925e2bb305c26582284082d Reviewed-on: https://chromium-review.googlesource.com/365825 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Place format info in angle::Format.  Some bits of information like the copy functions and mipmap gen functions can be shared across back-ends in the angle::Format class.  Also name the info struct angle::Format and use an enum class angle::Format::ID to identify the particular format.  This patch introduces a new table generator for angle formats and updates the D3D11 generator accordingly.  BUG=angleproject:1455  Change-Id: I13b8b98822b1186c6a9e436dc232c18fef50980c Reviewed-on: https://chromium-review.googlesource.com/365824 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Introduce angle::Format enum.  This general enum can encapsulate different formats between GL/Vulkan/D3D9/D3D11/etc so we can use them in common routines like PackPixels. It also can help us get rid of the ANGLEX enums which we use to represent internal formats not present in GL.  It is currently used for Textures/Renderbuffers/Surfaces but can also be extended in the future to cover things like vertex formats. It mirrors something like a DXGI_FORMAT in D3D11 or VkFormat.  BUG=angleproject:1455  Change-Id: I467d7b36d8fc92bb45239d56b9243d06f4e29378 Reviewed-on: https://chromium-review.googlesource.com/365413 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove recover() from ParseContext  This call is a no-op. The shader parser is intended to almost always recover from errors so including it doesn't clarify the code either. It's simpler to remove it entirely.  BUG=angleproject:911 TEST=angle_unittests  Change-Id: I0feae097c2807c8e9559672e7a3d50a2fc4fbdea Reviewed-on: https://chromium-review.googlesource.com/367040 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add compute shader special variables  Support is added for the compute shader special variables given in OpenGL GLSL ES 3.1 Revision 4 7.1.3 Compute Shader Special Variables. Unit tests are added for legal and illegal usage of the special variables.  BUG=angleproject:1442  TEST=angle_unittests  Change-Id: Idb25811c15c4044c55c611c0e73ef26eb5b3e9d7 Reviewed-on: https://chromium-review.googlesource.com/366661 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add compute shader compilation support in the glsl compiler  Support is added for compute shader compilation. There is a small extension to the parser so that 'local_size_x = ' 'local_size_y = ' and 'local_size_z = ' are supported as layout qualifiers.  A few shader compilation tests are added and one which checks the AST whether the layout qualifiers are properly parsed.  BUG=angleproject:1442  TEST=angle_unittests TEST=angle_end2end_tests  Change-Id: I67283797d1cf13fa4ac47faa2a6e66d93a2db867 Reviewed-on: https://chromium-review.googlesource.com/362300 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
D3D11: Store more format info by-reference.  This CL stores the d3d11::TextureFormat by reference in the texture storage. Adding the internalFormat to the TextureFormat allows us to store a single ref instead of three per TextureStorage11.  Also store the format sets in a d3d11::TextureFormat by-ref instead of by-pointer making the code a bit cleaner.  BUG=angleproject:1455  Change-Id: I3c0e966d948c694435577d7d45dc0cd156480cdb Reviewed-on: https://chromium-review.googlesource.com/365412 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D: Check for error before createTextureStorageEGLImage.  Previously we were just dumping any unexpected errors here. Fix this by passing in the RT explicitly in the constructor although we still store the EGLImage pointer in case the RT changes.  BUG=angleproject:1455  Change-Id: Ie4d4a07c3a7b3a5ccc0a43c4e80bfc6ee43a676b Reviewed-on: https://chromium-review.googlesource.com/365411 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Move texture format code out of the python script.  It's better to maintain the code outside of a generator script. It gives easier formatting and updating.  BUG=angleproject:1455  Change-Id: I2b4383f1ed01545004de10024d03879201e2bf41 Reviewed-on: https://chromium-review.googlesource.com/365410 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
DisplayGLX: XSync before setting the error handler  This mirrors https://codereview.chromium.org/2206973002  BUG=628823  Change-Id: Ifd71d67df174cac3f90097c809fc91046699bed8 Reviewed-on: https://chromium-review.googlesource.com/366790 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: Merge FL10 and 9_3 ANGLE formats.  This will let us use ANGLE formats to describe a format layout rather than a Renderer-specific usage. This in turn will let us use ANGLE formats for other Renderers as a universal thing.  BUG=angleproject:1455  Change-Id: I56492cb809d4ef6ac4b962cb12affbc853bbdaa0 Reviewed-on: https://chromium-review.googlesource.com/365269 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
GN: Enable more MSVS warnings.  Some warnings were enabled only in standalone builds. Enabling them in the GN config will prevent standalone build breakage and also make some potentially harmful warnings more visible to non-Windows devs.  BUG=angleproject:1449  Change-Id: I11fe9bac957864d37af37b3860a22fcbd91946ac Reviewed-on: https://chromium-review.googlesource.com/360961 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix unused variable warnings.  BUG=angleproject:1442  Change-Id: I07b32d4c1f1a95f136bf922e78053e0de41c1633 Reviewed-on: https://chromium-review.googlesource.com/366083 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
dEQP: Add simple stats reporting to GTest runs.  BUG=None  Change-Id: Ia2b59916ebb0de5a09c1f039200d6c8885dd294c Reviewed-on: https://chromium-review.googlesource.com/365940 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Noop cleanups to Renderer11.h and Renderer9.h  BUG=  Change-Id: I1cdaa61fa00cc418b3c0b4d9e8270e780ff0d8a6 Reviewed-on: https://chromium-review.googlesource.com/365737 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add es3.1 shader constants  The patch adds all shader built-in constants.  BUG=angleproject:1442  TEST=angle_unittests TEST=angle_end2end_tests  Change-Id: I81cae479d6506a8faa2dce023d5fcc2c1291d521 Reviewed-on: https://chromium-review.googlesource.com/364460 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Simplify loop conditions so that they won't generate statements  Introduce an AST traverser that can move the evaluation of certain types of loop conditions and loop expressions inside the loop. This way subsequent AST transformations don't have to worry about cases where they have to insert new statements to implement a loop condition or expression.  This includes the revert of "Unfold short-circuiting operators in loop conditions correctly". The new traverser covers the loop cases that used to be handled in UnfoldShortCircuitToIf.  BUG=angleproject:1465 TEST=WebGL conformance tests      dEQP-GLES2.functional.shaders.*select_iteration_count*  Change-Id: I88e50e007e924d5884a217117690ac7fa2f96d38 Reviewed-on: https://chromium-review.googlesource.com/362570 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add ES3.1 API constants  The newly added capability constants are handled in the corresponding glGet functions. Also getBooleani_v has been added.  BUG=angleproject:1442  TEST=angle_deqp_gtest_gles31_tests --gtest_filter=*functional_state_query_integer_max_* TEST=angle_deqp_gtest_gles31_tests --gtest_filter=*state_query_indexed_max_compute_work_group_size* TEST=angle_unittests TEST=angle_end2end_tests  Change-Id: I846e006307563ae81d8b6c62cf261417e15186c7 Reviewed-on: https://chromium-review.googlesource.com/362270 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Remove angle_standalone from GYP files  BUG=angleproject:1462  Change-Id: Ifdd714e2bc1f0a184f63f8ef162facce5286e935 Reviewed-on: https://chromium-review.googlesource.com/365233 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement CHROMIUM_copy_texture for D3D11.  BUG=angleproject:1356  Change-Id: I70246762411dbeeb3e291e317854139a68d80070 Reviewed-on: https://chromium-review.googlesource.com/339434 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove ANGLE's isolate  BUG=angleproject:1462  Change-Id: I549692583bbf35edc4e383f8fb7e0dff17c28594 Reviewed-on: https://chromium-review.googlesource.com/365234 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Check for device loss on all applicable EGL entry-points  This will make applications aware of device loss on all EGL calls that need to have an initialized display. For that purpose we track the device loss state at the egl::Display level instead of always querying the implementation. This is correct because at device-loss at the display level is non-recoverable. It also deduplicates the tracking that would have to be done in all the EGL backends.  Changes made in this commit:  - Cached device loss in egl::Display  - Check isDeviceLost in ValidateDisplay  - Changed EGL entry-points testing isDeviceLost to explicitely request    a testDeviceLost  - Add calls to ValidateDisplay to entry-points missing it  - Removed unused virtual qualifiers for some robustness methods  BUG=angleproject:1463  Change-Id: I92bea81f2ecd5423c445cff31557a4d9783557d5 Reviewed-on: https://chromium-review.googlesource.com/365450 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: Remove X24G8 special format.  This special format means we're using a depth/stencil format with only the stencil channel being used. We can just use a normal D24S8 format here there's pretty much no difference.  BUG=angleproject:1455  Change-Id: Id304094b92814f38930209a703733190ad8e8410 Reviewed-on: https://chromium-review.googlesource.com/359086 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Remove 'non-renderable' texture formats.  The only difference between the NONRENDERABLE and normal versions of the formats is the rtvFormat is blank for non-renderable. The only place that I can see we check rtvFormat to make a decision is in TextureStorage11::GetTextureBindFlags. The rtvFormat here isn't necessary because we also check the 'renderTarget' flag which won't be true for compressed formats at any time.  BUG=angleproject:1455  Change-Id: Icbb438d336e67b80c44a0ab8de995a32b92e451e Reviewed-on: https://chromium-review.googlesource.com/359085 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Replace std::set with vector for signal receivers.  This should make insertion much faster which will improve the speed of many BindBuffer calls.  BUG=angleproject:1458  Change-Id: I3f7ebc02cc481257be8b84773506b9ac9e3be677 Reviewed-on: https://chromium-review.googlesource.com/364221 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Store ANGLEFormatSets instead of ANGLEFormats.  This saves us looking up the FormatSet repeatedly.  BUG=angleproject:1455  Change-Id: I77890c1eb427e7d087ceaf194a5001b8b03585d4 Reviewed-on: https://chromium-review.googlesource.com/359084 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ShCheckVariablesWithinPackingLimits: remove deprecated overload  BUG=621031  Change-Id: Ib4cdd88ecd58f617813a91379a8b8b518fba149b Reviewed-on: https://chromium-review.googlesource.com/364910 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix integer pow workaround for nested pows.  For some nested pow expressions queueing two node replacements in the same tree traversal would mangle tree resulting in invalid code. Fix this by iterating over the tree until no replacements are found and doing one replacement each iteration.  BUG=angleproject:851  Change-Id: Ie08ab23f4bfe3d5f32726856afc61ff1f3d6c789 Reviewed-on: https://chromium-review.googlesource.com/365400 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a workaround for NVIDIA drivers with repeated transform feedback.  BUG=angleproject:1298  Change-Id: Ibfbad8eb8ec824e377d8c1746a6691d6b689f498 Reviewed-on: https://chromium-review.googlesource.com/362601 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add ES31 entry points as function stubs  Entry points were generated using scripts which take the new function declarations from gl31.h find the newly added functions and output the new function declarations and defitions.  BUG=angleproject:1442 TEST=angle_unittests  Change-Id: I2d77eb4cc24873a31cb2745b7b82bf611d5058c6 Reviewed-on: https://chromium-review.googlesource.com/361291 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
translator: Refactor node replacement APIs.  BUG=angleproject:851  Change-Id: I50c3b3a4f00b27fed85f09509738513a441c7b5b Reviewed-on: https://chromium-review.googlesource.com/363990 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Get driver version from DXGI adapter.  This is a simpler and more portable design. Thanks for Austin from MS.  BUG=angleproject:1452  Change-Id: I93e8f3fc61107f13c4b2c1cf7fbaf2bb7ccdfafb Reviewed-on: https://chromium-review.googlesource.com/363041 Reviewed-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Put chromium path rendering entry points into the extern C block  Entry points were outside of the extern C block.  Change-Id: Ifbd159c59b850a90f728db9027c485661aa96bc8 Reviewed-on: https://chromium-review.googlesource.com/361720 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
D3D11: Allow gl_PointCoord when not rendering points.  ANGLE D3D11 uses a geometry shader to expand points into quads. This led to an edge case with gl_PointCoord. When the user references gl_PointCoord in the fragment shader but renders with GL_TRIANGLES or other non-point primitives gl_PointCoord is undefined but ANGLE would produce a link error. This would break some very odd edge-case shaders (e.g. a shader that is used with both points and triangles).  We can fix this by simply adding a dummy PointCoord value to our vertex shader is all cases. If the user renders points we ignore the PointCoord value passed to the geometry shader. If they render tris or lines and use PointCoord the shader signatures will match and PointCoord will even have a sane value of (0.5 0.5).  BUG=angleproject:1380  Change-Id: I322155cd3801d0241cabc9bb639a5aaa502831b3 Reviewed-on: https://chromium-review.googlesource.com/362779 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
D3D11: Detect driver version for blit workaround.  Since the newer driver versions are required for WebGL 2 conformance we need a solution that can detect a driver version to know if we should apply the workaround.  Use a modified copy of Chrome's Windows GPU driver detection code. In the future we should extend this to a full module when we port the command buffer workarounds.  BUG=angleproject:1452  Change-Id: I783d5726454671cc22585a2bf990c071d539aa9f Reviewed-on: https://chromium-review.googlesource.com/361962 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D: Work around HLSL integer pow folding bug.  BUG=angleproject:851  Change-Id: I68a47b8343a29e42c0a69ca3f2a6cb5054d03782 Reviewed-on: https://chromium-review.googlesource.com/362775 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix another missing viewport set.  This one was in a different blit function.  BUG=angleproject:1246  Change-Id: Ib571c10ddc30b3293f5c0d6bdb357b4cd3b52579 Reviewed-on: https://chromium-review.googlesource.com/362774 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
D3D11: Set viewport in Blit11::resolveStencil.  This introduced a flaky failure to the multisample resolve blit tests. They would work sometimes if the state had set the correct viewport previously so it wasn't always evident there was a bug.  BUG=angleproject:1246  Change-Id: If16d574fb87484fcdc9b7cc6ecc0531ee4a8959d Reviewed-on: https://chromium-review.googlesource.com/362699 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix output variable gl_FragData array size issue.  If the GL_EXT_draw_buffers extension isn't explicitly enabled in the shader then gl_FragData is an array of size 1 not of size max_draw_buffers.  BUG=angleproject:1441 TEST=webgl2_conformance with --use-gl=angle  Change-Id: I2ead1457462bf1f396fda1f47022df6b54612e17 Reviewed-on: https://chromium-review.googlesource.com/362781 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix standalone variable shadowing warning.  Introduced in https://chromium-review.googlesource.com/362641 Eventually we'll switch to using the same sets of warnings for standalone and GN ANGLE.  BUG=angleproject:1441  Change-Id: I6534b9f85b952ddf1d953342cf9c8ddc5de6614e Reviewed-on: https://chromium-review.googlesource.com/362780 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix CopyTexSubImage validation.  Now that we preserve the sized-ness information we can validate CopyTexSubImage and related methods correctly.  Fixed a lot of WebGL 2 tests when using ANGLE.  BUG=angleproject:1228  Change-Id: I959322c0a9bb16a2f16d60dce7cd1e63ca95b45a Reviewed-on: https://chromium-review.googlesource.com/362618 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add gl::Format to represent a texture/rb/surface format.  This has a few advantages: it preserves all the information of the internal format such as if it is sized or unsized. It also saves looking up the format multiple times in the table which should improve speed in some cases.  The extra sized-ness information will allow us to perform the correct validation in CopyTexSubImage calls.  BUG=angleproject:1228  Change-Id: I42954771b0a9a968f5d787b8cf6e0af721791855 Reviewed-on: https://chromium-review.googlesource.com/362626 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Handle initializing of struct typed output variable correctly.  BUG=angleproject:1441 TEST=webgl2 conformance  Change-Id: Idb27036347e1e814ba4603969cc2065e425ac4aa Reviewed-on: https://chromium-review.googlesource.com/362641 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Commit-Queue: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
HLSL: Insert return statements into functions that are missing them.  It's allowed to not have all code paths return a value in ESSL but the HLSL compiler detects this and generates an error.  Work around this by adding dummy return statements at the end of each function that doesn't have one.  TEST=deqp/data/gles2/shaders/functions.html  BUG=angleproject:1015 BUG=478572  Change-Id: I2913f90f0994d4caf25cc43b16b9fc4e9efb19a5 Reviewed-on: https://chromium-review.googlesource.com/362085 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add missing R16 formats to internal format mapping.  These were missing and are in the spec.  BUG=angleproject:1228  Change-Id: Ife9d311e76662d467d06b7aec4e674f9699b3573 Reviewed-on: https://chromium-review.googlesource.com/362624 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix wrong type for GL_STENCIL_INDEX8.  This was stored as DEPTH_STENCIL when it should be STENCIL.  BUG=angleproject:1228  Change-Id: I34c226a273cf962e83a040630bedbefa0f9ee382 Reviewed-on: https://chromium-review.googlesource.com/362623 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove manual include path setup for gtest and gmock  This should no longer needed after http://crrev.com/d805a40eb7b1ef6b  BUG=chromium:630299  Change-Id: I2f78a922d873cf1b5809b3454cb0b72267261b97 Reviewed-on: https://chromium-review.googlesource.com/362295 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
preprocessor: Fix negative shift with bad ids.  Fix this by producing an error on undefined or negative shifts.  BUG=629518  Change-Id: Idfca5ed3fc8e557f6178408f3426a5ef2ce7cf14 Reviewed-on: https://chromium-review.googlesource.com/362020 Reviewed-by: Antoine Labour <piman@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix member variable masking warning in standalone MSVS build  The patch for initializing output variables introduced a warning that broke MSVS 2015 standalone build. The "shaderType" variable passed to TCompiler::initializeOutputVariables was unnecessary and had the same name as a member variable of TCompiler that stores the shader type.  TEST=MSVS 2015 build  Change-Id: I9e01f5eae77a88babde21d4864a02c8731a220de Reviewed-on: https://chromium-review.googlesource.com/362550 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Initialize all output variables.  BUG=angleproject:1441 TEST=bots  Change-Id: Ia4cf415d8346c3234bf0f548a178ee3ea8cd35c4 Reviewed-on: https://chromium-review.googlesource.com/362110 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Skip the TransformFeedbackTest.BufferRebinding on Windows NVIDIA.  BUG=angleproject:1298  Change-Id: I32750d5d81c14fe5a17634586cddf117f0a4e692 Reviewed-on: https://chromium-review.googlesource.com/362157 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Cover vector dynamic indexing case in SplitSequenceOperator  Vectors or matrices that are dynamically indexed as a part of an l-value generate new statements in the RemoveDynamicIndexing AST transformation step. SplitSequenceOperator needs to detect this case and split the sequence operator before statements are generated from its operands to ensure the correct order of execution.  BUG=angleproject:1341 TEST=angle_end2end_tests  Change-Id: I84e41a59c88fb5d0111669cab60312b930531a22 Reviewed-on: https://chromium-review.googlesource.com/361695 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Split sequence operator when necessary  Split sequence operators if some of their operands generate statements in subsequent AST transformations to guarantee the right order of execution. For now this is supported for expressions that return arrays and unfolded short-circuiting operators which is enough to get WebGL 2 tests passing. A trickier corner case with dynamic indexing of vectors as an l-value is left to be addressed later.  BUG=angleproject:1341 TEST=angle_end2end_tests WebGL 2 conformance test:      conformance2/glsl3/array-in-complex-expression.html  Change-Id: I9301edd3366be7607a8aa4c42a5ec13928749e10 Reviewed-on: https://chromium-review.googlesource.com/361694 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix TearDown incorrect order in ReadPixelsTest  The ANGLETest::TearDown() call was set at the beginning of the function where as it should be at the end since it destroys the context. The earlier version would not cause any crashes because the GL function calls would be ignored.  BUG=angleproject:1445  TEST=angle_end2end_tests  Change-Id: I187cb8fede1db4ef2bfc13ab850594c41e00b0b0 Reviewed-on: https://chromium-review.googlesource.com/362220 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add IntermNodePatternMatcher helper class  This will enable sharing code between different AST traversers that apply transformations on similar node structures. This will make the code more maintainable.  For now the helper class is used in UnfoldShortCircuitToIf and SeparateExpressionsReturningArrays.  BUG=angleproject:1341 TEST=angle_end2end_tests WebGL 2 conformance tests  Change-Id: Ib1e0d5a84fd05bcca983b34f18d47c53e86dc227 Reviewed-on: https://chromium-review.googlesource.com/361693 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
D3D: Validate that all color attachments are unique.  The previous logic of only checking the currently enabled draw buffers was incorrect.  Also updated the logic to be more lenient and allow multiple slices or mips of the same texture.  BUG=483282  Change-Id: I0d406d1a9a96e48342baefbaf11e0c2ecc6d390c Reviewed-on: https://chromium-review.googlesource.com/361533 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix uninitialized variables in BlendMinMaxTest  BUG=angleproject:1443  Change-Id: I1ad2ecee3ffc81a4d1c128aa4de4437e3ee88e34 Reviewed-on: https://chromium-review.googlesource.com/360120 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Improve glCopyTexSubImage2D and glReadPixels validation  glCopyTexSubImage2d and glReadPixels should generate a GL_INVALID_OPERATION when GL_NONE is specified as a color buffer. There are two tests added which cover glCopyTexSubImage2D and glReadPixels.  BUG=angleproject:1445  TEST=angle_end2end_tests  Change-Id: I3ab1428aad7eee96ca2330909e2b6f765f539705 Reviewed-on: https://chromium-review.googlesource.com/360860 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add support for ES31 context creation  The dEQP test for context creation passes.  SH_WEBGL3_SPEC has been added but it should be considered whether we should keep it remove it or rename it. It was added so that there is a webgl mapping to es 310 shaders. Check Compiler.cpp. The bison file has been modified so that some tokens from es3 can be also used in es31 as well.  A separate macro ES3_1_ONLY is added so that some tokens are limited only for es 310 shaders.  BUG=angleproject:1442 TEST=angle_unittests  Change-Id: I2e5ca227c96046c30dc796ab934f3fda9c533eba Reviewed-on: https://chromium-review.googlesource.com/360300 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix windows clang build  Change-Id: I920e9be38c3dd63e00db111294f69c335c4e772d Reviewed-on: https://chromium-review.googlesource.com/361663 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix KHR_Debug segfault errors  Calls to functions ObjectLabel ObjectPtrLabel GetObjectLabel GetObjectPtrLabel were resulting into segfaults due to improper validation and parameter handling. It could be that the implementations of those functions were based on an earlier version of the KHR_Debug extension.  The patch fixes the segfault error and almost all failing dEQP 3.1 tests related to KHR_Debug. The failing tests were also relevant to older ES versions. There is still one failing test but that one fails since ES3.1 is not fully supported yet.  List of reasons for the segfault error and failing tests: - the segfault error was caused by strlen called on a null pointer - another segfault was caused by writing out the length to a null pointer - even if the buffer size for getObject(Ptr)Label is 0 still the length of the label can be returned. That was not handled.  BUG=angleproject:1446 TEST=angle_deqp_gtest_gles31_tests --gtest_filter=*functional_debug_object*  Change-Id: I4743be8e862f3620091061cd7abb206a426655ed Reviewed-on: https://chromium-review.googlesource.com/361300 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "Support EXT_blend_func_extended in the GLES2 context"  Test failures on Intel Release: https://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Release%20%28New%20Intel%29/builds/1163  Also Intel Debug: https://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Debug%20%28New%20Intel%29/builds/820  Also NVIDIA with a different config: https://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Release%20%28NVIDIA%20GeForce%20730%29/builds/1564  BUG=angleproject:1379  This reverts commit 7f539ea52e6bc493d8e025ed2c43e10f606f088b.  Change-Id: I2634ad2b3fcc31e1e5ffb3674b94cb0aed9fd773 Reviewed-on: https://chromium-review.googlesource.com/361840 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Force the flush through the GetData call in Renderer11::finish.  NVIDIA drivers sometimes go into infinite loops in this code jbauman@ speculated that these drivers may need to do the flush in the GetData call.  BUG=626849  Change-Id: I85408fbe7176242240862225e968f557bd7818cf Reviewed-on: https://chromium-review.googlesource.com/360130 Reviewed-by: John Bauman <jbauman@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Check for out-of-date swap chains during eglWait calls.  BUG=angleproject:1438  Change-Id: I9b8d0da30e41c133ee92685d00f5f0239c7b2574 Reviewed-on: https://chromium-review.googlesource.com/358490 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Support virtualized contexts and transform feedback in Renderer11.  Track buffer offets in the transform feedback object and dirty them when a buffer is bound.  This fixes problems when a buffer is rebound at the same offset and maintains tracking between context switches.  BUG=angleproject:1447 BUG=angleproject:1298  Change-Id: I2f890e3ad5edacab47f624a95a502615c86cc0c8 Reviewed-on: https://chromium-review.googlesource.com/360910 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
dEQP: Move the shadow texture failure expectations.  BUG=angleproject:1435 BUG=angleproject:1436  Change-Id: Idd11e29ad49cb488d3a8ecefd6aefc181b43d3fc Reviewed-on: https://chromium-review.googlesource.com/361558 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Implement multisample depth resolve.  This uses a pretty slow path with readback to the CPU. It should be possible to use SV_Depth in HLSL to resolve without a readback but that will be left for a future optimization.  Enables the WebGL 2 tests gles3/fbomultisample and fboinvalidate/sub.  BUG=angleproject:1246  Change-Id: Id67178b0f6374cf53e4e107428637546ecca4124 Reviewed-on: https://chromium-review.googlesource.com/359956 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix compilation errors on Android  TBR=ynovikov@chromium.org BUG=None  Change-Id: I3d90027eaa2479622d7ea80f5dc69d2578d5b1b3 Reviewed-on: https://chromium-review.googlesource.com/361548 Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: Implement multisampled stencil resolve.  This implements a fairly slow path with readback for stencil blits and depth/stencil resolve. In a subsequent patch I'll implement the depth blits.  BUG=angleproject:1246  Change-Id: I04151d1f49ca404d858172dff8286608eae29864 Reviewed-on: https://chromium-review.googlesource.com/359955 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ShCheckVariablesWithinPackingLimits add sh::ShaderVariable overload  This overload doesn't take a stripped down version of the variable information which makes it possible to handle varying structs correctly by flattening them as individual variables.  BUG=621031  Change-Id: I367629fce3d17dd7e1f876c5937eb37f3d97c7f4 Reviewed-on: https://chromium-review.googlesource.com/361460 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Support EXT_blend_func_extended in the GLES2 context  BUG=angleproject:1379  Change-Id: Ibda6e84c0a7f86e838247cd5c538ef956dd786fe Reviewed-on: https://chromium-review.googlesource.com/346410 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Sami Visnen <svaisanen@nvidia.com>, 23355681, 619, 169, 619
Re-land "GN: Enable chromium_code config instead."  Using "no_chromium_code" is a bit less strict but ANGLE should be able to handle slightly stricter warnings.  Re-land with fix for Clang build.  BUG=angleproject:1449  Change-Id: I8988287d630a6258f2f9ee90e7bfef5f2d5799cd Reviewed-on: https://chromium-review.googlesource.com/361331 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add win_clang to CQ trybots.  BUG=angleproject:1311  Change-Id: I5a9f381ef7e7e18b20919f791beb2be7f2ddd7a5 Reviewed-on: https://chromium-review.googlesource.com/361064 Reviewed-by: Andrii Shyshkalov <tandrii@chromium.org>, 23355681, 619, 169, 619
dEQP: Make RandomOrderExecutor produce less spam.  We can take out the test case duration output as it would only be useful for diagnosing unexpectedly slow tests. This will reduce the size of dEQP logs on the bots.  BUG=None  Change-Id: I591b2c564e89393ca6754140001f334c19a10b1a Reviewed-on: https://chromium-review.googlesource.com/361243 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "GN: Enable chromium_code config instead."  Seems to fail the Clang build:  ../../third_party/angle/src/libANGLE/renderer/d3d/d3d11/StateManager11.cpp(3560):  error: comparison of integers of different signs: 'UINT' (aka 'unsigned int') and 'int' [-Werror-Wsign-compare]             maxSrvMip          = (desc.Texture2D.MipLevels == -1) ? INT_MAX : maxSrvMip;                                   ~~~~~~~~~~~~~~~~~~~~~~~~ ^  ~~  BUG=angleproject:1449  This reverts commit aeb477fbe5fad337815560a0031815f0636471a1.  Change-Id: I01baaf082f282c9d80a9c17fd6ffc2b8911313b2 Reviewed-on: https://chromium-review.googlesource.com/361094 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Add support for pack parameters when packing to PBOs.  BUG=angleproject:1268 TEST=conformance2/reading/read-pixels-pack-parameters.html  Change-Id: Ia7d69bdabd94d146bc027e6a6d3bb619b1ada2e8 Reviewed-on: https://chromium-review.googlesource.com/360491 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
GN: Enable chromium_code config instead.  Using "no_chromium_code" is a bit less strict but ANGLE should be able to handle slightly stricter warnings.  BUG=angleproject:1449  Change-Id: Ifaf77201085dd70cf5ff628b1aa02de55c5e96ba Reviewed-on: https://chromium-review.googlesource.com/360940 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix debug standalone build warning on MSVS 2015  Fixes signed/unsigned mismatch due to missing type cast inside an assert.  BUG=angleproject:1382 TEST=standalone MSVS 2015 debug build  Change-Id: I1508b54a2608e9204ad582bde4bd62af6926c36e Reviewed-on: https://chromium-review.googlesource.com/360921 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
ParseContext: validate additional restriction for the ? and  operators  WebGL2 shaders have added restriction to improve portability for some OpenGL compilers that do not support arbitrary ternary and sequence operators. It disallows these operators for arrays structs containing arrays and the void type.  BUG=612066  Change-Id: Id11042051bce25a91e57deaa9591d4d813fed7aa Reviewed-on: https://chromium-review.googlesource.com/359949 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Forbid defined operator generated by macro expansion  After lengthy debate the GLES working group recommended that this should be an error in WebGL though old specs were not updated. Make ANGLE follow the WebGL spec and generate an error in this case.  This is a partial revert of the patch which added support for defined operator generated by macro expansion. The preprocessor unit tests added by the reverted commit are kept but their expectations are changed.  This breaks some dEQP tests that are not in line with the WebGL spec.  BUG=angleproject:1335 TEST=angle_unittests WebGL conformance tests  Change-Id: I7d8a1d42c61367197f2aed4ca4de9297cc48acfc Reviewed-on: https://chromium-review.googlesource.com/352471 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Reserve "defined" as a macro name  After lengthy debate the GLES working group recommended that this should be an error in WebGL though old specs were not updated. Make ANGLE follow the WebGL spec and generate an error in this case.  This breaks some dEQP tests which are not in line with the WebGL spec.  BUG=angleproject:1335 TEST=WebGL conformance tests  Change-Id: I93fc397094419ecbf6a1b5179631b72064149bd0 Reviewed-on: https://chromium-review.googlesource.com/352470 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Workaround interpolation qualifier mismatching  Centroid implies smooth when doing translation. But the Intel Mesa driver considers centroid and smooth are different interpolation qualifiers which makes shaders fail compilation.  This patch adds smooth at the front of centroid at translation step. And it makes linkage.varying.rules.differing_interpolation_2 test in WebGL 2.0 dEQP test pass.  BUG=621031 TEST=WebGL 2.0 deqp/data/gles3/shaders/linkage.html  Change-Id: I8f0944846b5244b21c526ae95a7ce37c1504efb7 Reviewed-on: https://chromium-review.googlesource.com/360638 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix type conversion warnings.  BUG=angleproject:1382  Change-Id: Idee8882a7d7576faaa08418d9d399d836cec8fa7 Reviewed-on: https://chromium-review.googlesource.com/360903 Commit-Queue: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
dEQP GLES3 test expectations reassign a bug.  BUG=angleproject:1448  Change-Id: I82346baa0989416cf0105e4446178a299f4f8ffb Reviewed-on: https://chromium-review.googlesource.com/360664 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix uninitialized stencil ref variables in the GL backend  BUG=angleproject:1443  Change-Id: I8c259368abdffb57c2963b29f81e2433a08ecae1 Reviewed-on: https://chromium-review.googlesource.com/360110 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Support CHROMIUM_path_rendering fragment operations  This brings two new APIs BindFragmentInputLocation and ProgramPathFragmentInputGen that together dictate how the fragment shader varyings are used.  BUG=angleproject:1382  Change-Id: I4b52fd8a3555235a73aecd4f3dba2d500789cbb0 Reviewed-on: https://chromium-review.googlesource.com/357071 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Sami Visnen <svaisanen@nvidia.com> Commit-Queue: Sami Visnen <svaisanen@nvidia.com>, 23355681, 619, 169, 619
Audit and amend style guide.  BUG=None  Change-Id: Idb6863c93f639dfe4770e67710159f3e398c5238 Reviewed-on: https://chromium-review.googlesource.com/360890 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refine swizzle/indexing constant folding code  Fix constant folding of subscripting non-square matrices. Previously constant folding would offset the pointer into the matrix in multiples of the number of columns when it should offset the pointer in multiples of the number of rows.  Also change the MalformedShaderTest so that it only succeeds if vector swizzle is being checked correctly. Previously compilation would fail in the test either way because the shader code contained a call to an undefined function.  Also refactor indexing checks and constant folding so that constant folding is done entirely separately from out-of-range checks. Bogus comments are removed from the constant folding functions.  BUG=angleproject:1444 TEST=angle_unittests angle_end2end_tests  Change-Id: I7073b38f759e9b3635ee05947df4f6d8e23a39d5 Reviewed-on: https://chromium-review.googlesource.com/360112 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Stop linking a static_initializer into the Mac chromium build.  The :angle-image_util target was a source_set rather than a static_library() causing us to link in loadimage.cpp which pulled in mathutils.cpp which contains a static initializer. Switching :angle_image_util to a static library (which is what GYP does) solved the problem.  R=rsesek@chromium.org cwallez@chromium.org BUG=628052  Change-Id: I63387b3fc9d799c92f7c1b49a1c7c7435e70a951 Reviewed-on: https://chromium-review.googlesource.com/360228 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Robert Sesek <rsesek@chromium.org> Reviewed-by: Dirk Pranke <dpranke@chromium.org>, 23355681, 619, 169, 619
Pause TransformFeedback before eglMakeCurrent.  On Android Adreno eglMakeCurrent resets TransformFeedback position. Workaround is to pause TransformFeedback before eglMakeCurrent and resume afterwards.  BUG=angleproject:1426 TEST=TransformFeedbackTest.MultiContext  Change-Id: I4fdb9edbd28b4b16c01d1a94419e78160b31b79f Reviewed-on: https://chromium-review.googlesource.com/355676 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Compute row pitch using the size of the input pixel not the format pixel.  For formats that can be loaded with data that has a different size pixel than the internal format (UNSIGNED_INT -> GL_DEPTH_COMPONENT_24) the row length would be computed as rowLength * 3 which is incorrect.  BUG=angleproject:1095  Change-Id: I0f60a3bb9bb387d475ddda1389a3b4b6f4973922 Reviewed-on: https://chromium-review.googlesource.com/360214 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Support precision emulation on HLSL  Re-submit with missing virtual destructor and angle::NonCopyable added.  Add precision emulation support to HLSL 4.1 output. This makes it possible for developers to test their shaders for precision issues easily on Chrome on Windows without having to use the GL backend. The patch has been verified with Chrome on Windows to reproduce some precision bugs in real-world WebGL content including old versions of the babylon.js library.  The EmulatePrecision AST transformation still relies on writing out raw shader code for the rounding functions with raw HLSL code added alongside pre-existing GLSL and ESSL code. In some ways it would be nicer to do the EmulatePrecision step as a pure AST transformation but on the other hand the raw code is much more readable and easier to optimize.  To better support multiple output languages in EmulatePrecision add a RoundingHelperWriter class that has different subclasses for writing the rounding functions in different languages.  The unit tests are expanded to cover the HLSL output of precision emulation. The parts of the tests that require the HLSL output are only active on Windows where ANGLE_ENABLE_HLSL define is added to the unit tests. Putting the HLSL tests in an entirely separate file is a worse alternative since it would require either a lot of code duplication or add a lot of boilerplate to the individual tests.  BUG=angleproject:1437 TEST=angle_unittests  Change-Id: I47d501037c206f4bd8b976d3acab9b21c717084c Reviewed-on: https://chromium-review.googlesource.com/360152 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add deqp gles 3.1 tests to the build files  BUG=angleproject:1442  Change-Id: I2ef27478573ec362bff57b532f7fee5731333b06 Reviewed-on: https://chromium-review.googlesource.com/360121 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Clamp float32 depth data when uploading.  BUG=angleproject:1095  Change-Id: I4c272aef0f94733fc7b5297ddaa1fa2bc765fe62 Reviewed-on: https://chromium-review.googlesource.com/360029 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
ShaderVars: add isSameInterfaceBlockFieldAtLinkTime  This will be used by Chromium to check for interface blocks mismatches.  BUG=621031  Change-Id: Ia6cc19e5d7b2a5c33af558d65b87885a6b72cea3 Reviewed-on: https://chromium-review.googlesource.com/359607 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Support precision emulation on HLSL"  Forgot to add virtual destructors.  BUG=angleproject:1437  This reverts commit a42e8b2cb9d0857f53c0490b5be3bf25b4e1f827.  Change-Id: If33fecfeca9947deedf4668c64dbadf25a5dc5eb Reviewed-on: https://chromium-review.googlesource.com/360122 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
TranslatorGLSL/ESSL: Output #pragma before #extension  The Intel Mesa driver considers the #pragma directive to be a non-preprocessor token which makes shaders fail compilation.  The relevant blurb from the spec is: "the extension directives must occur before any non-preprocessor tokens"  BUG=627417  Change-Id: Ic22cff49a9f9c1fe5d140302581ca7b36688732c Reviewed-on: https://chromium-review.googlesource.com/359621 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Support precision emulation on HLSL  Add precision emulation support to HLSL 4.1 output. This makes it possible for developers to test their shaders for precision issues easily on Chrome on Windows without having to use the GL backend. The patch has been verified with Chrome on Windows to reproduce some precision bugs in real-world WebGL content including old versions of the babylon.js library.  The EmulatePrecision AST transformation still relies on writing out raw shader code for the rounding functions with raw HLSL code added alongside pre-existing GLSL and ESSL code. In some ways it would be nicer to do the EmulatePrecision step as a pure AST transformation but on the other hand the raw code is much more readable and easier to optimize.  To better support multiple output languages in EmulatePrecision add a RoundingHelperWriter class that has different subclasses for writing the rounding functions in different languages.  The unit tests are expanded to cover the HLSL output of precision emulation. The parts of the tests that require the HLSL output are only active on Windows where ANGLE_ENABLE_HLSL define is added to the unit tests. Putting the HLSL tests in an entirely separate file is a worse alternative since it would require either a lot of code duplication or add a lot of boilerplate to the individual tests.  BUG=angleproject:1437 TEST=angle_unittests  Change-Id: Ia4ba0374cd415908f16f34752321af1cb93525a5 Reviewed-on: https://chromium-review.googlesource.com/358473 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Skip DXT1CompressedTextureTestES3.PBOCompressedTexImage when DXT1 not supported  Was failing on Nexus 5X Adreno which doesn't have GL_EXT_texture_compression_dxt1 extension. Also rename the tests to indicate they test DXT1 compression format.  BUG=angleproject:1424 TEST=DXT1CompressedTextureTestES3.PBOCompressedTexImage  Change-Id: Ic82363a6f497da12602f3f3a662a52ffa833aa0f Reviewed-on: https://chromium-review.googlesource.com/355711 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Clear SRV cache on keyed mutex texture unbind from TextureStorage11_External  This fixes the same issue as https://chromium-review.googlesource.com/328400 except with NV12 external storage textures. The SRV cache thinks the texture is still bound but releasing the keyed mutex has unbound it.  BUG=625900626524  Change-Id: I991cb3eeaaea0a1c4570b88de2ba873ae868ec2a Reviewed-on: https://chromium-review.googlesource.com/359430 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: John Bauman <jbauman@chromium.org>, 23355681, 619, 169, 619
Check ozone_platform_gbm before doing gbm stuff.  Just checking use_ozone fails when building an ozone platform which doesn't have gbm e.g. chromecast.  BUG=angleproject:1439 CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_chromium_gn_chromeos_rel;tryserver.chromium.android:android_compile_dbg  Change-Id: Idec14441ce30dd872b3bfddfe844abfeb910cc02 Reviewed-on: https://chromium-review.googlesource.com/358860 Reviewed-by: Luke Halliwell <halliwell@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
The global invariant pragma must not leak across compilations.  BUG=chromium:625363 TEST=conformance/glsl/bugs/global-invariant-does-not-leak-across-shaders.html  Change-Id: I66389352b92211f4d7967772f68470c8e93405bd Reviewed-on: https://chromium-review.googlesource.com/358515 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Support non-square matrices in precision emulation  In case the shader version is greater than ESSL 1.00 the precision emulation needs to output rounding functions for non-square matrix types.  Writing emulated compound assignment functions for non-square matrices already had most of the code in place before this change.  New compound assignment operators like >>= don't need floating point precision emulation in ESSL 3.00 since all of them only operate on integers.  BUG=angleproject:1434 TEST=angle_unittests  Change-Id: I4678f511edf4f9f744fe23bb8d7dab4387f07f20 Reviewed-on: https://chromium-review.googlesource.com/358472 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Clean up the SSE detection logic.  * Include the correct header right in the SSE check in platform.h. * Don't use separate SSE versions of the load functions have them use   SSE automatically.  BUG=612205  Change-Id: I70f9a5513e144db4d16c1f3ad922debeb6c50268 Reviewed-on: https://chromium-review.googlesource.com/358108 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Reuse code for determining built-in type name string  Add TType::getBuiltInTypeNameString() that returns an unique char pointer for each built-in type. They can be easily stored in an std::set as required by EmulatePrecision and the function can also be used in TOutputGLSLBase.  BUG=angleproject:1437 TEST=angle_unittests  Change-Id: I9acfe1b149546dedeae058841cbabf0d9829cdc9 Reviewed-on: https://chromium-review.googlesource.com/358471 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Use the Windows 10 SDK in standalone builds.  BUG=None  Change-Id: I52a9beeddfc83ee8711cc23979a97c79a4f22227 Reviewed-on: https://chromium-review.googlesource.com/358109 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Set correct type on nodes created in precision emulation  The correct type needs to be set so that HLSL output will be able to disambiguate user-defined function calls correctly based on argument types. HLSL output support will be added to precision emulation in a future patch which will also have tests that verify this patch.  The lack of correct type on the nodes is not known to cause any bugs in GLSL output.  BUG=angleproject:1437  Change-Id: I53200df066ece0ab4bd7d7a6aab699d6a1ecb659 Reviewed-on: https://chromium-review.googlesource.com/358470 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "The global invariant pragma must not leak across compilations."  This reverts commit ae2e19188cf0a9b035a27143f585df10e72ffabd.  Change-Id: I017ba4ba9baa633793d7bdd9691c580ed7016cde Reviewed-on: https://chromium-review.googlesource.com/358410 Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
The global invariant pragma must not leak across compilations.  BUG=chromium:625363 TEST=conformance/glsl/bugs/global-invariant-does-not-leak-across-shaders.html  Change-Id: Ie8d38e44837fc87bb4c94e76e779ad41e8b79957 Reviewed-on: https://chromium-review.googlesource.com/358203 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Refactor ANGLE's image manipulation code into a static library.  Allows for chromium to make use of some of the functionality.  BUG=612205  Change-Id: Ib4435ca44775a3a554b0fb3bd384bd4d31d7952d Reviewed-on: https://chromium-review.googlesource.com/351753 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Emulate the pack/unpack functions for unorms.  BUG=angleproject:1044  Change-Id: I2cfb792de43d3a6fddd750100c74f948948dc1f6 Reviewed-on: https://chromium-review.googlesource.com/287290 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update dEQP test expectations for fixed tests.  BUG=angleproject:1021 BUG=angleproject:1027 BUG=angleproject:1101 BUG=angleproject:1323  Change-Id: I52ce720de66373ea2174890097a6908307a7fa91 Reviewed-on: https://chromium-review.googlesource.com/358168 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Re-land "D3D11: Fix readback of BGRA-backed formats."  For some BGRA-backed formats (RGBA4 R5G6B5 RGB5A1) our ReadPixels implementation wasn't aware the BGRA format didn't exactly match the RGBA format. For these it would do the 'fast path' memcpy method when it should stop and do the slow pixel-by-pixel packing method.  Fixes conformance2/reading/read-pixels-from-fbo-test.html.  Reland: fix empty format info that was causing us to only see the first pixel in the FBO in a ReadPixels call. Also fix bugs in the unorm 16-bit format readback code and add ASSERTs to catch bugs in subsequent new formats.  BUG=angleproject:1407 BUG=chromium:616176  Change-Id: I9fd55b9e1dd6a306eb4db195d775c02a1eb1f93f Reviewed-on: https://chromium-review.googlesource.com/357132 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove the artificial uniform vector limitation in D3D11.  BUG=407309  Change-Id: Ic59bea88f0a4d7a6df9089238be0c79d654016e2 Reviewed-on: https://chromium-review.googlesource.com/269971 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
translator: Fix two bugs that trigger ASSERTs.  The first bug was a result of constant-folding a vector swizzle that was out-of-bounds. The second bug was a result of using a semicolon in a preprocessor define.  BUG=angleproject:1425  Change-Id: Id6643b1f3e3b13cc021bd721ef2572487fe3c8d3 Reviewed-on: https://chromium-review.googlesource.com/357864 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove qualifiers from empty struct declarations in output  Empty struct declarations with qualifiers are rejected by NVIDIA GL driver version 367.27. For example this kind of construct that is expected to be accepted by the WebGL conformance tests is rejected:  const struct a {     int i; };  Since qualifiers do not carry meaning unless a struct declaration has declarators they can be simply omitted from the translator output in this kind of cases to work around this driver issue.  New unit test is added to check that pruning empty declarations works correctly.  BUG=angleproject:1430 BUG=622492 TEST=WebGL conformance tests angle_unittests  Change-Id: Id83f83124ae597fcdfa15100d336c2c207d9449c Reviewed-on: https://chromium-review.googlesource.com/356362 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix warnings in PathRenderingTest.cpp.  Certain warnings are suppressed in Chromium but not standalone ANGLE. We should enable those warnings for ANGLE specifically in a follow-up CL.  BUG=angleproject:1382  Change-Id: I12491a61b0f349c5937a1e5d9985c8da1d76e0dc Reviewed-on: https://chromium-review.googlesource.com/358107 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Support instanced CHROMIUM_path_rendering  This implements instanced path rendering.  BUG=angleproject:1382  Change-Id: I4654251882975d707b22c7bb522af14ae34eb1a1 Reviewed-on: https://chromium-review.googlesource.com/355401 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Sami Visnen <svaisanen@nvidia.com>, 23355681, 619, 169, 619
Add a helper class for compiler string matching tests  The MatchOutputCodeTest class makes it easier to implement tests that do string matching on compiler output. Inheriting test classes set the compiler settings tests then call compile() with the shader string and can call foundInCode() to check if the output code contains a given string.  Various compiler unit tests that already did string matching are refactored to make use of this new helper class. Some tests now use SH_GLES3_SPEC instead of SH_GLES2_SPEC - this should not have a significant impact on test coverage.  Some compileTestShader function variants that are now unused can be removed from the code.  BUG=angleproject:1430 TEST=angle_unittests  Change-Id: I1fd3529d5a1c6ab192f95ace800cf162604e68e7 Reviewed-on: https://chromium-review.googlesource.com/357800 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix BeginQuery validation  ANY_SAMPLES_PASSED and ANY_SAMPLES_PASSED_CONSERVATIVE queries can not be active at the same time. The only place where the State::isQueryActive function is used is validating whether a BeginQuery call is correct so it can be changed to check for this.  BUG=angleproject:1101 TEST=dEQP-GLES3.functional.negative_api.fragment.begin_query  Change-Id: Idadf129c6a036570f6e28857bdb24ffc11eeebe8 Reviewed-on: https://chromium-review.googlesource.com/356363 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Skip Texture2DTestES3.UnpackSkipImages2D test on Adreno Android GLES  Due to a bug in Adreno glTexImage2D with GL_UNPACK_SKIP_IMAGES.  BUG=angleproject:1429 TEST=Texture2DTestES3.UnpackSkipImages2D  Change-Id: Iccb4cc968915a623f0aed099b81e759c6e4343f7 Reviewed-on: https://chromium-review.googlesource.com/356494 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Skip SamplerInStruct AsFunctionParameter tests on Adreno Android GLES  Due to Adreno bug in compiling struct function parameter in shader.  BUG=angleproject:1427 TEST=SamplerInStructAsFunctionParameterTest      SamplerInStructArrayAsFunctionParameterTest      SamplerInNestedStructAsFunctionParameterTest  Change-Id: I979312885f2047e78b61530c97703854a4be1586 Reviewed-on: https://chromium-review.googlesource.com/356125 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Add android_angle_rel_ng to ANGLE CQ  Swarmed Nexus 5X bot. Mirroring Android Release (Nexus 5X) from chromium.gpu.fyi  BUG=chromium:617848 chromium:534814  Change-Id: I773c6accd3b4023822ddb165556e3af11ff5c6b1 Reviewed-on: https://chromium-review.googlesource.com/356470 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Andrii Shyshkalov <tandrii@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
On Desktop GL require index-constant sampler array indexing  BUG=598924  Change-Id: If97dbaa782595997b815c70d14f079e0f0c3d82a Reviewed-on: https://chromium-review.googlesource.com/356710 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Update bug IDs for some shadow sampler failures.  BUG=angleproject:1436  Change-Id: I4f6c2eaf4bcb2f85fe31c0e0112c0a9651d4ad70 Reviewed-on: https://chromium-review.googlesource.com/357161 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update bug IDs for some shadow sampler failures.  BUG=angleproject:1435  Change-Id: I4964c84f76991c156dfe49c99dae873ab451c8ab Reviewed-on: https://chromium-review.googlesource.com/357151 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix validating non-square matrix compound multiplication  The validation previously checked that two matrices in compound multiplication are the exact same size which isn't correct for non-square matrices introduced in ESSL 3.00.  Instead check that the matrix multiplication is valid and that the resulting value has the same number of columns as the lvalue. The number of rows in the result is taken from the lvalue so it doesn't need to be checked.  BUG=angleproject:1431 TEST=angle_unittests  Change-Id: I6f32b7dc037d72c3c5cfdfffcda5d996e8450283 Reviewed-on: https://chromium-review.googlesource.com/356411 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Require libdrm only if use_ozone=1.  This is more accurate and doesn't break platforms with no pkgconfig e.g. Android.  BUG=angleproject:1297 CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_chromium_gn_chromeos_rel;tryserver.chromium.android:android_compile_dbg  Change-Id: Iafbd66a5e81467d2a5431c3bb1ddd26a837888e7 Reviewed-on: https://chromium-review.googlesource.com/356481 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Fix Image11::copyFromFramebuffer for emulated texture formats.  Simply using the ReadPixels code paths to unpack the framebuffer into a texture was insufficient for handling cases like LUMA or RGB textures that are emulated with RGBA textures in D3D11.  Instead read the framebuffer's data into a buffer and then use the loading functions which are aware of the emulated formats to write the data to the destionation.  Fix LUMA format structure's logic for reading colors.  They aren't supposed to do any averaging logic.  BUG=angleproject:1095 BUG=483282  Change-Id: Iad91d193d4c824573d9e9cafd28cf456d2de8be5 Reviewed-on: https://chromium-review.googlesource.com/354482 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
TextureD3D: No-op on zero-sized CompressedTexImage.  TEST=deqp/functional/gles3/negativetextureapi.html  BUG=483282  Change-Id: Ifd9674c2d29dc7e3a5e620b7a043cdb38a923ca0 Reviewed-on: https://chromium-review.googlesource.com/356680 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D11: Refactor depth/stencil blit code.  Blit11 refactorings enable re-using some code for multisample resolve blits. Also some Renderer11 refactorings to use TextureHelper11 make the code more flexible for the multisample resolve to come later.  BUG=angleproject:1246  Change-Id: Id0c168cef75b0f487cb3995a906f6473989edcd5 Reviewed-on: https://chromium-review.googlesource.com/354420 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't unpack un-referenced varyings in the pixel shader.  Transform feedback varyings that were optimized out were still being unpacked causing HLSL compilation failures.  This was triggering failures in the conformance2/state/gl-object-get-calls.html test.  BUG=angleproject:1422  Change-Id: I297cccd5b99435dfb69a3c2b0fd3086b6ddf0b3a Reviewed-on: https://chromium-review.googlesource.com/354590 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
FramebufferD3D: Only make sure that enabled attachments are not the same.  It's acceptable to have the same object attached to muliple framebuffer attachments if they are not being drawn to.  This was triggering failures in the conformance2/state/gl-object-get-calls.html test.  BUG=483282  Change-Id: If088ccd9b1189f060dfa33ebbe4d82f1f47559b0 Reviewed-on: https://chromium-review.googlesource.com/354570 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Skip GLSLTest_ES3.InitGlobalArrayWithArrayIndexing on Adreno Android GLES  Due to Adreno compilation failure of two arrays in single line declaration.  BUG=angleproject:1428 TEST=GLSLTest_ES3.InitGlobalArrayWithArrayIndexing  Change-Id: I05d7c6b3a0eef8c879edf4d9cf24cdec0a2a403c Reviewed-on: https://chromium-review.googlesource.com/356217 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Make bucket names explicit in cq.cfg.  Don't assume bucket name to start with 'master.'.  NOTRY=True BUG=chromium:617627  Change-Id: I4e634fd2f485ac06c8e06af2de0cd86dbf425e9b Reviewed-on: https://chromium-review.googlesource.com/355990 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add ozone display gn build.  Pick up ozone source when use_ozone = true. Don't link X11 unless use_x11 = true.  BUG=angleproject:1297 CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_chromium_gn_chromeos_rel  Change-Id: I94e6242189646c8a18b00436294bccdd4c5a8785 Reviewed-on: https://chromium-review.googlesource.com/352251 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Fix rounding problem for SwapChainPanel size.  BUG=angleproject:1421  Change-Id: I08f0fa5f178c8d25cd2b02e75cf92759254aa918 Reviewed-on: https://chromium-review.googlesource.com/355020 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Skip Texture2DTestES3.TextureLuminance16ImplicitAlpha1 on Adreno Android GLES  Due to Adreno bug in GL_HALF_FLOAT support  BUG=angleproject:1420 TEST=Texture2DTestES3.TextureLuminance16ImplicitAlpha1  Change-Id: Id9bc12da21048a557325f076202ec482675320e3 Reviewed-on: https://chromium-review.googlesource.com/354782 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Cast display for eglGetPlatformDisplayEXT().  Cast the second parameter of eglGetPlatformDisplayEXT() to the correct type to stop compiler complaining.  BUG=angleproject:1297  Change-Id: I37260edbd0fb6b92c24b556b15ea8206295e12d4 Reviewed-on: https://chromium-review.googlesource.com/354740 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Ozone null pointer checks.  Check for null pointers so DisplayOzone::terminate() doesn't crash when DisplayOzone::initialize() wasn't completely successful.  BUG=angleproject:1419  Change-Id: I70e994490a7282083d5289e6c35b077676688b65 Reviewed-on: https://chromium-review.googlesource.com/354700 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
translator: Fix use-after-free with DepthRange.  Because this builtin uses a structure certain shaders could trigger the mangled name to be allocated during normal shader compilation. Then when the scope is popped the mangled name for DepthRange is freed and we're left with a dangling pointer.  Fix this temporarily by enforcing mangled name construction when we initialize the builtins but we should look for a more robust and future-proof fix.  BUG=620937  Change-Id: If130c8b48a18054502abaec08f10264f282b4925 Reviewed-on: https://chromium-review.googlesource.com/354494 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Antoine Labour <piman@google.com> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Include what you use  mbstowcs needs stdlib.h header on mipsel  BUG=  Change-Id: Ia93d0a877b2e22d5c1c461f0dea9999ede725520 Reviewed-on: https://chromium-review.googlesource.com/354020 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "use_ozone=1 for ANGLE CQ."  This reverts commit 13511a9ccd1ec35a4ddd17fa44f590125bbe0c95.  Change-Id: Ic5a91d14b59204c5667940797742bc55a137f177 Reviewed-on: https://chromium-review.googlesource.com/354706 Reviewed-by: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
use_ozone=1 for ANGLE CQ.  Add tryserver.chromium.linux:linux_chromium_gn_chromeos_rel to ANGLE CQ to build test with use_ozone=1.  BUG=angleproject:1412  Change-Id: Ib4e851b95f7cfbb7099b531affccd14f08418725 Reviewed-on: https://chromium-review.googlesource.com/352318 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Andrii Shyshkalov <tandrii@chromium.org>, 23355681, 619, 169, 619
[Mac/GN] Properly set the install_name and rpath for shared_library targets and their consumers.  BUG=621932 R=cwallez@chromium.org  Change-Id: I10b0fd5a668d74b7062747002bc48ef0e0a6df9c Reviewed-on: https://chromium-review.googlesource.com/354302 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add dEQP suppressions for two failing tests.  BUG=angleproject:1418 BUG=angleproject:1340  Change-Id: I8930845a2d398440a78b2569daaf655b51a30ee9 Reviewed-on: https://chromium-review.googlesource.com/354261 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix suppression for Intel.  BUG=None  Change-Id: I3e2e7e845e9ad3814f7d85e56c12023a5e2ef0df Reviewed-on: https://chromium-review.googlesource.com/354104 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix warning about unused local variable.  BUG=angleproject:1382  Change-Id: I63925fb7eeff2bdab26c1e541afd9cd1851485e6 Reviewed-on: https://chromium-review.googlesource.com/354083 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Roll dEQP cc0ded6c77267b..cd361df193e7535b9  https://android.googlesource.com/platform/external/deqp/+log/cc0ded6c77267b..f4f3d8079e7a37d7  BUG=None  Change-Id: I863f81d2c4c3f48862cb821b23c38266987a82a2 Reviewed-on: https://chromium-review.googlesource.com/340260 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't emit shader_texture_lod and draw_buffers extensions in core profile shader.  BUG=angleproject:1416 TEST=conformance/extention/ in core profile R=jmadill@chromium.orggeofflang@chromium.orgcwallez@chromium.org  Change-Id: I89b815929535586a2e90489129a1c6692bb87b3c Reviewed-on: https://chromium-review.googlesource.com/353820 Tryjob-Request: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org> Commit-Queue: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix incorrect PathParameter overload being called.  BUG=angleproject:1382  Change-Id: I9fd6e20b9487f9d7817865bc9129a60fc833d0ca Reviewed-on: https://chromium-review.googlesource.com/354030 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix float-to-int conversion warnings in the path rendering tests.  BUG=angleproject:1382  Change-Id: I586cd4a03d06a6ec87b6a57342b7f8d0ed0d9cd8 Reviewed-on: https://chromium-review.googlesource.com/354031 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update the dEQP test expectations  BUG=angleproject:1092 BUG=angleproject:1095 BUG=angleproject:1323  Change-Id: I58550f841febbfdf45133707f72e7f3a62b20a1c Reviewed-on: https://chromium-review.googlesource.com/353343 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Suppress a Wintel/OpenGL failure on a new test.  BUG=angleproject:1388  Change-Id: I4d346ca3c6914e56055aa6492d9d013634a1b9ad Reviewed-on: https://chromium-review.googlesource.com/353693 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Support CHROMIUM_path_rendering  This is partial support for CHROMIUM_path_rendering and implements basic path management and non-instanced rendering.  BUG=angleproject:1382  Change-Id: I9c0e88183e0a915d522889323933439d25b45b5f Reviewed-on: https://chromium-review.googlesource.com/348630 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Added Sami Visnen (Nvidia) to CONTRIBUTORS  Change-Id: I791fd7c4e145c37d0173e23cf57f937f802c26ea Reviewed-on: https://chromium-review.googlesource.com/353701 Reviewed-by: Sami Visnen <svaisanen@nvidia.com> Commit-Queue: Sami Visnen <svaisanen@nvidia.com>, 23355681, 619, 169, 619
Skip ReadPixelsPBOTest.SubDataOffsetPreservesContents on Adreno Android GLES  Due to either Adreno bug in glBufferSubData or generic Android bug in ANativeWindow_setBuffersGeometry.  BUG=angleproject:1415 TEST=ReadPixelsPBOTest.SubDataOffsetPreservesContents  Change-Id: If55f6ad4eacde98cfdbc46a61cc9fb479b779297 Reviewed-on: https://chromium-review.googlesource.com/353396 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Skip ReadPixelsTest.OutOfBounds on Adreno Android GLES  Due to Adreno bug in glReadPixels  BUG=angleproject:1413 TEST=ReadPixelsTest.OutOfBounds  Change-Id: I2fd426bc6d21f5d9604ca32ad34dd8841cbb9a3e Reviewed-on: https://chromium-review.googlesource.com/353363 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
translator: Fix builtin function emulator use-after-free.  We were calling the global pool allocator in the builtin function emulator which would lead to us freeing TTypes that were still referenced. Fix this by using the TCache which was designed for such a purpose and locking the allocator around the builtin function emulator to try and prevent similar bugs from creeping in.  Eventually we would like to get rid of the global allocator and replace it with different pools in different contexts which are managed more safely.  BUG=620937  Change-Id: If501ff6ea4d9bf8a2b8f89f2c94a01386f79ee3a Reviewed-on: https://chromium-review.googlesource.com/353671 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Set GERRIT_SQUASH_UPLOADS to False.  ANGLE uses a workflow where we upload stacks of dependent patches to Gerrit. The Chromium workflow has squashed by default for a long time so the infra team is planning to switch to squash by default. This change will preserve our workflow.  See http://crbug.com/611892  BUG=None  Change-Id: I62ab7a26d5bd899fbb8c48a1aced7d044640a66a Reviewed-on: https://chromium-review.googlesource.com/353039 Reviewed-by: Andrii Shyshkalov <tandrii@chromium.org>, 23355681, 619, 169, 619
Cache Framebuffer completeness.  Improves performance on the render-to-texture microbenchmark by ~3x on the OpenGL back-end. Wipes out several of the top profling hotspots on that benchmark.  BUG=angleproject:1388  Change-Id: I6a35a0b435b2ed3c83d32acdb9df090df98214ad Reviewed-on: https://chromium-review.googlesource.com/348957 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "D3D11: Fix readback of BGRA-backed formats."  This reverts commit 230d95616d1309914a6703e27a797a440806dd02.  This broke GLES2ConformTest.GL2Tests_framebuffer_objects_input_run on the NVIDIA Win8 Chromium bots.  BUG=chromium:620908  Change-Id: Idf6e3eb51483ff0b6bc758b95c5910863ddfc25f Reviewed-on: https://chromium-review.googlesource.com/353394 Reviewed-by: John Bauman <jbauman@chromium.org> Commit-Queue: John Bauman <jbauman@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Varying invariance must match between shaders in ESSL 1.00  While in ESSL 3.00 invariant is allowed only for out varyings. Verify that and update test expectations.  BUG=angleproject:1293 TEST=GLSLTest*.Invariant*  Change-Id: I5cab6c68f2b94ea2179719119668d905fe7a9b3d Reviewed-on: https://chromium-review.googlesource.com/352743 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Shader versions must match.  Per GLSL_ES_Specification_3.00.4 paragraph 3.3 Version Declaration: "Shaders declaring version 3.00 of the shading language cannot be linked with shaders declaring version 1.00."  BUG=angleproject:1361 TEST=GLSLTest_ES3.VersionMismatch  Change-Id: Icee672b798dcdb41a189e4a6459c4e643daf1fa6 Reviewed-on: https://chromium-review.googlesource.com/353182 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix readback of BGRA-backed formats.  For some BGRA-backed formats (RGBA4 R5G6B5 RGB5A1) our ReadPixels implementation wasn't aware the BGRA format didn't exactly match the RGBA format. For these it would do the 'fast path' memcpy method when it should stop and do the slow pixel-by-pixel packing method.  BUG=angleproject:1407 BUG=chromium:616176  Change-Id: Ie24758513af6f9ef87f0aa503135456c96493701 Reviewed-on: https://chromium-review.googlesource.com/352252 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
perf_tests: Work around stalls in gl_null test teardown.  The Clear command in the draw call benchmark was not being properly no-op'ed. This would cause the driver to get a huge queue of GL command which it would only flush when the test was torn down. This manifested as a 5+ second stall on test teardown.  Looking at the clear command it does some work with binding and then calling GL functions so properly filtering out the driver commands would be a bit more complicated. For now we can hack in a workaround for the draw call test (the only one that uses the GL NULL renderer at the moment) to not call clear when it would give us problems.  BUG=620687  Change-Id: I64a2ed1883e8d3bf0d4c423c8bce0902ae9bf8df Reviewed-on: https://chromium-review.googlesource.com/352828 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix unpacking overlapping unpack buffer rows on NVIDIA GL  When unpack parameters are set so that rows being read overlap in the unpack buffer stored in GPU memory NVIDIA GL driver may not upload the last pixels of the last one or more rows of a texture. The driver may also crash when the amount of overlap is high.  This issue affects both TexImage* and TexSubImage* calls.  Work around the issue by uploading textures row by row when the rows being read overlap in the unpack buffer. The workaround could possibly be optimized by uploading several of the first rows with a single call in some cases where the amount of overlap is low but this is expected to be a rarely used corner case so the added complexity that the optimization would create seems like a bad tradeoff.  The issue does not seem to be triggered when the layers (images) of a 3D texture overlap as long as the rows inside the images don't.  The workaround has been ported from Chromium.  This patch adds setting dirty bits when unpack state is set in StateManagerGL.  The included test case also reveals some issue in the D3D backend but this is left to be addressed later.  BUG=angleproject:1376 TEST=angle_end2end_tests  Change-Id: I7dbe73ebb70bbbc284fa92381546f4f2f832d333 Reviewed-on: https://chromium-review.googlesource.com/346430 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
D3D11: Prevent DXGI hooking the Alt+Enter keystroke  When ANGLE is using D3D11 and not using DirectComposition DXGI will hook the window's message loop and override Alt+Enter to trigger a transition to exclusive fullscreen mode. This disables that behaviour since it's inconsistent between backends and at least during my testing the application did not even work correctly after the transition to fullscreen mode.  This commit should be similar to the workarounds implemented in Qt and mpv to prevent this behaviour and will hopefully make those workarounds unnecessary. Only the DXGI_MWA_NO_ALT_ENTER flag is used since the other flags didn't seem to have an effect and probably only matter in fullscreen mode.  BUG=angleproject:1414  Change-Id: Icb70c2c1405225619dcb27c5ffc9472fddd1157b Reviewed-on: https://chromium-review.googlesource.com/352950 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Validate that unpack skip is in bounds  Unpack skip needs to be taken into account when determining which part of the unpack buffer is read. This is now done in the out-of-bounds check when validating texture upload calls.  Unpack skip code is removed from D3D9 backend since skip is not supported in GLES2.  BUG=angleproject:1411 TEST=angle_end2end_tests  Change-Id: I0db4db0877a352613c57e2820e5b650edb5a73ab Reviewed-on: https://chromium-review.googlesource.com/352450 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Don't allow returning a struct containing an array in ESSL 1.00  ESSL 1.00.17 section 6.1 forbids this. Returning arrays was already covered by the checks that disallow declaring array types in ESSL 1.00.  BUG=angleproject:1015 TEST=dEQP-GLES2.functional.shaders.functions.* (2 new tests pass)      dEQP-GLES3.functional.shaders.functions.* (no regression)  Change-Id: Iaffa1631c0c940afb57819221e7e8603b2305021 Reviewed-on: https://chromium-review.googlesource.com/352920 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Make Framebuffer::checkStatus non-const.  BUG=angleproject:1388  Change-Id: Ia9befba0c915c087f2fe0557d91060256f6d4950 Reviewed-on: https://chromium-review.googlesource.com/348955 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix uploading RGB10A2 data to RGB5A1 textures.  WebGL test: textures/misc/tex-new-formats  BUG=angleproject:1407 BUG=chromium:616176  Change-Id: I7b557587c1ea0861bcac327a370480b36f679794 Reviewed-on: https://chromium-review.googlesource.com/351170 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix loading of RGB5A1 data from RGBA8.  BUG=angleproject:1407 BUG=chromium:616176  Change-Id: I2b88616b6b72dd9caf07fac8ebba9a065cf2983f Reviewed-on: https://chromium-review.googlesource.com/350907 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix loading of RGBA8 data to RGB565.  BUG=angleproject:1407 BUG=chromium:616176  Change-Id: I663d265abfabb88a5aca8ca0002d2cbc29f6b069 Reviewed-on: https://chromium-review.googlesource.com/350906 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix native EGL library loading on Android.  Takes care of non-component Clank build and 64 bit.  BUG=angleproject:1362 TEST=angle_end2end_tests  Change-Id: Ib338734960c6ac378ae49028ae30416bff31ac2a Reviewed-on: https://chromium-review.googlesource.com/352710 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix loading of RGBA4 textures for ubyte.  BUG=angleproject:1407 BUG=chromium:616176  Change-Id: Ibb7c5e71b4cf8afe7b7d0092e7d019b87d507ba6 Reviewed-on: https://chromium-review.googlesource.com/350905 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a perf test for render-to-texture.  This perf test focuses on the hotspot we have in Framebuffer:: checkStatus. It's exactly the same as the standard draw call benchmark but binds a Framebuffer before rendering.  BUG=angleproject:1388  Change-Id: Icc7a99e399f469d765bf1ac6abe0562977b9a39d Reviewed-on: https://chromium-review.googlesource.com/348956 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Clean up parsing function headers  Move function header parsing code to ParseContext instead of having it in the grammar file. This commit is pure refactoring. This code needs to be changed later to detect returning arrays containing structs.  This commit also disables clang format for glslang.cpp generated by bison.  TEST=angle_unittests BUG=angleproject:1015  Change-Id: If60848ca32da6b98ea8bcd95bba8c3f831634b51 Reviewed-on: https://chromium-review.googlesource.com/352480 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add RAII helpers for GL tests.  These methods can obviate the need for glGen/Delete calls in tests.  BUG=angleproject:1407  Change-Id: Ied571e48db92bd1d4f4089d91a95e7c7fafcfcaf Reviewed-on: https://chromium-review.googlesource.com/350904 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Context: Remove mutable gl::State getter.  This will preserve layering - the API layer doesn't mutate the state directly it passes the API call through to the Context. Is also removes the possiblity of any shenanigans of the Validation layer changing the GL state.  Also this CL refactors a few validation entry points to take ValidationContext instead of Context. ValidationContext will be the correct way to interact with the gl::Context in the Validation code.  Finally additional refactorings make ContextState a proper class with private data. This allows the ContextState itself to keep a mutable pointer to the gl::State so ValidationContext can modify it if necessary (and it will be necessary for Framebuffer completeness caching).  BUG=angleproject:1388  Change-Id: I86ab3561573caa9535c8d1b8aad4ab3d0e7cd470 Reviewed-on: https://chromium-review.googlesource.com/348954 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add missing EXT_disjoint_timer_query entry points to eglGetProcAddress.  BUG=angleproject:1405 BUG=angleproject:1265  Change-Id: I823e1393943f7531374c094ce590fa0a6f49d213 Reviewed-on: https://chromium-review.googlesource.com/351776 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor more GL entrypoints.  In the next CL the Context is going to remove the mutable getter for the gl::State. This means we can only mutate the state inside Context. So we need to move all the state mutating GL command implementations to gl::Context.  BUG=angleproject:747 BUG=angleproject:1388  Change-Id: I9ed351d08611934bf708781c6af3948396921593 Reviewed-on: https://chromium-review.googlesource.com/351171 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix buildbreak on Linux GCC  Add virtual destructor to SignalReceiver.  class angle::SignalReceiver has virtual functions and accessible non-virtual destructor. This generates a compile error.  Change-Id: Iced2ee94ad9268ab5c1d00ab336ab2cc98385afc Reviewed-on: https://chromium-review.googlesource.com/351930 Reviewed-by: Sami Visnen <svaisanen@nvidia.com> Commit-Queue: Sami Visnen <svaisanen@nvidia.com>, 23355681, 619, 169, 619
Do not apply UNPACK_SKIP_IMAGES for 2D textures on D3D  Resubmitted with test skip added for Intel OpenGL.  GLES 3.0.4 section 3.8.3:  "For the purposes of decoding the texture image TexImage2D is equivalent to calling TexImage3D with corresponding arguments and depth of 1 except that UNPACK_SKIP_IMAGES is ignored."  An "applySkipImages" boolean parameter is added to the functions in the D3D backend that apply skip offset to the unpack pointer. In case 2D texture data is uploaded the parameter is set to false and UNPACK_SKIP_IMAGES is not applied.  BUG=angleproject:1406 TEST=angle_end2end_tests  Change-Id: I5878439e3d38dbae89cc2452a056c2d6bbf9e0b3 Reviewed-on: https://chromium-review.googlesource.com/351330 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "Do not apply UNPACK_SKIP_IMAGES for 2D textures on D3D"  The Windows Intel GPU FYI bot started failing the Texture2DTestES3.UnpackSkipImages2D/ES3_OPENGL test after this CL. Example: https://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Release%20%28New%20Intel%29/builds/866  This reverts commit ac3575b27296398baebeb6c891871c6dac7df338.  Change-Id: I5120261f5cf1ece9b21e4a94f63f85e014d2d8e4 Reviewed-on: https://chromium-review.googlesource.com/351280 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor how we signal dependent state changes.  Dependent state changes happen when the user calls TexImage on a Texture attached to a Framebuffer. The Framebuffer should be told 'hey you should know about this'. Other objects also have dependent relationships like VertexArrays and Buffers.  This refactoring uses a binding pointer design similar to the type 'RefCountObject'. This design fixes the need for manual decoupling when one or the other is destroyed. The pointers are cleaned up in destructors and do no-ops when either the source or dest is missing.  Also move these new classes to a location where they are accessible to the GL layer; they will be important for framebuffer completeness.  BUG=angleproject:1388  Change-Id: I92610acb85dae6f9c009b8f071e121fde53782ae Reviewed-on: https://chromium-review.googlesource.com/348953 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move ReadPixels logic to helper methods.  These routines were pretty much duplicated between D3D9 and D3D11. Since I was going to have to rewrite them again for Vulkan I figured it would be best to move them into a common location and clean them up a bit.  BUG=angleproject:1319  Change-Id: I15d39b052daf3e1020dbd0880f01ae84f3686a0a Reviewed-on: https://chromium-review.googlesource.com/349630 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Simplify load function table init.  Now that C++11 constructor syntax is allowed we can use a much simpler scheme.  BUG=angleproject:1407 BUG=chromium:616176  Change-Id: Ida5f235c3ed1429564af5213a5fead6c3b896080 Reviewed-on: https://chromium-review.googlesource.com/350903 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add an error check to ANGLE DLL update script.  BUG=None  Change-Id: I6fdcb8c436f35b9e3aa284760063f27e04e15a48 Reviewed-on: https://chromium-review.googlesource.com/350902 Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Do not apply UNPACK_SKIP_IMAGES for 2D textures on D3D  GLES 3.0.4 section 3.8.3:  "For the purposes of decoding the texture image TexImage2D is equivalent to calling TexImage3D with corresponding arguments and depth of 1 except that UNPACK_SKIP_IMAGES is ignored."  An "applySkipImages" boolean parameter is added to the functions in the D3D backend that apply skip offset to the unpack pointer. In case 2D texture data is uploaded the parameter is set to false and UNPACK_SKIP_IMAGES is not applied.  BUG=angleproject:1406 TEST=angle_end2end_tests  Change-Id: Iedc2b05377adee8d5c2504511a87421f4b1db18d Reviewed-on: https://chromium-review.googlesource.com/350465 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "Revert "Use MapBufferRangeWithFallback in VertexArrayGL::streamAttributes""  This reverts commit 8b8d043205a69802be7579bd90798162f34740b2.  Change-Id: I25726642d066ca322830d1f5a4327f4e7e551fa6 Reviewed-on: https://chromium-review.googlesource.com/350870 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix unpack parameter validation.  BUG=angleproject:1397  Change-Id: Icdfc99eefcfad730ec887b82ec0758a6d6c0b9a7 Reviewed-on: https://chromium-review.googlesource.com/348064 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Use MapBufferRangeWithFallback in VertexArrayGL::streamAttributes"  This reverts commit c88d8354479c2e8021ceacebed1450d509cf8ffa.  Likely causing failures on Linux webgl tests: http://build.chromium.org/p/chromium.gpu.fyi/waterfall?builder=Linux%20Release%20(New%20Intel)  Change-Id: I0294f7f544c666ee7db13c4f7acae868c6bd2240 Reviewed-on: https://chromium-review.googlesource.com/350530 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix MSVS x64 build  EGLAttrib can be a 64-bit type on some configurations in which case it needs an explicit cast to be converted to EGLint.  TEST=standalone MSVS 2015 x64 debug build  Change-Id: I6b3e0ae705e8862e079e81e516d6bf99409732e7 Reviewed-on: https://chromium-review.googlesource.com/350411 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Roll Cherry.  This fixes a bug preventing Cherry from running on Windows.  BUG=None  Change-Id: I0049005093e5abb7a7fd2c5b125e8133c0e0cab5 Reviewed-on: https://chromium-review.googlesource.com/350402 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Translate requirements of GL_EXT_draw_buffers to GL_ARB_draw_buffers.  GL_ARB_draw_buffers adds special semantics when writing to gl_FragData even if multiple renderbuffers is part of the core spec so it needs to be declared in the translated shader.  BUG=617410  Change-Id: Id5524634c278ba303413b11251d560744f2517ca Reviewed-on: https://chromium-review.googlesource.com/350121 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Android GL backend and end2end tests  Just the bare minimum implementation for end2end tests to run.  BUG=angleproject:1362 TEST=angle_end2end_tests on Nexus 5X  Change-Id: I92293e0f8bdc2ffaa5d4661927750d7cb3d931e6 Reviewed-on: https://chromium-review.googlesource.com/349353 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Vulkan: Hook up Renderer create functions.  Do this in a separate CL to preserve the renderer generation.  BUG=angleproject:1319  Change-Id: I6d5768f199f6aabff747b3708c0625ff78e1ceb0 Reviewed-on: https://chromium-review.googlesource.com/349424 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove const qualifier from generateConfigs  Requested in https://chromium-review.googlesource.com/349353  BUG=angleproject:1362  Change-Id: I989757c2fb8f65d5afcfb177b7f8da1414871e6f Reviewed-on: https://chromium-review.googlesource.com/349694 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
README.md group links by purpose and add Gerrit there  Change-Id: Icb15891d4325ad1724647f5d6faf0d17fbb50269 Reviewed-on: https://chromium-review.googlesource.com/349470 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use MapBufferRangeWithFallback in VertexArrayGL::streamAttributes  Otherwise end2end tests crash on Nexus 5X because Adreno driver doesn't provide glMapBuffer.  BUG=angleproject:1362 TEST=angle_end2end_tests on Nexus 5X and Linux  Change-Id: I6207eca2d0e03eee957bb612271a66016fd562bb Reviewed-on: https://chromium-review.googlesource.com/349421 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Add how to update working copy after change is submitted  Change-Id: I387249d29822d91a6126f6c25cb35e8b80cb4c36 Reviewed-on: https://chromium-review.googlesource.com/349460 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move getSwapBehavior call to be after SurfaceImpl initialize  Otherwise end2end tests crash on Nexus 5X since the underlying EGL surface doesn't exist at the time of getSwapBehavior call.  BUG=angleproject:1362 TEST=angle_end2end_tests on Nexus 5X  Change-Id: I550e46ee82592b9d1ea49a3c968d7ffad3ab06f7 Reviewed-on: https://chromium-review.googlesource.com/349430 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Fix GL_KHR_debug extension functions names  Otherwise running end2end tests on Nexus 5X crashes.  BUG=angleproject:1362 TEST=angle_end2end_tests on Nexus 5X  Change-Id: I063d9f9836a1575cbf0abe361dbf8b2c1492105d Reviewed-on: https://chromium-review.googlesource.com/349420 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Pass depth to computeBlockSize.  This was very wrong for 3D textures.  BUG=angleproject:1384  Change-Id: I7f042449e30e1e909778c0524d1ce99d20ddfd65 Reviewed-on: https://chromium-review.googlesource.com/348063 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add base::numerics for safe math and conversions.  This replaces are "IsUnsignedXXXSafe" family of methods. Also add overflow checks to unpack block sizes.  BUG=angleproject:1397  Change-Id: Ib47be149b0486c70f795b0d0f8899441faac9340 Reviewed-on: https://chromium-review.googlesource.com/348062 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ProgramGL: translate location in setUniform1uiv  BUG=angleproject:1401  Change-Id: I5d08ecb2d4090e4be049dc6d25fc2ea17911ff2c Reviewed-on: https://chromium-review.googlesource.com/349011 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add cmdline help to commit_id.py  Change-Id: I2b87e0b60f40d345388562e33ed8eb7010adf186 Reviewed-on: https://chromium-review.googlesource.com/349040 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Roll buildtools.  This will include a new clang-format for standalone ANGLE.  BUG=None  Change-Id: Ia4a888c77487d03c2c83989c5f565dea993d5a06 Reviewed-on: https://chromium-review.googlesource.com/348374 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix CopyTexture for ES3 types.  We were passing a sized format and indexing a table which expects unsized.  BUG=angleproject:1384  Change-Id: I69eb8e3d66cfb2178e3a7a4ddb93a54f47bbc938 Reviewed-on: https://chromium-review.googlesource.com/347249 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Try more to use ANGLE_TRY.  Also refactor the Renderer11::copyImage functions to share code.  BUG=angleproject:1384  Change-Id: I95f4266c0c9b67a13cba17797989fcc0b0d50c1d Reviewed-on: https://chromium-review.googlesource.com/347248 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix README.md for commonmark with small edits  Change-Id: Id7ed37945744a083e6eb5b6a792f8379b7b98bac Reviewed-on: https://chromium-review.googlesource.com/348200 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Enable Release ASSERT in ANGLE.  This will mainly affect the Chromium bots.  BUG=angleproject:790  Change-Id: I0c4318e83eedba851f15b3b139551cdb6a2fde12 Reviewed-on: https://chromium-review.googlesource.com/346103 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
doc/ContributingCode.md add more links needed at given context  Change-Id: I331ac7b24fd35735a0822a6b86ece66e1847f475 Reviewed-on: https://chromium-review.googlesource.com/347130 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove usage of auto_ptr in MacroExpander  BUG=angleproject:1269  Change-Id: I1fafa102b065f6da1797e8790ec3ed498d9d8b45 Reviewed-on: https://chromium-review.googlesource.com/339379 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix use-after-free when deleting share contexts.  The pattern of gen context share context free context then allocate a shared GL object in the second context would cause a use-after-free of the ContextImpl as a GLFactory. Fix this by passing the factory as a parameter to the resource manager allocation methods instead of storing the factory pointer. This allows the same ResourceManager to work with separate Context implementations which will work with non-virtual contexts.  BUG=612931  Change-Id: Ifceeb893bebd072f318963d935ff9d17181f5305 Reviewed-on: https://chromium-review.googlesource.com/347463 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add Vulkan stubs.  Currently enabled for Windows by default.  BUG=angleproject:1319  Change-Id: I87921c579bee466465fb1e3f629bb3a40fdff659 Reviewed-on: https://chromium-review.googlesource.com/328730 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix Renderer generator script.  This script breaks peridocially because we don't have automated tests for it. Split the FBO attachment object class into its own file and also fix a couple other small snags that prevented the script from running.  This will facilitate generating Vulkan renderer stubs.  BUG=angleproject:1319  Change-Id: I30a6ce4ab0adad962cea76731dbe82837c5c9a1b Reviewed-on: https://chromium-review.googlesource.com/347064 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement GL_EXT_texture_norm16 extension  BUG=angleproject:1365  Change-Id: I972b156ecb41ff44bc1f6365373ab386bacc85f1 Reviewed-on: https://chromium-review.googlesource.com/346530 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
DisplayGLX: make the Mesa context creation workaround Mesa specific.  BUG=598902  Change-Id: Ib2ca69fb3573dbd0df3dafb4caec0500c7a8aa3b Reviewed-on: https://chromium-review.googlesource.com/347071 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Enable always-available extensions in gl::Context.  We can consolidate exposing these extensions in initCaps. Otherwise we have to maintain the lists in every Renderer back-end.  Also do the same treatment for select egl::Display extensions.  BUG=angleproject:1319  Change-Id: I529dd120c6d2cdbb789bd9dd20491e796e97f3f6 Reviewed-on: https://chromium-review.googlesource.com/345914 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add the ChromeOS trybot to the CQ config.  BUG=angleproject:1347  Change-Id: I93266da474909352a4b83de52cffde82687bda86 Reviewed-on: https://chromium-review.googlesource.com/346735 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix include order for Clang in Renderer11.cpp.  BUG=angleproject:1369  Change-Id: Ie02e7c0b469e148bd8da4499ed560c4907d2a539 Reviewed-on: https://chromium-review.googlesource.com/346891 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
doc/DevSetup.md make lists rendered correctly by Gitiles  Change-Id: Id0dc92373f41b089081202692519adfbc44e0729 Reviewed-on: https://chromium-review.googlesource.com/346680 Reviewed-by: Aaron Gable <agable@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make RendererD3D a bit smaller.  Move some D3D11-specific stuff into Renderer11 and remove a few virtual methods that weren't needed to be virtual.  BUG=angleproject:1369  Change-Id: Id37e7271ffc28b089dbea123dca70f38c1a06ffb Reviewed-on: https://chromium-review.googlesource.com/345913 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Require FL 10.1+ for ES3.  We decided some time ago to make our lives easier and raise the lower bound on the feature level to 10.1 from 10.0. This makes using some multisample samplers easier in HLSL. It is also a very small and poorly suppoted fraction of our userbase.  BUG=angleproject:1381  Change-Id: I25d330a6097f71ec772899d49ff5d3a97c0cb0d2 Reviewed-on: https://chromium-review.googlesource.com/346102 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a shared egl::SurfaceState struct.  This structure can share GL-level properties (immutably) with the implementation.  BUG=angleproject:1369  Change-Id: I1e9406f18b6b88bb7db2a8f87b5e6d547cc7ecb1 Reviewed-on: https://chromium-review.googlesource.com/342061 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix GenerateMipmap when base level or max level are set  According to GLES 3.0.4 section 3.8.10 GenerateMipmap should generate levels based on the base level and generate them at most up to the max level. Levels outside the base/max level range should be unchanged by GenerateMipmap.  The Texture class is fixed so that the image descs are set only for the changed mipmap range when GenerateMipmap is called.  The D3D backend is fixed so that mipmap generation is correctly started from the base level instead of level 0 and making sure that mipmaps are generated only up to the max level. Generating mipmaps for array textures is also fixed for cases where the base level depth >= max(width height) * 2.  The GL backend is fixed to sync texture state before GenerateMipmap is called so that base level and max level are set correctly in the driver.  The GenerateMipmap entry point is refactored so that it has a separate validation function and a context function which does the work. Validation for out-of-range base levels is added.  New tests are added to verify the functionality. One corner case in the tests fails on NVIDIA GL drivers likely due to a driver bug - similar rules for GenerateMipmap are found from newer GLES specs and also OpenGL specs (checked versions 3.3 and 4.4).  BUG=angleproject:596 TEST=angle_end2end_tests  Change-Id: Ifc7b4126281967fc4f6dc4f9452e5b01e39f83d7 Reviewed-on: https://chromium-review.googlesource.com/344514 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Make inheritance heirarchy for egl::Surface.  This will allow us to select the Impl constructor more easily   createWindowSurface  createPbufferSurface  createPbufferSurfaceFromClientBuffer  createPixmapSurface  This in turn lets us pass an EGLImplFactory to the constructor and will allow us to pass in the local SurfaceState to the constructor.  BUG=angleproject:1369  Change-Id: I6b13c1548c54bd5c493d59b68bfdaf55226b6bb5 Reviewed-on: https://chromium-review.googlesource.com/342060 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Try hard to eliminate isError in ValidationEGL.  We were getting a compile warning due to variable shadowing from redeclaring a local egl::Error. Fix this using the ANGLE_TRY macro.  BUG=angleproject:596  Change-Id: I38954bd1c9f171f264d7ecbf58d634ae721296ad Reviewed-on: https://chromium-review.googlesource.com/346092 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix Linux standalone compilation.  simple_texture_2d hello_triangle stencil_operations simple_texture_cubemap fail to compile after https://chromium-review.googlesource.com/342050.  BUG=angleproject:1319 TEST=ninja -C out/Release all  Change-Id: Ib70008036f8688b737f3f40b5224437a7afdea19 Reviewed-on: https://chromium-review.googlesource.com/346121 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Update the dEQP GLES2/3 test expectations  Removed the tests that didn't fail in the latest 20 runs on the bots skipping a couple test categories that are known to flake with a very low probability. Some flakes might still go through and will have to be resuppressed later.  BUG=angleproject:504 BUG=angleproject:1027 BUG=angleproject:1032 BUG=angleproject:1051 BUG=angleproject:1092 BUG=angleproject:1093 BUG=angleproject:1095 BUG=angleproject:1097 BUG=angleproject:1101 BUG=angleproject:1143 BUG=angleproject:1323 BUG=angleproject:1324  Change-Id: I5943cd5bc125c64a45ad383c8bf22e48596a4f7e Reviewed-on: https://chromium-review.googlesource.com/346050 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add build instructions for Linux and MacOS  BUG=angleproject:1368  Change-Id: I2a0852399cdf04192d7e1d11b33b2103aa173354 Reviewed-on: https://chromium-review.googlesource.com/344003 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix determining texture mipmap completeness  The code didn't previously take base level properly into account when determining how many levels to check when checking for texture completeness.  The code is refactored so that the "q" value in spec that is the maximum mipmap level for determining completeness can be queried from TextureState. This value is used now for checking completeness.  This requires moving ImageDescs under TextureState. Functions that operate on the ImageDesc array are also moved from Texture to TextureState. TextureState members are also renamed to start with the "m" prefix and made private.  Also handle levels outside the base/max level range consistently in eglCreateImageKHR validation. We interpret the spec so that if the level used for the EGL image is not a part of the texture levels that affect texture completeness an error is generated.  BUG=angleproject:596 TEST=angle_end2end_tests  Change-Id: I038ef24aa83e0a6905ca3c0bbada5989eecb00d9 Reviewed-on: https://chromium-review.googlesource.com/344880 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add support for OES_EGL_image_external and OES_EGL_image_external_essl3.  BUG=angleproject:1372  Change-Id: I8489e7fd0ab409b0775041ad5e9fbf0aab53886d Reviewed-on: https://chromium-review.googlesource.com/344734 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix float-to-int conversion warning.  BUG=angleproject:1378  Change-Id: I92b902154432e82a1357e8623426256c4ca53ca3 Reviewed-on: https://chromium-review.googlesource.com/345585 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Support CHROMIUM_framebuffer_mixed_samples in the GL backend  BUG=angleproject:1378  Change-Id: I634c41f3507dbdeaa56234c4de1b498f81c848ed Reviewed-on: https://chromium-review.googlesource.com/344520 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Sami Visnen <svaisanen@nvidia.com>, 23355681, 619, 169, 619
Make Platform errors trigger test failures.  This can be useful in the Vulkan back-end to make validation layer errors cause test cases to fail.  BUG=angleproject:1319  Change-Id: I523f3c874e892a2646600e4c5c554319ed8d770c Reviewed-on: https://chromium-review.googlesource.com/342050 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Apply effective base and max level on GL backend  This works around GL drivers that neglect to clamp the base level or max level of immutable textures.  BUG=angleproject:596 BUG=610800 TEST=angle_end2end_tests  Change-Id: Ie4e04aaa9253f2befd73bccefa7759486b3ef487 Reviewed-on: https://chromium-review.googlesource.com/344590 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Replace rx::Renderer with rx::ContextImpl.  Previously Context had no Impl class but had a special relationship with the instanced Renderer class. Having a ContextImpl backing every Context will allow new designs to enable things like multithreading (where each ContextImpl stores a Context-specific device) or non- virtual Contexts on Android or other platforms where it is more efficient.  A large refactoring patch that touches every back-end.  BUG=angleproject:1363  Change-Id: Icb73a7d37447f08a664eeb499a310ba05d71a57e Reviewed-on: https://chromium-review.googlesource.com/342052 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
gn: Add a missing test.  BUG=chromium:604060  Change-Id: I7e9b8c1bd7cb14daa15575cfcfe9ba3e8a1e6d1b Reviewed-on: https://chromium-review.googlesource.com/344701 Tryjob-Request: Nico Weber <thakis@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Nico Weber <thakis@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Clean up specifying colors and texture scale in MipmapTest  Remove unnecessary scale parameter from MipmapTestES3 and use the GLColor class and EXPECT_PIXEL_COLOR_EQ instead of EXPECT_PIXEL_EQ for greater readability.  BUG=angleproject:596 TEST=angle_end2end_tests  Change-Id: I79c30ce85be5d554d89197f8f1ce7ab0c51c11b6 Reviewed-on: https://chromium-review.googlesource.com/344513 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
gn/mac: Build GL code and include CGL code.  BUG=chromium:431177  Change-Id: Id9c8ad68a9703591d6f576bfae3d7061526ed27f Reviewed-on: https://chromium-review.googlesource.com/344740 Tryjob-Request: Nico Weber <thakis@chromium.org> Reviewed-by: Nico Weber <thakis@chromium.org>, 23355681, 619, 169, 619
Support EXT_multisample_compatibility in the GL backend  BUG=angleproject:1377  Change-Id: Ie14aceca8e01f1cbc93fd5bd06d986336fb752b3 Reviewed-on: https://chromium-review.googlesource.com/343501 Reviewed-by: Sami Visnen <svaisanen@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Sami Visnen <svaisanen@nvidia.com>, 23355681, 619, 169, 619
D3D: Reallocate storage when texture format changes with base level  Different levels of the same texture may have different formats so changing the base level may affect the format that should be used for the storage. Take this into account in the D3D backend.  The added test fails on some GL drivers.  TEST=angle_end2end_tests BUG=angleproject:596  Change-Id: I5380e942694a75685ebb510edb01c0489e0d5179 Reviewed-on: https://chromium-review.googlesource.com/344230 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Share TextureState structure with TextureImpl  This refactoring patch removes the need to pass texture state to methods of TextureImpl in some cases. It also adds target value to TextureState and moves TextureState definition to Texture.h.  The effective base level can now also be queried from TextureState which reduces the need to pass it around.  Two different code paths that dealt with the TextureStorage11 SRV cache are combined into one.  Besides refactoring this patch fixes applying mTopLevel twice when determining the amount of mip levels TextureStorage11.  BUG=angleproject:596 TEST=angle_end2end_tests angle_unittests  Change-Id: I1add3d9ad847bec56774e394125156cf9cb0fc2a Reviewed-on: https://chromium-review.googlesource.com/342940 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
dEQP: Add GL ES display factory.  So we can run dEQP on the GL ES back end.  BUG=angleproject:1371  Change-Id: I7694d766f04997f9ba60ad0dd0bb4b30e714b4ae Reviewed-on: https://chromium-review.googlesource.com/342843 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Suppress and end2end failure caused by a Mesa bug  BUG=610800  Change-Id: I4ee6ba589afc98277c3cf50b8f57afb184b11216 Reviewed-on: https://chromium-review.googlesource.com/343994 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement GL_CHROMIUM_sync_query for D3D9 and D3D11.  BUG=angleproject:1366  Change-Id: Iadde61968f45b969c76578a6dd9116a25d63fb4b Reviewed-on: https://chromium-review.googlesource.com/341230 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Initial Chrome OS support.  Samples and end2end tests mostly work.  Only one config and no input.  BUG=angleproject:1297  Change-Id: I5b69babccc5b97e486d86e1721a0a1740ad80941 Reviewed-on: https://chromium-review.googlesource.com/319460 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Use data_deps to depend on :copy_compiler_dll  This should ensure that d3dcompiler_47.dll is saved into an isolate in chromium as it's used at runtime.  BUG=611235  Change-Id: I64801f00bf90f2be68c7a691724609bbf4d28dfa Reviewed-on: https://chromium-review.googlesource.com/344351 Tryjob-Request: John Bauman <jbauman@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: John Bauman <jbauman@chromium.org> Reviewed-by: Dirk Pranke <dpranke@chromium.org>, 23355681, 619, 169, 619
Add EGLImplFactory.  Also rename ImplFactory to GLImplFactory.  This will allow us to use the same factory design pattern for EGL objects and to use State helper classes to share data with Impls.  BUG=angleproject:1363 BUG=angleproject:1369  Change-Id: I07a8fe40838d5d4ca32b04910c306edeab4d25a7 Reviewed-on: https://chromium-review.googlesource.com/342051 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disable the DXGI WGL swap chain surface on AMD drivers.  BUG=540829  Change-Id: Ib15658c3fd7132068e9eb1e69a7a04720b3e3d6b Reviewed-on: https://chromium-review.googlesource.com/344250 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add DEPS.chromium to share dEQP deps with Chrome.  This file will allow ANGLE to update the build files and roll dEQP in the same CL making life a pleasure to live for maintainers.  BUG=chromium:605987  Change-Id: I8f574e80a5f7b176f08a9f51c2369e042cae56b7 Reviewed-on: https://chromium-review.googlesource.com/343010 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
In ES3 validate that depth and stencil are the same image  BUG=605775  Change-Id: I9508c70a588270dae871dde79fea1df1c3fd1558 Reviewed-on: https://chromium-review.googlesource.com/341440 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix the CopyTex validation logic for sized types  Previously we allowed copies to a sized format only if the depth of each component matched (including 0 depth). Now we require that the bit depth of non-empty component matches.  BUG=605775  Change-Id: If8abab886b0da5a1c8e89adabf3809f928dcedce Reviewed-on: https://chromium-review.googlesource.com/340382 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Determine D3D texture storage size with correct base level  The size of the texture storage is now determined by extrapolating the level zero texture dimensions from the base level dimensions. This fixes crashing when images for levels below the base level are not defined and also fixes texture storage dimensions being calculated wrong in case the levels outside the used level range have dimensions that are inconsistent with the dimensions inside the used level range.  Checking texture level completeness in TextureD3D is now done based on the dimensions of the base level and levels that are outside the base level to max level range are not taken into account. Textures are marked incomplete in case their base level is greater than their max level.  Changing the base level can also affect the size of the storage required for the texture. Old storage is now discarded when the base level is changed and the new base level calls for different storage dimensions.  Code in TextureD3D is refactored so that "base level" actually means the base level of the texture specified through the GLES API and "level zero" is used where TextureD3D would sometimes previously use "base level".  Changing either the base level or max level can also affect texture completeness so invalidate the cached completeness in Texture if they are changed.  Some of the added tests are still failing on Intel and NVIDIA OpenGL drivers because of driver bugs. Tests also fail on OSX.  BUG=angleproject:596 TEST=angle_end2end_tests      dEQP-GLES3.functional.texture.* (no regressions)      dEQP-GLES3.functional.shaders.texture_functions.* (no regressions)      dEQP-GLES3.functional.state_query.texture.* (no regressions)  Change-Id: Icd73d6e29f84a341ed5ff36d5ec5cb2f469cb4e8 Reviewed-on: https://chromium-review.googlesource.com/333352 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Disable angle_enable_gl on chromeos  BUG=angleproject:1370  Change-Id: I63e3ee8fc6e08fcd2a908cdca3558af886526cbd Reviewed-on: https://chromium-review.googlesource.com/342740 Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix eglStreamConsumerAcquireKHR  This was incorrectly acquiring every plane to texture 0.  BUG=angleproject:1332  Change-Id: I6df1401b705d903078e2631634b6bf20a07570de Reviewed-on: https://chromium-review.googlesource.com/342513 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: John Bauman <jbauman@chromium.org>, 23355681, 619, 169, 619
Pass ContextImpl to Framebuffer methods instead of ContextState.  BUG=angleproject:1363  Change-Id: I7e7524d95f2ca31c35918f9fe5c0cb681ed93616 Reviewed-on: https://chromium-review.googlesource.com/340746 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a ContextImpl class.  This class can contain impl-specific functionality for a Context. This will eventually replace the Renderer class and we can then start passing around a gl::Context instead of gl::ContextState.  In D3D11 the ContextImpl could hold a DeferredContext which would enable multi-thread rendering. In GL we can implement non-virtual (native) Contexts. In Vulkan it might store the logical device.  BUG=angleproject:1363  Change-Id: I39617e6d1a605d1a9574832e4d322400b09867ec Reviewed-on: https://chromium-review.googlesource.com/340745 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add missing errors specified by OES_EGL_image_external  Previously the code just silently ignored some filtering parameters for external textures when in fact trying to set them should result in an error according to the extension specs.  BUG=angleproject:1332  Change-Id: I3a691b60561638c562bc1a9780a4dcb88ac43012 Reviewed-on: https://chromium-review.googlesource.com/341441 Reviewed-by: Ian Ewell <ewell@google.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add script for updating Canary ANGLE DLLs.  This script makes debugging in Chrome easier on Windows. It scans for the latest set of ANGLE DLLs among many search paths and then copies them to the latest Chrome Canary binary directory. It also backs up the original DLLs if it finds them.  BUG=None  Change-Id: I66f8897a1393ceba8f614e4f91c0e1f9f0439eb3 Reviewed-on: https://chromium-review.googlesource.com/341221 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add dirty bits for the pixel pack and unpack buffer  BUG=605775  Change-Id: Ifb7eee94a395a9e9f5a5c1d6c0f05299162264a9 Reviewed-on: https://chromium-review.googlesource.com/340115 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix integer constant vertex attributes in OpenGL backend  BUG=605775  Change-Id: Ie76cae5be686478019c61c1877611bea83d7502f Reviewed-on: https://chromium-review.googlesource.com/340114 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Set the bound XFB to 0 when it is deleted  BUG=605775  Change-Id: Ie7af2c0dc4536b26473510a80955f4628ea496bb Reviewed-on: https://chromium-review.googlesource.com/340113 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Allow queries of different types to be active at the same time  BUG=605775  Change-Id: I0e23fae25d450c504f174a080279cf51aebcd123 Reviewed-on: https://chromium-review.googlesource.com/340112 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Rename gl::VertexArray::Data to gl::VertexArrayState.  BUG=angleproject:1363  Change-Id: I5acf670bd88988941676cc9bc75606d55cca224e Reviewed-on: https://chromium-review.googlesource.com/340744 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Rename gl::Shader::Data to gl::ShaderState.  BUG=angleproject:1363  Change-Id: I49cb5d7319742487c8c00c58ec58f9a29561b9c1 Reviewed-on: https://chromium-review.googlesource.com/340743 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Finish NV12 support via streams.  The main functionality for NV12 texture support through EGL streams has been added. Updates to the compiler texture code and stream code were added to support binding to external D3D11 NV12 textures. An end2end test was also added to test sampling of YUV textures and converting to RGB. There is also a new script to convert BMP files to an NV12 texture ready to load into D3D11 for testing purposes.  BUG=angleproject:1332  Change-Id: I39b6ec393ea338e2c843fb911acc1b36cd1158a0 Reviewed-on: https://chromium-review.googlesource.com/339454 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Ian Ewell <ewell@google.com> Reviewed-on: https://chromium-review.googlesource.com/341254 Reviewed-by: Ian Ewell <ewell@google.com>, 23355681, 619, 169, 619
Rename gl::Framebuffer::Data to gl::FramebufferState.  Moving this out of the Framebuffer class allows us to forward- declare it.  BUG=angleproject:1363  Change-Id: I91971c37a92151df508cdf7f0eb8c3e93506d112 Reviewed-on: https://chromium-review.googlesource.com/340741 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
OpenGL backend: fix logic updating max uniform components  BUG=605775  Change-Id: I37c1dc7117e7e47ee3a7e031cbccb44f39458c09 Reviewed-on: https://chromium-review.googlesource.com/340111 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Finish NV12 support via streams."  Broke Windows Clang compilation see https://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Win%20Clang%20Builder%20%28dbg%29/builds/3583/steps/compile/logs/stdio and search for TextureStorage11.h  This reverts commit 9b8b359fa3615be7c7492239a48f61103b2e4fcc.  Change-Id: I6e54305eba02b40927a35577594df39e951adb32 Reviewed-on: https://chromium-review.googlesource.com/341430 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Rename gl::Data to gl::ContextState.  Part of the new world order of renaming the Obj::Data classes to ObjState.  BUG=angleproject:1363  Change-Id: I15cf002b8b093d687f540b9e86f045874af24a7e Reviewed-on: https://chromium-review.googlesource.com/340740 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Finish NV12 support via streams.  The main functionality for NV12 texture support through EGL streams has been added. Updates to the compiler texture code and stream code were added to support binding to external D3D11 NV12 textures. An end2end test was also added to test sampling of YUV textures and converting to RGB. There is also a new script to convert BMP files to an NV12 texture ready to load into D3D11 for testing purposes.  BUG=angleproject:1332  Change-Id: I098940e6f25e113dcc4fc8d22ffed4b5a16fd860 Reviewed-on: https://chromium-review.googlesource.com/339454 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Ian Ewell <ewell@google.com>, 23355681, 619, 169, 619
D3D: Fix RGB5_A1 texture upload from PBO failure on Windows 10  Failure is consistently seen in the dEQP tests on Windows 10 on NVIDIA and Intel drivers where creating an SRV from the buffer in the right format fails. Disable the fast copy path for this format similarly to how it's already disabled for some other formats.  BUG=angleproject:1095 TEST=dEQP-GLES3.functional.texture.specification.teximage2d_pbo.rgb5*  Change-Id: I7a1cd15c2cd130c9e8a637457c201778f157333b Reviewed-on: https://chromium-review.googlesource.com/341170 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Use base level to get internal format in GenerateMipMap  BUG=605775  Change-Id: I11039ee9ba21dbe2716eed0d3a12a0fb2cf50ea4 Reviewed-on: https://chromium-review.googlesource.com/340116 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement program binary in ProgramGL.  BUG=angleproject:882  Change-Id: I8d57c185066e9fc0c1b8def09bc48d80ad97d328 Reviewed-on: https://chromium-review.googlesource.com/303901 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
DisplayGLX: Add AMD driver version detection  BUG=590870  Change-Id: I8b2548038635182bafa691671bdaa16f12b45694 Reviewed-on: https://chromium-review.googlesource.com/339450 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add FunctionsEGL FunctionsEGLDL - EGL wrappers.  FunctionsEGL is an abstract class. FunctionsEGLDL is an libdl-based implementation.  BUG=angleproject:1297  Change-Id: I0fe5a337e34518cc6248494dbc4ee5c2938d4b77 Reviewed-on: https://chromium-review.googlesource.com/338884 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
gyp: Remove the post-build script hook.  This was used by developers to copy compiled libs around. With better dEQP integration and supporting tools it is no longer necessary.  BUG=None  Change-Id: Iff35be88111c2c806bb02abf43ffb33ed5b641fd Reviewed-on: https://chromium-review.googlesource.com/340589 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement support for CHROMIUM_bind_uniform_location.  BUG=angleproject:1353  Change-Id: Ia219ff973de0de2f8e112c276b3ab6319f7d3884 Reviewed-on: https://chromium-review.googlesource.com/334252 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix allocation in ValidateOutputs.  We should not be using the pool allocator for destructable objects.  BUG=None  Change-Id: I89236b28f04bd9b7095056edbda4172dbbfe9586 Reviewed-on: https://chromium-review.googlesource.com/340362 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix deferring global array initialization  The initial implementation of DeferGlobalInitializers did not take HLSL corner cases into account. In particular in case there was a const-qualified array variable with an initializer that contained elements that weren't constant folded initialization would not be deferred and the global scope of HLSL output would contain a call to angle_construct_into_*().  On the other hand deferring global initializers was also done in cases where it wasn't necessary. Initializers of non-const qualified array variables that could be written as HLSL literals by HLSL output were unnecessarily deferred.  This patch fixes both of these issues: Now all global initializers are potential candidates for deferral instead of just those where the symbol has the EvqGlobal qualifier and initializers that are constructors taking only constant unions as parameters are not unnecessarily deferred.  BUG=angleproject:1205 BUG=541551 TEST=angle_end2end_tests  Change-Id: I4027059e0e5f39c8a5a48b5c97a3fceaac6b6f8a Reviewed-on: https://chromium-review.googlesource.com/339201 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Make sure D3DRS_TWOSIDEDSTENCILMODE is enabled if the stencil test is.  This state-setting code was not ported when adding the dirty bits for D3D9 depth stencil state in https://chromium-review.googlesource.com/#/c/316449.  BUG=597107  Change-Id: I0a1bdae18dd22c9b01f12a73267040157a866654 Reviewed-on: https://chromium-review.googlesource.com/340436 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Pass ImplFactory to Texture constructor  This improves encapsulation inside the Texture class and removes duplication of createTexture calls. This is a necessary step towards adding a shared "Data" structure to the Texture classes following a similar pattern as for example the Framebuffer class.  This patch also shares the same MockFactory class among different unit tests.  BUG=angleproject:596 TEST=angle_unittests  Change-Id: Ie8d3a9aa4ec35565d7ecbabb8c40e7b1ba068721 Reviewed-on: https://chromium-review.googlesource.com/340200 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Buffer11: Use adaptive threshold for releasing system memory.  The hard-coded threshold of five uses before a release was regressing the Oort online benchmark which seems to use an index buffer many times then change to a different range of indices which would need to check the system memory for index range validation.  Also add a performance regression test and an update to the perf runner script which checks for the most recent binary among the search directories.  BUG=594066  Change-Id: Id09cc32fd00bff1c72cbe9b6fb7c210fd047a551 Reviewed-on: https://chromium-review.googlesource.com/339271 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Clean up MipmapTest  This refactoring is done to prepare for adding more mipmap tests for ES3 where base level / max level is changed from 0.  1. Reuse drawQuad() from ANGLETest instead of having completely custom quad drawing code and reuse the same clear+draw function for both 2D and cube map texture tests.  2. Add a helper function for clearing texture level 0 with glClear.  3. Remove a few redundant texture binding and useProgram calls.  4. Rely on sampler uniforms being set to 0 by default and texture unit 0 being active by default.  5. Remove "Offscreen" from variable names.  6. Split SetUp functions to helper functions.  7. Reuse FillWithRGBA from TextureTest also in MipmapTest.  BUG=angleproject:596 TEST=angle_end2end_tests  Change-Id: I9fd738f4b8b0a19c7aa1d267f7dbaa40a6935631 Reviewed-on: https://chromium-review.googlesource.com/338791 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add a NativeWindowD3D abstract class to handle native window interactions.  The previous NativeWindow class included D3D11 headers while being included in all D3D backds and had platform-dependent includes and members.  This turns it into an abstract class that only implements the minimal functionality for each renderer.  BUG=angleproject:1345  Change-Id: I8f20339dd6bba719e574a1dcb3ec859897c9228f Reviewed-on: https://chromium-review.googlesource.com/336780 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix incorrect dirty bit state tracking on D3D9 AMD with color masks.  When using the zero color mask workaround in StateManager9 the blend state and blend equation were being modified.  This caused inconsistant state if the workaround stopped being used in subsequent draw calls.  To deal with this issue dirty the BLEND_ENABLED and BLEND_EQUATION states when the COLOR_MASK changes and dirty the COLOR_MASK state wheneither BLEND_ENABLED or BLEND_EQUATION changes.  BUG=597107  Change-Id: I03de934b419b7593e4863838720ced1e5773c092 Reviewed-on: https://chromium-review.googlesource.com/339280 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Re-land "Refactor texture function handling in OutputHLSL"  This change is pure refactoring it does not introduce any functional changes.  Separate texture function output into a helper class and further into different helper functions to make the code more maintainable.  Some of the logic is simplified slightly by eliminating duplicate cases and limiting the scope of variables where possible but care has been taken to preserve the exact same functionality as before.  Re-land with a fix to typo in include guard.  BUG=angleproject:1349 TEST=dEQP-GLES3.functional.shaders.texture_functions.* (no regression)      dEQP-GLES3.texture.* (no regression)  Change-Id: I57c1ec1950fa05bd16275ca578eb5ee99b34a5ae Reviewed-on: https://chromium-review.googlesource.com/339180 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Refactor texture function handling in OutputHLSL"  It triggered an include guard warning on Windows Clang  This reverts commit 6f6c5580553d1f3c584df692823c2f5640e23d88.  Change-Id: Ibd4f2851f311a494f16376d8eed38f3119594761 Reviewed-on: https://chromium-review.googlesource.com/338933 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Refactor texture function handling in OutputHLSL  This change is pure refactoring it does not introduce any functional changes.  Separate texture function output into a helper class and further into different helper functions to make the code more maintainable.  Some of the logic is simplified slightly by eliminating duplicate cases and limiting the scope of variables where possible but care has been taken to preserve the exact same functionality as before.  BUG=angleproject:1349 TEST=dEQP-GLES3.functional.shaders.texture_functions.* (no regression)      dEQP-GLES3.texture.* (no regression)  Change-Id: I5d81b842d693c0055890d5724eae6c105e454cd8 Reviewed-on: https://chromium-review.googlesource.com/337931 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Takes principal component analysis to improve the endpoint in ETC transcode.  Insteading of getting the BC1 endpoints from the max and min intensity a PCA on pixels might give us better quality results with limited costs.  Change-Id: I7638d78c666c2580a6b0c267470bf4a0f7082e05 Reviewed-on: https://chromium-review.googlesource.com/332871 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Defer global initializers when necessary  Move global variable initializers that are not constant expressions to a function that gets called at the start of main(). This is done with an AST transformation. This needs to be done because global variable initializers must be constant in native GL but ANGLE is more lenient with what can be put into ESSL 1.00 global initializers to remain compatible with legacy WebGL content.  Non-constant global variable initializers also caused issues in HLSL output since in HLSL output some types of expressions get unfolded into multiple statements. These include short-circuiting operators and array initialization. To make sure that these cases are covered any initializers that can't be constant folded are deferred even if they have the const qualifier.  The old deferring mechanism in OutputHLSL is removed in favor of this new AST transformation based approach.  BUG=angleproject:819 BUG=angleproject:1205 BUG=angleproject:1350 BUG=596616 TEST=WebGL conformance test      conformance/glsl/misc/global-variable-init.html  Change-Id: I039cc05d6b8c284baeefbdf7f10062cae4bc5716 Reviewed-on: https://chromium-review.googlesource.com/338291 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Wrap integer textures with correct wrap mode in HLSL  The wrap mode information for all three dimensions is packed to a single integer in order to conserve sampler metadata space. Only one int4 vector is used for the metadata for a single sampler.  The sampler metadata is now packed into a struct instead of an array of integers in order to make the code more readable and maintainable. The internalFormatBits field is not removed in this patch. It's better to remove it in a separate patch so restoring it is easier in case it will be used for optimizing some of the texture sampling functions.  The wrap mode passed in sampler metadata is used to wrap the texture coordinates in the code generated to implement ESSL 3.00 integer texture sampling built-ins.  Those dEQP-GLES3.functional.texture.units.* tests that sample from integer cube maps still fail on Intel D3D after this change presumably due to driver issues.  BUG=angleproject:1244 BUG=angleproject:1095 BUG=angleproject:1092 TEST=dEQP-GLES3.functional.texture.units.* (all pass on NVIDIA)      dEQP-GLES3.functional.shaders.texture_functions.* (no regressions)  Change-Id: I4e31e5796086f9cc290c6f1f8c4380a768758d71 Reviewed-on: https://chromium-review.googlesource.com/336638 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add a perf test for setting uniform data.  BUG=angleproject:1353  Change-Id: Iaae79bb85318583c12b9a939ea27a7f7f7f64faf Reviewed-on: https://chromium-review.googlesource.com/338441 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Disable pointer conversion warning in XNVCtrl  This warning happens on some older versions of the X headers such as those present on the current Chromium linux_chromium_chromeos_rel_ng bots. The default warnings in the GN build are slightly more strict than in GYP which is why we need to add some isolated warning disables.  BUG=432959  Change-Id: Id6218780195c59f160adae789305638d3463be9a Reviewed-on: https://chromium-review.googlesource.com/338424 Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Gyp support for Ozone.  Introduce gyp flag 'use_ozone' to select Ozone code. Ozone is a display method used on Chrome OS which is based on gbm drm/kms and surfaceless egl.  BUG=angleproject:1297  Change-Id: Ic1f66121d23d26bac56b09e3e6aedefec5a131df Reviewed-on: https://chromium-review.googlesource.com/338442 Commit-Queue: Frank Henigman <fjhenigman@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Lexer: Error out on invalid field start.  When parsing something like x.} the following would happen:  - Parsing "." the lexer would move to the FIELDS start condition  - Parsing } the lexer wouldn't find any <FIELDS> rule matching  - The parser would fall back to <*>. that was asserted unreachable.  The fix is to add a <FIELDS>. rule to catch bad field starts  BUG=angleproject:1352  Change-Id: I262d2b9ef5f7346c19ae5e19a173e24f40f2f600 Reviewed-on: https://chromium-review.googlesource.com/338222 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add a test for gl_VertexID  BUG=angleproject:1217 BUG=587781  Change-Id: I2fd20c686863c1409228717606977a3c4e1cd7fa Reviewed-on: https://chromium-review.googlesource.com/338180 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Re-re-land "D3D11: Implement dirty bits for VertexArray11.""  Translated attributes are now stored in the VertexArray11 in a cache and only updated when dirty bits change. Currently dynamic attributes must be re-translated every call so these are stored in a list and processed repeatedly.  This skips doing a lot of the VertexDataManager work for vertex attributes that don't change between draw calls.  Current value attributes which correspond to disabled attributes that the program will pulls vertex data from are owned by the Context so these need to be handled outside of the VertexArray11.  Further changes will be necessary to reduce the redundant work we do in the InputLayoutCache. We shouldn't need to re-check the cache if nothing relevant changed.  This give about a 23% performance improvement on the draw call benchmark on my machine.  Re-land with a fix for the start vertex offset.  Re-re-land with a fix for using XFB with deleted buffers.  BUG=angleproject:1327  Change-Id: I0fba49515375c149bbf54d933f8d1f747fbb8158 Reviewed-on: https://chromium-review.googlesource.com/338003 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Gyp support for Ozone."  This broke the Linux standalone build. Error message seen when running "gclient runhooks":  "gyp: name 'use_ozone' is not defined while evaluating condition 'OS=="linux" and use_ozone==0' in build/ANGLE.gyp while trying to load build/ANGLE.gyp"  This reverts commit 35e65e921394713f89df8d9bfe243b4abb5e9bd7.  Change-Id: Iee5f08195ee1c74ead99bb9d70d04928c9bae7af Reviewed-on: https://chromium-review.googlesource.com/338290 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Gyp support for Ozone.  Introduce gyp flag 'use_ozone' to select Ozone code. Ozone is a display method used on Chrome OS which is based on gbm drm/kms and surfaceless egl.  BUG=angleproject:1297  Change-Id: I5272651bd1af5806b6b42067d2d0f0abf0895af3 Reviewed-on: https://chromium-review.googlesource.com/337781 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Gyp support for Chrome OS.  Change comment to explain the 'chromeos' gyp flag. Make it possible to override pkg-config.  BUG=angleproject:1297  Change-Id: Ifc56cc4575d83ff893aaa0283c3aaa91df14fafd Reviewed-on: https://chromium-review.googlesource.com/337708 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Add workaround to always call useProgram after a successful link.  This workaround is meant to reproduce the behavior of the use_current_program_after_successful_link workaround in Chromium (http://crbug.com/110263)  The workaround was shown to be unnecessary for MacOSX 10.9 and higher (http://crrev.com/39eb535b).  BUG=349137  Change-Id: I3023f053aa1593ba7044a889dd47746b8f7e0581 Reviewed-on: https://chromium-review.googlesource.com/337780 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Re-land "D3D11: Implement dirty bits for VertexArray11."""  Seems to make the following dEQP test flaky: dEQP-GLES3.functional.lifetime.attach.deleted_output.buffer_transform_feedback  doesn't show up on every bot test but run it a few times and it'll flake. Reverting while I investigate.  BUG=angleproject:1327 This reverts commit 3477f3a62dc139a253a0b361ee138116e9fa881f.  Change-Id: Ic23a392526f5f6e107cf0aa06448389804d6b208 Reviewed-on: https://chromium-review.googlesource.com/337961 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Deqp gyp use_x11 fixes.  Remove the use_x11==1 condition from two things which have nothing to do with x11: defining _GNU_SOURCE and choosing deqp_libtester_sources_unix. This lets us build for Chrome OS where typically use_x11==0.  BUG=angleproject:1297  Change-Id: I9166f2a8119493aaab82af15e109d378fffb811a Reviewed-on: https://chromium-review.googlesource.com/337695 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Initial implementation of ANGLE_stream_producer_d3d_texture_nv12.  Add the validation and entrypoints for ANGLE_stream_producer_d3d_texture_nv12 which is a new EGL extension currently being written. The purpose of this extension is to allow insertion of D3D11 NV12 textures to be inserted into a stream. This acts as the producer of the EGL stream.  BUG=angleproject:1332  Change-Id: I50d4565cc82b63f7da7632adad4ac4c77d8800f2 Reviewed-on: https://chromium-review.googlesource.com/336695 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Ian Ewell <ewell@google.com>, 23355681, 619, 169, 619
Make :angle_common depend on :commit_id.  BUG=chromium:601195 Change-Id: Ic90b8c8dbe07700e66c8fe973a3e620f439d2fbe Reviewed-on: https://chromium-review.googlesource.com/337335 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix integer texture sampling with explicit gradients  The lod level should be selected according to the explicit gradients and the gradients are relative to the normalized texture coordinates so they need to be multiplied by the base level dimensions to get the correct gradients to use in the lod level formula.  In the case of sampling integer cube maps the derivatives of the texture coordinates on the cube map face need to be calculated based on the derivatives of the cube map direction vector components.  Also includes fix for sampling integer cube maps with explicit LOD.  BUG=angleproject:1092 TEST=dEQP-GLES3.functional.shaders.texture_functions.*grad*  Change-Id: Iadd358e713fa9695e755e98db8f368e8c512ac45 Reviewed-on: https://chromium-review.googlesource.com/337100 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Suppress samplers in structs test failures on Intel OpenGL  Some of the tests made to verify D3D implementation of samplers in structs are failing on Intel's OpenGL drivers so suppress the failures.  Since the test was crashing in shader program setup shader program setup needs to be moved out of the SetUp() function of the texture tests.  BUG=600758 TEST=angle_end2end_tests  Change-Id: I1b6e788d900425e914572d2a3d7ef1fc43146f50 Reviewed-on: https://chromium-review.googlesource.com/337500 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Refactor HLSL texture coordinate output to prepare for wrap modes  Wrap modes for integer textures need to be implemented in shaders in HLSL. This requires more complex transformations on the texture coordinates so store the texture coordinate code for each texture coordinate in a string variable.  BUG=angleproject:1244 TEST=dEQP-GLES3.functional.shaders.texture_functions.* (no regression)      dEQP-GLES3.functional.texture.units.* (no regression)  Change-Id: Iadd9617a7f906aa1d56dabfba6639f932152e6f1 Reviewed-on: https://chromium-review.googlesource.com/336637 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add initial support for various stream extensions.  Add entry points and validation for various egl stream extensions including EGL_KHR_stream_consumer_gltexture and EGL_NV_stream_consumer_gltexture_yuv and NV_EGL_stream_consumer_external. The extensions functionality is not yet implemented and the extension strings are thus not exposed yet.  BUG=angleproject:1332 Change-Id: I115d872557db38d8dd94cc367038668406719109 Reviewed-on: https://chromium-review.googlesource.com/332026 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Ian Ewell <ewell@google.com>, 23355681, 619, 169, 619
Update internal AttributeMap type to EGLAttrib.  Newer EGL functions use EGLAttrib to pass in attributes which can be either 32-bit or 64-bit depending on the system while the old attributes are passed in as EGLints which are usually 32-bits. To support these newer functions AttributeMap now uses EGLAttrib internally instead of EGLint and all the code using AttributeMap has been updated to cast properly.  BUG=angleproject:1348  Change-Id: I7c4dd9ef23ea1b1741f3a565502fb5e26bf962d7 Reviewed-on: https://chromium-review.googlesource.com/337162 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Ian Ewell <ewell@google.com>, 23355681, 619, 169, 619
Fix buffer mapping validation and refactor entry points  Checks for extension support are added to GetBufferPointervOES mapBufferOES unmapBufferOES mapBufferRangeEXT and flushMappedBufferRangeEXT.  The GetBufferPointerv function now checks if state is queried from buffer object zero.  The code is also refactored so that validation happens in separate validation functions and the implementations are in Context functions.  BUG=angleproject:1101 TEST=dEQP-GLES3.functional.negative_api.state.get_buffer_pointerv      dEQP-GLES3.functional.*buffer*map* (no regression)  Change-Id: I0f439abd12c92c51324f2e5a31bf621f61534306 Reviewed-on: https://chromium-review.googlesource.com/336164 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Support ESSL structs containing samplers on D3D  Since HLSL can't natively handle samplers in structs samplers need to be extracted out of structs into separate variables in the translated shader code. In HLSL 4.1 samplers that were in structs go into the normal sampler arrays and are identified by index constants. In other HLSL versions samplers that were in structs are translated as uniform variables.  These transformations are done inside the HLSL output classes not as tree transformations. This helps to keep the uniform API provided by the shader translator intact.  Wherever a struct containing samplers is passed into a user-defined function the translated HLSL code passes the separate sampler variables alongside a struct where the samplers have been removed.  The D3D backend in libANGLE queries the uniform registers of any samplers that were in uniform structs and adds them to the register maps so that correct sampler state gets assigned to them.  The extracted sampler variables are prefixed with "angle_" instead of the usual "_" to prevent any name conflicts between them and regular variables.  BUG=angleproject:504 TEST=angle_end2end_tests      dEQP-GLES*.functional.shaders.struct.uniform.* (all pass)      dEQP-GLES*.functional.uniform_api.* (most now pass)  Change-Id: Ib79cba2fa0ff8257a973d70dfd917a64f0ca1efb Reviewed-on: https://chromium-review.googlesource.com/333743 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix ProgramParameteri validation  dEQP tests suggest that passing a value other than GL_FALSE or GL_TRUE to ProgramParameteri generates INVALID_VALUE. The code is also refactored so that the implementation of ProgramParameteri is in the Context object.  BUG=angleproject:1101 TEST=dEQP-GLES3.functional.negative_api.shader.program_parameteri  Change-Id: I432d19fb574e58a7e0059189ab5b1863de029cdc Reviewed-on: https://chromium-review.googlesource.com/336163 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "Gyp build support for Chrome OS."  http://build.chromium.org/p/tryserver.chromium.linux/builders/linux_chromium_chromeos_rel_ng/builds/189745  ../../third_party/angle/src/libANGLE/renderer/gl/glx/DisplayGLX.cpp:87:27: error: assigning to 'Display *' (aka '_XDisplay *') from incompatible type 'EGLNativeDisplayType' (aka 'long')     mXDisplay             = display->getNativeDisplayId();                           ^ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ../../third_party/angle/src/libANGLE/renderer/gl/glx/DisplayGLX.cpp:93:19: error: comparison between pointer and integer ('Display *' (aka '_XDisplay *') and 'EGLNativeDisplayType' (aka 'long'))     if (mXDisplay == EGL_DEFAULT_DISPLAY)         ~~~~~~~~~ ^  ~~~~~~~~~~~~~~~~~~~  TBR=kbr@chromium.org TBR=jmadill@chromium.org BUG=angleproject:1297  This reverts commit b5aa26bda986d7f367ed4c33e50e931e9620abe9.  Change-Id: Icf3bd84df4493e66e78f8351b1a3879893ae9d0e Reviewed-on: https://chromium-review.googlesource.com/336849 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Re-land "D3D11: Implement dirty bits for VertexArray11.""  Translated attributes are now stored in the VertexArray11 in a cache and only updated when dirty bits change. Currently dynamic attributes must be re-translated every call so these are stored in a list and processed repeatedly.  This skips doing a lot of the VertexDataManager work for vertex attributes that don't change between draw calls.  Current value attributes which correspond to disabled attributes that the program will pulls vertex data from are owned by the Context so these need to be handled outside of the VertexArray11.  Further changes will be necessary to reduce the redundant work we do in the InputLayoutCache. We shouldn't need to re-check the cache if nothing relevant changed.  This give about a 23% performance improvement on the draw call benchmark on my machine.  Re-land with a fix for the start vertex offset.  BUG=angleproject:1327  Change-Id: Ic23e48fb18ed7f29c1999914a2f799ac04aa03e9 Reviewed-on: https://chromium-review.googlesource.com/334225 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Mark mRenderer as unused in Stream11.  BUG=angleproject:1332  Change-Id: I122f1b079e6d507423719df4576d7460e058f4b2 Reviewed-on: https://chromium-review.googlesource.com/336696 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add support for EGL_KHR_stream.  EGL_KHR_stream is now implemented. Since the extension does not come with any producers or consumers it does not have much functionality and the implementation is therefore very simple (validation layers and a new object to store some attributes). This however add the groundwork to add the appropriate consumer and producer extensions to stream D3D NV12 textures directly into ANGLE which will significantly improve video performance on Chromium on D3D-based platforms.  BUG=angleproject:1332  Change-Id: Ie240c73869f5098d1215cc5e27aa5decd06c3ed1 Reviewed-on: https://chromium-review.googlesource.com/330003 Commit-Queue: Ian Ewell <ewell@google.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Insert slash when concatenating paths.  BUG=angleproject:1343  Change-Id: I04180135dcd3aac2d40dc3f6d32b1aad362c69d1 Reviewed-on: https://chromium-review.googlesource.com/334920 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Implement gl_VertexID  BUG=angleproject:1217  Change-Id: Ibb9423d7de4966bce231734925a804b6340b5059 Reviewed-on: https://chromium-review.googlesource.com/321420 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix samplerParameter validation  Refactor the validation out from the API and into a separate Validate function. Also check the sampler parameter first to match dEQP expectations.  BUG=angleproject:1101 TEST=dEQP-GLES3.functional.negative_api.shader.sampler* (all pass)  Change-Id: I5f4072d9e52d37f741bd4c90f1bffe13371af3f5 Reviewed-on: https://chromium-review.googlesource.com/336162 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Suppress end2end failures for the new Linux Intel bot.  Since this is a new bot we should make it green ASAP so we can catch any new regressions.  BUG=angleproject:1346  Change-Id: I2c1288b8115a9d7980d5a3f37753b35cbb837486 Reviewed-on: https://chromium-review.googlesource.com/336050 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add ANGLE_TRY macros to reduce boilerplate with gl/egl Errors.  The macros don't need to disambiguate between GL/EGL. Also make helpers to deal with ErrorOrResult.  BUG=angleproject:1310 BUG=angleproject:1327  Change-Id: I8041c4b17a859fe1f236bca3ad266453d67a8fd4 Reviewed-on: https://chromium-review.googlesource.com/335826 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix C4434 warnings about 32-bit shift assigned to 64-bits  VS 2015 has a new or louder warning about 32-bit shifts that are then assigned to a 64-bit target. This code triggers it:  int64_t size = 1 << shift_amount;  Because the '1' being shifted is a 32-bit int the result of the shift will be a 32-bit result so assigning it to a 64-bit variable is just misleading.  In other cases the destination is a size_t which means that the warning only shows up on 64-bit builds. However in this case the size_t was later cast to a 32-bit type so the warnings can be suppressed by selecting more natural types and *deleting* some casts. The two warnings were:  C4334: '<<': result of 32-bit shift implicitly converted to 64 bits   third_party\angle\src\tests\gl_tests\framebufferrendermipmaptest.cpp(90)   third_party\angle\src\tests\gl_tests\framebufferrendermipmaptest.cpp(156)  BUG=593448  Change-Id: Ice9f67096b155fbb5fa3247ad04ac41acffa36a5 Reviewed-on: https://chromium-review.googlesource.com/336332 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Re-land "Clean up Buffer11."  This cleans up some messy stuff from the emulated index buffers which were caching variables that didn't need to be cached.  Also add in missing error checks. This touches a lot of code.  Re-land with a fix for clang-win build.  BUG=angleproject:1327 BUG=angleproject:1310  Change-Id: I31ed81c7242782bef7c5f6cde2192552f7ff9403 Reviewed-on: https://chromium-review.googlesource.com/336052 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Clean up Buffer11."  Fails Clang-win because of std::forward  ..\..\third_party\angle\src\libANGLE/Error.h(6040):  error: no matching function for call to 'forward'  BUG=598944 BUG=angleproject:1327 BUG=angleproject:1310  This reverts commit 041d678b4764484386f934df927f00a5df48a351.  Change-Id: I9fb0685cd01090b1faf8417ffa3c9b49eeb4510e Reviewed-on: https://chromium-review.googlesource.com/336040 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Clean up Buffer11.  This cleans up some messy stuff from the emulated index buffers which were caching variables that didn't need to be cached.  Also add in missing error checks. This touches a lot of code.  BUG=angleproject:1327 BUG=angleproject:1310  Change-Id: Icd722d57d9449388fbabc62c7ea37f0526a568ff Reviewed-on: https://chromium-review.googlesource.com/334731 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move -lrt where it belongs.  Only deqp uses librt so the dependency belongs there not in util.gyp and the condition should be OS==linux not use_x11. This lets things work on Chrome OS.  BUG=angleproject:1297  Change-Id: If397da5463b9c2d5217eb3b20841fa5a44bf56a3 Reviewed-on: https://chromium-review.googlesource.com/334813 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Fix warning introduced in "Program::getUniformInternal: return only one array element"  The warning does not seem to occur on the Chromium bots but shows when compiling ANGLE standalone.  BUG=595836  Change-Id: I3c22bbea263223f9e92f82229817e9e9894a46ad Reviewed-on: https://chromium-review.googlesource.com/335576 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Validate program changes wrt transform feedback  UseProgram can't be called while transform feedback is active and unpaused. Validate this by checking the presence of active transform feedback in UseProgram.  LinkProgram or ProgramBinary can't be called while transform feedback associated with the program is active. Validate this by going through all of the existing transform feedback objects when one of these functions is called and checking whether they are associated with the program being changed. A program association is added to gl::TransformFeedback to facilitate this.  BeginTransformFeedback can't be used to unpause a transform feedback object so code for that is removed.  The validation of the entry points touched in this patch is refactored to follow the current convention of separate Validate* functions though with LinkProgram following this convention fully isn't practical.  This patch also makes sure that ANGLE doesn't invoke behavior that the GL spec doesn't specify if a program object associated with a paused transform feedback is deleted.  Tests are edited so that they don't call UseProgram when it generates an error.  BUG=angleproject:1101 TEST=dEQP-GLES3.functional.negative_api.shader.* (2 more tests pass)      dEQP-GLES3.functional.transform_feedback.* (no regressions)      angle_end2end_tests  Change-Id: I2e5b3a027ced11249b762ec01a29fa41d2c0dd96 Reviewed-on: https://chromium-review.googlesource.com/332141 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Program::getUniformInternal: return only one array element  Reland with a compilation fix for GPU Builder with a fix for UniformTest.BooleanArrayUniformStateQuery and better formatting.  When getUniformInternal detected a mismatch between the glGetUniform type and the uniform type it entered a code path where it wrongly wrote the whole array instead of a single element causing a buffer overflow.  Adds a regression test.  BUG=595836  Change-Id: Ie860b87ad56046483650f457457116cc22bf3c0f Reviewed-on: https://chromium-review.googlesource.com/334448 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add DisplayGL::getDriverVersion and implementation on Linux NVIDIA  Some GPU driver bug workarounds should be active only for specific driver version ranges. This adds NVIDIA Linux driver detection using the XNVCtrl X11 extension.  BUG=590870  Change-Id: I8cbf692a0c8a6da7473169f29d720bdc2d07663d Reviewed-on: https://chromium-review.googlesource.com/329637 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Re-land "Validate that attrib offsets don't overflow buffers."  During draw calls we wouldn't add the current attrib offset to the required draw call size when checking attributes. This could lead to us producing warnings in the D3D11 runtime and miss returning some errors.  Re-land with a test data initialization fix and with some extra tests merged from another CL.  BUG=angleproject:1339  Change-Id: Ifd549c3b1f6871417dc1693cb3ec534414e92cfd Reviewed-on: https://chromium-review.googlesource.com/333723 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add validation for DrawRangeElements end < start  end < start must generate an INVALID_VALUE error. Before this patch INVALID_OPERATION was generated from the check which validated the actual index range against end and start in this case.  BUG=angleproject:1101 TEST=dEQP-GLES3.functional.negative_api.vertex_array.*      (few more subtests pass)  Change-Id: Ida9c5a8bc9dc416f1955e9012e5715c0848a0307 Reviewed-on: https://chromium-review.googlesource.com/332143 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Gyp build support for Chrome OS.  Don't hard code "chromeos" to zero. Fix incorrect assumptions that X11 would always be used on linux. Introduce "angle_use_drm" as the Chrome OS alternative to "angle_use_x11." Define USE_OZONE for Chrome OS. Allow overriding pkg-config.  BUG=angleproject:1297  Change-Id: Ie85b5c37f39170e0d11f8fc1bb70c175db6ee334 Reviewed-on: https://chromium-review.googlesource.com/323610 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Don't enable/disable sRGB on GLES.  glEnable/glDisable GL_FRAMEBUFFER_SRGB isn't meaningful on GLES.  BUG=angleproject:1300  Change-Id: I0afd697ed9770e2eb1cdcc851884b90de1a4583c Reviewed-on: https://chromium-review.googlesource.com/334490 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Revert "Program::getUniformInternal: return only one array element"  It breaks compilation on GPU Builder  This reverts commit 3ea54ba890f25fcce9213d8ab7c7f8a9fdf10cad.  Change-Id: Ie18f876b1db353d75cbd5a612f0a433cfc552ef2 Reviewed-on: https://chromium-review.googlesource.com/334405 Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix state query for DEPTH_STENCIL attachment properties  Add missing negation to validate the existence of a DEPTH_STENCIL attachment correctly.  BUG=angleproject:1101 TEST=dEQP-GLES3.functional.state_query.fbo.framebuffer_attachment_x_size_rbo      dEQP-GLES3.functional.negative_api.state.get_framebuffer_attachment_parameteriv  Change-Id: I278875684fdff562d16faba9a7eca0aa83bf80e9 Reviewed-on: https://chromium-review.googlesource.com/329867 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Skip the dEQP GLES3 functional.ubo tests on Linux.  We previously marked them as failing but they are causing a crash so we skip them until they are fixed.  BUG=angleproject:1323  Change-Id: I717e402d56ea88ef93da50d10803d0a62aa58fdf Reviewed-on: https://chromium-review.googlesource.com/331281 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: Clean up InputLayoutCache.  This change does a couple things. First it uses the 'active attribs' mask in the gl::Program to sort the translated attributes instead of checking the translated attribute themselves. This means we don't have to consult the 'active' field of the translated attributes which in turns means we don't have to update the active field in the attributes which breaks the dependency of the attributes on the gl::Program.  Second use a dynamically sized array for storing the cached vertex attributes in the InputLayoutCache. This is nice because it means we don't have to store the size of the array separately.  Also some other refactoring cleanups. Refactoring change only.  BUG=angleproject:1327  Change-Id: Iab22de92840b30674b92eca72e450673ed9f6d6d Reviewed-on: https://chromium-review.googlesource.com/330172 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Remove RTV and DSV cache vars from Renderer11.  These were only referenced by the StateManager11. Instead of using these cache variables ensure the StateManager11 marks the RT as dirty and apply the RenderTarget state.  Also remove the RenderTarget setters from Renderer11 and don't unapply RTs after a one-time set operation. The StateManager11 should take care of updating the necessary changes itself.  BUG=angleproject:1321  Change-Id: Idc8d22ea9e92ac8d07392ab10d067df6084403bb Reviewed-on: https://chromium-review.googlesource.com/330462 Reviewed-by: John Bauman <jbauman@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Make copyDepthStencil more robust to texture format table changes  This will make it easier to verify changes to integer texture DXGI formats. Currently the DXGI format info table contains some values that wouldn't make sense after the integer formats are changed such as R32_TYPELESS being recorded as a depth format and we need to make sure no code relies on this kind of information to make changing the table safe.  Includes cleaning up unused depth/stencil offset fields from DXGIFormatInfo.  BUG=angleproject:1244 TEST=dEQP-GLES3.functional.fbo.blit.*depth*  Change-Id: I0149f28e4c6f961af99ac2f5a656f3fbfe13aee6 Reviewed-on: https://chromium-review.googlesource.com/328964 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add support for READ_BUFFER and SAMPLER_BINDING queries  BUG=angleproject:1101 TEST=dEQP-GLES3.functional.state_query.integers.* (all pass)  Change-Id: I3a70335eeaef39822700ff639443a59849ed53fa Reviewed-on: https://chromium-review.googlesource.com/329866 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Return the correct count from getAttachedShaders  The count should be the total amount of shader ids written. Before this patch the code used to write the amount of attached shaders to count regardless of the value of maxCount.  BUG=angleproject:1101 TEST=dEQP-GLES3.functional.state_query.shader.*  Change-Id: I5ae729748c7809f03fd496c927a76f60398d2b42 Reviewed-on: https://chromium-review.googlesource.com/329865 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D: Refactor VertexDataManager attribute storage.  Instead of splitting attributes into 'active enabled' and 'active disabled' split them into static/dynamic/direct/current value and handle each group invidually. This also will allow the dirty bits code to call in to the VertexDataManager separately for each type of necessary vertex data translation and skip it entirely for direct buffer storage.  Should be a refactoring patch only.  BUG=angleproject:1327  Change-Id: I53cb5672054d99ae68e9aa2e5a3c046a002e360d Reviewed-on: https://chromium-review.googlesource.com/330171 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D: Use a single D3D buffer per static vertex attribute.  The current caching logic stores multiple static attributes in a single buffer if the attributes share a D3D buffer - sometimes. If a buffer is 'committed' (has been used in a draw) then we would make a new D3D buffer for the next set of static attributes.  Instead use a simpler scheme of a single D3D buffer for each static attribute. Also change rx::VertexBuffer to a reference counted class. This simplifies the caching logic for static vertex buffers (translated attributes) considerably. We only need to release the buffers when the ref count is zero and ensure we track the ref count correctly when bound to D3D.  This leads the way towards using a simpler dirty bit scheme for intelligent state updates and less overhead doing work with buffer state updates.  BUG=angleproject:1327  Change-Id: I99461d50b9663024eaa654cd56b42a63f1416d08 Reviewed-on: https://chromium-review.googlesource.com/330170 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update eglext.h to latest.  The new header contains EGL_NV_stream_consumer_gltexture_yuv which will be implemented in the future for video rendering purposes.  BUG=angleproject:1332 Change-Id: Ia35ee7360b8f09703ad2800c641c67f0f243e927 Reviewed-on: https://chromium-review.googlesource.com/330278 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Ian Ewell <ewell@google.com>, 23355681, 619, 169, 619
Program/ShaderGL: handle empty info logs  The GL driver can sometimes have an empty info log and return an info log length of 0. This would cause a vector to be initialized with a length of 0 just before it's .data() pointer was used causing a segfault.  BUG=angleproject:1323  Change-Id: Iaf9b569ec64a90c714a213562e427fb7cc8daa6b Reviewed-on: https://chromium-review.googlesource.com/330197 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: Get mip generation function from ANGLE format  This is done to make it possible to change some of the DXGI formats of integer textures without affecting their mip generation function associations.  BUG=angleproject:1244 TEST=angle_end2end_tests      dEQP-GLES3.functional.texture.mipmap.*generate* (all pass)  Change-Id: Ie83dd0e1883e9d8e267fbd4bf54b1e466fb0b210 Reviewed-on: https://chromium-review.googlesource.com/328963 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Remove getDXGIFormat() function from RenderTarget11  This query would return either the RTV format the DSV format or the texture format depending on the render target. This made the code hard to understand.  getDXGIFormat() calls are replaced by querying the ANGLE format and explicitly choosing which associated DXGI format to query info for (RTV format or DSV format).  This refactoring makes changing some format associations for integer texture formats easier in the future.  BUG=angleproject:1244 TEST=angle_end2end_tests      dEQP-GLES3.functional.fbo.blit.* (no regressions)  Change-Id: Ibe3c03fc6b7768af1a131d4df3909a1e20a71228 Reviewed-on: https://chromium-review.googlesource.com/329102 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
D3D11: Associate ANGLE formats with GL internal formats  Add a corresponding GL internal format to ANGLE format set. This is one step on the way to removing the problematic DXGI format to GL format mapping. This will also make it possible to stop storing the DXGIFormat field in RenderTarget11. The DXGIFormat field in RenderTarget11 can currently carry either the DSV format the RTV format or the texture storage format of the resource it is managing which makes code using it hard to understand.  Also fills in missing componentType for some compressed ANGLE formats in texture_format_data.json.  BUG=angleproject:1244 TEST=angle_end2end_tests  Change-Id: I87eedca8736aeface3fa6a0ec3c9d355cf006b24 Reviewed-on: https://chromium-review.googlesource.com/328961 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix texture and sampler state queries  Round MAX_LOD / MIN_LOD values correctly according to section 6.1.2 of GLES 3.0.4 and add code for COMPARE_MODE and COMPARE_FUNC.  BUG=angleproject:1101 TEST=dEQP-GLES3.functional.state_query.texture.* (all pass)      dEQP-GLES3.functional.state_query.sampler.* (all pass)  Change-Id: I6043c308c23997513d5de70510a0267419dd1868 Reviewed-on: https://chromium-review.googlesource.com/330112 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
D3D11: Don't use DXGI to GL format map in copy functions  The swizzle or copy shader needs to be chosen according to the component type of the source SRV. Before this patch the component type was obtained by going through the mapping from the SRV DXGI formats to GL formats.  This mapping is problematic because it has entries that don't really make sense like R16_UNORM and R16_TYPELESS formats being mapped to GL_DEPTH_COMPONENT16. This is an issue particularly because these formats will be used for integer RED textures in the future. For this reason the mapping should be removed.  In the case addressed by this specific commit rather than look up the component type of the SRV indirectly through the GL format table using the GL internal format that corresponds to the DXGI format just use the component type of the DXGI format. The depth+stencil swizzle cases where the component type is not well defined are handled as a special case.  BUG=angleproject:1244 TEST=angle_end2end_tests      dEQP-GLES3.functional.texture.swizzle.* (all pass)      dEQP-GLES3.functional.fbo.blit.* (no regressions)  Change-Id: I39fb8a14921b89d299e0077b3bea8b4e66ef218d Reviewed-on: https://chromium-review.googlesource.com/329103 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix RGBA32_UNORM integer vertex attribs.  This formats were mistakenly listed as having no conversion necessary in the vertex formats table. Fix is to mark them as CPU-converted.  This bug would only occur for 'direct' storage attributes not those that were dynamically streamed.  BUG=angleproject:1331  Change-Id: Ifa51b47d75e2f5bc762a718587470950cf195cb4 Reviewed-on: https://chromium-review.googlesource.com/329999 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix overlapping vertex shader signatures.  For the case of drawing with un-normalized integer vertex attributes we need to do some dynamic conversion in the VS. However each attribute can either be signed or unsigned and our shader signature code would treat both as a match giving rise to a warning in the D3D11 Debug runtime. It's unclear if this would give incorrect results but it certainly should not produce a warning.  BUG=angleproject:1329  Change-Id: I302d11b44e8a0ef981e89c181aefac5451a899b7 Reviewed-on: https://chromium-review.googlesource.com/329998 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
D3D: Refactor VertexBuffer::getSpaceRequired.  By making this a virtual call to BufferFactoryD3D (aka RendererD3D) we can also stop having side-effects in the BufferD3D class of creating a static buffer storage when we only want to know the space required for some vertex elements.  This refactoring will aid implementation of VertexArray11 dirty bits.  BUG=angleproject:1327  Change-Id: I0e34c6e9f5da35edebc179d578ad9392dc0166db Reviewed-on: https://chromium-review.googlesource.com/329741 Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Use static_cast instead of reinterpret_cast for nullptr  reinterpret_cast should not be used to cast nullptr_t. This should fix clang and also stops IntelliSense from complaining.  TEST=build on Windows  Change-Id: I4ba342172e36941f6a234fa4ed1369010527a790 Reviewed-on: https://chromium-review.googlesource.com/329901 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D: Make directStoragePossible a local static method.  This method doesn't need to call through to the VertexBuffer class since in only really depends on vertex format caps. This makes the code local to the VertexDataManager the only place it is used.  Refactoring patch only for VertexArray11 dirty bits.  BUG=angleproject:1327  Change-Id: I315313a72a00186930d7f9b1091ccb91f37f9f96 Reviewed-on: https://chromium-review.googlesource.com/329740 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add wildcard suppression for flaky dEQP GLES3 tests on Linux  BUG=angleproject:1323  Change-Id: Idcd49f9744db6ea282ccc2b4fbb932642b1c4c49 Reviewed-on: https://chromium-review.googlesource.com/329738 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix a bug in EGLPresentPathD3D11Test  This test was releasing a resource created with a queried device after it released the D3D11 device. It is problematic because the error was not caught by the swarming tests on the trybots but did show up on the Intel bot because it was not a swarming test.  BUG=589851 BUG=angleproject:1219  Change-Id: I7383640df9794aaf0e32e0a7c276ae3b22232050 Reviewed-on: https://chromium-review.googlesource.com/330001 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Suppress some failing end2end_tests on Intel.  BUG=589851  Change-Id: Ia580cee30e6842aaddb4683025f425166f0f6120 Reviewed-on: https://chromium-review.googlesource.com/329735 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Suppress some failing end2end_tests on Intel."  This reverts commit 7208f6994cf7d810c2226965362aad43d2a66f53.  Still some failures on Intel requires a slightly different solution.  BUG=589851  Change-Id: I6ac6599249e9e0f6319c917e04734cd48ca9274d Reviewed-on: https://chromium-review.googlesource.com/329734 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11 Texture refactoring: Store ANGLEFormat in TextureStorage11  This is needed to enable removing GetDXGIFormatInfo calls which are difficult to use correctly due to a texture format being associated with multiple DXGI formats. This is done in preparation of changing some of the DXGI formats associated with integer textures.  BUG=angleproject:1244 TEST=angle_end2end_tests      dEQP-GLES3.functional.fbo.* (no regressions)  Change-Id: I992c4c06189887c1b9de02f9b63dd9a474fcffab Reviewed-on: https://chromium-review.googlesource.com/329094 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
fix texture size check in WindowSurfaceCGL::swap  BUG=angleproject:1233  Change-Id: I92fddf331fe0687b290606fe222863bd0fcbc2da Reviewed-on: https://chromium-review.googlesource.com/329804 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Names of built-in functions cannot be redeclared as functions  With ESSL 3.00 names of built-in functions cannot be redeclared as functions and therefore an error needs to be generated if a built-in function is overloaded.  This is fixed by inserting unmangled built-ins into a special set in the symbol table and checking if function declarations match any of the built-ins in the set.  The regular symbol table structures can't be used for storing the unmangled names because that interferes with name hashing in OutputGLSL.  Credit goes to Arun Patole apatole@nvidia.com for initially investigating this issue and developing the first version of the patch.  BUG=angleproject:1066 TEST=angle_unittests dEQP-GLES3.functional.shaders.functions.invalid.overload_builtin_function* (2 tests started passing with this change)  Change-Id: I28c8325f5a3a8f4a97226b0dfdbb9762724fa609 Reviewed-on: https://chromium-review.googlesource.com/328994 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
floating point perf improvement in CopyNativeVertexData  In the CopyNativeVertexData template function in the else clause use memcpy/memset rather than for loops.  This is a performance improvment for floating point versions of CopyNativeVertexData particularly on 32-bit Firefox where the -arch:IA32 compiler option used cause the compiler to generate fld/fstp operations inside the for loops.  Update AUTHORS & CONTRIBUTORS to include AMD.  BUG=angleproject:1317  Change-Id: I7133fc476028284f56783f4e2f9e2395f6227514 Reviewed-on: https://chromium-review.googlesource.com/327590 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix a memory leak in the Query11 class.  The destructor did not release D3D objects that could be in the mPendingQueries list when the destructor is called. This fix now iterates through the list and releases them.  BUG=angleproject:1325  Change-Id: Ia3bd2a8a611f8dbf85051ab5bfea18ab72038af5 Reviewed-on: https://chromium-review.googlesource.com/329426 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Ian Ewell <ewell@google.com>, 23355681, 619, 169, 619
Remove a few GetDXGIFormatInfo queries  It's needlessly complex to query texture info when determining whether a format is a depth/stencil format. It can be tested simply by checking if the dsvFormat field of the format set is set.  BUG=angleproject:1244 TEST=angle_end2end_tests      dEQP-GLES3.functional.texture.specification.*depth* (no regressions)  Change-Id: I76d008462564657328dae35d664be5f5e22238fa Reviewed-on: https://chromium-review.googlesource.com/329104 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Suppress some failing end2end_tests on Intel.  BUG=589851  Change-Id: I91588014784a8a9b75389aeb596923458c30d80a Reviewed-on: https://chromium-review.googlesource.com/329427 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add EGL tests to help troubleshoot environment problems  BUG=585132  Change-Id: I9d04ad1705f45280cc608f419dbbd56db44d4d80 Reviewed-on: https://chromium-review.googlesource.com/329324 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "D3D11 Texture refactoring: Store ANGLEFormat in TextureStorage11"  Failing Windows Debug WebGL tests:  https://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Debug%20%28NVIDIA%29/builds/13587  Seems to fail in and around:  [  FAILED  ] WebglConformance.conformance_renderbuffers_framebuffer_object_attachment (320392 ms) [ RUN      ] WebglConformance.conformance_renderbuffers_framebuffer_state_restoration  BUG=angleproject:1244 This reverts commit d72c61c66e75536681c5fb529a92a2ee2134f0f1.  Change-Id: Id84d6988bc1a3530d8dde4c36d18b735f3de06fc Reviewed-on: https://chromium-review.googlesource.com/329621 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11 Texture refactoring: Store ANGLEFormat in TextureStorage11  This is needed to enable removing GetDXGIFormatInfo calls which are difficult to use correctly due to a texture format being associated with multiple DXGI formats. This is done in preparation of changing some of the DXGI formats associated with integer textures.  BUG=angleproject:1244 TEST=angle_end2end_tests      dEQP-GLES3.functional.fbo.* (no regressions)  Change-Id: I820b8331e6f9aacfe9979b13118371687c5fca51 Reviewed-on: https://chromium-review.googlesource.com/329075 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add suppressions for dEQP-GLES3 on Linux  BUG=angleproject:1323  Change-Id: Id437ecd8c05e151558b66294f4c0946e0fee2df9 Reviewed-on: https://chromium-review.googlesource.com/329049 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Choose D3D11 swizzle formats in gen_texture_format_table.py  Making swizzle format data come from the ANGLE format table will make it easier to make changes that affect both swizzle formats and regular texture formats. Swizzle format is now specified manually for some tricky formats but for most it can be determined automatically from the ANGLE texture format info.  The ANGLE texture format info in texture_format_table.json is changed to facilitate this. The componentType field now captures only whether the data is normalized int or float and its signedness but not the width of the data type. Bit widths of the individual channels are recorded in a separate "bits" object for each ANGLE format entry.  Also a new 16-bit RGBA UNORM ANGLE format is added to support swizzling 16-bit normalized depth formats.  This change is mostly just refactoring but it fixes swizzling for formats which have less bits for alpha than other channels:  - RGB10_A2 - RGB10_A2UI - RGB5_A1  BUG=angleproject:1322 BUG=angleproject:1244 TEST=angle_end2end_tests      dEQP-GLES3.functional.texture.swizzle.* (all pass)  Change-Id: I87d8a9cc0b6569191f50c41754d77b20ca6afef9 Reviewed-on: https://chromium-review.googlesource.com/329074 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
dEQP: Mark while 'continue' tests as failing on Linux.  These tests seem to be flaky and now they are showing up in a bunch of CLs as failures.  BUG=angleproject:1324  Change-Id: I47c0e0895f8d87fba52084cf571fb453e5d996e0 Reviewed-on: https://chromium-review.googlesource.com/329279 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "dEQP: Mark while 'continue' tests as failing on Linux."  Accidentally committed GLES3 suppressions to a GLES2 file.  BUG=angleproject:1324  This reverts commit ea9b92f6ad24b8643322e0b5cf03eaccfe9b0e27.  Change-Id: I510f05350d397ced8c68c3ea74c8549062835641 Reviewed-on: https://chromium-review.googlesource.com/329335 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
dEQP: Mark while 'continue' tests as failing on Linux.  These tests seem to be flaky and now they are showing up in a bunch of CLs as failures.  BUG=angleproject:1324  Change-Id: Ie7dd70bde1490c8623910c6d319128ca1225990a Reviewed-on: https://chromium-review.googlesource.com/329156 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11 Texture refactoring: Add ANGLEFormat enumeration to C++ code  Texture formats that are internal to ANGLE can now be uniquely identified using the ANGLEFormat enum.  GetANGLEFormatInfo returns a structure with the DXGI texture formats associated with the ANGLE format.  For starters the ANGLEFormat enum is used when building texture info structures queried from GetTextureFormatInfo.  BUG=angleproject:1244 TEST=angle_end2end_tests  Change-Id: I58a2027a1d9b7a5621f943cc5ceeb88a858009e3 Reviewed-on: https://chromium-review.googlesource.com/328254 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
D3D11: Enable dirty bits for Framebuffer11.  This patch works using a notification scheme - whenever a Texture or Renderbuffer changes in such a way as to recreate its RenderTarget we pass a signal to the Framebuffer to invalidate some internal state. Everything is entirely tracked in the Renderer11 layer and the GL layer is left untouched.  A RenderTarget11 now tracks points to which it is bound and the Framebuffer11 is mostly responsible for managing those links.  The three locations where we notify a Framebuffer when its bound RenderTargets might be dirty are:   1) RenderTarget11::~RenderTarget  2) EGLImageD3D::copyToLocalRendertarget  3) TextureStorage11_2D::useLevelZeroWorkaroundTexture  This patch gives about a 10% score increase in the D3D11 draw call benchmark on my system.  BUG=angleproject:1260  Change-Id: Ide38aeadff4a2681bf5bd685e8ca3c9e2612a380 Reviewed-on: https://chromium-review.googlesource.com/327255 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix Array texture depth-stencil attachments.  We were missing support for these layer depth-stencil attachments. This fixes running a WebGL test for this feature.  BUG=angleproject:1260 BUG=angleproject:1315  Change-Id: Ida7d44ba1fe65d5da95d2db721e497bfa685db77 Reviewed-on: https://chromium-review.googlesource.com/327402 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Group D3D11 DXGI format info under a struct  This patch refactors how DXGI format info is stored. The goal is to make it easier to make changes that affect both swizzle formats and regular texture formats and make it easier to pass the format sets around.  BUG=angleproject:1244 TEST=angle_end2end_tests  Change-Id: I1cc220bccbbdde9200a41829fdc37c8ec123c6a1 Reviewed-on: https://chromium-review.googlesource.com/329072 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Remove renderFormat from TextureFormat structure  The renderFormat is only ever needed in renderer11_utils when determining which multisample sample counts a format supports. Determine the renderFormat in the context where it is needed instead of storing it in the TextureFormat structure. Extra fallbacks can also be removed from the code.  The D3D11FormatTablesTest is restructured so that it doesn't need to use the renderFormat field.  This refactoring is done to make it simpler to expand usage of the ANGLE format enumeration in the C++ code.  BUG=angleproject:1244 TEST=angle_end2end_tests      dEQP-GLES3.functional.fbo.* (no regressions)  Change-Id: I980152eb2f3fdaaa1cc5b08e3c9b695c1625e9e5 Reviewed-on: https://chromium-review.googlesource.com/328680 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix MSVS 2013 build  Implicit conversion from int to boolean was generating a warning on MSVS 2013.  Still useful to keep support around at least while build instructions recommend using MSVS 2013.  Change-Id: I6975198f4bc6740a745454375f422d9c67ffaea5 Reviewed-on: https://chromium-review.googlesource.com/329070 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Don't always sync all dirty object state on update.  This leads to a problem where we're synching objects out of order. For instance when we call SetImage we need to sync the pack state. But SetImage can affect the FBO state so we need to sync the FBO only after we've finished with SetImage.  Fix this by using a mask of dirty objects to sync instead of all of them always. This also has the side effect of deferring some syncs that don't have to be processed immediately.  BUG=angleproject:1260  Change-Id: I5678d8f967930d11b42a4309d209215be2bae963 Reviewed-on: https://chromium-review.googlesource.com/327259 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement dynamic cast to TIntermBranch * on TIntermNode  On the TIntermNode class there is no Derived *getAsDerived() for TIntermBranch. This is needed for the shader debugger to determine the node type.  BUG=angleproject:1320  Change-Id: I9ce07017ccdb206c06c296b003b31eab6c65653c Reviewed-on: https://chromium-review.googlesource.com/328281 Tryjob-Request: Tibor Ouden den <tibordenouden@gmail.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Clear SRV cache on keyed mutex texture unbind from TextureStorage11  If the calling code releases the keyed mutex after the unbind then D3D will unbind the SRV or RTV from the pipeline without notifying the cache. This allows the SRV to be destroyed which means that a subsequently-created SRV could have the same address. This would cause the new SRV to not be correctly bound to the pipeline if its slot is the same as the unbound SRV.  BUG=588000 Change-Id: I0ad1ba3706a6bcc1fee50745e6148c9b23e578f6 Reviewed-on: https://chromium-review.googlesource.com/328400 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: John Bauman <jbauman@chromium.org>, 23355681, 619, 169, 619
Refactor more Texture entry points to a consistent style.  TexImage SubImage and the Compressed variants were all taking a GL Context as the first parameter which is a layering violation and also caused problems with reworking how the sync works. Fix this by refactoring them in the same style as the CopyTex* entry points.  BUG=angleproject:1260 BUG=angleproject:747  Change-Id: Ibe5e87d0ebc790e2dcadb8ba153cf40fec73d1f6 Reviewed-on: https://chromium-review.googlesource.com/327258 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
dEQP: search for the data directory relative to the exe path.  BUG=580045  Change-Id: I58bfa9ab6766eaae756b3c0f4d28f545e86d543b Reviewed-on: https://chromium-review.googlesource.com/327306 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Replace GetDXGIFormatInfo with a GetDXGIFormatSizeInfo where possible  It's not always clear which format should be passed to GetDXGIFormatInfo since a resource is associated with multiple formats. In some cases one of the formats is typeless and one of them is typed which would return different type information depending on which one is used. In some cases one of the formats may even be a depth format while another is not. GetDXGIFormatSizeInfo will return correct data no matter which format associated with a certain resource is passed to it.  Remaining uses of GetDXGIFormatInfo will need to be addressed separately either making sure that they always use the format that makes sense in a given context or plumbing in the required information in some other way.  BUG=angleproject:1244 TEST=angle_end2end_tests  Change-Id: If3cb03ab68d27743b1fdeb539234ec621dfa3c04 Reviewed-on: https://chromium-review.googlesource.com/328230 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Corrections to GLES sRGB formats.  This stops Mesa from complaining when using GLES 3.0 in the back end.  BUG=angleproject:1301  Change-Id: Ib9c0397586a11c407c6aa9ad1544e12b43dd08a7 Reviewed-on: https://chromium-review.googlesource.com/324031 Tryjob-Request: Frank Henigman <fjhenigman@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Mark sampler metadata clean when it is updated  This was accidentally left out of the patch:  "Pass texture base level to shaders on D3D11"  TEST=angle_end2end_tests      angle_perftests on d3d11 BUG=587846  Change-Id: I5d801288303cf0e0a3d52c1314aca95c47f02e25 Reviewed-on: https://chromium-review.googlesource.com/328960 Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add initializer function to more texture formats  All GL RGB formats that ANGLE stores as RGBA formats under the covers need to have their alpha channel set to 1. See GLES 3.0.4 table 3.24 for the relevant spec. In some cases this is handled by the dataInitializerFunction associated with the format. Previously some texture formats had the function set correctly but not all.  Associating formats with the datainitializerFormat is now a responsibility of the gen_texture_format_table.py script. The new automation there makes sure that all GL RGB formats emulated with RGBA formats get a data initializer function.  Tests are added in end2end_tests for most of the RGB formats.  BUG=angleproject:1318 TEST=angle_end2end_tests  Change-Id: Iad860357f33d87c625445ea6c58a53af47e0b547 Reviewed-on: https://chromium-review.googlesource.com/328253 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add a few missing newlines at eof.  Change-Id: Ie4b0811be8fe2d075a8854f1b9d318f7cb747cd1 Reviewed-on: https://chromium-review.googlesource.com/320930 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove AnyDevice from gen_texture_format_table  This makes the generated code easier to read.  BUG=angleproject:1318 BUG=angleproject:1244 TEST=angle_end2end_tests  Change-Id: I6f232f3b8959cf8c72efb1e68b3fae6358b7b698 Reviewed-on: https://chromium-review.googlesource.com/328252 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Split texture_format_data.json into two files  After this change texture_format_map.json maps the GL internal formats to an enumeration of formats that is internal to ANGLE.  Each ANGLE format specifies a unique combination of DXGI formats and what type of data the format contains. In the future the ANGLE format could be used instead of DXGI format inside C++ code to identify which type of data a resource contains. This becomes useful when a GL format is associated with multiple DXGI formats which may have different type information (for example depth vs. red integer vs. float).  texture_format_data.json is changed to only store data on these ANGLE formats.  BUG=angleproject:1318 BUG=angleproject:1244 TEST=gen_texture_format_table.py (no changes in autogenerated file)  Change-Id: I729c4a4d6fc66ee61598ef2d879e6785c85d40ab Reviewed-on: https://chromium-review.googlesource.com/328251 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Sort texture formats in gen_texture_format_table.py better  Sort the formats in a meaningful way so that even if the structure of the source files change the order can be maintained. This makes it easier to review further changes that affect the autogenerated texture format table.  BUG=angleproject:1318 BUG=angleproject:1244 TEST=angle_end2end_tests  Change-Id: Id3602a809137da43431144a31e36d4a0ed2e596e Reviewed-on: https://chromium-review.googlesource.com/328250 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Pass integer texture format bit count to shaders on D3D11  This will be needed in the future when integer texture wrap mode support will be added by sampling integer textures through FLOAT/UNORM/SNORM SRVs.  The bit count needs to be passed for 8- 10- and 16-bit textures. 32-bit integer textures are the ones left over. Only passing the bit counts for the absolute minimum number of formats avoids unnecessary driver constant buffer updates.  BUG=angleproject:1244 BUG=angleproject:1095 TEST=angle_end2end_tests  Change-Id: I28a84588842b2eb9a1661454437d21c22ce794b7 Reviewed-on: https://chromium-review.googlesource.com/326944 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add more const qualifiers in TextureStorage11  This makes the code easier to follow.  BUG=angleproject:1244 TEST=angle_end2end_tests  Change-Id: I7787b04217a6771629e69f6f67586f62ce5cfccf Reviewed-on: https://chromium-review.googlesource.com/327053 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Sync the D3D11 rasterizer state if pointDrawMode or multisample changes.  When drawing points culling is disabled to make sure the generated point sprites are not culled. Since there are no dirty bits for pointDrawMode or multiSample they were not being checked to ensure the rasterizer state was correct.  BUG=586531  Change-Id: I8fe60dd8d5bbc79b1bce2c0aa62c40cee560fe24 Reviewed-on: https://chromium-review.googlesource.com/327862 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use texture base level to implement textureSize on D3D11 HLSL  HLSL GetDimensions call doesn't take the texture base level into account so ANGLE needs to use the texture base level passed in uniforms to emulate ESSL textureSize() which does take it into account.  After this change the relevant dEQP tests pass on NVIDIA Intel is still suffering from an issue where a wrong value is returned when the lod is > 0 (tested on Intel HD Graphics 4600). AMD is also suffering from an unknown issue.  BUG=angleproject:596 TEST=dEQP-GLES3.functional.shaders.texture_functions.texturesize.*      (all pass on NVIDIA now) angle_end2end_tests  Change-Id: I13e33d126008ecdf2b89461a3fb5040949cf19e2 Reviewed-on: https://chromium-review.googlesource.com/322123 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Pass texture base level to shaders on D3D11  The base level is passed to shaders in an array included in the driver uniform block. This is done on feature levels above 9_3 which treat samplers as indices to sampler arrays in shaders.  A separate uniform block couldn't be used for the sampler metadata since that would bring the number of available uniform blocks down to below minimum level defined by GLES 3.0.  BUG=angleproject:596 TEST=angle_end2end_tests  Change-Id: Ie040521402f9996d51a978aeeba9222e9dd761ce Reviewed-on: https://chromium-review.googlesource.com/326290 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Initialize TextureState::usage.  This was probably omittted some time ago and was showing up as garbage in the debugger in some cases.  BUG=angleproject:1260  Change-Id: Ifca5243d0c94e7659a2245e327a72eed9dd918ab Reviewed-on: https://chromium-review.googlesource.com/327401 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Context virtualization for D3D11 queries  Queries in D3D11 are now virtualized such that they work as expected with multiple contexts. Timer queries now only time the operations that their context is responsible for and the operations of other contexts are ignored.  BUG=angleproject:657  Change-Id: I667de594bdb5831d126d5801c0e692ded4c88bf4 Reviewed-on: https://chromium-review.googlesource.com/327150 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Ian Ewell <ewell@google.com>, 23355681, 619, 169, 619
Clean up the style in TextureStorage11.  This is a pure refactoring change and should behave identically.  BUG=angleproject:1260  Change-Id: I44f5ef2f1444ffd8f8dd6ce55c266ec95781a6d8 Reviewed-on: https://chromium-review.googlesource.com/327266 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fixed clang build for InputLayoutCache.  Change-Id: I0757874fad5f665cf4629092ad2d0d5982ca4856 Reviewed-on: https://chromium-review.googlesource.com/327301 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implemented instanced rendering for emulated point sprites  Non-instanced PointSprite emulation for lower feature levels is implemented using D3D DrawIndexedInstanced and an instanced vertex buffer containing a pointsprite quad.  GL instanced rendering using glDrawArraysInstanced and glDrawElementsInstanced with pointsprite emulation is performed using a for-loop.  The loop iterates over each instance to render and adjusts the buffer offsets accordingly. This is not performant and is only used and required by this chosen pointsprite emulation method.  Indexed instanced (glDrawElementsInstanced) uses the same offset loop because the vertex buffer containing the data to be rendered has already been expanded using getEmulatedIndexedBuffer().  Expanding the buffer makes the two rendering operations similar enough to share code.  BUG=angleproject:1279 TEST=angle_end2end_tests  Change-Id: If46cc9f158e29f5518c70ad630b3228f474a9f8b Reviewed-on: https://chromium-review.googlesource.com/321407 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D11: Add a test to cover a clear RTV driver bug.  See dEQP-GLES3.functional.fbo.color.repeated_clear.sample.tex2d.rgba8  This test uses ClearRenderTargetView to clear various FBO textures but it does not seem to work correctly on my Nvidia configuration. It has been reported to Nvidia. It also seems to fail on Intel.  Current GPU: NVIDIA GeForce GTX 660 Current Driver: 10.18.13.5598 (9-13-2015) Works on Desktop OpenGL back-end also on AMD R5230  BUG=angleproject:1305  Change-Id: I4b53b7376faf71f234d05c90f4fb55462de23e36 Reviewed-on: https://chromium-review.googlesource.com/314304 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix texture swizzle cache initialization  Texture swizzle cache needs to be initialized so that the keys do not represent a valid swizzle state before any swizzled textures have been cached.  BUG=angleproject:1095 TEST=dEQP-GLES3.functional.texture.swizzle.* (all pass)  Change-Id: I66c10ed49134875d29b07852488a41a776e8fb67 Reviewed-on: https://chromium-review.googlesource.com/326971 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Avoid a copy in TextureStorage11::setData  This is essentially a reland of 9cf9bcbecaa1e54a47a92eb784e7f591f7b65c57  This code always allocates a new memory buffer for the texture memory picks a load function to copy/convert the input data into it and the uploads.  In the case where the input format matches the upload format we should be able to skip the allocation and copy and be much happier.  Change-Id: If4281aeb4cd7bbbebba60122a10610a916833052 Reviewed-on: https://chromium-review.googlesource.com/326852 Tryjob-Request: John Bauman <jbauman@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: John Bauman <jbauman@chromium.org>, 23355681, 619, 169, 619
Re-enable win_angle_x64_dbg_ng as a trybot target.  BUG=chromium:585270  Change-Id: I94b78d21aa700fbc7549f9f30534ba9f414780a3 Reviewed-on: https://chromium-review.googlesource.com/326924 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Re-enable win_angle_x64_dbg_ng as a trybot target."  This reverts commit b36b491c00924acfc03c71453833c442b7a22be6.  Forgot to restart the tryserver.chromium.angle waterfall to add this bot and now waterfall restarts are broken: http://crbug.com/585632 .  Change-Id: Id25ac99a54013a9dd1406d4680717bef12a75940 Reviewed-on: https://chromium-review.googlesource.com/327033 Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Re-enable win_angle_x64_dbg_ng as a trybot target.  BUG=chromium:585270  Change-Id: I9d95667d676f54bfe8901a428a6cb5eddf927819 Reviewed-on: https://chromium-review.googlesource.com/326830 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Increase the timeout on Timer queries tests.  On Mac the timer queries tests have flakiness as the tests may timeout before the query result is available. The time to wait before throwing a timeout error in the tests was therefore increased by a factor of 20.  BUG=585498  Change-Id: I55047ee7759e6d2dde69294df451202dfb498034 Reviewed-on: https://chromium-review.googlesource.com/327031 Commit-Queue: Ian Ewell <ewell@google.com> Reviewed-by: Ian Ewell <ewell@google.com>, 23355681, 619, 169, 619
Fix context virtualization for timer queries  In the current implementation of query virtualization queries are paused/resumed during draw calls. Timer queries however are affected by every OpenGL call so virtualization and context switches for timer queries must happen every time there is a context switch. Thus the logic for context-switching queries was moved to a new function in the GL state manager that is called everytime a makeCurrent call on the context is made. Since queries may be made after a context is made current the state manager needs to keep track of any new queries that are started in a context so an additional delegate function was added to the state manager that is called every time a glBeginQuery() call is made that adds the query object to a set. All the queries in that set are paused when a context switch is made and the queries in the new context are then loaded and resumed.  BUG=angleproject:1307  Change-Id: I4e596d83739274cb2e14152a39e86e0e51b0f95c Reviewed-on: https://chromium-review.googlesource.com/325811 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Ian Ewell <ewell@google.com>, 23355681, 619, 169, 619
Make the dEQP GTEST initialization failures red on swarming.  On swarming the dEQP GTEST initialization failures would show as green because the FAIL GTEST macro was called outside of a test. Use exit(-1) instead that shows up as red on the bots.  BUG=580045  Change-Id: Icf82a8593a11fe7e992778ffd8c682f6738c39a6 Reviewed-on: https://chromium-review.googlesource.com/326690 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add in GN the data dependencies required by the dEQP tests.  BUG=580045  Change-Id: I3424568c6b200d6b6eb9921c6c09a3b3c974d710 Reviewed-on: https://chromium-review.googlesource.com/326320 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
CollectVariables: Don't include block name in field name.  The spec mandates that the instance name of a block determines how the active uniform name for this field is reported. However our handling of this was a bit bugged. We would include the proper prefix on the compiler-side but this mangled the hashing and was also not strictly needed. We now also expose the instance name so we can determine the proper prefix for variable linking on the GL-side of things. This also is consistent with how we handle other spec issues where the GL-side handles the GL-API specific functionality.  This also allows us to fix name hashing of instanced uniform blocks which was previously broken because we would hash the full name of the active uniform instead of just the field.  BUG=angleproject:1306  Change-Id: I06ace6dbc3f75fdd8129677360dcc142aa89136e Reviewed-on: https://chromium-review.googlesource.com/326681 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove unused texture format source files  These files are not included in the build they have been replaced by autogenerated files.  TEST=build on Windows  Change-Id: I6b8448d6f2426bc05c01b7ec6db605e6047ee207 Reviewed-on: https://chromium-review.googlesource.com/326660 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Remove unreferenced member of Renderer11 mDepthStencilInitialized.  BUG=angleproject:1260  Change-Id: I3773297a4e517e2fca7072f56f3bdbec0a561d9a Reviewed-on: https://chromium-review.googlesource.com/326851 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Replace '> >' with '>>'  BUG=angleproject:1308  Change-Id: I00bd2ea939b633817662205eb7879efb7f99965f Reviewed-on: https://chromium-review.googlesource.com/326400 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Re-land "Implement EGL_experimental_present_path_angle"  - Re-land with clang fix.  This allows ANGLE to render directly onto a D3D swapchain in the correct orientation when using the D3D11 renderer.  The trick is to add an extra uniform to each shader which takes either the value +1.0 or -1.0. When rendering to a texture ANGLE sets this value to -1.0. When rendering to the default framebuffer ANGLE sets this value to +1.0. ANGLE multiplies vertex positions by this value in the VS to invert rendering when appropriate. It also corrects other state (e.g. viewport/scissor rect) and shader built-in values (e.g. gl_FragCoord).  This saves a substantial amount of GPU time and lowers power consumption. For example the old method (where ANGLE renders all content onto an offscreen texture and then copies/inverts this onto the swapchain at eglSwapBuffers() time) uses about 20% of the GPU each frame on a Lumia 630.  Verification: + dEQP GL ES2 tests pass when "present path fast" is enabled + all ANGLE_end2end_tests pass when "present path fast" is enabled  BUG=angleproject:1219  Change-Id: I56b339897828753a616d7bae837a2f354dba9c63 Reviewed-on: https://chromium-review.googlesource.com/326730 Tryjob-Request: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D11: Refactor RenderTarget apply into StateManager11.  This is a refactoring patch only and doesn't change the behaviour. The intent is to make it easy to turn on the Framebuffer dirty bits in a subsequent patch once we can cleanly handle textures and renderbuffers getting recreated.  BUG=angleproject:1260  Change-Id: Iaa5cfe222b020724e088eee5f1ae909b6f981a08 Reviewed-on: https://chromium-review.googlesource.com/325423 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Download GN in the gclient hooks.  Recently git cl format has started requiring GN and would fail when run in the ANGLE standalone repository because the binary was not present.  BUG=  Change-Id: I0482db6fd6a868dc02ef6e395e6ff4817623c291 Reviewed-on: https://chromium-review.googlesource.com/326420 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Implement EGL_experimental_present_path_angle"  Compile failure on Clang/Win:  The reason for reverting is: FAILED: ninja -t msvc -e environment.x86 -- "..\..\third_party/llvm-build/Release+Asserts/bin/clang-cl" -m32 /nologo /showIncludes /FC @obj\third_party\angle\src\tests\egl_tests\angle_end2end_tests.EGLPresentPathD3D11Test.obj.rsp /c ..\..\third_party\angle\src\tests\egl_tests\EGLPresentPathD3D11Test.cpp /Foobj\third_party\angle\src\tests\egl_tests\angle_end2end_tests.EGLPresentPathD3D11Test.obj /Fdobj\gpu\angle_end2end_tests.cc.pdb  In file included from ..\..\third_party\angle\src\tests\egl_tests\EGLPresentPathD3D11Test.cpp:7: In file included from ..\..\third_party\angle\src\tests\test_utils/ANGLETest.h:13: ..\..\testing\gtest\include\gtest/gtest.h(139216) :  error: comparison of integers of different signs: 'const int' and 'const unsigned int' [-Werror-Wsign-compare]   if (expected == actual) {       ~~~~~~~~ ^  ~~~~~~ ..\..\testing\gtest\include\gtest/gtest.h(142212) :  note: in instantiation of function template specialization 'testing::internal::CmpHelperEQ<int unsigned int>' requested here     return CmpHelperEQ(expected_expression actual_expression expected            ^ ..\..\third_party\angle\src\tests\egl_tests\EGLPresentPathD3D11Test.cpp(2819) :  note: in instantiation of function template specialization 'testing::internal::EqHelper<false>::Compare<int unsigned int>' requested here         ASSERT_EQ(mWindowWidth * 4 mappedSubresource.RowPitch);         ^ ..\..\testing\gtest\include\gtest/gtest.h(196032) :  note: expanded from macro 'ASSERT_EQ' # define ASSERT_EQ(val1 val2) GTEST_ASSERT_EQ(val1 val2)                                ^ ..\..\testing\gtest\include\gtest/gtest.h(194367) :  note: expanded from macro 'GTEST_ASSERT_EQ'                       EqHelper<GTEST_IS_NULL_LITERAL_(expected)>::Compare \                                                                   ^  BUG=angleproject:1219  This reverts commit 6b3c1db5170450bbc4946d8f18ba0d8619da43a0.  Change-Id: Ia67ab82dd13295dc03235d57fa417c73f20a49e6 Reviewed-on: https://chromium-review.googlesource.com/326680 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor InputLayoutCache::applyVertexBuffers.  The redesigned code places the internal buffers and input elements for instance point sprite emulation (FL9_3) at the start of the arrays instead of swapping with the first non-instanced element. This makes the tracking logic of the caching somewhat cleaner.  This facilitates the work of implementing instancing-on-instancing for FL9_3 conformance.  BUG=angleproject:1279  Change-Id: Ifb030816a313b1e8b916c57ef05915914443312a Reviewed-on: https://chromium-review.googlesource.com/325090 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Avoid a copy in TextureStorage11::setData"  Fails on the Windows builders:  https://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Win%20Builder/builds/42201  e:\b\build\slave\gpu_win_builder\build\src\third_party\angle\src\libangle\renderer\d3d\d3d11\load_functions_table_autogen.cpp(787) : error C2440: 'return' : cannot convert from 'const std::map<GLenumrx::LoadImageFunctionstd::less<_Kty>std::allocator<std::pair<const _Kty_Ty>>>' to 'const std::map<GLenumrx::d3d11::LoadImageFunctionInfostd::less<_Kty>std::allocator<std::pair<const _Kty_Ty>>> &'         with         [             _Kty=GLuint             _Ty=rx::LoadImageFunction         ]         and         [             _Kty=GLuint             _Ty=rx::d3d11::LoadImageFunctionInfo         ]         Reason: cannot convert from 'const std::map<GLenumrx::LoadImageFunctionstd::less<_Kty>std::allocator<std::pair<const _Kty_Ty>>>' to 'const std::map<GLenumrx::d3d11::LoadImageFunctionInfostd::less<_Kty>std::allocator<std::pair<const _Kty_Ty>>>'         with         [             _Kty=GLuint             _Ty=rx::LoadImageFunction         ]         and         [             _Kty=GLuint             _Ty=rx::d3d11::LoadImageFunctionInfo         ]         No user-defined-conversion operator available that can perform this conversion or the operator cannot be called  This reverts commit 52d3e43b66478b07d26c95a5511d4132cec26000.  Change-Id: I83774ea09ccbb2b92ff609714e1c7201beb775bc Reviewed-on: https://chromium-review.googlesource.com/326540 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix 3D ReadPixels with PBOs.  Pass the FBO attachment to the Buffer packing method so we can retrieve the layer of the attachment when doing an asynchronous readback. Also take advantage of the TextureHelper11 class to remove some redundant code.  BUG=angleproject:1290  Change-Id: I26bb21a03e0ff7a42aab4eee75f3c3d12915f398 Reviewed-on: https://chromium-review.googlesource.com/324021 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Avoid a copy in TextureStorage11::setData  This is essentially a reland of 9cf9bcbecaa1e54a47a92eb784e7f591f7b65c57  This code always allocates a new memory buffer for the texture memory picks a load function to copy/convert the input data into it and the uploads.  In the case where the input format matches the upload format we should be able to skip the allocation and copy and be much happier.  Change-Id: I3c1a0ab34be91c7d39eb2d0866029d01352b6056 Reviewed-on: https://chromium-review.googlesource.com/325526 Tryjob-Request: John Bauman <jbauman@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fail the dEQP tests early if the case list is not found.  BUG=580045  Change-Id: I917f62dca047ca163bfdbcc5437b2fc1d7a1e020 Reviewed-on: https://chromium-review.googlesource.com/326401 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add support for timer queries in D3D11  Timer queries without context virtualization are now supported in the Direct3D11 backend. Only the elapsed time portion of the GL extension is supported though due to limitations of D3D11 preventing a reliable implementation of the timestamp functionality. As a result of this the counter bits for the timestamp is set to 0 and any queries of the timestamp will always return 0.  BUG=angleproject:657  Change-Id: I51ca1a1a6bd6bc13155cebeacdca414b764db168 Reviewed-on: https://chromium-review.googlesource.com/325780 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement EGL_experimental_present_path_angle  This allows ANGLE to render directly onto a D3D swapchain in the correct orientation when using the D3D11 renderer.  The trick is to add an extra uniform to each shader which takes either the value +1.0 or -1.0. When rendering to a texture ANGLE sets this value to -1.0. When rendering to the default framebuffer ANGLE sets this value to +1.0. ANGLE multiplies vertex positions by this value in the VS to invert rendering when appropriate. It also corrects other state (e.g. viewport/scissor rect) and shader built-in values (e.g. gl_FragCoord).  This saves a substantial amount of GPU time and lowers power consumption. For example the old method (where ANGLE renders all content onto an offscreen texture and then copies/inverts this onto the swapchain at eglSwapBuffers() time) uses about 20% of the GPU each frame on a Lumia 630.  Verification: + dEQP GL ES2 tests pass when "present path fast" is enabled + all ANGLE_end2end_tests pass when "present path fast" is enabled  BUG=angleproject:1219  Change-Id: Ib6eeea46bafa6ebce4adada0ae9db3a433b8fc4c Reviewed-on: https://chromium-review.googlesource.com/321360 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove the _ANGLE targets from the GN build.  They are no longer needed by Chromium.  BUG=522967  Change-Id: I187eed52378a58f3ea24c3e21082c6a93e56da7f Reviewed-on: https://chromium-review.googlesource.com/325330 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: Transcode ETC1 to BC1.  Adds a new extension to allow transcode ETC formats to suitable BC formats. This commit implements ETC1 to BC1. More formats will be supported soon.  BUG=angleproject:1285  Change-Id: Iacbfbc2248dfe1aebf24b92696249a9404e331cd Reviewed-on: https://chromium-review.googlesource.com/316511 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Enable EGL_ANGLE_keyed_mutex on D3D11  Pbuffers created using eglCreatePbufferFromClientBuffer from share handles created using keyed mutexes can now have their keyed mutex queried. All other pbuffers will continue to be created without keyed mutexes.  BUG=337606  Change-Id: Id9039064dd8c89fe1706cc8ecb31111c994761fc Reviewed-on: https://chromium-review.googlesource.com/324253 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Pass texture base level to shaders on D3D11"  This reverts commit 3026829e155bd89b5ca5b7b7c5267699b9192557.  Change-Id: I0b4c3f5b1453b993b149423bb1ce407f4918cf54 Reviewed-on: https://chromium-review.googlesource.com/325435 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Pass texture base level to shaders on D3D11  The base level is passed to shaders in a uniform block created specifically for passing sampler metadata. This is done on feature levels above 9_3 which treat samplers as indices to sampler arrays in shaders.  BUG=angleproject:596 TEST=angle_end2end_tests  Change-Id: I846f2fc195ab1fd884052824ffd3c1d65083c0fb Reviewed-on: https://chromium-review.googlesource.com/322122 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
D3D11: Fix ReadPixels with layer 3D attachments.  Non-zero layer attachments are FBO attachments of 3D textures bound from a layer other than zero. These haven't ever worked AFAIK. Fix them by retrieving the correct layer from the FBO attachment.  Note: 3D attachments are still broken with PBO ReadPixels. The fix for those will come in a subsequent patch.  BUG=angleproject:1290  Change-Id: I5417e7374188dd320e1209d006723ce070f98561 Reviewed-on: https://chromium-review.googlesource.com/323472 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix basic ReadPixels from 3D attachments.  Use the TextureHelper class to abstractly handle 2D and 3d textures.  Also refactor the Image11 copy methods to be a bit cleaner and not use the copy conversion path when unnecessary.  This patch does not yet fix layer attachments - the fix for that will come up in a subsequent patch.  BUG=angleproject:1290  Change-Id: If8b7aa8848ca4260e0dde690e7a99e115a97fabb Reviewed-on: https://chromium-review.googlesource.com/323442 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add Debug labels to more D3D11 objects.  This makes debugging using graphics tools easier on Windows.  BUG=angleproject:1290 BUG=angleproject:1299  Change-Id: Ia3889c10fd8e23486f0122e0b567c470517bc9e0 Reviewed-on: https://chromium-review.googlesource.com/324821 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add an EGL spec for EGL_experimental_present_path_angle  BUG=angleproject:1219  Change-Id: I1e303ec30ffe877aebf00720620b818c335fac76 Reviewed-on: https://chromium-review.googlesource.com/310652 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Finish basic timer query support in GL backend  EXT_disjoint_timer_query is feature complete with the WebGL tests passing with Chromium using ANGLE as a backend. There is some flakiness in the timestamp query test on WebGL but investigation revealed a bug on Chromium's end and a fix is being made there. Since the extension is feature complete it is now enabled by default on OpenGL so that it can be regression tested.  BUG=angleproject:1265  Change-Id: If018b7e3ae84aff7e40c73ff8e672a86689ae6c4 Reviewed-on: https://chromium-review.googlesource.com/324580 Tryjob-Request: Ian Ewell <ewell@google.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Ian Ewell <ewell@google.com>, 23355681, 619, 169, 619
Remove win_angle_x64_dbg_ng tryserver.  This won't be mirrored on the waterfall for the time being due to lack of hardware.  BUG=542370  Change-Id: I2ecfde30f66d3dcdde2d05144d647c2b4b5c83d3 Reviewed-on: https://chromium-review.googlesource.com/325133 Tested-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Tell GN about the dependecy of dEQP tests on expectations  Without this gn-built isolates do not include the test expectations file in the isolate causing the test suite to bail out at startup. Also rename target_name to api_name as target_name is a special variable name when inside a target definition.  BUG=580045  Change-Id: I20be39c7e50e24757a0828f9056613e171f0002f Reviewed-on: https://chromium-review.googlesource.com/325040 Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Redesign samplers in shaders on D3D11  Translation of samplers to HLSL on D3D11 is changed as follows:  Instead of passing around HLSL sampler and HLSL texture references in shaders all references to ESSL samplers are converted to constant indices within the shader body. Each ESSL sampler is identified by an unique index. In the code generated to implement ESSL texture functions these indices are used to index arrays of HLSL samplers and HLSL textures to get the sampler and texture to use.  HLSL textures and samplers are grouped into arrays by their types. Each unique combination of a HLSL texture type + HLSL sampler type gets its own array. To convert a unique sampler index to an index to one of these arrays a constant offset is applied. In the most common case of a 2D texture and a regular (non-comparison) sampler the index offset is always zero and is omitted.  The end goal of this refactoring is to make adding extra metadata for samplers easier. The unique sampler index can be used in follow-up changes to index an array of metadata passed in uniforms which can contain such things as the base level of the texture.  This does not solve the issues with samplers in structs.  The interface from the point of view of libANGLE is still exactly the same the only thing that changes is how samplers are handled inside the shader.  On feature level 9_3 the D3D compiler has a bug where it can report that the maximum sampler index is exceeded when in fact it is not. This can happen when an array of samplers is declared in the shader. Because of this the new approach can't be used on D3D11 feature level 9_3 but it will continue using the old approach instead.  BUG=angleproject:1261 TEST=angle_end2end_tests      dEQP-GLES3.functional.shaders.texture_functions.* (no regressions)      dEQP-GLES3.functional.texture.units.* (no regressions)  Change-Id: I5fbb0c4280000202dc2795a628b56bd8194ef96f Reviewed-on: https://chromium-review.googlesource.com/320571 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com> Tryjob-Request: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix leak with binding Framebuffers directly.  Using BindFramebuffer(1) then GenFramebuffers would return 1. This leads to a memory leak and was something that was obscuring debugging a bug in my ReadPixels fix for ES3.  This also fixes a bug where running the texture tests along produces some random failures.  BUG=angleproject:1290 BUG=angleproject:1299  Change-Id: If11e8c743d2ddde725b12749ac012f670cd290e1 Reviewed-on: https://chromium-review.googlesource.com/324820 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix some override related warnings.  BUG=  Change-Id: I9e67ba2165ac87959f319fd2485fe385c60a8ea0 Reviewed-on: https://chromium-review.googlesource.com/324461 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Updated a few new passing tests in dEQP-GLES3.  Unknown when these started passing but they seem to be OK locally and on the bot.  BUG=angleproject:1095 BUG=angleproject:1097 BUG=angleproject:1101  Change-Id: Icf6102792b356cd23bf39414f75e796fe7e81879 Reviewed-on: https://chromium-review.googlesource.com/324940 Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
DisplayGLX: fix a SwapControl copy-paste error  BUG=angleproject:1304  Change-Id: If0ec8682b1d519bc6460cd6ed82f42c4c1ceb952 Reviewed-on: https://chromium-review.googlesource.com/324930 Commit-Queue: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Build GN dEQP iff "build_angle_deqp_tests==true"  BUG=580045  Change-Id: Id19f843e8a04d38938b6827a7a64970eb088bcc6 Reviewed-on: https://chromium-review.googlesource.com/324760 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
DisplayGLX: disable the GLES backend on Intel and NVIDIA  This is to fix failures in the automated testing while we work on them.  BUG=angleproject:1303  Change-Id: I0813b5cf1dca1e329504704c70b9d2b0c34d003b Reviewed-on: https://chromium-review.googlesource.com/324460 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add initial support for EXT_disjoint_timer_query.  Basic timer queries are supported and tested in the OpenGL backend but are not enabled by default. A good portion of the existing query code was also refactored for improved validation - specifically for validating that the appropriate extensions are available.  BUG=angleproject:1265  Change-Id: Iebae994cd7a8d3ed3e9fc3776fe2f3d99caa9237 Reviewed-on: https://chromium-review.googlesource.com/323450 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Ian Ewell <ewell@google.com> Tested-by: Ian Ewell <ewell@google.com>, 23355681, 619, 169, 619
Clean up unused variable macros.  We might want UNUSED_ASSERTION as a special case but the unused trace variable macro was being abused in places.  BUG=angleproject:1290  Change-Id: I5f9252b3ff0484d2e859b9fcf68d5d060b28f1fc Reviewed-on: https://chromium-review.googlesource.com/324290 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disable support for OpenGL ES targets with WGL on Intel drivers.  BUG=angleproject:1145  Change-Id: I9f3a8926eaad88076026f58922289487f90518c7 Reviewed-on: https://chromium-review.googlesource.com/324270 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
X11Window: fix the behavior of setVisible  An obvious bug crept in setVisible where setVisible(true) twice would end up hiding the window.  BUG=angleproject:1145  Change-Id: Iea8ca3de4ab8c05e6da66fb04c8d377824547b41 Reviewed-on: https://chromium-review.googlesource.com/324090 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Remove the now unused _ANGLE targets.  BUG=522967  Change-Id: I9a5c1793b089920273c74ab43fd5464d0aea7adb Reviewed-on: https://chromium-review.googlesource.com/324022 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Touch Infraustructure CQ config.  Change-Id: I9f733055ba3c22950eeedc17e756fe50af272a16 Reviewed-on: https://chromium-review.googlesource.com/324280 Reviewed-by: Andrii Shyshkalov <tandrii@chromium.org> Tested-by: Andrii Shyshkalov <tandrii@chromium.org>, 23355681, 619, 169, 619
Add support for targetting GLES with DisplayGLX.  BUG=angleproject:1145  Change-Id: I3072c31f2f743943b2ed9a3b1a020529112d5f71 Reviewed-on: https://chromium-review.googlesource.com/324091 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix warnings from shadowed variables in DXGISwapChainWindowSurfaceWGL.  BUG=540829  Change-Id: I3595f316afa1897224ad95d6f9a3da3685aa0831 Reviewed-on: https://chromium-review.googlesource.com/324032 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor ReadPixelsTest.  Split the test into several categories based on what fixture types they need.  BUG=angleproject:1290  Change-Id: Ia25a022d90a0571e03d86c8e38f6243189968149 Reviewed-on: https://chromium-review.googlesource.com/324020 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Reland "Infrastructure: CQ Verified label is no longer required."  This re-lands https://chromium-review.googlesource.com/#/c/323690/. It didn't break tryjobs they actually didn't work.  Change-Id: Id3da7658515f59e8dae550816d82b1fcce1e5f7a Reviewed-on: https://chromium-review.googlesource.com/324220 Reviewed-by: Sergiy Byelozyorov <sergiyb@chromium.org> Tested-by: Andrii Shyshkalov <tandrii@chromium.org> Commit-Queue: Andrii Shyshkalov <tandrii@chromium.org>, 23355681, 619, 169, 619
Fix bugs with drawbuffer state.   * IsAttachmentEnabled was checking the wrong draw buffer state.  Instead    of checking that drawbuffer[colorAttachment] is in use it should have    been scanning for a drawbuffer state that points to colorAttachment.  * Allow for maxDrawBuffer != maxColorAttachments.  Tested by the GL    backend on some systems that don't have the draw buffers extension.  Fixed by updating the helpers and adding a new getDrawBuffer helper.  BUG=angleproject:1121  Change-Id: Idd1b0a9ec4a3f944d332c708364408bf5d59e1fd Reviewed-on: https://chromium-review.googlesource.com/292740 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a WGL Surface implementation that renders to a DXGI swap chain.  This avoids sandbox issues when calling SetPixelFormat on windows from other processes while in a sandboxed process.  BUG=540829  Change-Id: I012168531d8c2e5b189671533cea9f57ec713538 Reviewed-on: https://chromium-review.googlesource.com/296340 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Tests: Prettify output for EXPECT_PIXEL_EQ.  Previously our output would spam multiple lines by checking equality for each color component. Instead use a helper struct with a stream operator to clean up the output. This makes it much more legible.  New output style:    Expected: (0 255 0 255)   Actual: angle::MakeGLColor(255 0 127 255)   Which is: (255 0 127 255)  BUG=angleproject:1290  Change-Id: Ieea018ab6c149a20b5fd74d74c972118b63a4b5e Reviewed-on: https://chromium-review.googlesource.com/323441 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use std::random functions for test and samples RNG.  These standard functions are much more powerful than the C random() routines. Use them to improve the random utils and use a class to clean things up further.  This fixes a problem I was having using random_utils where I was having trouble generating random 32 bit unsigned integers.  BUG=angleproject:1290  Change-Id: I5081764053d0667a4e323553b7dea531256aa778 Reviewed-on: https://chromium-review.googlesource.com/323440 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
GLX backend: check for child window resizes on eglWaitNative  This is the standard way if not often used for application to notify the driver of window size changes. Chromium uses it to resize when it is done rendering and swapping so that drivers do not clobber the backbuffer. This fixes black flickering appearing when resizing the Chromium windows with --use-gl=angle.  BUG=angleproject:1281  Change-Id: Ic76f3c3ef453eae07eb59122135290411f86764d Reviewed-on: https://chromium-review.googlesource.com/322390 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: Add a TextureHelper class to wrap 2D+3D reads.  In some cases in our code we had hard-coded ID3D11Texture2D where the code should handle 2D and 3D textures. This happens in ReadPixels where we have to handle 3D textures when the user binds a layer of a 3D textures with FramebufferTextureLayer.  This is a refactoring patch only which makes the error cleaner. Tests and the bug fix to come in a follow-up patch.  BUG=angleproject:1290  Change-Id: Ie1c293dead4d5b6b4dd6ce24ba2a9146619b141d Reviewed-on: https://chromium-review.googlesource.com/322680 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Supress AMD OpenGL failures in angle_end2end_tests.  BUG=angleproject:1291  Change-Id: I4fc8cc152bb5ef18fff78bf312a14691e9de0243 Reviewed-on: https://chromium-review.googlesource.com/324030 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Supress Mac OpenGL AMD angle_end2end_test failures.  BUG=angleproject:1291  Change-Id: I7fe6a6203c71c893dad97d6e9bc8272164d44f58 Reviewed-on: https://chromium-review.googlesource.com/323790 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement dirty bits for Framebuffer.  The dirty bits set the stage for performance improvements in D3D but don't actually reduce any of the redundant work just yet.  BUG=angleproject:1260  Change-Id: Ib84e6a9b7aa40c37c41790f492361b22faaf4742 Reviewed-on: https://chromium-review.googlesource.com/318730 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Infrastructure: CQ Verified label is no longer required."  This might cause analyze weirdness as shown in tryjobs here.  NOTRY=true  This reverts commit 5b74bd390334b1c988bb4b941e7765b992f611f7.  Change-Id: I018925a55ce4cebbc873e8c0ebb4b97ae9ca1020 Reviewed-on: https://chromium-review.googlesource.com/323581 Reviewed-by: Andrii Shyshkalov <tandrii@chromium.org> Tested-by: Andrii Shyshkalov <tandrii@chromium.org> Commit-Queue: Andrii Shyshkalov <tandrii@chromium.org>, 23355681, 619, 169, 619
Enable all angle_end2end_tests targeting OpenGL and OpenGL ES backends.  Added failure supressions and filed bugs for failing tests.  BUG=angleproject:1145 BUG=angleproject:1289 BUG=angleproject:1291 BUG=angleproject:1292 BUG=angleproject:1293 BUG=angleproject:1296  Change-Id: Ida78ba855500fe8a6ce6154d43ee01520330e3b1 Reviewed-on: https://chromium-review.googlesource.com/322695 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add GL_OES_EGL_image functions.  Needed to work on Chrome OS.  BUG=angleproject:1297  Change-Id: I78e18472780745f73257c8954f263d236ff92180 Reviewed-on: https://chromium-review.googlesource.com/323470 Tryjob-Request: Frank Henigman <fjhenigman@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Cast display parm for eglGetPlatformDisplayEXT.  The native display parameter to eglGetPlatformDisplayEXT has type void*. When building with -DUSE_OZONE the native display type is intptr_t so a cast is needed.  BUG=angleproject:1297  Change-Id: I947f5f9016926b6e3d590a2e29b5ee1fc883384d Reviewed-on: https://chromium-review.googlesource.com/323471 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Frank Henigman <fjhenigman@chromium.org> Commit-Queue: Frank Henigman <fjhenigman@chromium.org> Tested-by: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Infrastructure: CQ Verified label is no longer required.  BUG=577560  Change-Id: Ibd5b8bfd0da1631b03317dc6d0c85c649c947c12 Reviewed-on: https://chromium-review.googlesource.com/323690 Commit-Queue: Andrii Shyshkalov <tandrii@chromium.org> Reviewed-by: Sergiy Byelozyorov <sergiyb@chromium.org> Tested-by: Sergiy Byelozyorov <sergiyb@chromium.org>, 23355681, 619, 169, 619
Add support for targetting GLES with DisplayWGL.  BUG=angleproject:1145  Change-Id: I5a0a667621aceedb4662cfb2356d7dbd0d9f7718 Reviewed-on: https://chromium-review.googlesource.com/285557 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix packSnorm2x16.  Casting -32767.0f to uint16_t on Android resulted in 0. According to C99 6.3.1.4 footnote 50 this kind of cast behavior is unspecified  BUG=angleproject:913 TEST=build/android/test_runner.py gtest -s angle_unittests --release  Change-Id: I136386fe0aa618c17f07f99d8e1ca72fa407d36a Reviewed-on: https://chromium-review.googlesource.com/323230 Tryjob-Request: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Don't force using sized internal texture formats for OpenGL ES.   * LUMA formats don't have sized versions without specific extensions.  * This allows a more direct translation the driver should do the right    thing.  BUG=angleproject:884 BUG=angleproject:1145  Change-Id: I2ad13db7216eb7c715621a237b13ae9e3035310a Reviewed-on: https://chromium-review.googlesource.com/322694 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update FunctionsGL to load OpenGL ES entry points.  BUG=angleproject:1145 BUG=angleproject:879  Change-Id: I04eb900df28909f97469691a6c05a6af775d7465 Reviewed-on: https://chromium-review.googlesource.com/322693 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Always write to gl_Position when compiling shaders with SH_GLSL_COMPATIBILITY_OUTPUT.  BUG=angleproject:1277  Change-Id: Ib820a46151637e8c61e94b966b970de46ccca6b9 Reviewed-on: https://chromium-review.googlesource.com/323160 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Ian Ewell <ewell@google.com>, 23355681, 619, 169, 619
Fail any ANGLE test if it outputs D3D11 SDK message in debug mode  Also:  - Disable some Feature Level 9_3 tests that trigger SDK messages  - Fix a debug object name issue. If you try to assign a debug name    to an object twice then you get an SDK warning message. This can    occur if you 'create' two objects (e.g. Rasterizer States) with    identical DESCs on the same device since D3D11 can optimize    this and return the same object both times.  - Disable the message checks in Line Loops tests since the tests    trigger incorrect D3D11 SDK messages on Win7 machines  BUG=angleproject:667;angleproject:1282  Change-Id: I7284fb3a11377afde24e0014e21dbcea80ebb126 Reviewed-on: https://chromium-review.googlesource.com/321393 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Austin Kinross <aukinros@microsoft.com> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Fixed validation errors in teximage3d and friends.  BUG=angleproject:1169 BUG=angleproject:1101  Change-Id: I3770335d04cafd652c2f3839afca3e4a854e6e76 Reviewed-on: https://chromium-review.googlesource.com/322381 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Ian Ewell <ewell@google.com>, 23355681, 619, 169, 619
Fix version check for GL_MAX_VARYING_COMPONENTS with OpenGL ES.  BUG=angleproject:1145  Change-Id: Ibd5dab0fe54516427e6f7697559fb0ef670e1035 Reviewed-on: https://chromium-review.googlesource.com/322692 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Revert "OSXWindow: fix window size and position computations""  This reverts commit 67d810449c661460770ba7812856cd3da30ad8d6.  Change-Id: I4fcaffeb161d22c1cea72fd764461b0c38024e01 Reviewed-on: https://chromium-review.googlesource.com/322214 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Revert "WindowSurfaceCGL: unregister the SwapLayer on destruction""  This reverts commit 10277159570e987a02a112fa994a4b82845786d3.  Change-Id: I9ecf977845c6ee01d7c3e3791c23673407cfb91a Reviewed-on: https://chromium-review.googlesource.com/322213 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Suppress ProvokingVertexTest.FlatTriWithTransformFeedback on Mac AMD  BUG=  Change-Id: Ia6e7c67aaed40cca70be5522e0b9edff2610b63a Reviewed-on: https://chromium-review.googlesource.com/322212 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Sync dirty objects at the GL layer.  The dirty bit system currently puts dirty objects in line with the rest of the dirty state. This means at the Renderer level the sync manager code would call back to the GL layer to sync the specific objects that are dirty. This is a bit of a layering violation (impl layer mutating top-level objects) and also a bit of repeated boiler- plate code.  Fix this by treating dirty objects in a separate dirty bit set called the dirty objects. This also has the benefit of allowing us to re- implement the dirty object set at a later date if we want to store them in a list or other structure.  Also don't skip the state sync at the GL level if there are no GL dirty bits. The Impl might have some dirty bits locally and it's better to call syncState and do the no-op check in the Impl than it is to also sync local state at every sync point (draw call read etc) in each Impl.  BUG=angleproject:1260  Change-Id: Id5d4beb2a1c4e3ad351edf54e3f32e828d5f5da3 Reviewed-on: https://chromium-review.googlesource.com/318790 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disable dEQP in GN.  Change-Id: If2b3097f976a4433625b393c8562ea5d22c0c070 Reviewed-on: https://chromium-review.googlesource.com/322211 Reviewed-by: Nico Weber <thakis@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactoring: Split TextureTest to multiple classes  This removes the cube map setup and the draw scale parameter from the tests that don't need them and reuses the code for setting up the window and the shader program for most of the texture tests. The tests are now structured as follows:  TexCoordDrawTest: Test class that sets up a shader program for drawing with texture coordinates. Vertex shader source can be overridden in subclasses and fragment shader source must be specified in subclasses.  Texture2DTest: Inherits TexCoordDrawTest sets up a 2D texture and a shader for drawing from it.  Texture2DTestWithDrawScale: Inherits Texture2DTest adding a scale parameter that scales the quad that gets drawn.  TextureCubeTest: Inherits TexCoordDrawTest sets up a cube map and a 2D texture and a shader for drawing from them.  Texture2DArrayTestES3: Inherits TexCoordDrawTest. Reserves a texture ID and sets up an ESSL3 shader for drawing from a 2D texture array.  Also add a few comments about where things being tested are specified.  Also ANGLETest::drawQuad parameter names are renamed to make their meaning clearer. The parameters affect the vertex shader attribute values which the shader may use for other things besides setting the vertex position.  BUG=angleproject:1261 TEST=angle_end2end_tests  Change-Id: Id673e36d5883aaaf47f2f830c2a1ad0ca293d578 Reviewed-on: https://chromium-review.googlesource.com/321620 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Only use the shortening warning in Clang.  This seems to be Clang-only.  Change-Id: I4276a29e3d1575bd47d58d819ed3223b2c66838a Reviewed-on: https://chromium-review.googlesource.com/321820 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix translator having multiply defined symbols in GN builds.  This error was introduced in 82b5ab606f68bad27fe5d143d8b96e84801222ac where the translator's essl and glsl sources are compiled in both the translator and translator_lib targets. As translator depends on translator_lib this caused symbols to be defined multiple times.  BUG=angleproject:1250  Change-Id: I50bab7112d1460e14710f50250fa2417b2163236 Reviewed-on: https://chromium-review.googlesource.com/321770 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Update Debugging Tips document.  BUG=None  Change-Id: I9e417b37b072ea3874cd8b111d6b751295b9b0c2 Reviewed-on: https://chromium-review.googlesource.com/321760 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add loadable_module versions of libEGL and libGLESv2.  Reland with a link fix for Clang on Windows  In order to implement the --use-gl=angle Chrome flag on Linux we need to have the ANGLE .so directly in the build directory however GYP places shared_libraries under lib/ on Linux. On the contrary loadable_modules cannot be linked against so we need to keep the shared_library targets.  This commit adds _ANGLE versions of the libEGL and libGLESv2 targets as loadable module that depend on their respective shared library.  BUG=522967  Change-Id: Iad968ab786b94b6041c279921de99633d23b48a7 Reviewed-on: https://chromium-review.googlesource.com/318470 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add dEQP Linux GN integration.  BUG=angleproject:1272  Change-Id: I20cb8968221c25bb374b3cc71d7ca619a35f1a2f Reviewed-on: https://chromium-review.googlesource.com/320781 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disallow invariant(all) pragma in ESSL 3.00 fragment shaders  ESSL 3.00.4 section 4.6.1 says that using #pragma STDGL invariant(all) in a fragment shader is an error so make it an error. This spec language is not found in ESSL 1.00 and it's been removed in ESSL 3.10.  BUG=angleproject:1276 TEST=angle_unittests  Change-Id: I2022f35475f867304b55dfb142f8568f6df28830 Reviewed-on: https://chromium-review.googlesource.com/321240 Tryjob-Request: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Add dEQP GN integration.  This is Windows-only for now but will be expanded to Linux. Also do a bit of refactoring in our deqp.gypi file.  BUG=angleproject:1272  Change-Id: I526a99fe3b91a2d9e8901c7e033a4916a06780be Reviewed-on: https://chromium-review.googlesource.com/320800 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Compile out GLSL/ESSL translator output code if it's not needed  In WinRT we only use the HLSL code so the GLSL/ESSL output code is not necessary and is only adding to our binary size.  BUG=angleproject:1250  Change-Id: I9363ca3981bde50a230f8353c1bcc09f6ea209cb Reviewed-on: https://chromium-review.googlesource.com/317358 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Austin Kinross <aukinros@microsoft.com> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Fix BlendMinMaxTest.RGBA16F on D3D11 Feature Level 9_3  This test checks for OES_texture_half_float but it's trying to use a 16F texture as a color buffer so it should be checking for EXT_color_buffer_half_float.  Since EXT_color_buffer_half_float requires more format support (e.g. R16F RG16F RGB16F) than OES_texture_half_float it's possible for an implementation to support one extension and not the other. D3D11 Feature Level 9_3 does this.  Change-Id: I40fb38aa3f419be2606464bd0476cd064afe90fa Reviewed-on: https://chromium-review.googlesource.com/319642 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix compilation error on Linux  BUG=574909  Change-Id: I6dc4b010b67a9c7f3b64215a168e6ed5e894989b Reviewed-on: https://chromium-review.googlesource.com/320635 Commit-Queue: Byungseon Shin <xingri@gmail.com> Tested-by: Byungseon Shin <xingri@gmail.com> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Small cleanup of MultiWindow  Fixes a glitch on OSX where the root window would swap twice causing a glitch.  Change-Id: I5886105fb18ed8f45e69cd10b5d1cac49b82093f Reviewed-on: https://chromium-review.googlesource.com/320291 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add rpath for GN build of angle_end2end_tests.  This fixes the static library build of this target on Linux.  BUG=angleproject:1270  Change-Id: Id65bd9b7136918829f385920b540a4df83650c6f Reviewed-on: https://chromium-review.googlesource.com/320615 Tested-by: Kenneth Russell <kbr@chromium.org> Tryjob-Request: Kenneth Russell <kbr@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disallow local function prototypes  Function prototypes should not be allowed inside other functions according to ESSL 3.00.4 section 4.2.4.  BUG=angleproject:1068 TEST=angle_unittests      dEQP-GLES*.functional.shaders.functions.invalid.local_function_proto*  Change-Id: I54160da4d49b92a6cd7cbee020e67733963d4e10 Reviewed-on: https://chromium-review.googlesource.com/320091 Tryjob-Request: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Disallow multiple function prototypes in ESSL 1.00  The same function can't be declared twice in ESSL 1.00. In ESSL 3.00 this is allowed.  A function prototype following the definition of that function is not interpreted as redeclaration and the shader compiler continues to allow this.  BUG=angleproject:1067 TEST=angle_unittests      dEQP-GLES2.functional.shaders.functions.invalid.double_declare*  Change-Id: I6d2ddafd456d378d92839600f19069ad1cd19aff Reviewed-on: https://chromium-review.googlesource.com/320082 Tryjob-Request: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move function parsing code to ParseContext  This change is pure refactoring. It will make it easier to fix bugs related to function declarations.  BUG=angleproject:911 BUG=angleproject:1067 BUG=angleproject:1068 TEST=angle_unittests  Change-Id: I031783dc02612d9cf3ff7a9c8291cf8ab33577aa Reviewed-on: https://chromium-review.googlesource.com/320081 Tryjob-Request: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Make sure clang is defined before usage.  Standalone builds failed to generate projects.  Change-Id: I2897f84242255edabd0606ad858a048f635db0bc Reviewed-on: https://chromium-review.googlesource.com/320680 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nico Weber <thakis@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Clang warning fixes  This fixes member initialization order and unused private member warnings that broke the Clang build after the last Angle roll.  BUG=82385  Change-Id: If866f352bda6d66093c180fdbec6c16bf902b628 Reviewed-on: https://chromium-review.googlesource.com/320466 Reviewed-by: Nico Weber <thakis@chromium.org> Tryjob-Request: Nico Weber <thakis@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Geoff Lang <geofflang@chromium.org> Tested-by: Nico Weber <thakis@chromium.org>, 23355681, 619, 169, 619
Fixed memory leak in egl::Error and gl::Error  Move assignment operator of both classes contained a memory leak. Changed type of mMessage from mutable std::string *to mutable std::unique_ptr<std::string>  BUG=angleproject:1264  Change-Id: I7d1419b2e9f385b36afebfd6371983be33ee9e61 Reviewed-on: https://chromium-review.googlesource.com/319520 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Tibor Ouden den <tibordenouden@gmail.com> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
GN: Use $root_out_dir in in copy_compiler_dll rule  The root_build_dir variable yields the root of the build tree. But when the component is being built under a non-default toolchain its output files are delivered to a toolchain subdirectory instead.  The copy_compiler_dll rule should put its output next to where libANGLE and things built using it will go which is root_out_dir.  This fixes cases where the angle GN component is instantiated under more than one toolchain which heretofore would produce multiple Ninja rules for the same target file $root_build_dir/d3dcompiler_47.dll and thus get complaints from Ninja.  BUG=512869  Change-Id: I9fe83c5c5fa74902ef270654d3707636588af6b7 Reviewed-on: https://chromium-review.googlesource.com/320119 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Roland McGrath <mcgrathr@chromium.org>, 23355681, 619, 169, 619
Fix case of #includes in DisplayCGL.mm  Building libGLESv2 on Mac currently results in  .../DisplayCGL.mm:9:10: fatal error: 'libANGLE/renderer/gl/CGL/DisplayCGL.h' file not found  Other files in libANGLE/renderer/gl/cgl are using lowercase `cgl` for #includes. DisplayCGL.mm should do the same.  Change-Id: I03b68041ef3194eb14d65738e4e4fb12711b1b20 Reviewed-on: https://chromium-review.googlesource.com/320155 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Enable and fix the -Wshorten-64-to-32  BUG=angleproject:635  Change-Id: If09014508d5f4dfeb17ac946672a76a98b8ad175 Reviewed-on: https://chromium-review.googlesource.com/316580 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix compilation failures on OSX standalone builds  BUG=  Change-Id: Ifd40ae30d601227caf550546fcffc286cf533a73 Reviewed-on: https://chromium-review.googlesource.com/320290 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix EGL_ANGLE_flexible_surface_compatibility string  The extension string was misspelled.  Change-Id: Ic44dfe7340696e7e49c4924db068e9454927d5c4 Reviewed-on: https://chromium-review.googlesource.com/320371 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Ignore clang -Wall warning."  This was not working as intended. The correct fix was implemented in 444922662a59a45ad8f86ec9480b180571337f4e  This reverts commit 74b92323c9a210178ab97cc9418d6bf639cb9d8c.  Change-Id: Ib2bc3861bcdb49555b59981ca95f1c1c1e924d7d Reviewed-on: https://chromium-review.googlesource.com/320480 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add texture sampling perf test  The test generates a texture containing random data and then blurs it in a fragment shader using nearest neighbor sampling. The test is specifically designed to test overhead of GLSL's builtin texture*() functions that may result from how ANGLE translates them on each backend.  BUG=angleproject:1261 TEST=angle_perftests  Change-Id: I188fa8c07e609b7f371e587358f913b506bd7d44 Reviewed-on: https://chromium-review.googlesource.com/319382 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tryjob-Request: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix build issue in direct composition patch  MSVS2013 was warning about implicit conversion from EGLint to bool. Fix this by making the conversion explicit like another similar conversions.  The issue got introduced by the recent patch "Implement EGL_ANGLE_direct_composition extension". Since the issue only affects some particular build varieties it's simpler to fix it rather than revert the patch.  Change-Id: I120d34fddb48278856cbb0339ce25c49e57eb781 Reviewed-on: https://chromium-review.googlesource.com/320530 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Implement EGL_ANGLE_direct_composition extension  On D3D11 if dcomp.dll can be loaded then EGL_ANGLE_direct_composition is exposed. Setting EGL_DIRECT_COMPOSITION_ANGLE as an attrib on a surface will force it to use DirectComposition to draw to the screen possibly saving power.  BUG=524838  Change-Id: I3ea175a97bbca1a3388ffe52fdd1587a2f0c2ce7 Reviewed-on: https://chromium-review.googlesource.com/319214 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: John Bauman <jbauman@chromium.org>, 23355681, 619, 169, 619
Disable virtual destructor warning in dEQP.  This small error in dEQP triggers a warning that was recently enabled in Chromium builds. We should remove the suppression once we fix dEQP.  BUG=angleproject:1271  Change-Id: I9df3a304043b6decc00440103d105c9de76dc2db Reviewed-on: https://chromium-review.googlesource.com/320320 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Nico Weber <thakis@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix missing virtual destructor warning.  This only showed up on Linux/standalone builds for me. The error was added during the Debug extension patch.  Change-Id: Ibfcbdb61a71f30e863a10719c552ce662f835256 Reviewed-on: https://chromium-review.googlesource.com/320330 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add an EGL_ANGLE_surface_orientation extension.  BUG=angleproject:1262  Change-Id: Ifbb0f5302311a68a0c6f02baaea706cbb7055a52 Reviewed-on: https://chromium-review.googlesource.com/320011 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Add an EGL_ANGLE_surface_orientation extension."  Compilation warnings on clang.  This reverts commit 18cc14b5951842ede85c06dcbc0bba230bcedc45.  Change-Id: If58047486116e34ef30c4b317d3fb47cd2349d15 Reviewed-on: https://chromium-review.googlesource.com/319822 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add an EGL_ANGLE_surface_orientation extension.  BUG=angleproject:1262  Change-Id: I863c46c8557604da045447550f7d69831c9f06b5 Reviewed-on: https://chromium-review.googlesource.com/318780 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make generate_parser.sh run from any working directory  The script used to have partial support for specifying complete paths to the files it referenced but the patch command didn't work if the working directory wasn't src/compiler/translator. It's simplest to fix the script by just changing the working directory in the script.  Change-Id: If3642cbe11436d8c7553cd1812ee0f6c19fe990b Reviewed-on: https://chromium-review.googlesource.com/320270 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix typo in shader test  The only error in the test should be the non-integer index. gl_FragColor should be used correctly.  BUG=angleproject:1254 TEST=angle_unittests  Change-Id: I0b7a36be5485661cc03bf2c476aaacae5d3b6e76 Reviewed-on: https://chromium-review.googlesource.com/320280 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix clang warning in Buffer.cpp  BUG=angleproject:520  Change-Id: I3ee9e61a6a25eb6f16cf7d68d6da27ba1eec752d Reviewed-on: https://chromium-review.googlesource.com/320240 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement GL_KHR_debug.  BUG=angleproject:520  Change-Id: I9ced3e7ab1515feddf2ec103c26b2610a45b1784 Reviewed-on: https://chromium-review.googlesource.com/319830 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Ignore clang -Wall warning.  Change-Id: I76e3cd5038457a7d978497ef9a5ebee60b05e34d, 23355681, 619, 169, 619
Revert "Implement GL_KHR_debug."  This reverts commit 6c521b7a70a53b1c9f7762e53e34b5a8146b0f7b.  Change-Id: I6ff981198e31f34d3e405edea6277ee75516d6ee Reviewed-on: https://chromium-review.googlesource.com/319820 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement GL_KHR_debug.  BUG=angleproject:520  Change-Id: I78d14cc8c94f5cef58604220f0ca847473b25bf8 Reviewed-on: https://chromium-review.googlesource.com/317820 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Improve perf testing framework  The ANGLERenderTest subclasses have a parameter "iterations". Previously most of these tests would perform iterations^2 iterations since the looping was done both in ANGLERenderTest and in the individual test classes. Do the looping only in the individual test classes instead. This enables getting rid of separate beginDrawBenchmark() and endDrawBenchmark() functions.  Some other unused code is also removed:  1. stepBenchmark function 2. unused parameters to step()  This makes the core loop of running tests simpler.  The perf testing framework also now has shared logic for deciding when to end a given test.  The score calculation for tests is also changed. Instead of reporting just the number of operations done it is reported relative to the actual run time of the test. This should make the test results more accurate since run time of the tests may have some variation. It also enables changing the run time of the tests without rebaselining them.  In the tests that use GPU GPU operations are also waited to finish before stopping the timer.  BUG=angleproject:1261 TEST=angle_perftests  Change-Id: I69e9aad8afd2d9dedd60e144f0a5d4203618feef Reviewed-on: https://chromium-review.googlesource.com/319381 Tryjob-Request: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Remove deprecated ShShaderOutput versions.  These aren't referenced from Chromium code any more.  BUG=chromium:550487  Change-Id: Ie4094667ec5f739efd9f1253ffdb779deaf3cebc Reviewed-on: https://chromium-review.googlesource.com/319162 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Using dirty bit notification for D3D9 viewport state  BUG=angleproject:1249  This is a continuation of D3D dirty bit refactor for D3D9 performance enhancements  Change-Id: Iedd7eb003981cac7f81a58560cb326760f01c06a Reviewed-on: https://chromium-review.googlesource.com/317313 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Dian Xiang <dianx@google.com> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix code style in perf tests  1) Format switch/case with git cl format 2) Change NULL -> nullptr 3) Change int to GLint where appropriate 4) Use more appropriate variants of asserts  BUG=angleproject:1261 TEST=angle_perftests  Change-Id: I97d6260dbd72ef3897fff145682b7043bf323b76 Reviewed-on: https://chromium-review.googlesource.com/319380 Tryjob-Request: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Using dirty bit notification for D3D9 scissor state  BUG=angleproject:1249  This is a continuation of D3D dirty bit refactor for D3D9 performance enhancements  Change-Id: I480bb95414a1baf71e7768a1704b34ae55244ed1 Reviewed-on: https://chromium-review.googlesource.com/316917 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Dian Xiang <dianx@google.com>, 23355681, 619, 169, 619
Add EGL spec for EGL_ANGLE_direct_composition  This allows applications to specify that they want to render to the screen using DirectComposition. This can save power by allowing the use of DXGI_SWAP_EFFECT_FLIP_SEQUENTIAL and DirectFlip but has other side effects - windows must be owned by the current process and contents drawn by GDI are shown underneatch the window.  BUG=angleproject:1178 Change-Id: I2e45d92c9f92f27eedaf50f0a866c20c43f3aab5 Reviewed-on: https://chromium-review.googlesource.com/317651 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: John Bauman <jbauman@chromium.org>, 23355681, 619, 169, 619
Using dirty bits notification for D3D9 depth stencil state  BUG=angleproject:1249  This is a continuation of the D3D dirty bit refactor for D3D9 for performance enhancements  Change-Id: I8690d47999b73483c47f4994dc46cd97f4ced63d Reviewed-on: https://chromium-review.googlesource.com/316449 Tryjob-Request: Dian Xiang <dianx@google.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Dian Xiang <dianx@google.com>, 23355681, 619, 169, 619
Using dirty bit notification for D3D9 rasterizer state  BUG=angleproject:1249  Continuation of refactor for d3d9 dirty bit refactor for performance enhancements  Change-Id: I414cc9bfbdc806d870a9f208895f411edf5adcf3 Reviewed-on: https://chromium-review.googlesource.com/316515 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Dian Xiang <dianx@google.com>, 23355681, 619, 169, 619
Removing unused render target format in D3D11  This takes up about 2.9% of the time in performance runs.  BUG=angleproject:1161  Change-Id: I9ff98cd6f4bfd14cab0c702d5873f3fadfbcb4d7 Reviewed-on: https://chromium-review.googlesource.com/317574 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Dian Xiang <dianx@google.com>, 23355681, 619, 169, 619
gyp: Always use pkg-config wrapper  Calling pkg-config directly doesn't work when building with a sysroot image as it will looks for host libraries rather than those within the sysroot.  BUG=chromium:569947  Change-Id: I6f3e63c1816cd9393110cb3060744a69a93c9a2e Reviewed-on: https://chromium-review.googlesource.com/318771 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Sam Clegg <sbc@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix perf_test_runner printing wrong test name  The previous version of the script would always print the default test name even if user specified a different one.  BUG=angleproject:596  Change-Id: I43a07e81b49f69c7c372b46bd9494d6fe440b968 Reviewed-on: https://chromium-review.googlesource.com/319091 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Improve perf_test_runner script  1) Make it possible to run the script from any working directory 2) Abort the run if angle_perftests is executing multiple test cases 3) Print some information on which exe and test is running 4) Print the test runner output in case there was an error  BUG=angleproject:596  Change-Id: If30c2455dc39b0a776df03e6c1dda2ced90d73ba Reviewed-on: https://chromium-review.googlesource.com/319090 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Re-land "Implement GL_EXT_color_buffer_half_float."  This exposes previously enabled functionality. Also update the format support check to be:  supported: GLES3 || texture extension renderable: supported && color buffer extension filterable: filtering extension  (Note: we silently support float rendering in ES2)  Re-land with suppression for newly exposed failing test.  BUG=angleproject:445  Change-Id: I4e46699e6b0c2ec8a7d8b36f1f598af1ec6420bc Reviewed-on: https://chromium-review.googlesource.com/318931 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Implement GL_EXT_color_buffer_half_float."  Failing dEQP-GLES3.functional.fbo.color.repeated_clear.sample.tex2d.rgb16f  http://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Release%20dEQP%20%28NVIDIA%29/builds/4651  Likely missing a suppression for this test. It likely passed only because the extension was missing and it was passing as not supported.  BUG=angleproject:1229  This reverts commit 39f9251daef5c4ddb4b7c413466a092f4a7f21bf.  Change-Id: Ia703378d5aaacafc14503aff0b52a795b7eb4467 Reviewed-on: https://chromium-review.googlesource.com/319080 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add EGL_ANGLE_flexible_surface_compatibility  This extension allows users of ANGLE to make contexts current with surfaces that were created with different bit depths.  BUG=angleproject:1223  Change-Id: I9072c256e0a36aee1ce41ab69cb9a04240bf0521 Reviewed-on: https://chromium-review.googlesource.com/314935 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: John Bauman <jbauman@chromium.org> Tested-by: John Bauman <jbauman@chromium.org>, 23355681, 619, 169, 619
Implement GL_EXT_color_buffer_half_float.  This exposes previously enabled functionality. Also update the format support check to be:  supported: GLES3 || texture extension renderable: supported && color buffer extension filterable: filtering extension  (Note: we silently support float rendering in ES2)  BUG=angleproject:1229  Change-Id: Icf0775891d6e336acd1a0ac07c3b37cf6bb0f101 Reviewed-on: https://chromium-review.googlesource.com/308430 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Using dirty bits notification for D3D9 blend state  BUG=angleproject:1249  Dirty bit notifications are used in GL and D3D11 for state tracking. This is a continuation of D3D dirty bit refactor for D3D9  Change-Id: Ifaa1826a93cf36c83d68150107b164d1d269c2b0 Reviewed-on: https://chromium-review.googlesource.com/316475 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Dian Xiang <dianx@google.com> Tested-by: Dian Xiang <dianx@google.com>, 23355681, 619, 169, 619
Fix missing newline from "Missing main()" error message  Change-Id: Id28e20097fc2c66117c688425c73df731afecbe3 Reviewed-on: https://chromium-review.googlesource.com/318431 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add an instancing perf test.  BUG=526217 BUG=angleproject:1164  Change-Id: Ia353a3b2fa0ab0e8b7fd15d72bb63e5ecb7833b1 Reviewed-on: https://chromium-review.googlesource.com/301469 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Validation cube completeness for FBO attachments.  ES3 adds a clause that cube map FBO attachments must be cube complete to produce complete framebuffers. ES2 doesn't have this clause but some (if not all unverified) OpenGL back-ends don't support these incomplete cube map attachments.  BUG=angleproject:1259  Change-Id: Idd4564488375b8646dde712e6ce4a158c23020ee Reviewed-on: https://chromium-review.googlesource.com/318264 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Rafael Cintron <rafael.cintron@microsoft.com> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Add loadable_module versions of libEGL and libGLESv2."  This reverts commit 6beb0bfdd0e57d7cb5797355d10e971c7c97cc29.  It caused compile failures on win_clang_dbg because when building libEGL_ANGLE.dll DllMainCRTStartup wasn't defined.  Change-Id: I8080f8db373f5988d86560da1b8b2a1bae30d3ea Reviewed-on: https://chromium-review.googlesource.com/318460 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Extend the CallDAG info log to report undefined functions  BUG=angleproject:784  Change-Id: If5073a91bc4f47ade27c242d6966306600029f33 Reviewed-on: https://chromium-review.googlesource.com/316870 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add compiler/linker flags to optimize WinRT release builds  This reduces the WinRT binary sizes by up to 500KB.  BUG=angleproject:1250  Change-Id: I2ce0e9597c49515fe4b414f105b03785d6ce132f Reviewed-on: https://chromium-review.googlesource.com/317595 Tryjob-Request: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
TDependencyGraph: use range-base for loops instead of iterators  No functional changes intended.  BUG=angleproject:591  Change-Id: Ieccf0b792766be86a3533e5324ce6f83ee508ad5 Reviewed-on: https://chromium-review.googlesource.com/316601 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Compiler: remove dead code in limitExpressionComplexity  TGraphTraverser is a class that does nothing by itself so the for loop was a noop statement and has been for at least two years (since 17732823f9c2 didn't check earlier).  BUG=angleproject:591  Change-Id: I1919059fcb8987c2f043a71fed6223e16bc014d8 Reviewed-on: https://chromium-review.googlesource.com/316600 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Don't crash when calling ShConstructCompiler with a wrong output  BUG=angleproject:446  Change-Id: Ic1c326f79105950e5c3eb8724eba12fca187a2ec Reviewed-on: https://chromium-review.googlesource.com/316610 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add stub entry points for GL_KHR_debug.  BUG=angleproject:520  Change-Id: I6f19ca160214a44c75619c320d5e1db7e4098eda Reviewed-on: https://chromium-review.googlesource.com/317540 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Win32Window: Implement Event::EVENT_MOUSE_ENTERED  BUG=angleproject:1000  Change-Id: I9b61564fa086318c3ffa9a6b85bb100c52cfad54 Reviewed-on: https://chromium-review.googlesource.com/316590 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add loadable_module versions of libEGL and libGLESv2.  In order to implement the --use-gl=angle Chrome flag on Linux we need to have the ANGLE .so directly in the build directory however GYP places shared_libraries under lib/ on Linux. On the contrary loadable_modules cannot be linked against so we need to keep the shared_library targets.  This commit adds _ANGLE versions of the libEGL and libGLESv2 targets as loadable module that depend on their respective shared library.  BUG=522967  Change-Id: I08f2ce0ee0430eff5bee852f09cd7d30b94d6266 Reviewed-on: https://chromium-review.googlesource.com/316421 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Re-land "Finish ReadBuffer support in end2end_tests."  Currently we had a few TODOs concerned about unimplemented calls in ANGLE. ANGLE now has support for ReadBuffer so uncomment the calls.  Re-land with end2end_tests fix.  BUG=angleproject:940  Change-Id: I6e00c3aac6307308fb7f00c7e0426812563ed778 Reviewed-on: https://chromium-review.googlesource.com/317821 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Use default arguments in texture format table.  This reduces the footprint of the table considerably and makes it a little bit easier to maintain.  BUG=angleproject:1244  Change-Id: I84710729b94ba78813f9be2fcadb8c4d51fe8d7d Reviewed-on: https://chromium-review.googlesource.com/317330 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disable COMDAT folding and OptimizeReferences for debug WinRT  In some configs these are enabled by default and they causes linker warnings (which are treated as errors).  BUG=angleproject:1250  Change-Id: Ia8d28e313c91f1d63248aa5c68d29f9c69b8d596 Reviewed-on: https://chromium-review.googlesource.com/317566 Tryjob-Request: Austin Kinross <aukinros@microsoft.com> Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Expose unsized GL_FLOAT formats required by GL_OES_texture_float  BUG=angleproject:1209  Change-Id: I490c524d203dd72a8e6c556b537c4254720d9447 Reviewed-on: https://chromium-review.googlesource.com/315510 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix Clang 3.7 build issue in VS 2015 Update 1  VS 2015 Update 1 adds support for 'Clang 3.7 with Microsoft CodeGen'.  This fixes these errors when using Clang 3.7 in VS2015:  compiler\translator\ASTMetadataHLSL.cpp(6910): error : 'visitLoop' overrides a member function but is not marked 'override' [-Werror-Winconsistent-missing-override] compiler\translator\ASTMetadataHLSL.cpp(7510): error : 'visitSelection' overrides a member function but is not marked 'override' [-Werror-Winconsistent-missing-override] compiler\translator\ASTMetadataHLSL.cpp(33610): error : 'visitLoop' overrides a member function but is not marked 'override' [-Werror-Winconsistent-missing-override]  Change-Id: Ia9c3029eb2966132827596b55ad9afce34b6f19c Reviewed-on: https://chromium-review.googlesource.com/317732 Tryjob-Request: Austin Kinross <aukinros@microsoft.com> Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove redundant index integer check from ValidateLimitations  Non-integer indices are already rejected in the parser so the ValidateLimitations pass doesn't need to check for them.  ESSL 1.00 spec is not actually terribly clear about whether the parser should do this check but the language grammar in the spec only has indexing with "integer_expression" so it seems like ANGLE's interpretation of only allowing indexing with integers is correct. ESSL 3.00 makes this restriction explicitly clear in section 5.7.  BUG=angleproject:1254 TEST=angle_unittests  Change-Id: I02b2a6f4d9fa7801a98df63ed21bc990e1585eb8 Reviewed-on: https://chromium-review.googlesource.com/317741 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Don't try to apply ForLoopUnroll to loops it can't handle  ForLoopUnroll should only mark loops that fit the limitations in ESSL 1.00 Appendix A.  BUG=angleproject:1253 TEST=angle_unittests WebGL conformance tests  Change-Id: I00b0a7d29cd42efea9611d020aa1f873ac04773f Reviewed-on: https://chromium-review.googlesource.com/317551 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix buffer unbinding upon deletion.  - Remove buffer bindings for new ES3 buffer types. - Fix detachment behavior to GLES3 spec   i.e. detach only from currently bound containers. - Make pack/unpack buffer binding parameter available in GLES3. - Update test expectations.  BUG=angleproject:1191  Change-Id: Iab4c1de8d96a523d5af55d22956d50c10f7c93c2 Reviewed-on: https://chromium-review.googlesource.com/315521 Tryjob-Request: Yuly Novikov <ynovikov@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Yuly Novikov <ynovikov@chromium.org> Commit-Queue: Yuly Novikov <ynovikov@chromium.org>, 23355681, 619, 169, 619
Fix ValidateLimitations for folded non-constant expressions  ANGLE recently gained the ability to constant fold some expressions that are not constant expressions. ValidateLimitations should continue to recognize all cases where an expression is not a constant expression.  BUG=angleproject:851 TEST=angle_unittests  Change-Id: I8ad0552a59213cdd6af9a220ffd672be9752271d Reviewed-on: https://chromium-review.googlesource.com/317281 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Don't skip delete_bound.transform_feedback.  A one-line subset of 36167ab3 allowed dEQP-GLES3.functional.lifetime.delete_bound.transform_feedback to pass though it indented that line differently than its neighbors. Fix up the indentation and don't skip the test.  BUG=angleproject:1150 TEST=angle_deqp_gtest_gles3_tests --gtest_filter='*transform_feedback*'  Change-Id: I8471bd46f8a642b0945b43ab9b980c11c50d63c0 Reviewed-on: https://chromium-review.googlesource.com/313860 Tryjob-Request: Frank Henigman <fjhenigman@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Re-land "Disable RTTI in VS release builds"  - Re-land with fix for Chromium Debug Windows builds  Chrome forbids RTTI but standalone ANGLE currently allows it. Disallowing RTTI in standalone release builds brings ANGLE and Chrome closer and prevents accidental use of dynamic_cast in ANGLE.  It also reduces binary size. Win10 libGLESv2 (x86) is 47KB smaller after this.  BUG=angleproject:1239  Change-Id: I505fd0d72868a38444e47198a9bf85ee3e25719f Reviewed-on: https://chromium-review.googlesource.com/316830 Tryjob-Request: Austin Kinross <aukinros@microsoft.com> Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
clang/win: Let EGLDeviceTest.cpp build with -Wextra on trunk too.  Like https://chromium-review.googlesource.com/317360 but for code that's in ANGLE trunk but not yet rolled in by Chromium.  BUG=567877  Change-Id: I59b1568b134f57919eb333e99e7d185416d5d3b5 Reviewed-on: https://chromium-review.googlesource.com/317390 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Nico Weber <thakis@chromium.org>, 23355681, 619, 169, 619
Destroy surfaces from Display::terminate instead of the DisplayImpl destructor.  Previously the parent display impl would be destroyed before the surface impls.  It is useful to call helper functions in the parent display during surface destruction.  BUG=540829  Change-Id: I0884826d2e360319da896f049d46bfc01a2481a0 Reviewed-on: https://chromium-review.googlesource.com/316801 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Pass the gl::Texture object into Surface::bindTexImage.  BUG=540829  Change-Id: Iee602165e69bfe574821c6f628a745c32932a938 Reviewed-on: https://chromium-review.googlesource.com/316800 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactoring RendererD3D to not have virtual functions for state calls  BUG=angleproject:1242  Draw calls get called many times. Eliminating the number of virtual function calls will help with performance. Renderer9 and Renderer11 now have diverging paths for managing state with the dirty bits. Hence we can remove some of the virtual calls.  Change-Id: Ic5d69e744826f1c4f4ae168bca058f4743ff0843 Reviewed-on: https://chromium-review.googlesource.com/315229 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Dian Xiang <dianx@google.com>, 23355681, 619, 169, 619
Revert "Finish ReadBuffer support in end2end_tests."  Fails on the bots on ReadPixelsTest.DrawWithPBO/ES3_D3D11  BUG=angleproject:940  This reverts commit ada5d07ec6c3578eb07adbb647360c0ae60edf46.  Change-Id: I60c71af6317f6b5ee1bf1555cb4573c5e82a11d6 Reviewed-on: https://chromium-review.googlesource.com/317430 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
clang/win: Let EGLDeviceTest.cpp build with -Wextra.  In a Chromium build this target is built as part of gpu with the chromium_code warning settings applied.  Make sure it builds in that config.  BUG=567877  Change-Id: I7464538a259295d83d990853b06b9ba76b82889d Reviewed-on: https://chromium-review.googlesource.com/317360 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Nico Weber <thakis@chromium.org>, 23355681, 619, 169, 619
Finish ReadBuffer support in end2end_tests.  Currently we had a few TODOs concerned about unimplemented calls in ANGLE. ANGLE now has support for ReadBuffer so uncomment the calls.  BUG=angleproject:940  Change-Id: Ib297e3ab7f2fa2424ee2cc85918331066dae4475 Reviewed-on: https://chromium-review.googlesource.com/317340 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Apply null InputLayout with no attributes.  In some cases in ES3 we can render without vertex attributes. For this don't bind or create an empty input layout but instead bind null.  This silences a D3D11 warning in Debug when viewing the system out.  BUG=angleproject:667  Change-Id: Ib88dc1177d7f9bb6a5fa15e44c74da022be137f6 Reviewed-on: https://chromium-review.googlesource.com/316612 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't disable COMDAT folding or OptimizeReferences in WinRT  This is bloating the WinRT binaries unnecessarily.  BUG=angleproject:1250  Change-Id: I87fa2422e7d58374329956540d03933b0177234b Reviewed-on: https://chromium-review.googlesource.com/316820 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Windows: Write test name in debug log.  This helps isolate particular debug log messages to specific tests.  BUG=angleproject:667  Change-Id: I6be37d50cc41a13abbceb395e6e9b603bd44c7bd Reviewed-on: https://chromium-review.googlesource.com/316611 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
dEQP/Win: Skip trig tests that crash on new compiler.  The new version of D3DCompile_47.dll that gets bundled with the Chromium depot_tools Windows SDK seems to crash when compiling these shaders I think during the optimization step.  BUG=angleproject:1252 BUG=568170  Change-Id: Ic54a6353ffe3520ecc5e5012721c0a09eb370b22 Reviewed-on: https://chromium-review.googlesource.com/317331 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ES3: Allow floating point blit conversions under extension.  If we support EXT_color_buffer_float we should also allow blits to and from float and fixed point data according to the extension spec.  BUG=angleproject:1243 TEST=dEQP-GLES3.functional.fbo.blit.*  Change-Id: I0957ac0647c94e38ebd67480c608eeb16c82dbf4 Reviewed-on: https://chromium-review.googlesource.com/316030 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Load the WGL_NV_DX_interop entry points in FunctionsWGL.  BUG=540829  Change-Id: Iab080789f2a21b900e2641aa97c0e3392d007391 Reviewed-on: https://chromium-review.googlesource.com/316802 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix bootstrap instructions.  BUG=angleproject:1204 TEST=bootstrap and build in Linux and Windows 8  Change-Id: Iad43ed41588d4519e3881dc48771beae375b5d40 Reviewed-on: https://chromium-review.googlesource.com/313793 Tested-by: Frank Henigman <fjhenigman@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement full program binary support for ES3.  Refactor validation to be used in both the OES and ES3 entry points.  BUG=angleproject:600 BUG=angleproject:1101  Change-Id: I2008c4ea04ce07910f03ae0b997f8a77b66203d8 Reviewed-on: https://chromium-review.googlesource.com/316620 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't allocate VertexArray or TransformFeedback objects until binding.  Follow the spec more closely and only reserve IDs of vertex arrays and transform feedback objects before binding.  This saves memory and allows the glIs* calls to succeed.  BUG=angleproject:1218 BUG=angleproject:1101  Change-Id: I0039680c39c66c1c5506f6a1a9121a71791b77e9 Reviewed-on: https://chromium-review.googlesource.com/316591 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Don't allocate VertexArray or TransformFeedback objects until binding."  This reverts commit 070c0124be642383220ca44f795225b89d56f13b.  Change-Id: I4ffa528f63311615bb4e22593c6e8a0ec424cd2d Reviewed-on: https://chromium-review.googlesource.com/316780 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "D3D11: Use clamp wrap mode for Integer textures."  dEQP-GLES3 texture failures:  http://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Release%20dEQP%20%28NVIDIA%29/builds/4510/steps/angle_deqp_gles3_tests/logs/stdio  dEQP-GLES3.functional.shaders.texture_functions.texture.isampler* dEQP-GLES3.functional.shaders.texture_functions.texture.usampler*  BUG=angleproject:1244  This reverts commit 7a6a1ffeb275a8b565701305c8b42857ff2bf0b0.  Change-Id: I0e25e7aed0e0d78015d5b8f5a7b9a81e0a5fca4e Reviewed-on: https://chromium-review.googlesource.com/316641 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
OutputHLSL: Avoid using info sink stack as much as possible.  Due to how the traversers work it might not be trivial to avoid the info sink stack entirely but minimize its use to keep the code as functional as possible.  BUG=angleproject:958  Change-Id: I354313f10f496feea7c6a6f167b0617aeadbe5b0 Reviewed-on: https://chromium-review.googlesource.com/316412 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Protect against overflow in BinaryInputStream.  BUG=angleproject:1112  Change-Id: I6d58d9e0db97ec6c67661abd92b57f61f357d6b5 Reviewed-on: https://chromium-review.googlesource.com/316640 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Protect against overflow in BinaryInputStream."  This reverts commit dfa2fe31ad66ede57af1c0244ee99b8918eb2d9b.  Change-Id: If4a7eb1876876991c537d0a9077cede52ba40b95 Reviewed-on: https://chromium-review.googlesource.com/316621 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D11: Mask off alpha channel for RGBA->RGB blits.  We emulate RGB8 in D3D11 with RGBA8 textures. Make sure when we blit that we don't copy the unused texture channel.  BUG=angleproject:1245 TEST=dEQP-GLES3.functional.fbo.blit.*  Change-Id: I805132fda984860a6d84ad4c1fc7169973938df9 Reviewed-on: https://chromium-review.googlesource.com/316010 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Use clamp wrap mode for Integer textures.  Until we can support all wrap modes for int textures use a correct clamping scheme. This fixes several dEQP GLES3 FBO tests.  This shuffles some of the tests in functional.texture.units since it hard-codes a different behaviour for all wrap modes ignoring the sampler setting.  BUG=angleproject:1244 TEST=dEQP-GLES3.functional.texture.*  Change-Id: Ic7e89a111728dfb18821534996bf5b9a5ad172b6 Reviewed-on: https://chromium-review.googlesource.com/313997 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Protect against overflow in BinaryInputStream.  BUG=angleproject:1112  Change-Id: Iedd92ce7a56b20f42e51ef86278eb64fbae3c353 Reviewed-on: https://chromium-review.googlesource.com/316031 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't allocate VertexArray or TransformFeedback objects until binding.  Follow the spec more closely and only reserve IDs of vertex arrays and transform feedback objects before binding.  This saves memory and allows the glIs* calls to succeed.  BUG=angleproject:1218 BUG=angleproject:1101  Change-Id: I7bf99870a7c93f5545325785cbecd891c6b77f8a Reviewed-on: https://chromium-review.googlesource.com/316402 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move TType::getCompleteString to Types.cpp.  Probably left over from previous refactoring.  BUG=angleproject:1247  Change-Id: Ieb4b60ae9f724248f92ae77d23e4bdd8c5d9265a Reviewed-on: https://chromium-review.googlesource.com/316400 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't print assertion expression as a format string.  If the assert contained '%' symbols it would be interpreted as a substituion.  BUG=angleproject:1189  Change-Id: Ib347bc1a892397373e7318e032070c0337f110de Reviewed-on: https://chromium-review.googlesource.com/316410 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Using dirty bit notification for D3D11 viewport state  BUG=angleproject:1161  This is a continuation of the dirty bit refactor  Change-Id: I101f415094dd406f6b0a40cb260f1cbbfec7b62c Reviewed-on: https://chromium-review.googlesource.com/313249 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Dian Xiang <dianx@google.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Dian Xiang <dianx@google.com>, 23355681, 619, 169, 619
Using dirty bit notification for D3D11 scissor rectangle state  BUG=angleproject:1161  This is a continuation of the dirty bit refactor  Change-Id: I1a9f297835943eee5f756e4e4721b2db543184ec Reviewed-on: https://chromium-review.googlesource.com/312987 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Dian Xiang <dianx@google.com>, 23355681, 619, 169, 619
D3D11: Fix blit from out-of-bounds.  Do not copy pixels in a negative read region. Also make sure we clamp the boundaries so the dEQP tests are mostly pixel-perfect.  We can't yet fix some default framebuffer tests because of issues with blitting RGBA8 (default FBO) to floating point framebuffers.  BUG=angleproject:1241 TEST=dEQP-GLES3.functional.fbo.blit.*  Change-Id: I16ee264b0b1a7e6b9121dde5ae4f96cfd27ea53e Reviewed-on: https://chromium-review.googlesource.com/315670 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add support for EGL_EXT_platform_device  This allows an application to use EGLDeviceEXT to initialize EGL.  For example if an application wants to initialize EGL using an existing D3D11 device (instead of ANGLE creating its D3D device) then the app may create an EGLDeviceEXT using EGL_ANGLE_device_creation_d3d11 and use this device to initialize EGL via EGL_EXT_platform_device.  BUG=angleproject:1190  Change-Id: Ife91ce95a63e29eb2b3f05aedfb668e4cac8f5ce Reviewed-on: https://chromium-review.googlesource.com/313444 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Revert "Revert "Add and implement EGL_ANGLE_device_creation[_d3d11]""  This reverts commit dd5c5b79333fdde7858a77d39e91cc3d30b74c9e.  BUG=angleproject:1190  Change-Id: I1bc1b232b6a916da6d18b546baf20e0854a2768f Reviewed-on: https://chromium-review.googlesource.com/315169 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Define EGL_EGLEXT_PROTOTYPES in GN projects  This makes sure that EGL_EGLEXT_PROTOTYPES is defined in the same places as GL_GLEXT_PROTOTYPES.  BUG=angleproject:1190  Change-Id: I0e55aad5728df765bff495822570e7590b157d68 Reviewed-on: https://chromium-review.googlesource.com/315208 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Disable stencil buffer when not attached.  Similarly to the D24S8 attachment getting confused when we use only the stencil portion ANGLE could write to the stencil portion when we were only using the depth. Fix this by internally disabling stencil test and writes when using this type of configuration.  BUG=angleproject:1237  Change-Id: Ib7868d5e9f8aea73304a132005541dab947aa619 Reviewed-on: https://chromium-review.googlesource.com/314032 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Don't read or write to the unused depth buffer.  When using STENCIL8 we emulate it on D3D11 with D24S8 since there is no native stencil-only format. However in many places we would write to the depth part of this format and confuse the D3D runtime when it would use the depth test. Fix this by never modifying the depth portion of the buffer or reading from it.  BUG=angleproject:1232  Change-Id: Ifd2e54eceae84e8deea85f439c132d07981b2286 Reviewed-on: https://chromium-review.googlesource.com/313996 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Rewrite WindowSurfaceCGL to use CAOpenGLLayer  It used to render to IOSurfaces and use setContents to directly give them to the OSX compositor. This was worth the complexity only because Chrome going to use that code path. This is no longer the case.  Instead we replace the implementation with one based on CAOpenGLLayer that basically gets a "draw" callback every frame. The complexity comes from the fact that this callback is called from another thread with another CGL context.  BUG=angleproject:1233  Change-Id: I1878d0071d057e043e0bb9043d9849f50e00d023 Reviewed-on: https://chromium-review.googlesource.com/314031 Reviewed-by: ccameron chromium <ccameron@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Add and implement EGL_ANGLE_device_creation[_d3d11]"  Causes failures on Windows/GN:  e:\b\build\slave\win_x64_gn\build\src\third_party\angle\src\tests\egl_tests\egldevicetest.cpp(108) : error C3861: 'eglCreateDeviceANGLE': identifier not found e:\b\build\slave\win_x64_gn\build\src\third_party\angle\src\tests\egl_tests\egldevicetest.cpp(113) : error C3861: 'eglQueryDeviceAttribEXT': identifier not found e:\b\build\slave\win_x64_gn\build\src\third_party\angle\src\tests\egl_tests\egldevicetest.cpp(119) : error C3861: 'eglReleaseDeviceANGLE': identifier not found e:\b\build\slave\win_x64_gn\build\src\third_party\angle\src\tests\egl_tests\egldevicetest.cpp(143) : error C3861: 'eglQueryDeviceAttribEXT': identifier not found e:\b\build\slave\win_x64_gn\build\src\third_party\angle\src\tests\egl_tests\egldevicetest.cpp(162) : error C3861: 'eglCreateDeviceANGLE': identifier not found e:\b\build\slave\win_x64_gn\build\src\third_party\angle\src\tests\egl_tests\egldevicetest.cpp(178) : error C3861: 'eglCreateDeviceANGLE': identifier not found  This reverts commit 4029ad42d5ffe94a0a744532ab3577b982f847b8.  BUG=angleproject:1190  Change-Id: Ibcdfd8cea7ba275cd67c0220f8d7a1069ec1cf97 Reviewed-on: https://chromium-review.googlesource.com/315480 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Disable RTTI in VS release builds"  Fails compile on the Windows Debug GPU bot:  c:\b\build\slave\gpu_win_builder__dbg_\build\src\third_party\deqp\src\framework\opengl\simplereference\sglrreferencecontext.cpp(2342) : warning C4541: 'dynamic_cast' used on polymorphic type 'sglr::rc::Texture' with /GR-; unpredictable behavior may result c:\b\build\slave\gpu_win_builder__dbg_\build\src\third_party\deqp\src\framework\opengl\simplereference\sglrreferencecontext.cpp(2344) : warning C4541: 'dynamic_cast' used on polymorphic type 'sglr::rc::Texture' with /GR-; unpredictable behavior may result  Many other similar errors.  BUG=angleproject:1239  This reverts commit aca86045d9aae4d41939a3953103304b7ba9e3a2.  Change-Id: I523e12b32665bcc74a6437582be82db8174e42ac Reviewed-on: https://chromium-review.googlesource.com/315170 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement EGL_ANGLE_x11_visual  Reland with a fixed tests on AMD.  This extension will be used by Chrome to advertise the visual it will use for its windows. Having ANGLE use the same visual will bring several benefits:  - A blit will be avoided and the content of the window might be    rendered on the system framebuffer directly.  - There will be less latency when resizing windows which will make it    much less likely to see a black border when resizing.  BUG=522149  Change-Id: I66004b6ac45453330af7c4c810ddf2c26941be42 Reviewed-on: https://chromium-review.googlesource.com/314661 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Disable RTTI in VS release builds  Chrome forbids RTTI but standalone ANGLE currently allows it. Disallowing RTTI in standalone release builds brings ANGLE and Chrome closer and prevents accidental use of dynamic_cast in ANGLE.  It also reduces binary size. Win10 libGLESv2 is 47KB smaller after this.  BUG=angleproject:1239  Change-Id: Ib5fb50df66c3a94042e2d9bbb062c0d025cf3eef Reviewed-on: https://chromium-review.googlesource.com/314831 Tryjob-Request: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Update link to ANGLE and Cross-Platform WebGL Support presentation  Change-Id: Ib3322b10f8549ce743f7ce8ee1b46d6341af4062 Reviewed-on: https://chromium-review.googlesource.com/314912 Tested-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Return correct error in Framebuffer::checkStatus.  UNSUPPORTED is a specific error meaning an implementation-specific incompatibility. For cases where the attachments are invalid according to the spec we should be returning INCOMPLETE_ATTACHMENT.  BUG=angleproject:1231  Change-Id: I4b4332ee5661738374e93c825a53d66d7ba1fad5 Reviewed-on: https://chromium-review.googlesource.com/313995 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add support for GL_OES_depth32.  This will allow ANGLE to be more conformant when it accepts 32-bit depth as a Renderbuffer format.  BUG=angleproject:1230  Change-Id: I9336c6f951d280b2332fc3e6d2e640852473aa03 Reviewed-on: https://chromium-review.googlesource.com/313994 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Suppress failing dEQP tests.  With the suppression changes from 5111a06 a few were removed that seem to fail only on certain configurations. Reinstate the failure expectations for the dEQP bots.  BUG=angleproject:1236  Change-Id: Ib642c60a7871f7994ae1f0082f22533e6650f082 Reviewed-on: https://chromium-review.googlesource.com/315090 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix D3D static buffer cache cleanup logic  BUG=angleproject:197  Change-Id: Ia71f4063fa13c72a3a8bd41ec8fe01a762543796 Reviewed-on: https://chromium-review.googlesource.com/313468 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add queries for GL_RASTERIZER_DISCARD.  BUG=angleproject:1238  Change-Id: Id3b219dfcc758cf19d61b7dc7eeabd8c2159d212 Reviewed-on: https://chromium-review.googlesource.com/315100 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fixed compilation with mingw.  Change-Id: I8102ce4dd934ac247a29e31140d3a1eca691802f Reviewed-on: https://chromium-review.googlesource.com/315060 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add *.VC.opendb to the .gitignore  These are new temporary files used by VS 2015 Update 1  Equivalent Chromium CR: https://codereview.chromium.org/1413153015  Change-Id: I7a73b3d45107cf2a81b604953482aed9f2c971f8 Reviewed-on: https://chromium-review.googlesource.com/314881 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Using dirty bit notification for D3D11 rasterizer state  BUG=angleproject:1161  This is a continuation of the dirty bit refactor  Change-Id: I78ab046aaeb7de6dd288433c86e6524dcb2d6a66 Reviewed-on: https://chromium-review.googlesource.com/312837 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Dian Xiang <dianx@google.com> Tested-by: Dian Xiang <dianx@google.com>, 23355681, 619, 169, 619
Add link to browse source to README.md  This makes it more clear to anyone landing directly at README.md instead of the root of the repo how to browse the source.  Change-Id: I19b7e8e2f8e55385fa0825d4268623ef318bdaa0 Reviewed-on: https://chromium-review.googlesource.com/314441 Tested-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Using dirty bit notification for D3D11 depth stencil state  BUG=angleproject:1161  This is a continuation of the dirty bit refactor  Change-Id: If7d523e6200fef631051cab0bde47fdec8385c17 Reviewed-on: https://chromium-review.googlesource.com/312722 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Dian Xiang <dianx@google.com>, 23355681, 619, 169, 619
Update dEQP integration.  Intead of generating a case list from a build dEQP executable and packing it into a gzip file we can use the Android CTS mustpass list. This has the benefit of allowing us to remove some failure expectations for broken tests. It also means we don't need to ever regenerate our case list files.  Also remove the old dEQP test integration since it is no longer supported or possibly even working.  And update our test expectations to match the new Android CTS must-pass lists.  This change will likely need to be landed simulatanously with a Chromium-side CL due to the nature of the gyp/DEPS configuration.  BUG=angleproject:1236  Change-Id: I352e4a651dfb88193a1c4991974502dee1edb67b Reviewed-on: https://chromium-review.googlesource.com/313792 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Ignore clear commands if rasterizer discard is enabled.  From the 3.0 spec (Section 3.1):  "When enabled RASTERIZER_DISCARD also causes the Clear and ClearBuffer* commands to be ignored."  BUG=angleproject:1227  Change-Id: I0316103827927e8af9732d7b4565d787b881ccb8 Reviewed-on: https://chromium-review.googlesource.com/313993 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Re-land "D3D11: Fix Integer Texture Cube mip mapping."  We were missing both the correct SRV parameter as well as the full computation of the mip level in the HLSL.  Re-land makes the mip computation only happen with implicit sampling. Before it would confuse the LOD0 computation.  BUG=angleproject:1208 TEST=dEQP-GLES3.functional.texture.*  Change-Id: I4b579033afe5cd1aca1f2d017e48a74c7fc324cc Reviewed-on: https://chromium-review.googlesource.com/314330 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add and implement EGL_ANGLE_device_creation[_d3d11]  BUG=angleproject:1190  Change-Id: I248935ef81803062cf9ba5776512cda456331f51 Reviewed-on: https://chromium-review.googlesource.com/309634 Tryjob-Request: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Implement EGL_ANGLE_x11_visual"  Fails on Linux AMD:  http://build.chromium.org/p/chromium.gpu.fyi/builders/Linux%20Release%20%28ATI%29/builds/43819  EGLX11VisualHintTest.InvalidWindowVisualID: ../../third_party/angle/src/tests/egl_tests/EGLX11VisualTest.cpp:183: Failure Value of: EGL_TRUE == eglInitialize(display nullptr nullptr) Actual: false Expected: true  BUG=522149  This reverts commit b28e010aa10b3e4aec3207e767be10ee5ffb25fd.  Change-Id: I9a02f2aa3caadd787eb0099c0ddf9d781084fa1c Reviewed-on: https://chromium-review.googlesource.com/314660 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement EGL_ANGLE_x11_visual  This extension will be used by Chrome to advertise the visual it will use for its windows. Having ANGLE use the same visual will bring several benefits:  - A blit will be avoided and the content of the window might be    rendered on the system framebuffer directly.  - There will be less latency when resizing windows which will make it    much less likely to see a black border when resizing.  BUG=522149  Change-Id: Icd484c9a948ed5b5b9116247bb50560bffa30667 Reviewed-on: https://chromium-review.googlesource.com/312323 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Added information about generating Windows Store ANGLE projects.  Change-Id: I49b229b7d4f3d6d305fed023f62626a9966f692d Reviewed-on: https://chromium-review.googlesource.com/312456 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Hard-limit the number of uniform vectors in OpenGL.  Using the real limits (usually 4096) can cause the uniforms/gl-uniform-arrays WebGL test to time out.  This limit artificial limit can be lifted once the test is updated.  BUG=407309  Change-Id: I17a0a963e606800ec4f6f1972c777b597976622f Reviewed-on: https://chromium-review.googlesource.com/314460 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove assertion that OpenGL program linking succeeds.  This assertion is causing problems on the debug bots.  While the assertion is nice for local debugging causing the entire run of WebGL cts on the trybots to fail is too big of a drawback.  BUG=angleproject:889  Change-Id: Ie86d2f0e84132bef8fb94a693440af7e9b7fc8e9 Reviewed-on: https://chromium-review.googlesource.com/314480 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update gpu_test_expectations to support OSX 10.11  On the Chromium side there was also a large refactor of SplitString. This patch includes a replication of that refactor in string_utils and adds the Chromium unittests to string_utils_unittests.cpp  BUG=angleproject:1234  Change-Id: I4f71064fbf325c204e98a7b36ead118913d90f2c Reviewed-on: https://chromium-review.googlesource.com/314101 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Hide libpci pkg-config request behind use_libpci==1  This allows platforms that don't have libpci to configure the code without error.  BUG=560948  Change-Id: I155f35108d9be193afed5304b443a6afdf33b077 Reviewed-on: https://chromium-review.googlesource.com/314300 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Stephen Mcgruer <smcgruer@google.com> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove predefined precision qualifiers from ESSL3 samplers  New sampler types in ESSL3 should not have default precision qualifiers. This is specified in ESSL 3.00.4 section 4.5.4.  BUG=angleproject:1222 TEST=angle_unittests  Change-Id: I9c8e7a5fbb4278db80de79bcaeebaf23e64242a0 Reviewed-on: https://chromium-review.googlesource.com/312048 Tryjob-Request: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Add gl_FragDepth support for D3D11/ES3.  An incorrect check was blocking existing support we added for the extension.  BUG=angleproject:1226  Change-Id: I335053b1bebb37fd9296b36702031bd34c1bb59e Reviewed-on: https://chromium-review.googlesource.com/313992 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add checks for FBO attachment layer.  We would allow the app to attach layers that were out-of-bounds. Fix this by checking against the underlying resource dimensions. Also rework the code a bit to clean up the texture size query which is available from the ImageDesc.  BUG=angleproject:869  Change-Id: I984f1db16daea6ca650d795884d8ec2cb8f05ebb Reviewed-on: https://chromium-review.googlesource.com/313991 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "D3D11: Fix Integer Texture Cube mip mapping."  2 tests failed:     dEQP_GLES3.Default/functional_shaders_texture_functions_texture_isamplercube_vertex (c:\b\build\slave\gpu_win_builder\build\src\third_party\angle\src\tests\deqp_support\angle_deqp_gtest.cpp:234)     dEQP_GLES3.Default/functional_shaders_texture_functions_texture_usamplercube_vertex (c:\b\build\slave\gpu_win_builder\build\src\third_party\angle\src\tests\deqp_support\angle_deqp_gtest.cpp:234)  BUG=angleproject:1208  This reverts commit 5778557fe99e300f245a7bfc2200f6b0179e3fbf.  Change-Id: I6f7441bdbfbf937680b0d572645edee8ece649a1 Reviewed-on: https://chromium-review.googlesource.com/314301 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make Framebuffer size check ES2-only.  This is an ES2-only incompleteness check. We also need to require matching dimensions in D3D11 but make this an implementation specific check. Also make all implementation specific errors 'UNSUPPORTED' since that catches all "non-ES" framebuffer restrictions.  Note that we can't be conformant here in D3D11 currently since the spec only makes an exception for mismatching formats for UNSUPPORTED not for size checks. However we don't have an easy solution.  BUG=angleproject:1225  Change-Id: Ic80a04bce397fc12643b010c874f432033babc5d Reviewed-on: https://chromium-review.googlesource.com/313990 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix Integer Texture Cube mip mapping.  We were missing both the correct SRV parameter as well as the full computation of the mip level in the HLSL.  BUG=angleproject:1208  Change-Id: I345b1e0895495654de3863c4ebcc395d9b7371b9 Reviewed-on: https://chromium-review.googlesource.com/312060 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't accept default precision for uint  Default precision can only be specified for float int and sampler types. Default precision for int also applies to uint and uvec declarations.  BUG=angleproject:1221 TEST=angle_unittests  Change-Id: I31fdcde80da16e2ea8771838f7c1a6ab4e478194 Reviewed-on: https://chromium-review.googlesource.com/313314 Tryjob-Request: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Roll dEQP 92f7752da8..cc0ded6c.  https://android.googlesource.com/platform/external/deqp/+log/92f7752da8..cc0ded6c  BUG=angleproject:1092  Change-Id: Ie891d4d12eeaabb367e105e2e5e2f6823fb816f7 Reviewed-on: https://chromium-review.googlesource.com/313021 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Re-land "D3D: Generate more shader debug info by default."  Re-land with fix for shader size query.  The debug info can be very useful to WebGL developers. Instead of hiding the feature behind an unsupported and broken flag always enable it so that WebGL devs can access the useful translated info.  Change the debug info policy to build the full info (including generated assembly) in Debug and all info excepth the assembly in Release.  BUG=angleproject:1179  Change-Id: I812b2c9ba98cb8c9d5ec95721441c70e8990b626 Reviewed-on: https://chromium-review.googlesource.com/313600 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Using dirty bit notification for d3d11 blend state  BUG=angleproject:1161  This is a re-land for commit ff2ab57. Dirty bits didn't check for sampleMask hence when sampleMask changed and nothing else d3D states didn't update. This commit also focuses on blend state for d3d11 to make the cl change smaller and more manageable.  This commit also some performance regression issues that were occuring in commit ff2ab57  Change-Id: I866066689911870a84125fa2150f9efbf1405ad0 Reviewed-on: https://chromium-review.googlesource.com/312468 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Dian Xiang <dianx@google.com> Tested-by: Dian Xiang <dianx@google.com>, 23355681, 619, 169, 619
Add python perftests test runner.  This test runner can run the tests in an infinite loop giving much lower variance. It also automatically parses the output from several runs and prints out the mean and standard deviation of the population.  BUG=None  Change-Id: Ic9f6f7d3158e93949a8e17c99ea1e3856eb34076 Reviewed-on: https://chromium-review.googlesource.com/312262 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "D3D: Generate more shader debug info by default."  Has a bug where we would return the wrong size for the query.  BUG=angleproject:1179  This reverts commit 6de4d49477986339a92b542a18df22c49d10cf14.  Change-Id: Ib58aaf0b58d8f20765f7267b29acd8c62d287525 Reviewed-on: https://chromium-review.googlesource.com/313552 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Mark crashing dEQP-GLES3 TF Feedback test as SKIP.  This test was previously passing but adding the new enum support has somehow uncovered a crashing bug. Mark it as skipped.  BUG=angleproject:1150 BUG=angleproject:1151  Change-Id: Ieb0254606eab716a1628168433069ff8016e47a3 Reviewed-on: https://chromium-review.googlesource.com/313570 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D: Generate more shader debug info by default.  The debug info can be very useful to WebGL developers. Instead of hiding the feature behind an unsupported and broken flag always enable it so that WebGL devs can access the useful translated info.  Change the debug info policy to build the full info (including generated assembly) in Debug and all info excepth the assembly in Release.  BUG=angleproject:1179  Change-Id: I25656b76b8437cb2edc9d88cd33f2c4d19b6a3f0 Reviewed-on: https://chromium-review.googlesource.com/313160 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix instancing draw with line loops.  We were missing the implementation for the instanced draw for these. Implement them in the same way as for triangle fan.  BUG=angleproject:1101  Change-Id: I444f3a23383c63b8df6f9ebe25b255c8890632a1 Reviewed-on: https://chromium-review.googlesource.com/313007 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D: Fix incorrect instanced vertex offsets.  The spec says that DrawElements is equivalent to the instanced call with an instance ID of zero. This patch fixes a bug in our VertexDataManager where we would sometimes ignore the attribute divisor for DrawElements and stream the wrong amount of data/wrong start offset.  BUG=angleproject:1213 TEST=dEQP-GLES3.functional.draw.draw_elements.* TEST=dEQP-GLES3.functional.draw.draw_range_elements.* TEST=dEQP-GLES3.functional.draw.random.*  Change-Id: I1c430a14ab3be68a24e233e9cdd1e4fd88c920a0 Reviewed-on: https://chromium-review.googlesource.com/312062 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Check that texture offset is constant and valid  Offset passed to textureOffset and similar functions must be constant. See ESSL 3.00 spec section 8.8.  It must also be in the valid range between MIN_PROGRAM_TEXEL_OFFSET and MAX_PROGRAM_TEXEL_OFFSET. Using values outside the valid range makes the results of the texture lookup undefined as specified in GLES 3.0.4 section 3.8.10. We generate a compiler error if an offset is outside the valid range.  BUG=angleproject:1215 TEST=angle_unittests  Change-Id: Ida28361444d2f4050d516160f1491674c31868a1 Reviewed-on: https://chromium-review.googlesource.com/312223 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Remove incorrect comment from expectations files.  BUG=none TEST=none  Change-Id: I80283b825d4c9fe8c672c1efc9d6bc016b81ecc9 Reviewed-on: https://chromium-review.googlesource.com/312482 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Support glGet GL_TRANSFORM_FEEDBACK_BINDING.  BUG=angleproject:1150  Change-Id: If11bb2df6407248812d6dfa415395bbe315fa58c Reviewed-on: https://chromium-review.googlesource.com/311152 Tryjob-Request: Shannon Woods <shannonwoods@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Re-land "In D3D cache static vertex buffers to prevent wasteful recreation"  BUG=angleproject:197  Changes since first failed patch:  - Optimized BufferD3D::getStaticVertexBuffer()  - Removed loop to commit static buffers  - Out-of-date static buffers (which are much rarer anyway after this patch)    are marked for deletion at the *next* draw call rather than searched for    before each draw call. That search was expensive.  The change should see a net improvement to DrawCallPerfBenchmark for D3D null.  Change-Id: If4942e0afd9e8fefadce8820a1305e13636547ef Reviewed-on: https://chromium-review.googlesource.com/311115 Tested-by: Austin Kinross <aukinros@microsoft.com> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix invalid generated sampling functions in HLSL output  In some generated shaders "levels" would be read before it is assigned by GetDimensions when clamping mip level to valid range. Fix these cases.  BUG=angleproject:1092 TEST=dEQP-GLES3.functional.shaders.texture_functions.*      (12 tests start passing)  Change-Id: I9fce8d378606738e5172673d222bce7968e26789 Reviewed-on: https://chromium-review.googlesource.com/312022 Tryjob-Request: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Detect when gl_FragData is indexed with != 0 in WebGL 2.0  WebGL 2.0 explicitly specifies it to be an error when gl_FragData is indexed with anything else than constant zero in spec section 'GLSL ES 1.00 Fragment Shader Output'.  This doesn't apply to WebGL 1.0 or GLES. dEQP-GLES2.functional.shaders.fragdata* test that dynamic indexing of gl_FragData is allowed.  TEST=angle_unittests BUG=angleproject:1210  Change-Id: Ib401242e7867f5e7943456b059dd8e24dc404098 Reviewed-on: https://chromium-review.googlesource.com/312045 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix parsing structure definitions in place of constructors  The shader parser used to accept structure definitions in place of constructors which is invalid GLSL. This patch fixes that.  BUG=angleproject:939 TEST=angle_unittests  Change-Id: Ibcf502160e91c19e693e9427b548a399d83e2a71 Reviewed-on: https://chromium-review.googlesource.com/312032 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix structure comparison constant folding  objectSize() will return the size of all data in the structure and simply iterating over the data will work for determining whether two structures are equal. The earlier complex and broken approach where the structure was traversed recursively is not needed.  BUG=angleproject:1211 TEST=angle_unittests  Change-Id: I0e5c5ccbb767d44ef6acb0f1f25f27dfc42866e1 Reviewed-on: https://chromium-review.googlesource.com/312490 Tryjob-Request: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Qualify stored constant union data with const  This prevents accidentally changing data that may be shared between multiple TIntermConstantUnion nodes.  Besides making the code less prone to bugs in general this will make it easier to implement constant folding of array constructors.  BUG=541551 TEST=angle_unittests WebGL conformance tests  Change-Id: I4f3059f70b841d9dd0cf20fea4d37684da9cd47e Reviewed-on: https://chromium-review.googlesource.com/312440 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix ESSL3 indexing corner cases  Indexing interface blocks or fragment outputs with a non-constant expression is not valid even if ANGLE has been able to constant fold the expression.  BUG=angleproject:1210 TEST=angle_unittests  Change-Id: I2ccb67871b682976a31b8de306053b9b28c06437 Reviewed-on: https://chromium-review.googlesource.com/312044 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
bootstrap: make it work on Windows  gclient is a .bat file on Windows and subprocess won't run it unless shell=True.  BUG=angleproject:1204 TEST=run in Linux and Windows 8  Change-Id: I1f94673f23ef25fe35df64ffd1ad04ed69626ad0 Reviewed-on: https://chromium-review.googlesource.com/312324 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Austin Kinross <aukinros@microsoft.com> Tested-by: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Fix a user-after-free in a ValidationES unittest.  The State destructor was trying to unref a Program that had already been deleted. Fix this by unbinding resources from State before we exit the test.  BUG=554520  Change-Id: I2215b1e5d27a34a649572c8f81e96dfeef7e983e Reviewed-on: https://chromium-review.googlesource.com/312977 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix varying packing with structs.  Previously we would try to pass an entire struct through HLSL's shader interface. Instead split this off as if each field was its own variable which seems to be spec compliant (see ESSL 3.10).  In the future we may want to fix register packing to use specific components of float4/int4/uint4 HLSL registers. This could also fix the remaining bugs in the SM3 packing.  TEST=dEQP-GLES3.functional.shaders.linkage.varying.* BUG=angleproject:910 BUG=angleproject:1202  Change-Id: I1fd8b4505abc39bd2385ed5c088c316d55d0bc2c Reviewed-on: https://chromium-review.googlesource.com/311242 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D: Rework varying packing code.  In D3D we pack varyings by making a register map and using the recommended GLSL ES algorithm to reserve register space. We use this map to assign row and column slots to each varying and then produce a semantic index value.  The existing scheme had a number of bugs and was failing several angle_end2end_tests. The new design cleans up the code somewhat and uses a different counting scheme for the semantic indexes: just sort the varyings in packing order and use a simple incrementing semantic index per varying. In SM4+ the HLSL compiler sorts and packs the varyings correctly itself and in SM3 handle the cases we don't support by returning an error instead of a D3D compiler link error.  Also refactor how we store varying information for TF Feedback/ StreamOut. Only store the necessary D3D information instead of extra information like the name and type.  This fixes several tests in GLSLTest/*. This also will allow us to fix interpolation qualifier packing and the structure packing in HLSL which seems to work differently than the rest of the varying types.  BUG=angleproject:1202 TEST=botsdEQP-GLES3.functional.transform_feedback.*  Change-Id: Ie5bfbb4f71d8bf97f39115fc46d2e61b131df639 Reviewed-on: https://chromium-review.googlesource.com/311241 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ProgramD3D: Move some common code into a Metadata class.  This metadata class captures some of our commonly referenced but also complex flats into a shared place. We can then re-use them in the semantic code the DynamicHLSL linking code and the program code.  Refactoring patch only.  BUG=angleproject:1202  Change-Id: I8b6088cfa5488c5173a6f06c15abab5a4ead4cb8 Reviewed-on: https://chromium-review.googlesource.com/311700 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add bootstrap.py.  Add a script to run "gclient config" and edit the output since gclient will no longer do what we want.  BUG=angleproject:1204 TEST=none  Change-Id: I00e214490967e14034c935e051acc39229f27ff7 Reviewed-on: https://chromium-review.googlesource.com/312233 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Frank Henigman <fjhenigman@chromium.org>, 23355681, 619, 169, 619
Revert "Revert "renderergl_utils: Require explicit location qualifier for OpenGLES3""  This reverts commit 45a7d64fd84a7cb292ff71890a61f8d2b7609aa4.  Change-Id: I7f94609fc7cf14220d98c61e73a13311d3cc4ecd Reviewed-on: https://chromium-review.googlesource.com/311245 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
DisplayGLX: add support for complete lack of extensions  We thought we could rely on GLX_create_context_attrib being present but this is not the case with VM drivers. Instead we fallback to creating contexts with glXCreateContext that doesn't offer control on which version and profile the context will have.  Likewise we may not always be able to use the multisample but we can safely assume that the number of samples and sample buffers are zero in this case.  BUG=angleproject:1206  Change-Id: I888c69e609764994baf86386c9683b3edeb320f7 Reviewed-on: https://chromium-review.googlesource.com/312230 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix GL_ETC1_RGB8_OES format.  Passes all ETC1 related dEQP tests on Windows.  BUG=angleproject:1212 TEST=dEQP-GLES2.capability.extensions.compressed_texture_formats.GL_OES_compressed_ETC1_RGB8_texture TEST=dEQP-GLES2.functional.texture.format.* TEST=dEQP-GLES2.functional.texture.wrap.* TEST=dEQP-GLES2.functional.texture.filtering.* TEST=dEQP-GLES3.functional.texture.format.compressed.etc1* TEST=dEQP-GLES3.functional.texture.filtering.*  Change-Id: I937b039f90161bb5e8777766ea0c032ddfbbf159 Reviewed-on: https://chromium-review.googlesource.com/312416 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Minmin Gong <mgong@microsoft.com>, 23355681, 619, 169, 619
Re-land "D3D: Move some varying packing code into a new file."  Re-land with fix for compile errors.  Refactoring patch which moves code only. Work and full description will follow in a subsequent CL.  BUG=angleproject:1202  Change-Id: Ib7c7dbd32491cdd9512dbecdc0e1e90303d8f28d Reviewed-on: https://chromium-review.googlesource.com/312481 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
GLX backend: fallback to lesser swap_control extensions  Re-reland with a warning fix.  We would like to use the EXT_swap_control extension to specify the swap interval of each drawable independently. However open source drivers do not expose this extension and instead expose the MESA and SGI versions that have a global swap interval.  This commit changes the code to use the best swap_control extension it can potentially changing the swap interval on each swap buffers on lesser extensions.  BUG=angleproject:1206  Change-Id: I7ecf1eed6808672f277d0242d65f90d7851d2a32 Reviewed-on: https://chromium-review.googlesource.com/312322 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "GLX backend: fallback to lesser swap_control extensions"  This reverts commit a1393c59e9466dfe3a3ccaf710c272aa26045b85.  Change-Id: I5da0f740a7073f14ad1ee7e2876a9cc71a706e7f Reviewed-on: https://chromium-review.googlesource.com/312231 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Adds info from current landing page to README file  Also adds a table to document support for various APIs and platforms.  Change-Id: Ie032f553dec23516242a96ce6788fb086fad4229 Reviewed-on: https://chromium-review.googlesource.com/311021 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Revert "renderergl_utils: Require explicit location qualifier for OpenGLES3"  Causes angle_end2end_tests failures on Mac  This reverts commit d63243f5be2ac7d8dafa6aea5b23e036074af397.  Change-Id: Idf25d7fe9f4162813a4fc67927191747f660fceb Reviewed-on: https://chromium-review.googlesource.com/311041 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
renderergl_utils: Require explicit location qualifier for OpenGLES3  BUG=525930  Change-Id: I591308078c5a392a527291419567a11241a8be17 Reviewed-on: https://chromium-review.googlesource.com/309636 Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
DisplayGLX: validate configs against the backing context's config  This is a step required before adding an ANGLE extension that will allow passing the Visual ID to use for the context at display creation time: the configs will have to be compatible with it even if the visual has non-standard sizes.  BUG=522149  Change-Id: I85e8ee3b9072934c665bddfa2b461d26f8903ff3 Reviewed-on: https://chromium-review.googlesource.com/311220 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Enable needed extensions in generated GLSL shaders and call them when possible.  reland: use the defined preprocessor function.  BUG=angleproject:1044  Change-Id: I6171708a2d55ec085ba2c598a1a863779842da6c Reviewed-on: https://chromium-review.googlesource.com/311270 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix issues in comma operator parsing  Always qualify comma operator result with EvqTemporary in ESSL3 as specified.  Also it is possible that in the future some expressions are qualified as EvqConst but they'd still have side effects in which case discarding them when they're the left operand of the comma operator would be wrong. This would be the case if ANGLE allowed "(a = b).length()" for example. For this reason it is better to check whether the left node has side effects rather than check its const qualification and only discard it if it doesn't.  Also Intermediate::addComma() never returns null so there's no need to check the result.  BUG=angleproject:1201 TEST=WebGL conformance tests      conformance/glsl/misc/sequence-operator-returns-constant.html      conformance2/glsl3/sequence-operator-returns-non-constant.html  Change-Id: Ibfbd92baa4910b14c0dc8f8a3c3008440d191cd6 Reviewed-on: https://chromium-review.googlesource.com/311171 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Move comma operator parsing to ParseContext  This change is pure refactoring. It will help with fixing comma operator return value qualifier bug.  BUG=angleproject:911 BUG=angleproject:1201  Change-Id: I481c337adbaf789cc959c8a1106f99ad7275e1e5 Reviewed-on: https://chromium-review.googlesource.com/311170 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix missing init when parsing storage qualifier fails  When parsing a storage qualifier results in an error the parser should not leave the type uninitialized. Otherwise after recovering from the error the parsed value could contain uninitialized memory which could cause flaky asserts in further parsing.  TEST=dEQP-GLES2.functional.shaders.functions.* BUG=angleproject:1200  Change-Id: Ia3add76df243898e35fee97d01555b953cff8379 Reviewed-on: https://chromium-review.googlesource.com/311140 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
When doing a LUMA blit render to an intermediate texture.  Instead of rendering the swizzled result to the destination texture render to another intermediate texture and then CopyTexImage it into the destination texture.  Rendering to arbitrary mip levels of the destination texture is not always supported but CopyTexImage-ing is.  BUG=angleproject:1113  Change-Id: I352a1fcc769ce92268744d3e7a6265dd2bfddb37 Reviewed-on: https://chromium-review.googlesource.com/310570 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Enable needed extensions in generated GLSL shaders and call them when possible."  This reverts commit 233b334213c1a4853e81f71ba90aa223b2a68dce.  Change-Id: Id99024b736324ad030ce63c5d0baae32b6d7f54b Reviewed-on: https://chromium-review.googlesource.com/311181 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add magic newlines to markdown files.  Change-Id: I225ecab48a7d3d0a04390c5535cf5b65709fd758 Reviewed-on: https://chromium-review.googlesource.com/311072 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fixing formatting try three.  Change-Id: I226d35e777e1388e01189dac0f7189e2cbf3d35a Reviewed-on: https://chromium-review.googlesource.com/311061 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
More formatting fixes.  Change-Id: I8ff32a61362e5329c922ec696ba69480145f316a Reviewed-on: https://chromium-review.googlesource.com/311081 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix .md file formatting  Change-Id: Ie9240f9b03ad8ab106659d2dc369893bfc2b652f Reviewed-on: https://chromium-review.googlesource.com/311071 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Enable needed extensions in generated GLSL shaders and call them when possible.  BUG=angleproject:1044  Change-Id: Ife94d2258fb912974aa97484a0e30f289dd96734 Reviewed-on: https://chromium-review.googlesource.com/278324 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "In D3D cache static vertex buffers to prevent wasteful recreation"  Perf bisect traced performance regression to this CL:  8.1% regression in angle_perftests/DrawCallPerf_d3d9_null/score 6.2% regression in angle_perftests/DrawCallPerf_d3d11_null/score  BUG=angleproject:197  This reverts commit 868651d334d060458af13c7ff9211c2f72be0cad.  Change-Id: Iaba7eb4e574eb886496361e61fd5fe78ca14dcb8 Reviewed-on: https://chromium-review.googlesource.com/311150 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Using dirty bits notification for blend state  BUG=angleproject:1161  Dirty bit notifications are used in GL for state tracking but not D3D. Before D3D would use memcmp to check a change in state for every call. This showed up as a hot spot in the perf test runs. Hence switching D3D over to the dirty bit system similar to GL backend will help.  Change-Id: I482edc852f1dcc888af3038ff3a61916496a02bc Reviewed-on: https://chromium-review.googlesource.com/305295 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Dian Xiang <dianx@google.com> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Accept const array initialization in shader parsing  Array constructors are not folded unlike all other constant expressions. Change initializer parsing path so that it accepts constant initializers whether they are folded or not.  Some parts need to be adapted to work with expressions that are qualified as constant but that are not necessarily folded:  1. Identifier parsing 2. Indexing parsing 3. Field selection parsing 4. HLSL output for variable declarations 5. Determining unary operator result type 6. Determining binary operator result type 7. Determining built-in function call result type 8. Determining ternary operator result type  Corner cases that are not supported yet:  1. Using array constructors inside case labels 2. Using array constructors inside array size expressions 3. Detecting when a negative constant expression containing an array    constructor is used to index an array  In these cases being able to constant fold the expression is essential to validating that the code is correct so they require a more sophisticated solution. For now we keep the old code that rejects the shader if ANGLE hasn't been able to constant fold the case label or array size. In case of indexing an array with a negative constant expression containing an array constructor ANGLE will simply treat it as a non-constant expression.  BUG=541551 BUG=angleproject:1094 TEST=dEQP-GLES3.functional.shaders.constant_expressions.* (all pass)      angle_unittests  Change-Id: I0cbc47afd1651a4dece3d68acf7ec72a01fdf047 Reviewed-on: https://chromium-review.googlesource.com/310231 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
build: ensure gyp_angle uses angle's gyp  Prepend to sys.path instead of appending so that gyp_angle imports angle's gyp instead of whatever may be installed on the system.  BUG=angleproject:1203  Change-Id: I9f3cfddb71fbd53f30ebf5792c31ba0a8947bddb Reviewed-on: https://chromium-review.googlesource.com/311040 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update the gclient config instructions to not use relative paths.  As of https://codereview.chromium.org/1406053003 relative paths are no longer valid for the solution name.  Update the docs to use the full current directory instead.  BUG=angleproject:1204  Change-Id: I42b289fdad6d85901f431bb701f2a08e0ad0deb3 Reviewed-on: https://chromium-review.googlesource.com/311180 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update the testing documentation to include the trybots.  BUG=504872  Change-Id: I9cbbe92afc9df6a4cb8f3ddf0c547492c6765c8e Reviewed-on: https://chromium-review.googlesource.com/310011 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D11: Restrict use of MAX_UINT element indexes.  We need to block the app from using MAX_UINT on D3D11 because we can't disable primitive restart on this platform. Instead generate an INVALID_OPERATION error which is spec-compliant in ES3 because the result is undefined behaviour. This is also compliant with WebGL which explicitly defines an error here.  BUG=angleproject:597  Change-Id: I7ebc5371b63ff860dc6dddf79939e9629ebb2a3c Reviewed-on: https://chromium-review.googlesource.com/309638 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
DisplayGLX: on mesa only expose configs with the same depth-stencil  BUG=angleproject:1188  Change-Id: I19516cf3d037245144dfbe6fa2eed13a57aa6800 Reviewed-on: https://chromium-review.googlesource.com/309635 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
RendererGL: only support ES3 when GLSL packing builtins are available  BUG=angleproject:1188  Change-Id: I07638c52ef09ffc96d91eec25c32dd905207c49f Reviewed-on: https://chromium-review.googlesource.com/309650 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add a ValidationContext class helper.  This class is a wrapper around gl::Data aka the metadata describing a gl::Context. We can use it for unit-testing validation functions by passing that through the validation methods instead of a Context and using mocks to expect certain errors.  BUG=angleproject:747 BUG=angleproject:597  Change-Id: I7bd85c7662860ba9a3a13406579a088d447e5631 Reviewed-on: https://chromium-review.googlesource.com/309637 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move variable identifier parsing to ParseContext  This change is purely refactoring existing functionality to make it easier to change variable identifier parsing.  BUG=angleproject:911 BUG=541551  Change-Id: I282fbb66d40cd71fa0f4804e4a8e893744cd6bfc Reviewed-on: https://chromium-review.googlesource.com/309724 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Update dEQP failing test expectations.  BUG=angleproject:1088 BUG=angleproject:1095 BUG=angleproject:1097 BUG=angleproject:1101  Change-Id: I40f4d5960ef52bb1049336d23da4034a41f2fe63 Reviewed-on: https://chromium-review.googlesource.com/310480 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix standalone build in MSVS 2013  Range-based for loop saves the end iterator by assigning it to a variable so the iterator class needs to have a copy constructor at least on some C++ compiler implementations.  The issue got introduced by a chain of three commits so it's better to just fix the issue rather than revert them all.  TEST=build on Windows  Change-Id: Ib6d8d7e97559838eaac44279454197445535f256 Reviewed-on: https://chromium-review.googlesource.com/309723 Tryjob-Request: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "DisplayGLX: rework how glXCreateContextAttribsARB is called"  Breaks dEQP-GLES2.functional.texture.specification.basic_copyteximage2d.2d_alpha  BUG=angleproject:1188  This reverts commit 31e60cf221801a60c052112b5a0bbcfad9b5f705.  Change-Id: Icf1fcd984832a813536fe63e385b3cf9f667d66b Reviewed-on: https://chromium-review.googlesource.com/309801 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix provoking vertex for flat triangle strips.  Triangle strips alternate the provoking vertex based on the primitive so use the primitive ID in the GS to determine this. This might interact poorly with primitive restart so we might have to use a slow path for that.  BUG=angleproject:754  Change-Id: I4f6f520887d4c4c52d2ad020e6db148607f68325 Reviewed-on: https://chromium-review.googlesource.com/309156 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
DisplayGLX: rework how glXCreateContextAttribsARB is called  This patch adds handling of the EGL ANGLE platform api version display attributes for better testing.  It makes the code more resilient by ignoring X11 errors that could crash our program in the call to glXCreateContextAttribsARB.  It also makes sure that we always choose the most recent OpenGL version available on the system.  BUG=angleproject:1188  Change-Id: I26e1bf6733215db6f5841b54c471f644e2b15e89 Reviewed-on: https://chromium-review.googlesource.com/309633 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix basic provoking vertex flat shading cases.  The enables geometry shaders that correct for the flat shading on provoking vertexes. It does not fix it for triangle strips or in conjunction with primitive restart (which is not yet implemented in D3D11).  Also ensure we do not regress with flat shading enabled and transform feedback. In cases where we use flat shading do a double draw call first with an untransformed vertex stream and no geometry shader then with the geometry shader enabled.  This also fixes the dEQP fragment output tests with ints.  BUG=angleproject:754  Change-Id: Ib37e8ec32d19db17ea5d4dc88158cdae0c956bfc Reviewed-on: https://chromium-review.googlesource.com/309155 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor DynamicHLSL geometry shader code more.  This refactor adds a typed iterator class for helping to iterate over varying registers from packed varyings. We use the same iteration logic in several places and it has a triple loop so encapsulating this into an iterator class keeps it cleaner.  The other change is to use std::stringstream in places where we would return a std::string.  These refactorings will aid in subsequent work to implement provoking vertex fixes and to refactor our varying packing algorithm.  BUG=angleproject:754  Change-Id: Id44a1f68ccd4edc3458f1cf514f5eab4b8cd4151 Reviewed-on: https://chromium-review.googlesource.com/309811 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
PbufferSurfaceGLX: avoid creating (0 0)-sized pbuffers  It crashes on Mesa.  BUG=angleproject:1188  Change-Id: I1e1e3e696bfda0c127b683a620cbaf302087e43b Reviewed-on: https://chromium-review.googlesource.com/309630 Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove dynamic indexing of matrices and vectors in HLSL  Re-re-relanding after clang warning fix.  Re-re-landing with fix to setting qualifiers on generated nodes. The previous version failed when a uniform was indexed because it would set the uniform qualifier on some of the generated nodes and that interfered with the operation of UniformsHLSL.  Re-landing after fixing D3D9 specific issues.  HLSL doesn't support dynamic indexing of matrices and vectors so replace that with helper functions that unroll dynamic indexing into switch/case and static indexing.  Both the indexed vector/matrix expression and the index may have side effects and these will be evaluated correctly. If necessary index expressions that have side effects will be written to a temporary variable that will replace the index.  Besides dEQP tests this change is tested by a WebGL 2 conformance test.  In the case that a dynamic index is out-of-range the base ESSL 3.00 spec allows undefined behavior. KHR_robust_buffer_access_behavior adds the requirement that program termination should not occur and that out-of-range reads must return either a value from the active program's memory or zero and out-of-range writes should only affect the active program's memory or do nothing. This patch clamps out-of-range indices so that either the first or last item of the matrix/vector is accessed.  The code is not transformed in case the it fits within the limited subset of ESSL 1.00 given in Appendix A of the spec. If the code isn't within the restricted subset even ESSL 1.00 shaders may require this workaround.  BUG=angleproject:1116 TEST=dEQP-GLES3.functional.shaders.indexing.* (all pass after change)      WebGL 2 conformance tests (glsl3/vector-dynamic-indexing.html)  Change-Id: I9f6d7c7ecda8ac4dc3c30b39e15a9a0b5381c5a8 Reviewed-on: https://chromium-review.googlesource.com/310010 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D11: Add dynamic geometry shaders.  The geometry shader we want will depend on our current draw mode and if we're using flat shading in the shader. Without flat shading we'll still be using them only for point sprites but for other primitive types with flat shading enabled we'll be using them to correct the provoking vertex order with D3D11.  Note: no new features in this CL those are turned on in follow-ups.  BUG=angleproject:754  Change-Id: Iabf13ffd582f5a7200ee0df5aa9c3671aa7b6ed4 Reviewed-on: https://chromium-review.googlesource.com/309154 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor Geometry Shader support to enable pass-through.  This should be a refactoring change only. The new code is exercised in follow-up CLs.  BUG=angleproject:754  Change-Id: I99285e1e7772cae467013102f25c911ebc9f54a9 Reviewed-on: https://chromium-review.googlesource.com/309153 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Removed Sleep( ) workaround for Windows Store builds  Visual Studio SDKs now include the ability for Windows Store applications to use the Sleep( ) function.  Change-Id: Iaf2a978e778f82e918ba14a58bbb1807cc1fbaf4 Reviewed-on: https://chromium-review.googlesource.com/309890 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
dEQP: Use full GTest name in non-standalone.  With crbug.com/509883 fixed we can use the full test names.  BUG=509883 BUG=angleproject:1153  Change-Id: I62bf60fb5066de8c0cc118512ba0d9e9bbd94303 Reviewed-on: https://chromium-review.googlesource.com/309653 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Remove dynamic indexing of matrices and vectors in HLSL"  Failing build on Clang-win:  ..\..\third_party\angle\src\compiler\translator\RemoveDynamicIndexing.cpp(12843) :  error: expected '(' for function-style cast or type construction         fieldType.setPrimarySize(unsigned char(indexedType.getRows()));                                  ~~~~~~~~ ^  BUG=angleproject:1116  This reverts commit 7535b761dd4740c8e76b888d7c58c7cbeefd2083.  Change-Id: I7b502e3dcd45e17b7ed88fec18be702614d9ac65 Reviewed-on: https://chromium-review.googlesource.com/309772 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ProgramBinaryTest: use override where applicable  BUG=None  Change-Id: Ibb3c6ea919c34e967aaa5d475d6e05249d2ee6aa Reviewed-on: https://chromium-review.googlesource.com/309810 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Replace _countof with ArraySize  This macro only exists on MSVC  BUG=None  Change-Id: I23204d1307279840a7f85a005da9ed5c324e7dae Reviewed-on: https://chromium-review.googlesource.com/309800 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
platform_glx: Add support for ARB_create_context_profile  BUG=angleproject:1188  Change-Id: I5a72ff3521c01b4da661a90f6d761da61b3aad60 Reviewed-on: https://chromium-review.googlesource.com/309631 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
In D3D cache static vertex buffers to prevent wasteful recreation  BUG=angleproject:197  Change-Id: I66cd10609b2edbcf12b99530eafe1727511fe515 Reviewed-on: https://chromium-review.googlesource.com/296503 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix a typo in DisplayWGL  BUG=None  Change-Id: Ib9d43ced80f38c61f5936fb027433d9f2b4c7f98 Reviewed-on: https://chromium-review.googlesource.com/309632 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
OSXWindow fix a use after free of the WindowDelegate  This use after free was triggered when a window was made key and destroyed then another window was made key. dedResignKey was called on the former's WindowDelegate which had already been freed causing a crash.  BUG=angleproject:891  Change-Id: If47e88419f9a407a6a77c5cd9853b7b4860dc698 Reviewed-on: https://chromium-review.googlesource.com/305817 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Reland Fixed FL9_3 shaders that use glPointCoord without glPointSize.  This change fixes a Shader error on FL9_3 that reports Vertex/Pixel Shader linkage signatures between stages being incompatible when glPointCoord is used without glPointSize.  Change-Id: I107d06692c5375c07544038f5f4429c1e8d6e313 Reviewed-on: https://chromium-review.googlesource.com/305395 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add ASTC compressed texture format info to the GL layer.  BUG=angleproject:1185  Change-Id: Ie723687e0289812d6c2306589911b548ac321e22 Reviewed-on: https://chromium-review.googlesource.com/308491 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a test for flat shader 'provoking vertex'.  The provoking vertex or leading vertex is the vertex in a triangle which produces the value that gets used for a flat-shaded triangle. Flat shading means the same value gets used for the entire triangle.  It seems as though D3D and OpenGL have different definitions of which vertex is the leading/provoking one; GL says it is the *last* vertex of a primitive while while D3D says it is the first.  Additional complexity comes about from triangle strips which switch winding order and primitive restart which defines new primitives in the middle of prior primitives.  BUG=angleproject:754  Change-Id: If1217cba33dabf3b1e4ad13fd639d049cb16fe44 Reviewed-on: https://chromium-review.googlesource.com/309152 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix parsing integers larger than 0x7FFFFFFF  Parsing should accept all values between 0 and 0xFFFFFFFF as specified in ESSL 3.00 section 4.1.3.  When a signed literal is parsed it's interpreted as if it specifies the bit pattern of a two's complement integer. For example parsing "0xFFFFFFFF" results in -1. Decimal literals behave the same way so for example parsing "3000000000" results in -1294967296.  This change affects parsing of literals in ESSL 1.00 as well. In ESSL 3.00 an out-of-range integer literal now generates a compiler error.  Unit tests are added based on examples in the ESSL 3.00 spec and one example in GLSL 4.5 spec that ESSL should match.  BUG=541550 TEST=angle_unittests  Change-Id: I82f8ef5cfa2881019a3f80d77ff99707d61c000d Reviewed-on: https://chromium-review.googlesource.com/305420 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Corentin Wallez <cwallez@google.com>, 23355681, 619, 169, 619
DisplayGLX: make the dummy pbuffer of size (1 1)  This works around a Mesa crasher bug.  BUG=angleproject:1188  Change-Id: Ief7e6e841715cc04dea696bc1919d7a2d6fbc78d Reviewed-on: https://chromium-review.googlesource.com/309141 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
FunctionsGLX: add glXGetCurrent(Drawable|Context) support  BUG=angleproject:1188  Change-Id: Ibf0fb4be3ec08cc43b2d9aba03a3d0fc12adce9d Reviewed-on: https://chromium-review.googlesource.com/309140 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement primitive restart boolean query.  We have support for primitive restart in the GL renderer but we didn't complete support for the state query.  BUG=angleproject:1101  Change-Id: I4c6ad10642f7de1d09718c4582f1037782cced58 Reviewed-on: https://chromium-review.googlesource.com/309151 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@google.com> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update WebGL test expectations.  BUG=None  Change-Id: Id2a88bcfd9ebf8152704ca9fc66d8401d5db43e2 Reviewed-on: https://chromium-review.googlesource.com/309150 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Output layout qualifiers in GLSL output  Output layout qualifiers for vertex shader attributes and fragment shader outputs. This applies both to ESSL output and GLSL output. If the source shader is in ESSL1 the code has no effect since there's no layout information in the AST.  BUG=525930 TEST=angle_unittests angle_end2end_tests  Change-Id: I48b3aa56116c15d11599b030eed4c45be2c8fc7e Reviewed-on: https://chromium-review.googlesource.com/304550 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@google.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Validate that compressed image formats are supported by the context.  This validation was previously acceptable because all renderers supported all compressed formats in the format tables.  Adding new formats that are not universally supported would have caused failures in the dEQP negative API tests.  BUG=angleproject:1185  Change-Id: I102a3286a351a7c8936527963a382d9673341fc0 Reviewed-on: https://chromium-review.googlesource.com/308490 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove dynamic indexing of matrices and vectors in HLSL  Re-re-landing with fix to setting qualifiers on generated nodes. The previous version failed when a uniform was indexed because it would set the uniform qualifier on some of the generated nodes and that interfered with the operation of UniformsHLSL.  Re-landing after fixing D3D9 specific issues.  HLSL doesn't support dynamic indexing of matrices and vectors so replace that with helper functions that unroll dynamic indexing into switch/case and static indexing.  Both the indexed vector/matrix expression and the index may have side effects and these will be evaluated correctly. If necessary index expressions that have side effects will be written to a temporary variable that will replace the index.  Besides dEQP tests this change is tested by a WebGL 2 conformance test.  In the case that a dynamic index is out-of-range the base ESSL 3.00 spec allows undefined behavior. KHR_robust_buffer_access_behavior adds the requirement that program termination should not occur and that out-of-range reads must return either a value from the active program's memory or zero and out-of-range writes should only affect the active program's memory or do nothing. This patch clamps out-of-range indices so that either the first or last item of the matrix/vector is accessed.  The code is not transformed in case the it fits within the limited subset of ESSL 1.00 given in Appendix A of the spec. If the code isn't within the restricted subset even ESSL 1.00 shaders may require this workaround.  BUG=angleproject:1116 TEST=dEQP-GLES3.functional.shaders.indexing.* (all pass after change)      WebGL 2 conformance tests (glsl3/vector-dynamic-indexing.html)  Change-Id: I16119f9092360fb72798f9550a6f4d3cfffdc92f Reviewed-on: https://chromium-review.googlesource.com/308790 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Suppress failing textures tests in Linux dEQP.  BUG=angleproject:1020  Change-Id: Ia074186c2f80b41c5a02523b3b3f564cd09ec557 Reviewed-on: https://chromium-review.googlesource.com/308920 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't use static const & locals for format tables.  This hits an unimplemented feature in Clang. Work around this by using values instead of references.  BUG=angleproject:1160  Change-Id: I94b08d8fd9a09bbbfbe4bcd1b6f9d7f0031ce18d Reviewed-on: https://chromium-review.googlesource.com/308910 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Re-re-land "Add GL_OES_vertex_array_object to D3D11 and GL renderers"  + Include fixed validation logic for GL_UNPACK_SKIP_IMAGES and GL_UNPACK_ROW_LENGTH + Include fix for Clang build break  BUG=angleproject:1186  Change-Id: I403a066e29614f532db6931755265d2ee088d442 Reviewed-on: https://chromium-review.googlesource.com/308746 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Re-land "Add GL_OES_vertex_array_object to D3D11 and GL renderers""  Fails build on Clang because Caps.cpp defines a constructor initializer out-of-order with the member variable order in the header.  BUG=angleproject:1186  This reverts commit 7432321e03a70a99639b149f44cf80086feb4ea2.  Change-Id: I2840d02e6e7b6bbc76eb495b5462c43116a5c4a6 Reviewed-on: https://chromium-review.googlesource.com/308800 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update dEQP-GLES2 expectations.  Some texture.mipmap.2d.projected are passing and  fbo.api.valid_texcube_attachments seems to pass.  BUG=angleproject:1026 BUG=angleproject:1020  Change-Id: I46ada896978cbb0a3bcbfb3985a5a50e4095ab98 Reviewed-on: https://chromium-review.googlesource.com/308391 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Remove dynamic indexing of matrices and vectors in HLSL"  This reverts commit 3766a40d6fda7e7190514ab7838a3f37169d863f.  This CL was causing crashes in UniformHLSL.cpp where an internal uniform "base" was attempted to be declared in HLSL. Was crashing on an external WebGL 3D canvas page (http://www.taccgl.org/?dbg=t).  BUG=546686  Original commit message:  Re-landing after fixing D3D9 specific issues.  HLSL doesn't support dynamic indexing of matrices and vectors so replace that with helper functions that unroll dynamic indexing into switch/case and static indexing.  Both the indexed vector/matrix expression and the index may have side effects and these will be evaluated correctly. If necessary index expressions that have side effects will be written to a temporary variable that will replace the index.  Besides dEQP tests this change is tested by a WebGL 2 conformance test.  In the case that a dynamic index is out-of-range the base ESSL 3.00 spec allows undefined behavior. KHR_robust_buffer_access_behavior adds the requirement that program termination should not occur and that out-of-range reads must return either a value from the active program's memory or zero and out-of-range writes should only affect the active program's memory or do nothing. This patch clamps out-of-range indices so that either the first or last item of the matrix/vector is accessed.  The code is not transformed in case the it fits within the limited subset of ESSL 1.00 given in Appendix A of the spec. If the code isn't within the restricted subset even ESSL 1.00 shaders may require this workaround.  BUG=angleproject:1116 TEST=dEQP-GLES3.functional.shaders.indexing.* (all pass after change)      WebGL 2 conformance tests (glsl3/vector-dynamic-indexing.html)  Change-Id: I1d4b2e3888e91af7d5eebf743d12778698b6b903 Reviewed-on: https://chromium-review.googlesource.com/308770 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor RendererD3D::applyShaders.  Reduce the argument count to make future refactorings easier.  BUG=angleproject:754  Change-Id: Ia8acfc2bc8f922ad6a115e198ea51a62710a422c Reviewed-on: https://chromium-review.googlesource.com/307873 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix up the style in DynamicHLSL a bit.  Use std::stringstream when possible and use Context's caps instead of the Renderer's.  BUG=angleproject:754  Change-Id: I2dc773709bbd612ab7ea372a358337c0a81869a3 Reviewed-on: https://chromium-review.googlesource.com/307872 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fixed compilation on mingw.  BUG=angleproject:1184  This is reland of parts of commit 566273222683314d. It also adds <algorithm> include in FunctionsWGL.cpp which is needed for std::find on GCC.  Change-Id: I852008087afa6b12da6e7e29934fa83390fded21 Reviewed-on: https://chromium-review.googlesource.com/308090 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Changed GetTextureFormatInfo to use static switch  BUG=angleproject:1160  The find of the map table in GetTextureFormatInfo is showing up as a hotspot in draw call perf benchmark. Switching the map into a static switch should make it more efficient.  Other tables that only GetTextureFormatInfo uses is also converted into static switching instead of maps for performance. Other tables include swizzle_format_table and load_functions_table which are both only used by GetTextureFormatInfo to generate the TextureFormat for a given internalFormat and d3d device caps.  The static switches for each table is generated using a python script named gen_*.py. The data for each table is stored in JSON files. This makes it more flexible for additions and deletions.  Change-Id: I0f40fcc2a215c85661863ea225891071cb2f2c71 Reviewed-on: https://chromium-review.googlesource.com/301770 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tryjob-Request: Dian Xiang <dianx@google.com> Tested-by: Dian Xiang <dianx@google.com> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Re-land "Add GL_OES_vertex_array_object to D3D11 and GL renderers"  Include fixed validation logic for GL_UNPACK_SKIP_IMAGES and GL_UNPACK_ROW_LENGTH  BUG=angleproject:1186  Change-Id: I9910a67733702a05991f62129d200ea39adb910c Reviewed-on: https://chromium-review.googlesource.com/308421 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add "../../../third_party/deqp/src/data" to dEQP data directories  Change-Id: I9bd4127d2eb24657e45b3a3b4668794d86b9d0e3 Reviewed-on: https://chromium-review.googlesource.com/308481 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Add GL_OES_vertex_array_object to D3D11 and GL renderers"  This is failing the WebGL 2 test:  WebglConformance.conformance2_state_gl_get_calls  http://build.chromium.org/p/chromium.gpu.fyi/builders/Win8%20Debug%20%28NVIDIA%29/builds/9807  Also the dEQP-GLES3 tests: dEQP-GLES3.functional.state_query.integers.unpack_skip_images_get*  BUG=angleproject:1186  This reverts commit eb36e275b8f63ebd442a2580e858ef671ddfe1be.  Change-Id: If903c471f4610ac0b33a268df42f3329d672f429 Reviewed-on: https://chromium-review.googlesource.com/308460 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
angle: prevent huge allocations when GL_MAX_VERTEX_ATTRIBS fails  I'm not sure why yet but when using angle in skia getIntegerv(GL_MAX_VERTEX_ATTRIBS &maxVertexAttribs) sometimes fails and when that happens we attempt to allocate and array with the size of maxVertexAttribs which is uninitialized which could be huge.  Prevent this by initializing the variable.  Also sweep through other similar calls and ensure that these use initialized values (test code has not been updated)  BUG=skia:4380  Change-Id: If1f3cf72f2b2829ad3933637af8778d574a20f61 Reviewed-on: https://chromium-review.googlesource.com/307239 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Dian Xiang <dianx@google.com> Tested-by: Hendrik Wagenaar <hendrikw@chromium.org>, 23355681, 619, 169, 619
Revert "Add ASTC compressed texture format info to the GL layer."  This reverts commit 3bd6e18d1b6545b94bb82c23bcfa076579adf0ce.  Change-Id: I44a82cec1757061897f35f3f63dc6bcc09429866 Reviewed-on: https://chromium-review.googlesource.com/308410 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add GL_OES_vertex_array_object to D3D11 and GL renderers  BUG=angleproject:1186  Change-Id: I7c685084b42f977902228cadca3263064881ba77 Reviewed-on: https://chromium-review.googlesource.com/307038 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Enable EXT_discard_framebuffer in ANGLE's D3D11 backend.  This doesn't seem to cause the video-related WebGL test failures anymore that were previously seen.  BUG=497445  Change-Id: I705ae8735823ab7f4b26cf7696cdb746936e4447 Reviewed-on: https://chromium-review.googlesource.com/308001 Tryjob-Request: Kenneth Russell <kbr@chromium.org> Tested-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Support GL_ETC1_RGB8_OES.  Passes all dEQP tests related to etc1.  Reland: Updated to work with the D3D11 renderer and re-tested with chromium's gles2_conform_test.  Change-Id: Id2ce1b0eb58129152f67016ce2dc3ab19208269c Reviewed-on: https://chromium-review.googlesource.com/299770 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Lazily load the Blit11 buffers and state objects.  BUG=angleproject:1014  Change-Id: I46629253d164a7522c3a97574fcf591f395b04ea Reviewed-on: https://chromium-review.googlesource.com/295144 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add ASTC compressed texture format info to the GL layer.  BUG=angleproject:1185  Change-Id: Ia0bbe85fe8fa2b6a55289ff291f30e215d7a3ba9 Reviewed-on: https://chromium-review.googlesource.com/301146 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Skip the TransformFeedbackTest.MultiContext on OSX AMD too.  BUG=angleproject:889  Change-Id: Idf8d00ac13382970aa8b16313a56db32a3fca05f Reviewed-on: https://chromium-review.googlesource.com/307891 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement TransformFeedbackGL.  Reland with supression for TransformFeedbackTest.MultiContext on Linux AMD.  BUG=angleproject:889  Change-Id: I6f2a2e856dacf16308de222dd0936bedbb3b175c Reviewed-on: https://chromium-review.googlesource.com/307871 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Implement TransformFeedbackGL."  Failing on AMD Linux bots.  This reverts commit a9c5288192f90ebf03b0d26d86964b4fbce74bcb.  Change-Id: I2a2db8c3d96c4b927d7d784486c6df772ae63084 Reviewed-on: https://chromium-review.googlesource.com/308130 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement TransformFeedbackGL.  BUG=angleproject:889  Change-Id: I347ac21cfd0a56654a75fb41ac24c6c67ede3a05 Reviewed-on: https://chromium-review.googlesource.com/302351 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use .def file to export functions using dllexport.  BUG=angleproject:1183  This is a reland of part of commit 566273222683314dfc8ac1cdb9bf6deb5d2b4c65. The original commit caused warnings on 64-bit MSVC linker. This version removes declspec(dllexport) from exported ANGLE APIs (for which we need a new ANGLE_PLATFORM_EXPORT macro). It also makes those APIs stdcall on Windows builds.  Change-Id: Iee2ab7e43ef0b98924f5759b5e1b333307052235 Reviewed-on: https://chromium-review.googlesource.com/304501 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't ASSERT shader compilation success in ShaderGL.  This assertion was useful for debugging the initial implementation but it is becoming an issue in tryjobs where tests will hang instead of fail due to driver bugs.  BUG=angleproject:882  Change-Id: Ib23a0d16dfe250ea175a166b5e277bf07d80a2fa Reviewed-on: https://chromium-review.googlesource.com/307460 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Re-land "Only require that the stencil masks are same as many effective bits set"  It seems reasonable to validate the equality between stencilWriteMask and stencilBackWriteMask only by comparing the effective bits. An existing dEQP test[1] and a WebGL test[2] also use the max size of stencil bits for checking the stencil mask values.  [1] StencilWriteMaskSeparateTestCase (gles3/functional/ es3fIntegerStateQueryTests.cpp) [2] https://www.khronos.org/registry/webgl/sdk/tests/conformance/state/ gl-get-calls.html (Search for "minimumRequiredStencilMask ")  Re-land with fix for Clang warning.  Change-Id: I4cadaffced04ca55fa6daf7ac6a462368e0cfeec Reviewed-on: https://chromium-review.googlesource.com/307530 Reviewed-by: Jinyoung Hur <hurims@gmail.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Only require that the stencil masks are same as many effective bits set"  Reverting temporarily causes a compile warning with Clang:  ..\..\third_party\angle\src\libANGLE\renderer\d3d\d3d11\Renderer11.cpp(2427) :  error: field 'mDebug' will be initialized after field 'mCurStencilSize' [-Werror-Wreorder]       mDebug(nullptr)       ^ 1 error generated. ninja: build stopped: subcommand failed.  http://build.chromium.org/p/tryserver.chromium.win/builders/win_clang_dbg/builds/98  This reverts commit 685aa4b87d2c6a3f13134c77af8690e5f3d6aa6d.  Change-Id: I9dab08b26e2eddf508a7bcde7813c25be350bf31 Reviewed-on: https://chromium-review.googlesource.com/307520 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add support for EAC and ETC2 texture formats with D3D11.  Passes:  * dEQP-GLES3.functional.implementation_limits.num_compressed_texture_formats  * dEQP-GLES3.functional.implementation_limits.compressed_texture_formats  * dEQP-GLES3.functional.texture.*eac*  * dEQP-GLES3.functional.texture.*etc2*  BUG=angleproject:598  Change-Id: Iaec1756b540f8f44c821fd8b9ba63f115ebe6de0 Reviewed-on: https://chromium-review.googlesource.com/305520 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix ANGLE documentation about Chromium build.  BUG=angleproject:848  Change-Id: If70498c10d50dad3da3852c12c6bd732166c54e4 Reviewed-on: https://chromium-review.googlesource.com/307070 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make DebugAnnotator::getStatus work on Windows 10 (WinRT)  Change-Id: I860a814490ac643eb3d7d1b770c956f0dce3e39e Reviewed-on: https://chromium-review.googlesource.com/305309 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Do not attempt to compile angle_end2end_tests or angle_perftests on Android  BUG=507294  Change-Id: Ied198a26f5eecab1dc608a06c2cc5e3be08cc28c Reviewed-on: https://chromium-review.googlesource.com/306460 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Peter Kotwicz <pkotwicz@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Peter Kotwicz <pkotwicz@chromium.org>, 23355681, 619, 169, 619
Fix MultipleDrawBuffers sample when GL_OES_texture_npot isn't active  If the GL_OES_texture_npot extension isn't active then setting GL_TEXTURE_WRAP_S/T to GL_REPEAT for a NPOT texture results in black rendering. This is specified in Section 3.8.2 of the OpenGL ES 2.0 specification.  Setting GL_TEXTURE_WRAP_S/T to GL_CLAMP_TO_EDGE is valid even if the NPOT extension isn't active.  Change-Id: Ibd553620995df32138bf8153d1036fd05d386d90 Reviewed-on: https://chromium-review.googlesource.com/306302 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix debug annotations and shaders.  The Program refactor inadvertantly broken Debug annotations. Fix this by correctly passing the path to the temporary shader source in the first "C" string argument to ShCompile instead of as the first part of the source string.  BUG=angleproject:1177 TEST=manual testing with MSVS  Change-Id: Ie77bb11b51645a474b542ddd2ae0f391e019e341 Reviewed-on: https://chromium-review.googlesource.com/306210 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add missing include guard to FunctionsWGL.h  Change-Id: I603eb99219234bb0292432ec41ede011c9c7d3ca Reviewed-on: https://chromium-review.googlesource.com/305830 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Only require that the stencil masks are same as many effective bits set  It seems reasonable to validate the equality between stencilWriteMask and stencilBackWriteMask only by comparing the effective bits. An existing dEQP test[1] and a WebGL test[2] also use the max size of stencil bits for checking the stencil mask values.  [1] StencilWriteMaskSeparateTestCase (gles3/functional/ es3fIntegerStateQueryTests.cpp) [2] https://www.khronos.org/registry/webgl/sdk/tests/conformance/state/ gl-get-calls.html (Search for "minimumRequiredStencilMask ")  Change-Id: I68cefbe8a9f69c5a9ebcb30027a05581e3024add Reviewed-on: https://chromium-review.googlesource.com/302703 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jinyoung Hur <hurims@gmail.com> Commit-Queue: Jinyoung Hur <hurims@gmail.com> Tryjob-Request: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
angle: move DeallocateCurrent into windows only code  DeallocateCurrent is only called from within DllMain which means it's only called on windows.  On the mac the warning unused-function may be triggered.  Move DeallocateCurrent to windows only code.  Change-Id: I61ba602af78d546a91cf009ae7350cf03eaa84dd Reviewed-on: https://chromium-review.googlesource.com/305880 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fixed incorrect buffer count for emulated points rendering  Emulated points rendering for FL9_3 was getting lucky because the value of maxDiff just happened to be large enuough to include the additional pointsprite vertex buffer in the total buffer count used in IASetVertexBuffers.  maxDiff is calculated while buffers and offsets are being configured. The pointsprite buffer was not updating maxDiff resulting in an off-by one calculation which causes TDRs on some Qualcomm chipsets.  This issue was discovered using Cocos2dx.  BUG=angleproject:1176  Change-Id: I3b3af1757e1cef48bbc62e68695a3e239fef77bf Reviewed-on: https://chromium-review.googlesource.com/305752 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Don't include samplers in uniform vector count validation  Change-Id: Id2820643b70d3266c82eb10a5f05d3a5886e9323 Reviewed-on: https://chromium-review.googlesource.com/304871 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
UniformTest.SamplerUniformsAppearOnce should check for VTF support  Change-Id: If4b1602a5f706b5343fc1757962341602354b88e Reviewed-on: https://chromium-review.googlesource.com/304389 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Fix "blob content mismatch between level9 and d3d10 shader" errors on 9_3  Fixes these dEQP failures on 9_3: + dEQP-GLES2.functional.shaders.struct.local.loop_nested_struct_array_vertex + dEQP-GLES2.functional.shaders.struct.local.loop_nested_struct_array_fragment  Change-Id: I3e3b3552fe842c8a3c04363bf966c121e40dd9dc Reviewed-on: https://chromium-review.googlesource.com/304489 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Geoff Lang <geofflang@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Re-land "Implements more pack/unpack states."  Pack: row length skip rows skip pixels. Unpack: image height skip images skip rows skip pixels. Note that PBOs are not covered by this change.  Re-land with fix for test expectations.  BUG=angleproject:512 BUG=angleproject:1095  Change-Id: I71d8d3bd8fc1f2c75ca16ac2634d5eafcbd71f26 Reviewed-on: https://chromium-review.googlesource.com/305522 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Implements more pack/unpack states. Pack: row length skip rows skip pixels. Unpack: image height skip images skip rows skip pixels. Note that PBOs are not covered by this change."  Expectations still not correct. This removes suppressions for two failing tests:  functional.texture.specification.teximage3d_depth_pbo.depth_component32f_2d_array dEQP-GLES3.functional.texture.specification.teximage3d_depth_pbo.depth32f_stencil8_2d_array  BUG=angleproject:512 BUG=angleproject:1095  This reverts commit 72e7013e68a24107b9082629fc52d59a78998eb2.  Change-Id: Id81b6e616e61535b8504890ce57591813e22af69 Reviewed-on: https://chromium-review.googlesource.com/305521 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Automatically enable highp in fragment shaders on ESSL3  Most code using the translator already enables highp with the resources flag when a shader spec that accepts ESSL3 is used but for example the shader_translator utility doesn't. This fix makes sure that highp is always enabled when a fragment shader written in ESSL3 or newer is being compiled. This will make shader_translator easier to use for testing ESSL3 shaders.  BUG=541550 TEST=angle_unittests  Change-Id: Ia1911677c55f3c5d921829a8cbb808847ac8b636 Reviewed-on: https://chromium-review.googlesource.com/305190 Tryjob-Request: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "Fixed FL9_3 shaders that use glPointCoord without glPointSize."  Failing test in angle_end2end_tests:  GLSLTest.MaxMinusTwoVaryingVec4PlusTwoSpecialVariables: program link failed: C:\fakepath(875-18): error X4000: variable 'output' used without having been completely initialized  This reverts commit 73e32ee161b7b613e9e25e3cc393851c430eeb98.  Change-Id: Ie47cb3a92ccfa1271a880a8b7e5a87b05963bab9 Reviewed-on: https://chromium-review.googlesource.com/305530 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implements more pack/unpack states. Pack: row length skip rows skip pixels. Unpack: image height skip images skip rows skip pixels. Note that PBOs are not covered by this change.  BUG=angleproject:512 BUG=angleproject:1095  Change-Id: Ia2fd7e52615d4aa08011dd615fcc20b79672d355 Reviewed-on: https://chromium-review.googlesource.com/304908 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fixed FL9_3 shaders that use glPointCoord without glPointSize.  This change fixes a Shader error on FL9_3 that reports Vertex/Pixel Shader linkage signatures between stages being incompatible when glPointCoord is used without glPointSize.  Change-Id: I93ffb6c6dd38f26e2156a374b1b58ecc3a5f250b Reviewed-on: https://chromium-review.googlesource.com/301450 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Cooper Partin <coopp@microsoft.com>, 23355681, 619, 169, 619
Use named value-parameterized tests for dEQP gtests  This replace the non-descriptive digit at the end of the test name by the name of the dEQP test being run.  Reland enabling the named tests only in standalone.  BUG=angleproject:1153  Change-Id: I1336d38425c19305fae8279a42d4931cc516215c Reviewed-on: https://chromium-review.googlesource.com/304171 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
glTexSubImage2D should always allow non-power-of-two inputs  If GL_OES_texture_npot isn't active then ANGLE currently prevents calls to glTexSubImage2D with: - level > 0 - width/height NPOT  This isn't correct. It is legitimate to supply data to a NPOT subregion of a POT texture via glTexSubImage2D.  Fixes these dEQP tests on 9_3: dEQP-GLES2.functional.texture.specification.basic_texsubimage2d.a8_2d dEQP-GLES2.functional.texture.specification.basic_texsubimage2d.a8_cube dEQP-GLES2.functional.texture.specification.basic_texsubimage2d.l8_2d dEQP-GLES2.functional.texture.specification.basic_texsubimage2d.l8_cube dEQP-GLES2.functional.texture.specification.basic_texsubimage2d.la88_2d dEQP-GLES2.functional.texture.specification.basic_texsubimage2d.la88_cube dEQP-GLES2.functional.texture.specification.basic_texsubimage2d.rgb565_2d dEQP-GLES2.functional.texture.specification.basic_texsubimage2d.rgb565_cube dEQP-GLES2.functional.texture.specification.basic_texsubimage2d.rgb888_2d dEQP-GLES2.functional.texture.specification.basic_texsubimage2d.rgb888_cube dEQP-GLES2.functional.texture.specification.basic_texsubimage2d.rgba4444_2d dEQP-GLES2.functional.texture.specification.basic_texsubimage2d.rgba4444_cube dEQP-GLES2.functional.texture.specification.basic_texsubimage2d.rgba5551_2d dEQP-GLES2.functional.texture.specification.basic_texsubimage2d.rgba5551_cube dEQP-GLES2.functional.texture.specification.basic_texsubimage2d.rgba8888_2d dEQP-GLES2.functional.texture.specification.basic_texsubimage2d.rgba8888_cube  Change-Id: I5889a27edbfa807995fa20b16f36456f676b80fc Reviewed-on: https://chromium-review.googlesource.com/304612 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Allow double underscore in macro names  Double underscore is allowed according to GLSL ES 3.10 and based on Khronos discussions the intent is that this should also apply to older specs. The dEQP tests also check this and WebGL tests that check the opposite were recently removed. The error is changed into a warning.  BUG=angleproject:989 TEST=angle_unittests      dEQP-GLES3.functional.shaders.preprocessor.* (2 tests start passing)      dEQP-GLES2.functional.shaders.preprocessor.* (2 tests start passing)  Change-Id: I582c01b4adc8fc416354351e02b776f2cc602408 Reviewed-on: https://chromium-review.googlesource.com/300965 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tryjob-Request: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Made program binaries cache information needed for getTransformFeedbackVarying  BUG=angleproject:1173 Change-Id: Ib8883b32f54f5d38fb94e85decae2dcee108facf Reviewed-on: https://chromium-review.googlesource.com/304381 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Treat linker warnings as errors on Windows  This would have avoided the issue seen here: https://chromium-review.googlesource.com/#/c/304501/  Currently linker warnings are only visible in build logs. VS outputs 0 warnings/0 errors even if there are linker warnings.  If linker warnings were treated as errors then the issue above would have caused a build break.  Change-Id: I4b529b778989a7299f83e0ef3e40cccf2c17e905 Reviewed-on: https://chromium-review.googlesource.com/304886 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Program: Clean up UBO info gathering.  The data size & block member info was getting messy so clean up how we query this from the Impl layer.  Also remove the register information from gl::UniformBlock moving it into the D3D-only world.  BUG=angleproject:1172  Change-Id: I40af658ebbd6b7c1a4251906a387ebcbb621cf77 Reviewed-on: https://chromium-review.googlesource.com/304150 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Fixed compilation on mingw."  This causes some linker warnings. I don't think we should add linker warnings to Chrome so reverting this temporarily until we can land your CL with the correct using of export keywords.  Please re-submit the fixed CL.  This reverts commit 566273222683314dfc8ac1cdb9bf6deb5d2b4c65.  Change-Id: I21fa623af31fac06de6afbefa50c9ea1ec157c15 Reviewed-on: https://chromium-review.googlesource.com/305000 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Implements more pack/unpack states. Pack: row length skip rows skip pixels. Unpack: image height skip images skip rows skip pixels."  This is causing failures in dEQP-GLES3.functional.texture.specification.teximage3d_depth_pbo.depth_component24_2d_array  First failing build on the bot: http://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Release%20dEQP%20%28NVIDIA%29/builds/3635  Please fix the failure and re-land your CL with the fix.  BUG=angleproject:512 BUG=angleproject:1095  This reverts commit f1bb3f0569d5ef41b17f8ad0add7308f9d0f0de1.  Change-Id: I30f61db888b0adf73a1d98bbeeb2428068119627 Reviewed-on: https://chromium-review.googlesource.com/304990 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implements more pack/unpack states. Pack: row length skip rows skip pixels. Unpack: image height skip images skip rows skip pixels.  BUG=angleproject:512 BUG=angleproject:1095  Change-Id: I11e3bc05d23419b72c92b96aabd3f0bacd983626 Reviewed-on: https://chromium-review.googlesource.com/304370 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Suppress EGLSurfaceTest.MakeCurrentTwice on Mac chromium builds  This is to remove a failure on the intel trybots were ANGLE is currently enable to create any context while this test expects creation to succeed.  BUG=angleproject:891  Change-Id: I0450da3211fd958a17f6db0d7e2a85968d6e3a87 Reviewed-on: https://chromium-review.googlesource.com/304730 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Only support ES3 if texture swizzling is available  On OSX 10.8 with an Intel HD 3000 we were wrongly exposing ES3 when texture swizzling was not available.  BUG=angleproject:891  Change-Id: If71acdc1943ab2f013dc80cd28eab130c32fb201 Reviewed-on: https://chromium-review.googlesource.com/303392 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix WinRT compilation issue in ShaderD3D.cpp  Change-Id: If7bd4e9cdba3d893f2ee28a70b894af3fb37ae30 Reviewed-on: https://chromium-review.googlesource.com/304488 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Store WGL extensions in FunctionsWGL.  Add helpers for checking which extensions are available instead of discarding the extension strings after function loading.  BUG=angleproject:1144  Change-Id: Ie3d209cd5f6f116bbedaa618a59a4c2d7ddda4d6 Reviewed-on: https://chromium-review.googlesource.com/296360 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add suppressions for several Intel failures.  Also add a new test for UBOs to end2end_tests.  BUG=540538  Change-Id: I6ffa6ba061a2c33811c65719deaa4302f1dbd704 Reviewed-on: https://chromium-review.googlesource.com/304521 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix setting const qualifier on indexing expression  Resubmitting now that separate fix for updating mangled names of types has been merged. A unit test is added to make sure that the same regression doesn't happen again.  Previously constness of indexing expressions did not take the index expression into account. Now constness correctly takes into account both the base expression and the index expression.  Setting the type of expressions that index arrays is also simplified.  BUG=angleproject:1170 TEST=angle_unittests  Change-Id: Ie9b6aaee8185b945c03657b13d9513cc55cd2a9f Reviewed-on: https://chromium-review.googlesource.com/303601 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Invalidate mangled name of TType if the type is changed  Sometimes the mangled name of a type is already generated when the type is still being changed. For example this could happen when the type of A[i] is generated by copying the type of A (already mangled) and calling clearArrayness() on the copy. Make sure that the mangled name gets updated if the type is changed by clearing the mangled name when something affecting it is changed.  BUG=angleproject:1170 BUG=538692 TEST=angle_unittests  Change-Id: I9dfacea653f56536e1573a6dbf60ff21da7cc5ab Reviewed-on: https://chromium-review.googlesource.com/303846 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Implement QueryGL.  Passes all tests in:  * dEQP-GLES3.functional.occlusion_query  * angle_end2end_tests  BUG=angleproject:887  Change-Id: I643ab4c28cb545de9e7b0e1740e3fd8e2aa9d3d9 Reviewed-on: https://chromium-review.googlesource.com/302338 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fixed compilation on mingw.  Change-Id: I5734f789f25fbc6b9b90f2043459a3a5f72008c4 Reviewed-on: https://chromium-review.googlesource.com/303602 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Check for GL_OES_get_program_binary before running ProgramBinaryTest.  BUG=angleproject:882  Change-Id: I2e5f4aeac6ff413d5f69097957718c52bd7828dd Reviewed-on: https://chromium-review.googlesource.com/304170 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Only apply uniform buffers referenced by the Program.  Continues to pass dEQP-GLES3.functional.ubo.*  Performance regression in draw call overhead is fixed.  BUG=angleproject:882 BUG=angleproject:1171  Change-Id: I1d827d70611c1bf743a7930796e31a54aca04b1e Reviewed-on: https://chromium-review.googlesource.com/303473 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add texture2DRect -> texture conversion for OpenGL core profile  BUG=534114  Change-Id: If0e1557a2399436b1b160407ced2d265f42df5f0 Reviewed-on: https://chromium-review.googlesource.com/303761 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: ccameron chromium <ccameron@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Make more gl::Program methods const.  BUG=angleproject:1123  Change-Id: Ib48c523538322871a0deec7ba6497c8797967ef1 Reviewed-on: https://chromium-review.googlesource.com/303305 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Correcting INVALID_ENUM issue for GLES3.  Similar to prior fix for GLES2 validation now correctly returns INVALID_ENUM instead of shorting out.  BUG=angleproject:1168  Change-Id: I8247b0b3520b0f116856049c85606bb44fa24021 Reviewed-on: https://chromium-review.googlesource.com/303472 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Tommy Martino <tmartino@chromium.org>, 23355681, 619, 169, 619
Revert "Implement program binary in ProgramGL."  Causing issues on AMD and Intel bots.  This reverts commit 6d8926691a8ed59add7602af602af3e6f7a81ab6.  Change-Id: Ifb395f78a6a44b874ac13da1f252f604a1a7b0bc Reviewed-on: https://chromium-review.googlesource.com/303439 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add angle_perftests to GN.  Also clean up the formatting a bit with gn format.  BUG=537008  Change-Id: I23337e634f20f611aaae7d17ef47b5784738bbe8 Reviewed-on: https://chromium-review.googlesource.com/303793 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement program binary in ProgramGL.  Verified by end2end tests and manually checking that chrome can load and save program binaries.  BUG=angleproject:882  Change-Id: Ic7e4b443365af6ea2d9ce5b0ecfb685eac85f479 Reviewed-on: https://chromium-review.googlesource.com/303828 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix standalone ninja build on Linux  Preprocessor conditions referring to undefined macros failed standalone build which uses the -Werror=undef setting.  This same error has been in multiple patches and reverting them would cause test breakage so fixing the issue is simpler than reverting.  Change-Id: I4a079ef5d823eed76ebdefa8be413f63d29a5f6a Reviewed-on: https://chromium-review.googlesource.com/304020 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Improve handling of internal function calls  Many parts of the shader translator that deal with function calls have been written without internal function calls in mind. Fix some of these so that they can handle internal function calls.  -Fix TLValueTrackingTraverser handling a shader where there are an  internal and non-internal function of the same name. -Maintain internalness when shallow copying function calls in  SeparateExpressionReturningArrays and ArrayReturnValueToOutParameter  AST transformations. -Output function internalness in intermOut.  BUG=angleproject:1116 TEST=angle_unittests  Change-Id: Ic65e2803062b807651f1b3952409face6aceb780 Reviewed-on: https://chromium-review.googlesource.com/303353 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Revert "Fix setting const qualifier on indexing expression"  Failing to compile shaders which are used in some layout_tests see http://crbug.com/538692 for logs and bad shaders.  We should diagnose if the shaders are faulty or if there's a bug in this CL and take appropriate action but first priority  is to get the tests running again.  BUG=538692 BUG=angleproject:1170  This reverts commit 16a79cd169420cdf0254964b1bac9dd9964a8119.  Change-Id: Iea14c58d87041bcf5ba645b7076ba0936dea6b9d Reviewed-on: https://chromium-review.googlesource.com/303794 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Check for GL_INVALID_INDEX instead of -1 for GetUniformIndices  While they have the same bit representation the variable was unsigned so the comparison would always fail which triggered a compilation warning.  BUG=  Change-Id: Idbbdb942b71d59f95e65c072dbbfdf31d14eda05 Reviewed-on: https://chromium-review.googlesource.com/303391 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
UniformTest.FloatUniformStateQuery do computations in doubles  When using floats when testing INT_MAX the loss of precision causes an undefined behavior when casting from float to int. In this cause on clang 3.6 on Mac the integer wrapped and became INT_MIN.  Reland with warnings fixes for MSVC on standalone builds.  BUG=angleproject:891  Change-Id: Ieed609840ae22e89f51c3a85cd5309c4d8bc52ea Reviewed-on: https://chromium-review.googlesource.com/303900 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Return the correct value when querying GL_MAX_FRAGMENT_UNIFORM_VECTORS.  BUG=angleproject:1087  Change-Id: Ibd0918f29b65c509e749953059d584ea83776a31 Reviewed-on: https://chromium-review.googlesource.com/303775 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
dEQP: Add Cherry (Web-based GUI) to DEPS.  Cherry allows us to view results from dEQP test passes and is an open-source project.  BUG=None  Change-Id: I6edc2220fe4e9daf85dc6cf44053f59a51269cb5 Reviewed-on: https://chromium-review.googlesource.com/303464 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Load the ARB_sampler_objects entry points in FunctionsGL.  Load the sampler object entry points and limit supported ES version to 2 if samplers are not available.  BUG=angleproject:1162  Change-Id: Ida7cf0cc0a81dd3714d958a98efe0c6e973ecca2 Reviewed-on: https://chromium-review.googlesource.com/303770 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove ProgramImpl::getBinaryFormat.  Because we only expose GL_ANGLE_program_binary we're only allowed to use the GL_PROGRAM_BINARY_ANGLE binary type.  This should be enforced at the GL level.  If implementations wish to use multiple types of formats internally they are able to by writing those enums to their binaries.  BUG=angleproject:882 BUG=angleproject:1123  Change-Id: I43685958814e4333b7cef3952d92c1017dc885f8 Reviewed-on: https://chromium-review.googlesource.com/303827 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove the unused ProgramImpl::getShaderVersion method.  BUG=angleproject:882 BUG=angleproject:1123  Change-Id: Iace1d6c2c594f0b00c18d595f14cef9bce6f3595 Reviewed-on: https://chromium-review.googlesource.com/303826 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Correcting INVALID_OPERATION to INVALID_ENUM  Should return INVALID_ENUM when uncompressed texture passed to compressed image constructor.  BUG=angleproject:1168  Change-Id: If30f0407e7455d6e19432831883d33a1e8bfec9a Reviewed-on: https://chromium-review.googlesource.com/303750 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "UniformTest.FloatUniformStateQuery do computations in doubles"  This change broke standalone build on Windows. Two casts from double to GLfloat were missing.  This reverts commit 7aa4cae26f755dc9e6646e669fc3222f9dd63b20.  BUG=angleproject:891  Change-Id: I69cf773c940fd43b06f21c1ee86e60bac6825684 Reviewed-on: https://chromium-review.googlesource.com/303352 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix an undefined behavior in clampCast  This undefined behavior appeared in angle_end2end_tests compiled with clang 3.6 on Mac.  BUG=angleproject:891  Change-Id: I840b40a7bd54c9cfaeb0fe6784b73f875f9d5502 Reviewed-on: https://chromium-review.googlesource.com/303337 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
UniformTest.FloatUniformStateQuery do computations in doubles  When using floats when testing INT_MAX the loss of precision causes an undefined behavior when casting from float to int. In this cause on clang 3.6 on Mac the integer wrapped and became INT_MIN.  BUG=angleproject:891  Change-Id: Ieb3199fd33c25e7da8d154f88658e06f01d53c0e Reviewed-on: https://chromium-review.googlesource.com/303338 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add -Wnon-virtual-dtor and fix a warning.  BUG=  Change-Id: I234e3a963e110762bac2a89d146b60f028928fb5 Reviewed-on: https://chromium-review.googlesource.com/302487 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Support UBOs in RendererGL and ProgramGL.  Reland: fix compile warnings on Windows.  BUG=angleproject:882 BUG=angleproject:883  Change-Id: If4844d50d43ff9b765f64606e8f08d65a1afd9a4 Reviewed-on: https://chromium-review.googlesource.com/303431 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Support UBOs in RendererGL and ProgramGL."  Compile error.  This reverts commit 97d82b724b71be464f2aff377f056cade44fca94.  Change-Id: I71ae10cb01b8ded0297eaf4742fb1098ce02a9bb Reviewed-on: https://chromium-review.googlesource.com/303303 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Support UBOs in RendererGL and ProgramGL.  BUG=angleproject:882 BUG=angleproject:883  Change-Id: I36f8ef42d87e289658a6ba4899380bc72b9bcebf Reviewed-on: https://chromium-review.googlesource.com/299871 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement GL_EXT_debug_marker for RendererGL.  Passes dEQP-GLES2.functional.debug_marker.*  Change-Id: I37f2b6724f32867d2e428613b1b6d9c8377c6d60 Reviewed-on: https://chromium-review.googlesource.com/302990 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix a possible OOB read in InsertD3D11FormatInfo.  It's unclear how this might happen as it's during static map init but add a fail-safe to be sure.  BUG=526779  Change-Id: I5aa33f9bed30d4a8c1e9937a0b8c5fd11a7503d7 Reviewed-on: https://chromium-review.googlesource.com/302385 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix setting const qualifier on indexing expression  Previously constness of indexing expressions did not take the index expression into account. Now constness correctly takes into account both the base expression and the index expression.  Setting the type of expressions that index arrays is also simplified.  BUG=angleproject:1170 TEST=angle_unittests  Change-Id: Ie2d122020cc252655ab0eea96886b9f85931b80a Reviewed-on: https://chromium-review.googlesource.com/303350 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
compiler: Rewrite do-while loops as while loops  This works around a Mac driver shader compiler bug that makes many do-while loops cause GPU-hangs when ran.  BUG=angleproject:891  Change-Id: I29828d6ea9e887ad0ed0c577f1deb41fb632a900 Reviewed-on: https://chromium-review.googlesource.com/302465 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add suppressions for failing end2end tests on Mac Intel  BUG=angleproject:891  Change-Id: I88a8bcc4a6911c92bdb981aca34a0557ad451df7 Reviewed-on: https://chromium-review.googlesource.com/303390 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
OSXWindow release the tracking area instead of deallocing it  The Mac AMD GPU FYI bots were crashing on end2end tests exit because the NSView was trying to deallocated an NSTrackingArea that had been previously deallocated.  BUG=angleproject:891  Change-Id: I933e437254cad65f18cb0518a401b8b8e9dc59a0 Reviewed-on: https://chromium-review.googlesource.com/303302 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Sync scissor state before calling BlitFramebuffer.  Now passes:  * dEQP-GLES3.functional.fragment_ops.scissor.framebuffer_blit_center  * dEQP-GLES3.functional.fragment_ops.scissor.framebuffer_blit_corner  * dEQP-GLES3.functional.fragment_ops.scissor.framebuffer_blit_none  BUG=angleproject:885  Change-Id: Ifec2995562c684b3a4b287619c9bf7a25512b1fd Reviewed-on: https://chromium-review.googlesource.com/302384 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement gl_FragDepth for GLES SL 3.0  Makes it an error to access gl_FragDepthEXT  in #version 300 es shader.  TODO: Lacks the feature to make "#extension GL_EXT_frag_depth : require" an error for #version 300 es.  Reland of: https://chromium-review.googlesource.com/#/c/287570  BUG=angleproject:1102 TEST=angle_unittest  Change-Id: I064d918d65f37539cb1e14f12173ca5591a4ea3f Reviewed-on: https://chromium-review.googlesource.com/301711 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Skip BlendMinMax test on Intel OpenGL due to driver flakyness.  Change-Id: I72da31fa0bfbed578e20ff39b82d8c8e716fd276 Reviewed-on: https://chromium-review.googlesource.com/302337 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
TOutputGLSLBase::visitLoop clarify the function slightly  Since only for loops can be unrolled handle each type of loop only once. This improvement was going to be part of a do-while workaround for Mac that will instead be done at the AST level.  BUG=angleproject:891  Change-Id: Ic8ecf41aa6d9abd7a01c2230e908c85152f52b62 Reviewed-on: https://chromium-review.googlesource.com/302332 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add dEQP GLES2 test expectations for Mac  BUG=angleproject:891  Change-Id: Ib7d16a9266fe23fb9374cec94f3baa4ad135c0d3 Reviewed-on: https://chromium-review.googlesource.com/302333 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
RewriteElseBlocks.cpp: add missing override  Change-Id: Ic98de554cabffabd3cdd58b2a44a554cb2c3cd53 Reviewed-on: https://chromium-review.googlesource.com/302464 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Explicitly enable framebuffer SRGB blending in StateManagerGL.  In DesktopGL SRGB blending must be enabled or linear blending will be used.  reland: Work around issues on AMD drivers where SRGB blending would be used on clears of linear attachments.  Passes all dEQP-GLES3.functional.fragment_ops.blend.fbo_srgb.* tests (1106 new passing tests).  BUG=angleproject:883 BUG=angleproject:885  Change-Id: I974a55fe3acc77ac77e93f19c83ee3b76f784df2 Reviewed-on: https://chromium-review.googlesource.com/302336 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Explicitly enable framebuffer SRGB blending in StateManagerGL."  More compile errors on mac.  This reverts commit 056fae4a01db306b8f9c1e57374e18ebffbdf8eb.  Change-Id: I579b9e50ded7240be4f488a48588a89ecb4bea44 Reviewed-on: https://chromium-review.googlesource.com/302571 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Delete function that's unused after https://chromium-review.googlesource.com/#/c/299691/  BUG=505316  Change-Id: Iac794dc8a13f9aabc6f53e34dab8750dc1ed994a Reviewed-on: https://chromium-review.googlesource.com/302830 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Explicitly enable framebuffer SRGB blending in StateManagerGL.  In DesktopGL SRGB blending must be enabled or linear blending will be used.  reland: Work around issues on AMD drivers where SRGB blending would be used on clears of linear attachments.  Passes all dEQP-GLES3.functional.fragment_ops.blend.fbo_srgb.* tests (1106 new passing tests).  BUG=angleproject:883 BUG=angleproject:885  Change-Id: I6c2b4552c571707a8d8d80d3573bcb38797c3929 Reviewed-on: https://chromium-review.googlesource.com/302791 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix possible compiler errors on linux  Change-Id: Ifc45446c749690eddc406f66f144304262f04664 Reviewed-on: https://chromium-review.googlesource.com/302478 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Sampler.cpp: Fix a warning on Linux and Mac  BUG=  Change-Id: I58a19de9d5978aa4d65ac2ab1acd2fbd233ec6a2 Reviewed-on: https://chromium-review.googlesource.com/302463 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Explicitly enable framebuffer SRGB blending in StateManagerGL."  Compilation failure on mac and linux.  This reverts commit e19d7f90355f02ac7a7cd0a2ac130e0859cd3cc7.  Change-Id: I638c3ffebb8c7ad0e3fe2e1e65d6212487bfc6ae Reviewed-on: https://chromium-review.googlesource.com/302790 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Explicitly enable framebuffer SRGB blending in StateManagerGL.  In DesktopGL SRGB blending must be enabled or linear blending will be used.  reland: Work around issues on AMD drivers where SRGB blending would be used on clears of linear attachments.  Passes all dEQP-GLES3.functional.fragment_ops.blend.fbo_srgb.* tests (1106 new passing tests).  BUG=angleproject:883 BUG=angleproject:885  Change-Id: I03fbb0910ce414552ba841099a177446d0ace7b6 Reviewed-on: https://chromium-review.googlesource.com/301702 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move more sample_util sources to util.  These sample utils can also be useful for writing perf tests.  BUG=angleproject:1164  Change-Id: I44b5d63b57bfce7a541442fd02cd729a1bab17f0 Reviewed-on: https://chromium-review.googlesource.com/301468 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactoring TextureFormat and its helper functions to individual classes  BUG=angleproject:1160  This is the first step to BUG=angleproject:1160 optimizing GetTextureFormatInfo to use static switching rather than building maps and using the find function. Also reordered the includes in alphabetical src files first format  The next step is to modify the GetTextureFormatInfo not to build a map but to use static switching. The step after that is to use a JSON generator to generate the switching hence refactoring TextureFormat to be in its own class so we only need to generate what's necesary. The helper functions such as swizzle texture format can also be done using the same approach. Hence they're also refactored into their own files.  Change-Id: I753f437ca0df69ee5584d254fe0d2ea8b09a857e Reviewed-on: https://chromium-review.googlesource.com/300288 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Dian Xiang <dianx@google.com>, 23355681, 619, 169, 619
Add a SamplerImpl object and implement it for the GL backend.  Passes all tests in dEQP-GLES3.functional.samplers  BUG=angleproject:1162  Change-Id: I7713031a677aac2b41889a6b4297ab512e184863 Reviewed-on: https://chromium-review.googlesource.com/301582 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Compile the dEQP test targets on Mac  BUG=angleproject:891  Change-Id: I4bc2817106c8170684a76972badd38c02c0abf0e Reviewed-on: https://chromium-review.googlesource.com/299852 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Allow limited form of expressions in #line directives  Reuse ExpressionParser that's also used for parsing preprocessor conditionals to parse line and file numbers in #line directives. According to recent Khronos discussions the intent of the spec is that expressions in #line directives should be interpreted similarly to expressions in conditional directives so reusing ExpressionParser is a natural way to implement this. This enables simple math operators operating on integers. There are a few unclear corner cases but this approach is enough to support practical use cases and pass the dEQP tests.  Valid line directives have one of the following forms:   #line line-expression  #line line-expression file-expression  ExpressionParser is first run to parse the line-expression. In ambiguous cases the ExpressionParser consumes as much of the line as possible to form line-expression. Then if end-of-line hasn't been reached file-expression is parsed by running ExpressionParser again. As an example of an ambiguous case:   #line 1 + 2  This could alternatively be interpreted to mean line-expression "1" and file-expression "+ 2" where + is the unary + operator but ANGLE now interprets it to mean line-expression "1 + 2". Because of these ambiguous cases a bison grammar that would parse multiple expressions on the same line couldn't be easily constructed so this solution where ExpressionParser is run twice was chosen instead.  The problematic corner cases are:  - ExpressionParser uses 64-bit integers internally for evaluating the expression's value. It's possible to interpret the ESSL3 spec so that 32-bit integer wraparound behavior would be required also for #line directive expressions.  - It's unclear whether the defined operator can be used in #line expressions. In this patch it is disabled. Hoping for further clarification from Khronos.  - It's unclear how short-circuiting should affect the parsing of undefined identifiers in #line expressions. Now it's consistent with #if expressions (undefined identifiers are OK if they're short-circuited).  dEQP expectations are updated for preprocessor tests including ones not affected specifically by this change.  BUG=angleproject:989 TEST=angle_unittests      dEQP-GLES3.functional.shaders.preprocessor.* (4 start passing)      dEQP-GLES2.functional.shaders.preprocessor.* (4 start passing)  Change-Id: I55c5bf75857da5de855cc600d3603ee19399f328 Reviewed-on: https://chromium-review.googlesource.com/300964 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Suppress TextureLimitsTest.MaxCombinedTextures on Intel GL.  This test probably triggers a driver bug.  BUG=angleproject:1123  Change-Id: I81921e7faf51ac60f1175a04ee17e920a346059d Reviewed-on: https://chromium-review.googlesource.com/302461 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Split the SamplerState struct into SamplerState and TextureState.  SamplerState is now only the members that are overridden by a sampler object this makes it easy to update those specific members.  Opted for getters and setters for each member in Texture and Sampler because it will be required to enable dirty bits for these states.  Added maxAnisotropy to the SamplerState instead of texture state.  The sampler objects extension mentions it should be there.  BUG=angleproject:1162  Change-Id: I5aa6d702bd5915ee9df1976afef3c8c1f69d27c8 Reviewed-on: https://chromium-review.googlesource.com/300490 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove rx::ShaderSh and move the shared code to the GL.  The GL layer can interact with the translator directly to query all the active shader variables and call ShCompile.  BUG=angleproject:1159  Change-Id: I334a9bef28f93cf85dd8cac0fb8542ac567cc3ec Reviewed-on: https://chromium-review.googlesource.com/299877 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make a shader Shader::Data state structure.  This design follows the similar designs for Program Framebuffer etc. Because of the current design share a mutable pointer with the Impl so the patch becomes a bit smaller and easier to review. In a follow- up patch we can move the shared code into the GL layer.  BUG=angleproject:1159  Change-Id: Ib243e74779f23be51cdca80f1b5c6e5f3e36059d Reviewed-on: https://chromium-review.googlesource.com/299876 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add an interm ShaderSh class.  This class logic will eventually move to the GL layer. Keep it in the Renderer layer for now for refactoring purposes.  BUG=angleproject:1159  Change-Id: I91843099367f9a0293cc43ab98626bf79eb75ebf Reviewed-on: https://chromium-review.googlesource.com/299875 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Re-re-land "Move sampler validation to the GL layer."  This previously was D3D-only but is required for every draw call. This completes the work of removing the D3D-specific Impl methods from ProgramImpl.  Also add several regression tests to cover texture and sampler validation.  Re-land with a fix for duplicate sampler active uniforms.  Re-re-land with a fix for a test comparison warning on Linux.  BUG=angleproject:1123  Change-Id: Iaf7b33861c07b9ceed4bd53ac2f010d35f05df45 Reviewed-on: https://chromium-review.googlesource.com/301712 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Explicitly enable framebuffer SRGB blending in StateManagerGL."  Causing failures on AMD OpenGL drivers for sRGB clears.  This reverts commit 04b89c975b3c7f6b86191d0255136a8a798f0b66.  Change-Id: I51ee856d1c4d37882e5b1d1926415c398fa7ff5c Reviewed-on: https://chromium-review.googlesource.com/301721 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Re-land "Move sampler validation to the GL layer.""  Build failure on Linux:  In file included from ../../third_party/angle/src/tests/gl_tests/UniformTest.cpp:7: In file included from ../../third_party/angle/src/tests/test_utils/ANGLETest.h:10: ../../testing/gtest/include/gtest/gtest.h:1392:16: error: comparison of integers of different signs: 'const int' and 'const unsigned int' [-Werror-Wsign-compare]   if (expected == actual) {       ~~~~~~~~ ^  ~~~~~~ ../../testing/gtest/include/gtest/gtest.h:1422:12: note: in instantiation of function template specialization 'testing::internal::CmpHelperEQ<int unsigned int>' requested here     return CmpHelperEQ(expected_expression actual_expression expected            ^ ../../third_party/angle/src/tests/gl_tests/UniformTest.cpp:487:5: note: in instantiation of function template specialization 'testing::internal::EqHelper<false>::Compare<int unsigned int>' requested here     EXPECT_EQ(GL_SAMPLER_2D type);     ^  BUG=angleproject:1123  This reverts commit 6cbf4385280c4c1dd97f0882ecb18dbc4c341fd4.  Change-Id: I95279b37d253e3ea78faa53f3773f2dc3d17df95 Reviewed-on: https://chromium-review.googlesource.com/302030 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implements GL_EXT_unpack_subimage and GL_NV_pack_subimage. Pack/unpack subimages is core features of GLES3. Those 2 extensions expose them to GLES2.  BUG=angleproject:512  Change-Id: I6834cf5d4a91bc3430c60dcec29c449826fd6d93 Reviewed-on: https://chromium-review.googlesource.com/299790 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Minmin Gong <mgong@microsoft.com>, 23355681, 619, 169, 619
Fixed FL9_3 shaders that use glPointSize without GL_POINTS mode  This change fixes rendering on FL9_3 with shaders that reference glPointSize and are not used with GL_POINTS rendering mode. A TDR occurs on some hardware because of missing vertex buffers specified by the vertex layout.  Change-Id: Ie49b75f7177c32c7f021a0409d15c27b18140c4b Reviewed-on: https://chromium-review.googlesource.com/299719 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Explicitly enable framebuffer SRGB blending in StateManagerGL.  In DesktopGL SRGB blending must be enabled or linear blending will be used.  Passes all dEQP-GLES3.functional.fragment_ops.blend.fbo_srgb.* tests (1106 new passing tests).  BUG=angleproject:883 BUG=angleproject:885  Change-Id: I0dfb744faa811f10be47c5bd8295b368baf3b04b Reviewed-on: https://chromium-review.googlesource.com/298620 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove CompilerImpl and merge code to gl::Compiler.  This class uses no Impl-specific code. We can also do a similar code relocation for the gl::Shader class but in several steps because it is a bit more complex.  BUG=angleproject:1159  Change-Id: I4d3ce3253df0a2bdee1d98e46cfd4b999d86be6e Reviewed-on: https://chromium-review.googlesource.com/299874 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Re-land "Move sampler validation to the GL layer."  This previously was D3D-only but is required for every draw call. This completes the work of removing the D3D-specific Impl methods from ProgramImpl.  Also add several regression tests to cover texture and sampler validation.  Re-land with a fix for duplicate sampler active uniforms.  BUG=angleproject:1123  Change-Id: Iefef06e7901873c98bf2ba7864efd16a4c6435d3 Reviewed-on: https://chromium-review.googlesource.com/301581 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make preprocessor ExpressionParser only lex what it can parse  This cleans up ExpressionParser so that the lexer only consumes one extra token in case the parser finishes. The parser will also finish with YYACCEPT once it has parsed a complete expression. This will make the preprocessor to generate a more informative unexpected token error instead of a syntax error if there are extra tokens after #if.  This will also enable reusing ExpressionParser for parsing expressions in line directives. The format for a line directive that specifies both line and file numbers is as follows:   #if line-expression file_expression  ExpressionParser will need to be run twice for each line: first to parse line-expression and then to parse file-expression. For that reason it is essential that ExpressionParser for line-expression stops before consuming more than one token of file-expression.  BUG=angleproject:989 TEST=angle_unittests dEQP-GLES3.functional.shaders.preprocessor.*  Change-Id: I0bb92f733c18891eeddbc61e7c5bebdf1003559a Reviewed-on: https://chromium-review.googlesource.com/300962 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tryjob-Request: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Support primitive restart in RendererGL.  Store index ranges in a new struct that tracks how many real indices were seen.  Update index caching to key on primitive restart being enabled and update index counting functions to skip primitive restart indicies when needed.  Passes dEQP-GLES3.functional.primitive_restart.*  Change-Id: Id1e25a5adcdcd4e998836e8ff6679c64be4c3066 Reviewed-on: https://chromium-review.googlesource.com/297770 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
In WinRT XAML allow eglCreateWindowSurface to be called from any thread  Before this change eglCreateWindowSurface had to be called from one specific XAML thread which may have been a different thread to the one where rendering was performed. This change fixes this so eglCreateWindowSurface can be called from any thread.  Change-Id: Ic383a508c223d1b0463e8a8f1d8e8d6880c26844 Reviewed-on: https://chromium-review.googlesource.com/300131 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
[Docs] Add wiki content to Markdown docs  Change-Id: I729d3208b206e83f99e73002b45402c4f6f9f443 Reviewed-on: https://chromium-review.googlesource.com/301560 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Move sampler validation to the GL layer."  Probably causing failures in the dEQP-GLES2 GL back-end tests:  dEQP-GLES2.functional.uniform_api.info_query.basic.sampler2D_both  BUG=angleproject:1123  This reverts commit 6fa156b66da2090c98f1a044a948694c7ac83324.  Change-Id: I3cc993c34aae4a108037ce81709b71d16ece814e Reviewed-on: https://chromium-review.googlesource.com/301580 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move sampler validation to the GL layer.  This previously was D3D-only but is required for every draw call. This completes the work of removing the D3D-specific Impl methods from ProgramImpl.  Also add several regression tests to cover texture and sampler validation.  BUG=angleproject:1123  Change-Id: I167cbc8f47b4a397d2ae6cc507bdac35168bcacd Reviewed-on: https://chromium-review.googlesource.com/299400 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Re-add the GERRIT_HOST and GERRIT_PORT codereview settings.  Some users get 404s when running 'git cl upload' because gclient attempts to upload as a reitveld patch.  Change-Id: I8fb5a46480f91489a05fbff918a106312cf0118c Reviewed-on: https://chromium-review.googlesource.com/301474 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Support parsing defined operator generated by macro expansion  dEQP tests enforce that the defined operator should be parsed even when it is generated as a result of macro expansion even though this is undefined according to the C++ preprocessor spec.  Implement support for this by putting the parsing for the defined operator inside MacroExpander. The operator gets processed right after it is generated by macro expansion. Parsing the defined operator is toggled with a boolean according to the context where MacroExpander is used.  BUG=angleproject:989 TEST=angle_unittests      dEQP-GLES3.functional.shaders.preprocessor.* - 2 tests start passing:      dEQP-GLES3.functional.shaders.preprocessor.conditional_inclusion.basic_2*  Change-Id: I780e63bd4558253657d898685d62339017564a06 Reviewed-on: https://chromium-review.googlesource.com/300970 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add WinrtWindow.cpp and WinRT version of angle_util  Change-Id: If4ff4b966f5bd388d32c72a2d1bcf9cf29e6032d Reviewed-on: https://chromium-review.googlesource.com/297308 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Revert "Avoid a copy in TextureStorage11::setData"  Speculative fix for performance regression.  BUG=532647  This reverts commit 9cf9bcbecaa1e54a47a92eb784e7f591f7b65c57.  Change-Id: I53e41f6c17f89c400e38bfcdf3147946c27906c0 Reviewed-on: https://chromium-review.googlesource.com/300540 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Try Sleep(1) instead of Sleep(0) while waiting for queries."  Caused significant slowdown in some chrome use cases that used glFinish or synchronous fences.  BUG=532571  This reverts commit a53000b09b012235af228f2b4f48cc9fb477a45a.  Change-Id: Id260e9ced472c409b2fa0b28b2b3dea99d412fdf Reviewed-on: https://chromium-review.googlesource.com/300491 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement missing util/ functions on Mac  SetLowPriorityProcess's implementation can be shared between Mac and Linux so even though it isn't using a Posix API it lives in the posix file. CreateOSPixmap needed to be implemented but will never be used by dEQP as our Mac EGL backend doesn't expose configs supporting pixmaps.  Reland with a Linux compilation fix (forgot to delete SetLowPriorityProcess).  BUG=angleproject:891  Change-Id: If8145501e1787d08d82402a6baa60a5404cac6b1 Reviewed-on: https://chromium-review.googlesource.com/299773 Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Implement missing util/ functions on Mac"  This reverts commit 959e197c84065267811b0a28e1d8e4aa5f98cf82.  BUG=  Change-Id: I71ea2894c74be8fda80a59c99bc53f4fcb7e9115 Reviewed-on: https://chromium-review.googlesource.com/299873 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Adding checks in DrawBuffers to return INVALID_ENUM  When a enum is given that is not a BACK NONE or COLOR_ATTACHMENTi where i ranges from 0 to MAX_COLOR_ATTACHMENT an INVALID_ENUM should be returned rather than an INVALID_OPERATION.  BUG=angleproject:1148  Change-Id: I3663f897face14f6ba46a15fb982efda6f4f4b05 Reviewed-on: https://chromium-review.googlesource.com/299312 Tryjob-Request: Dian Xiang <dianx@google.com> Tested-by: Dian Xiang <dianx@google.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Never de-init default Platform.  This fixes a crash after calling eglTerminate then using a previously initialized Display.  BUG=None  Change-Id: Ica974033d9da2ac15c07d6a39801781c2d776427 Reviewed-on: https://chromium-review.googlesource.com/299691 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Optimizing updatecachedInputLayout to not update inactive vertex attribs  BUG=angleproject:1158 part a  We only need to iterate and update the active attributes in a program. This can further be optimized by updating the cache more intelligently possibly by marking attributes as "need update" when necessary  Change-Id: I41e9c033116582c82a56b8d20ea245f06e8fa3d1 Reviewed-on: https://chromium-review.googlesource.com/299758 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement missing util/ functions on Mac  SetLowPriorityProcess's implementation can be shared between Mac and Linux so even though it isn't using a Posix API it lives in the posix file. CreateOSPixmap needed to be implemented but will never be used by dEQP as our Mac EGL backend doesn't expose configs supporting pixmaps.  BUG=angleproject:891  Change-Id: I7b53b44b3465045954ec8e5997f703525ece92d0 Reviewed-on: https://chromium-review.googlesource.com/299851 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Port gpu_test_expectations to Mac  BUG=angleproject:891  Change-Id: I06ad3b25914bc9ec4541b38a9b160983b7dcb720 Reviewed-on: https://chromium-review.googlesource.com/299850 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
ANGLE: Assert to check pointer  The assert was checking the value (which is unitialized) rather than the pointer.  Change-Id: Id8d57953b32b62739e64d88dedd26f0b15a2385f Reviewed-on: https://chromium-review.googlesource.com/299819 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Hendrik Wagenaar <hendrikw@chromium.org>, 23355681, 619, 169, 619
Generate tests.sln for WinRT and make it include dEQP projects  Change-Id: I34284965f7b4f9d11aa7bab263292d4f41312d04 Reviewed-on: https://chromium-review.googlesource.com/297307 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update to the latest versions of the GL and EGL headers.  Add GLES 3.1 and 3.2 headers.  Remove GLES 3.0 extension headers and entry point files.  Re-land fixes double define from different style defines in libGLESv2.gypi and other projects.  Re-land fixes missing defines in angle_util project in gn.  Change-Id: I1952413cd4390e6f5450df809f8f5867bf6f49e2 Reviewed-on: https://chromium-review.googlesource.com/299771 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix warning about out-of-order field initialization.  Change-Id: I38a3f93ea07c9bbd779d18bf7d3e2a5a6ee4113a Reviewed-on: https://chromium-review.googlesource.com/299772 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org> Tested-by: Nico Weber <thakis@chromium.org>, 23355681, 619, 169, 619
Revert "Update to the latest versions of the GL and EGL headers."  Issues with GN build.  This reverts commit 8284436798dd184afe61cbb586185cb68e503d6f.  Change-Id: I99d186019135bbbe250e95c9567854108d31c556 Reviewed-on: https://chromium-review.googlesource.com/299870 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use SDKROOT in the paths to OSX framework to match Chromium  BUG=angleproject:891  Change-Id: I458a12bd6b4be3b262d76184c51bde1f2b803c67 Reviewed-on: https://chromium-review.googlesource.com/299730 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Remove the usage of some c++11 library features  That were causing compilation error in Chromium Mac builds  BUG=angleproject:891  Change-Id: I45777451b300928e8c8d232a5b7ecffa7f1c3cbe Reviewed-on: https://chromium-review.googlesource.com/299721 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
In Chromium Mac builds do not find cstdint use stdint.h instead  BUG=angleproject:891  Change-Id: Idf2a89ad26955df3579bb2c1883137589f68f573 Reviewed-on: https://chromium-review.googlesource.com/299720 Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
IndexBufferOffsetTest: fix -Wnewline-eof for Mac  BUG=angleproject:891  Change-Id: Ic36d549d1a5ae52c49185064c2fdf60bd0074c0d Reviewed-on: https://chromium-review.googlesource.com/299723 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
OSXWindow::setMousePosition add a workaround for OSX 10.6 SDK  -[NSWindow convertRectToScreen] was introduced in OSX 10.7 use convertBaseToScreen instead for OSX 10.6  BUG=angleproject:891  Change-Id: I255a71d98bc9bf22735a7cb8b9ce1ea24061742f Reviewed-on: https://chromium-review.googlesource.com/299722 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement Pbuffers for the CGL backend using renderbuffers  The CGL pbuffers have been deprecated since OSX 10.7 but our testing requires that an EGL implementation supports pbuffers. This commit implement pbuffers on top of renderbuffer using only OpenGL.  BUG=angleproject:891  Change-Id: Ie8e09c9300a00800600c3a77044ba05205f805da Reviewed-on: https://chromium-review.googlesource.com/299442 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Avoid a copy in TextureStorage11::setData  This code always allocates a new memory buffer for the texture memory picks a load function to copy/convert the input data into it and the uploads.  In the case where the input format matches the upload format we should be able to skip the allocation and copy and be much happier.  Change-Id: I8b8c106e0d397bef1c4bcfdb0df60669030776a3 Reviewed-on: https://chromium-review.googlesource.com/293742 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
SixteenBppTextureTest: test the FBO are renderable before drawing  It is valid for the implementation to return a GL_FRAMEBUFFER_UNSUPPORTED for framebuffer completeness. Check for that case and return early. This fixes the RGB5_A1 tests on Mac that doesn't support rendering to this format.  BUG=angleproject:891  Change-Id: If37d8f82e994a93a470cbdc01d758fe60d54a5b2 Reviewed-on: https://chromium-review.googlesource.com/298863 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
EGLContextCompatTest: fix typo in WindowDifferentConfig  It was incorrectly calling the pbuffer function.  BUG=angleproject:891  Change-Id: I6959540262a8ef80886e41da795f9e4aff218535 Reviewed-on: https://chromium-review.googlesource.com/299441 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Formatutilsgl: Make floating point formats renderable on core GL 3.0  Previously they were listed as requiring ARB_color_buffer_float in all cases even if the extension has been merged in Desktop GL 3.0. Make it require Desktop GL 3.0 _or_ the extension. This fixes the PackUnpackTest and BlendMinMaxTest on Mac  BUG=angleproject:891  Change-Id: I504d9ed3ed9f1d908964181a6c21b79f1faee9b1 Reviewed-on: https://chromium-review.googlesource.com/298862 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
WindowSurfaceCGL: add a depth-stencil buffer  In our EGL config we advertise a depth-stencil buffer but do not provide it. This fixes a lot of end2end tests that were relying on the presence of the depth buffer.  BUG=angleproject:891  Change-Id: I48e0eb27753ee64c08bf51b8ec13bfe20360332d Reviewed-on: https://chromium-review.googlesource.com/298861 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Rename Optional::None to Invalid.  This fixes a name conflict with the XWindow headers on Linux. Only becomes an issue when using Optional inside GL-level libANGLE.  BUG=angleproject:1123  Change-Id: I7f0eb278a8b6eb6fecd864e556428678cb90dcea Reviewed-on: https://chromium-review.googlesource.com/298892 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Support GL_ETC1_RGB8_OES in the OpenGL renderer."  This reverts commit 20bf7034533fbd9ff57296c5f9a5b1b9e06059db.  Broke GL2ExtensionTests_compressed_etc1_rgb8_texture_input_run on win bots  Change-Id: I2b48aac1512d916671d41e03f0409c404d6d7c88 Reviewed-on: https://chromium-review.googlesource.com/299429 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Support GL_ETC1_RGB8_OES in the OpenGL renderer.  Passes all dEQP tests related to etc1.  Change-Id: I33f37c44396899d87e9ef19bd7a6e2b2482d232a Reviewed-on: https://chromium-review.googlesource.com/299342 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update to the latest versions of the GL and EGL headers.  Add GLES 3.1 and 3.2 headers.  Remove GLES 3.0 extension headers and entry point files.  Re-land fixes double define from different style defines in libGLESv2.gypi and other projects.  Change-Id: I6204dc767bd83b7aa7e4d6e2fa338b2ce7f304d8 Reviewed-on: https://chromium-review.googlesource.com/299401 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Update to the latest versions of the GL and EGL headers."  Linux compile failures to do gyp defines.  This reverts commit 8bbeabc1795473f7b3141219be3970fea3b95a71.  Change-Id: Icb31dd817414b3a9ab36e88cedab9c725af26b6b Reviewed-on: https://chromium-review.googlesource.com/299173 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Support GL_ETC1_RGB8_OES in the OpenGL renderer."  Failing some ES2 dEQP tests.  This reverts commit 4aba0b90ec3d2dcd550ed4111f5739191f022028.  Change-Id: Ie39055872d25bce0f387e9e983ebab648c0493f0 Reviewed-on: https://chromium-review.googlesource.com/298972 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update to the latest versions of the GL and EGL headers.  Add GLES 3.1 and 3.2 headers.  Remove GLES 3.0 extension headers and entry point files.  Change-Id: Icaa444efa52f3b9d1497189da92bc364545a6e3a Reviewed-on: https://chromium-review.googlesource.com/299172 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Default test window size to 16x16.  This fixes a crash on Linux whenever we try to create a test without specifying a default width and height. Did not seem to have a problem on Windows.  TEST=angle_end2end_tests (Windows/Linux) BUG=angleproject:1123  Change-Id: I1afcea9e833208d8a67d363678b9736c2a222066 Reviewed-on: https://chromium-review.googlesource.com/298835 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Update to the latest versions of the GL and EGL headers."  Broke the Clang compile.  In file included from ../../third_party/angle/include/GLSLANG/ShaderLang.h:28: ../../third_party/angle/include/KHR/khrplatform.h:282:30: error: no newline at end of file [-Werror-Wnewline-eof] #endif /* __khrplatform_h_ */  Several other similar errors.  BUG=None  This reverts commit aac2035d851fc92b159dc8e01cfd2ebb86e99e4a.  Change-Id: I407e7e65bb6a46d1d941c54cdf14a14758e22d96 Reviewed-on: https://chromium-review.googlesource.com/298834 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Support GL_ETC1_RGB8_OES in the OpenGL renderer.  Passes all dEQP tests related to etc1.  Change-Id: I3ab2d51b7664cb2411fdc3247ff65a9e3258185a Reviewed-on: https://chromium-review.googlesource.com/299340 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update to the latest versions of the GL and EGL headers.  Add GLES 3.1 and 3.2 headers.  Remove GLES 3.0 extension headers and entry point files.  Change-Id: I8e9df6262dc1b2536a409c5791734e4a4d63b115 Reviewed-on: https://chromium-review.googlesource.com/299341 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Re-land "Added support for premultiplied alpha mode for composition swapchains"  Change-Id: Ic0c863c3d4936947fc520a5394e38e458659df46 Reviewed-on: https://chromium-review.googlesource.com/298880 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Re^6-land "Move Uniform and UBO info to the gl::Program layer."  This data was previously stored entirely in the Impl level. Move as much as possible to the GL level using a read-only view in the Impl level. Some information in D3D-specific and should be stored separately in the Impl.  This patch has a lot of refactoring that splits the D3D and GL info and moves as much validation as possible to the GL layer where it is shared between the back-ends.  Re-land with fix for dEQP unused uniforms. The fix involves storing a local copy of all uniform data in the GL layer. This will also let us validate sampler indexes during draw calls at the GL layer.  Re-re-land with a fix for multiply defined symbols on Clang.  Re-re-re-land with a fix for boolean uniforms and Uniform{1234}f.  Re^4-land with a fix for boolean uniform arrays and UBO uniforms.  Re^5-land with a fix for a test warning on Linux.  Re^6-land with a fix for transposed matrix uniform arrays.  BUG=angleproject:1123 TEST=end2end_tests bots dEQP GLES3.ubo and GLES2.uniform_api  Change-Id: Ie6fcde1c16eb05d67191b629338b88302a2563f5 Reviewed-on: https://chromium-review.googlesource.com/298971 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Re^5-land "Move Uniform and UBO info to the gl::Program layer.""  Failing dEQP-GLES3.functional.uniform_api.random.22 and 23: There's a bug with arrays of tranpsosed matrix uniforms.  BUG=angleproject:1123  This reverts commit 78d356929bd0441d81e2dd8a63130cd6788e2fde.  Change-Id: If39b5908af39671dfe98965e6a1ba77fd18ea8fc Reviewed-on: https://chromium-review.googlesource.com/299320 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Call the correct vertex attrib function for stream integer attribs.  Fixes tests related to integer attributes in dEQP-GLES3.functional.shaders.builtin_functions.*  BUG=angleproject:880  Change-Id: I107c5c9fd1adc29f58617fab095374daa74a0da1 Reviewed-on: https://chromium-review.googlesource.com/298970 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement EGL image classes for the D3D renderers.  BUG=angleproject:970  Change-Id: I24d393fcd75dd4ee510785e8475b093868701c77 Reviewed-on: https://chromium-review.googlesource.com/295152 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Re^5-land "Move Uniform and UBO info to the gl::Program layer."  This data was previously stored entirely in the Impl level. Move as much as possible to the GL level using a read-only view in the Impl level. Some information in D3D-specific and should be stored separately in the Impl.  This patch has a lot of refactoring that splits the D3D and GL info and moves as much validation as possible to the GL layer where it is shared between the back-ends.  Re-land with fix for dEQP unused uniforms. The fix involves storing a local copy of all uniform data in the GL layer. This will also let us validate sampler indexes during draw calls at the GL layer.  Re-re-land with a fix for multiply defined symbols on Clang.  Re-re-re-land with a fix for boolean uniforms and Uniform{1234}f.  Re^4-land with a fix for boolean uniform arrays and UBO uniforms.  Re^5-land with a fix for a test warning on Linux.  BUG=angleproject:1123 TEST=end2end_tests bots dEQP GLES3.ubo and GLES2.uniform_api  Change-Id: I03afcd446d9e74573c4d4c712ed7407b91d8001c Reviewed-on: https://chromium-review.googlesource.com/299180 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Re^4-land "Move Uniform and UBO info to the gl::Program layer.""  Test has a warning on Linux:  In file included from ../../third_party/angle/src/tests/test_utils/ANGLETest.h:13: ../../testing/gtest/include/gtest/gtest.h:1392:16: error: comparison of integers of different signs: 'const int' and 'const unsigned int' [-Werror-Wsign-compare]   if (expected == actual) {       ~~~~~~~~ ^  ~~~~~~ ../../testing/gtest/include/gtest/gtest.h:1422:12: note: in instantiation of function template specialization 'testing::internal::CmpHelperEQ<int unsigned int>' requested here     return CmpHelperEQ(expected_expression actual_expression expected            ^ ../../third_party/angle/src/tests/gl_tests/UniformBufferTest.cpp:357:5: note: in instantiation of function template specialization 'testing::internal::EqHelper<false>::Compare<int unsigned int>' requested here     EXPECT_EQ(GL_FLOAT type);     ^  BUG=angleproject:1123  This reverts commit 2ae1ee6161c24aab065190b1528f6195e80e34d0.  Change-Id: Ic3dabea54068377d1f2c5f722ba52966cf1a0491 Reviewed-on: https://chromium-review.googlesource.com/299170 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Re^4-land "Move Uniform and UBO info to the gl::Program layer."  This data was previously stored entirely in the Impl level. Move as much as possible to the GL level using a read-only view in the Impl level. Some information in D3D-specific and should be stored separately in the Impl.  This patch has a lot of refactoring that splits the D3D and GL info and moves as much validation as possible to the GL layer where it is shared between the back-ends.  Re-land with fix for dEQP unused uniforms. The fix involves storing a local copy of all uniform data in the GL layer. This will also let us validate sampler indexes during draw calls at the GL layer.  Re-re-land with a fix for multiply defined symbols on Clang.  Re-re-re-land with a fix for boolean uniforms and Uniform{1234}f.  Re^4-land with a fix for boolean uniform arrays and UBO uniforms.  BUG=angleproject:1123 TEST=end2end_tests bots dEQP GLES3.ubo and GLES2.uniform_api  Change-Id: I4c9f5ed31b81380507bef7981f97086d642801ae Reviewed-on: https://chromium-review.googlesource.com/298451 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Adding in checks for program and shader names to return INVALID_OPERATION  When a valid program is given instead of a shader an INVALID_OPERATION is returned rather than INVALID_VALUE when a shader related function is called. The reverse happens when a program related function is called and a valid shader program is given to it.  This commit also refactors other places that requires a similar check to use the same validation function and error message.  BUG=angleproject:1029 dEQP-GLES2.functional.negative_api.state.get_shader_info_log dEQP-GLES2.functional.negative_api.state.get_shader_source dEQP-GLES2.functional.negative_api.state.get_programiv dEQP-GLES2.functional.negative_api.state.get_program_info_log  BUG=angleproject:1101 dEQP-GLES3.functional.negative_api.state.get_shader_info_log dEQP-GLES3.functional.negative_api.state.get_shader_source dEQP-GLES3.functional.negative_api.state.get_programiv dEQP-GLES3.functional.negative_api.state.get_program_info_log  Change-Id: I707b6ba10da0288128af185ce8dfb906fca0f766 Reviewed-on: https://chromium-review.googlesource.com/298604 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tryjob-Request: Dian Xiang <dianx@google.com> Tested-by: Dian Xiang <dianx@google.com>, 23355681, 619, 169, 619
Work around depth texture sampling differences in GL versions.  ES3 requires that only the red channel has data when sampling from depth textures while desktop GL treats them as luminance textures.  Set the swizzle state of the texture to sample 0 from the blue and green channels in TextureGL.  Passes 75 new tests in dEQP-GLES3.functional.texture.format and dEQP-GLES3.functional.texture.specification.  BUG=angleproject:884  Change-Id: I863472961dcbbf8af864f5e1d85a4aea41f47bda Reviewed-on: https://chromium-review.googlesource.com/298481 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix the named parameter for the IndexConversion perftest  It seems that the compiler didn't resolve the overloaded operator<< with the structure's grandparent structure. Fix it by explicitely casting to the grandparent before calling operator<<. Also provides slightly more information on the number of iterations/triangles.  This wasn't caught with local testing as IndexConversion isn't compiled in angle_perftests on Linux.  BUG=angleproject:1153 BUG=530226  Change-Id: Ifa602eb0728d052bc651f0dd030f9f880c00dc51 Reviewed-on: https://chromium-review.googlesource.com/298860 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Added support for premultiplied alpha mode for composition swapchains"  Unused member warning:  ..\..\third_party\angle\src\libANGLE/renderer/d3d/d3d11/NativeWindow.h(6824) :  error: private field 'mConfig' is not used [-Werror-Wunused-private-field]     const egl::Config *mConfig;                        ^ BUG=None  This reverts commit 9823337204555935804985c5b93a38adc69cb681.  Change-Id: I8ed41770eb3fe70ab7e32ba9a0860e2c397e22c5 Reviewed-on: https://chromium-review.googlesource.com/298830 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement a minimal EGL -> CGL backend  This succesfully renders HelloTriangle and some samples but fails on a lot of tests. In particular it doesn't handle resizing the window and doesn't have depth or stencil buffers.  BUG=angleproject:891  Change-Id: I16356471b470f764acb38e8dd3589e9c0129829d Reviewed-on: https://chromium-review.googlesource.com/290770 Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Returning INVALID_OPERATION when a valid program is passed to getShaderiv  BUG=angleproject:1147  Change-Id: I7f3e77f8f5f55887fe03172eadce78129ffeb10f Reviewed-on: https://chromium-review.googlesource.com/298064 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tryjob-Request: Dian Xiang <dianx@google.com> Tested-by: Dian Xiang <dianx@google.com>, 23355681, 619, 169, 619
win clang build fix  BUG= TEST=win clang bots build  Change-Id: I802be2e72a884e50cf13120d3cd9c76a8f8eb86f Reviewed-on: https://chromium-review.googlesource.com/298253 Tested-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Support ETC2 texture formats with RendererGL.  400 tests in dEQP-GLES3.functional.texture go from unsupported to passing.  BUG=angleproject:884  Change-Id: I51927dffbc5931c7d1b80e72f55c620197736724 Reviewed-on: https://chromium-review.googlesource.com/298484 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add LUMA format entries into the tables in formatutilsgl.  BUG=angleproject:884  Change-Id: Ie4f378bc18cda57a91c16832c33f0ddc81f9c105 Reviewed-on: https://chromium-review.googlesource.com/298483 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Pass the texture unit to TextureGL::syncSamplerState.  When syncing the texture's sampler state make sure the correct texture unit is active.  When StateManagerGL syncs the textures it may not set the active texture if the texture ID has not changed.  BUG=angleproject:884 BUG=angleproject:883 BUG=angleproject:1051  Change-Id: Ib22874c22a12b1b9bd68887ac5a449c507e7bdc6 Reviewed-on: https://chromium-review.googlesource.com/298482 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't sync the multisample state in StateManagerGL.  GL_MULTISAMPLE is not a real state in GLES but existed for the D3D renderers to sync the rasterizer state more easily.  Instead of syncing it in StateManagerGL rely on the default value of GL_TRUE in Desktop GL.  All tests in dEQP-GLES3.functional.multisample.* now pass.  BUG=angleproject:885 BUG=angleproject:883  Change-Id: Idbe5fbc1b43a6e66008fe87da41601277dbe7311 Reviewed-on: https://chromium-review.googlesource.com/298441 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Re-re-re-land "Move Uniform and UBO info to the gl::Program layer.""  Seems to be failing the dEQP-GLES2.functional.uniform_api tests relating to boolean arrays.  BUG=angleproject:1123  This reverts commit 892a6a4b17b35e89898be8b4605c1ee595d3ae13.  Change-Id: Ifc4ce3ca806ef88a02ac6f693334ac37ce098a88 Reviewed-on: https://chromium-review.googlesource.com/298520 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Re-re-re-land "Move Uniform and UBO info to the gl::Program layer."  This data was previously stored entirely in the Impl level. Move as much as possible to the GL level using a read-only view in the Impl level. Some information in D3D-specific and should be stored separately in the Impl.  This patch has a lot of refactoring that splits the D3D and GL info and moves as much validation as possible to the GL layer where it is shared between the back-ends.  Re-land with fix for dEQP unused uniforms. The fix involves storing a local copy of all uniform data in the GL layer. This will also let us validate sampler indexes during draw calls at the GL layer.  Re-re-land with a fix for multiply defined symbols on Clang.  Re-re-re-land with a fix for boolean uniforms and Uniform{1234}f.  BUG=angleproject:1123 TEST=end2end_testsCanary WebGL (D3D11/GL) dEQP-GLES2+3.functional.uniform_api  Change-Id: Ia40820a5ce2f34ec2d27648b1dc940a8955e9999 Reviewed-on: https://chromium-review.googlesource.com/298440 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix compilation on Mac  BUG=angleproject:891  Change-Id: I2b787778268e8c29f0cf36d91520a04e92208f6f Reviewed-on: https://chromium-review.googlesource.com/298030 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Suppress two failing end2end_tests on Intel.  The UniformTest suppression we can work around with a patch to handle GetUniform queries entirely in ANGLE. The suppression for BlendMinMax is a long-standing failure for an unknown reason.  BUG=angleproject:809  Change-Id: Ib89af1579a74dc5065f169b31307678429724a7c Reviewed-on: https://chromium-review.googlesource.com/298450 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix preprocessor macro replacement list location  According to the dEQP tests a macro replacement list generated by a function-like macro invocation should get its location from the closing parenthesis of the invocation. The tests check this by using __LINE__ in a macro with a multi-line invocation. It's not quite clear from the spec that the enforced behavior is expected as opposed to the replacement list getting its location from the macro name but a minor correction to the preprocessor makes the dEQP tests pass.  Newlines in the preprocessor unit tests are generated according to the source locations in the token list produced by the preprocessor so the expectations of a few tests also need to be updated.  BUG=angleproject:989 TEST=dEQP-GLES3.functional.shaders.preprocessor.predefined_macros.*      (2 start passing with this change)      angle_unittests  Change-Id: I4cc9da09bd0985310a05ebf6def680916a46308a Reviewed-on: https://chromium-review.googlesource.com/297990 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Don't split the file into two chunks in shader_translator  Splitting the file into two strings in shader_translator complicated testing line/file numbering related functionality with it since each chunk passed to ShCompile has its own file number and line numbering. These are exposed to the preprocessor in __FILE__ and __LINE__ predefined macros.  Just supply the file to ShCompile in a single string. Also since the original motivation for splitting the string seems to have been to exercise ShCompile with multiple strings add a new unit test that ensures that ShCompile handles multiple strings as expected.  BUG=angleproject:989 TEST=angle_unittests  Change-Id: I31d24925ec85ca3411e537df25a985f09737403e Reviewed-on: https://chromium-review.googlesource.com/297251 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Revert "Re-re-land "Move Uniform and UBO info to the gl::Program layer.""  Failes the gles2_conform_test:  GLES2ConformTest.GL2Tests_glGetUniform_input_run  Possibly also WebGL failures will investigate.  BUG=angleproject:1123  This reverts commit 10750cb936288d8dd09d49fadd592904c06c56f9.  Change-Id: I1ae59325e1831589019bc5a27ffc2091d3994a65 Reviewed-on: https://chromium-review.googlesource.com/298200 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Re-re-land "Move Uniform and UBO info to the gl::Program layer."  This data was previously stored entirely in the Impl level. Move as much as possible to the GL level using a read-only view in the Impl level. Some information in D3D-specific and should be stored separately in the Impl.  This patch has a lot of refactoring that splits the D3D and GL info and moves as much validation as possible to the GL layer where it is shared between the back-ends.  Re-land with fix for dEQP unused uniforms. The fix involves storing a local copy of all uniform data in the GL layer. This will also let us validate sampler indexes during draw calls at the GL layer.  Re-re-land with a fix for multiply defined symbols on Clang.  BUG=angleproject:1123 TEST=end2end_testsCanary WebGL (D3D11/GL) dEQP-GLES2+3.functional.uniform_api  Change-Id: I7b55e4964fbe64e0106c37928c894146937a2476 Reviewed-on: https://chromium-review.googlesource.com/298110 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Re-land "Move Uniform and UBO info to the gl::Program layer.""  Problems with multiply defined symbols in the Linux builder.  BUG=angleproject:1123  This reverts commit ff1abe63c3d8af28e9755c8d0c95b2aeca27a0d9.  Change-Id: Ifcb2ad885d0841c128ffd69afb6594e37eba17fc Reviewed-on: https://chromium-review.googlesource.com/298100 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Re-land "Move Uniform and UBO info to the gl::Program layer."  This data was previously stored entirely in the Impl level. Move as much as possible to the GL level using a read-only view in the Impl level. Some information in D3D-specific and should be stored separately in the Impl.  This patch has a lot of refactoring that splits the D3D and GL info and moves as much validation as possible to the GL layer where it is shared between the back-ends.  Re-land with fix for dEQP unused uniforms. The fix involves storing a local copy of all uniform data in the GL layer. This will also let us validate sampler indexes during draw calls at the GL layer.  BUG=angleproject:1123 TEST=end2end_testsCanary WebGL (D3D11/GL) dEQP-GLES2+3.functional.uniform_api  Change-Id: I9074c057c2c67d4d3221ec11c5556a26e07c7ceb Reviewed-on: https://chromium-review.googlesource.com/297070 Tryjob-Request: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Set seamless cubemap filtering in StateManagerGL.  Cubemap filtering is supposed to be seamless for ES3+ contexts.  Fixes 298 failures in dEQP-GLES3.functional.texture mostly in dEQP-GLES3.functional.texture.filtering and dEQP-GLES3.functional.texture.shadow.  BUG=angleproject:986 BUG=angleproject:1149  Change-Id: I6054365086bb3b9d9b085c260f88e2c43eb75bfe Reviewed-on: https://chromium-review.googlesource.com/296966 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Added support for premultiplied alpha mode for composition swapchains  Change-Id: Iee1d327a03469d7daf6cc412709c0a36e1c83e32 Reviewed-on: https://chromium-review.googlesource.com/296721 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Cooper Partin <coopp@microsoft.com> Tryjob-Request: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use named value-parameterized tests for angle_end2end_tests  This replace the non-descriptive digit at the end of the test name by the name of the configuration being tested.  Reland with a fix for gtest initialization on Windows caused by ProgramBinaryTest having the same parameter name twice.  BUG=angleproject:1153  Change-Id: I9b0f661a535b760793d9d87ef0c8298f6b83830d Reviewed-on: https://chromium-review.googlesource.com/297701 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Mark GL_RGB10_A2UI as a renderable format.  dEQP-GLES3.functional.fbo.color.tex3d.rgb10_a2ui was already failing but because the framebuffer was marked as unsupported dEQP considers the test to be passing.  BUG=angleproject:1149 BUG=angleproject:1097  Change-Id: I82223e8e927d1fd6d66f75b5fdea7989c92d706d Reviewed-on: https://chromium-review.googlesource.com/298031 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't evaluate short-circuited preprocessor expressions  Resubmit with clang build issue fixed. The result of a short-circuited operation is now either 0 or 1.  ESSL 3.00 spec section 3.4 mentions that the second operand in a logical && or || preprocessor operation is evaluated only if the first operand doesn't short-circuit the expression. The non-evaluated part of a preprocessor expression may also have undefined identifiers.  Make the expression parser follow the spec by ignoring errors that are generated inside short-circuited expressions. This includes undefined identifiers and divide by zero.  BUG=angleproject:347 TEST=dEQP-GLES3.functional.shaders.preprocessor.undefined_identifiers.*      angle_unittests  Change-Id: I4163f96ec46d40ac859ffb39d91b89490041e44d Reviewed-on: https://chromium-review.googlesource.com/297252 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Don't evaluate short-circuited preprocessor expressions"  Build break on Clang:  FAILED: /b/build/goma/gomacc ../../third_party/llvm-build/Release+Asserts/bin/clang++ -MMD -MF obj/third_party/angle/src/compiler/preprocessor/preprocessor.ExpressionParser.o.d -DV8_DEPRECATION_WARNINGS -DCLD_VERSION=2 -D__ASSERT_MACROS_DEFINE_VERSIONS_WITHOUT_UNDERSCORE=0 -DCHROMIUM_BUILD -DCR_CLANG_REVISION=245965-1 -DUSE_LIBJPEG_TURBO=1 -DENABLE_ONE_CLICK_SIGNIN -DENABLE_PRE_SYNC_BACKUP -DENABLE_WEBRTC=1 -DENABLE_MEDIA_ROUTER=1 -DUSE_PROPRIETARY_CODECS -DENABLE_PEPPER_CDMS -DENABLE_CONFIGURATION_POLICY -DENABLE_NOTIFICATIONS -DENABLE_HIDPI=1 -DSYSTEM_NATIVELY_SIGNALS_MEMORY_PRESSURE -DDONT_EMBED_BUILD_METADATA -DDCHECK_ALWAYS_ON=1 -DFIELDTRIAL_TESTING_ENABLED -DENABLE_TASK_MANAGER=1 -DENABLE_EXTENSIONS=1 -DENABLE_PDF=1 -DENABLE_PLUGIN_INSTALLATION=1 -DENABLE_PLUGINS=1 -DENABLE_SESSION_SERVICE=1 -DENABLE_THEMES=1 -DENABLE_AUTOFILL_DIALOG=1 -DENABLE_BACKGROUND=1 -DENABLE_GOOGLE_NOW=1 -DENABLE_PRINTING=1 -DENABLE_BASIC_PRINTING=1 -DENABLE_PRINT_PREVIEW=1 -DENABLE_SPELLCHECK=1 -DUSE_BROWSER_SPELLCHECKER=1 -DENABLE_CAPTIVE_PORTAL_DETECTION=1 -DENABLE_APP_LIST=1 -DENABLE_SETTINGS_APP=1 -DENABLE_SUPERVISED_USERS=1 -DENABLE_SERVICE_DISCOVERY=1 -DENABLE_WIFI_BOOTSTRAPPING=1 -DV8_USE_EXTERNAL_STARTUP_DATA -DFULL_SAFE_BROWSING -DSAFE_BROWSING_CSD -DSAFE_BROWSING_DB_LOCAL -DSAFE_BROWSING_SERVICE -DUSE_LIBPCI=1 -DUSE_OPENSSL=1 -DNDEBUG -DNVALGRIND -DDYNAMIC_ANNOTATIONS_ENABLED=0 -Igen -isysroot /Applications/Xcode5.1.1.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.10.sdk -O2 -gdwarf-2 -fvisibility=hidden -Werror -Wnewline-eof -mmacosx-version-min=10.6 -arch x86_64 -Wendif-labels -Wno-unused-parameter -Wno-missing-field-initializers -Wno-selector-type-mismatch -Wpartial-availability -Wheader-hygiene -Wno-char-subscripts -Wno-unneeded-internal-declaration -Wno-covered-switch-default -Wstring-conversion -Wno-c++11-narrowing -Wno-deprecated-register -Wno-inconsistent-missing-override -Wno-shift-negative-value -Wno-unused-function -Wno-unused-variable -std=c++11 -fno-rtti -fno-exceptions -fvisibility-inlines-hidden -fno-threadsafe-statics -Xclang -load -Xclang /b/build/slave/GPU_Mac_Builder/build/src/third_party/llvm-build/Release+Asserts/lib/libFindBadConstructs.dylib -Xclang -add-plugin -Xclang find-bad-constructs -Xclang -plugin-arg-find-bad-constructs -Xclang check-templates -fcolor-diagnostics -fno-strict-aliasing  -c ../../third_party/angle/src/compiler/preprocessor/ExpressionParser.cpp -o obj/third_party/angle/src/compiler/preprocessor/preprocessor.ExpressionParser.o ../../third_party/angle/src/compiler/preprocessor/ExpressionParser.cpp:1372:35: error: use of logical '||' with constant operand [-Werror-Wconstant-logical-operand]             (yyval) = (yyvsp[-3]) || 0;                                   ^  ~ ../../third_party/angle/src/compiler/preprocessor/ExpressionParser.cpp:1372:35: note: use '|' for a bitwise operation             (yyval) = (yyvsp[-3]) || 0;                                   ^~                                   | ../../third_party/angle/src/compiler/preprocessor/ExpressionParser.cpp:1406:35: error: use of logical '&&' with constant operand [-Werror-Wconstant-logical-operand]             (yyval) = (yyvsp[-3]) && 0;                                   ^  ~ ../../third_party/angle/src/compiler/preprocessor/ExpressionParser.cpp:1406:35: note: use '&' for a bitwise operation             (yyval) = (yyvsp[-3]) && 0;                                   ^~                                   & ../../third_party/angle/src/compiler/preprocessor/ExpressionParser.cpp:1406:35: note: remove constant to silence this warning             (yyval) = (yyvsp[-3]) && 0;                                  ~^~~~  BUG=angleproject:347  This reverts commit 6ffe613518482b966b913013c51221ce06ca7c33.  Change-Id: I6d81666cca573f320bfb1164a6c794b6f75f7463 Reviewed-on: https://chromium-review.googlesource.com/298020 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Mark GL_RGB10_A2UI as a renderable format."  Fails the dEQP test:  dEQP-GLES3.functional.fbo.color.tex3d.rgb10_a2ui  BUG=angleproject:1149  This reverts commit d0f9fdc772d0b286a50978f4a16c94e2af3dfee7.  Change-Id: I5b76255be3fc1f0734395dac609e2949fc8c8185 Reviewed-on: https://chromium-review.googlesource.com/298010 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't evaluate short-circuited preprocessor expressions  ESSL 3.00 spec section 3.4 mentions that the second operand in a logical && or || preprocessor operation is evaluated only if the first operand doesn't short-circuit the expression. The non-evaluated part of a preprocessor expression may also have undefined identifiers.  Make the expression parser follow the spec by ignoring errors that are generated inside short-circuited expressions. This includes undefined identifiers and divide by zero.  BUG=angleproject:347 TEST=dEQP-GLES3.functional.shaders.preprocessor.undefined_identifiers.*      angle_unittests  Change-Id: Ieed02a71298af838f784a5d1197d4f4a9ba0e3c8 Reviewed-on: https://chromium-review.googlesource.com/295033 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Suppress failing Uniform test on AMD.  This test exposes a driver bug in state query where the AMD driver does not cast state values correctly. Suppress this for now but we can quickly turn it on with the Uniforms refactor which does all of the necessary state retrieval within ANGLE without consulting the driver.  BUG=angleproject:1123  Change-Id: I5c1f1c16e3a59582267de3365e388ffef4d57467 Reviewed-on: https://chromium-review.googlesource.com/296667 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix GetUniform rounding in D3D. Also add a test.  The test will help cover a bug that I found when doing the refactor of gl::Program.  BUG=angleproject:1123  Change-Id: Id353ffaffef83ad1538580ad01668c915bf9853f Reviewed-on: https://chromium-review.googlesource.com/297031 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Use named value-parameterized tests for dEQP gtests"  This reverts commit 0db7b15554f30c528a69285ec19150f36be263f7.  BUG=  Change-Id: Ia2de8268bd51d865ad87875c55cb5bfcc51e29f6 Reviewed-on: https://chromium-review.googlesource.com/297760 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Don't use the mip level to validate the 2D texture depth parameter.  BUG=angleproject:1149  Change-Id: I5dd45c99b373d480814c9fbdbe0abd419a270c89 Reviewed-on: https://chromium-review.googlesource.com/297052 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix typo when syncing GL_UNPACK_SKIP_ROWS and GL_PACK_SKIP_ROWS.  Causes crashes in the dEQP ReadPixels test.  BUG=angleproject:1149 BUG=angleproject:883  Change-Id: I090e21ebd7781ce3372b8842421e7da3e4bedbac Reviewed-on: https://chromium-review.googlesource.com/287629 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Apply the pixel pack state before ReadPixels in FramebufferGL.  This ensures that the PBO is bound because it does not have a dirty bit yet.  BUG=angleproject:1149 BUG=angleproject:885  Change-Id: Iad96abc4dec4e6ac8187975c7638dfd7f18951e7 Reviewed-on: https://chromium-review.googlesource.com/296963 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Mark GL_RGB10_A2UI as a renderable format.  BUG=angleproject:1149  Change-Id: Ia808c0d411133d135eef8e90485ba346086f012c Reviewed-on: https://chromium-review.googlesource.com/296964 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Skip deletion of null framebuffers.  It's valid to have a map entry that is null to represent a framebuffer that has been generated but never bound.  This was causing crashes after dEQP pbo tests were run during dEQP shutdown.  BUG=angleproject:1149  Change-Id: Idcedac23e5c4e17ed025b10c2939572b394d3aec Reviewed-on: https://chromium-review.googlesource.com/296962 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use named value-parameterized tests for dEQP gtests  This replace the non-descriptive digit at the end of the test name by the name of the dEQP test being run.  BUG=angleproject:1153  Change-Id: Ibc9e5fbf46ffbf3a8c783807161b2bdc63119f54 Reviewed-on: https://chromium-review.googlesource.com/296686 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Tryjob-Request: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix the vertex copy loop iterating over one too many elements.  BUG=angleproject:1149 BUG=angleproject:880  Change-Id: I2840043ded50f805afa3032fc1f0362fa91b8877 Reviewed-on: https://chromium-review.googlesource.com/297088 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Use named value-parameterized tests for angle_end2end_tests"  Causing crashes on windows.  This reverts commit dfa569e67829f891ae4481812ca7a0371c9d4e17.  Change-Id: Icbe56455d172ec92395c4f889557091f98a30240 Reviewed-on: https://chromium-review.googlesource.com/297700 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fixed GL_MAX_VERTEX_UNIFORM_VECTORS and GL_MAX_FRAGMENT_UNIFORM_VECTORS to report accurate maximum value.  Change-Id: Ic581e1ef0c6be2bf1ff0092b373b3c480b6fbd8a Reviewed-on: https://chromium-review.googlesource.com/294755 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Cooper Partin <coopp@microsoft.com> Tryjob-Request: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove dynamic indexing of matrices and vectors in HLSL  Re-landing after fixing D3D9 specific issues.  HLSL doesn't support dynamic indexing of matrices and vectors so replace that with helper functions that unroll dynamic indexing into switch/case and static indexing.  Both the indexed vector/matrix expression and the index may have side effects and these will be evaluated correctly. If necessary index expressions that have side effects will be written to a temporary variable that will replace the index.  Besides dEQP tests this change is tested by a WebGL 2 conformance test.  In the case that a dynamic index is out-of-range the base ESSL 3.00 spec allows undefined behavior. KHR_robust_buffer_access_behavior adds the requirement that program termination should not occur and that out-of-range reads must return either a value from the active program's memory or zero and out-of-range writes should only affect the active program's memory or do nothing. This patch clamps out-of-range indices so that either the first or last item of the matrix/vector is accessed.  The code is not transformed in case the it fits within the limited subset of ESSL 1.00 given in Appendix A of the spec. If the code isn't within the restricted subset even ESSL 1.00 shaders may require this workaround.  BUG=angleproject:1116 TEST=dEQP-GLES3.functional.shaders.indexing.* (all pass after change)      WebGL 2 conformance tests (glsl3/vector-dynamic-indexing.html)  Change-Id: I66a5e5a8d7f4267da0045f1cc2ba6b0dc7eb3f5d Reviewed-on: https://chromium-review.googlesource.com/296671 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Use named value-parameterized tests for angle_end2end_tests  This replace the non-descriptive digit at the end of the test name by the name of the configuration being tested.  BUG=angleproject:1153  Change-Id: Ieed08c8e5f111c079c183dd96cf3fe1cfff52f7f Reviewed-on: https://chromium-review.googlesource.com/296685 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Roll googletest 23574bf2..9855a871  BUG=angleproject:1153  Change-Id: I0b0be8133c04a3ebfed7e9ed20d7375ee5e07903 Reviewed-on: https://chromium-review.googlesource.com/296684 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Comment out UNIMPLEMENTEDs in TransformFeedbackGL.  dEQP's resetState function triggers these assertions when testing.  BUG=angleproject:1149  Change-Id: Ib6fc3acdf15cadf3ffafad8ffda4788e34f520f0 Reviewed-on: https://chromium-review.googlesource.com/297082 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Support writing interface blocks in OutputGLSL.  BUG=angleproject:882 BUG=angleproject:1149  Change-Id: Iea0b1d0bc586ec9517a06793386c91890b7a5115 Reviewed-on: https://chromium-review.googlesource.com/297086 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Allow OutputGLSL to write non-square matrices.  Fixes assertion failures when ShaderGL fails to compile the generated shaders.  BUG=angleproject:882 BUG=angleproject:1149  Change-Id: Ib7c23a54bdb81852864d792f29c89644084859a3 Reviewed-on: https://chromium-review.googlesource.com/297085 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement translation of EOpIndexDirectInterfaceBlock in OutputGLSL.  BUG=angleproject:882 BUG=angleproject:1149  Change-Id: I5e0808dd3576339aa87aade3a349586d01b28f74 Reviewed-on: https://chromium-review.googlesource.com/297087 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Avoid copy of PixelUnpackState in Texture::setImage.  The ternary operator determines that the common type is the value type causing a copy of PixelUnpackState.  If PixelUnpackState::pixelBuffer is non-null then there is an assertion failure in the destructor on any call to Texture::setImage.  See:http://stackoverflow.com/a/30088030  BUG=angleproject:1149  Change-Id: I9654e65956339d6b6966ad65a98cf37ad4e00452 Reviewed-on: https://chromium-review.googlesource.com/297084 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Support syncing pixel pack and unpack buffers in StateManagerGL.  BUG=angleproject:1149  Change-Id: I641693e67bf35733a591107fdd3812d0badd17f2 Reviewed-on: https://chromium-review.googlesource.com/297083 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Properly check for EGL_KHR_create_context before creating ES3 context.  Mark EGL_KHR_create_context as supported in the DisplayGLs.  BUG=angleproject:1149  Change-Id: I20671535680eb2c3b9c08205cee243b3aa5c5821 Reviewed-on: https://chromium-review.googlesource.com/297080 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Mark the pack and unpack buffer types as valid in ES3.  dEQP resetState generates a GL error and exits when trying to reset the pixel buffers after a test.  BUG=angleproject:1149  Change-Id: I133788c6c2f17074bf5bbf5cd17b63338352765f Reviewed-on: https://chromium-review.googlesource.com/297081 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Only validate that color and alpha blend funcs are non-constant on D3D renderers.  BUG=angleproject:1025  Change-Id: I9c6008cc2f268bda4afa2c67e0b3d3716e77ea31 Reviewed-on: https://chromium-review.googlesource.com/296681 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Force index/loop validation on the D3D9 backend  D3D9 shader models have limited support for looping so the Appendix A index/loop limitations are necessary. This is consistent with applying the limitations on D3D9_3 feature level and lower of the D3D11 backend too.  Also when the limitations are not in place a workaround for dynamic indexing of vectors and matrices will be applied. This workaround does not work on the D3D9 backend as demonstrated with some WebGL conformance failures caused by it in Chrome on D3D9.  BUG=525188 TEST=angle_end2end_tests  Change-Id: I6411594f067f2740f55d7560427026b23b15dac7 Reviewed-on: https://chromium-review.googlesource.com/296940 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
translator: Add sh::OutputVariable type.  This replaces the dual-use of sh::Attribute which can be a bit confusing to people expecting a literal output variable.  Currently not used in Chromium so should be safe to land.  BUG=angleproject:1146  Change-Id: I436f2bc9dc4ddc3709369cb2baa344c6b13a21a2 Reviewed-on: https://chromium-review.googlesource.com/296683 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make the end2end tests compile in the GN build.  BUG=angleproject:929  Change-Id: Ifc5ad03579c3e187721842f7585f3f06b69cbf45 Reviewed-on: https://chromium-review.googlesource.com/296682 Reviewed-by: Dirk Pranke <dpranke@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Move Uniform and UBO info to the gl::Program layer."  Seems to be failing dEQP-GLES2.functional.uniform_api.value.unused_uniforms.* on Linux (possibly Win as well)  BUG=angleproject:1123  This reverts commit 54f882c9167b1aff5b3700187a2048bd886e8b17.  Change-Id: I7dbbf40aae8dd9ebd35895df0dd338a3b6b9cc96 Reviewed-on: https://chromium-review.googlesource.com/297051 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move Uniform and UBO info to the gl::Program layer.  This data was previously stored entirely in the Impl level. Move as much as possible to the GL level using a read-only view in the Impl level. Some information in D3D-specific and should be stored separately in the Impl.  This patch has a lot of refactoring that splits the D3D and GL info and moves as much validation as possible to the GL layer where it is shared between the back-ends.  BUG=angleproject:1123 TEST=end2end_testsCanary WebGL (D3D11/GL) dEQP-GLES2+3.functional.uniform_api  Change-Id: I8b7e1380a61590a46ccee646a47ffe9bda287f6b Reviewed-on: https://chromium-review.googlesource.com/295124 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Revert "Clean up interface to ProgramImpl::link.""  Should be fixed now with the fix the prior CL.  BUG=angleproject:1123  This reverts commit 63069dfc20bc34fe6962dee694953893ee6fc663.  Change-Id: Ie1826673820e3a24f9bb3e4ff5c723ac47570041 Reviewed-on: https://chromium-review.googlesource.com/297050 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Re-land "Compute packed varyings in ProgramD3D only."  Instead of storing varying information in the shader use a temporary set when linking a D3D program. This also means we won't have to modify information in the Shader object when linking a D3D program.  This completes the refactoring for PackedVaryings.  Re-land with fix for missing init of PackedVarying::vertexOnly.  BUG=angleproject:1123  Change-Id: If110809c3817d88b0370ac575d739d7385b067d9 Reviewed-on: https://chromium-review.googlesource.com/296731 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Only validate that stencil refs and masks are the same on D3D renderers.  BUG=angleproject:1025  Change-Id: If79046f9f81ad20c5f2f7296245b0cb74a4102aa Reviewed-on: https://chromium-review.googlesource.com/296680 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add back a suppression for a bot specific dEQP GLES2 failure on Windows  BUG=angleproject:1127  Change-Id: I749c2c39dfaf60d5e39a00bd7954fcb1d7e931ac Reviewed-on: https://chromium-review.googlesource.com/296960 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
ProgramBinaryTest: fix an unreachable code warning  This warning was found by the GN build on Windows: the FAIL macro contains a return which caused code after the FAIL to be unreachable.  BUG=angleproject:929  Change-Id: Id4bda39ea9f76d2b59c44391cb2de8a3bfb6947c Reviewed-on: https://chromium-review.googlesource.com/296950 Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make the unittests compile in the GN build.  This changes angle_unittests.gypi to use a variable per list of files so that we can grab the list of files in conditions in BUILD.gn  BUG=angleproject:929  Change-Id: I7fc73fd84d8efc1ea545fe672b1dba1c429b317f Reviewed-on: https://chromium-review.googlesource.com/296443 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
BitSetIterator_unittest: fix an unreachable code warning  Because gtest's FAIL macro does a return MSVC complained that the update part of a range-based for loop was unreachable. Fixed this by having a boolean value set to true if we execute the loop body.  BUG=angleproject:929  Change-Id: I6c1fec7ed6cf1a3aba6f02b68c1015bee2feebfd Reviewed-on: https://chromium-review.googlesource.com/296730 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Compute packed varyings in ProgramD3D only."  Likely the cause of Windows bot failures.  BUG=angleproject:1123  This reverts commit 532061bbfb160586a06f0e47b6bbb5350e735203.  Change-Id: Ia4f0161b97bfbf2adb4cafaa5fa5484f04fad245 Reviewed-on: https://chromium-review.googlesource.com/296710 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Clean up interface to ProgramImpl::link."  Probably causing bot failures in a prior dependent patch.  BUG=angleproject:1123  This reverts commit b83592750d00ca96413575016b0e27bc9d861f58.  Change-Id: I7642c4a66b190dda49cbb16611abc893f3eb6422 Reviewed-on: https://chromium-review.googlesource.com/296700 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Change the FLATTEN heuristic to "ifs with a loop with a gradient"  This heuristic makes more sense than the previous "ifs with a discontinuous loop" as the reason we need to flatten is that we need gradients to be in branchless code.  Change the UnrollFlatten test accordingly.  Tested with:  - the WebGL CTS  - dev.miaumiau.cat/rayTracer "Skull Demo"  - THe turbulenz engine GPU particle demo  - Lots of ShaderToy Samples (inc. Volcanic Metropolis and Hierarchical    Voronoi)  - Google Maps Earth mode  - Lots of Chrome experiments  - madebyevan.com/webgl-water  BUG=524297  Change-Id: Iaa727036fffcfde3952716a1ef33b6ee0546b69d Reviewed-on: https://chromium-review.googlesource.com/296442 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Prefer glDepthRangef and glClearDepthf to the double version.  ES only has the float versions.  BUG=angleproject:1145  Change-Id: I6c96b553d20e8aa160f68fe1b3fa0200d64108a3 Reviewed-on: https://chromium-review.googlesource.com/296361 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix wrongly formatted dEQP GLES2 expectations  The formatting problem was introduced in 770f8f8658806b278f67e55ca195e022b683f9e0 and prevented the bots from running the dEQP tests.  BUG=angleproject:1143  Change-Id: I427f6472625df19111ff56685b7e70b9e9aae866 Reviewed-on: https://chromium-review.googlesource.com/295199 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make unittest #includes start from src  This is will help avoid adding many include directories for the GN build.  BUG=angleproject:929  Change-Id: If8f7e98526df3560b8e410ec86271a2da0c6889d Reviewed-on: https://chromium-review.googlesource.com/296480 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Mark TF Feedback array element capture as unsupported.  According to dEQP this is an undefined section of the spec. Mark it as unsupported for now until we can investgate if it's possible on certain platforms.  Noticed this when testing with the Program refactor.  BUG=angleproject:1123 TEST=dEQP-GLES3.functional.transform_feedback.array_element.*  Change-Id: I830dddf418e28fb4536f09500f4069def1d97b58 Reviewed-on: https://chromium-review.googlesource.com/295984 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Supress failures in RGB->L CopyTex[Sub]Image calls on Intel OpenGL.  BUG=angleproject:1113  Change-Id: Ie16a28046546fad2ff1c1af35ca67c434b9f5216 Reviewed-on: https://chromium-review.googlesource.com/296481 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement drawRangeElements in RendererGL.  BUG=angleproject:1136  Change-Id: I8b84b845da09f60bfd5e8f400da47d759f0d8f1a Reviewed-on: https://chromium-review.googlesource.com/295234 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix unsigned/signed comparison in VertexDataManager.  Affects Debug/Win32 only.  BUG=angleproject:1136  Change-Id: I29fbf06077014c313489be07ff983009afb652fd Reviewed-on: https://chromium-review.googlesource.com/296362 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Clean up interface to ProgramImpl::link.  We no longer need to pass mutable shaders with the changed to packed varyings.  BUG=angleproject:1123  Change-Id: I0a4bbf5d770ff48e10e3de2146840d8987b1e826 Reviewed-on: https://chromium-review.googlesource.com/295194 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Compute packed varyings in ProgramD3D only.  Instead of storing varying information in the shader use a temporary set when linking a D3D program. This also means we won't have to modify information in the Shader object when linking a D3D program.  This completes the refactoring for PackedVaryings.  BUG=angleproject:1123  Change-Id: I241610e87f7d14f3e18b0d8bd84f1a3509c05dfd Reviewed-on: https://chromium-review.googlesource.com/295193 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
HLSLCompiler: fix an infinite loop when failing to compile  When compiling shaders that produce errors X3531 or X4014 even when macros is nullptr we would try the same permutation infinitely.  BUG=524297  Change-Id: Id2a26ce2a5344bff4566440342adad5031368994 Reviewed-on: https://chromium-review.googlesource.com/296441 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement the instanced draw calls in RendererGL.  BUG=angleproject:1136  Change-Id: I1167365618bdc3ca37ac0f4c60809de32c7a9d78 Reviewed-on: https://chromium-review.googlesource.com/295733 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Implement the instanced draw calls in RendererGL."  Causing crashes in some dEQP tests.  This reverts commit c1948415e52dbaefb0d3176b75a58a7b86bd091a.  Change-Id: Idedb32484b4f2b09090346bc4228fe536190a621 Reviewed-on: https://chromium-review.googlesource.com/296440 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix dEQP renderer selection flag in documentation.  BUG=None  Change-Id: Ibefeab05c9c9ac87263a23fd69e6725bf4998673 Reviewed-on: https://chromium-review.googlesource.com/295148 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement the instanced draw calls in RendererGL.  BUG=angleproject:1136  Change-Id: Id04e357b97c04b3843b25827f705fd802e6a68e3 Reviewed-on: https://chromium-review.googlesource.com/295233 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Re-land "Fix warnings with ANGLE and VS2015."  With fix for VS2013.  BUG=None  Change-Id: I9f656efa6b540a03ce21f6b65fde0753c0d72538 Reviewed-on: https://chromium-review.googlesource.com/295157 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Fix warnings with ANGLE and VS2015."  Seems to break VS2013. Reverting.  This reverts commit 51e275b4dfb961b59b055655b6e3f49aae48a443.  Change-Id: I37843bf457122614007ba455f6ee751577b14604 Reviewed-on: https://chromium-review.googlesource.com/296290 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix warnings with ANGLE and VS2015.  BUG=None  Change-Id: I47b08593a38d710b59051a3107933c08c2789ca2 Reviewed-on: https://chromium-review.googlesource.com/295722 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix Chromium compilation error in VariablePack_test.cpp  BUG=  Change-Id: I59c9716774df4615da6dd412795639e055f45034 Reviewed-on: https://chromium-review.googlesource.com/295732 Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add row-sharing packing tests for VariablePacker_test.cpp  Recent test failures leads to suspicion that our variable packing algorithm is buggy - turns out to be an underlying driver bug.  With the added test cases such suspicion shouldn't even arise.  BUG=angleproject:1142 TEST=angle_unittests  Change-Id: I1fb3c5c7798d9ad17668a3d633286e031da79cab Reviewed-on: https://chromium-review.googlesource.com/295901 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix missing copy rules for DEQP EGL test cases and expectations.  BUG=angleproject:1139  Change-Id: I9d58b2c0b1e6465b58b2f3d4aad4b1d3517ae3ec Reviewed-on: https://chromium-review.googlesource.com/295147 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Only update the synced parts of mAppliedAttributes.  Members such as divisor are not synced in VertexArrayGL::updateAttribPointer so assigning the whole attribute causes the divisor to not be synced.  BUG=angleproject:1136  Change-Id: I947a144f81ae67953947e363debd1d1cff78207a Reviewed-on: https://chromium-review.googlesource.com/295145 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add back suppressions for bot-specific dEQP GLES2 failures on Linux  BUG=angleproject:1143  Change-Id: I5bd1a7de7b147062f2e093a30efe4ed06eb80ec2 Reviewed-on: https://chromium-review.googlesource.com/295247 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update the Windows dEQP GLES2 test expectations  BUG=angleproject:1127  Change-Id: I6f38e5441c4a288e9c1f55fefa31d5d2f10a700c Reviewed-on: https://chromium-review.googlesource.com/295246 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
angle_unittests add forgotten VariablePacker test.  Also add a warning on top of the UnrollFlatten test that it works only when HLSL is enabled.  BUG=angleproject:1140  Change-Id: Ide961bbed70dc9ed2a604f13273e4209b1dec29b Reviewed-on: https://chromium-review.googlesource.com/295125 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add back one left out compiler test to angle_unittests  VariablePacker_test.cpp  The other one UnrollFlatten_test.cpp crashes.  BUG= TEST=angle_unittests  Change-Id: I78e6e81e9b61f2a1599a5a0601b5b76165b180de Reviewed-on: https://chromium-review.googlesource.com/295767 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Update the dEQP wiki page.  BUG=none  Change-Id: I3a3095b270ca3c199c14840f75b480e15298fa5c Reviewed-on: https://chromium-review.googlesource.com/295117 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Update the dEQP GLES2 test expectations for Linux  BUG=angleproject:1127  Change-Id: Ia5f9442ef718625ed913fe3a76301a0edea00390 Reviewed-on: https://chromium-review.googlesource.com/295720 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix preprocessor failure in string concatenation.  BUG=angleproject:1138  Change-Id: I20f3b542884fbaa2b2cccd65ceb45e54174bccc2 Reviewed-on: https://chromium-review.googlesource.com/295831 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix warning about initialization order in BlitGL.  BUG=angleproject:1113  Change-Id: I808d521ffc257c2f45badbbd462698f91def314f Reviewed-on: https://chromium-review.googlesource.com/295830 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove unused mOptimize/mDebug flags from TIntermAggregate  These flags were written but they were never read.  TEST=compile BUG=angleproject:1116  Change-Id: I41e3e89f13861ebda4828c76c753ca17c74c4358 Reviewed-on: https://chromium-review.googlesource.com/294931 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Split the Context and Renderer draw* to one per entry point.  BUG=angleproject:1136  Change-Id: Ic7ff9c23201e1fe03c5a2135be24d61cfe3d6268 Reviewed-on: https://chromium-review.googlesource.com/295232 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix a warning on Linux  BUG=  Change-Id: I5c4f5df14321644d7ac42af6059400ae43d0fe4d Reviewed-on: https://chromium-review.googlesource.com/295721 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tryjob-Request: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Remove dynamic indexing of matrices and vectors in HLSL"  Seems to be failing a WebGL/ES2 CTS test in D3D9:  conformance/ogles/GL/mat3/mat3_001_to_006  BUG=angleproject:1116 BUG=525188  This reverts commit 83f3411da456faac8570892e3dd7d76edf4095e5.  Change-Id: Ic186f51240dbdd96ccab3f5470329cdc9727c618 Reviewed-on: https://chromium-review.googlesource.com/295730 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
gl::GetString check for a valid context  glGetString() without a current context could cause a null dereference for some enums. Always return nullptr when no context is bound.  BUG=angleproject:1106  Change-Id: Ic36f1adff8b2e3cd54a7b33b2e12899781feba82 Reviewed-on: https://chromium-review.googlesource.com/295142 Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Context: directly delete the resource instead of also detaching  Otherwise when detaching vertex array 0 and N the following would happen:  - call Context::deleteVertexArray(0)    - call Context::detachVertexArray(0)      - call State::removeVertexArrayBinding(0)        set mVertexArray to nullptr returns true      - call State::bindVertexArray(0)        reset mVertexArray to its previous value  - call Context::deleteVertexArray(n)    - call Context::detachVertexArray(n)      - call State::removeVertexArrayBinding(n)        Incorrectly call mVertexArray->id() which is a use after free.  BUG=angleproject:1137  Change-Id: I594044fee6c90b1775a61943b15df92bf323ff2a Reviewed-on: https://chromium-review.googlesource.com/295123 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add targets that run the EGL dEQP tests.  Generates lots of assertion failures when run expectations and assertion fixes to come.  BUG=angleproject:1139  Change-Id: Ia55b4b2ca3a7844d8d9d05cb7043cd42d55b86ed Reviewed-on: https://chromium-review.googlesource.com/295243 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement EGL_KHR_get_all_proc_addresses.  BUG=angleproject:1138  Change-Id: I0dd4e1a092e889cdb9de4773162e5416ac9be65d Reviewed-on: https://chromium-review.googlesource.com/295242 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Work around deprecated LUMA formats in the core profile.  Use R and RG textures with swizzle states to emulate them. A manual blit is required when calling CopyTex[Sub]Image from a RGB[A] framebuffer to an emulated L[A] texture so that the alpha channel ends up in the correct channel of the destination texture.  Fixes the following tests when using the core profile:  * conformance/extensions/oes-texture-float.html  * conformance/extensions/oes-texture-half-float.html  * conformance/textures/misc/tex-sub-image-2d.html  * conformance/textures/misc/texture-formats-test.html  * conformance/textures/misc/texture-npot.html  BUG=angleproject:1113  Change-Id: If5540e66d9017596bd83d95ec3ede043cbcfe0d2 Reviewed-on: https://chromium-review.googlesource.com/293905 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
VertexArrayGL: fix an off by one error for indexRange for drawElements  DrawElements' range was of the form [start end] while DrawArrays' was of the form [start end) which caused an out of bound array access in the client vertex pointers.  This issue was detected while running angle_end2end_tests with AddressSanitizer.  BUG=angleproject:1137  Change-Id: Id9abddf29eaf73bacfd08d1616a999be2fe616b8 Reviewed-on: https://chromium-review.googlesource.com/295122 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Remove dynamic indexing of matrices and vectors in HLSL  HLSL doesn't support dynamic indexing of matrices and vectors so replace that with helper functions that unroll dynamic indexing into switch/case and static indexing.  Both the indexed vector/matrix expression and the index may have side effects and these will be evaluated correctly. If necessary index expressions that have side effects will be written to a temporary variable that will replace the index.  Besides dEQP tests this change is tested by a WebGL 2 conformance test.  In the case that a dynamic index is out-of-range the base ESSL 3.00 spec allows undefined behavior. KHR_robust_buffer_access_behavior adds the requirement that program termination should not occur and that out-of-range reads must return either a value from the active program's memory or zero and out-of-range writes should only affect the active program's memory or do nothing. This patch clamps out-of-range indices so that either the first or last item of the matrix/vector is accessed.  The code is not transformed in case the it fits within the limited subset of ESSL 1.00 given in Appendix A of the spec. If the code isn't within the restricted subset even ESSL 1.00 shaders may require this workaround.  BUG=angleproject:1116 TEST=dEQP-GLES3.functional.shaders.indexing.* (all pass after change)      WebGL 2 conformance tests (glsl3/vector-dynamic-indexing.html)  Change-Id: I024722ef4ca1e14d5ad47fdc540397e18858bed6 Reviewed-on: https://chromium-review.googlesource.com/290515 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Make PackedVarying a D3D-only type.  The register assignment stuff only applies to the D3D back-end. Cleans up the GL back-ends use of PackedVarying and will lead to future cleanups relating to packing varyings.  BUG=angleproject:1123  Change-Id: Iaaa5fc03577e5b61ea6ae76ee1e15ad608037f34 Reviewed-on: https://chromium-review.googlesource.com/295190 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix debug build on Linux  Compiling an assert in Program.cpp was failing at least on GCC 4.8 because it compared unsigned size_t to zero a comparison that was always true. The C standard defines size_t as unsigned so the assert shouldn't be necessary on other platforms either.  There was already a commit on top of the patch that added the bug so it is simpler to fix the problem by changing the assert rather than reverting.  TEST=standalone debug build on Linux  Change-Id: Ifd910332a770f7360a15c31706beca740d0f289d Reviewed-on: https://chromium-review.googlesource.com/294971 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add deep copying support for typed AST nodes  Resubmit with inconsistent override warnings fixed.  Removing dynamic indexing of vectors and matrices will require copying the indexed nodes in case they are written. Any type of l-value node that doesn't have side effects may need to be copied. Add a copying function for all typed node classes so that this copying can be performed.  Private copy constructors are used to implement the deepCopy function in order to make maintenance easier. With copy constructors each subclass only needs to take care of copying its own members and not the base class members which reduces the possibility of errors. Copy constructors are disabled for all node classes that don't support deep copying by inheriting TIntermNode from angle::NonCopyable.  Assignment operator is disabled for all node classes through inheriting angle::NonCopyable. This applies also to classes that now get the private copy constructor.  Explicit copy constructor and assignment operator declarations are added to some classes which show up in node member variables to make code clearer.  BUG=angleproject:1116 TEST=angle_unittests  Change-Id: I7964976f5dac7dfd745b8c6612ca06fb01d271c4 Reviewed-on: https://chromium-review.googlesource.com/295080 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix two leaks and a delete vs delete[] reported by ASAN  BUG=angleproject:1137  Change-Id: Ic654b79aa56ae0c0a24097b85ab48f5af53ca1f7 Reviewed-on: https://chromium-review.googlesource.com/295154 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Surface: do not leak the default framebuffer  Due to the many merges and changes to 37c3979e47bf93958b426aaa31c1d65aef881b5f the default framebuffer deletion "disappeared". Add it back to the destructor of Surface.  Update Surface_unittests and remove one of the two tests as they were equivalent.  BUG=524495 BUG=angleproject:1137  Change-Id: I1309285ea00976ae2685628ea3f92731a9259718 Reviewed-on: https://chromium-review.googlesource.com/295153 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
VertexArrayGL: fix the streaming of offset non-packed strides  When the packed stride and source stride were different the streaming code path used a loop that added two times the offset for the start of the index range.  BUG=angleproject:1135  Change-Id: I6d314a1a28abec4df22f7c798c1af87a18d8b7ec Reviewed-on: https://chromium-review.googlesource.com/295225 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Make output variables part of Program's shared data.  Also initialize this structure within Program instead of DynamicHLSL. This should have benefits for other back-ends. Also these variables weren't being serialized and de-serialized with the program binary which could mess up WebGL apps that use MRT.  BUG=angleproject:1123  Change-Id: Ic0dd4840f26441a1bee8527dfa178b24daf82f8a Reviewed-on: https://chromium-review.googlesource.com/294571 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make the Program's semantic index D3D-only.  This concept isn't strictly necessary for GL-side validation. Instead we can use a bitset to track active attribs and determine is a particular location is active.  BUG=angleproject:1123  Change-Id: If7a920a3071672116bafffb3368671f721723b65 Reviewed-on: https://chromium-review.googlesource.com/294570 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Try Sleep(1) instead of Sleep(0) while waiting for queries.  On a loaded machine Sleep(0) can be very slow (40+ms) while Sleep(1) is consistantly 1-2ms.  BUG=488571  Change-Id: I71de0b4cfc334a2476b7c613c103e77fe759041d Reviewed-on: https://chromium-review.googlesource.com/273183 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Always collect variables when generating HLSL  HLSL output needs uniform information generated by the collectVariables() step to be able to write uniform registers.  Tested manually by compiling a shader with a uniform with shader_translator.  BUG=angleproject:1132  Change-Id: I91d19b5fa789b7b33cf76a654ffbbd17d279db01 Reviewed-on: https://chromium-review.googlesource.com/294962 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Support creating render targets of non-zero mip levels in TextureStorage9.  BUG=angleproject:970  Change-Id: I02caf1a5d15a8e32e68b63362e86e3a689dbdb5a Reviewed-on: https://chromium-review.googlesource.com/293221 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
When possible create RenderTarget9s from textures.  Unless the RenderTarget9 is backed by a texture it's not possible to sample from it.  This is required to sample from D3D9 renderbuffers when they are bound to texture targets.  BUG=angleproject:970  Change-Id: Id667a5e44c1f959609bc653a974ede5b93ec9a3e Reviewed-on: https://chromium-review.googlesource.com/293290 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Bind native GL attributes to match the locations in gl::Program.  Simplifies a lot of logic when we don't have to maintain mappings between the driver and gl-layer locations.  BUG=angleproject:882 BUG=angleproject:1123  Change-Id: Ia94257a322f768fdfa3167000a46a0715820ef4d Reviewed-on: https://chromium-review.googlesource.com/295231 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move TF Feedback linked varyings into D3D-only.  The LinkedVarying structure is a D3D-specific type and the GL back-end doesn't need the extra info. Isolate this into the D3D back-end so we can clean up the Impl inteface.  BUG=angleproject:1123  Change-Id: I76d77ac505876d865e3e02f47acbfd6665a9507e Reviewed-on: https://chromium-review.googlesource.com/293764 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Make the default framebuffer owned by Surface"  Compilation warning on Windows  This reverts commit 6cb2ae8292e69aa110c89e0465366b9f049c1168.  Change-Id: I4ecadf5d8e909f986da186a7326cfa0922ae8710 Reviewed-on: https://chromium-review.googlesource.com/294241 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Make the default framebuffer owned by Surface  Reland with a fix for SurfaceTest in angle_unittests and fixes for signed-unsigned warnings  In CGL there is no notion of default Framebuffer and MakeCurrent only makes a context current but not a drawable. Instead everything is done via render to texture. For that reason different surfaces will have different FBOs as default framebuffers which causes that change.  BUG=angleproject:891  Change-Id: Ie9a72de01a58e583a1bfa3f4a055debb860b912f Reviewed-on: https://chromium-review.googlesource.com/293713 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Clean up uniform block Program Impl APIs.  The D3D-specific code we can split into D3D-only methods and the GL-level shared code we can place in Program instead of making Impl methods. This cleans up the Impl inteface significantly.  BUG=angleproject:1123  Change-Id: Ibcb7d07733eb939adf5bb4f5395a661875a60238 Reviewed-on: https://chromium-review.googlesource.com/293763 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix improper error handling in Image11.  A device lost event would improperly skip returning an error which could lead us down a code path that would read/write to invalid locations.  BUG=519642  Change-Id: Iba437b9b24cdf44320a944a85146f5f73be9f7a6 Reviewed-on: https://chromium-review.googlesource.com/293903 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Clean up Program::linkUniforms.  This method previously relied on output from the D3D back-end from ProgramImpl::link. Split the D3D-specific code into its own method and do the linking validation before we call link.  BUG=angleproject:1123  Change-Id: I582671e21af605af9f4451b02fc96ad29c923048 Reviewed-on: https://chromium-review.googlesource.com/293762 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Work around deprecated LUMA formats in the core profile."  Caused failures in the WebglConformance.conformance_textures_misc_copy_tex_image_2d_formats test on the ATI FYI waterfall bot. This reverts commit 61f51dc1b7d383bcb3632218cd2434f65cac4b7a.  Change-Id: Iddea03d53ae2a9b639e36931f01c1e889e550af4 Reviewed-on: https://chromium-review.googlesource.com/294262 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix build after https://chromium-review.googlesource.com/#/c/293865  Change-Id: I691d80deff03b49463b08d093934b44b049a0606 Reviewed-on: https://chromium-review.googlesource.com/294163 Reviewed-by: Nico Weber <thakis@chromium.org> Tested-by: Nico Weber <thakis@chromium.org>, 23355681, 619, 169, 619
Rename TextureD3D::setImage() to setImageImpl().  This makes it clear that this is not an attempted override of the virtual base class's method rx::TextureImpl::setImage().  Do the same for TextureD3D::setCompressedImage(). No intended behavior change.  BUG=angleproject:1083  Change-Id: I874e4101e8138c7c5000f5966afed6a339523c02 Reviewed-on: https://chromium-review.googlesource.com/293865 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Nico Weber <thakis@chromium.org>, 23355681, 619, 169, 619
Fix warning C4312 (x64) - reinterpret_cast conversion to greater size  Change-Id: I90504b00e8f3af208511ec393ddfb0da267f56bc Reviewed-on: https://chromium-review.googlesource.com/293341 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Add target platform version for generating Windows 10 WinRT projects  BUG=angleproject:1122  Change-Id: Ia6a79ef1b4e94e15830981f0cee6269c9f0c71ca Reviewed-on: https://chromium-review.googlesource.com/293401 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
In TextureD3D_2D don't call Image::redefine directly.  Call the TextureD3D_2D::redefine member which will not make unnecessary modifications to the image and lets the member serve as a callback for redefined images.  BUG=angleproject:970  Change-Id: I511310ebfd4d6133219bbef82c53747f9454aee0 Reviewed-on: https://chromium-review.googlesource.com/293904 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "In TextureD3D_2D don't call Image::redefine directly."  Warnings in 64-bit.  This reverts commit a0633a7e4124473d67538053cba3ebdc44f71687.  Change-Id: I5b3f31b261b947cd295e9f4a9abbbdbc00740183 Reviewed-on: https://chromium-review.googlesource.com/293841 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
In TextureD3D_2D don't call Image::redefine directly.  Call the TextureD3D_2D::redefine member which will not make unnecessary modifications to the image and lets the member serve as a callback for redefined images.  BUG=angleproject:970  Change-Id: I280c18b993ef4dfac2efe1b28bf28c34aa4b6bcc Reviewed-on: https://chromium-review.googlesource.com/293222 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Work around deprecated LUMA formats in the core profile.  Use R and RG textures with swizzle states to emulate them.  Fixes the following tests when using the core profile:  * conformance/extensions/oes-texture-float.html  * conformance/extensions/oes-texture-half-float.html  * conformance/textures/misc/tex-sub-image-2d.html  * conformance/textures/misc/texture-formats-test.html  * conformance/textures/misc/texture-npot.html  * conformance/more/functions/copyTexImage2D.html  * conformance/more/functions/copyTexSubImage2D.html  BUG=angleproject:1113  Change-Id: Iaf4b7b2b0000052b1747f46d90ad45d4cb1f6b50 Reviewed-on: https://chromium-review.googlesource.com/293530 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make FramebufferAttachmentObject not refcountable  Re-land with a fix for an unitialized variable  Instead the refcount is done via callbacks. This allows Surface to ignore this refcounting which will be useful in a follow-up CL.  BUG=angleproject:891  Change-Id: I1925ccaa4ce7b502b33088660d31c404b8313cb5 Reviewed-on: https://chromium-review.googlesource.com/293712 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Make TF Feedback buffer mode a GL-level variable.  Don't query this as an Impl method since it exists on the GL level. Also some related refactorings and cleanups.  BUG=angleproject:1123  Change-Id: I3610bc0db2bcaa96408506e06a65a2f4dab93150 Reviewed-on: https://chromium-review.googlesource.com/293761 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a Program::Data shared state structure.  Similar to the Framebuffer and other classes this gives the Impl class a read-only view of the object's state.  BUG=angleproject:1123  Change-Id: I580eaebe2de236adf8131d6e3f54633cecce8c25 Reviewed-on: https://chromium-review.googlesource.com/293760 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Add full support for line continuation in the preprocessor"  Warning in the Linux/Mac builders:  In file included from ../../third_party/angle/src/tests/preprocessor_tests/input_test.cpp:7: In file included from ../../third_party/angle/src/tests/preprocessor_tests/PreprocessorTest.h:7: ../../testing/gtest/include/gtest/gtest.h:1392:16: error: comparison of integers of different signs: 'const int' and 'const unsigned long' [-Werror-Wsign-compare]   if (expected == actual) {       ~~~~~~~~ ^  ~~~~~~ ../../testing/gtest/include/gtest/gtest.h:1422:12: note: in instantiation of function template specialization 'testing::internal::CmpHelperEQ<int unsigned long>' requested here     return CmpHelperEQ(expected_expression actual_expression expected            ^ ../../third_party/angle/src/tests/preprocessor_tests/input_test.cpp:171:5: note: in instantiation of function template specialization 'testing::internal::EqHelper<false>::Compare<int unsigned long>' requested here     EXPECT_EQ(3 input.read(buf maxSize &lineNo));     ^  BUG=angleproject:1125  This reverts commit c1157d1963170c7411eb6c32e2b2fbce02c5a170.  Change-Id: Ic6fa286d190b006cccc5154d86e21ecc03175763 Reviewed-on: https://chromium-review.googlesource.com/294080 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add full support for line continuation in the preprocessor  Line continuation in ESSL 3.00 needs to be processed before tokenization since tokens can span the line continuation. On the other hand ANGLE's tokenizer keeps track of line numbers and whenever a line continuation appears the line number still needs to be incremented by one just like on a regular newline.  That's why line continuation is now implemented as follows: when the shader strings are concatenated in Input they are also checked for line continuation. Whenever line continuation is encountered the string is cut before that point. When the tokenizer asks for more input the string starting from the character after line continuation is passed to it and the line number is incremented from Input. This way the tokenizer can parse tokens that span multiple lines - it never sees the line continuation - but still keeps track of the line number correctly.  Relevant spec is in ESSL 3.00 section 3.2 "Source strings".  Support for line continuation also applies to ESSL 1.00. ESSL 3.00 spec section 1.5 says that line continuation support is mandated when an ESSL 1.00 shader is used with the OpenGL ES 3.0 API and is optional when ESSL 1.00 is used with the OpenGL ES 2.0 API.  TEST=dEQP-GLES3.functional.shaders.preprocessor.line_continuation.*      (all pass)      angle_unittests BUG=angleproject:1125  Change-Id: I1c1de49602e7cd755d6072c3c0aa5524cd0313b4 Reviewed-on: https://chromium-review.googlesource.com/293721 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Surface_unittest: fix a gmock warning  getSwapBehavior was being called in Surface's constructor but masn't expected causing a warning. Add it as an expect call.  BUG=angleproject:1126  Change-Id: Idf4a7e0ff66ba5741d3773e09ade4a1335b355ae Reviewed-on: https://chromium-review.googlesource.com/293902 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Revert "Implement dirty bits acceleration for VertexArrayGL.""  Should be fixed with the Iterator change.  BUG=angleproject:1040  This reverts commit 5b21ed5fd030d33ae379b8cc493746244d2928b4.  Change-Id: Ibb77775b6b2ce5a49cee7dd81efc62d8c3ba3c62 Reviewed-on: https://chromium-review.googlesource.com/293901 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Store iterator bitset by-value instead of by-reference.  The by-reference method was giving strange problems when using a non- LValue as argument to IterateBitSet.  BUG=angleproject:1040  Change-Id: Iec10f7256a5b19b239804e0beba4ae675f53f876 Reviewed-on: https://chromium-review.googlesource.com/293840 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Implement dirty bits acceleration for VertexArrayGL."  Seems to cause an exception in Release in end2end_tests.  BUG=angleproject:1040  This reverts commit 6d51c70ccf63a2c5ec240d960ff1bc179d36c92c.  Change-Id: I6548bc68dce07d2d85e40afdb604157e689c1d6c Reviewed-on: https://chromium-review.googlesource.com/293821 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement dirty bits acceleration for VertexArrayGL.  BUG=angleproject:1040 TEST=angle_end2end_testsangle_perftestsWebGL  Change-Id: I91d9aea5eefb58ecaf5b1cc95926fddb2aa846ea Reviewed-on: https://chromium-review.googlesource.com/289570 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix remaining size_t conversion warnings.  BUG=angleproject:1120  Change-Id: If4fba903511dcd57d21f8f8178e772cf3cae4187 Reviewed-on: https://chromium-review.googlesource.com/293750 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Reland "Fix memory layout of imageformats.h's 16-bit structs"  Changes since last patch: - Disable tests on D3D11 Intel  Change-Id: Ie65f56b7ed107f8901ea3be7d96036d7c882d189 Reviewed-on: https://chromium-review.googlesource.com/285218 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Roll GYP for Windows 10 project generation.  BUG=angleproject:1122  Change-Id: I8b7a33fb8e7d1200e655c73c7d1a5502cac955c6 Reviewed-on: https://chromium-review.googlesource.com/293335 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Cooper Partin <coopp@microsoft.com> Commit-Queue: Cooper Partin <coopp@microsoft.com>, 23355681, 619, 169, 619
Remove EOpInternalFunctionCall  It's cleaner to mark internal functions by using the TName class similarly to TIntermSymbol.  TEST=angle_unittests BUG=angleproject:1116  Change-Id: I12a03a3dea42b3fc571fa25a1b11d0161f24de72 Reviewed-on: https://chromium-review.googlesource.com/291621 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Track whether a name is internal to ANGLE in a separate class  The AST contains identifiers in a few different places: besides symbols there are also function names which show up in function signatures and function calls. Any of these can be coming either from the original shader or from inside ANGLE. A class that encapsulates a string and its internalness will be useful for implementing a unified way of handling all names in shader translation. Start implementing this by splitting the functionality out of TSymbol.  TEST=angle_unittests BUG=angleproject:1116  Change-Id: I0a1b5936dcccd0d5fc1c0c13c712102fbfff2a79 Reviewed-on: https://chromium-review.googlesource.com/291280 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix angle miscompiling shaders on x86_64 Android.  BUG=487341 Change-Id: I792e0c9419566facb0bec0ad93f3646294e5a2a7 Reviewed-on: https://chromium-review.googlesource.com/293500 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Nico Weber <thakis@chromium.org> Reviewed-by: Nico Weber <thakis@chromium.org>, 23355681, 619, 169, 619
Detect when built-in modf requires an l-value in AST traversal  This fixes an omission that out parameter tracking had inherited from EmulatePrecision. Accurate tracking of when values are written is required for converting dynamic indexing of vectors and matrices to function calls.  A new test covering this is added to angle_unittests.  TEST=angle_unittests BUG=angleproject:1116  Change-Id: I05c5fd60355117d0053b84110748ae221375a790 Reviewed-on: https://chromium-review.googlesource.com/290562 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Refactor l-value tracking to a separate traverser parent class  This makes TIntermTraverser implementation easier to understand and removes the overhead of maintaining the user-defined GLSL function table from the traversers that don't need it.  Some logic is duplicated between TIntermTraverser and its new subclass TLValueTrackingTraverser but duplication is hard to eliminate completely since there are some differences scattered throughout the code.  BUG=angleproject:1116 TEST=angle_unittests  Change-Id: Iab4a0c1d4320ecfafaf18ea3a45824d756890774 Reviewed-on: https://chromium-review.googlesource.com/292721 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Set __VERSION__ macro when the #version directive is parsed  __VERSION__ macro needs to be set to 300 when #version 300 es is on the first line of the shader since section 3.4 of ESSL 3.00.4 spec mentions that the value of __VERSION__ should match the shading language being parsed. The value from parsing the version directive replaces the default value 100.  BUG=angleproject:524 TEST=dEQP-GLES3.functional.shaders.preprocessor.predefined_macros.*      (4 tests start passing 2 still fail)      dEQP-GLES3.functional.shaders.preprocessor.conditionals.*      (2 tests start passing)      dEQP-GLES2.functional.shaders.preprocessor.predefined_macros.*      (no regression)  Change-Id: I15bfdeb73d1e343d131ded56b1fd52ca5ef32408 Reviewed-on: https://chromium-review.googlesource.com/293440 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "Add tests for streaming client side data."  This reverts commit 656b0d45cd4758be67202aded9783d536b00e611.  Change-Id: I0b6ad5e1fa788ffc698029410aa98e13a061902d Reviewed-on: https://chromium-review.googlesource.com/293450 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Generate the egl Display extensions in Renderer9 and Renderer11.  With the addition of EGL Image the display extensions generated by Renderer9 and Renderer11 become significantly different.  Instead of generating them via getXSupport() methods generate them inside the renderers themselves.  BUG=angleproject:970  Change-Id: Ib3fffabcca3e3cdef13ef994aa0b06dba0f00362 Reviewed-on: https://chromium-review.googlesource.com/293271 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a common base function for getSurfaceLevel in TextureStorage9.  Instead of casting to the specific TextureStorage9 type before calling getSurfaceLevel merge the prototypes into a pure method in TextureStorage9.  BUG=angleproject:970  Change-Id: I07b24b6cc470fc8cb6ba9bd9a8f178c3b43be36a Reviewed-on: https://chromium-review.googlesource.com/293270 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add tests for streaming client side data.  BUG=angleproject:880  Change-Id: Ief76f3011ce18ad0ca396af0bc36e69a30ae143b Reviewed-on: https://chromium-review.googlesource.com/293220 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Reland Fixed compiler warning C4267 'conversion from 'size_t' to 'type' possible loss of data' Additional warnings found with more testing and added C4267 warning disable only for angle_libpng  BUG=angleproject:1120  Change-Id: Ic403dcff5a8018056fa51a8c408e64207f3362eb Reviewed-on: https://chromium-review.googlesource.com/293028 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Disable some VS2015 warnings for dEQP projects  Change-Id: I036084b2fea20d4f1712bc34b161fb3be604af0d Reviewed-on: https://chromium-review.googlesource.com/293009 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Make FramebufferAttachmentObject not refcountable"  BUG=  This reverts commit 19ba57469aa02074d094a9aef104f84d0b6d881e.  Change-Id: I5dce6c8a81570e22affbcaf32183a97c97849718 Reviewed-on: https://chromium-review.googlesource.com/293351 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Make the default framebuffer owned by Surface"  This reverts commit 87e63a9982803b5e4c12afa9a40ff0e2b04a7369.  Speculative revert to fix the webgl cts on Windows D3D9 and the unittests on Linux.  BUG=  Change-Id: I488f4e0b2dc67270eed45f1c10bfba1d13c98739 Reviewed-on: https://chromium-review.googlesource.com/293350 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Make the default framebuffer owned by Surface  In CGL there is no notion of default Framebuffer and MakeCurrent only makes a context current but not a drawable. Instead everything is done via render to texture. For that reason different surfaces will have different FBOs as default framebuffers which causes that change.  BUG=angleproject:891  Change-Id: I3f6da7b587353316026ea39a5c87f91265e0f1ba Reviewed-on: https://chromium-review.googlesource.com/289872 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix warnings on Linux  BUG=  Change-Id: I24ed2a2ee85a152ef79fc9cb2c3b067bbbaedf05 Reviewed-on: https://chromium-review.googlesource.com/293310 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Make FramebufferAttachmentObject not refcountable  Instead the refcount is done via callbacks. This allows Surface to ignore this refcounting which will be useful in a follow-up CL.  BUG=angleproject:891  Change-Id: I39b028476e0e3ab1837c033e1121ea21e54d7970 Reviewed-on: https://chromium-review.googlesource.com/291651 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
ValidateDrawElements: check count > 0 then compute the index range  Otherwise glDrawElements(GL_TRIANGLES -1 nullptr) would crash. This was found by an ASSERT in ComputeIndexRange triggered by dEQP-GLES2.functional.negative_api.vertex_array.draw_elements  BUG=  Change-Id: I5269031fa35aa6403c844561e04158361ee7950f Reviewed-on: https://chromium-review.googlesource.com/292710 Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Fixed compiler warning C4267 'conversion from 'size_t' to 'type' possible loss of data'"  Seems to have quite a few warnings in 64-bit on my machine.  BUG=angleproject:1120  This reverts commit c5cf9bc47d0ee028adbbf9e9f94ca567eec601dc.  Change-Id: I86768b900aeba52e7a2242d9ae8949f93f1a5ba9 Reviewed-on: https://chromium-review.googlesource.com/293280 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
clang/win: Fix -Wunused-function warning in angle.  Also inline a function that wasn't pulling its weight. No intended behavior change.  BUG=chromium:505316  Change-Id: If059700062a38c45971397311af7a2a4037b815e Reviewed-on: https://chromium-review.googlesource.com/288399 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Nico Weber <thakis@chromium.org>, 23355681, 619, 169, 619
Use default commit.h file if git index is not available  The solution is the same as in GYP version: 1. Check if .git/index is available in angle directory. 2. Use generated commit.h file if git is available or copy the default file instead.  Change-Id: Ic3cedf6793c368070228a63c0eb270ca6fb47f81 Reviewed-on: https://chromium-review.googlesource.com/289391 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Tomasz Moniuszko <tmoniuszko@opera.com>, 23355681, 619, 169, 619
Clean up parseMatrixFields  Applying field selection directly on matrices is not mentioned in ESSL 1.00 or 3.00 specs. Remove erroneous code that generated odd error messages when a shader tried to apply certain kinds of field selection on a matrix.  BUG=angleproject:1118 TEST=angle_unittests dEQP-GLES3.functional.shaders.swizzles.*  Change-Id: I7bbf5d0cbaee3f21d20b830d904c0feef445dd78 Reviewed-on: https://chromium-review.googlesource.com/293190 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "Add pragma errors for malformed pragmas."  Since this commit was made dEQP tests were fixed to check that unrecognized pragma tokens only generate warnings not errors.  This applies to both ESSL1.00 and ESSL3.00 which specify this behavior in section 3.4 Preprocessor.  BUG=angleproject:989 TEST=dEQP-GLES2.functional.shaders.preprocessor.pragmas.*  This reverts commit d3c29f57aaeb451b149bbb9fd17b3f1f99101c52.  Change-Id: Ie4e0ec061fa3164d6f3872ac0016a063056ed110 Reviewed-on: https://chromium-review.googlesource.com/293181 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Reland of "Store the applied element array buffer as a binding pointer."  To be consistent with how we start vertex attributes. A null pointer indicates we're using the streaming buffer.  Will also aid the dirty state bits refactor.  The re-land fixes a crash with WebGL related to element array buffers.  BUG=angleproject:1040 TEST=WebGL CTS end2end_tests unittests  Change-Id: I9b82e06825bf95f0fc2b7c7427e1eb6dd257c1ee Reviewed-on: https://chromium-review.googlesource.com/290044 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fixed compiler warning C4267 'conversion from 'size_t' to 'type' possible loss of data'  BUG=angleproject:1120  Change-Id: I01ef10bea7f487c2b394d030c76628f38d2ea645 Reviewed-on: https://chromium-review.googlesource.com/292780 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move traverse functions under TIntermTraverser  This enables implementing specialized variants of TIntermTraverser. Intermediate subclasses of TIntermTraverser are expected to maintain contextual information in their traverse* functions which is then used by the visit* functions in the actual traversers.  This approach is better than adding a flag to TIntermTraverser since it will make the code cleaner and easier to understand.  Traverse() functions in TIntermNode subclasses are still kept around to redirect calls to TIntermTraverser traversal functions. This is less hacky than choosing the function with switch/case in TIntermTraverser would be and if new TIntermNode subclasses get added it's not as likely that adding the traversal support would be forgotten.  TEST=angle_unittests BUG=angleproject:1116  Change-Id: Ie6889be1d7e955518f13cd3390dce17871ba49b5 Reviewed-on: https://chromium-review.googlesource.com/292720 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix missing and incorrect ordering of FunctionsWGL member initialization.  BUG=angleproject:890  Change-Id: Id55d941a95cf38f825b9a52fc8043e0e129f7a82 Reviewed-on: https://chromium-review.googlesource.com/292631 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fixed compiler warning C4457 'declaration of 'node' hides function parameter'.  BUG=angleproject:1119  Change-Id: Ie3de5a776b5860b1ca502cee9e2b19c41cd3bfb2 Reviewed-on: https://chromium-review.googlesource.com/292051 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Cooper Partin <coopp@microsoft.com>, 23355681, 619, 169, 619
Fixed compiler warning C4456 'declaration of variable hides previous local declaration'.  BUG=angleproject:1119  Change-Id: I99572711ceeae94fb920d197c86e741945d3b60b Reviewed-on: https://chromium-review.googlesource.com/292279 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fixed compiler warning C4838 'conversion from size_t to LONG requires a narrowing conversion'.  BUG=angleproject:1119  Change-Id: I2c879193dc122e6c45d0462abc91f39f5d332506 Reviewed-on: https://chromium-review.googlesource.com/292156 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fixed compiler warning C4458 'declaration of variable hides class member'.  BUG=angleproject:1119  Change-Id: Ibc7cfdea72abe402cbfa1c10e0ada7576fa1cfa2 Reviewed-on: https://chromium-review.googlesource.com/292052 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement dirty bits acceleration for Current Values.  BUG=angleproject:1040 TEST=angle_end2end_testsangle_perftestsWebGL  Change-Id: If471cfb9676795d5cc985eea52ad7144d4544ed1 Reviewed-on: https://chromium-review.googlesource.com/289559 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D: Fix buffer overflow in VertexBuffer.cpp.  Under certain situations an integer overflow could lead to ANGLE writing to places where it shouldn't.  BUG=518206  Change-Id: I9217685daecb160a4072fbf79c26e5bee9f4621e Reviewed-on: https://chromium-review.googlesource.com/292391 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Reland of "D3D11: Fix draw perf regression with input layouts."  f8dd7b10 fixed unnecessary shader compiles but introduced a draw call perf regression. Fix the regression robustly by storing a minimal set of input layout elements/vertex attribute info but also handle the case where the vector sizes mismatch between a cached and new vertex layout.  Reland with fix for comparison warning.  BUG=510151  Change-Id: I578ddbb5b5bb12e7c1a901f23c7b5fcbd64b5d23 Reviewed-on: https://chromium-review.googlesource.com/292460 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix missing colon in codereview.settings.  BUG=504872  Change-Id: Ib69830a556fe06c111f41d78811c7115b0d8314c Reviewed-on: https://chromium-review.googlesource.com/292450 Tryjob-Request: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "D3D11: Fix draw perf regression with input layouts."  size_t comparison warning in Win32.  src\libangle\renderer\d3d\programd3d.cpp(2084) : warning C4018: '<' : signed/unsigned mismatch  BUG=510151 This reverts commit bf3f780c0a281cfe6192aa5635b02a01314f7fd3.  Change-Id: I5565b697ca29270375049f3e855437fa19157de9 Reviewed-on: https://chromium-review.googlesource.com/292331 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix draw perf regression with input layouts.  f8dd7b10 fixed unnecessary shader compiles but introduced a draw call perf regression. Fix the regression robustly by storing a minimal set of input layout elements/vertex attribute info but also handle the case where the vector sizes mismatch between a cached and new vertex layout.  BUG=510151  Change-Id: If5e9ea4a4c9edaa7a78c8daa44bbe7d9927dc4e4 Reviewed-on: https://chromium-review.googlesource.com/292390 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
libGLESv2.gypi move the link to X11 to libANGLE (vs. libGLESv2)  This fixes a bot compilation failure that started happening after unittest started using Display stuff that use X11. Because angle_unittests was linking against libANGLE and not libGLESv2 it didn't get linked to X11 which produced a link error.  BUG=  Change-Id: I8f1f0dbcb13bb7c9897f235b72c4d4896a7b8a6c Reviewed-on: https://chromium-review.googlesource.com/292380 Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Import new MurmurHash3 to fix g++ 4.9.2 errors  The code is from http://smhasher.googlecode.com/svn/trunk/ revision 152.  Fixes error: ../../src/third_party/murmurhash/MurmurHash3.cpp:57:41: error: inlining failed in call to always_inline uint32_t getblock(const uint32_t* int): function body can be overwritten at link time  FORCE_INLINE uint32_t getblock ( const uint32_t * p int i )  The error was previously fixed by adding a pragma to ignore the warning.  The problem the compiler is complaining is that the function is visible to outside of the compilation unit. This can be fixed by making the function inline (as in the new version of the MurmurHash3.cpp) or static.  Change-Id: I7a1262964489d72de8b4707ca2284363c8b46e20 Reviewed-on: https://chromium-review.googlesource.com/291620 Tested-by: Kimmo Kinnunen <kkinnunen@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Dongseong Hwang <dongseong.hwang@intel.com> Tested-by: Dongseong Hwang <dongseong.hwang@intel.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Track that indices of l-values are not required to be l-values  In an expression like a[ind]++ a[ind] is required to be an l-value but ind is not. Reset the l-value required flags before traversing the index of an indexing operation so that this is accurately tracked. After the index has been traversed the previous state of the l-value required flags is restored.  New tests are added to angle_unittests cover this functionality.  TEST=angle_unittests BUG=angleproject:1116  Change-Id: I8929ec01e85e672c83ef7d385e455b7df8682f4b Reviewed-on: https://chromium-review.googlesource.com/290561 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Track where l-values are required in AST traversal  This functionality is refactored out of EmulatePrecision to be a common feature of TIntermTraverser. This is done since tracking where l-values are required will be useful for other traversers. For example it will be needed for converting dynamic indexing of matrices and vectors to function calls. This change adds some overhead to all tree traversers but the overhead is expected to be small for typical shaders which don't contain too many user-defined functions.  BUG=angleproject:1116 TEST=angle_unittests  Change-Id: I54d34c2b5093ef028f2b24d854c11c0195dc1dbb Reviewed-on: https://chromium-review.googlesource.com/290514 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Use WGL_ARB_pixel_format to choose the pixel format when available.  BUG=angleproject:890  Change-Id: If10ea7e1cb670bb3cd6fdcf40344d1c1e0acd862 Reviewed-on: https://chromium-review.googlesource.com/291650 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement dirty bits for RendererGL's basic state.  BUG=angleproject:1040 TEST=angle_end2end_testsangle_perftestsWebGL  Change-Id: I72beaf7e178e042440337fbb8b9669638c5ad016 Reviewed-on: https://chromium-review.googlesource.com/289558 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update ANGLE's GPU test expectations code.  Pull over the more recent changes from Chromium which include the graphics API which we can use for specific API suppressions for the dEQP tests.  Also update the docs with detailed steps for updating from Chrome.  BUG=None  Change-Id: I0cb7d8268fbb2778c0160a58f1a10ef4a92c9c61 Reviewed-on: https://chromium-review.googlesource.com/287810 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement ES 23 parts of EXT_blend_func_extended for shader translation  Exposes gl_SecondaryFragColor glSecondaryFragData[] and gl_MaxDualSourceDrawBuffers to GLES SL 1.0.  Relaxes rules for undefined output locations for GLES SL 3.0 and exposes gl_MaxDualSourceDrawBuffers.  If the output GL context is GL ES 2.0 or 3.0: The emulation layer is expected to turn on EXT_blend_func_extended if the output GL context supports it.  If the output GL context is GL: The emulation layer is expected to turn on EXT_blend_func_extended if the output GL context supports ARB_blend_func_extended or if GL context is 3.2 or later.  If the source shader spec is GLES SL 2.0: The emulation layer is expected to inspect the shader compilation output variables upon linking. If output target is GL SL the emulation layer should bind color location 0 index 1 to "angle_SecondaryFragColor" if variable "gl_SecondaryFragColorEXT" is used. Alternatively emulation layer should bind "angle_SecondaryFragData" to locations 0123... all color index 1 if "gl_SecondaryFragData" array is used. (The caller can not bind the locations or specify output variables.)  If the source shader spec is GLES SL 3.0: The emulation layer is expected to do location auto-resolve of the the output variables that have undefined output locations that have not been bound by the caller. (The caller can not use gl_ built-ins so nothing to do with those.)  BUG=angleproject:1085 TEST=angle_unittest  Change-Id: I5cafe205b0c29478b0dcd24aa89a7b0000f5d046 Reviewed-on: https://chromium-review.googlesource.com/287580 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Kimmo Kinnunen <kkinnunen@nvidia.com>, 23355681, 619, 169, 619
Fix warnings caused by gmock on linux  When mocking functions gmock uses the keyword virtual instead of override and this conflicted with our usage of override for the destructor (there is a warning for using all one or the other).  BUG=  Change-Id: I9dd9204d5755dd3a588a32d438de3c1018ba07cd Reviewed-on: https://chromium-review.googlesource.com/291630 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
ANGLETest::SetUp: resize the window only if needed.  This avoids a flickering of the window at the start of every test.  Reland with a speculative fix for ViewportTest  BUG=angleproject:1105  Change-Id: I83e89881de5b6f58cfb3e14cbe324fd9547f2836 Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/288533 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
ViewportTest::SetUp set the scissor to the default value  Previously ViewportTest would rely on the scissor being set to the size of the window by default which is a fragile assumption as the scissor is set to the size of the window only on the first makeCurrent.  BUG=angleproject:1105  Change-Id: I088565c7032fe817eb5c48a5351cc678fe42b376 Reviewed-on: https://chromium-review.googlesource.com/291310 Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor input layout & vertex signatures.  Always size input layouts to gl::MAX_VERTEX_ATTRIBS and use '1' bits to signal where we have a GPU conversion. The simplification allows us to more cleanly match the vertex executable signatures and makes our default VertexExecutable hit much more often.  BUG=510151 TEST=angle_end2end_testsCanary WebGL manual testing with Chromium  Change-Id: I5009323c4e7e208e7a2595be46658c344517a4ff Reviewed-on: https://chromium-review.googlesource.com/290740 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement the egl and gl layers of EGL Image.  Add end2end tests and unittests.  BUG=angleproject:970  Change-Id: Ie8306971730a793f08dfd09ead1bfd6ff3e4623d Reviewed-on: https://chromium-review.googlesource.com/291260 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Implement the egl and gl layers of EGL Image."  This reverts commit 22a4f38c2ca9ca430b5f976fc7fc816d88918eba.  Change-Id: I07acbfe28d11675236de2ea7f6b050c25f80579a Reviewed-on: https://chromium-review.googlesource.com/290960 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Fix warnings on gcc builds in ImageTest.cpp."  This reverts commit 52ff4ac92ef5dfe77e14221726a0f0ab57dc57d5.  Change-Id: I11ec6e7e343dd6579f7aa13106facc65b05eb795 Reviewed-on: https://chromium-review.googlesource.com/290940 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix warnings on gcc builds in ImageTest.cpp.  BUG=angleproject:970  Change-Id: Ic7f451fb4c2378c7574ede7c513a5bb9d903c908 Reviewed-on: https://chromium-review.googlesource.com/290920 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement the egl and gl layers of EGL Image.  Add end2end tests and unittests.  BUG=angleproject:970  Change-Id: I13fc501b24c3f11bfedc810c1ff80fcf1318877c Reviewed-on: https://chromium-review.googlesource.com/287343 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Reland of "Add Iterable bitset class."  This helper allows us to quickly iterate state bits from the Impl/Renderer layers.  Re-land with no C++11 usage.  BUG=angleproject:1040 TEST=angle_unittests (Mac/Win/Linux)  Change-Id: I3b6d5beb2bcff7fa3d45c9220d7c026c64c45d2e Reviewed-on: https://chromium-review.googlesource.com/290153 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Make sure that the AST root is always a sequence node  This enables inserting helper functions as an AST transformation.  BUG=angleproject:1116 TEST=angle_unittests  Change-Id: I169d4d3a726d0e389cb3444fe9dfb4c6c5d80155 Reviewed-on: https://chromium-review.googlesource.com/290513 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
DisplayGLX: factor redundant getFBConfigAttribs  This is very tiny code cleanup and is a noop behavior change.  BUG=  Change-Id: Ib850ff88eafa0bd45bb389de1b74b1e9fe4c6d8b Reviewed-on: https://chromium-review.googlesource.com/290146 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
FramebufferGL: Add a member to know if we are the default FBO  On CGL the default framebuffer will have a name different than 0 and without this change it wouldn't get special-cased as on the other platforms. It is assumed that the default framebuffer will get initialized directly by the driver or other parts of the code.  BUG=angleproject:891  Change-Id: Ifbe4ada58f27ad9ddb5b43697c234cb17e7504f0 Reviewed-on: https://chromium-review.googlesource.com/290147 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add the tryserver properties to the codereview.settings file.  BUG=504872  Change-Id: I44b619f15e46cb3a6a3d95fd81c999d612d60184 Reviewed-on: https://chromium-review.googlesource.com/290090 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement ESSL 3.00 shader input/output variable type rules  ESSL 3.00 allows a wider variety of types of input/output variables than ESSL 1.00 but there are still specific restrictions on structs matrices and arrays.  Some of the checks need to be implemented twice: once for array syntax where the brackets are after the type and another time for array syntax where the brackets are after the variable name.  This requires fixes to constant folding unit tests which were previously incorrectly using matrix outputs in fragment shaders.  New unit tests are added for several of the rules introduced but some cases are also covered by dEQP.  TEST=angle_unittests dEQP-GLES.functional.shaders.linkage.varying.rules.* BUG=angleproject:1061  Change-Id: I655b054cfe56d376db775b96a2bb41b3ac5740b0 Reviewed-on: https://chromium-review.googlesource.com/285482 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Surface: query swapBehavior from the Impl  All the previously implemented surfaces used to preserve the content of the surface on a swap but this is no longer the case with CGL.  BUG=angleproject:891  Change-Id: I264c579bcbbd22b4eeb09e78aa95751d223694fc Reviewed-on: https://chromium-review.googlesource.com/289871 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D: Add timer histogram for D3DCompile.  BUG=516027  Change-Id: Ibbf45c863570581ea79e198604cd4c5cc1836620 Reviewed-on: https://chromium-review.googlesource.com/289996 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add scoped timer histogram helper macros.  These macros replace a lot of repeated timing code and mirror how Chromium operates.  BUG=516027  Change-Id: Ib03e35d0f3b8638b9b0e8785c397c8381f16b041 Reviewed-on: https://chromium-review.googlesource.com/289995 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Change the NSGL skeleton to be a CGL skeleton  The previous skeleton was name NSGL because it seemed the easier route to go however Chrome uses CGL internally which we want to match.  BUG=angleproject:891  Change-Id: I00eb597080c8b735545750dfcd6ad80dcea79300 Reviewed-on: https://chromium-review.googlesource.com/289870 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Add Iterable bitset class."  std::to_ullong is c++11 failing on Mac.  BUG=angleproject:1040  This reverts commit 37a9e71246e2a3343289267e5d7e123948924bd3.  Change-Id: I5cecd1fe95b889feffb556f67d082cec585256f4 Reviewed-on: https://chromium-review.googlesource.com/290211 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add Iterable bitset class.  This class allows us to quickly notify Impl/Renderer layers of which state changed.  BUG=angleproject:1040 TEST=angle_unittests (Mac/Win/Linux)  Change-Id: I2f27bc65b4f627a261e94e3e3b7095b169986cc6 Reviewed-on: https://chromium-review.googlesource.com/289557 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add trace event for D3DCompile.  Adds more profiling help for startup shader compiles in Chrome.  BUG=510151  Change-Id: I550b55b1280542d1eaab9ed6166387b663cafffe Reviewed-on: https://chromium-review.googlesource.com/290091 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add support for RESOURCE_MISC_SHARED_KEYEDMUTEX  Change-Id: I225f38b4616ac47e690dccbcb67074fedc571d61 Reviewed-on: https://chromium-review.googlesource.com/225642 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Log EGL initialize errors to the platform.  This will allow us to show more extended error info in about:gpu in Chromium.  BUG=angleproject:966 BUG=515229  Change-Id: I24c8f33ac3576395ff13dbf7f4664c649af18e33 Reviewed-on: https://chromium-review.googlesource.com/289590 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Store the applied element array buffer as a binding pointer."  This reverts commit 0018c85ea45090b5de61d4be1fbfbf96a3cde48b.  Change-Id: Ieab61c0a4cd1b24d606263e9bf2bae31ea2e8ac4 Reviewed-on: https://chromium-review.googlesource.com/289486 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Store the applied element array buffer as a binding pointer.  to be consistent with how we start vertex attributes. A null pointer indicates we're using the streaming buffer.  Will also aid the dirty state bits refactor.  BUG=angleproject:1040 TEST=WebGL CTS end2end_tests unittests  Change-Id: I7a9167282b60dbe0cbb9f0e5d9e3770890ffeb71 Reviewed-on: https://chromium-review.googlesource.com/284619 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Names of built-in functions cannot be redeclared as functions"  Causing failures in the WebGL1 test: conformance/glsl/misc/shader-with-non-reserved-words.html  This reverts commit b5f88853ea80ea112368bb15999b363db0e4c648.  Change-Id: I2105c8040057665abda00435e8c0ff8a83af3645 Reviewed-on: https://chromium-review.googlesource.com/289192 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix reference leak in Blit9.  BUG=angleproject:1111  Change-Id: I0c71b765e8589a7387f4fd40f9dc453ed06c05b9 Reviewed-on: https://chromium-review.googlesource.com/289591 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
dEQP-GLES2: Reland of "Skip flush/finish test on Windows."  This test is having flaky timeouts on the bots. Disable it for now. The re-land fixes the test syntax and ensures we will see any errors in test config as test failures on the bots.  BUG=angleproject:1107 TEST=angle_deqp_gles2_tests runs  Change-Id: Ia4fa8affb70e4474d8e43ff87ee86328aa47ebeb Reviewed-on: https://chromium-review.googlesource.com/289580 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix uniform array handling in ProgramGL.  Our validation wouldn't correctly handle single-element arrays because it was checking size > 1 instead of isArray().  This caused issues in ProgramGL on some drivers that optimized the array size (AMD) if some elements were unused.  BUG=angleproject:882  Change-Id: I417d13cd86380e2c6caa688f6398709a74692e21 Reviewed-on: https://chromium-review.googlesource.com/289201 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Names of built-in functions cannot be redeclared as functions  With ESSL 3.00 names of built-in functions cannot be redeclared as functions and therefore overloading or redefining builtin functions is an error. This is fixed by inserting unmangled built-ins into the symbol table and then checking if the new function declaration matches any of the built-in in symbol table.  BUG=angleproject:1066 TEST=angle_unittests(new: ParseESSLFunctionsTest) dEQP Tests dEQP-GLES3.functional.shaders.functions.invalid.overload_builtin_function* (2 tests started passing with this change)  Change-Id: I0e027e588664e604f29c130028178315c3e21631 Reviewed-on: https://chromium-review.googlesource.com/287801 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "dEQP-GLES2: Skip flush/finish test on Windows."  Incorrect syntax is making the bots skip all tests.  BUG=angleproject:1107  This reverts commit e8c8de2da7907579dd25273bbb422143586e79b1.  Change-Id: I4469b6b320f8754af576875128e4e3fb210c67b6 Reviewed-on: https://chromium-review.googlesource.com/289501 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove compiler_tests.gypi and preprocessor_tests.gypi.  These files were a relic of a previous structure we can safely remove them now that chrome uses angle_unittests.gypi.  BUG=None TEST=compiles standalone and with chromium  Change-Id: If9a09122f664b740099b4270f5acc5627fc5ac35 Reviewed-on: https://chromium-review.googlesource.com/289343 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix incorrect extension check.  BUG=angleproject:884  Change-Id: Ia201ac60e337fd45ef72cc254bcb36d333418613 Reviewed-on: https://chromium-review.googlesource.com/289333 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
EGLContextCompatibility: remove suppression  BUG=angleproject:1109  Change-Id: I551dbf79b98798f06fd5cbe1b005dc2410daaa6b Reviewed-on: https://chromium-review.googlesource.com/289274 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
DisplayGLX::generateConfigs filter by MS and Accum buffers  FBConfigs where missing some filtering that wasn't needed on NVIDIA: the multisample and accumulation buffers must be the same as the context's config otherwise glXMakeCurrent will fail. See FBConfigCompatibility.md for more details.  BUG=angleproject:1109  Change-Id: Ied3336f9f5227594b143c884c4546fd603238b47 Reviewed-on: https://chromium-review.googlesource.com/289273 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
X11Window::initialize remove a small code redundancy  BUG=  Change-Id: Id5f98332129b3cc854254187b494bf6a97921dbd Reviewed-on: https://chromium-review.googlesource.com/289272 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Centralize GL format workarounds.  Instead of trying to encapsulate the GL texture format workarounds into tables use functions that do manual checks for specific cases.  Simplifies the logic.  Fixes:  * conformance/extensions/ext-sRGB.html  * conformance/extensions/oes-texture-half-float.html  * conformance/extensions/oes-texture-half-float-with-canvas.html  * conformance/extensions/oes-texture-half-float-with-image.htm  * conformance/extensions/oes-texture-half-float-with-video.html  BUG=angleproject:884  Change-Id: Ifb719fff908680fddc7c53a544e2284a42a58356 Reviewed-on: https://chromium-review.googlesource.com/289082 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add DebuggingTips.md with a tip about using apitrace  BUG=angleproject:892  Change-Id: I0999b0d3b043d412c092350f7d20560cb8b87ff7 Reviewed-on: https://chromium-review.googlesource.com/287450 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Always use sized internal formats for textures in TextureGL.  On desktop GL using an internal format of GL_RGBA produces GL_RGBA8 textures even if format is set to GL_FLOAT.  Use sized internal formats whenever possible to ensure that the internal format of the texture is the expected format.  Work around issues with Intel and AMD drivers that always round up when writing to a 1-bit alpha framebuffer format.  Fixes:  * conformance/extensions/oes-texture-float-with-image-data.htm  * conformance/extensions/oes-texture-float-with-image.html  * conformance/extensions/oes-texture-float.html  * conformance/extensions/oes-texture-half-float-linear.html  * conformance/extensions/oes-texture-half-float-with-image-data.html  * conformance/extensions/oes-texture-half-float-with-image.html  * conformance/extensions/oes-texture-half-float.html  Reland of https://chromium-review.googlesource.com/#/c/288350/  BUG=angleproject:884  Change-Id: Ia2f9251d12dd3bbc7b6918d46e61623d0abedfac Reviewed-on: https://chromium-review.googlesource.com/288584 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add IndexBufferOffsetTest  This test that using glDrawElements with an offset and an index buffer works correctly with or without a static copy of the buffer in D3D.  BUG=510585  Change-Id: I4574a4058cc803e2ee0306e5bac52b6df6a71530 Reviewed-on: https://chromium-review.googlesource.com/288352 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
BufferD3D: reinit static data only when the usage is static  Previously once a dynamic buffer had an associated static data it would be considered as static and the static data would be always be reinitialized just after having been invalidated.  BUG=510585  Change-Id: I403e91d35d11efe17f52947b2182f7b8febd7922 Reviewed-on: https://chromium-review.googlesource.com/288351 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add stubs for RendererGL workarounds.  BUG=angleproject:884  Change-Id: I9e48803f6150b9d8cd70a36ab9197f78fd01a50f Reviewed-on: https://chromium-review.googlesource.com/288583 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Rename Workarounds to WorkaroundsD3D.  It is not referenced outside of the d3d classes.  BUG=angleproject:884  Change-Id: Ibeec034b1b78b569bea2f1c77d6a686b58b8e010 Reviewed-on: https://chromium-review.googlesource.com/288582 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
StateManagerGL: Use an array instead of map for FBOs.  The std::map became a significant bottleneck for draw calls.  BUG=angleproject:959  Change-Id: I28176d1474fe5cff05018f89878ea8b2a3e3f9f1 Reviewed-on: https://chromium-review.googlesource.com/288702 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
dEQP-GLES2: Skip flush/finish test on Windows.  This test is having flaky timeouts on the bots. Disable it for now.  BUG=angleproject:1107  Change-Id: Iaa15672fb96f4aa3463a0613980f8a941aeafe1f Reviewed-on: https://chromium-review.googlesource.com/288405 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
dEQP-GLES3: Mark dynamic_loop_struct_array_fragment as failing.  This test is failing on the bots.  BUG=angleproject:1108  Change-Id: Iaef3f0810c5d076b6c49bc356340c9bde014c4f5 Reviewed-on: https://chromium-review.googlesource.com/288518 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Always use sized internal formats for textures in TextureGL."  Causing failures on the Intel and AMD bot.  This reverts commit 8d8044f7e39839a5dfbf09553f77fd4325e64d4c.  Change-Id: I7dc6634eaf6f57ad84c315d74aa74d3ef2d4016f Reviewed-on: https://chromium-review.googlesource.com/288325 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Always use sized internal formats for textures in TextureGL.  On desktop GL using an internal format of GL_RGBA produces GL_RGBA8 textures even if format is set to GL_FLOAT.  Use sized internal formats whenever possible to ensure that the internal format of the texture is the expected format.  Fixes:  * conformance/extensions/oes-texture-float-with-image-data.htm  * conformance/extensions/oes-texture-float-with-image.html  * conformance/extensions/oes-texture-float.html  * conformance/extensions/oes-texture-half-float-linear.html  * conformance/extensions/oes-texture-half-float-with-image-data.html  * conformance/extensions/oes-texture-half-float-with-image.html  * conformance/extensions/oes-texture-half-float.html  BUG=angleproject:884  Change-Id: I48f220a4da518fff5831155a45c04cafcdffd33b Reviewed-on: https://chromium-review.googlesource.com/288350 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix a -Wswitch warning in ANGLE.  BUG=505308  Change-Id: I34ae3aa65ce55c4e04eecfef3c9cde9841e47140 Reviewed-on: https://chromium-review.googlesource.com/288245 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Daniel Cheng <dcheng@chromium.org>, 23355681, 619, 169, 619
Revert "Always use sized internal formats for textures in TextureGL."  Causing failures on the Intel and AMD bots which seem to have incorrect rounding for 1-bit alpha formats.  This reverts commit 0bcb68f32f5790b0c10913351259fdf4bfed0c28.  Change-Id: I00d333b5c10ba3f41d54bec95769f4baf07b0771 Reviewed-on: https://chromium-review.googlesource.com/288206 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Reformat style in ParseContext.cpp.  Using git cl format.  BUG=None  Change-Id: Ia0ce03ae8115f45c3bcc4b022acd7e3e88518062 Reviewed-on: https://chromium-review.googlesource.com/287833 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix use-after-delete in ParseContext.cpp.  This bug was exposed after a refactoring from the translator.  BUG=None TEST=angle_unittestsangle_end2end_tests  Change-Id: I13fddcbe84f87826068a557f139f6e35c674571e Reviewed-on: https://chromium-review.googlesource.com/287832 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Only check alpha values of 0 and 1.  Relying on the driver to round in one direction or the other is not reliable.  Change-Id: Ide96864607ee6a22d2523544d6cfe8fae3116fcd Reviewed-on: https://chromium-review.googlesource.com/288289 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Always use sized internal formats for textures in TextureGL.  On desktop GL using an internal format of GL_RGBA produces GL_RGBA8 textures even if format is set to GL_FLOAT.  Use sized internal formats whenever possible to ensure that the internal format of the texture is the expected format.  Fixes:  * conformance/extensions/oes-texture-float-with-image-data.htm  * conformance/extensions/oes-texture-float-with-image.html  * conformance/extensions/oes-texture-float.html  * conformance/extensions/oes-texture-half-float-linear.html  * conformance/extensions/oes-texture-half-float-with-image-data.html  * conformance/extensions/oes-texture-half-float-with-image.html  * conformance/extensions/oes-texture-half-float.html  BUG=angleproject:884  Change-Id: I227e782fe9aae7b2e66df67c7a4519cfc79890b9 Reviewed-on: https://chromium-review.googlesource.com/287529 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
IncompleteTextureTest: Remove the Linux/NVIDIA suppression  BUG=angleproject:892  Change-Id: Iae3d1a83ccc4a6d738a78b58c295e06bfc564767 Reviewed-on: https://chromium-review.googlesource.com/287676 Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
dEQP: Remove old test expectations file.  This is no longer needed by Chromium after we land the GLES3 expectations patch.  BUG=angleproject:1071 BUG=510822  Change-Id: I63c2b020838aae8771314c959e9e7eb994bed93f Reviewed-on: https://chromium-review.googlesource.com/287518 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Revert "ANGLETest::SetUp: resize the window only if needed."  Going to try reverting this as a potential fix to failures seen on the bots.  Can re-land in the morning if the failures don't clear up.  Failures seen on all windows bots now.  This reverts commit 15ca829680f81b26dfbcb59e9d53554cb1b29395.  Change-Id: Ic2904e00e8d53b2cc8939b36953f47f131c5e6c2 Reviewed-on: https://chromium-review.googlesource.com/287846 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Implement gl_FragDepth for GLES SL 3.0"  assertion failures in WebGL2 CTS.  This reverts commit 544809610a131fe7040f2212789c62e212bbaf24.  Change-Id: I2e0c7045c5b6ef9031a6e6c5916504fe68f51077 Reviewed-on: https://chromium-review.googlesource.com/287910 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Enable point sprites in StateManagerGL.  Test it against multiple versions of the OpenGL renderer so make sure that both core and compatibility profile are tested.  Fixes:  * conformance/rendering/point-size.html  * conformance/rendering/point-with-gl-pointcoord-in-fragment-shader.html  * PointSpritesTest  * particle_system sample  BUG=angleproject:883  Change-Id: I31f1c3d9bee1d191b4d731afbaa2d6de1a5c9454 Reviewed-on: https://chromium-review.googlesource.com/287855 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Enable point sprites in StateManagerGL."  Failures on AMD and Intel bots.  This reverts commit e1bb74e7305cee5ea92ecd2b3b3d2ecad1cdee32.  Change-Id: I8ae50bcf9ca365969f5231105fadc28f843aa527 Reviewed-on: https://chromium-review.googlesource.com/287854 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Enable more GL extensions.  Fixes:  * conformance/canvas/canvas-test.html  * conformance/canvas/draw-static-webgl-to-multiple-canvas-test.html  * conformance/canvas/to-data-url-test.html  * conformance/context/context-attribute-preserve-drawing-buffer.html  * conformance/context/premultiplyalpha-test.html  * conformance/extensions/oes-texture-float-with-canvas.html  * conformance/extensions/oes-texture-half-float-with-canvas.html  * conformance/textures/misc/gl-pixelstorei.html  * conformance/textures/misc/tex-image-canvas-corruption.html  Change-Id: Iab37a211c498ed0eece4c1748cf8b4ab6c0f53e0 Reviewed-on: https://chromium-review.googlesource.com/274444 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix compilation warning in ANGLETest  BUG=angleproject:1105  Change-Id: I5f5f0ebea4fa83cc03df932e60e5843ba380597b Reviewed-on: https://chromium-review.googlesource.com/287831 Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Enable point sprites in StateManagerGL.  Test it against multiple versions of the OpenGL renderer so make sure that both core and compatibility profile are tested.  Fixes:  * conformance/rendering/point-size.html  * conformance/rendering/point-with-gl-pointcoord-in-fragment-shader.html  * PointSpritesTest  * particle_system sample  BUG=angleproject:883  Change-Id: Ib7625cb12faeac21016a9ff551aa650ba24e789f Reviewed-on: https://chromium-review.googlesource.com/277692 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement gl_FragDepth for GLES SL 3.0  Makes it an error to access gl_FragDepthEXT  in #version 300 es shader.  TODO: Lacks the feature to make "#extension GL_EXT_frag_depth : require" an error for #version 300 es.  BUG=angleproject:1102 TEST=angle_unittest  Change-Id: Ic313a0e1ed6369550d53885290f300fab1aaf304 Reviewed-on: https://chromium-review.googlesource.com/287570 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ANGLETest::SetUp: resize the window only if needed.  This avoids a flickering of the window at the start of every test.  BUG=angleproject:1105  Change-Id: Ib277ad5cfef97e00d27408f8feaa8ccba9a5e032 Reviewed-on: https://chromium-review.googlesource.com/287640 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
EGLWindow: remove the unused width and height  EGLWindow does nothing with it per se but some code was relying on it to store it. Add width and height to ANGLETest and SampleApplication instead. Also fix a typo in PerfTestParams widowWidth -> windowWidth.  BUG=angleproject:1105  Change-Id: I26da607a2e6342864b508a50ee3cf8944608f868 Reviewed-on: https://chromium-review.googlesource.com/287379 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Expose GL built-in output variables in ShGetOutputVariables  Expose GL built-in output variables in ShGetOutputVariables. Currently gl_FragColor gl_FragData and gl_FragDepthEXT are exposed.  The output variable names in the returned array are the input shader names not the output shader names.  This is needed in future features in which the emulation layer (command buffer/libANGLE) needs to know which output variables caller used.  Example of such a feature is EXT_blend_func_extended where gl_SecondaryFragColorEXT and gl_SecondaryFragDataEXT cause the need to bind the emulated output variables to their respective color indices.  BUG=angleproject:1085 TEST=angle_unittests  Change-Id: I7ca3e0fe6bdd3e3c66113518aa771cbb013fc014 Reviewed-on: https://chromium-review.googlesource.com/287230 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Kimmo Kinnunen <kkinnunen@nvidia.com>, 23355681, 619, 169, 619
IndexDataManager: always add the offset when streaming  When the static buffer has just been invalidated we stream from the buffer directly for some time. This streaming forgot to offset the starting point causing a bug.  BUG=510585  Change-Id: I8321e462841eb0bd7ed97ab78197914cbdb68c55 Reviewed-on: https://chromium-review.googlesource.com/287525 Reviewed-by: Hendrik Wagenaar <hendrikw@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
dEQP: Update dEQP-GLES3 test expectations.  Tests are all green on my local Nvidia configuration.  BUG=510822 BUG=angleproject:1071  Change-Id: I56d30089d574e795cfbd012ce7430896856d32ee Reviewed-on: https://chromium-review.googlesource.com/287517 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add a GLES3 GoogleTest target.  BUG=510822 BUG=angleproject:1071  Change-Id: Ia2e6d0ac71e61dbed75e55994d2bf874a75fabd6 Reviewed-on: https://chromium-review.googlesource.com/286831 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make sure the given display is a valid pointer.  EGL functions are supposed to return EGL_BAD_DISPLAY when the display is an invalid pointer.  Since there is very rarely more than one simultaneous display iterating through the map is not costly.  BUG=angleproject:970  Change-Id: I3d9b842a49c5c99f9b8fad3d7ef53f9f5d3057ba Reviewed-on: https://chromium-review.googlesource.com/287342 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Print outputs when printing variables in shader translator  Print outputs when printing variables in shader translator.  BUG=angleproject:1085  Change-Id: I67e301c4392fef70e6a186d404aff720b601a08d Reviewed-on: https://chromium-review.googlesource.com/287214 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add ability to select GLSL output type to shader translator  User can pass -x=g130 ... -x=g450 to get output in specific GLSL version. Passing -x=g selects GLSL compatiblity profile.  BUG=angleproject:1085  Change-Id: Ia680e219eacb0e8a53b711ae277ecebf069dfdc7 Reviewed-on: https://chromium-review.googlesource.com/287220 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Kimmo Kinnunen <kkinnunen@nvidia.com> Commit-Queue: Kimmo Kinnunen <kkinnunen@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add skeleton for DisplayNSGL and WindowSurfaceNSGL  BUG=angleproject:891  Change-Id: Ie79e76c68775e1144ac224a4f1eba85f8a889269 Reviewed-on: https://chromium-review.googlesource.com/286829 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add stubs for EGL image entry points and validation.  BUG=angleproject:970  Change-Id: Ic3b9f9f60146920571e0e5f00fac2273c35fff2f Reviewed-on: https://chromium-review.googlesource.com/287162 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
ES3: Fix off-by-one max enabled attrib.  In some cases we would have a 'max enabled' attrib that was checked incorrectly and this could lead to edge cases which crash when we have a vertex attribute and buffer both NULL.  BUG=angleproject:1081 TEST=dEQP-GLES3.functional.lifetime.attach.deleted_input.buffer_vertex_array  Change-Id: I62a9fa79f38340c99a708e54751d2b67dd4b6c1f Reviewed-on: https://chromium-review.googlesource.com/286854 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ES3: Fix crash when binding nullptr to DEPTH_STENCIL.  In some cases binding nullptr could query for the internal format of the null object causing us to dereference null and crash.  BUG=angleproject:1080 TEST=dEQP-GLES3.functional.multisample.fbo_*  Change-Id: I592ab31dc1efadfac003c39051632fc2a0fff0cc Reviewed-on: https://chromium-review.googlesource.com/286853 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ES3: Fix assertion failure in validation edge case.  Passing a 2D texture type to a 3D texture function could result in an explosion.  BUG=angleproject:1079 TEST=dEQP-GLES3.functional.negative_api.texture.compressedteximage3d  Change-Id: Ibfcc4bdb334270f8fa27ebed6bcc3911986e7c7c Reviewed-on: https://chromium-review.googlesource.com/286852 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix buffer alignment math in draw validation.  We had a bug where we would require "stride * primCount" bytes when drawing from a buffer when the last element would not require the full stride. The correct expression: "stride * (primCount-1) + size.  BUG=angleproject:1086 TEST=dEQP-GLES3.functional.vertex_arrays.single_attribute.strides.*  Change-Id: I7e2897c9d18b0e9849289d033f0ae2573237e4e5 Reviewed-on: https://chromium-review.googlesource.com/287320 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add helpers for checking EGL extension availablity in tests.  Also make sure that EGL_EGLEXT_PROTOTYPES is always defined so that extension functions can be used without loading them.  BUG=angleproject:970  Change-Id: I33fa3e8ed68aeda55ad69e1bc7826646f5e3ce29 Reviewed-on: https://chromium-review.googlesource.com/287161 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add angle_gl_library_type to allow making static libGLESv2 and libEGL  With this commit angle programs can be run under apitrace: when we use shared libraries the apitrace driver shim shadows ANGLE and redirects the GL calls to the driver which is not what we want.  BUG=angleproject:892  Change-Id: I32535ba8db6202b0b5b285e86abd472366ee3d03 Reviewed-on: https://chromium-review.googlesource.com/287270 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
ANGLETest: set viewport after resizing to help apitrace  Otherwise apitrace doesn't know the dimension of the framebuffer and cannot display it.  BUG=angleproject:892  Change-Id: Ib8ad846ca80e4783ab77c96430bb5220df1a39ab Reviewed-on: https://chromium-review.googlesource.com/286881 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Emulate the pack/unpack functions for unorms."  Causing MSAN failures on Linux.  This reverts commit 1915652ee82109d7756dc8349562c3c11ea39b77.  Change-Id: Ib23bec16eab22288930be0b41186e54cd8d1f921 Reviewed-on: https://chromium-review.googlesource.com/287127 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add an angle_link_glx that can be used for debugging  This replaces the dlsyming of glX entry point with linking to libGL which in trun allows the ANGLE to be traced using apitrace.  Re-land with a trivial compilation fix (MEMBER vs MEMEBER)  BUG=angleproject:892  Change-Id: Ie89b6fe26eb80d3d8d48f49645d7a6254230bf5c Reviewed-on: https://chromium-review.googlesource.com/287143 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
dEQP: Duplicate/rename gles2 test expectations.  This will clear the way to put the GLES3 tests on the bots.  BUG=angleproject:1071 BUG=510822  Change-Id: I65fc917425531f6c080bcc862802d25af10cf265 Reviewed-on: https://chromium-review.googlesource.com/287164 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Revert "Add an angle_link_glx that can be used for debugging"  This reverts commit cddca5f204d9aa55c9810cf30c74997ca19a7f86.  Change-Id: I07fa96a8b84308c77fb642a64f39fcacc471d96e Reviewed-on: https://chromium-review.googlesource.com/287123 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add an angle_link_glx that can be used for debugging  This replaces the dlsyming of glX entry point with linking to libGL which in trun allows the ANGLE to be traced using apitrace.  BUG=angleproject:892  Change-Id: Ic065582401e0e1e3fce1329cde216220a1e086a8 Reviewed-on: https://chromium-review.googlesource.com/286880 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix missing uint cases for GLSL and ESSL output.  These were causing assertions in several WebGL2 conformance tests.  BUG=angleproject:882 BUG=angleproject:1084 BUG=483282  Change-Id: I7651c359a528c95469dcbfb5da2715ae4616b49b Reviewed-on: https://chromium-review.googlesource.com/286592 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Initialize all members in the default TType constructor.  This is an attempt to fix use-of-uninitialized-value errors. Example failure: https://build.chromium.org/p/tryserver.chromium.linux/builders/linux_chromium_msan_rel_ng/builds/68/steps/cc_unittests%20%28with%20patch%29/logs/EnlargedTextureWithAlphaThresholdFilter.GL  BUG=angleproject:1044  Change-Id: I5906c67a55da553e2e5fd15320a5dd4186644e87 Reviewed-on: https://chromium-review.googlesource.com/287191 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make all fragment shader out variables require location layout qualifier  Make all fragment shader out variables require location layout qualifier. Previously the last variable did not need a location layout qualifier if the previous variables had those.  TEST=angle_unittests BUG=angleproject:1070  Change-Id: Ifb66ee52b811409f5278eaad330d6cd9b8ea059f Reviewed-on: https://chromium-review.googlesource.com/287100 Tested-by: Kimmo Kinnunen <kkinnunen@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Always try to load the extension entry points.  Despite many extensions being written against specific versions of the GL spec some drivers (Intel) expose the extensions in much earlier versions.  This leads to issues where the extension string would be present but the entry points were not loaded.  BUG=angleproject:1038  Change-Id: Ia87bb3f038f310f6bc3e711a0b2d82717b67ae70 Reviewed-on: https://chromium-review.googlesource.com/286525 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
When the GL version is below 3.0 use GL_MAX_VARYING_FLOATS.  It should be equivalent to GL_MAX_VARYING_COMPONENTS for ES2.  BUG=angleproject:1038  Change-Id: Ic2fe6c27a0ebd6259d70f8d28edb7d4bdd5d0c35 Reviewed-on: https://chromium-review.googlesource.com/286526 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a profile mask member to the FunctionsGL structure.  BUG=angleproject:883  Change-Id: I3cdf88391e77a26a77e120de0fd32296a2b079d1 Reviewed-on: https://chromium-review.googlesource.com/286822 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update ContributingCode to mention 'git cl format'.  BUG=angleproject:762  Change-Id: Ic0f862ac901eb793266e68ce26cc9be67d5cb12d Reviewed-on: https://chromium-review.googlesource.com/286862 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D: No-op ClearBufferfi calls with no DS attachments.  The ES3 spec is clear that these calls should no-op see page 187  "If a buffer is not present then a Clear directed at that buffer has no effect."  BUG=angleproject:1078 TEST=dEQP-GLES3.functional.fbo.msaa.2_samples.*  Change-Id: Ic521f55785d10065e2ffe2e98a68c9d7da0c2c71 Reviewed-on: https://chromium-review.googlesource.com/286776 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Make all fragment shader out variables require location layout qualifier"  Causes a warning on Windows:  compiler\translator\ValidateOutputs.cpp(37): warning C4804: '>' : unsafe use of type 'bool' in operation  BUG=angleproject:1070  This reverts commit 140941d066c11238ba4f2f15647fb2d65ae56faf.  Change-Id: Ieed42cdda22f17c6e15c38ee1c059184869e6919 Reviewed-on: https://chromium-review.googlesource.com/286820 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make all fragment shader out variables require location layout qualifier  Make all fragment shader out variables require location layout qualifier. Previously the last variable did not need a location layout qualifier if the previous variables had those.  TEST=angle_unittests BUG=angleproject:1070  Change-Id: I3763b8ca38b1e14ee8456a54592c01e0fd89692c Reviewed-on: https://chromium-review.googlesource.com/286101 Tested-by: Kimmo Kinnunen <kkinnunen@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Add clang-format integration for 'git cl format'.  This will allow us to eventually make a presubmit script for ANGLE and also will help new contributors who aren't as familiar with the style guide.  One outstanding issue is the lack of proper breaking before array initializers. We don't use arrays all over the place but this will likely require a patch for clang.  BUG=angleproject:762  Change-Id: I4702b1fcdfa10b7682b07316be59ec67bcf84943 Reviewed-on: https://chromium-review.googlesource.com/285901 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ES3-D3D11: Fix UBO vertex caching.  There was a typo in the vertex shader cache which could trigger an overflow bug.  TEST=dEQP-GLES3.functional.ubo.random.scalar_types.* BUG=angleproject:1077  Change-Id: I5652cf9675155b627f84531e09c01b42e29278fc Reviewed-on: https://chromium-review.googlesource.com/286775 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix regression with R32I blits.  The blit refactoring mislabeled one shader as GL_RED instead of GL_RED_INTEGER.  BUG=angleproject:1076 TEST= dEQP-GLES3.functional.fbo.render.shared_depth_stencil.*  Change-Id: I262b218c72d955a88a2d2c00b470d6a4f3568451 Reviewed-on: https://chromium-review.googlesource.com/286774 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
ES3: Add some missing unsized formats to the format tables.  These were causing validation errors in the dEQP FBO tests. See Table 3.2 in the ES3 spec.  BUG=angleproject:1074 TEST=dEQP-GLES3.functional.fbo.completeness.renderable.texture.color0.*  Change-Id: Ifbf9199c54060eb3fc1a1dac7bbd74e19e013c61 Reviewed-on: https://chromium-review.googlesource.com/286773 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Fix mapBufferRange not invalidating static data.  This was causing several dEQP tests with index data to fail.  BUG=angleproject:1073 TEST=dEQP-GLES3.functional.buffer.map.read_write.render_as_index_array.*  Change-Id: Ic231a561202fbcda499b7584905b80252a7407de Reviewed-on: https://chromium-review.googlesource.com/286772 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
HLSL: Fix uniform packing for non-square matrices.  We were neglecting to transpose the types here so were getting incorrect registers counts for rows and columns.  BUG=angleproject:1072 TEST=dEQP-GLES3.functional.shaders.matrix.*  Change-Id: Ia0ab89bbba8b9e2d8f39e84ef4e8ad3c03bb118d Reviewed-on: https://chromium-review.googlesource.com/286771 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Use texture format not SRV format for mip gen test.  Using the SRV format could lead to using R32F for D32F formats which is incorrect.  BUG=angleproject:1075 TEST=dEQP-GLES3.functional.fbo.blit.*  Change-Id: Ic81d51b888897a7f7c79e2ba1a24ab69f18d981c Reviewed-on: https://chromium-review.googlesource.com/286770 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use the type cache for the types used in the emulated GLSL functions.  BUG=angleproject:1044  Change-Id: I7c4bde80448b2cd64921b809a3a0dfb37c4e0f47 Reviewed-on: https://chromium-review.googlesource.com/286643 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix order of Renderer11 initializer list.  BUG=angleproject:916  Change-Id: I5be7460b737095eedb886be3e8978765c0940757 Reviewed-on: https://chromium-review.googlesource.com/286784 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Compiler: avoid an undefined behavior when using erase-remove  Using that idiom on an empty vector results in an undefined behavior that I have seen cause a vector to get length -1 with clang 3.6 on Linux.  BUG=  Change-Id: I3bb8d8884efa29a17672b458263067644dbf0fec Reviewed-on: https://chromium-review.googlesource.com/286740 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Remove GetAttachmentSerial.  Cascades to remove serials from many objects.  BUG=angleproject:970  Change-Id: I0a74a14519da3203cd5df7ae0fa19f83393951ce Reviewed-on: https://chromium-review.googlesource.com/286554 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Handle non-zero base level with mipmapping disabled in D3D9.  BUG=angleproject:970  Change-Id: I33120ec8121dc1265360fbbe61103e03e593af3f Reviewed-on: https://chromium-review.googlesource.com/286550 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add mocks of TextureImpl and RenderbufferImpl.  BUG=angleproject:970  Change-Id: I63a7d8363f90018827c5d8482c9d98f3fa61c573 Reviewed-on: https://chromium-review.googlesource.com/286553 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove RenderbufferImpl.cpp  BUG=angleproject:970  Change-Id: I1606df42e6423fe84d3ab69029a37224adb89a9b Reviewed-on: https://chromium-review.googlesource.com/286552 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a RefCountObject::getRefCount method for testing.  BUG=angleproject:970  Change-Id: I4fae29766ee76512375872535dbaf2d31a379de0 Reviewed-on: https://chromium-review.googlesource.com/286551 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Emulate the pack/unpack functions for unorms.  BUG=angleproject:1044  Change-Id: I0e7bee366398159ae6b87a820f36cb51c05cb064 Reviewed-on: https://chromium-review.googlesource.com/280362 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update WebGL test expectations.  Change-Id: I24ea67f354191697d8a577c8b21ccc1689dd3536 Reviewed-on: https://chromium-review.googlesource.com/286016 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
X11Window::resize wait for the window to be resized before returning  This will help address a bug in glReadPixels performed after a resize.  BUG=angleproject:1050  Change-Id: Ie204dec229582ec0e990c6f7fa22cfd44048d46e Reviewed-on: https://chromium-review.googlesource.com/286250 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
WindowSurfaceGLX: swap after resizing the child window.  This reverts ac2582d3aac25f2a5c504af146ca614761fc3f7e which was a speculative improvement. It turns out that resizing before the swap is important as it lets the driver know that it should resize the default framebuffer making the following frame have a default framebuffer of the right size.  BUG=angleproject:1050 BUG=angleproject:892  Change-Id: I84ec3728226fde9fb208f91c02a3d5a1ab71aef8 Reviewed-on: https://chromium-review.googlesource.com/286252 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
WindowSurfaceGLX: Do not send an unused border_pixel to XCreateWindow  This was a typo that never had any effect but it could cause problems in Debug but in release border_pixel could have contain garbage and cause an X11 error.  BUG=angleproject:892  Change-Id: Id6dc24c726730d998b419101239b3a43d6675330 Reviewed-on: https://chromium-review.googlesource.com/286251 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
ANGLETest: swap after resizing the window before running the test.  This allows the test code to assume that the framebuffer size is equal to the window size.  BUG=angleproject:1050  Change-Id: Ia4928d7a1d6cddb1ae330846bb44576db6a37533 Reviewed-on: https://chromium-review.googlesource.com/286253 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Renderer11: expose a metric for the Buffer11 CPU copies size  This will allow us to measure the impact of subsequent optimizations on the memory consumption of Chrome.  BUG=angleproject:916  Change-Id: Ib57fdfcc2950917eff33080bfb3db574595ecb6d Reviewed-on: https://chromium-review.googlesource.com/284637 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Move function prototypes and declarations out of the .y  This will make the code easier to edit and maintain.  BUG=none TEST=angle_unittestsangle_end2end_tests  Change-Id: I955307d1209170fa99142103bc4d361c9eab1cc8 Reviewed-on: https://chromium-review.googlesource.com/286145 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Only sync attributes used by the current program in RendererGL.  Improves draw call overhead of RendererGL.  DrawCallPerf_gl: Before: 136973 score After: 153317 score Improvement: 11.932%  BUG=angleproject:959  Change-Id: Ib75f6fdd756648e4a07f6e970cda03abbdbcf009 Reviewed-on: https://chromium-review.googlesource.com/275409 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Inline comparison operators of several small ANGLE structs.  Improves draw call overhead of RendererGL.  DrawCallPerf_gl: Before: 129779 score After: 136973 score Improvement: 5.543%  No noticeable difference in DLL size or draw call perf of the D3D renderers.  BUG=angleproject:959  Change-Id: Id54d49e9e2cfb69431ee26d632c58fee2c42b82c Reviewed-on: https://chromium-review.googlesource.com/275408 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use a map to store uniform locations instead of a vector.  Some intel drivers use seemingly arbitrary integers as uniform locations. This causes the location vector to be resized to arbitrarily large sizes.  BUG=angleproject:882  Change-Id: I8db89178907dd6206eb8e646a0b426aa9bac0832 Reviewed-on: https://chromium-review.googlesource.com/274816 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
EGLWindow: correctly retrieve mAlphaBits  BUG=angleproject:1065  Change-Id: I1e396d1bd4d1c65edc3ad07bb32f895135d59474 Reviewed-on: https://chromium-review.googlesource.com/285180 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement OSXWindow.  BUG=angleproject:891  Change-Id: If8aefa4a37ba7d1b6b08921bee61463bb20550af Reviewed-on: https://chromium-review.googlesource.com/285834 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
X11Window: Add missing handling of Keypad's '5' key.  BUG=angleproject:891  Change-Id: Icb0dc3449db6982979a93a394fb9e0c58413a256 Reviewed-on: https://chromium-review.googlesource.com/285836 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
OSWindow: small fix to the formatting of key event debugging  BUG=  Change-Id: I09ab785311ec0fa7f3eecb6484a965378a1fef0d Reviewed-on: https://chromium-review.googlesource.com/285835 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix 2D array texture redefinition.  Only happens with texture formats that require initialization.  BUG=angleproject:1069 TEST=dEQP-GLES3.functional.texture.format.sized.2d_array.* all pass  Change-Id: I215d1262cddcde4ed218b6f023e67747cbc3eeaf Reviewed-on: https://chromium-review.googlesource.com/285347 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@google.com>, 23355681, 619, 169, 619
Centralize renderer limitations for non-conformant renderers  Some renderer configurations (e.g. D3D11 Feature Level 9_3) have some limitations and aren't quite conformant. This change generates errors when applications hit these limitations and informs developers that they must work around them.  BUG=angleproject:1055  Change-Id: I6a4a9e5cc71288ca366a54c769ca0eb82e79a7f7 Reviewed-on: https://chromium-review.googlesource.com/282814 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Futher optimize input layout cache.  *re-land with fix for matrix attributes* *re-re-land with fix for attributes with BindAttribLocation*  Using the new vertex format type enum we can shrink the size of the input layout tables and reduce draw call overhead further.  BUG=angleproject:959  Change-Id: I181acd3d7d519f5587cbe180fb1bca8530b7cfc2 Reviewed-on: https://chromium-review.googlesource.com/285348 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Apply array restriction on qualified types only on ESSL1.00  Add a test that checks that uniforms with an array type are allowed in ESSL3.00.  TEST=angle_unittests BUG=angleproject:1061  Change-Id: I6c9e8eeb3e8a6b81522c87039b93bcc0008ae317 Reviewed-on: https://chromium-review.googlesource.com/285481 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix texture formats that only require extensions failing requirements checks.  Unset version requirements equate to UINT_MAX causing requirements checks for fail for formats that only need extensions such as DXT formats.  Fixes tests that require compressed formats.  Passes conformance/extensions/webgl-compressed-texture-s3tc.html  BUG=angleproject:884  Change-Id: Id810c477a359bf9d35a886c60735a91b51d1e931 Reviewed-on: https://chromium-review.googlesource.com/275693 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "D3D11: Futher optimize input layout cache."  Causing assertion failures in WebGL CTS in debug. Example build: https://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Debug%20%28NVIDIA%29/builds/10215  This reverts commit 2ee580f10052c03a3a0e8c535bd7da82147133c3.  Change-Id: Idffcd848adb6898f77b3c758b214eb31ca1f6e05 Reviewed-on: https://chromium-review.googlesource.com/285326 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Check that layout qualifiers may only appear in declarations  In the shading language grammar layout qualifiers may appear in loop conditions and function declarations but this is not valid ESSL 3.00 according to section 4.3.8.  TEST=angle_unittests dEQP-GLES3.functional.shaders.*layout* BUG=angleproject:1064  Change-Id: I73f805247bf6678b953f2e1d45a23391e9eacb96 Reviewed-on: https://chromium-review.googlesource.com/285040 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Revert "Fix memory layout of imageformats.h's 16-bit structs"  Seeing failures in the new tests on Chrome's Intel bot: http://build.chromium.org/p/chromium.gpu.fyi/waterfall?builder=Win7%20Release%20(Intel)   Also seeing failures in the BlendMinMaxTest.RGBA16F test may be related.  Reverting for now can help diagnose the problems tomorrow if needed.  This reverts commit 61d46d8740f1f93878ef324e11e4d72c57de8c3a.  Change-Id: Id227f6ce8dafca24fbd2de92a2c4974e6a564c1f Reviewed-on: https://chromium-review.googlesource.com/285227 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix more links and incorrect newlines in markdown files.  Change-Id: I3c96b0408d80be0f47c968566301637f49fe98c6 Reviewed-on: https://chromium-review.googlesource.com/285224 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix more inconsistancies with the gitiles markdown renderer.  Change-Id: Ie960cc00f136d86e5e3702a8f2e2f0f1930a5f47 Reviewed-on: https://chromium-review.googlesource.com/285230 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix markdown parsing issues from gitiles.  Change-Id: I2d62f410075385a87106f0c94ac1ff7cdd110655 Reviewed-on: https://chromium-review.googlesource.com/285185 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move the most popular wiki articles into markdown files.  Change-Id: Ide6ef3d9995d1f3f66de4b340a60b4bf350a9ddb Reviewed-on: https://chromium-review.googlesource.com/275479 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Handle the remaining pixel unpack parameters in TextureGL.  BUG=angleproject:884  Change-Id: I9e248e623f3b342f878bf65c9686768b90cf5ed8 Reviewed-on: https://chromium-review.googlesource.com/275692 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Sync pixel pack state before glReadPixels in FramebufferGL.  Fixes conformance/reading/read-pixels-pack-alignment.html  BUG=angleproject:885  Change-Id: I48f1598d9a67f3980d2ff86307eb107ec7506776 Reviewed-on: https://chromium-review.googlesource.com/275691 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add missing GL_STENCIL_INDEX8 format to the formatutilsgl table.  Fixes conformance/renderbuffers/framebuffer-object-attachment.html  BUG=angleproject:884  Change-Id: I421b563fa8549eb2edc42a9ac1c798fc457256ee Reviewed-on: https://chromium-review.googlesource.com/275690 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
LineLoopTest: Fix the test not rendering anything.  BUG=angleproject:1063  Change-Id: Id0772b5c8479150a1e736aa7cd35ec6444753278 Reviewed-on: https://chromium-review.googlesource.com/285126 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix memory layout of imageformats.h's 16-bit structs  Change-Id: I87c363f68394d868d2a72e84bfdfd64db0c6e1d0 Reviewed-on: https://chromium-review.googlesource.com/284652 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
D3D11: Futher optimize input layout cache.  *re-land with fix for matrix attributes*  Using the new vertex format type enum we can shrink the size of the input layout tables and reduce draw call overhead further.  BUG=angleproject:959  Change-Id: I6d8ad78a003c41f40e7e1caa5972838f8ff4fce8 Reviewed-on: https://chromium-review.googlesource.com/284811 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Changed d3d11 desktop renderer to use d3d9 debug annotation interfaces.  The D3D11 renderer must choose the D3D9 debug annotator because the D3D11 interface method ID3DUserDefinedAnnotation::GetStatus on desktop builds doesn't work with the Graphics Diagnostics tools in Visual Studio 2013. The D3D9 annotator works properly for both D3D11 and D3D9. Incorrect status reporting can cause ANGLE to log unnecessary debug events.  Change-Id: I9a31c63cbc506904eb39577826fc4df8d503f03a Reviewed-on: https://chromium-review.googlesource.com/278162 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Cooper Partin <coopp@microsoft.com> Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
After a create-on-bind the subsequent glGen* should not waste handle space.  Consider this calling sequence: glBindTexture(GL_TEXTURE_2D 3); // create-on-bind glGenTextures(1 tex);  Before this fix mUnallocatedList in HandleAllocator is in reverse sorted order. It's split into (4 MAX_UINT) and (1 3). The glGen gets tex = 4 and handles 1 and 2 will not be allocated until it reaches MAX_UINT. With this fix the elements in mUnallocatedList is in sorted order (1 3) and (4 MAX_UINT). So tex is 1 and we can have all rest handles.  Change-Id: If408ea92f7c243791119fe386e3e0ea27954e55c Reviewed-on: https://chromium-review.googlesource.com/273886 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Minmin Gong <mgong@microsoft.com>, 23355681, 619, 169, 619
Lazily load the HLSL compiler DLL.  If the user is loading resources straight from the disk with the binary shader cache they shouldn't need to load the compiler DLL at all. Note: might be a good idea to track more statistics here.  BUG=angleproject:1014  Change-Id: Ie75dcce3eb249347c545f1bbca7d0977df7addee Reviewed-on: https://chromium-review.googlesource.com/282554 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Check that block instance name isn't reserved  BUG=angleproject:1060 TEST=dEQP-GLES3.functional.shaders.uniform_block.invalid.*  Change-Id: I6de3aa0f714d585e7821798744530f3e51ddee7f Reviewed-on: https://chromium-review.googlesource.com/284259 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
EGLContextCompatibility: suppress test on Linux non-standalone  The tests turn out to fail before we have a context current on AMD so we cannot use isAMD and have to resort to disabling for all Linuxes on the FYI bots. Using MAYBE like Chrome doesn't seem to work with TEST_P.  BUG=angleproject:892  Change-Id: Ibabd2c359ce55c7677af0f8bd5723f845935f2be Reviewed-on: https://chromium-review.googlesource.com/284872 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/284749, 23355681, 619, 169, 619
Revert "EGLContextCompatibility: suppress test on Linux non-standalone"  Causing gyp generation failures on FYI bots: https://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Win%20Builder/builds/30490  This reverts commit af98f24aece19c3231d9e7300bbab5c323109b23.  Change-Id: I0b3ea26ee02591588bda14676211658b42135cf2 Reviewed-on: https://chromium-review.googlesource.com/284910 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
EGLContextCompatibility: suppress test on Linux non-standalone  The tests turn out to fail before we have a context current on AMD so we cannot use isAMD and have to resort to disabling for all Linuxes on the FYI bots. Using MAYBE like Chrome doesn't seem to work with TEST_P.  BUG=angleproject:892  Change-Id: Ie964168eb0b1d830dd1fd0988869adf39bc2309a Reviewed-on: https://chromium-review.googlesource.com/284872 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Cache TTypes.  *re-land with build fix for Win/Release*  This change saves us ~70KiB per compiler with just ~3KiB of cache.  BUG=492725  Change-Id: I4382c55b2480f70b00c5d117fcb7e0c51d0dfbb4 Reviewed-on: https://chromium-review.googlesource.com/284735 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Dmitry Skiba <dskiba@google.com> Reviewed-by: Alexis Htu <sugoi@chromium.org>, 23355681, 619, 169, 619
Revert "Cache TTypes."  Unused variable warning in Release:  warning C4189: 'MaxEnumValue' : local variable is initialized but not referenced  I'll handle fixing this.  BUG=492725 This reverts commit b25d14e4b39ee273fad3bb585c3a3a929b3f794c.  Change-Id: I502fc5288d5d3c48ecd43f84acdf66b7e300ad22 Reviewed-on: https://chromium-review.googlesource.com/284863 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
egl::MakeCurrent: report platform's makeCurrent errors  This caused the context to be current from ANGLE's point of view while it wasn't from the driver's point of view.  BUG=angleproject:892  Change-Id: I0719b4702721916e9eb3a9f4cafc7a86dbc7a625 Reviewed-on: https://chromium-review.googlesource.com/284871 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
clang/win: Fix -Wunused-private-field warnings in debug builds.  No intended behavior change.  BUG=505317 Change-Id: I5dfa1d67715b18133f3373ca00a6d1d96b678043 Reviewed-on: https://chromium-review.googlesource.com/284850 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Nico Weber <thakis@chromium.org>, 23355681, 619, 169, 619
Added non square matrix construction  Added new construction operations for non square matrices along with the required changes to the related translation functions.  Change-Id: I04ae7d4b2d1bb363b35d088cea45c0e7c4bc8a13 Reviewed-on: https://chromium-review.googlesource.com/277729 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Added winrt project generation to gclient sync  BUG=angleproject:1057  Change-Id: Ic52c385cb19f6ddccaf3d46a88a56670da0cf67d Reviewed-on: https://chromium-review.googlesource.com/283987 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Cache TTypes.  This change saves us ~70KiB per compiler with just ~3KiB of cache.  BUG=492725  Change-Id: I7b8053c032c9c68f646162baf61abf6db3afe52e Reviewed-on: https://chromium-review.googlesource.com/284003 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Share data between VertexArray and Impl.  Using the same design as for the Framebuffer::Data helper we can use a struct to share between the object and the Impl. This also gives the Impl access to the maxEnabledAttrib and saves some duplicated storage.  BUG=angleproject:1040 TEST=WebGL CTS end2end_tests unittests  Change-Id: I55c91e8a5f3dcae302cab441182320aafd5375ef Reviewed-on: https://chromium-review.googlesource.com/283930 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "D3D11: Futher optimize input layout cache."  This seems to have broken some dEQP tests in debug build possibly uncovering a previously undetected bug.  TEST=dEQP-GLES3.functional.shaders.linkage.varying.basic_types.*  This reverts commit d2328a5246d8e0ab8a3dde1b30b80ce5e161e6f3.  Change-Id: I9f082d7a6fca38b4c076fecc342ac40d5416ebef Reviewed-on: https://chromium-review.googlesource.com/284780 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Matrix layout qualifiers are valid for non-matrices  Uniform block members may be structs containing matrices and there's no explicit mention in the spec that the matrix qualifiers would only be valid for matrix fields. Only generate a warning when an extraneous matrix layout qualifier is used.  TEST=dEQP-GLES3.functional.shaders.*layout* (all pass with this patch) BUG=angleproject:1058  Change-Id: Ifb2f2392d84100d997cc2d68fd55e9ad17a17cea Reviewed-on: https://chromium-review.googlesource.com/284112 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
clang/win: Fix a -Wreorder warning  ..\..\third_party\angle\src\libANGLE\renderer\d3d\d3d11\SwapChain11.cpp(307) : error: field 'mDepthStencilRenderTarget' will be initialized after field 'mPassThroughResourcesInit' [-Werror-Wreorder]       mDepthStencilRenderTarget(this renderer true)       ^  While here also reorder the fields that are initialized in the constructor to match the order the fields are declared in to make it easier to see if any are missing.  No intended behavior change.  BUG=505304  Change-Id: If48195c84161868d33d4361088d3ad22b7a0fc31 Reviewed-on: https://chromium-review.googlesource.com/284682 Reviewed-by: Nico Weber <thakis@chromium.org> Tested-by: Nico Weber <thakis@chromium.org>, 23355681, 619, 169, 619
Suppress dEQP failure only showing on the bot.  Unsure why this is failing:  functional.shaders.struct.local.dynamic_loop_struct_array_fragment  BUG=angleproject:1059  Change-Id: I72e05269f831769a763c44354b95a7224edb72fa Reviewed-on: https://chromium-review.googlesource.com/284636 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Futher optimize input layout cache.  Using the new vertex format type enum we can shrink the size of the input layout tables and reduce draw call overhead further.  BUG=angleproject:959  Change-Id: Iea595fa64edbbd91f669138dfdeb9d2543b83929 Reviewed-on: https://chromium-review.googlesource.com/277291 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Refactor vertex format tables.  Use switch statements based on the format type enum instead of a map from the old VertexFormat structure to the info payload. This saves on lookup and initialization time.  BUG=angleproject:959  Change-Id: I6d1bf282c88f67272ca067cb64bc71e77824a12e Reviewed-on: https://chromium-review.googlesource.com/277290 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add isolate for ANGLE on all platforms.  This will be included in isolates for targets which really need it; initially angle_end2end_tests.  BUG=angleproject:892  Change-Id: I466455b0cc50a70980ddc09a6db2211f13774abc Reviewed-on: https://chromium-review.googlesource.com/284361 Tested-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Antoine Labour <piman@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Disallow texture lookup functions in global initializers  Do this by simply disallowing all function calls in global initializers - all built-in math ops are handled as other ops not function calls.  This change was tested extensively with popular WebGL content with no regressions found.  TEST=angle_unittests BUG=angleproject:988  Change-Id: Id1107fa294ae4012d5dd3949539d0b7b4cd21943 Reviewed-on: https://chromium-review.googlesource.com/283703 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Make Buffer11::mBuffersStorages an array instead of a map  BUG=angleproject:516  Change-Id: I7f969435a89c0063b504628d2ec3321cc02df7ce Reviewed-on: https://chromium-review.googlesource.com/283243 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
D3D11: map index buffers only when needed.  Before this patch index buffers where always mapped in case we needed the index data for the indexed point sprites workaround. This patch makes it so the index buffer is only mapped in this case when we need to stream index data or when we need to fill the static copies of the index buffers.  This make the memory usage of http://alteredqualia.com/xg/examples/mammoth.html go down from 41MB to 28MB.  BUG=angleproject:516  Change-Id: I937506d06fd6f074ef2120469dbd235e20245fca Reviewed-on: https://chromium-review.googlesource.com/283626 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Calculate TFunction::mangledName lazily.  This saves us ~15KiB per compiler instance on 32-bit Android.  BUG=492725  Change-Id: I9db2998482941b5ab2eb5cb4925cbd1fb58ab4be Reviewed-on: https://chromium-review.googlesource.com/283584 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix build on Windows.  WindowTest.cpp was missing <algorithm> for std::min and std::max.  BUG=angleproject:892  Change-Id: I9bf6e7b8e66cd4ffc34ee639f495b469dabde91a Reviewed-on: https://chromium-review.googlesource.com/284590 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Support constant folding of fragment processing built-ins  This change adds constant folding support for following derivative functions:     - dFdx dFdy and fwidth. As per spec derivatives of constant arguments should be 0 so this change just sets result components to zero when the above operations are performed on constant argument.  BUG=angleproject:913 TEST=dEQP Tests dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions. fragment_processing.* (All 12 tests started passing with this change.)  Change-Id: I67b7c5abd970b740e15e3bd1ee56721e81bbecc4 Reviewed-on: https://chromium-review.googlesource.com/283759 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Support constant folding of more common built-ins  This change adds const folding support for below mentioned common built-ins:     - isnan ininf floatBitsToInt floatBitsToUint       intBitsToFloat and uintBitsToFloat  BUG=angleproject:913 TEST=angle_unittests(new: MathUtilTest.isNan/inInf) dEQP Tests dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.common.* (20 more tests started passing with this change)  Change-Id: Ifdedb251cd8b183b4999314c0f5de857bc20702f Reviewed-on: https://chromium-review.googlesource.com/283767 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix typo in Buffer11::getContantBufferRangeStorage  BUG=angleproject:516  Change-Id: I907ec41ce5691300d17ca5b08a62b0d4579b01e5 Reviewed-on: https://chromium-review.googlesource.com/283244 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Simplify the flow of IndexDataManager::prepareIndexData  This will simplify the work on follow up CLs a lot  BUG=angleproject:516  Change-Id: Ie8374ec28fce2e01e76c711a4d280e1ed004a21f Reviewed-on: https://chromium-review.googlesource.com/283380 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
OSWindow: add KeyEvent debugging  BUG=angleproject:892  Change-Id: I35288ff43fb7a50a327047eacb8f41ca91e2b441 Reviewed-on: https://chromium-review.googlesource.com/283471 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add a WindowTest sample to test OSWindow manually  This will help port OSWindow to other platforms.  BUG=angleproject:892  Change-Id: If9884d310d80421e2fc09cffd03bcf01327b1eee Reviewed-on: https://chromium-review.googlesource.com/283900 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
EGLContextCompatibilityTest: check for suppression only when a context is bound.  Otherwise glGetString(GL_RENDERER) returns "ANGLE" and doesn't provide information on the vendor.  BUG=angleproject:892  Change-Id: I01899ca78656aaa8db860829c78bf3c61c355eae Reviewed-on: https://chromium-review.googlesource.com/284051 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Refactor how we store vertex formats.  Instead of storing a vertex format as a struct with the full info instead use an enum and look up the info when we need it. This saves a lot of constructor initialization time operator comparison time and storage. It also will allow us to look up D3D format info more quickly.  BUG=angleproject:959  Change-Id: I202fd1ea96981073bc1b5b232b1ec3efa91485cb Reviewed-on: https://chromium-review.googlesource.com/277289 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix the InputLayoutCache test on Windows 8.  On some configs this would use an RGBA4 16-bit backbuffer which is not enough resolution for the test. Fix this by requiring 32-bit backbuffers. We might also want to figure out if we want to default to 16-bit on Windows 8 desktop which seems less than ideal.  BUG=angleproject:959  Change-Id: I53b3a9ef6cbecf76c7c764623e5eb1f454a6b72d Reviewed-on: https://chromium-review.googlesource.com/283773 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Austin Kinross <austin.kinross@gmail.com> Reviewed-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix another clang warning with -Wmissing-braces in ANGLE.  Clang warns if there are missing braces around a subobject initializer. The most common idiom that triggers this is: STRUCT s = {0}; which can be more simply written as: STRUCT s = {};  BUG=505297  Change-Id: Ie9f9037a1ba4b6303daa30424cdc24c1ecf18896 Reviewed-on: https://chromium-review.googlesource.com/284160 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor unary operation constant folding code  This change splits TIntermConstantUnion::foldUnary into two functions:     - foldUnaryWithDifferentReturnType:         - Handles constant folding of operations where the return           type has a different number of components compared to the           operand type.     - foldUnaryWithSameReturnType:         - Handles constant folding of unary operations where the           return type is the same as operand type.  BUG=angleproject:913 TEST=angle_unittests dEQP Tests (dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.*)  Change-Id: I675891138d4e17fd2390c03e9f710e0be0b7c7b6 Reviewed-on: https://chromium-review.googlesource.com/283464 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Constant fold float pack/unpack functions  This change adds constant folding support for following floating point pack and unpack functions:     - packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16       packHalf2x16 and unpackHalf2x16.  BUG=angleproject:913 TEST=angle_unittests(new: MathUtilTest.packAndUnpack*) dEQP Tests dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.float_pack_unpack.* (all 10 tests started passing with this change)  Change-Id: I2b69faebee4127e5e13900b3a9485b7145950277 Reviewed-on: https://chromium-review.googlesource.com/282683 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disable using globals as l-values in global initializers  It should not be possible to use globals as l-values in global initializers.  This change was tested extensively with popular WebGL content with no regressions found.  TEST=angle_unittests BUG=angleproject:988  Change-Id: I21ab731eb1d92aeae25795856ccae280792ad1f0 Reviewed-on: https://chromium-review.googlesource.com/283910 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Suppress angle_end2end_tests failures on Linux/NVIDIA and Linux/AMD.  Verified the NVIDIA suppression locally; assuming the AMD suppression will take effect on the bot. Thanks to geofflang@ and cwallez@ for the suggestion on the approach to take.  BUG=angleproject:892  Change-Id: Ida4b6c1395185b0dfb0ea890395e35cb6db7ccd5 Reviewed-on: https://chromium-review.googlesource.com/283974 Tested-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Cache TTypes."  Lots of compile errors.  BUG=492725  This reverts commit 5377720aae042c5bfae0e8a37032c90dc3ab78cf.  Change-Id: I64889b99b1f1f48d39b87ebb668f6a32a3abac45 Reviewed-on: https://chromium-review.googlesource.com/283945 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
EGLSurfaceTest: run d3d specific tests only on d3d.  This is to help with the FYI bot and pending a refactor to use our test instantiation.  BUG=angleproject:892  Change-Id: I56e772d7988a2172ad2384bdf408a8eaeab7129a Reviewed-on: https://chromium-review.googlesource.com/283971 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Cooper Partin <coopp@microsoft.com> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Cache TTypes.  This change saves us ~70KiB per compiler with just ~3KiB of cache.  BUG=492725  Change-Id: I2ee748f7271b1afe0834083cbff6f0b84104aa53 Reviewed-on: https://chromium-review.googlesource.com/281411 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Dmitry Skiba <dskiba@google.com>, 23355681, 619, 169, 619
Include libEGL.so and libGLESv2.so in ANGLE-based isolates on Linux.  Fixes problem where the glBlitFramebufferANGLE symbol couldn't be found because Mesa's libGLESv2.so was being picked up.  BUG=angleproject:892  Change-Id: Ia3c55bd8eb3f078350adf4cc504bbbed6d97cb0b Reviewed-on: https://chromium-review.googlesource.com/283950 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
X11Window: handle key presses and releases  BUG=angleproject:892  Change-Id: I66690ba49789faa672f6ed58e9eb8a2482eb4f6d Reviewed-on: https://chromium-review.googlesource.com/283472 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
For WinRT add EGLRenderSurfaceScaleProperty to specify swapchain scaling factor  Change-Id: Iede6682306082346cf2a3a55fe58f732b7a453df Reviewed-on: https://chromium-review.googlesource.com/277931 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disallow user-defined function calls in global variable init  Generate an error message when an user-defined function call is found in a global variable initializer.  Even before this patch the call graph already marked functions that were only called from the global scope as unused.  This change was tested extensively with popular WebGL content with no regressions found.  TEST=angle_unittests BUG=angleproject:988  Change-Id: Iec1b16d2af386f1e5c383f86926d80cef553b694 Reviewed-on: https://chromium-review.googlesource.com/283291 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Lazily load SwapChain11 pass-through resources.  This allows Chromium to avoid initializing a whole bunch of resources and a shader when it collects GPU information. This should speed up startup.  BUG=angleproject:1014  Change-Id: Id1e777c6ea86d66ad812540f9d8494744cda64de Reviewed-on: https://chromium-review.googlesource.com/282553 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Load Clear11 resources lazily.  Again this saves on startup time and memory use.  BUG=angleproject:1014  Change-Id: I3890dc2ea50ff4e4f1ff9d7cb223e1ab57c330ce Reviewed-on: https://chromium-review.googlesource.com/282552 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add LazyInputLayout to defer loading input layouts.  Lazily loading input layouts can also save memory and startup time. There are several cases where we don't need these resources until later or sometimes at all.  BUG=angleproject:1014  Change-Id: I4e0d45353b5d3969bd1ed86ad26f47d34e542ed5 Reviewed-on: https://chromium-review.googlesource.com/282551 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
D3D11: Refactor InputLayout cache.  *re-land with fix for cache overflowing*  Using a much more compact input layout structure allows us to save quite a bit of time comparing input layouts or computing hashes. A subsequent patch shrinks the size of the structure further.  BUG=angleproject:959  Change-Id: If240bb7c84d78fc8c9fb6f9049bf71d8a81c97c6 Reviewed-on: https://chromium-review.googlesource.com/283227 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update dEQP test expectations with Linux failures  BUG=angleproject:1051  Change-Id: I5f397e230f0e56b1e6832c3dae5ae5c0c9a8b7c4 Reviewed-on: https://chromium-review.googlesource.com/283226 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix warnings with code analysis tools.  Variable shadowing and a few other non-bug warnings.  BUG=None  Change-Id: Ibf62d6e7fef91fc213a53a6902f494147ed30ebc Reviewed-on: https://chromium-review.googlesource.com/283223 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move Float16ToFloat32 implementation to common  Float16ToFloat32 is now required by constant folding of float pack/unpack built-ins as well moving it to commom so that it is available in libangle_common instead of libANGLE.  BUG=angleproject:913 TEST=angle_unittests  Change-Id: I1e23bb98c1b725c79f933a66ddb9986133fec19c Reviewed-on: https://chromium-review.googlesource.com/282961 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix 'unused private field' warnings for clang.  BUG=505317  Change-Id: I731b6e5ae5d5eba50f556314eeeebc6a3d29fc7a Reviewed-on: https://chromium-review.googlesource.com/282932 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Added 16-bit formats to GLConfigs to reduce offscreen texture memory usage.  BUG=angleproject:1042  Change-Id: I7024bd47601a21b08cafbf6460d512151b53d035 Reviewed-on: https://chromium-review.googlesource.com/277002 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix compilation on Linux  BUG=angleproject:892  Change-Id: I135e356e1ec78c95e69a260bd0576e5285e759b5 Reviewed-on: https://chromium-review.googlesource.com/283225 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Added emulated indexed pointsprite rendering support.  This emulation is for renderers that do not support Geometry Shaders.  BUG=angleproject:949  Change-Id: I7acf003e83ea6661f10a703486e6d07eb28786f8 Reviewed-on: https://chromium-review.googlesource.com/274851 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Cooper Partin <coopp@microsoft.com>, 23355681, 619, 169, 619
Remove redundant chdir in angle_deqp_test_main  Fixes the tests not running directly from the VS UI.  BUG=angleproject:1051  Change-Id: Ia299d8e7ad676330902725c114e8f5766db49d82 Reviewed-on: https://chromium-review.googlesource.com/283158 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix command line being ignored in non-gtest dEQP tests  BUG=angleproject:1051  Change-Id: If10abaea31ad29af9f8d438403f67b9dfbfd7e45 Reviewed-on: https://chromium-review.googlesource.com/283167 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Port gpu_test_expectations and angle_deqp_googletest to Linux  BUG=angleproject:1051  Change-Id: I46c3a5651d36750558735eb626ed5c9424b250b4 Reviewed-on: https://chromium-review.googlesource.com/282596 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "D3D11: Refactor InputLayout cache."  Seems to be failing maps_pixel_test on the bots.  BUG=angleproject:959  This reverts commit 53fd1552ba7dbf91a726fce139d748860bd8a5f5.  Change-Id: I1f2593caca58f701d284993d2ee313846806491b Reviewed-on: https://chromium-review.googlesource.com/283157 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Refactor InputLayout cache.  Using a much more compact input layout structure allows us to save quite a bit of time comparing input layouts or computing hashes. A subsequent patch shrinks the size of the structure further.  BUG=angleproject:959  Change-Id: I7a0f10428cc7e96967e60cc085ff2e8779718978 Reviewed-on: https://chromium-review.googlesource.com/277288 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Optimize checks for active UBOs.  We can reduce the amount of iterations we use by using std::vectors for storing UBO indexes and resizing them to the max active index. This allows us to skip inactive ranges. Reduces draw call overhead.  BUG=angleproject:959  Change-Id: I2577e5dbdce0e5ab102ca916eb7f1f35cf03f9ad Reviewed-on: https://chromium-review.googlesource.com/277287 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix some clang warnings with -Wmissing-braces in ANGLE.  Clang warns if there are missing braces around a subobject initializer. The most common idiom that triggers this is: STRUCT s = {0}; which can be more simply written as: STRUCT s = {};  BUG=505297  Change-Id: Ib4513ee195d43e7c4a4a2f46c328866f0023a2a5 Reviewed-on: https://chromium-review.googlesource.com/282921 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Store TFunction::returnType by a const pointer.  On 32-bit Android this change saves ~30KiB per compiler instance.  BUG=492725  Change-Id: I8bea48d57ee7eac0a0ee417035085c0d335aea09 Reviewed-on: https://chromium-review.googlesource.com/281047 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Dmitry Skiba <dskiba@google.com>, 23355681, 619, 169, 619
Change TSymbolTable::insertBuiltIn() TType* pointers to const.  Const types make it possible to implement caching and other optimizations.  BUG=492725  Change-Id: I64398bb9effcc909dd052a038acbb5ec0ca730e8 Reviewed-on: https://chromium-review.googlesource.com/281046 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Dmitry Skiba <dskiba@google.com>, 23355681, 619, 169, 619
Rename DeferredShader to LazyShader.  Deferred rendering is a shading technique and "lazy" is the more correct term. Also rename a few methods so we can use a shared interface for other types of lazy D3D11 resources.  BUG=angleproject:1014  Change-Id: I2fd2c823291d414003690066eaec063f1cd0bc4c Reviewed-on: https://chromium-review.googlesource.com/282550 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Brandon Jones <bajones@google.com>, 23355681, 619, 169, 619
Enable compilation of dEQP tests on Linux  BUG=angleproject:1051  Change-Id: I158e59ca581b580825848e831d05064cdcc30d96 Reviewed-on: https://chromium-review.googlesource.com/276202 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Allow calling HandleAllocator::reserve with MAX_UINT.  BUG=angleproject:1052  Change-Id: I03883799ef334f39c9e855a0a4b7af1ab02d5da9 Reviewed-on: https://chromium-review.googlesource.com/282414 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Minmin Gong <mgong@microsoft.com>, 23355681, 619, 169, 619
Update failing WebGL test expectations.  Change-Id: I8c469dad3e6a084e5b37a76ea3a1f86b9a99d613 Reviewed-on: https://chromium-review.googlesource.com/282624 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Improve D3D GetProgramBinary chipset validation  - Check chipset identifying info before trying to compile shaders - Check device feature level when loading a binary - Use chipset VendorID/DeviceID etc instead of LUID so that program   binaries remain valid across system reboots  Change-Id: I88ba4543bb990956d1d8fb324abf9784d72950cd Reviewed-on: https://chromium-review.googlesource.com/280428 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Ensure FencSyncTests::BasicOperations can't get stuck in an infinite loop  BUG=angleproject:1053  Change-Id: If6661ce3d87cdf44b1d45911418ecf78b5e6175a Reviewed-on: https://chromium-review.googlesource.com/277370 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use std::vector for TranslatedAttribs.  This allows us to cache a std::vector between calls and avoids us calling allocation/constructors for locals which saves us some time. It also allows us to use the vector's size to limit the range of attribs we look at.  BUG=angleproject:959  Change-Id: I799ed6c92fa8fca96e92e235b125a11d2d551aab Reviewed-on: https://chromium-review.googlesource.com/277286 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Small optimization to VertexDataManager.  Avoid calling a getter repeatedly in a loop when we can instead store a local reference to an array.  BUG=angleproject:959  Change-Id: I507ad1a6cf3bb6183dd3499df024dfec6950a6c8 Reviewed-on: https://chromium-review.googlesource.com/277285 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Change intializer list order to match field order.  BUG=505304  Change-Id: I38149e72732f0b4eb7d398f90b5d11660e2a7fbc Reviewed-on: https://chromium-review.googlesource.com/282465 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Roll dEQP 554adf..92f7752.  Includes updated Licences.  https://android.googlesource.com/platform/external/deqp/+log/554adf..92f7752  BUG=angleproject:998  Change-Id: If2da8719addeef25ec46adc105cf63c8b861f55a Reviewed-on: https://chromium-review.googlesource.com/282271 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@google.com> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
WindowSurfaceGLX: swap before resizing the child window  BUG=angleproject:892  Change-Id: I9b27777547624959fce6e045f9aac2652f139b9b Reviewed-on: https://chromium-review.googlesource.com/282058 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
WindowSurfaceGLX: Fix child window creation size  This makes Chrome on ANGLE work on Linux without obvious bugs.  BUG=angleproject:892  Change-Id: I595ac00a6646cb407941932b0d4f9f020d4cd059 Reviewed-on: https://chromium-review.googlesource.com/282057 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add remaining ES3 caps queries.  BUG=angleproject:1049  Change-Id: Ib5076380c692f4fa94921692baa7da14440556d1 Reviewed-on: https://chromium-review.googlesource.com/282386 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Cache active attribute lists in VertexDataManager.  This saves us re-creating vector memory every iteration and allows us to iterate over much smaller lists of attributes. In the future it could allow us to update the cache more efficiently with state change updates.  BUG=angleproject:959  Change-Id: Ie8ae7a31726468dc2184165380f1f3e5e0152936 Reviewed-on: https://chromium-review.googlesource.com/277284 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Pass current value type instead of the object.  This allows us to simplify the logic in VertexDataManager enough that we can start to cache attribute information.  BUG=angleproject:959  Change-Id: I7b53a137d73f40f86e3acb9caebb66f9cacf8b6f Reviewed-on: https://chromium-review.googlesource.com/277283 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove the PackUnpackHalfOverflow test.  Different drivers handle overflow differently.  The overflow case is not defined in the spec.  BUG=angleproject:1044  Change-Id: I9e3883af147c6c1a4fcdcddea3ff70c62f859c56 Reviewed-on: https://chromium-review.googlesource.com/282540 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add new GLSL target versions.  Test the emulated GLSL functions against multiple GL versions.  BUG=angleproject:1044  Change-Id: I1e12523301042f0d541ab2f4e73f02319d1584ef Reviewed-on: https://chromium-review.googlesource.com/277702 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Improve the test precision in PackUnpackTest.   * Output to floating point framebuffers so that results are not truncated    to 8 bit normalized values.  * Tighten the epsilon from 1/255 to 0.0005. May need further tweaking as    more GPUs are tested.  * Explicitly check for -inf and inf values when they were previously    rounded to 0 and 255.  * Explicitly check for clamping of overflowed normalized floats by    providing the expectations instead of computing them.  BUG=angleproject:1044  Change-Id: I8410cf61fe79a9919fb0db7e415bf97b2d0abd9e Reviewed-on: https://chromium-review.googlesource.com/281191 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix a tautological comparison.  BUG=505309  Change-Id: I0e93139693206e766b91a5998d6e284c7a29fd14 Reviewed-on: https://chromium-review.googlesource.com/282450 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Error when encountering non-preprocessor tokens before #extension in ESSL3.  BUG=angleproject:1047  Change-Id: I4a548270f651e35b2c8d1ab5d0f46185230c5f74 Reviewed-on: https://chromium-review.googlesource.com/281216 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Compile end2end tests on MacOS  This includes an implementation of OSX timer and path_utils.  BUG=angleproject:891  Change-Id: Id5440a8321bcfd4a61f3fe35b4a3fc0c651f564f Reviewed-on: https://chromium-review.googlesource.com/278211 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Revert "dEQP: Compile dEQP targets in Chromium.""  Should be fixed now with latest patches.  BUG=angleproject:998 BUG=500736  This reverts commit d0071dd9c39d0ada72292d476d8e8e081731c953.  Change-Id: I3a611bfa10429a1f97d18e9aa1f316eabb67d114 Reviewed-on: https://chromium-review.googlesource.com/282055 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
dEQP: Extend GoogleTest support.  *re-land after rebase on top of Chrome build fix*  This patch will enable a Chromium-side CL to build dEQP/ANGLE with GoogleTest.  BUG=angleproject:998 BUG=500736  Change-Id: Id02c66a260b0a7bab3de9cda624fe097322b2d3c Reviewed-on: https://chromium-review.googlesource.com/281824 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@google.com> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
dEQP: Move the DEPS dirs to mirror Chromium.  This avoid us needing to replicate gyp variables in both Chromium's and ANGLE's common.gypi files.  BUG=angleproject:998  Change-Id: Iba1938fd37eb4bee28ae7daad31bf85a2d3bd692 Reviewed-on: https://chromium-review.googlesource.com/282145 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@google.com> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Add constant folding support for matrix built-ins  This change adds constant folding support for following matrix built-ins:     - matrixCompMult outerProduct transpose determinant and       inverse.  BUG=angleproject:913 TEST=angle_unittests(new: MatrixUtilsTest ConstantFoldingTest.*Matrix*) dEQP Tests: dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.matrix.* (All 54 tests started passing with this change)  Change-Id: I7b9bf04b9a2cbff72c48216cab04df58c5f008d6 Reviewed-on: https://chromium-review.googlesource.com/276574 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add opaque definitions of EGL platform types for ozone chromium builds  These are copied from chromium's modified eglplatform.h. It is necessary in order to build ANGLE for freon Chrome OS boards because X11 headers aren't included in the SDK.  BUG=504501 TEST=cros chrome-sdk --board link   gclient runhooks   ninja -C out_link/Release chromium_builder_tests  Change-Id: I37c3cba280689ec8d8a13e8946b1401d4bba7ea8 Reviewed-on: https://chromium-review.googlesource.com/281992 Tested-by: Michael Spang <spang@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Michael Spang <spang@chromium.org>, 23355681, 619, 169, 619
perf_tests: Normalize MS counts in EGL init test.  The un-normalized values depend on the number of frames rendered so if we optimize down one time the other ms values all increase because we are rendering more frames. This generates spurious perf alerts from the perf dashboard.  BUG=None  Change-Id: I1bc480141a8cad7eee96bcdf4d6747a3cbae30f2 Reviewed-on: https://chromium-review.googlesource.com/280980 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor source pointer math out of VertexBuffer9/11.  This math can live in a single place in the VertexDataManager. This cleans up the code and paves the way for future optimizations.  BUG=angleproject:959  Change-Id: I7138c6e080d9c3d6507b55d981bfb62c2590a2a8 Reviewed-on: https://chromium-review.googlesource.com/277282 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor VertexDataManager to store translated attrib.  Refactoring patch only. Reduces the number of parameters we need to pass around in internal functions. Clears the way for future optimization work.  BUG=angleproject:959  Change-Id: Ic98ab5a07189eaa053dffce994546666bb07cede Reviewed-on: https://chromium-review.googlesource.com/277281 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix ANGLE build on Chrome OS ARM.  These builders set use_x11=1 but don't have GLX headers. Avoid trying to compile ANGLE's GL GLX and X11 sources on Chrome OS at all.  BUG=503173angleproject:892  Change-Id: I7f5862bb83b33f6ce302244fa5668295789a3a41 Reviewed-on: https://chromium-review.googlesource.com/281778 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Fix seg fault in IsPlatformAvailable.  Some GLX implementations can't handle having libGL.so.1 dlclose'd out from under them while there's any X window still open against which a GLXWindow was ever created. Load the library once per process rather than once per FunctionsGLX instance.  This showed up as a crash in X11Window::destroy during XCloseDisplay.  BUG=angleproject:892  Change-Id: I0da2674786a952865e5bea2513259c0a32d4453c Reviewed-on: https://chromium-review.googlesource.com/280902 Tested-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Corentin Wallez <cwallez@google.com>, 23355681, 619, 169, 619
Revert "dEQP: Extend GoogleTest support."  Causing runhooks failures:  gyp: Undefined variable deqp_path in C:\b\build\slave\GPU_Win_Builder\build\src\third_party\angle\src\tests\tests.gyp  BUG=angleproject:998 BUG=500736  This reverts commit 8edd75d1bb6680e7c2018ece9f5c81e3b87bf938.  Change-Id: I8cd83bb5871dea81abea61554b182825145298e6 Reviewed-on: https://chromium-review.googlesource.com/281208 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "dEQP: Compile dEQP targets in Chromium."  Causing runhooks failures:  gyp: Undefined variable deqp_path in C:\b\build\slave\GPU_Win_Builder\build\src\third_party\angle\src\tests\tests.gyp  BUG=angleproject:998 BUG=500736 This reverts commit 3018c206abd1fbfb94ab049326ff89f1f8cf3be4.  Change-Id: I8c0402fb7465101a9331cbb2020693469d644e7e Reviewed-on: https://chromium-review.googlesource.com/281194 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Simplify the assignment of use_x11.  Hopefully fixes the flaky compile errors in ChromeOS  BUG=angleproject:892 BUG=503173  Change-Id: Ifd79f1e382c12be3aecd9efb4860287df7d43060 Reviewed-on: https://chromium-review.googlesource.com/281180 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
dEQP: Compile dEQP targets in Chromium.  This switches the primary targets for dEQP into the non-standalone namespace so we can build dEQP ANGLE tests on Windows with Chrome.  BUG=angleproject:998 BUG=500736  Change-Id: I2ae25f31ab123c49965412445f661b6b69d19109 Reviewed-on: https://chromium-review.googlesource.com/281020 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
dEQP: Extend GoogleTest support.  This patch will enable a Chromium-side CL to build dEQP/ANGLE with GoogleTest.  BUG=angleproject:998 BUG=500736  Change-Id: Ie480e3319c1bd77dd1de2c964f78ef97297fcfe9 Reviewed-on: https://chromium-review.googlesource.com/280856 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix lots of compilation errors in generated GLSL functions.  Reformatted to improve readability.  BUG=angleproject:angleproject:947  Change-Id: I467f0396a0318b7a51d5cafce3f11e55d929c369 Reviewed-on: https://chromium-review.googlesource.com/278250 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor GLSL version calculations for emulated functions.  Pass the target GLSL version to InitBuiltInFunctionEmulatorForGLSL so that it can be updated to generate emulated functions for multiple versions.  BUG=angleproject:1044  Change-Id: I34c408df52fd0f7d6c2f66d0579ac854afd93b87 Reviewed-on: https://chromium-review.googlesource.com/277700 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
dEQP: Rename deqp_dir to deqp_path.  The same for the other dEQP gyp path vars.  BUG=angleproject:998  Change-Id: I7c123dbd8983e032dc9339bf289259e6d8ec654b Reviewed-on: https://chromium-review.googlesource.com/281009 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
dEQP: Move libtester sources to a gyp variable.  This keeps the target definition cleaner and will enable GN if we ever get to that point.  BUG=angleproject:998  Change-Id: I8692c93155a6bada9b1b0c05a1dd34af64a3b400 Reviewed-on: https://chromium-review.googlesource.com/280992 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Refactor VertexDataManager's current value cache.  This clears the way for future optimizations.  BUG=angleproject:959  Change-Id: Ief9077159e1e5fed5670862454a6f0b41d630551 Reviewed-on: https://chromium-review.googlesource.com/277280 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Optimize ProgramD3D::sortAttributesByLayout.  We can use pointer math here instead of copying values.  BUG=angleproject:959  Change-Id: I3b87956224d0846c9011f5d8edb811bc5e4f2b85 Reviewed-on: https://chromium-review.googlesource.com/277119 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Try setting use_x11 to 0 when doing a linux chromeos build.  BUG=503173  Change-Id: I31c09a1d0849de14cc72ba3a357e482c7e329a46 Reviewed-on: https://chromium-review.googlesource.com/281025 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Added define to enable/disable uniform precision validation for shaders. This feature was requested by developers to allow non-conformant shaders to be used which contain mismatched precisions.  Change-Id: I57899efe064f7ffed1c0e43a508930ac70f6aa03 Reviewed-on: https://chromium-review.googlesource.com/277340 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Updated libEGL to have correct application revision type for winrt project generation.  Change-Id: Ifc4ffda8a80d2317dda70f5bf2add53ea91df961 Reviewed-on: https://chromium-review.googlesource.com/277420 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Reduce overhead of clearing unused textures.  *re-land with compile fix*  We would spend a fair bit of time iterating over the unused textures setting them to null one-by-one and updating our cache. We can reduce this time by smarter caching and skipping unmodified ranges.  BUG=angleproject:959  Change-Id: I4de20bc131c4a568108ad670a2ef491cfd4c50ed Reviewed-on: https://chromium-review.googlesource.com/280916 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "D3D11: Reduce overhead of clearing unused textures."  Compile error on Windows:  error C2561: 'rx::Renderer11::clearTextures' : function must return a value  BUG=angleproject:959  This reverts commit 475e5b7f91f8ed9688b5a46efe54f15357096e3e.  Change-Id: Id34ff9530a71ce43549e2eb78d2d927084d46a47 Reviewed-on: https://chromium-review.googlesource.com/280915 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Reduce overhead of clearing unused textures.  We would spend a fair bit of time iterating over the unused textures setting them to null one-by-one and updating our cache. We can reduce this time by smarter caching and skipping unmodified ranges.  BUG=angleproject:959  Change-Id: I92f11cf63542c55bb3adbbb8276a54bcfe848f61 Reviewed-on: https://chromium-review.googlesource.com/277118 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
In WinRT prevent too many calls to DXGIGetDebugInterface1  Change-Id: Id0ec9eb40566f7c2169b228394fb3afe9f32e6f5 Reviewed-on: https://chromium-review.googlesource.com/280551 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Workaround for some STLs not parsing floats with a suffix  BUG=angleproject:1046 BUG=angleproject:891  Change-Id: I01c3f024142e573385a5f40d721171ad752ffd19 Reviewed-on: https://chromium-review.googlesource.com/278210 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add a OSPixmap class to have cross platform pixmaps  This will help make the deqp support code platform agnostic.  BUG=angleproject:892  Change-Id: I6f8c738ed8125057db87afea2079583f8feac977 Reviewed-on: https://chromium-review.googlesource.com/276201 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add OSWindow::takeScreenshot to be used by some dEQP egl tests  This helps make dEQP support platform agnostic  BUG=angleproject:892  Change-Id: Ifd9436caa8c79018a053c27e32b514ef9ebee707 Reviewed-on: https://chromium-review.googlesource.com/273596 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add SetLowPriorityProcess to utils and use it in dEQP support  This provides a cross-platform way to make sure dEQP runs in a low priority process.  BUG=angleproject:892  Change-Id: I0d12f1eacb78be43edcdb6622f945734c0b377ff Reviewed-on: https://chromium-review.googlesource.com/273595 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
dEQP support: use OSWindow instead of tcuWin32Window  This is to help dEQP support become cross platform.  BUG=angleproject:892  Change-Id: I4480b64a33b1725fb42769bf7dddef1b4ee27c83 Reviewed-on: https://chromium-review.googlesource.com/273594 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix compilation errors and Mac and some try bots  BUG=angleproject:892  Change-Id: I9a449889109b7df9c69776573b0fc2098cd06199 Reviewed-on: https://chromium-review.googlesource.com/280565 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
DisplayGLX: add error checking for the dummy pbuffer creation  BUG=angleproject:892  Change-Id: I7a15f2be19a598e40d4fa5a7c70d879cdbc6d32a Reviewed-on: https://chromium-review.googlesource.com/277011 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix defines being exported outside of ANGLE  This should fix a build failure on a GPU try bot so we can Roll ANGLE  BUG=angleproject:892  Change-Id: I86cb0135dc71b003f691633e339d5d0527eaace4 Reviewed-on: https://chromium-review.googlesource.com/280396 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Add workaround for flushing before readPixels."  This reverts commit 46c13a15fa90130eca14301a4ef6deed12315037.  Seems to have introduced significant flakiness on the Windows AMD FYI bot. Reverting while investigating.  Change-Id: I9cfdb09a4a0d792a0c5db76c8b0b9d3285c0695a Reviewed-on: https://chromium-review.googlesource.com/280365 Tested-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Add workaround for flushing before readPixels.  This has been found necessary on the D3D11 backend on AMD GPUs and on the D3D9 backend on all GPUs.  Tested an earlier version of this patch overnight on one of the affected Windows AMD bots; it eliminated the flakiness observed on one of the WebGL conformance tests.  BUG=491419  Change-Id: I668493eb5ec109b5e0650c154dc97b786e0745bd Reviewed-on: https://chromium-review.googlesource.com/278265 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Fix Chromium build of angle_end2end_tests  BUG=angleproject:892  Change-Id: I9922046fc9e4d82d7034405f5952263f982c6529 Reviewed-on: https://chromium-review.googlesource.com/278159 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix standalone compilation on Linux  Use a "gyp trick" to define a default value for use_x11 thanks goes to kbr for remembering the other instance of this trick.  BUG=angleproject:892  Change-Id: Ifb64af4e56d9eb90993760a495008d95dd31ae3d Reviewed-on: https://chromium-review.googlesource.com/278158 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add ShClearResults() for clearing last compilation results.  This helps reclaiming memory used by the results when we don't need them anymore.  BUG=492725  Change-Id: I4bc11be27b23589548120f0dc43e9979bf894089 Reviewed-on: https://chromium-review.googlesource.com/277808 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Dmitry Skiba <dskiba@google.com> Tested-by: Dmitry Skiba <dskiba@google.com> Reviewed-by: Dmitry Skiba <dskiba@google.com>, 23355681, 619, 169, 619
Roll dEQP 9b4161..554adf1.  Includes some tests for EXT_debug_marker  https://android.googlesource.com/platform/external/deqp/+log/9b4161..554adf1  BUG=None  Change-Id: I911fcb5577caefaa1fe3479445146a2b3f819124 Reviewed-on: https://chromium-review.googlesource.com/277140 Reviewed-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix some markdown syntax that github had trouble parsing.  Change-Id: I00f4409b7c6e12bb0cd6944a488fde3f6ef4054c Reviewed-on: https://chromium-review.googlesource.com/278055 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Notify the VertexArrayImpl when a buffer is detached.  Update VertexArrayGL to clear it's cached buffer binding when a buffer is detached to prevent name aliasing.  Fixes:  * DEQP standalone crashes.  * WebGL Conformance DEQP tests.  Change-Id: If21a617629e15873ddeae0368b5399616f2ca68b Reviewed-on: https://chromium-review.googlesource.com/278050 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Roll GYP.  Includes fixes to clean up our MSVS projects.  BUG=None  Change-Id: Ied16bf5b40e7a29ee08e76152daa1296c8960724 Reviewed-on: https://chromium-review.googlesource.com/278051 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Document ESSL3 builtin functions and which GLSL version they became core in.  BUG=angleproject:1044  Change-Id: I1cd35f17a2d6cc384ac1bfae72a23a092ca50244 Reviewed-on: https://chromium-review.googlesource.com/277701 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Corentin Wallez <cwallez@google.com> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Skip MaxAttribs test on all AMD/OpenGL configs.  Change-Id: Ia1c4f230a51c49a48db2d12749b9a028a17168e3 Reviewed-on: https://chromium-review.googlesource.com/277727 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix support for GL_MAX_ATTRIBS attributes.  *re-land with fix for AMD/ES2/OpenGL.*  An off-by-one bug slipped in that broke support for these edge case shaders.  Bug introduced in https://chromium-review.googlesource.com/#/c/266928/  BUG=angleproject:1045 BUG=500116  Change-Id: If44f809d432221d1e17afc407d49e87e0cb7504c Reviewed-on: https://chromium-review.googlesource.com/277664 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Enable point sprites in StateManagerGL."  Speculative fix for failures on the AMD FYI bot.  This reverts commit 67e04be12dda07ac9b37798558e842f50bd42776.  Change-Id: Ia57e3c800a6ff9e81e31bf5b37a95e97460ceda4 Reviewed-on: https://chromium-review.googlesource.com/277681 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Fix support for GL_MAX_ATTRIBS attributes."  Breaks the AMD bot's OpenGL tests.  VertexAttributeTest.MaxAttribs/3: shader compilation failed: Vertex shader failed to compile with the following errors: ERROR: error(#272) Implicit version number 110 not supported by GL3 forward compatible context ERROR: error(#273) 1 compilation errors.  No code generated  shader compilation failed: Fragment shader failed to compile with the following errors: ERROR: error(#272) Implicit version number 110 not supported by GL3 forward compatible context ERROR: error(#273) 1 compilation errors.  No code generated  BUG=angleproject:1045 BUG=500116  This reverts commit 3f3d75ea6c20826adb6240f1573fd7139939a986.  Change-Id: I8cdd024fcf49f1ade553dae2cdbe8b02d8fba364 Reviewed-on: https://chromium-review.googlesource.com/277673 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Enable point sprites in StateManagerGL.  Fixes:  * conformance/rendering/point-size.html  * conformance/rendering/point-with-gl-pointcoord-in-fragment-shader.html  * PointSpritesTest  * particle_system sample  BUG=angleproject:883  Change-Id: Idb3352fa916cf08817496f0a8425c95ece9bfa49 Reviewed-on: https://chromium-review.googlesource.com/275860 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix support for GL_MAX_ATTRIBS attributes.  An off-by-one bug slipped in that broke support for these edge case shaders.  Bug introduced in https://chromium-review.googlesource.com/#/c/266928/  BUG=angleproject:1045 BUG=500116  Change-Id: Iddfe0c21bef3c3a61017ba56d9e1fc001c0a3703 Reviewed-on: https://chromium-review.googlesource.com/277476 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Implement GL_EXT_debug_marker in D3D9/D3D11 renderers  BUG=angleproject:1043  Change-Id: I7f3bfb35050662520b901828d0478719fa8d11b3 Reviewed-on: https://chromium-review.googlesource.com/274054 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Reduce hardcoded D3D11 assumptions in DrawBuffersTest  Change-Id: I9b93cc6ee7218a92dda80dbc3f70aec6fef69ded Reviewed-on: https://chromium-review.googlesource.com/276598 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Small fixes for passing code analysis tools.  BUG=angleproject:1005  Change-Id: I8f2a6c0a5a6157303e436b96cc4c4ff1c29cfe18 Reviewed-on: https://chromium-review.googlesource.com/271600 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Blit11: Defer loading some resources until we use them.  We can also defer loading InputLayouts and other resources in Blit11 if we don't need them immediately.  BUG=angleproject:1014  Change-Id: I859583e4696e5864dfd8d436143ed9ddbc2fd60d Reviewed-on: https://chromium-review.googlesource.com/275779 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Blit11: Defer built-in shader loads.  Introduce a 'DeferredShader' utility class. Other classes can use DeferredShader to delay loading shader resources until we render with them which saves on loading time as well as memory if we aren't using particular shaders.  BUG=angleproject:1014  Change-Id: Ic6767c3c422a7fedbf23cce5d0c9d822aaf2e652 Reviewed-on: https://chromium-review.googlesource.com/275778 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Add multisample render target info to DXGI tables.  Saves us some time on startup. Also assume every multisample format can support 1x multisampling and that if we support a higher format we support all lower sample counts (eg - if we support 16x we support 8x and 4x etc)  BUG=angleproject:1014  Change-Id: I62143e5db561b717edd1a0c96f5e3acd4de3d154 Reviewed-on: https://chromium-review.googlesource.com/275777 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
In D3D11 check for 16-bit texture support and use if possible  BUG=angleproject:1002  The last patch added new tests which failed on some Intel Win7 machines. This was due to a driver bug. Windows Updates have been applied to the failing machine and the tests now pass.  Changes between second and current (third) failed 16-bit patch: - Reenable usage of 16-bit DXGI textures on all Intel cards - Disable 16bpp tests on Intel D3D11 until the bots are updated - Updated Win7 test machine. Tests now pass  Changes between first and second failed 16-bit patch: - Disabled usage of 16-bit DXGI textures on all Intel cards - Added DXGI->GL conversion entries for 16-bit formats which   fixes FBO readback issues. The ES CTS and dEQP tests which   failed with the last patch now pass.  Change-Id: Id8ea89bfbc450beea54afdd398956bc97ecf3c01 Reviewed-on: https://chromium-review.googlesource.com/275082 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Add DXGI format info for depth-stencil.  This will save us some queries on D3D11 startup.  BUG=angleproject:1014  Change-Id: I5aaeec43d3b9bc73d011de17e2abac902ac3b7b9 Reviewed-on: https://chromium-review.googlesource.com/275776 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Add DXGI RenderTarget info to the format tables.  This will save us some time on D3D11 startup.  BUG=angleproject:1014  Change-Id: Ic00b3dfd9f6230d2d54e6e9bb74be55b923697fe Reviewed-on: https://chromium-review.googlesource.com/275775 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Implement DXGI shader sample format tables.  This saves us some startup time in the D3D11 Renderer.  BUG=angleproject:1014  Change-Id: I5d2607b58a86ee0a8932032a0f8a31b21d39b525 Reviewed-on: https://chromium-review.googlesource.com/275774 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
dEQP: Hook up GPU test expectations code.  With the list of failures this gives a 100% passing GLES2 test suite.  BUG=angleproject:998  Change-Id: I20985c729104d7a114352d156c238bca3ea1698c Reviewed-on: https://chromium-review.googlesource.com/274423 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add more detailed captures to EGL init perf test.  We can use the ANGLE platform to capture more specific information than total number of iterations. We can also capture time spent initializing DLLs calling D3D11CreateDevice and allocating some default resources.  BUG=angleproject:1014  Change-Id: If0f4965e7aac22eb09dfa0d2300ff449e7481f6e Reviewed-on: https://chromium-review.googlesource.com/276631 Reviewed-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix the broken draw call perf test.  This was broken by the angle test platforms refactor patch https://chromium-review.googlesource.com/#/c/276460/. It was leading to the wrong tests be executed for the perf tests and also had bugs with supporting a default platform.  BUG=None TEST=angle_perftests  Change-Id: Ib99342d4189fd98bf93dce088d15afcecc4a7e37 Reviewed-on: https://chromium-review.googlesource.com/277036 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Refactoring: use compileTestShader in PackUnpackTest  TEST=angle_unittests  Change-Id: I49f17444bf0fe6568ec4d3445421c27a562adf1b Reviewed-on: https://chromium-review.googlesource.com/277040 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix compilation of libtester_main on Linux  Replace usage of std::exception by std::runtime_error  BUG=angleproject:892  Change-Id: I214fe6a93944dcfb39b0633f46caf3b1187bd5d3 Reviewed-on: https://chromium-review.googlesource.com/275815 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Revert "Add baked DXGI format info for 2D/3D/Cube textures.""  Parent patch fixed.  BUG=angleproject:1014  This reverts commit 79ae150ed273f4c5e94b89be5d913c6b252ff1dd.  Change-Id: I6431d73e5a766d1937732ddb7964751d46465674 Reviewed-on: https://chromium-review.googlesource.com/276776 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add generated tables to mirror D3D11 format support.  *re-land with fix for test build*  These tables can save us on startup time. Instead of querying the tables we can keep certain assumptions about texture formats because certain formats are guaranteed to be supported in various feature levels.  Testing with angle_perftests indicates this patch series will save about 50% of the time we spend in Renderer11::initializeDevice.  BUG=angleproject:1014  Change-Id: I5477eea3e8433d36119cd099fb0c08eea168489a Reviewed-on: https://chromium-review.googlesource.com/276758 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Add generated tables to mirror D3D11 format support."  Hidden conflict with Geoff's test refactor patch.  BUG=angleproject:1014  This reverts commit 396ee48b639189465039cd62ef8409e86d5f6dd1.  Change-Id: I8182acb350b61b31f4040a20c86652e23706905a Reviewed-on: https://chromium-review.googlesource.com/276774 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Add baked DXGI format info for 2D/3D/Cube textures."  Hidden conflict with Geoff's test refactor patch.  BUG=angleproject:1014  This reverts commit a3028ab99b70c216368a876cdffe44b0b2239fcf.  Change-Id: Ic202e377032e9c74f62450ba0ffcba85a1fc0cc7 Reviewed-on: https://chromium-review.googlesource.com/276773 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add baked DXGI format info for 2D/3D/Cube textures.  This saves us from querying a lot of the formats on startup.  BUG=angleproject:1014  Change-Id: I499625b9a131cf10791d1580d7a7b477a161045a Reviewed-on: https://chromium-review.googlesource.com/275773 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add generated tables to mirror D3D11 format support.  These tables can save us on startup time. Instead of querying the tables we can keep certain assumptions about texture formats because certain formats are guaranteed to be supported in various feature levels.  Testing with angle_perftests indicates this patch series will save about 50% of the time we spend in Renderer11::initializeDevice.  BUG=angleproject:1014  Change-Id: I84dbeaba1d1c635ad60c8413705cc41af8a51f06 Reviewed-on: https://chromium-review.googlesource.com/275772 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Import Chromium test expectation libs.  This can be useful for our testing code to filter based on system configurations such as GPU type OS or Debug/Release.  BUG=angleproject:998  Change-Id: I88b7fe1a7a1446262cc084e62cdb335776fa8912 Reviewed-on: https://chromium-review.googlesource.com/274422 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement the remaining caps queries.  Limit the supported ES version based on these caps.  BUG=angleproject:879  Change-Id: If3a097576465b33af0015fcb28dab10e88fdc4d9 Reviewed-on: https://chromium-review.googlesource.com/273160 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Only run tests that the current hardware can support.  For each config determine if a context can be created at test instantiation time.  This allows skipping of ES3 tests when the hardware does not support ES3.  Updated the perf_tests to use the EGLPlatformParameters struct so that they can be filtered in the same way.  Change-Id: If664604b057cec4005eb4b63bebd83cd4964b7b2 Reviewed-on: https://chromium-review.googlesource.com/276460 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add missing newlines to BuiltInFunctionEmulatorGLSL.cpp and Pack_Unpack_test.cpp.  BUG=angleproject:947  Change-Id: I8cbcd99e8c2cb7c461b0c624596631a4dec6dcc8 Reviewed-on: https://chromium-review.googlesource.com/276668 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Emulate Missing pack_unpack functions from OpenGL 4.1  BUG=angleproject:947  TEST=angle_unittests angle_end2end_tests  Change-Id: Id1afd7630d9720b6701225b7abf1ce4a3bf528b6 Reviewed-on: https://chromium-review.googlesource.com/260232 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Record precision of constant variables when needed  Add a traverser that checks precision qualifiers of folded constants and hoists them to separate precision qualified variables if needed.  Fixes sdk/tests/conformance/glsl/bugs/constant-precision-qualifier.html  TEST=WebGL conformance tests angle_unittests BUG=angleproject:817  Change-Id: I1639595e0e49470736be93274f0af07ee732e1fe Reviewed-on: https://chromium-review.googlesource.com/275095 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix missing newline at the end of compiler_test.h  BUG=angleproject:817  Change-Id: Iaa971c71c0f5bcec46fffb5d2e70f108e6ca6b02 Reviewed-on: https://chromium-review.googlesource.com/276607 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor common compiler test functionality into helper functions  Refactor translating a ESSL shader string into a target language so that compiler initialization and cleanup code can be reused between test classes.  BUG=angleproject:817 TEST=angle_unittests  Change-Id: Idb229dceb9e17b13ed6ad2a68ab55ed5c968780e Reviewed-on: https://chromium-review.googlesource.com/275814 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make MaxTextureSizeTest::RenderToTexture check for glBlitFramebuffer support  Change-Id: I25236240eec135b265a25eefdbbd28f069633eee Reviewed-on: https://chromium-review.googlesource.com/276308 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Fix standalone compilation on Linux"  This broke Chromium build on Linux.  This reverts commit c6a61c27e6c4f25d555fbcbd37f6d8dbdf958a39.  Change-Id: I4df380eaed3ecc19b85aa99a397968ceb5ce3af8 Reviewed-on: https://chromium-review.googlesource.com/276293 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix standalone compilation on Linux  BUG=angleproject:892  Change-Id: Iceae30f5bc12546b2486e8aac0346eab1f09ded3 Reviewed-on: https://chromium-review.googlesource.com/276200 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement EXT_discard_framebuffer in D3D11 renderer  Change-Id: I52bcf0cfb1aa123e085a35730fdefb006b617c3c Reviewed-on: https://chromium-review.googlesource.com/269232 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
d3d11: Add a histogram to capture DLL loading time.  This should complete the breakdown of the time we spent in eglInitialize.  BUG=angleproject:1014 BUG=436191  Change-Id: I3b44f10c56322924f9391a56973df5f439fa83bb Reviewed-on: https://chromium-review.googlesource.com/276268 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use both null and real renders for draw call perf.  Introduce a "null" GL renderer for this specific benchmark which does not do any work on drawArrays and drawElements. We could use the same kind of trick for buffer and texture updates if we need it. This gives us a good baseline for comparing GL and D3D perf.  BUG=angleproject:1040  Change-Id: I4bf7c75df01932de45ddd0a4e42e8fc82f15e37e Reviewed-on: https://chromium-review.googlesource.com/276192 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
dEQP: Add GoogleTest integration.  Use value-parameterized tests loading a full test list from case files.  BUG=angleproject:998  Change-Id: Iff65a2d722e9d105e22649b17a18cc74dccea2b1 Reviewed-on: https://chromium-review.googlesource.com/274421 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
dEQP: Add tcu::RandomOrderExecutor.  A prototype based on work from phaulos@. This should eventually be integrated into the dEQP repo.  BUG=angleproject:998  Change-Id: I9be137fb54423bc180623f172dde63a22311b791 Reviewed-on: https://chromium-review.googlesource.com/274420 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't create child windows in the WGL implementation.  BUG=angleproject:890  Change-Id: I66fb7b97ea3f09d40ba25a769c8bc7fe04527805 Reviewed-on: https://chromium-review.googlesource.com/275307 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Unify aggregate operator folding with other constant folding  Setting the type for folded aggregate nodes should work in a similar way as other constant folding. Common functionality between the different folding functions is refactored into a single function.  TEST=dEQP-GLES3.functional.shaders.constant_expressions.* BUG=angleproject:817  Change-Id: Ie0be561f4a30e52e52d570ff0b2bdb426f6e4f7a Reviewed-on: https://chromium-review.googlesource.com/275186 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Skip MipmapTest.RenderOntoLevelZeroAfterGenerateMipmap on Intel too.  Seeing failures on some Intel HD4000 cards as well as AMD.  BUG=angleproject:1038  Change-Id: I45dfcdf62af69cd3295918d963def85f2eb50ebe Reviewed-on: https://chromium-review.googlesource.com/274943 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
dEQP: Add case file generator script.  Use the dEQP null platform for speed and to avoid popping up a new window. Store the case lists as .gz files to save space in the repo.  BUG=angleproject:998  Change-Id: Ib9b10b8a83edc510cc98f120847b1cf93a3d2f78 Reviewed-on: https://chromium-review.googlesource.com/273975 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update WebGL CTS expectations.  BUG=none  Change-Id: I9c297853be54d8aec6e133535c5596283dbd246c Reviewed-on: https://chromium-review.googlesource.com/275861 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Unify unary operator folding with binary operator folding  Implement unary operator folding in a similar way to binary operator folding so that the code is easier to understand.  TEST=dEQP-GLES3.functional.shaders.constant_expressions.* BUG=angleproject:817  Change-Id: I069bdb38f965e1badb3e8f3f954386b205b7bb00 Reviewed-on: https://chromium-review.googlesource.com/275185 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "Revert "Make sure type gets set consistently in folded binary operations""  This patch was originally reverted only because a dependency patch failed a buggy Chromium test.  This reverts commit aebd002d00d39858819c58bad1970df121b78e1b.  TEST=dEQP-GLES3.functional.shaders.constant_expressions.* BUG=angleproject:817  Change-Id: Ia5acf15518ea89717c0cfe1398cb18ea27be5b19 Reviewed-on: https://chromium-review.googlesource.com/275811 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Skip LUMA format tests on OpenGL.  These formats are depricated in the core profile and not supported yet.  BUG=angleproject:884  Change-Id: Ic5cf75196ed73cc6bd660fc437f96fdcea5de1b4 Reviewed-on: https://chromium-review.googlesource.com/275771 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Clean up TIntermTraverser usage  Remove default parameters from TIntermTraverser.  Also clean up a few dead function declarations in traversers.  TEST=angle_unittests angle_end2end_tests BUG=angleproject:1037  Change-Id: I8d126c6c2d5b53e8b14e23e3d102f204a59323b3 Reviewed-on: https://chromium-review.googlesource.com/275184 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "Revert "Add constant folding support for geometric built-ins""  Revert of revert as the issue is with the failing test itself.  This reverts commit b3da45c12d3eecdd319c0feb4d2b933e144f816a.  Change-Id: Ie2003c78527f87cad7f8ead0d87fee75ce032379 Reviewed-on: https://chromium-review.googlesource.com/275487 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Remove unused right-to-left AST traversal support  No code actually uses the right-to-left traversal. All it does is add unnecessary complexity.  TEST=angle_unittests angle_end2end_tests BUG=angleproject:1037  Change-Id: Id15498343538c02c252ef0852f9a00c85ac3c4bb Reviewed-on: https://chromium-review.googlesource.com/275183 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Add a simple unit test for built-in emulation on Mac  This will replace a similar buggy test that will be removed from Chromium.  BUG=angleproject:913 TEST=angle_unittests  Change-Id: If782004e764316ca003effbea883640ecdb30dda Reviewed-on: https://chromium-review.googlesource.com/275397 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Always use the highest GL version available unless requested.  BUG=angleproject:890  Change-Id: I76a1b1c455cb4be02b4b5c52153f5c87f33d426d Reviewed-on: https://chromium-review.googlesource.com/275008 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Document OpenGL ES and EGL features formats and extensions.  Change-Id: I38fb5acc5e0824035ccba55c28d12c8980c5905e Reviewed-on: https://chromium-review.googlesource.com/275311 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Mark no_angle_common as no_chromium_code.  All other targets that remove chromium_code add no_chromium_code; looks like not doing this here was an oversight.  BUG=491209  Change-Id: Id5c81d019603b428561a23aaa4dbe4427e43e751 Reviewed-on: https://chromium-review.googlesource.com/275316 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nico Weber <thakis@chromium.org> Tested-by: Nico Weber <thakis@chromium.org>, 23355681, 619, 169, 619
Revert "Add constant folding support for geometric built-ins"  This is failing gpu_unittests on Mac:  ShaderTranslatorTest.BuiltInFunctionEmulation: ../../gpu/command_buffer/service/shader_translator_unittest.cc:314: Failure Value of: strstr(translated_source.c_str() "webgl_dot_emu") != NULL Actual: false Expected: true  Reverting until we can fix the overly-narrow test.  BUG=angleproject:913  This reverts commit b50788d11dec046415565af1cc7da334e2979577.  Change-Id: I5bd9df83704e771e419339745eceaa43a20bd1e6 Reviewed-on: https://chromium-review.googlesource.com/275320 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Make sure type gets set consistently in folded binary operations"  This is blocking the revert of the geometric constant folding  patch which is breaking gpu_unittests and blocking the roll.  BUG=angleproject:817  This reverts commit b07aba0798d3bba3118dac78933e73b3f08a601b.  Change-Id: Ia00fc45b1ddd9d3c079742dea0627aa12304f93b Reviewed-on: https://chromium-review.googlesource.com/275321 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Add a flush before looping to get the sync status."  Apparently even a flush isn't enough on some Intel drivers.  This reverts commit 73410e42c88dc28ada1a2b337b5c94b063b7a4e6.  Change-Id: Iafdd1cbb4e89d30ebe3be6404f0bf4e586d91b8d Reviewed-on: https://chromium-review.googlesource.com/275305 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make sure type gets set consistently in folded binary operations  Add a wrapper function that handles creating the folded node and setting the right parameters on it so that the folding function handles only calculating the folded values.  This will fix the precision set to constant folded values in some cases. Previously the precision was always set to be equal to one of the operands to the binary operation but now both operands are taken into account.  Folding binary operations is now in a separate function from folding unary operations.  TEST=dEQP-GLES3.functional.shaders.constant_expressions.* BUG=angleproject:817  Change-Id: Id97e765173c6110f49607e21c3fb90019b1ebac7 Reviewed-on: https://chromium-review.googlesource.com/274001 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add constant folding support for geometric built-ins  * re-land after mac compilation fix (unsupported c++11 initializer) *  This change adds constant folding support for following geometric built-ins:     - length distance dot cross normalize faceforward       reflect and refract.  BUG=angleproject:913 TEST=angle_unittests dEQP Tests dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.geometric.* (56 tests started passing with this change)  Change-Id: I236fc0c1af47a63f359564500c711e6bedf1c808 Reviewed-on: https://chromium-review.googlesource.com/274789 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add unit test for RemovePow  Add two versions of the test - one with a single pow() and another with a nested pow().  TEST=angle_unittests BUG=477306  Change-Id: Idb38e57a4b2522b7794996d6ea0f0456b349abf7 Reviewed-on: https://chromium-review.googlesource.com/274736 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add a flush before looping to get the sync status.  Intel GPUs enter an infinite loop unless told to flush.  BUG=angleproject:1038  Change-Id: I7c3d9dd08bf1ee09cb163dd859f817379a72cd65 Reviewed-on: https://chromium-review.googlesource.com/274942 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Read the proper uniform location instead of assuming location 0.  Fixes MipMapTest on Intel/OpenGL.  BUG=angleproject:1038  Change-Id: I19a0704969ef03d5d2ee3c9092daf4bd3a9818f7 Reviewed-on: https://chromium-review.googlesource.com/274818 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Load the framebuffer and vertex array object extensions.  BUG=angleproject:879 BUG=angleproject:1038  Change-Id: Idd2ad36707c17d13c45bc4fc131ec1ebfc45e0a5 Reviewed-on: https://chromium-review.googlesource.com/274817 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove unused QualifierAlive traverser  This class is not used anywhere in the code.  TEST=angle_unittests  Change-Id: Ib59573203636a669b136e3823d0abea8120f448e Reviewed-on: https://chromium-review.googlesource.com/274896 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Use the git mirror of googlemock.  Revision unchanged.  Change-Id: I95bc28ff8d47de1ddc90647a54e138dcd80161ee Reviewed-on: https://chromium-review.googlesource.com/274803 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix incorrect value being synced for the alpha blend equation.  Fixes angle_end2end_test BlendMinMaxTest with the blend_minmax extension enabled.  BUG=angleproject:883  Change-Id: Iae2441d11a3c4c497a1ddc4d250120fd85175d52 Reviewed-on: https://chromium-review.googlesource.com/274802 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Add constant folding support for geometric built-ins"  Breaks Mac build because of C++11 init syntax:  FAILED: /b/build/goma/gomacc ../../third_party/llvm-build/Release+Asserts/bin/clang++ -MMD -MF obj/third_party/angle/src/tests/compiler_tests/angle_unittests.ConstantFolding_test.o.d -DV8_DEPRECATION_WARNINGS -D__ASSERT_MACROS_DEFINE_VERSIONS_WITHOUT_UNDERSCORE=0 -DCHROMIUM_BUILD -DCR_CLANG_REVISION=238013-3 -DCOMPONENT_BUILD -DTOOLKIT_VIEWS=1 -DUSE_LIBJPEG_TURBO=1 -DENABLE_ONE_CLICK_SIGNIN -DENABLE_PRE_SYNC_BACKUP -DENABLE_REMOTING=1 -DENABLE_WEBRTC=1 -DENABLE_MEDIA_ROUTER=1 -DUSE_PROPRIETARY_CODECS -DENABLE_PEPPER_CDMS -DENABLE_CONFIGURATION_POLICY -DENABLE_NOTIFICATIONS -DENABLE_HIDPI=1 -DSYSTEM_NATIVELY_SIGNALS_MEMORY_PRESSURE -DDONT_EMBED_BUILD_METADATA -DDCHECK_ALWAYS_ON=1 -DENABLE_TASK_MANAGER=1 -DENABLE_EXTENSIONS=1 -DENABLE_PLUGIN_INSTALLATION=1 -DENABLE_PLUGINS=1 -DENABLE_SESSION_SERVICE=1 -DENABLE_THEMES=1 -DENABLE_AUTOFILL_DIALOG=1 -DENABLE_BACKGROUND=1 -DENABLE_GOOGLE_NOW=1 -DCLD_VERSION=2 -DENABLE_PRINTING=1 -DENABLE_BASIC_PRINTING=1 -DENABLE_PRINT_PREVIEW=1 -DENABLE_SPELLCHECK=1 -DENABLE_CAPTIVE_PORTAL_DETECTION=1 -DENABLE_APP_LIST=1 -DENABLE_SETTINGS_APP=1 -DENABLE_SUPERVISED_USERS=1 -DENABLE_SERVICE_DISCOVERY=1 -DENABLE_WIFI_BOOTSTRAPPING=1 -DV8_USE_EXTERNAL_STARTUP_DATA -DFULL_SAFE_BROWSING -DSAFE_BROWSING_CSD -DSAFE_BROWSING_DB_LOCAL -DSAFE_BROWSING_SERVICE -DGTEST_HAS_POSIX_RE=0 -DGTEST_LANG_CXX11=0 -DGL_APICALL= -DGL_GLEXT_PROTOTYPES= -DEGLAPI= '-DANGLE_PRELOADED_D3DCOMPILER_MODULE_NAMES={ "d3dcompiler_47.dll" "d3dcompiler_46.dll" "d3dcompiler_43.dll" }' -DANGLE_TRANSLATOR_STATIC -DUSE_LIBPCI=1 -DUSE_OPENSSL=1 -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -DDYNAMIC_ANNOTATIONS_ENABLED=1 -DWTF_USE_DYNAMIC_ANNOTATIONS=1 -Igen -I../.. -I../../third_party/angle/include -I../../third_party/angle/src -I../../third_party/angle/src/compiler/preprocessor -I../../third_party/angle/src/tests -Igen/angle -I../../testing/gmock/include -I../../testing/gtest/include -isysroot /Applications/Xcode5.1.1.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.10.sdk -O0 -gdwarf-2 -fvisibility=hidden -Werror -Wnewline-eof -mmacosx-version-min=10.6 -arch x86_64 -Wall -Wendif-labels -Wextra -Wno-unused-parameter -Wno-missing-field-initializers -Wno-selector-type-mismatch -Wpartial-availability -Wheader-hygiene -Wno-char-subscripts -Wno-unneeded-internal-declaration -Wno-covered-switch-default -Wstring-conversion -Wno-c++11-narrowing -Wno-deprecated-register -Wno-inconsistent-missing-override -std=c++11 -fno-rtti -fno-exceptions -fvisibility-inlines-hidden -fno-threadsafe-statics -Xclang -load -Xclang /b/build/slave/GPU_Mac_Builder__dbg_/build/src/third_party/llvm-build/Release+Asserts/lib/libFindBadConstructs.dylib -Xclang -add-plugin -Xclang find-bad-constructs -Xclang -plugin-arg-find-bad-constructs -Xclang check-templates -fcolor-diagnostics -fno-strict-aliasing -fstack-protector-all -Wno-undefined-bool-conversion -Wno-tautological-undefined-compare  -c ../../third_party/angle/src/tests/compiler_tests/ConstantFolding_test.cpp -o obj/third_party/angle/src/tests/compiler_tests/angle_unittests.ConstantFolding_test.o ../../third_party/angle/src/tests/compiler_tests/ConstantFolding_test.cpp:210:43: error: no matching constructor for initialization of 'std::vector<float>'     ASSERT_FALSE(constantVectorFoundInAST(std::vector<float>{1.0f 1.0f 1.0f}));                                           ^                 ~~~~~~~~~~~~~~~~~~   BUG=angleproject:913  This reverts commit 2decb4b1557a57a5a74e3ab98d8b25f9fc0f8557.  Change-Id: Iaf3c61a0c0ed591c17f50f2e3eafe2debf588c95 Reviewed-on: https://chromium-review.googlesource.com/274917 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add constant folding support for geometric built-ins  This change adds constant folding support for following geometric built-ins:     - length distance dot cross normalize faceforward       reflect and refract.  BUG=angleproject:913 TEST=angle_unittests dEQP Tests dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.geometric.* (56 tests started passing with this change)  Change-Id: I973689554bb8c30ee3ebdf71f1b8a051ceb5e0cf Reviewed-on: https://chromium-review.googlesource.com/273097 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Change behaviour of string_utils also fix file io.  File IO tested manually in a follow-up patch.  BUG=angleproject:998  Change-Id: I0bfa778d1787cdedfbf3cd68cd134477e6dcd23c Reviewed-on: https://chromium-review.googlesource.com/274030 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Optimize sample caps checks.  We don't need to check NPOT sample counts. This should save us some time on eglInitialize.  BUG=angleproject:1014  Change-Id: Id3b0a440689746d5de9a7fbc3641ff9452b18601 Reviewed-on: https://chromium-review.googlesource.com/274430 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Work around pow() issue in NVIDIA 331.x drivers  pow(x y) when y is a certain kind of a constant vector can cause issues on NVIDIA 331 series drivers. Add an option to replace pow(x y) with exp2(y * log2(x)) when y is a constant to work around this issue.  This is done with an AST traverser instead of BuiltInFunctionEmulator since there's no mechanism in BuiltInFunctionEmulator to apply the replacements only to calls where the second parameter is constant.  TEST=WebGL conformance tests BUG=chromium:477306  Change-Id: Ifb327d72659fca36868439f24705203014b3ce53 Reviewed-on: https://chromium-review.googlesource.com/274279 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Revert "In D3D11 check for 16-bit texture support and use if possible"  Seeing failures on Win7 + Intel machines.  Example build: https://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Release%20%28Intel%29/builds/11756  This reverts commit 673115d9cc4251cd690e14a98ef0c717ba9de0b9.  Change-Id: Ie2b6cc1ae9c4e83dde3a531e38252c95ac2e2a0a Reviewed-on: https://chromium-review.googlesource.com/274450 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Sync the scissor tests state before clearing.  Fixes:  * conformance/rendering/gl-scissor-fbo-test.html  * conformance/rendering/gl-scissor-canvas-dimensions.html  BUG=angleproject:883  Change-Id: Icd337894f1dbc7464a4566bfab9a30b70fd4bbfa Reviewed-on: https://chromium-review.googlesource.com/274445 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix flaky WebGL point-sprites test when using instanced point sprites  Change-Id: I7d417016d9fa3a2e49806543d981ab98a3e71cbc Reviewed-on: https://chromium-review.googlesource.com/273914 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
In D3D11 check for 16-bit texture support and use if possible  BUG=angleproject:1002  Changed since last failed 16-bit patch: - Disabled usage of 16-bit DXGI textures on all Intel cards - Added DXGI->GL conversion entries for 16-bit formats which   fixes FBO readback issues. The ES CTS and dEQP tests which   failed with the last patch now pass.  Change-Id: Ib66abf73f23dbb4329f0a32d7f3dafbbc23e6c08 Reviewed-on: https://chromium-review.googlesource.com/273712 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add Windows SDK path to WinPhone projects  Change-Id: Iaa0bbeba55a277724e4f1851fb0f9db7150308c2 Reviewed-on: https://chromium-review.googlesource.com/274012 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Support BGRA texture by remapping the internal format to RGBA.  The format is still passed as BGRA to the driver so that the data can be properly unpacked.  BUG=angleproject:884  Change-Id: I767626c818ce1a3c5a4739f07aa623bf8a9ae377 Reviewed-on: https://chromium-review.googlesource.com/273162 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add remaining unsized formats to the GL format tables.  BUG=angleproject:884  Change-Id: I53e7ff9e35b820573691df0d23b41ef45e2a07d0 Reviewed-on: https://chromium-review.googlesource.com/273590 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Add ANGLE_REVISION sub-identifier to the DLL versioning scheme  Change-Id: Ie9df84957801def2db72a382f4860bbe4e06002f Reviewed-on: https://chromium-review.googlesource.com/274051 Tested-by: Shawn Hargreaves <shawnhar@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a perf test for eglInitialize.  Also shutdown performance since it's not easy to only test one.  BUG=angleproject:1014  Change-Id: I9d06426788ed336031271f8876589b111f1294b7 Reviewed-on: https://chromium-review.googlesource.com/273974 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Add Shawn Hargreaves (Microsoft Corporation) to CONTRIBUTORS  Change-Id: I23110ecaba34990051ff81c40cb93198e2ad1e9c Reviewed-on: https://chromium-review.googlesource.com/274050 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shawn Hargreaves <shawnhar@microsoft.com>, 23355681, 619, 169, 619
Don't enable opengl on linux unless x11 is also available.  BUG=493682  Change-Id: I10d5b710fcc9b51160c3aff169d1af839212003c Reviewed-on: https://chromium-review.googlesource.com/273976 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add timing stats for Renderer11::initializeDevice.  This gives us insight to what we can optimize away.  BUG=angleproject:1014  Change-Id: I86208c5cbebe14905a05d0859b9e37368f4c25d4 Reviewed-on: https://chromium-review.googlesource.com/273862 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disable UNIMPLEMENTED in ProgramGL::applyUniforms.  Disables lots of assertion failures in WebGL CTS.  BUG=angleproject:882  Change-Id: I407397a256955d608dbf1234e4e391704653bb5a Reviewed-on: https://chromium-review.googlesource.com/273547 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Always init gl_Position in vertex shaders in ShaderGL.  Fixes:  * conformance/glsl/misc/empty_main.vert.html  * conformance/glsl/misc/gl_position_unset.vert.html  BUG=angleproject:882  Change-Id: I92a465b58f319b14e4f697d9bb5b45427a6247c0 Reviewed-on: https://chromium-review.googlesource.com/273548 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Bind renderbuffers as soon as they are generated.  Like textures renderbuffers don't become real objects until they are bound.  If the renderbuffer is never bound before being attached to a framebuffer it would generate an INVALID_OPERATION.  Fixes:  * conformance/textures/tex-input-validation.html  * conformance/renderbuffers/renderbuffer-initialization.html  BUG=angleproject:886  Change-Id: I639b9e2d9ae694dce29f20ed5f95077ae02d471e Reviewed-on: https://chromium-review.googlesource.com/273533 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Clean up most common extra semicolons and braces in HLSL output  Clean up extra semicolons and braces from loops and conditional statements and extra braces from function definitions.  This makes the HLSL output considerably easier to read.  TEST=angle_unittests angle_end2end_tests dEQP-GLES3.functional.shaders.*      WebGL conformance tests BUG=angleproject:1013  Change-Id: I8180bab7b3d4bda1cdb8e4fb51cf9d8e384dd797 Reviewed-on: https://chromium-review.googlesource.com/273607 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Make false blocks produced by RewriteElseBlocks sequence nodes  All child nodes of selection should be sequence nodes so that they will output braces and extra braces can be removed from HLSL output.  Also make RewriteElseBlocks to reuse common IntermTraverser functionality to simplify the code.  TEST=WebGL conformance tests on D3D9 BUG=angleproject:1013  Change-Id: Iafdc05468b22d110abcd020cf52c646dd98fb4a0 Reviewed-on: https://chromium-review.googlesource.com/273608 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Remove ref to intermediate.h.  With https://chromium-review.googlesource.com/213300 b9b5c105799bac1a4738c7589538fab523e3a43d  the file intermediate.h was renamed Intermediate.h. However compiler.gypi now contains references to both but the lower case version doesn't exist anymore so it should be removed.  Change-Id: I6b36bd561f110694daecd4ad911036c94300cd1f Reviewed-on: https://chromium-review.googlesource.com/273593 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Encapsulate GL version and standard into a struct and enum.  Change-Id: I9f51971c1bfd51424605b2687b5fd107d58c9a67 Reviewed-on: https://chromium-review.googlesource.com/273139 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/273572 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Encapsulate GL version and standard into a struct and enum."  Linux didn't like compiling this.  This reverts commit 03f589122ed796060f1345f9ccfc64455c547fef.  Change-Id: Ifd0824caeb02791b4acc5e4bca330ecdc8164b11 Reviewed-on: https://chromium-review.googlesource.com/273583 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Encapsulate GL version and standard into a struct and enum.  Change-Id: Ib3c37627298976040d5a333f4c845a7b2620dd30 Reviewed-on: https://chromium-review.googlesource.com/273139 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Do not always use X11 for Linux builds inherit Chromium's settings  This fixes project generation for Chromium for non-X11 builds  BUG=angleproject:1011  Change-Id: If528f63fb186d834d56a43ca379497d99e74777e Reviewed-on: https://chromium-review.googlesource.com/273163 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Enable PbufferTest on Linux by not advertising bindable configs  GLX Pbuffers are not bindable so implementing bindable pbuffers would have to be one of the following:  - Implement Pbuffer as GLXPixmaps with complication arising in the    initialization.  - Implement Pbuffers as GL textures which would require a large change    of the EGL implementation.  - Fake bindable Pbuffers with glCopyTexImage2D with obvious    performance problems.  BUG=angleproject:892  Change-Id: I7d9cd5a4aa2d35343244be3cbe55fc1e492f6928 Reviewed-on: https://chromium-review.googlesource.com/273056 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Enable OcclusionQueriesTest on Linux  This includes an implementation of a cross platform Sleep function  BUG=angleproject:892  Change-Id: I1087a00ab204b37bafc5e95a9766962b194d97ef Reviewed-on: https://chromium-review.googlesource.com/273133 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Constant fold vector relational built-ins  This change adds constant folding support for vector relational built-ins.  BUG=angleproject:913 TEST=dEQP Tests dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.vector_relational* (Fixes all 138 tests)  Change-Id: I291e332f2afb3ce3d6596e634f509995dbf35164 Reviewed-on: https://chromium-review.googlesource.com/272344 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "In D3D11 check for 16-bit texture support and use if possible"  Causing failures on Windows 8 bots running ES CTS and Windows 7 Intel bot running angle tests.  Example failures: https://build.chromium.org/p/chromium.gpu.fyi/builders/Win8%20Release%20%28NVIDIA%29/builds/14442 https://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Release%20%28Intel%29/builds/11627  This reverts commit d63f08fcc32ea17bac2b025f0ad3261664ff79c9.  Change-Id: I841aee5fb0973432f249277126424b909d5b3e17 Reviewed-on: https://chromium-review.googlesource.com/273416 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
When applying vertex array objects update the currently applied index buffer.  When binding a vertex array object it was not changing the tracked index buffer binding.  This was causing the buffer bindings to sometimes not be updated between index and non-indexed draw calls.  Fixes:  * Intermittent crashes in chromium startup.  * conformance/rendering/many-draw-calls.html  * conformance/rendering/framebuffer-switch.html  * conformance/attribs/gl-bindAttribLocation-aliasing.html  * conformance/attribs/gl-vertex-attrib-render.html  * conformance/buffers/index-validation-verifies-too-many-indices.html  BUG=angleproject:883  Change-Id: I34ed1ebc65b339329c0f9ab9c28a392f552ed3d8 Reviewed-on: https://chromium-review.googlesource.com/273300 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Bind a texture after creation so that it has a type.  If a texture is bound to a framebuffer before any data is set on it the texture does not have a type because it has never been bound.  This generates an INVALID_OPERATION because the attachment type cannot be validated.  Fixes:  * Many generated GL_INVALID_OPERATIONs in chromium  BUG=angleproject:884  Change-Id: I4f36f80fecc5a772b6522f8f82e0be9d3758e524 Reviewed-on: https://chromium-review.googlesource.com/273324 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Check for null attribute buffers before binding.  Fixes:  * Crash in conformance/extensions/oes-vertex-array-object.html  BUG=angleproject:880  Change-Id: I90eba9b26b2834644ce3ba0e78cab3417c2a7bd1 Reviewed-on: https://chromium-review.googlesource.com/273325 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Handle function calls where returned array is not used  This is done by declaring a temporary variable which is passed as the array out parameter defined by ArrayReturnValueToOutParameter. SeparateExpressionsReturningArrays takes care of transforming the rest of the cases where a function call returns an array into form that ArrayReturnValueToOutParameter can handle.  BUG=angleproject:971 TEST=WebGL 2 conformance tests dEQP-GLES3.functional.shaders.arrays.*  Change-Id: I70c07712ba5cd91efb4c2e575ecc49b9ef71bfd7 Reviewed-on: https://chromium-review.googlesource.com/273111 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix destructing TStrings through BuiltInFunctionEmulator after free  BuiltInFunctionEmulator gets destructed after the PoolAllocator has already freed memory. That's why BuiltInFunctionEmulator can't hold any objects that contain parts stored in the memory pool that would be accessed in its destructor. Use only pointers to TType objects inside BuiltInFunctionEmulator so that the BuiltInFunctionEmulator destructor doesn't access TStrings which have data in the memory pool.  Also fix style issues in BuiltInFunctionEmulator.  BUG=angleproject:1010 TEST=dEQP-GLES3.functional.shaders.builtin_functions.*  Change-Id: Ic35caf80bf125d0427c2ed2024e98657756103b6 Reviewed-on: https://chromium-review.googlesource.com/272738 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Check that #version 300 es directive is on the first line  ESSL3.00 and 3.10 specs don't allow even newlines before the version directive.  BUG=angleproject:1009 TEST=WebGL 2 conformance tests angle_unittests  Change-Id: Id7967829077e35e03572c724e0eafffbed0c975b Reviewed-on: https://chromium-review.googlesource.com/272719 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix small issues in array related AST transformations  Make sure that user-defined bit stays in place when copying function call nodes and that mInFunctionWithArrayReturnValue gets reset correctly in ArrayReturnValueToOutParameter.  BUG=angleproject:971 TEST=WebGL 2 conformance tests  Change-Id: I385f4ce4990597e44ddad4f0fa6db23b661771dc Reviewed-on: https://chromium-review.googlesource.com/273110 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix missing break statements.  Fixes:  * conformance/glsl/functions/glsl-function*  BUG=angleproject:883  Change-Id: I22a528c6ba4c4077ba47269e14396b4117d1c849 Reviewed-on: https://chromium-review.googlesource.com/273169 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
In D3D11 check for 16-bit texture support and use if possible  BUG=angleproject:1002  Change-Id: I36a5ee774b38e9865b2eb6c6789afd316c4eff16 Reviewed-on: https://chromium-review.googlesource.com/272061 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Fix order of TearDown of EGLSurfaceTest  Previously the OS window was deleted before the EGL window surface which caused the GLX window to be deleted after its X window was deleted. All this was invalid and resulted in a crash.  BUG=angleproject:892  Change-Id: I394795b6ebce947ad7eeab9a70ad5f80fcd89241 Reviewed-on: https://chromium-review.googlesource.com/273055 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
WindowSurfaceGLX handle resizing the window on swap  This make the multi window sample work well.  BUG=angleproject:892  Change-Id: If98c6f995875b63c391cee9b6fddc6d138d48f8b Reviewed-on: https://chromium-review.googlesource.com/272946 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Report warning whenever constant folding results are undefined  With recent constant folding changes we are reporting warnings whenever constant folding results are undefined for values passed in this change adds that warning at all the places where it was missing.  BUG=angleproject:913 TEST=dEQP Tests angle_unittests  Change-Id: Ief8380488e2a4807c91ddac06d342cb172433b9d Reviewed-on: https://chromium-review.googlesource.com/272879 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Use absolute paths in angle_perftests.gypi  Otherwise in the Chromium build gyp might have a wrong cwd and then ninja will fail to find the files to compile.  BUG=angleproject:892  Change-Id: I6b7beef5ecad62cc345b49253cedbde0ac166c17 Reviewed-on: https://chromium-review.googlesource.com/273161 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disable some tests due to failures on Intel OpenGL.  BUG=angleproject:884  Change-Id: Iceb571807a2232dae22703953e12e1af4bba5a87 Reviewed-on: https://chromium-review.googlesource.com/273029 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Merge separate definitions of include_dirs for perftests  BUG=angleproject:892  Change-Id: Ifd108b3119ea73c05e984ca9138536fb8cf6839c Reviewed-on: https://chromium-review.googlesource.com/273137 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add table entries for almost all the remaining GL texture formats.  BUG=angleproject:884 BUG=angleproject:967  Change-Id: I113757dd9e1fae8fe0241a7286be979a90891b53 Reviewed-on: https://chromium-review.googlesource.com/270275 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/273135, 23355681, 619, 169, 619
Revert "Add table entries for almost all the remaining GL texture formats."  Missing include of <limits> for linux.  This reverts commit aa3a5fadebb2bad0be07eb2963a9d23f901c4c49.  Change-Id: Iafebfbc6154b4fe3a94e3f8b91b5ff496631c1f1 Reviewed-on: https://chromium-review.googlesource.com/273134 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Rename path_utils to system_utils  For inclusion of Sleep  BUG=angleproject:892  Change-Id: I1a9491102e9943d945eef0ba372a6779c30cd311 Reviewed-on: https://chromium-review.googlesource.com/273131 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Enable EGLSurfaceTest on Linux  BUG=angleproject:892  Change-Id: I142ab37e00e2ba7fc2316aff564cc449eeb22771 Reviewed-on: https://chromium-review.googlesource.com/273130 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Poll all windows in the multi window sample  On Linux all windows are polled separately contrary to windows in which the callback is used on all windows.  BUG=angleproject:892  Change-Id: Ib1538f12ab2fa1864d29c91b9c5bfc2204cd1fa7 Reviewed-on: https://chromium-review.googlesource.com/272945 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Simplify the implementation of ANGLE_INSTANTIATE_TEST  I mistakenly submitted a refactor with +2 but not +1 so a comment wasn't addressed hopefully fixes it.  BUG=angleproject:892  Change-Id: I096c2424449be196dfa949cc6ef662b766036330 Reviewed-on: https://chromium-review.googlesource.com/272905 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix styling issues in ParseContext.cpp  There were lot of styling issues in ParseContext.cpp mostly related to opening braces on same line as conditional statement and pointers and references not being tight to the variable in variable declarations this change fixes them.  TEST=angle_unittests  Change-Id: Ia225726254bcf5f315c13054ff41c5ff9cfe0992 Reviewed-on: https://chromium-review.googlesource.com/272846 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add table entries for almost all the remaining GL texture formats.  BUG=angleproject:884 BUG=angleproject:967  Change-Id: I0b05841272f4410c33ee4e4c3654846f07b7c39b Reviewed-on: https://chromium-review.googlesource.com/270275 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement swapInterval for EGL on GLX  BUG=angleproject:892  Change-Id: I80d8d67270662c7f2be893f4a8318fbc0926f1fc Reviewed-on: https://chromium-review.googlesource.com/272677 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add timer histogram for egl::Initialize time.  This can help is track startup time regressions within ANGLE.  BUG=436191 BUG=angleproject:944  Change-Id: I73cf2449661b909dced4ddc11957037ed5535fc0 Reviewed-on: https://chromium-review.googlesource.com/272613 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add an end2end test checking EGL context-surface compatibility  This has been very useful to figure out the FBConfig story for the GLX EGL implementation.  BUG=angleproject:892  Change-Id: Ie4138dd1dd98f1450984a61317e3fc863c620ad3 Reviewed-on: https://chromium-review.googlesource.com/272371 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/272907, 23355681, 619, 169, 619
Revert "Add an end2end test checking EGL context-surface compatibility"  Failing due to a bug in the test:  BUG=angleproject:892  This reverts commit 08971bff3e24b516fcfd5327a51801bc270d3987.  Change-Id: I5f97f5e00f8b820874d575421b9a50829bb6f1e0 Reviewed-on: https://chromium-review.googlesource.com/272912 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Pick return value from copyTexture.  Change-Id: Ia04358645348326c5577854053b550426121e64e Reviewed-on: https://chromium-review.googlesource.com/272765 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Cooper Partin <coopp@microsoft.com> Tested-by: Minmin Gong <mgong@microsoft.com>, 23355681, 619, 169, 619
Added compiler flags to enable Control Flow Guard.  Change-Id: I86e24b83e2e9b279c93c518ab9bc7dafd4b3d006 Reviewed-on: https://chromium-review.googlesource.com/272501 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
X11Window: handling of ConfigureNotify work when reparented  BUG=angleproject:892  Change-Id: Ib201a5fbf4fca39c90464ed76434dac5e5ded381 Reviewed-on: https://chromium-review.googlesource.com/272683 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add perftest parameters for OpenGL  BUG=angleproject:892  Change-Id: Ia22b8ab48456d6fbccb159404e943f9ef2650bdc Reviewed-on: https://chromium-review.googlesource.com/272610 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Make perftests use ANGLE_INSTANTIATE_TEST  This also moves ANGLE_INSTANTIATE_TEST to its own header and makes it generic over the type of test parameter.  BUG=angleproject:892  Change-Id: Id4e3929d7ad06964b3259015915be84a8ee414f9 Reviewed-on: https://chromium-review.googlesource.com/272553 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Make eglMakeCurrent validate for config compatibility  See section 2.2 of the EGL 1.5 specification.  BUG=angleproject:892  Change-Id: I2a43260e53cb045b2e06b0e50915e228cec96f33 Reviewed-on: https://chromium-review.googlesource.com/272370 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Correct LinuxTimer time calculations  Changes to CLOCK_MONOTONIC as CLOCK_PROCESS_CPUTIME counts only user time and not kernel time.  BUG=angleproject:892  Change-Id: I3d5aee26ee2bacd7449fdd7795ad8c2b289d7324 Reviewed-on: https://chromium-review.googlesource.com/272652 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Make perftests compile on Linux  BUG=angleproject:892  Change-Id: I3fe43c7a84d1eb2b875309495fe27a0bfd6c3e82 Reviewed-on: https://chromium-review.googlesource.com/272552 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add an end2end test checking EGL context-surface compatibility  This has been very useful to figure out the FBConfig story for the GLX EGL implementation.  BUG=angleproject:892  Change-Id: Icd9afd8e4bdd8766d2fa727afcaf20826c2faf2a Reviewed-on: https://chromium-review.googlesource.com/272371 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Load texture storage extension entry points in RendererGL.  BUG=angleproject:884  Change-Id: Iaef596337f9c4d781fb93f517c8f605d119136fb Reviewed-on: https://chromium-review.googlesource.com/266599 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/272746 Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Load texture storage extension entry points in RendererGL."  This reverts commit 5ec636f67cb65438b71ca46375fa45e33eb2e4ba.  Change-Id: I68b87279f08e558948216630259349e4db8481d7 Reviewed-on: https://chromium-review.googlesource.com/272785 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Load texture storage extension entry points in RendererGL.  BUG=angleproject:884  Change-Id: I30e688ca4304b0a0a1c939edee95d75faf8e8485 Reviewed-on: https://chromium-review.googlesource.com/266599 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Separate expressions returning arrays for HLSL output  Complex array expressions need to be broken down in HLSL output so that they are built out of simple combinations of operations and symbols.  In practice this means that array constructors array assignments and functions that return arrays inside complex expressions need to be replaced by symbols.  After this change ANGLE passes all dEQP-GLES3.functional.shaders.arrays tests.  The old SimplifyArrayAssignment stub is removed the new name SeparateExpressionsReturningArrays more closely reflects what the function needs to do.  BUG=angleproject:971 angleproject:941 TEST=dEQP-GLES3.functional.shaders.arrays.* WebGL 2 conformance tests  Change-Id: Iab8dde72b1126dc2f958ffb5b1b830fe3ce25912 Reviewed-on: https://chromium-review.googlesource.com/272122 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Refactoring: Make creating temporary symbols in AST traversal reusable  Temporary symbols will also be needed to store temporary arrays when complex array expressions are unfolded.  Also clear tree update related structures at the end of updateTree() so that the traverser can be reused for several rounds of replacement more easily and remove unnecessary InVisit step from UnfoldShortCircuitToIf.  BUG=angleproject:971 TEST=angle_end2end_tests WebGL conformance tests  Change-Id: Iecdd3008d43f01b02fe344ccde8614f70e6c0c65 Reviewed-on: https://chromium-review.googlesource.com/272121 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add constant folding support for more built-ins  This change adds constant folding support for following built-ins:   - atan(two arguments) pow mod mix step and smoothstep.  BUG=angleproject:913 TEST=dEQP tests Following 80 tests from dEQP-GLES3.functional.shaders.constant_expressions started passing with this change:  - builtin_functions.angle_and_trigonometry.atan_separate*  - builtin_functions.exponential.pow_*  - builtin_functions.common.mod_*  - builtin_functions.common.mix_*  - builtin_functions.common.step_*  - builtin_functions.common.smoothstep_*  Change-Id: I70f0a8837a82c480da8cff3f1382c6252a486fe4 Reviewed-on: https://chromium-review.googlesource.com/271753 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix warning in string_utils.cpp in Win32  BUG=  Change-Id: Ibb25d46c2ee5f361f6a948dc3efea38422a4573f Reviewed-on: https://chromium-review.googlesource.com/272559 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix -Winconsistent-override in Mock classes  Gmock defines virtual functions without the override keyword so the constructors using override here caused a warning.  BUG=angleproject:892  Change-Id: I2a8f0445aa4a1e09694b7f98a6da07f8abaa47fb Reviewed-on: https://chromium-review.googlesource.com/272551 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Revert "Call XSync in the GLX EGL impl if we have a new X server connection""  This reverts commit 9c0a421858162673f4232d37bf8c5e2459ec28ea.  Change-Id: Ia543daebc240b81950e21930895a7e24ed9f7a1b Reviewed-on: https://chromium-review.googlesource.com/272225 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add some string helper classes.  *re-land with build fix for Clang*  These helper functions mirror some utilities in Chrome for splitting strings along whitespace or reading file contents into a string.  Also remove the hack for skipping the doubly-defined GLX header.  BUG=angleproject:892angleproject:998  Change-Id: Ife43fbf5035a3be7820460bea1b26d0e632a4fb0 Reviewed-on: https://chromium-review.googlesource.com/272518 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Handle compressed texture formats in the emulated TextureStorage for TextureGL.  BUG=angleproject:884  Change-Id: Id54d9ff2845af52807161e0b589d8b76cfba412d Reviewed-on: https://chromium-review.googlesource.com/272424 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Pipe the imageSize parameter from the entry point to avoid recomputation.  BUG=angleproject:884  Change-Id: Ic4d5bdc5b65ebcb8c57b960e84708e945db0276a Reviewed-on: https://chromium-review.googlesource.com/272422 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Add some string helper classes."  Build errors on Clang:  FAILED: /b/build/goma/gomacc ../../third_party/llvm-build/Release+Asserts/bin/clang++ -MMD -MF obj/third_party/angle/src/common/angle_common.string_utils.o.d -DV8_DEPRECATION_WARNINGS -D__ASSERT_MACROS_DEFINE_VERSIONS_WITHOUT_UNDERSCORE=0 -DCHROMIUM_BUILD -DCR_CLANG_REVISION=233105-2 -DTOOLKIT_VIEWS=1 -DUSE_LIBJPEG_TURBO=1 -DENABLE_ONE_CLICK_SIGNIN -DENABLE_PRE_SYNC_BACKUP -DENABLE_REMOTING=1 -DENABLE_WEBRTC=1 -DENABLE_MEDIA_ROUTER=1 -DUSE_PROPRIETARY_CODECS -DENABLE_PEPPER_CDMS -DENABLE_CONFIGURATION_POLICY -DENABLE_NOTIFICATIONS -DENABLE_HIDPI=1 -DSYSTEM_NATIVELY_SIGNALS_MEMORY_PRESSURE -DDONT_EMBED_BUILD_METADATA -DDCHECK_ALWAYS_ON=1 -DENABLE_TASK_MANAGER=1 -DENABLE_EXTENSIONS=1 -DENABLE_PLUGIN_INSTALLATION=1 -DENABLE_PLUGINS=1 -DENABLE_SESSION_SERVICE=1 -DENABLE_THEMES=1 -DENABLE_AUTOFILL_DIALOG=1 -DENABLE_BACKGROUND=1 -DENABLE_GOOGLE_NOW=1 -DCLD_VERSION=2 -DENABLE_PRINTING=1 -DENABLE_BASIC_PRINTING=1 -DENABLE_PRINT_PREVIEW=1 -DENABLE_SPELLCHECK=1 -DENABLE_CAPTIVE_PORTAL_DETECTION=1 -DENABLE_APP_LIST=1 -DENABLE_SETTINGS_APP=1 -DENABLE_SUPERVISED_USERS=1 -DENABLE_SERVICE_DISCOVERY=1 -DENABLE_WIFI_BOOTSTRAPPING=1 -DV8_USE_EXTERNAL_STARTUP_DATA -DFULL_SAFE_BROWSING -DSAFE_BROWSING_CSD -DSAFE_BROWSING_DB_LOCAL -DSAFE_BROWSING_SERVICE -DUSE_LIBPCI=1 -DUSE_OPENSSL=1 -DNDEBUG -DNVALGRIND -DDYNAMIC_ANNOTATIONS_ENABLED=0 -Igen -I../../third_party/angle/src -I../../third_party/angle/include -isysroot /Applications/Xcode5.1.1.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.10.sdk -O2 -gdwarf-2 -fvisibility=hidden -Werror -Wnewline-eof -mmacosx-version-min=10.6 -arch x86_64 -Wendif-labels -Wno-unused-parameter -Wno-missing-field-initializers -Wno-selector-type-mismatch -Wpartial-availability -Wheader-hygiene -Wno-char-subscripts -Wno-unneeded-internal-declaration -Wno-covered-switch-default -Wstring-conversion -Wno-c++11-narrowing -Wno-deprecated-register -Wno-inconsistent-missing-override -std=c++11 -fno-rtti -fno-exceptions -fvisibility-inlines-hidden -fno-threadsafe-statics -Xclang -load -Xclang /b/build/slave/GPU_Mac_Builder/build/src/third_party/llvm-build/Release+Asserts/lib/libFindBadConstructs.dylib -Xclang -add-plugin -Xclang find-bad-constructs -fcolor-diagnostics -fno-strict-aliasing  -c ../../third_party/angle/src/common/string_utils.cpp -o obj/third_party/angle/src/common/angle_common.string_utils.o ../../third_party/angle/src/common/string_utils.cpp:72:19: error: no matching constructor for initialization of 'std::ifstream' (aka 'basic_ifstream<char>')     std::ifstream inFile(path);                   ^      ~~~~ /Applications/Xcode5.1.1.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.10.sdk/usr/include/c++/4.2.1/fstream:465:7: note: candidate constructor not viable: no known conversion from 'const std::string' (aka 'const basic_string<char>') to 'const char *' for 1st argument       basic_ifstream(const char* __s ios_base::openmode __mode = ios_base::in)       ^ /Applications/Xcode5.1.1.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.10.sdk/usr/include/c++/4.2.1/bits/fstream.tcc:894:25: note: candidate constructor (the implicit copy constructor) not viable: no known conversion from 'const std::string' (aka 'const basic_string<char>') to 'const std::basic_ifstream<char>' for 1st argument   extern template class basic_ifstream<char>;                         ^ /Applications/Xcode5.1.1.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.10.sdk/usr/include/c++/4.2.1/fstream:451:7: note: candidate constructor not viable: requires 0 arguments but 1 was provided       basic_ifstream() : __istream_type() _M_filebuf()       ^ 1 error generated. FAILED: /b/build/goma/gomacc ../../third_party/llvm-build/Release+Asserts/bin/clang++ -MMD -MF obj/third_party/angle/src/common/angle_unittests.string_utils_unittest.o.d -DV8_DEPRECATION_WARNINGS -D__ASSERT_MACROS_DEFINE_VERSIONS_WITHOUT_UNDERSCORE=0 -DCHROMIUM_BUILD -DCR_CLANG_REVISION=233105-2 -DTOOLKIT_VIEWS=1 -DUSE_LIBJPEG_TURBO=1 -DENABLE_ONE_CLICK_SIGNIN -DENABLE_PRE_SYNC_BACKUP -DENABLE_REMOTING=1 -DENABLE_WEBRTC=1 -DENABLE_MEDIA_ROUTER=1 -DUSE_PROPRIETARY_CODECS -DENABLE_PEPPER_CDMS -DENABLE_CONFIGURATION_POLICY -DENABLE_NOTIFICATIONS -DENABLE_HIDPI=1 -DSYSTEM_NATIVELY_SIGNALS_MEMORY_PRESSURE -DDONT_EMBED_BUILD_METADATA -DDCHECK_ALWAYS_ON=1 -DENABLE_TASK_MANAGER=1 -DENABLE_EXTENSIONS=1 -DENABLE_PLUGIN_INSTALLATION=1 -DENABLE_PLUGINS=1 -DENABLE_SESSION_SERVICE=1 -DENABLE_THEMES=1 -DENABLE_AUTOFILL_DIALOG=1 -DENABLE_BACKGROUND=1 -DENABLE_GOOGLE_NOW=1 -DCLD_VERSION=2 -DENABLE_PRINTING=1 -DENABLE_BASIC_PRINTING=1 -DENABLE_PRINT_PREVIEW=1 -DENABLE_SPELLCHECK=1 -DENABLE_CAPTIVE_PORTAL_DETECTION=1 -DENABLE_APP_LIST=1 -DENABLE_SETTINGS_APP=1 -DENABLE_SUPERVISED_USERS=1 -DENABLE_SERVICE_DISCOVERY=1 -DENABLE_WIFI_BOOTSTRAPPING=1 -DV8_USE_EXTERNAL_STARTUP_DATA -DFULL_SAFE_BROWSING -DSAFE_BROWSING_CSD -DSAFE_BROWSING_DB_LOCAL -DSAFE_BROWSING_SERVICE -DGTEST_HAS_POSIX_RE=0 -DGTEST_LANG_CXX11=0 -DGL_APICALL= -DGL_GLEXT_PROTOTYPES= -DEGLAPI= '-DANGLE_PRELOADED_D3DCOMPILER_MODULE_NAMES={ "d3dcompiler_47.dll" "d3dcompiler_46.dll" "d3dcompiler_43.dll" }' -DANGLE_TRANSLATOR_STATIC -DUSE_LIBPCI=1 -DUSE_OPENSSL=1 -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -DNDEBUG -DNVALGRIND -DDYNAMIC_ANNOTATIONS_ENABLED=0 -D_FORTIFY_SOURCE=2 -Igen -I../.. -I../../third_party/angle/include -I../../third_party/angle/src -I../../third_party/angle/src/compiler/preprocessor -I../../third_party/angle/src/tests -Igen/angle -I../../testing/gmock/include -I../../testing/gtest/include -isysroot /Applications/Xcode5.1.1.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.10.sdk -O2 -gdwarf-2 -fvisibility=hidden -Werror -Wnewline-eof -mmacosx-version-min=10.6 -arch x86_64 -Wall -Wendif-labels -Wextra -Wno-unused-parameter -Wno-missing-field-initializers -Wno-selector-type-mismatch -Wpartial-availability -Wheader-hygiene -Wno-char-subscripts -Wno-unneeded-internal-declaration -Wno-covered-switch-default -Wstring-conversion -Wno-c++11-narrowing -Wno-deprecated-register -Wno-inconsistent-missing-override -std=c++11 -fno-rtti -fno-exceptions -fvisibility-inlines-hidden -fno-threadsafe-statics -Xclang -load -Xclang /b/build/slave/GPU_Mac_Builder/build/src/third_party/llvm-build/Release+Asserts/lib/libFindBadConstructs.dylib -Xclang -add-plugin -Xclang find-bad-constructs -fcolor-diagnostics -fno-strict-aliasing  -c ../../third_party/angle/src/common/string_utils_unittest.cpp -o obj/third_party/angle/src/common/angle_unittests.string_utils_unittest.o In file included from ../../third_party/angle/src/common/string_utils_unittest.cpp:12: ../../testing/gtest/include/gtest/gtest.h:1481:16: error: comparison of integers of different signs: 'const int' and 'const unsigned int' [-Werror-Wsign-compare]   if (expected == actual) {       ~~~~~~~~ ^  ~~~~~~ ../../testing/gtest/include/gtest/gtest.h:1511:12: note: in instantiation of function template specialization 'testing::internal::CmpHelperEQ<int unsigned int>' requested here     return CmpHelperEQ(expected_expression actual_expression expected            ^ ../../third_party/angle/src/common/string_utils_unittest.cpp:55:5: note: in instantiation of function template specialization 'testing::internal::EqHelper<false>::Compare<int unsigned int>' requested here     EXPECT_EQ(0xBADF00D uintValue);     ^ ../../testing/gtest/include/gtest/gtest.h:2017:67: note: expanded from macro 'EXPECT_EQ'                       EqHelper<GTEST_IS_NULL_LITERAL_(expected)>::Compare \                                                                   ^ ../../testing/gtest/include/gtest/gtest_pred_impl.h:162:23: note: expanded from macro 'EXPECT_PRED_FORMAT2'   GTEST_PRED_FORMAT2_(pred_format v1 v2 GTEST_NONFATAL_FAILURE_)                       ^ ../../testing/gtest/include/gtest/gtest_pred_impl.h:147:17: note: expanded from macro 'GTEST_PRED_FORMAT2_'   GTEST_ASSERT_(pred_format(#v1 #v2 v1 v2) \                 ^ ../../testing/gtest/include/gtest/gtest_pred_impl.h:77:52: note: expanded from macro 'GTEST_ASSERT_'   if (const ::testing::AssertionResult gtest_ar = (expression)) \                                                    ^ BUG=angleproject:892angleproject:998  This reverts commit fa5fb6f1ef685af316b320530ffbb425bb63446e.  Change-Id: I949debbd365926301ec19225f262484fa3b8e13b Reviewed-on: https://chromium-review.googlesource.com/272548 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add some string helper classes.  These helper functions mirror some utilities in Chrome for splitting strings along whitespace or reading file contents into a string.  Also remove the hack for skipping the doubly-defined GLX header.  BUG=angleproject:892angleproject:998  Change-Id: Ie617be7e02c2ccc684028500aabb54561c9c6c14 Reviewed-on: https://chromium-review.googlesource.com/272436 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "In D3D11 with DXGI1.2 use B5G6R5 for GL_RGB565"  Causing a failure in the end2end_test (in Debug):  ClearTest.ClearIssue/1  Renderer11::createRenderTarget returns unsupported when trying to create a BGR565 texture.  BUG=angleproject:1002  This reverts commit 72a31d66e9f2b6bd0beff57af5278ef1348d09bd.  Change-Id: I9e052c78517abbcb22a678a949fdb81d6ba67eb7 Reviewed-on: https://chromium-review.googlesource.com/272543 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
In D3D11 with DXGI1.2 use B5G6R5 for GL_RGB565  *re-land with build fix*  BUG=angleproject:1002  Change-Id: Ic1d8ea23dc1bf56e713e5d991ab9edd48978d3d7 Reviewed-on: https://chromium-review.googlesource.com/272515 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "In D3D11 with DXGI1.2 use B5G6R5 for GL_RGB565"  Build break on Windows due to a rebase conflict (relocated header)  24>..\..\src\tests\gl_tests\SixteenBppTextureTest.cpp(9): fatal error C1083: Cannot open include file: 'end2end_tests/ANGLETest.h': No such file or directory  BUG=angleproject:1002 This reverts commit 5224926d11de22e6f0043d6b25ace7d3c4b60b28.  Change-Id: I4ed4e918ca5bcd85367ed3e364e29039fcdf5619 Reviewed-on: https://chromium-review.googlesource.com/272542 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
In D3D11 with DXGI1.2 use B5G6R5 for GL_RGB565  BUG=angleproject:1002  Change-Id: I13dfe218fd9dce6581843d7fab33ce482187e351 Reviewed-on: https://chromium-review.googlesource.com/270771 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix ninja build warning on Linux.  The 'all' target has a special meaning to ninja and it would complain about having two 'all' targets. Fix this by using a capital 'a'.  BUG=None  Change-Id: I3ce2aab8df4bdfc8f49361f514881005547c51bf Reviewed-on: https://chromium-review.googlesource.com/272258 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Always mark *_Base configurations as abstract.  These configurations were showing up in generated projects that angle is included in because those projects don't see our common.gypi file that marks these configurations as abstract.  Change-Id: I2c93e82567619d23f8535bd4f77446a1f837707f Reviewed-on: https://chromium-review.googlesource.com/270282 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Determine packed depth stencil extension support automatically.  BUG=angleproject:884  Change-Id: If2b8fd94b0354449ba7e629606d7b1b2c2430fd1 Reviewed-on: https://chromium-review.googlesource.com/272421 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add simple_vertex_shader back to the GYP  Change-Id: I1d078af32c725e7bdd5b366ff8218758049f5a38 Reviewed-on: https://chromium-review.googlesource.com/272065 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Remove un-needed swapBuffers calls in the tests.  If a glReadPixels is done after a swapBuffers it's results are often undefined.  bug=angleproject:967  Change-Id: I4a99ca47624347ecbc0a5c084e93b997c92e1b31 Reviewed-on: https://chromium-review.googlesource.com/272423 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove proxy header for ANGLETest.h  It is no longer needed as https://codereview.chromium.org/1134953003/ has been landed.  BUG=angleproject:892  Change-Id: I3923a7bda2d4a3d70d128f7210fab35837df435d Reviewed-on: https://chromium-review.googlesource.com/272380 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Write the single/double buffer investigation results  BUG=angleproject:892  Change-Id: I163e3b674cdb5357cfaf31305f4776dc4c895af1 Reviewed-on: https://chromium-review.googlesource.com/272228 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Release egl::Surface on Texture image changes.  We would get into a broken state if the user would bind a Texture to an egl::Surface then change the Texture. This is valid in egl and should release the Surface when it happens.  BUG=485543  Change-Id: Idfaa305ac704f2bc579e79be816e88a23e69351b Reviewed-on: https://chromium-review.googlesource.com/271986 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix most occurences of -Winconsistent-missing-override  Other occurences are in code generated by macro in googlemock.  BUG=angleproject:892  Change-Id: I8b2c6ad4b793be2d9a440687b1b010c9feb8bdae Reviewed-on: https://chromium-review.googlesource.com/272224 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
FunctionsGLX: Remove all but one of the ANGLE dependencies  A follow-up CL will make it so the dependencies on TokenizeExtensionString doesn't pull the GL headers this will then allow use to remove the hack for the inclusion of glx.h  BUG=angleproject:892  Change-Id: I51c5466617057e2c580bd5e8056307515bcecc4b Reviewed-on: https://chromium-review.googlesource.com/272206 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Completely isolate GLX in FunctionsGLX  This makes it so it is the only file including glx.h.  BUG=angleproject:892  Change-Id: I5c45b659ec102b7a2c92e010a6843fa21b7c664b Reviewed-on: https://chromium-review.googlesource.com/271418 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Ensure that conditional blocks and loop bodies are sequence nodes  AST transformations such as unfolding logical operations can only create nodes inside sequence (block) nodes. This patch ensures that these AST transformations work even inside conditional blocks and loop bodies that were first parsed as single statements instead of blocks.  BUG=angleproject:971 TEST=WebGL conformance tests  Change-Id: If98cb7be653ec7b005537b89547f4f4cf1c07c72 Reviewed-on: https://chromium-review.googlesource.com/272141 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
In D3D11 return 0 if not conformant rather than GL_NONE  Change-Id: Ica6484d1b5960f162ad88648ff9b2b9b96710930 Reviewed-on: https://chromium-review.googlesource.com/272166 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Updated generate_winrt_projects to produce Windows 10 projects  BUG=angleproject:1004  Change-Id: I6f50226b21ff92ac85dbe5ed2e39dcc4f7e39306 Reviewed-on: https://chromium-review.googlesource.com/272160 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactoring: make tracking parent block position in AST traversal reusable  Add a helper function to make it easier for traverser classes to insert statements and use it in UnfoldShortCircuitToIf.  BUG=angleproject:971 TEST=angle_end2end_tests WebGL conformance tests  Change-Id: I141bdd8abf4b01988581e6cb27c2320bf38370ac Reviewed-on: https://chromium-review.googlesource.com/272140 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add ANGLE support for ESSL3 variant of mix()  This change adds support for ESSL3 variant of built-in function mix() that takes last argument as a boolean vector. lerp() - HLSL equivalent of mix() doesn't look to be supporting a variant that takes last argument as a boolean vector so emulated it for HLSL.  BUG=angleproject:1006 TESTS=dEQP tests Fixes "no matching overloaded function found " errors in below tests: dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.common.mix_*_b* (Note: These tests still fail because of constant expression issues)  Change-Id: I79b353933cb450516b8678b1fdaeabe60417e9a7 Reviewed-on: https://chromium-review.googlesource.com/271751 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Combine D3D11 FL10_0+ and FL9_3 format support tables  BUG=angleproject:1002  Change-Id: I4305db01c0ca40fd0ccf0dd441744b6184d5e945 Reviewed-on: https://chromium-review.googlesource.com/270770 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Combine D3D11 FL10_0+ and FL9_3 LoadFunctionMaps  BUG=angleproject:1002  A 'LoadFunction' is used to load data of a given <GL format GL type> pair into a specific DXGI_FORMAT. Before this change BuildD3D11LoadFunctionMap mapped <GL format GL type> pairs to LoadFunctions. This meant each <GL format GL type> pair could only loaded using one LoadFunction and therefore could only be loaded into one specific DXGI_FORMAT.  We now want to map <GL format GL type DXGI_FORMAT> triples to LoadFunctions. This allows us to use different DXGI_FORMATS for each <GL format GL type> pair depending on the capabilities of the underlying D3D11 device.  Change-Id: I3b5e24c4bf98f18360ddd45b2022a90b5000f866 Reviewed-on: https://chromium-review.googlesource.com/270561 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
DisplayGLX: rework the GLXFBConfig selection  This allows us to return multiple EGL configs in particular we can have configs with no depth-stencil buffer. Also includes a description of the investigation I did for this patch.  BUG=angleproject:892  Change-Id: I921e254e91e818396dd4c9bd0ee2a43b00a043b9 Reviewed-on: https://chromium-review.googlesource.com/271426 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Roll GYP for Windows 10 project generation.  BUG=angleproject:1004  Change-Id: Ide2f71f1aee70d0d962ff275ac9bd0f852b218ac Reviewed-on: https://chromium-review.googlesource.com/271482 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
eglGetConfigAttrib: handle EGL_NATIVE_VISUAL_ID  BUG=angleproject:892  Change-Id: Idf5496de7006f8fd0658e9d40a4f16dba00d90ea Reviewed-on: https://chromium-review.googlesource.com/271473 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix more warnings in samples and tests  These warnings are currently disabled because these files are not with angle_code set to 1 in the gyp files to avoid gtest's code warnings. We hope to either fix warnings in gtest or change our build system to not use warnings for gtest.  BUG=angleproject:1003  Change-Id: I281781b77f92ef8c394dd53fbbd50d525e4da5c9 Reviewed-on: https://chromium-review.googlesource.com/271412 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Enable more warnings on GCC and clang  BUG=angleproject:892  Change-Id: I74ca341f29b245f698d1e1ad43149a91db46817f Reviewed-on: https://chromium-review.googlesource.com/271411 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Roll dEQP.  Includes fixes for some tests and a new null platform class which makes generating case lists easier.  BUG=angleproject:998  Change-Id: I1641c579bb63713fccde05e48f0cea31324f7d1b Reviewed-on: https://chromium-review.googlesource.com/271202 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Clear image descs on Impl errors."  Didn't fix the crash and the crash experiment is complete.  BUG=485543  This reverts commit 9674850737bd3e7f44fdc9d1ddc42fffd76f2997.  Change-Id: If7d97901b87506bf306ab5558575d0413c76cb68 Reviewed-on: https://chromium-review.googlesource.com/272150 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Set mUsesDiscardRewriting more conservatively  This fixes a regression from recent refactoring of unfolding short-circuiting operators. mUsesDiscardRewriting used to be set based on detecting patterns that the AST traverser now overwrites before the code reaches OutputHLSL. With this patch mUsesDiscardRewriting is set more conservatively which ensures that using discard works correctly also in case the input shader contains the same kind of pattern as the short-circuiting operator unfolding creates.  TEST=WebGL conformance tests on D3D9 BUG=chromium:488552  Change-Id: Iea0103822a268079593b0913f0b6fc54c745c6e3 Reviewed-on: https://chromium-review.googlesource.com/271761 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add constant folding support for minmax and clamp  This change adds necessary mechanism to support constant folding of built-ins that take more than one parameter and also adds constant folding support for min max and clamp built-ins.  BUG=angleproject:913 TESTS=dEQP tests (126 tests started passing with this change) dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.common.min_* dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.common.max_* dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.common.clamp_*  Change-Id: Iccc9bf503a536f2e3c144627e64572f2f95db9db Reviewed-on: https://chromium-review.googlesource.com/271251 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
WindowSurfaceGLX: set the border pixel attribute  This is so we can use a different visual depth than our parent window so that we can create a subwindow whichever the parent's visual.  BUG=angleproject:892  Change-Id: I9bab676761b1f80fad1599adb8e97a3ec710f67f Reviewed-on: https://chromium-review.googlesource.com/271425 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Enable postSubBuffer on D3D11 with DXGI 1.2.  BUG=147291  Change-Id: Iafddb83b4949168f1c59272a99ae0244d86ce3f9 Reviewed-on: https://chromium-review.googlesource.com/270572 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Sunny Sachanandani <sunnyps@chromium.org>, 23355681, 619, 169, 619
Revert "Call XSync in the GLX EGL impl if we have a new X server connection"  broke linux builders  This reverts commit cedb8ca27f97d3101a22f586671a4668bf09bbec.  Change-Id: I57143ec207b454bce7498a4d33f6d54464b55ab8 Reviewed-on: https://chromium-review.googlesource.com/271424 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Call XSync in the GLX EGL impl if we have a new X server connection  This prevents races between the application's connection and ANGLE's one that could lead to X errors crashing the program.  BUG=angleproject:892  Change-Id: Ic09462e76724d1a32c35b32708de97258d99241c Reviewed-on: https://chromium-review.googlesource.com/271178 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Clear image descs on Impl errors.  This is a speculative fix for a possible crash when we could get out-of-sync between the Impl and the GL state.  BUG=485543  Change-Id: Id26475f1aae7da05b5ffd802c4a7600e21b40315 Reviewed-on: https://chromium-review.googlesource.com/270194 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add -lrt and -ldl to link flags on Linux builds  BUG=angleproject:892  Change-Id: Ic06b493cbfdc061565d94d98aabfc3b1f2d882c6 Reviewed-on: https://chromium-review.googlesource.com/271275 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
translator: Reject shaders that use both FragColor+FragData.  *re-land with fix for unused var in release*  We checked this at link time in the D3D back-end but this restriction applies to all shaders.  TEST=dEQP-GLES2.functional.shaders.fragdata.* BUG=angleproject:995 BUG=478572  Change-Id: I63258f4de47e658812822f31601cc235f48c0826 Reviewed-on: https://chromium-review.googlesource.com/271470 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Unfold sequence operator when operations inside need unfolding  Unfolding the sequence operator ensures correct evaluation order when parts of the expression need to get hoisted out of the expression to the surrounding scope.  BUG=angleproject:1001 TEST=WebGL conformance tests  Change-Id: Ifd3093c9fb63d3e9842ebb4b9531b2f46875ad8a Reviewed-on: https://chromium-review.googlesource.com/270660 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Defer executing if statements in the global scope  Unfolding of short-circuiting operators (ternary and logical operators) may create if statements in the global scope which is not valid HLSL. Use existing deferred global initialization function to defer execution of if statements in the global scope.  TEST=WebGL conformance tests BUG=angleproject:819  Change-Id: I2b0afcc6824dab6bb87eb6abed609e75b1384dab Reviewed-on: https://chromium-review.googlesource.com/270461 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Make UnfoldShortCircuit to change AST instead of writing output  This is needed to make way for further AST transformations to handle array expressions that need to work correctly together with unfolding short- circuiting operators. This also improves the maintainability of HLSL output by isolating the unfolding into a separate compilation step.  The new version of UnfoldShortCircuit traverser will traverse the tree until an expression that needs to be unfolded is encountered. It then unfolds it and gets reset. The traverser will be run repeatedly until no more operations to unfold are found. This helps with keeping the traverser's design relatively simple.  All declarations are separated to single declarations before short-circuit unfolding is run. Previously OutputHLSL already output every declaration separately.  BUG=angleproject:960 TEST=WebGL conformance tests angle_unittests angle_end2end_tests  Change-Id: Id769be396adbd4c0223e418980dc464dd855f019 Reviewed-on: https://chromium-review.googlesource.com/270460 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "translator: Reject shaders that use both FragColor+FragData."  The change introduced a warning in Windows release build.  This reverts commit b8e3a568bbd16fca1099a1b54cd82a981cd88a8e.  Change-Id: I77bbc35876043c9a164aa2665965f5189ee90052 Reviewed-on: https://chromium-review.googlesource.com/271430 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix "unused private variable" warning in ParseContext  BUG=angleproject:892  Change-Id: I3d0c23f1c2d43477c8b4ff28a6db470b3491de0b Reviewed-on: https://chromium-review.googlesource.com/271276 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Make X11Window::setVisible block until the window is mapped.  That way the code calling setVisible knows it can safely create a framebuffer for this window without having its content be undefined.  BUG=angleproject:830  Change-Id: Ia694f50ac20e1d510d0c0f899226ed241d9a5a3a Reviewed-on: https://chromium-review.googlesource.com/271156 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
FunctionsGLX: add support for glXWaitX/GL  The functions are not used in the code but are useful during development to try to see where race condition with the X server are.  BUG=angleproject:892  Change-Id: Ie1267e46ac251bd9ac62e2a146db68ad84644fb8 Reviewed-on: https://chromium-review.googlesource.com/271177 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
FunctionsGLX: make most functions take the display implicitly  In later CLs FunctionsGLX will need to store the X display so we take advantage of it to reduce the verbosity of the other GLX files slightly.  BUG=angleproject:892  Change-Id: I42ea00d0a37055e5e0752a860978b8ef5afb7a0b Reviewed-on: https://chromium-review.googlesource.com/271163 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
translator: Reject shaders that use both FragColor+FragData.  We checked this at link time in the D3D back-end but this restriction applies to all shaders.  TEST=dEQP-GLES2.functional.shaders.fragdata.* BUG=angleproject:995 BUG=478572  Change-Id: I99111cc6aa05b9352693f9c3b5bc70d56c9842d4 Reviewed-on: https://chromium-review.googlesource.com/269846 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make TParseContext a class with private data.  *re-land with build fix*  BUG=angleproject:995  Change-Id: I67d3ded8f6c705b54fb372857e07ce1a86b58475 Reviewed-on: https://chromium-review.googlesource.com/271162 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Use a sparse histogram for D3D11CreateDevice errors.  This avoid us needing to capture an enum value for every possible error code. Leave the existing enum values in for now.  BUG=477701  Change-Id: Iccaa4d9b732fe4d56432e17578421cba11bcf9ce Reviewed-on: https://chromium-review.googlesource.com/271159 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add collection of D3D11 and DXGI stats.  Will require a chromium-side patch to enable boolean histograms.  BUG=angleproject:966 BUG=436191  Change-Id: I3026c73894fbbff521503b377955816a8e831df8 Reviewed-on: https://chromium-review.googlesource.com/271174 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix typo in a comment in PbufferTest  BUG=angleproject:892  Change-Id: I8383b0b061f613ee3592c3d7cd41135164223604 Reviewed-on: https://chromium-review.googlesource.com/271158 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Move ANGLETest back in test_utils leaving a proxy header for Chromium  BUG=angleproject:892  Change-Id: Ibd494813be87e996096077d6e208cc92461b8f49 Reviewed-on: https://chromium-review.googlesource.com/271154 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
EGLWindow: remove redundant EGL_NONE to finish attrib list.  Only one EGL_NONE is needed to signal the end of the list.  BUG=angleproject:892  Change-Id: I7de349bef9d674344ccd1b2c4801d8b42c801299 Reviewed-on: https://chromium-review.googlesource.com/271157 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Add more D3D11 init errors to stats collection."  Going to rework this in favor of a sparse histogram.  BUG=477701  This reverts commit c5146c762a5c4fa3df522593f4084767b3d71583.  Change-Id: I88ba7b461a1de04324a6ebe164037ea9081f2239 Reviewed-on: https://chromium-review.googlesource.com/271155 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Revert "Make EGLQueryContextTest use ANGLE_INSTANTIATE_TEST""  The original commit was not the one causing the problem it was reverted for.  This reverts commit c4738880d4651e5a025abad75db352748f1fd34c.  BUG=angleproject:892  Change-Id: I8dee28545c3895750247635a63b73ecec4ba449c Reviewed-on: https://chromium-review.googlesource.com/270262 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/270473 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Compile the GLX EGL implementation in BUILD.gn  BUG=angleproject:892  Change-Id: Ifebcadab4fc4ad9fd93b9cf21b3ebdd2f4d6cfc1 Reviewed-on: https://chromium-review.googlesource.com/271164 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add plumbing for D3D11 device caps  BUG=angleproject:1002  Change-Id: Id24783c75377ea92a73a43f2605693e07f63dc15 Reviewed-on: https://chromium-review.googlesource.com/270545 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Revert "Make TParseContext a class with private data."  Causing build errors on Linux:  FAILED: ninja -t msvc -e environment.x86 -- C:\b\build\goma/gomacc "C:\b\depot_tools\win_toolchain\vs2013_files\VC\bin\amd64_x86\cl.exe" /nologo /showIncludes /FC @obj\third_party\angle\src\compiler\translator\translator_lib.ParseContext.obj.rsp /c ..\..\third_party\angle\src\compiler\translator\ParseContext.cpp /Foobj\third_party\angle\src\compiler\translator\translator_lib.ParseContext.obj /Fdobj\third_party\angle\src\translator_lib.cc.pdb  c:\b\build\slave\gpu_win_builder__dbg_\build\src\third_party\angle\src\compiler\translator\validateglobalinitializer.h(11) : error C2220: warning treated as error - no 'object' file generated c:\b\build\slave\gpu_win_builder__dbg_\build\src\third_party\angle\src\compiler\translator\validateglobalinitializer.h(11) : warning C4099: 'TParseContext' : type name first seen using 'class' now seen using 'struct'         c:\b\build\slave\gpu_win_builder__dbg_\build\src\third_party\angle\src\compiler\translator\parsecontext.h(28) : see declaration of 'TParseContext'  BUG=angleproject:995  This reverts commit 6c0c2987fba9dcf2a8d432534c9548092281bfa4.  Change-Id: I49a8b7df9bc8b7c4892bf3af5e2c7a6444fba890 Reviewed-on: https://chromium-review.googlesource.com/270767 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make TParseContext a class with private data.  BUG=angleproject:995  Change-Id: Ie077e3a4f0fd5ef840aa35edeb41d15a98b7c0ff Reviewed-on: https://chromium-review.googlesource.com/270628 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor style in ParseContext.h.  BUG=angleproject:995  Change-Id: I893785a068d0d5cf4afc18123896bf540e53a3e0 Reviewed-on: https://chromium-review.googlesource.com/270627 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Add constant folding support for minmax and clamp"  This reverts commit 1137a2a6b4a68fe3f7497bb9289975b030576372.  Change-Id: I1493c2706e5f08a9f0001835e663a147be85a303 Reviewed-on: https://chromium-review.googlesource.com/270782 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix crash in IndexDataManagerPerfTest.  Since the gl::Buffer doesn't know about its data the index range needs to be computed on the raw indices instead of through the buffer.  Change-Id: I3f53822033a1a25bf5fae9132ee2ceb312eaa283 Reviewed-on: https://chromium-review.googlesource.com/270498 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Roll Gmock and Gtest.  This fixes the build of angle_end2end_tests on Linux/Clang.  BUG=angleproject:997  Change-Id: Ie6eca3dc0fc7114d2755892b4b02e8b47a8fa478 Reviewed-on: https://chromium-review.googlesource.com/270680 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Validate global initializer qualifiers  Allow only constants other globals temporaries and uniforms to be used in global variable initialization for now. The spec limits global variable initialization further to only constant expressions but fully implementing this has a too large compatibility cost for ESSL 1.00 so implement it only partially. In the case of ESSL 3.00 we can use stricter validation since there's no legacy to worry about.  Resubmitting the change since the previous version neglected to remove incorrect GLSL tests.  TEST=angle_unittests WebGL conformance tests angle_end2end_tests BUG=angleproject:988  Change-Id: I1bb3b8dc305689a90eadfe8cc7705e5ac3829e03 Reviewed-on: https://chromium-review.googlesource.com/270651 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
perf_tests: Reduce iteration counts in some tests.  This gives the tests more room to breathe and report more precision in the final scores. Hopefully this will clear up the issues on the bots where some tests appear to fluctuate between a  high and low value.  BUG=468852  Change-Id: Ie2793e0a89e5ded63ba4217828076df46c393a92 Reviewed-on: https://chromium-review.googlesource.com/270497 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Validate global initializer qualifiers"  Seems to be failing angle_end2end_tests:  GLSLTest.GlobalStaticAndVarying_0 GLSLTest.GlobalStaticAndVarying_1 GLSLTest_ES3.GlobalStaticAndInstanceID_0  http://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Release%20%28NVIDIA%29/builds/15598  BUG=angleproject:988  This reverts commit 6caa5e815f7e3c11e4452ed5e60446b9943db183.  Change-Id: I394b571c9b4ee739721018c5287a45df49e1471c Reviewed-on: https://chromium-review.googlesource.com/270589 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Validate global initializer qualifiers  Allow only constants other globals temporaries and uniforms to be used in global variable initialization for now. The spec limits global variable initialization further to only constant expressions but fully implementing this has a too large compatibility cost for ESSL 1.00 so implement it only partially. In the case of ESSL 3.00 we can use stricter validation since there's no legacy to worry about.  TEST=angle_unittests WebGL conformance tests BUG=angleproject:988  Change-Id: I6a66f6a31130b44717dd2bef3082a0fc395a60b6 Reviewed-on: https://chromium-review.googlesource.com/270430 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add more D3D11 init errors to stats collection.  We ran into the UNSUPPORTED value when looking at D3D11 on a VM. It's quite possible that systems which don't support D3D11 return this value when initialization fails.  Also add a few more severe errors such as device removed.  BUG=477701  Change-Id: I2ebbfff5f7eed6fe3939dea86b25845a748caedc Reviewed-on: https://chromium-review.googlesource.com/270346 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Create a child window in SurfaceD3D when needed."  Reverting until chromium sandbox issues are resolved.  This reverts commit b7f1a8b0ab3489a7463749e7fc088187bfafbd35.  BUG=484963 BUG=angleproject:961  Change-Id: I4b030329a322d0a96a18e6ae875d500c5f755ddd Reviewed-on: https://chromium-review.googlesource.com/270490 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix compilation of EGLSurfaceTest  BUG=angleproject:892  Change-Id: I8c999e06c8cc3567f7bb1aed23286bd7e9080616 Reviewed-on: https://chromium-review.googlesource.com/270432 Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
X11Window: implement event handling and modifiers  BUG=angleproject:892  Change-Id: I65f251abdd28b273e2d3d574825f20bba8bb2532 Reviewed-on: https://chromium-review.googlesource.com/270452 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Temporarily move back ANGLETest in end2end_tests  This path needs to a Chrome change before it can change.  BUG=angleproject:892  Change-Id: I549737383b9720a2e7d83ee5e3145d71716f04cb Reviewed-on: https://chromium-review.googlesource.com/270457 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Make EGLQueryContextTest use ANGLE_INSTANTIATE_TEST"  Broke win build  ninja: error: '../../gpu/egl_tests/EGLQueryContextTest.cpp' needed by 'obj/gpu/egl_tests/angle_end2end_tests.EGLQueryContextTest.obj' missing and no known rule to make it This reverts commit 887dd2f196f73f12d9c302aaf07027ace87609fa.  Change-Id: I2ceb430010628c2aa7cb242eb2bf49406d8d87db Reviewed-on: https://chromium-review.googlesource.com/270471 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Make EGLQueryContextTest use ANGLE_INSTANTIATE_TEST  This makes it run correctly on Linux where the only platform available is OpenGL.  BUG=angleproject:892  Change-Id: I3d72163b49b35daba702ebb5b48d010761c7fb6d Reviewed-on: https://chromium-review.googlesource.com/270262 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Compile end2end tests on Linux  BUG=angleproject:892  Change-Id: Id4a9ddc35ae9600080e743c77476d36743a3e646 Reviewed-on: https://chromium-review.googlesource.com/270199 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/270412, 23355681, 619, 169, 619
Revert "Compile end2end tests on Linux"  Build errors in Chromium:  ninja: Entering directory `C:\b\build\slave\GPU_Win_Builder\build\src\out\Release' ninja: error: '../../gpu/egl_tests/EGLQueryContextTest.cpp' needed by 'obj/gpu/egl_tests/angle_end2end_tests.EGLQueryContextTest.obj' missing and no known rule to make it  This reverts commit be39156b10bf56686b03b274046e51ef156283fc.  Change-Id: I931295f16cad096e94baac9811ea2396a4182848 Reviewed-on: https://chromium-review.googlesource.com/270347 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
OSWindow: add optional debugging of events received  BUG=angleproject:830  Change-Id: Icd854ee152f15ec1de4293b5ed2ed49cb1a5fc2b Reviewed-on: https://chromium-review.googlesource.com/270451 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement Pbuffers for the GLX EGL implementation  BUG=angleproject:892  Change-Id: I32b9bbb35d99621f16a055fb544ec0691dfcd5a0 Reviewed-on: https://chromium-review.googlesource.com/270261 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Compile end2end tests on Linux  BUG=angleproject:892  Change-Id: If3903f1801f4999bebaaaed2625346bfbec2243d Reviewed-on: https://chromium-review.googlesource.com/270199 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Move end2end and standalone tests to gl_tests and egl_tests  Also introduce a test_utils directory that contains helpers used for all types of tests.  BUG=angleproject:892  Change-Id: I9e1bff895020ffd3a109162283971a290a1098bd Reviewed-on: https://chromium-review.googlesource.com/270198 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add constant folding support for minmax and clamp  This change adds necessary mechanism to support constant folding of built-ins that take more than one parameter and also adds constant folding support for min max and clamp built-ins.  BUG=angleproject:913 TESTS=dEQP tests (126 tests started passing with this change) dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.common.min_* dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.common.max_* dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.common.clamp_*  Change-Id: I5d3e96ef2062116cbf164a7a42cba096bd4d5389 Reviewed-on: https://chromium-review.googlesource.com/269317 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
DisplayGLX: handle EGL_DEFAULT_DISPLAY for ANGLE_platform_angle  BUG=angleproject:892  Change-Id: I681e2b92ac2e8b853c7d1271a5518c4b77a67929 Reviewed-on: https://chromium-review.googlesource.com/270260 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Convert floats to integers using doubles and 64-bit integers.  Avoids some edge cases that overflow or round incorrectly.  Fixes: dEQP-GLES2.functional.state_query.floats.depth_range_getinteger dEQP-GLES2.functional.state_query.floats.color_clear_value_getinteger dEQP-GLES2.functional.state_query.floats.depth_clear_value_getinteger  Change-Id: Ib2c7f422dac76094c7ff6c5f8aef3fd392f68e80 Reviewed-on: https://chromium-review.googlesource.com/268510 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a basic GLX EGL implementation  BUG=angleproject:892  Change-Id: Ife9955a457d4a6fb3adce17757ccb0de7d0dd274 Reviewed-on: https://chromium-review.googlesource.com/269413 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add a FunctionsGLX class to dynamically load the GLX entry points  BUG=angleproject:892  Change-Id: I516b7d859100cb065871de8e328585a9ca817499 Reviewed-on: https://chromium-review.googlesource.com/270123 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Filter out unsupported platforms for value parameterized tests  With this most of the end2end tests pass on Linux  BUG=angleproject:997 BUG=angleproject:982  Change-Id: I6aab7d407f260ee24c5c59bf4d6055e875d3a6d6 Reviewed-on: https://chromium-review.googlesource.com/270184 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix pointer to int conversion warning in EGLWindow.cpp  BUG=angleproject:892  Change-Id: Ic40f29c811d18efea0e081c269ca43d0170488a4 Reviewed-on: https://chromium-review.googlesource.com/269122 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/270125, 23355681, 619, 169, 619
Add missing EvqPointCoord to getQualifierString  Also sort enums in getQualifierString in the same order as in the enum definition.  BUG=angleproject:999 TEST=WebGL conformance tests with --gl-shader-interm-output  Change-Id: I31aa2e4b2405a090f560bf4140d9ee66271e526c Reviewed-on: https://chromium-review.googlesource.com/269941 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make all the samples compile under Linux  Two-thirds of them run and work well.  BUG=angleproject:892  Change-Id: I401a7ef4fd055eda7276bd34dcf0fc6ae0deff13 Reviewed-on: https://chromium-review.googlesource.com/270124 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Remove Texture serials and Texture::INCOMPLETE_TEXTURE_ID.  Texture serials were not used in any place that pointers could not be used and Texture::INCOMPLETE_TEXTURE_ID was only referenced by RendererD3D.  This was the last place that serials are used in the gl layer.  BUG=angleproject:681  Change-Id: Iad24321fba57db8ade3c9eb8f04cc20e98ded1b0 Reviewed-on: https://chromium-review.googlesource.com/263659 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move unsupported depth stencil check to FramebufferD3D.  BUG=angleproject:885  Change-Id: I0abc674e365d2b5b65d23e2abf741a02a1146cdd Reviewed-on: https://chromium-review.googlesource.com/268311 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Roll googletest.  This also moves us to the Chromium googletest mirror. It may cause conflicts with developer setups if they have the folder open when they try to gclient sync.  BUG=angleproject:997  Change-Id: I94a629c50cb6ea6fc0020e3ec9ee93b7088d964b Reviewed-on: https://chromium-review.googlesource.com/270108 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Optimize Texture binding by only applying referenced textures.  Update ProgramGL to track which the current values of sampler uniforms so that only the currently applied texture units have to be bound for the draw call.  BUG=angleproject:882  Change-Id: I280aa106172b13a5fbb31cdefba27b6691c0a0e4 Reviewed-on: https://chromium-review.googlesource.com/264803 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add GLX EGL implementation stubs  BUG=angleproject:892  Change-Id: I1ef1bd0ce60f4585e473f9750c748a1b41c09da2 Reviewed-on: https://chromium-review.googlesource.com/269741 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Roll dEQP.  BUG=angleproject:998  Change-Id: I35067bd5ed2919f918a1f1b93bef0feb934c838d Reviewed-on: https://chromium-review.googlesource.com/270120 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use value-paramaterized tests instead of by type.  This should fix our non-standard template use which causes compile errors for the tests on GCC/Clang.  BUG=angleproject:997  Change-Id: Id1bb15231eda445f37e53a5b33d4684ec6618d8e Reviewed-on: https://chromium-review.googlesource.com/269858 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix issues with ProgramGL.   * Don't re-create the native GL program every link some program state should    persist between re-linking such as bound attribute locations.  * Forward glBindAttribLocation calls to the ProgramImpl fixes some chromium    rendering issues because chromium always binds attribute locations    sometimes with gaps.  * Query the real attrib location before inserting it into the list of attribs.    It was unsafe to rely on the attrib having the same location as its index    into the active attributes.  BUG=angleproject:882  Change-Id: If14b4c4c2f5ebcdaa4f7c5a890b9519d6d4e6e43 Reviewed-on: https://chromium-review.googlesource.com/269991 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use a D3D11 renderer by default when available.  Also update SampleApplication to request the default renderer instead of explicitely asking for d3d11  BUG=angleproject:892  Change-Id: I70c431b3c1ba78c3ce7844d7f276cc19ac17d7f5 Reviewed-on: https://chromium-review.googlesource.com/269999 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix GetExecutablePath on Linux  It was using lstat to get the size of /proc/self/exe but it always returns 0 so we just use a big buffer on the stack instead.  BUG=angleproject:892  Change-Id: I6d88efeb4ec5de7a78cb3668e3d78520203ad1d5 Reviewed-on: https://chromium-review.googlesource.com/269990 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Load the blit framebuffer extension entry points.  Change-Id: I654f944aea25661d3fb1e2381b93780771300f32 Reviewed-on: https://chromium-review.googlesource.com/269144 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
eglGetPlatformDisplayEXT: validate device types are set only on d3d  BUG=angleproject:892  Change-Id: I0fa089f299abaab406384a05b096de19f04f3a5e Reviewed-on: https://chromium-review.googlesource.com/269771 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/269829, 23355681, 619, 169, 619
EGLSurfaceTest: specify the device type only on d3d platform  BUG=angleproject:892  Change-Id: If09cf30122d97590f07447147e6d54c2e4157f9e Reviewed-on: https://chromium-review.googlesource.com/269828 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
EGLWindow: specify the device type only on d3d platform  BUG=angleproject:892  Change-Id: I0406e26910f5a012ccb9e533af18e831522161b1 Reviewed-on: https://chromium-review.googlesource.com/269666 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/269827, 23355681, 619, 169, 619
Make util/win32 follow ANGLE conventions better  BUG=angleproject:892  Change-Id: I1ad366e16b135649fe1b0351081f9971db84df50 Reviewed-on: https://chromium-review.googlesource.com/269665 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Use stream operators for appending to InfoLog.  Also add a helper class to keep the previous behaviour of automatically appending a newline after every new message.  BUG=angleproject:992  Change-Id: I0ff5d2846175cf19de7a6af295af24a92451456f Reviewed-on: https://chromium-review.googlesource.com/268744 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use a std::stringstream for Program's InfoLog.  This should help WebKit avoid needing to apply a local patch. Also clean up the style in this file a bit.  BUG=angleproject:307angleproject:992  Change-Id: I41ecf7cbfa20b469b3731215ef28cb36253ba186 Reviewed-on: https://chromium-review.googlesource.com/269849 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add test for HLSL "pow" constant folding bug.  This covers 'pow-of-small-constant-in-user-defined-function' from the WebGL CTS. Leave disabled until we have a proper fix.  BUG=angleproject:851  Change-Id: I41a4ad9354e32bb2d48894d75676a9dfe226e9d8 Reviewed-on: https://chromium-review.googlesource.com/269747 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "EGLWindow: specify the device type only on d3d platform"  Causing failures in EGLSurfaceTest.MakeCurrentTwice on Windows  BUG=angleproject:892  This reverts commit 118e7195fdaa76a1f3aa52bbed30fdb97cc3fd4a.  Change-Id: Ifbb17d1c9bc0390abadbfb8f78cf14dbf1bb8e83 Reviewed-on: https://chromium-review.googlesource.com/269950 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "eglGetPlatformDisplayEXT: validate device types are set only on d3d"  Depends on patch which is causing a failure in EGLSurfaceTest.MakeCurrentTwice  BUG=None  This reverts commit 0e7ee498972e2d69e2d3bc3d99c798386aa2e950.  Change-Id: I7d11900c784bdb2a8963a824e89019b39a184cbe Reviewed-on: https://chromium-review.googlesource.com/269856 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
EGLWindow: specify the device type only on d3d platform  BUG=angleproject:892  Change-Id: I2dda3a8d15e58d15a401258a5a64c5783ea1a132 Reviewed-on: https://chromium-review.googlesource.com/269666 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add a basic support for Linux for utils/  * Timer and path utils are done. * Window only implements initialize and setVisible  BUG=angleproject:892  Change-Id: I3f49b68ef9ec5be324b25e211199bac2953ae11e Reviewed-on: https://chromium-review.googlesource.com/269520 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
eglGetPlatformDisplayEXT: validate device types are set only on d3d  Change-Id: I15f0651fbe90b3572ea6b62f804492fbe100e591 Reviewed-on: https://chromium-review.googlesource.com/269771 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Use a std::stringstream for Program's InfoLog."  Missing one character for the log length.  BUG=angleproject:307angleproject:992  This reverts commit 8ae74e11d2105104737a7425e3bdd68e6329dcfa.  Change-Id: Ifb3658c324cb0aa56ee31352a0fc0e6759979f7b Reviewed-on: https://chromium-review.googlesource.com/269848 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Sync the generic vertex attribute data.  BUG=angleproject:883  Change-Id: If5616bf24c1ac5477ae80cf1d25efa70b62edea1 Reviewed-on: https://chromium-review.googlesource.com/268750 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Clear cached state when deleting GL objects.  Change-Id: I84eac9b3796858e5e19e26851ad83baa1f9b6af2 Reviewed-on: https://chromium-review.googlesource.com/269142 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Always sync writemasks and front face.  BUG=angleproject:883  Change-Id: Ie1d544c8f30472238d859d8fd7f553a73b066802 Reviewed-on: https://chromium-review.googlesource.com/269145 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add support for parsing ESSL3 invariant qualifiers  The parser recognizes ESSL3 invariant variable declaration syntax and marks the variables as invariant.  In ESSL3 invariant out variables can be linked to non-invariant in variables so linking checks should now be different depending on shading language version. A shading language version dependent varying matching check is added to the translator API to facilitate this.  Tested by deqp/data/gles3/shaders/qualification_order.html after patching Chrome to use the new linking check API.  A previous revision of this change that broke API compatibility was reverted since it broke Chromium FYI bots. This revision keeps deprecated API functionality around for now so that changes can be rolled step-by-step to Chromium without breakage.  TEST=WebGL 2 conformance tests angle_unittests BUG=angleproject:987  Change-Id: Iecb64e3afd23e267ba999bc17f44390affcdfc13 Reviewed-on: https://chromium-review.googlesource.com/269940 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "Add support for parsing ESSL3 invariant qualifiers"  Build breaks in GPU FYI bots.  BUG=angleproject:987  This reverts commit 4008879357159c7850cf105f2ae842bc68dd3c18.  Change-Id: Ia88ad302c403c65516c050eb7741316b5097bcfb Reviewed-on: https://chromium-review.googlesource.com/269847 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add support for parsing ESSL3 invariant qualifiers  The parser recognizes ESSL3 invariant variable declaration syntax and marks the variables as invariant.  In ESSL3 invariant out variables can be linked to non-invariant in variables so linking checks should now be different depending on shading language version. The varying matching check in the translator API is changed to be shading language version dependent to facilitate this.  Tested by deqp/data/gles3/shaders/qualification_order.html after patching Chrome to use the new linking check API.  TEST=WebGL 2 conformance tests angle_unittests BUG=angleproject:987  Change-Id: I3982feff7380c4dfc647940ee03a020692dd0c59 Reviewed-on: https://chromium-review.googlesource.com/267663 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add a Buffer::getIndexRange function.  Instead of exposing the index range cache add a more generic method that allows the buffers to handle their own caching of index ranges. BufferImpl::getData can be hard to implement for BufferGL because there isn't a way to tell the buffer to unmap and glGetBufferSubData can be very expensive requiring an extra copy of the data.  BUG=angleproject:881  Change-Id: Idec645219056132e0d72a410fbe7b971fa02c9e9 Reviewed-on: https://chromium-review.googlesource.com/261892 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move the IndexRangeCache and Range types to the gl namespace.  BUG=angleproject:881  Change-Id: Ib05149facee9fcc7714cb957ca8647b3498a36b6 Reviewed-on: https://chromium-review.googlesource.com/269254 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Factor GL extension parsing in renderergl_utils.cpp  DisplayGLX will use it for the GLX extensions too.  BUG=angleproject:892  Change-Id: I5e4f80776a558fcdcc7e7b83767145112bcfee98 Reviewed-on: https://chromium-review.googlesource.com/269461 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Track if a non-preprocessor token has been seen and validate #extension with it.  Reland: Only report a warning instead of an error.  BUG=angleproject:989 BUG=483252  Change-Id: Ife3e7759cdef6bc0f41cae3c58c307682b608279 Reviewed-on: https://chromium-review.googlesource.com/269404 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make build/gyp_angle executable  BUG=angleproject:892  Change-Id: I88c2724150142415cebf9e45e5747fe2c4889c91 Reviewed-on: https://chromium-review.googlesource.com/269760 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Refactor egl::Surface constructors.  We can reduce the code in these classes quite a bit by calling the common code in egl::Display.  BUG=angleproject:994  Change-Id: Idf0ffa054fc6a70cf8c65a0b98fd963911715591 Reviewed-on: https://chromium-review.googlesource.com/269258 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update WebGL CTS expectations.  Change-Id: If07442b45d97f259e5a2ebda3dbfee3c11618499 Reviewed-on: https://chromium-review.googlesource.com/269664 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add missing includes in samples/sample_util/  BUG=angleproject:892  Change-Id: Ia718306226ce6cfcf91f74947a7775b1439e4fab Reviewed-on: https://chromium-review.googlesource.com/268995 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Track if a non-preprocessor token has been seen and validate #extension with it."  Causing failures in the GLES2 CTS "build" related to extensions.  BUG=483252 BUG=angleproject:989  This reverts commit bbdb9e2259c38454be097ce01505db83db3ad7a8.  Change-Id: I3e1ad989af645194c8ee9b9847b2131e289d09e1 Reviewed-on: https://chromium-review.googlesource.com/269403 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move comments next to their code block in FunctionsGL  BUG=angleproject:892  Change-Id: I7b47e26c81dc91900b17a2062bef0ee10c3290aa Reviewed-on: https://chromium-review.googlesource.com/269209 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Remove noop assignment to configId in DisplayWGL  It is overwritten by ConfigSet::add.  BUG=angleproject:892  Change-Id: I23becb235969c6aeda216014fd06880bd7cc5f67 Reviewed-on: https://chromium-review.googlesource.com/269410 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Track if a non-preprocessor token has been seen and validate #extension with it.  Reland: Only report a warning instead of an error.  BUG=angleproject:989 BUG=483252  Change-Id: Ibf9adbf423cd9dee20ec45b8d2ea42bcfd9311be Reviewed-on: https://chromium-review.googlesource.com/269205 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Load the KHR_debug extension entry points and print debug messages.  Change-Id: If1b64a7d5cc80205683062586a56fb50da6c1a21 Reviewed-on: https://chromium-review.googlesource.com/269143 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Separate invariance from qualifiers  ESSL3 makes it possible to combine invariant with several more different qualifiers. To avoid combinatorial explosion of the qualifier enum track invariance with a separate boolean.  TEST=WebGL conformance tests angle_unittests BUG=angleproject:987  Change-Id: I0c6629e5ca2ded06db9ac9e5bab2fb6480299a5a Reviewed-on: https://chromium-review.googlesource.com/267662 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Require size for empty array declarations  Passing dEQP tests requires this check which seems to be a valid interpretation of ESSL3 spec section 4.1.9.  BUG=angleproject:941 TEST=dEQP-GLES3.functional.shaders.arrays.invalid.*  Change-Id: Iae88e6bb8e4ec784a2f1c8a94554e1e5c5e3ee85 Reviewed-on: https://chromium-review.googlesource.com/267430 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
translator: Fix validation sometimes modifying builtins.  When validating some shaders with out-of-bounds array indexes we would write the sanitized index into the global symbol table. We would then overwrite a wrong value for the builtin. This fixes the WebGL test extensions/webgl-draw-buffers-max-draw-buffers.  Also mark const on as many uses ConstantUnion as we can.  BUG=angleproject:993  Change-Id: I110efaf1b7b0158b08b704277e3bc2472437902c Reviewed-on: https://chromium-review.googlesource.com/268962 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Rename ConstantUnion to TConstantUnion.  This clarified that we're using the Pool allocator/deallocator for this type.  BUG=angleproject:993  Change-Id: If8c95f6054d07291e7014be0d4e35766ba2e943b Reviewed-on: https://chromium-review.googlesource.com/269131 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Revert "Fix pointer to int conversion warning in EGLWindow.cpp"  Causes a compile error.  BUG=angleproject:892  This reverts commit d424da4a4c5f9eb08632738c53ca4604c3b808f1.  Change-Id: Ieb8bb99d02f7050306974db5dab72d26474891ac Reviewed-on: https://chromium-review.googlesource.com/268996 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add missing trailing newline before EGLWindow.cpp EOF  BUG=angleproject:892  Change-Id: Iaf175a310ce2acb5a8715902b3d367aa3dae8e2c Reviewed-on: https://chromium-review.googlesource.com/269124 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add missing include in EGLWindow.cpp  BUG=angleproject:892  Change-Id: I23cfbd9cfbe7d41e048a2b2a4eea048f5de72d12 Reviewed-on: https://chromium-review.googlesource.com/269123 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix pointer to int conversion warning in EGLWindow.cpp  BUG=angleproject:892  Change-Id: If6f0eb13bca10f9328faeaab35665a67e7ef6e44 Reviewed-on: https://chromium-review.googlesource.com/269122 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Use a std::stringstream for Program's InfoLog.  This should help WebKit avoid needing to apply a local patch. Also clean up the style in this file a bit.  BUG=angleproject:307angleproject:992  Change-Id: I6328cd03901dbf52eccddc7c747a684ed9b23ea1 Reviewed-on: https://chromium-review.googlesource.com/268741 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Query attachment render targets from Impl class.  *re-land with fix for D3D9*  This allows us to eradicate the GetAttachmentRenderTarget methods. This improves potential performance at the cost of exposing a Renderer-specific function at the API object level.  BUG=angleproject:963  Change-Id: Iee9f985ddaed668df0c622228004b348eb4d2ea8 Reviewed-on: https://chromium-review.googlesource.com/269006 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix warning about namespacing of HelloTriangle's constructor  BUG=angleproject:892  Change-Id: Ib3b4eb597964c21aba01047e77a413ce19c35855 Reviewed-on: https://chromium-review.googlesource.com/268994 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
CompilerGL: Use mOutputType when creating the compiler  BUG=angleproject:892  Change-Id: Id6bbc4059f92ff7d8d291583cd30dbd4cd5e9bd3 Reviewed-on: https://chromium-review.googlesource.com/268969 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
vs2015: disable warning in generated code fix another  Macro redefinition is for INT8_MIN etc. which are generated by flex. VS doesn't define __STDC_VERSION__ as >= C99 because it's still only partial support in VS2015.  Fix a float->int conversion narrowing warning.  Change-Id: I5232eb23426eaf584218137c068e14d74119a1ef Reviewed-on: https://chromium-review.googlesource.com/268821 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Scott Graham <scottmg@chromium.org>, 23355681, 619, 169, 619
Fix signed to unsigned integer conversion warning in EGLWindow.h  Change-Id: I7b4249e04c8fb76b60b4c837266b144fbd64cbf6 Reviewed-on: https://chromium-review.googlesource.com/269128 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix tautological compare and && in || warnings in FunctionsGL.cpp  Change-Id: Icfbd79e3cbb116da9981daeb42d3657146bf673e Reviewed-on: https://chromium-review.googlesource.com/268968 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix text trailing after preprocessor macro warning in util/Event.h  Change-Id: Ie977e6fce0e5e0efeb16f0387bf653bbd2d1cd93 Reviewed-on: https://chromium-review.googlesource.com/269127 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix 'not all switch case are handled' warning in OSWindow.cpp  Change-Id: Ib4d1e4b04c73e5eb5e0e4f6c56212e99723d2ce0 Reviewed-on: https://chromium-review.googlesource.com/269126 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add missing include in OSWindow.h  Change-Id: Ie1fd40c308ed9d0d90756e31dfe153f44510defa Reviewed-on: https://chromium-review.googlesource.com/269125 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
translator: Fix variable collection for gl_DepthRange.  *re-land with Linux fixes and fix for locations*  This built-in uniform wasn't being collected in VariableInfo.cpp. Also remove the existing workaround for D3D gl_DepthRange collection.  BUG=angleproject:991 BUG=478570  Change-Id: Iba84651bfc58f82fd4ce039421874f561f83c348 Reviewed-on: https://chromium-review.googlesource.com/268840 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix typo intialize -> initialize  Change-Id: Ia39fffc6f2782b918b37ab7ae25ee16ecc98e93a Reviewed-on: https://chromium-review.googlesource.com/269120 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Initialize Win32Timer::mRunning as a bool  Change-Id: I1770684217239bcbdf2bb07f4867e1427577a01f Reviewed-on: https://chromium-review.googlesource.com/269121 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Query attachment render targets from Impl class."  D3D9 bug is causing failures in the WebGL depth texture test.  BUG=angleproject:963  This reverts commit 804e8436f91733e1d0f769ec10082e4741f2e549.  Change-Id: I660f05033360e97258794138cb50b604f5ac16b6 Reviewed-on: https://chromium-review.googlesource.com/269005 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't reallocate default FBO on makeCurrent.  We can use the flat FBO attachment types to update our data instead of reallocating it. This also lets us delete the DefaultFramebuffer class.  BUG=angleproject:963angleproject:840  Change-Id: Ib8f20d8212d073fb5e248756321cb2e6b4e086dc Reviewed-on: https://chromium-review.googlesource.com/263492 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Query attachment render targets from Impl class.  This allows us to eradicate the GetAttachmentRenderTarget methods. This improves potential performance at the cost of exposing a Renderer-specific function at the API object level.  BUG=angleproject:963  Change-Id: Ifc227b5f42e87bd4deb451d685618cf61fea39f1 Reviewed-on: https://chromium-review.googlesource.com/263491 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "translator: Fix variable collection for gl_DepthRange."  Build errors on Linux:  error: comparison of integers of different signs: 'const int' and 'const unsigned int'  BUG=angleproject:991 BUG=478570  This reverts commit f1ae954b660cb058c40665b623f4d689b65180d4.  Change-Id: I217aba1b32dc0e70d6153337a1f0ccef0483a0e1 Reviewed-on: https://chromium-review.googlesource.com/268792 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
translator: Fix variable collection for gl_DepthRange.  This built-in uniform wasn't being collected in VariableInfo.cpp. Also remove the existing workaround for D3D gl_DepthRange collection.  BUG=angleproject:991 BUG=478570  Change-Id: Ie254132e37c307323ba9e6e1705d138eea67b520 Reviewed-on: https://chromium-review.googlesource.com/268524 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Revert "Don't mark all macros with double underscores as reserved."  Fails a WebGL CTS test.  BUG=angleproject:989  This reverts commit 942e36254a1e3537371c39f3f23d1ce12f4c87e8.  Change-Id: I9f833366d5b69535ef74e358ac21efaccb1f1a3d Reviewed-on: https://chromium-review.googlesource.com/268751 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't mark all macros with double underscores as reserved.  Only __FILE__ __LINE__ __VERSION__ and GL_ES are reserved but it is still not recommended to use a name with double underscores because it may be used by the "underlying software layers".  Updated the tests to reflect that it is OK to define macros with double underscores but it is not valid to make assumptions about their values.  Fixes: dEQP-GLES2.functional.shaders.preprocessor.basic.identifier_with_double_underscore_vertex dEQP-GLES2.functional.shaders.preprocessor.basic.identifier_with_double_underscore_fragment  BUG=angleproject:898  Change-Id: I77054d04c9935eedcdbb7304dc0c3b60b53994f9 Reviewed-on: https://chromium-review.googlesource.com/268434 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
translator: Fix C++11-deprecated register usage.  Define 'register' as an empty string if we're in a modern version of C++.  BUG=255186 BUG=angleproject:463  Change-Id: Ied044fb87a9b05c91cb419c54295c39f0f0ab776 Reviewed-on: https://chromium-review.googlesource.com/268512 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
translator: Regenerate with Bison 3.0.4.  BUG=angleproject:463  Change-Id: If89a29de8fb006e8e3b0483ac5df21c8833ce974 Reviewed-on: https://chromium-review.googlesource.com/268511 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Track if a non-preprocessor token has been seen and validate #extension with it."  Breaks some WebGL applications holding off until a decision is made.  BUG=483252 BUG=angleproject:989  This reverts commit fa55bf1ed6a26341c57f45b3a3da8feda0b6c18d.  Change-Id: Iebef439095a95741c8502716a4ce90c4785561eb Reviewed-on: https://chromium-review.googlesource.com/268742 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor CreateDevice error checking.  Also return a different code for a NULL pointer vs a failed call.  BUG=477701  Change-Id: Ib0584371d51b99760e80ce5481a1e72e1ec673e0 Reviewed-on: https://chromium-review.googlesource.com/267753 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Replace NULL with nullptr in Framebuffer9/11.  BUG=angleproject:963  Change-Id: I1ba418e7540b9c3ac6611aa3e4f0c1ca27557a1a Reviewed-on: https://chromium-review.googlesource.com/267734 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Simplify message to FBO Impls of attachment changes.  We don't need to pass attachment pointers since they are now value types and no longer change their address.  BUG=angleproject:963  Change-Id: I02cdce0886512cc847930f61c5bfb62fc1d7cd1a Reviewed-on: https://chromium-review.googlesource.com/265938 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
hlsl: Fix struct specifiers in uniforms.  We would miss the definition for structs specfied in uniforms. Fix this by always checking to add the constructor. Fixes the WebGL test 'glsl/misc/struct-specifiers-in-uniforms'.  BUG=angleproject:818 BUG=433412  Change-Id: I411e4a4477f7ef34fceb9faa77489f77d8efdce8 Reviewed-on: https://chromium-review.googlesource.com/267797 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fixes for the tagging of discontinuous loops  The first fix was for all loops being considered discontinuous in OutputHLSL because of a typo that produced a tautology.  The error was not detected by the unit tests because as an optimization we do not generate Lod0 calls when they are not needed for the callee function (which was correctly detected by the analysis in this case). Fixed the unit tests by adding a call to a builtin gradient operation.  The second fix was for discard not being taken into account in the analyses of the AST which caused a WebGL test regression after the first fix for conformance/glsl/bugs/conditional-discard-in-loop  BUG=angleproject:982  Change-Id: I1315eac1ad36f726be52d7fda5facf3104341b1f Reviewed-on: https://chromium-review.googlesource.com/267814 Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Default buffer usage to GL_STATIC_DRAW.  Calling glGetBufferParameteriv with GL_BUFFER_USAGE on a buffer that has never had glBufferData called on it should return GL_STATIC_DRAW. [ES 2.0.25 spec table 6.3]  Fixes: dEQP-GLES2.functional.state_query.buffer_object.buffer_usage_getbufferparameteri  Change-Id: I1bf1614b606d20338bb507861164c6ab0b64122f Reviewed-on: https://chromium-review.googlesource.com/267816 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
surfaceD3D::swapRect(): always call checkForOutOfDateSwapChain() even if width or height is 0.  BUG=angleproject:990  Change-Id: I9fbdd3d341d3f6fa42dfb39950e6b2d3204c4c9b Reviewed-on: https://chromium-review.googlesource.com/267415 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Rgis Fnon <regis.feneon@gmail.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Track if a non-preprocessor token has been seen and validate #extension with it.  Fixes: dEQP-GLES2.functional.shaders.preprocessor.extensions.after_non_preprocessing_tokens_vertex dEQP-GLES2.functional.shaders.preprocessor.extensions.after_non_preprocessing_tokens_fragment  BUG=angleproject:989  Change-Id: Ie0aba80b2fde0160e83fc95f545b62954af2e5fc Reviewed-on: https://chromium-review.googlesource.com/267398 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Cache gl::Data in Context to speed up validation.  This avoids creating a new Data object and copying it around. Gives a noticable performance increase in the benchmark which tests validation-only draw calls. Gives about a 8% increase in the benchmark.  BUG=angleproject:959  Change-Id: Id3a7459753b1b466a06da89f3f8b03b2c2c7a5c1 Reviewed-on: https://chromium-review.googlesource.com/267752 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Cache maximum enabled vertex attribute.  This can give us much faster draw call validation by saving us from checking buffer sizes for non-enabled attribs. Also for checking if vertex buffers are mapped. Gives >100% increase in the benchmark.  BUG=angleproject:959  Change-Id: I211c310385bdee46ed06f68ecd9c98385e1f8db9 Reviewed-on: https://chromium-review.googlesource.com/267751 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Cache validate samplers result.  This gives ~23% increase in the validation-only draw call perf test.  BUG=angleproject:959  Change-Id: I384a5c4fbb1c2cd47483bd7cf4bc1d39447a99bc Reviewed-on: https://chromium-review.googlesource.com/267750 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Update copyright dates in generated DLLs.  BUG=angleproject:546  Change-Id: If44d808e30e4c5b15971fe44e8c59a3c9f19095f Reviewed-on: https://chromium-review.googlesource.com/267837 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Validate that all preprocessor function arguments are unique.  Fixes: dEQP-GLES2.functional.shaders.preprocessor.invalid_function_definitions.unique_param_name_vertex dEQP-GLES2.functional.shaders.preprocessor.invalid_function_definitions.unique_param_name_fragment  BUG=angleproject:989  Change-Id: I32198f1c9036c371b46e7ad2986a44e42fd38e20 Reviewed-on: https://chromium-review.googlesource.com/267396 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Disable some failing tests on Intel and AMD bots.  Change-Id: I745fab7c6c169c1ffc930f865b6b109c4c623e2b Reviewed-on: https://chromium-review.googlesource.com/267835 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Enable more tests for the OpenGL backend.  Change-Id: I3fc9948498bd7c2b7c8e75f010196982de240c1b Reviewed-on: https://chromium-review.googlesource.com/267461 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Unexpected tokens after conditionals should be an error instead of a warning.  Fixes: dEQP-GLES2.functional.shaders.preprocessor.invalid_conditionals.tokens_after_if_vertex dEQP-GLES2.functional.shaders.preprocessor.invalid_conditionals.tokens_after_if_fragment dEQP-GLES2.functional.shaders.preprocessor.invalid_conditionals.tokens_after_else_vertex dEQP-GLES2.functional.shaders.preprocessor.invalid_conditionals.tokens_after_else_fragment dEQP-GLES2.functional.shaders.preprocessor.invalid_conditionals.tokens_after_endif_vertex dEQP-GLES2.functional.shaders.preprocessor.invalid_conditionals.tokens_after_endif_fragment dEQP-GLES2.functional.shaders.preprocessor.invalid_conditionals.tokens_after_ifdef_vertex dEQP-GLES2.functional.shaders.preprocessor.invalid_conditionals.tokens_after_ifdef_fragment dEQP-GLES2.functional.shaders.preprocessor.invalid_conditionals.tokens_after_ifndef_vertex dEQP-GLES2.functional.shaders.preprocessor.invalid_conditionals.tokens_after_ifndef_fragment  BUG=angleproject:989  Change-Id: I6511f7082c98206fb623775d81329b6bc7673c1a Reviewed-on: https://chromium-review.googlesource.com/267638 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add pragma errors for malformed pragmas.  Instead of always warning on invalid pragmas only warn when the pragma type is not recognized and error when the syntax is invalid.  Fixes: dEQP-GLES2.functional.shaders.preprocessor.pragmas.invalid_pragma_invalid_debug_vertex dEQP-GLES2.functional.shaders.preprocessor.pragmas.invalid_pragma_invalid_debug_fragment dEQP-GLES2.functional.shaders.preprocessor.pragmas.invalid_pragma_invalid_token_vertex dEQP-GLES2.functional.shaders.preprocessor.pragmas.invalid_pragma_invalid_token_fragment  BUG=angleproject:989  Change-Id: Ibd584dc08a2436e163dfc52eeffdf2dac8a22cb8 Reviewed-on: https://chromium-review.googlesource.com/267639 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Validate that there are no tokens following #undef on the same line.  Fixes: dEQP-GLES2.functional.shaders.preprocessor.definitions.undefine_object_invalid_syntax_vertex dEQP-GLES2.functional.shaders.preprocessor.definitions.undefine_object_invalid_syntax_fragment dEQP-GLES2.functional.shaders.preprocessor.invalid_definitions.undef_non_identifier_2_vertex dEQP-GLES2.functional.shaders.preprocessor.invalid_definitions.undef_non_identifier_2_fragment  BUG=angleproject:989  Change-Id: I279a38aaae8010017ef6e3f1aa139ae03f374680 Reviewed-on: https://chromium-review.googlesource.com/267397 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Reject shaders using attribute aliasing.  The current code rejects any shaders that use more than the caps allow but a bug would crash us before the check. We don't support aliasing in shaders that use a lot of uniforms because this causes problems with the D3D back-end currently. This changes the crash in the dEQP aliasing tests to a link error.  See dEQP-GLES2.functional.attribute_location.bind_aliasing.*  BUG=angleproject:901  Change-Id: I6906d3345abe9f89cfa0aa6cec4be26b5b2851d0 Reviewed-on: https://chromium-review.googlesource.com/266928 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Create a child window in SurfaceD3D when needed.  BUG=angleproject:961 BUG=angleproject:860  Change-Id: I137d27bafc4d690b159ffef8cc69d6f1c5a05131 Reviewed-on: https://chromium-review.googlesource.com/267681 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Temporarily disable the ClearTest.ClearIssue test on Intel OpenGL.  Change-Id: Ia54b2258422c23fc53f2af5ebe7594375412452c Reviewed-on: https://chromium-review.googlesource.com/267675 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Expand ShShaderOutput for different GLSL versions  BUG=angleproject:968  Change-Id: I2d4c0a8e9a91a940922da4501c22124da0c0399c Reviewed-on: https://chromium-review.googlesource.com/264840 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Revert "Remove non-const FBO attachment queries.""  Fixed build errors in prior patch.  This reverts commit 34771622d756adc52f02becd7c2b70c717dcc638.  Change-Id: I909b455f2c632a3df7d97149972e167c2adb058f Reviewed-on: https://chromium-review.googlesource.com/267599 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Create a child window in SurfaceD3D when needed."  Causing errors with D3D9 see build:  http://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Release%20%28NVIDIA%29/builds/15149  This reverts commit b7f1a8b0ab3489a7463749e7fc088187bfafbd35.  Change-Id: I6f1c3fd119f76a298e5b3fb676ddcb208cd1234b Reviewed-on: https://chromium-review.googlesource.com/267673 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Fix compile failure on build systems with UNICODE defined."  Earlier patch causing errors on D3D9:  http://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Release%20%28NVIDIA%29/builds/15149  This reverts commit acb0a1a6d74100833dbccd49d3eca317b56fd004.  Change-Id: I1956c57224ecf1c0caee2c3f624d1a871d171686 Reviewed-on: https://chromium-review.googlesource.com/267674 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix compile failure on build systems with UNICODE defined.  BUG=angleproject:961  Change-Id: I32053309a8384a27d1c2a991ddfaa195195f88c8 Reviewed-on: https://chromium-review.googlesource.com/267637 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't subclass windows in SurfaceD3D.  The subclassing was not used by chromium and caused problems for users that wanted to use a window owned by another thread as an EGL surface.  BUG=angleproject:961  Change-Id: I1d91323c758374de317179874320961385b10ae0 Reviewed-on: https://chromium-review.googlesource.com/266658 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: John Bauman <jbauman@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Create a child window in SurfaceD3D when needed.  BUG=angleproject:961  Change-Id: I61931961f8cb86b47012edd2bc08d0e1e7a5d0f7 Reviewed-on: https://chromium-review.googlesource.com/266515 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: John Bauman <jbauman@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a special case for binding to GL_FRAMEBUFFER for state tracking.  Binding to GL_FRAMEBUFFER is supposed to set the read and draw framebuffer bindings instead of being a separate binding point.  BUG=angleproject:885  Change-Id: Ic6d9056a2f8bfa472587c5ed030c15fcc93574c7 Reviewed-on: https://chromium-review.googlesource.com/267460 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fixed shadowed error variable.  BUG=angleproject:886  Change-Id: I4224ba26fef6783d61a56c294da2bdb6596da7bc Reviewed-on: https://chromium-review.googlesource.com/267552 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Store value types for FBO attachments.  *re-land with fix for Mac*  This prevents us from re-allocating FBO attachments every set. This change requires quite a bit of refactoring.  BUG=angleproject:963  Change-Id: Ia1f83e3c427d446ddbe16c6703db136942149e91 Reviewed-on: https://chromium-review.googlesource.com/266691 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "D3D11: Filter HRESULT error code properly."  Fix is incorrect: See http://crbug.com/477701  This reverts commit 02bce6e559988f2c4a6ec0c8905ed90254467baa.  Change-Id: I718d1a7e5d9fef662cee9ba90407a835466c74fc Reviewed-on: https://chromium-review.googlesource.com/267560 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fixed compilation with mingw.  Change-Id: Icc40c61b5c6df5a0aed4e175f1724ca55f981625 Reviewed-on: https://chromium-review.googlesource.com/267412 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove separate compilerdebug.h in favor of debug.h  This unifies the behavior across the compiler and rest of ANGLE - for example one can use #define ANGLE_TEST_CONFIG to disable UNIMPLEMENTED asserts in both the compiler and the rest of ANGLE. Compiler traces from asserts also go to the same TRACE_OUTPUT_FILE as other traces instead of being directed through ParseContext.  The compiler build already includes the common sources so no changes to build config are needed.  The original version of this change was reverted due to release mode build issues. This version adds UNUSED_ASSERTION_VARIABLE where needed.  TEST=angle_unittests angle_end2end_tests      dEQP-GLES3.functional.shaders.* BUG=angleproject:983  Change-Id: I36929020a04251b8bc834fbb3c069e10128c3082 Reviewed-on: https://chromium-review.googlesource.com/267411 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Keep default FBO attachments immutable.  In some cases we would let the user change the attachments of the default FBO. This hole in our validation would confound the dEQP negative API tests (negative_api.buffer.framebuffer_*) and muck up the remainder of the test run.  BUG=angleproject:901  Change-Id: I2b3c04752d1df3289d41c013cc936eda30e98aad Reviewed-on: https://chromium-review.googlesource.com/266927 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
No-op BufferSubData after validation.  We were skipping some validation which was confusing dEQP. We can still no-op but do this after all validation.  BUG=angleproject:901  Change-Id: I9888c1aca851519e9c7da210c983ba6012e95932 Reviewed-on: https://chromium-review.googlesource.com/266926 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix missing texture target validations.  We were missing this in a few places and this was giving runtime errors in dEQP negative tests.  BUG=angleproject:901  Change-Id: I9de5b055dcfe4ad5c13c800a31b4a0b424863bee Reviewed-on: https://chromium-review.googlesource.com/266888 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix warning about unexpected mock function call.  BUG=angleproject:985  Change-Id: If2138d8ec9a4f99adaf4ef1a4cbeeab6b0bf9f2c Reviewed-on: https://chromium-review.googlesource.com/267349 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Remove separate compilerdebug.h in favor of debug.h"  Causing compile warnings in Release:  1>compiler\translator\CallDAG.cpp(238): error C2220: warning treated as error - no 'object' file generated 1>compiler\translator\CallDAG.cpp(238): warning C4189: 'op' : local variable is initialized but not referenced 1>compiler\translator\IntermNode.cpp(1495): error C2220: warning treated as error - no 'object' file generated 1>compiler\translator\IntermNode.cpp(1495): warning C4189: 'replaced' : local variable is initialized but not referenced 1>compiler\translator\IntermNode.cpp(1517): warning C4189: 'replaced' : local variable is initialized but not referenced  This reverts commit 5271025865b34685da71d0309131c5aff2e32f71.  Change-Id: Icdf1c37eef22a13d083767609ab0b0285d3dc517 Reviewed-on: https://chromium-review.googlesource.com/267359 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a sample that uses multiple windows.  BUG=angleproject:521  Change-Id: I50858193518b4d07edcb2073caaa99ce37fcc4c3 Reviewed-on: https://chromium-review.googlesource.com/267000 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove separate compilerdebug.h in favor of debug.h  This unifies the behavior across the compiler and rest of ANGLE - for example one can use #define ANGLE_TEST_CONFIG to disable UNIMPLEMENTED asserts in both the compiler and the rest of ANGLE. Compiler traces from asserts also go to the same TRACE_OUTPUT_FILE as other traces instead of being directed through ParseContext.  The compiler build already includes the common sources so no changes to build config are needed.  TEST=angle_unittests angle_end2end_tests      dEQP-GLES3.functional.shaders.* BUG=angleproject:983  Change-Id: Ifca4d16f667b1e5cf9c2e7cc4139940091917a1c Reviewed-on: https://chromium-review.googlesource.com/266993 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add ANGLE platform selection for dEQP.  This gives us the choice between D3D9 and D3D11. We can add more platforms easily using the same patterns.  BUG=angleproject:901  Change-Id: Ia8dc77466bd32f0b8b0d638ae839f41288bfe25b Reviewed-on: https://chromium-review.googlesource.com/266889 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Clean up binary operation constant folding code  Fix mixed up comments remove unnecessary type conversions clarify variable names and improve formatting in a few places.  TEST=angle_unittests WebGL conformance tests BUG=angleproject:913  Change-Id: Ice8fe3682d8e97f42747752302a1fba116132df4 Reviewed-on: https://chromium-review.googlesource.com/266843 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Add basic support for arrays as return values in HLSL output  In HLSL output user-defined functions that have an array as their return value get changed so that they have the array as an out parameter instead.  Still missing: support for calling a function that has array as a return value without assigning the array. Also support for assignments inside complex expressions.  TEST=dEQP-GLES3.functional.shaders.arrays.return.* BUG=angleproject:941  Change-Id: I79f5170139116a3dcfb2be2df5f0f79a3d955ca8 Reviewed-on: https://chromium-review.googlesource.com/266003 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Prune empty declarations from the AST  Empty declarations in ESSL shaders currently result in errors on several platforms. Prune empty declarations that are not struct or interface block declarations from the AST.  TEST=WebGL conformance tests angle_unittests angle_end2end_tests BUG=angleproject:980  Change-Id: I9e3abf8134e6dfed0253cc83f69ce0ee92b0e0e7 Reviewed-on: https://chromium-review.googlesource.com/266841 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Disallow length being called on expressions with side effects  ESSL 3.00 definition of expressions does not include calling length on anything other than array names so enforce this restriction in the parser.  TEST=WebGL 2 conformance tests BUG=angleproject:972  Change-Id: I893d3c468ff21cb419b3239738f2a41834298cf2 Reviewed-on: https://chromium-review.googlesource.com/266992 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix array.length() to return a signed integer  array.length() should return a signed integer as specified in ESSL 3.00 section 4.1.9 not unsigned. Fix this and add a simple unit test - the dEQP tests included in WebGL conformance are built in a way that they don't catch the issue.  TEST=angle_unittests BUG=angleproject:972  Change-Id: I1389f51751a6a25c1681f57ac3d2d52f31ecc8fb Reviewed-on: https://chromium-review.googlesource.com/266991 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Sync the remaining miscellaneous state before drawing in RendererGL.  BUG=angleproject:883  Change-Id: Id530f855ab14b6ec575101c9e74c02842c27d3d6 Reviewed-on: https://chromium-review.googlesource.com/266036 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Sync the entire rasterizer state before drawing in RendererGL.  BUG=angleproject:883  Change-Id: I721c198f33caa18ec04899d6323faa9dbd4aa100 Reviewed-on: https://chromium-review.googlesource.com/266035 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Sync the entire depth stencil state before drawing in RendererGL.  BUG=angleproject:883  Change-Id: I1d748281184ff8111f8ff1c63f56882650b6871b Reviewed-on: https://chromium-review.googlesource.com/266034 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Sync the entire blend state before drawing in RendererGL.  BUG=angleproject:883  Change-Id: I903090c1a7ba90bd479ad8d24f943672eb51054e Reviewed-on: https://chromium-review.googlesource.com/266033 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove last uses of the enumerate_files script.  BUG=angleproject:981  Change-Id: Ib91d4b515e129241814706351b69a74e8295a250 Reviewed-on: https://chromium-review.googlesource.com/266874 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove uses of enumerate_files in the sample projects.  Speeds up project generation a lot.  BUG=angleproject:981  Change-Id: I3cb340baa8da3a30a2c861b584ba0e7758da5b4d Reviewed-on: https://chromium-review.googlesource.com/266873 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Rename translator to shader_translator and remove redundant projects.  The essl_to_hlsl and essl_to_glsl projects were exactly the same so it doesn't make sense to keep both.  BUG=angleproject:981  Change-Id: Ibf034a71e94ba5002f9c40ac87720bf0de74ae18 Reviewed-on: https://chromium-review.googlesource.com/266872 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move all GLES samples into the samples directory.  There was no real reason to keep them in an angle directory and it makes the generated projects nicer.  BUG=angleproject:981  Change-Id: I844e44dc5c2df51f5292cff4bdffe5e951745aae Reviewed-on: https://chromium-review.googlesource.com/266871 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove the dds_to_header sample.  It has very little to do with ANGLE and should not be in the repository.  BUG=angleproject:981  Change-Id: I7aa97b8f56b49beda591e90afcffcb27619beaec Reviewed-on: https://chromium-review.googlesource.com/266870 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix build regression on Linux  Chromium's Linux toolchain doesn't implement the return value of std::vector::insert correctly causing a build failure. Remove an unnecessary assignment of the return value to fix this build regression.  The regression was caused by the commit: "Put each array declarator into a separate declaration in HLSL output"  TEST=angle_unittests  Change-Id: I2959122d28e4c7e6d6a4d842a97a8f1fd4f27ca1 Reviewed-on: https://chromium-review.googlesource.com/266990 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Replace EvqInternal with a separate flag to make it more flexible  The internal flag disables decorating a given symbol in output effectively placing it to a different namespace than user-defined symbols. This enables the compiler to insert symbols to the tree when transforming it to be suitable for HLSL output without running into name conflicts. In this patch the flag is separated from the qualifiers since sometimes different qualifiers need to be used with these internal symbols.  TEST=angle_unittests angle_end2end_tests WebGL conformance tests BUG=angleproject:941  Change-Id: I7036bed98fdb1478a383bb959ca03b42c3cb8100 Reviewed-on: https://chromium-review.googlesource.com/266690 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Support array initialization in HLSL output  Do this by separating each array initialization into a declaration and an assignment. Array assignment is already supported in HLSL output by replacing it with a function call.  The functionality is tested by the struct array constructor tests in dEQP.  BUG=angleproject:941 TEST=dEQP-GLES3.functional.shaders.arrays.constructor.*  Change-Id: Ida84fc343b767bea8b2d04e91c60cb8197d39039 Reviewed-on: https://chromium-review.googlesource.com/266002 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Put each array declarator into a separate declaration in HLSL output  Since HLSL doesn't support arrays as l-values HLSL output needs to split declarators that initialize arrays to variable declaration and assignment implemented via a function call. To prepare for this it is necessary that each declarator has its own declaration.  BUG=angleproject:941 TEST=angle_end2end_tests WebGL conformance tests  Change-Id: I43dee487578561c01dbde90c2f55a93dda2f057a Reviewed-on: https://chromium-review.googlesource.com/266001 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
D3D11: Use DX generateMips to generate mipmaps whenever possible.  BUG=angleproject:974  Change-Id: I95937fe7a0833de77c52f838ebb3ecba55dfbf8a Reviewed-on: https://chromium-review.googlesource.com/265640 Tested-by: Gregoire Payen de La Garanderie <Gregory.Payen@imgtec.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Support constant folding of exponential built-ins  This change adds constant folding support for unary exponential built-ins - exp log exp2 log2 sqrt and inversesqrt.  BUG=angleproject:913 TEST= dEQP tests dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.exponential* (48 out of 56 tests started passing with this change)  Change-Id: I4b98782c4c4b72dd7d60dfc4f18ba6961526ec41 Reviewed-on: https://chromium-review.googlesource.com/266797 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "Revert "Use nullptr consistently in TIntermConstantUnion::fold""  Revert of revert as the new changes that use nullptr in fold function are already in.  This reverts commit b775778a050739c4d802da8db7edb8c865602950.  Change-Id: Ifbdb35264132c66e5d1f2379932839b99291c54a Reviewed-on: https://chromium-review.googlesource.com/266803 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "Store value types for FBO attachments."  In file included from ../../third_party/angle/src/libANGLE/Framebuffer.cpp:10: In file included from ../../third_party/angle/src/libANGLE/Framebuffer.h:13: In file included from /Applications/Xcode5.1.1.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.6.sdk/usr/include/c++/4.2.1/vector:68: /Applications/Xcode5.1.1.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.6.sdk/usr/include/c++/4.2.1/bits/stl_construct.h:81:38: error: call to implicitly-deleted copy constructor of 'gl::FramebufferAttachment'       ::new(static_cast<void*>(__p)) _T1(__value);                                      ^   ~~~~~~~ This reverts commit 13773b26dfb29b963ea727e1ebf7bdabdc5892b1.  Change-Id: If79f2797fe46798cbe5b39d83c9bcb1a7e87026d Reviewed-on: https://chromium-review.googlesource.com/266643 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Remove non-const FBO attachment queries."  Compile errors on Mac:  In file included from ../../third_party/angle/src/libANGLE/Framebuffer.cpp:10: In file included from ../../third_party/angle/src/libANGLE/Framebuffer.h:13: In file included from /Applications/Xcode5.1.1.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.6.sdk/usr/include/c++/4.2.1/vector:68: /Applications/Xcode5.1.1.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.6.sdk/usr/include/c++/4.2.1/bits/stl_construct.h:81:38: error: call to implicitly-deleted copy constructor of 'gl::FramebufferAttachment'       ::new(static_cast<void*>(__p)) _T1(__value);                                      ^   ~~~~~~~ This reverts commit ed61a5f673cefe1fac580e96adaa3da698d448e3.  Change-Id: I602bffc96f77cffa217cb63a5cc3caf334fd9879 Reviewed-on: https://chromium-review.googlesource.com/266652 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove non-const FBO attachment queries.  Methods that need to mutate the Framebuffer should use setAttachment etc instead of using mutable pointers.  BUG=angleproject:963  Change-Id: Ibe7b8f8245f762916e0224fdc78796b1c933195f Reviewed-on: https://chromium-review.googlesource.com/263490 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Store value types for FBO attachments.  This prevents us from re-allocating FBO attachments every set. This change requires quite a bit of refactoring.  BUG=angleproject:963  Change-Id: Iafa4e4a0f3dd66c9e7452e0e96a0cbb9753487bb Reviewed-on: https://chromium-review.googlesource.com/263489 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make Framebuffer::Data members private.  This makes "Data" a proper class and enforces access control when used in FramebufferImpl. This gives a cleaner refactor when we switch the internals of the class to use value types to store attachments instead of pointer types.  BUG=angleproject:963  Change-Id: If825095458eaf9367f616f0bb54084025efb9882 Reviewed-on: https://chromium-review.googlesource.com/265937 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add D3D11CreateDevice timing histogram.  This should give us a bound on how much we can improve startup time in ANGLE on D3D11 across all users.  BUG=angleproject:944 BUG=436191  Change-Id: Ie9047c0424429aecec5f6d7be8e119ebcc53fbe3 Reviewed-on: https://chromium-review.googlesource.com/266524 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Add histograms helper macros.  These macros mimic Chromium's histogram_macros.h so we can use similar values for our histograms.  BUG=angleproject:944 BUG=436191  Change-Id: If77abaf71964d26a6269183e51b68b76bb562085 Reviewed-on: https://chromium-review.googlesource.com/266523 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Temporarily disable some FenceSync tests on Intel OpenGL.  BUG=angleproject:888  Change-Id: Ia64d2f313c5ddf2ebb6efb54e205a22801fce01b Reviewed-on: https://chromium-review.googlesource.com/266503 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
perf_tests: Use 'score' units.  The dashboard automatically marks 'frames' as 'lower is better' while 'score' is automatically marked as 'higher is better'. Hence use score instead of frames.  BUG=468852  Change-Id: I02b3a9e4b74989793d4bfbf21a94e43670b3e028 Reviewed-on: https://chromium-review.googlesource.com/266522 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement FenceNVGL.  BUG=angleproject:888  Change-Id: Iea6993fe5459cf829f4bd23b0df5e223f22903f5 Reviewed-on: https://chromium-review.googlesource.com/264989 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement FenceSyncGL.  BUG=angleproject:888  Change-Id: Ie811266ed1cb08d29344fb11cd9afe77f9587cd7 Reviewed-on: https://chromium-review.googlesource.com/263654 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Support multisampled framebuffers with the GL backend.  Move validation of sample counts into the Renderbuffer implementations because the exact supported sample counts are not always known.  BUG=angleoproject:886  Change-Id: I9c90d9d435e940b852343a29a6aa11d6cb1ad23b Reviewed-on: https://chromium-review.googlesource.com/255513 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D11: Filter HRESULT error code properly.  The Windows helper function HRESULT_CODE masks out some bits that obscure the error code. This could be why we're seeing some undetermined errors in our logs.  BUG=477701  Change-Id: I6eee442c149c2568e3823edc538d365b06ee20d8 Reviewed-on: https://chromium-review.googlesource.com/266375 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add missing end-of-file newlines  Change-Id: I664e40f8d3f2276d5964b111d066861540010b43 Reviewed-on: https://chromium-review.googlesource.com/260791 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update The Qt Company in AUTHORS/CONTRIBUTORS  Change-Id: Iaa923e48d26eb1044d02ac097cc6caa1986309cf Reviewed-on: https://chromium-review.googlesource.com/263400 Tested-by: Andrew Knight <andrew.knight@intopalo.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Support constant folding of common built-ins  This change adds constant folding support for unary common built-ins: abs sign floor trunc round roundEven ceil and fract.  BUG=angleproject:913 TEST= dEQP tests dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.common* (80 out of 210 tests started passing with this change)  Change-Id: I46312fec43084601d4fca8195ddaaa5292f1c02a Reviewed-on: https://chromium-review.googlesource.com/265967 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Temporarily disable UniformArrayLocations test on Intel OpenGL.  BUG=angleproject:882  Change-Id: Idd5cb8c794bbeec162f65255231fe2ae0180bdf8 Reviewed-on: https://chromium-review.googlesource.com/266180 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Support constant folding of exponential built-ins"  Causing compile errors on Android:  ../../third_party/angle/src/compiler/translator/IntermNode.cpp:1309:62: error: use of undeclared identifier 'log2f'                 else if (!foldFloatTypeUnary(unionArray[i] &log2f infoSink &tempConstArray[i]))  This reverts commit 1623a1b90f24cd1afd8839c0726ad276a887fbda.  Change-Id: If9c45aea85801eb11e7d1513b4183ec11289d2f3 Reviewed-on: https://chromium-review.googlesource.com/266154 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Record more explicit error codes in Renderer init.  Our data shows the most common D3D11CreateDevice failure as being 'other error'. Explicitly enumerate more error codes so we can figure out which value we're getting.  BUG=47701  Change-Id: Ibcda5e8ff1bb0368b1bfe3c8e7e3ffbb404771ce Reviewed-on: https://chromium-review.googlesource.com/265939 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix uniform locations in ProgramGL.  ProgramGL was unable to handle uniform arrays and improperly set uniform locations. It now queries the driver for the location of each uniform and iterates over all array elements.  BUG=angleproject:882  Change-Id: Iffe9d12944b2399f19f4a7823df2f535a430d6e3 Reviewed-on: https://chromium-review.googlesource.com/265724 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Support constant folding of exponential built-ins  This change adds constant folding support for unary exponential built-ins - exp log exp2 log2 sqrt and inversesqrt.  BUG=angleproject:913 TEST= dEQP tests dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.exponential* (48 out of 56 tests started passing with this change)  Change-Id: I63133ee8c04c4a8d6cb30da5788e9227c05d4cbe Reviewed-on: https://chromium-review.googlesource.com/266071 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Support constant folding of trigonometry built-ins  This change adds constant folding support for trigonometry built-in functions. Constant folding for these functions also fixes constant expression issues where constant initializer is a built-in trignometry function whose arguments are all constant expressions.  BUG=angleproject:913 TEST= dEQP tests dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.angle_and_trigonometry* (112 out of 120 tests pass with this change)  Change-Id: I2b7a61320819dcd095827faa1fd16e835f4688b4 Reviewed-on: https://chromium-review.googlesource.com/265819 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Micro-optimize ValidateDrawBase.  This speeds up our draw call benchmark.  BUG=angleproject:959  Change-Id: I9a916a6c344493cc96873ae5f4ec337c181dc487 Reviewed-on: https://chromium-review.googlesource.com/266026 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Micro-optimize State::hasMappedBuffer.  This speeds up draw call validation.  BUG=angleproject:959  Change-Id: I8272e36201521f158823739a6604444fb5e66b6e Reviewed-on: https://chromium-review.googlesource.com/266025 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix style issues in updateTree()  "entry" is an old C keyword so it's better not to use it as a variable name. Also fix a few other minor style issues in the code.  TEST=angle_unittests BUG=angleproject:941  Change-Id: I59470555227985262b3e914ff6ca11e88d15fd8c Reviewed-on: https://chromium-review.googlesource.com/265647 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add an IndexDataManager perf test.  This microbenchmark tests the time at which we find index ranges in the cache and how long the call to prepareIndexData might take. It also verifies we successfully store index ranges in the cache.  BUG=angleproject:956  Change-Id: I0f1b0c00daa73d8e1bcde197d9de80ca229078b7 Reviewed-on: https://chromium-review.googlesource.com/262779 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add basic support for the length() method of arrays  Support expressions where the expression that .length() is called on does not have side effects.  Tested with WebGL 2 test sdk/tests/deqp/data/gles3/shaders/arrays.html  TEST=WebGL 2 conformance tests BUG=angleproject:972  Change-Id: Ib4f8377a51da61179b6e47fbcf6b4d915e351fbd Reviewed-on: https://chromium-review.googlesource.com/265654 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Disallow ternary operator on arrays and structs  ESSL specs only allow a limited number of operators on arrays and structs. The spec section on the ternary operator contradicts this to an extent saying that the second and third operands can be "any type" or "any type other than an array" but we interpret the spec so that the operator restrictions on structures and arrays override this.  BUG=angleproject:976 TEST=angle_unittests  Change-Id: Icd90d5450dcb94bb23b1683d4cb9e579e82de4ad Reviewed-on: https://chromium-review.googlesource.com/265644 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Refactor ternary operator parsing  Refactor ternary operator parsing so that validation is done in ParseContext and Intermediate's role is simply to create the node added to the tree.  Remove partially bugged checks for null nodes as a part of this - in error cases the parser doesn't typically add null nodes to the tree but rather always has a fallback to add a dummy node if parsing fails as a method of recovery. When parsing ternary operators it should be guaranteed that none of the parameter nodes is null.  Includes a better explanation of why ternary operators are not always folded when only the condition is constant and a test to make sure this doesn't regress.  BUG=angleproject:952 TEST=WebGL conformance tests angle_unittests  Change-Id: Icbcb721b5ab36cf314a16e79f9814aef1f355fa0 Reviewed-on: https://chromium-review.googlesource.com/265643 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
D3D11: Only rewrite for primitive restart when needed.  We would rewrite our index data every draw call. Change the index check to see if we're writing to the same sized / typed static buffer and only rewrite the data if the user re-uploaded.  Also add a performance test for the primitive restart workaround.  As a future improvement we could avoid creating new D3D objects every time we reinitialize static data since BufferSubData calls don't change the size of the buffer if the index type remains the same.  BUG=476658  Change-Id: I9d2540ad8b1b34fa0142ba0bf794cf572da8c61d Reviewed-on: https://chromium-review.googlesource.com/265838 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
perftests: Use gtest asserts macro helpers.  We still were using the old cassert code with a boolean return value on our initialization code. We can make use of the gtest macros and helpers to check for a successful init or GL errors.  BUG=476658  Change-Id: I09cbb3d40748cbeaf530ae8f23fb8a1b07e7611f Reviewed-on: https://chromium-review.googlesource.com/265837 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Update WebGL CTS expectations.  Change-Id: I4f51fdb1e23effa0069f1dd1e84b95b3a313f678 Reviewed-on: https://chromium-review.googlesource.com/265836 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Store current transform feedback buffer bindings in the object itself.  BUG=angleproject:763  Change-Id: I76565f68fa8145da29713de2a517a39a8d50a24b Reviewed-on: https://chromium-review.googlesource.com/263061 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Rename TransformFeedback members to match the spec.  BUG=angleproject:763  Change-Id: I12fa57de9263eb0cb5ff1840cf44b0a8f2a40912 Reviewed-on: https://chromium-review.googlesource.com/263721 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor uniform array name parsing to a utility function.  BUG=angleproject:882  Change-Id: I00fd6d3cfaa107561cee5e4c82d3c60438052963 Reviewed-on: https://chromium-review.googlesource.com/265723 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Squash the attachment types.  We can store all relevant information in the base class which lets us avoid using any virtual methods. This will finally let us avoid using reallocations on FBO attachment sets.  BUG=angleproject:963  Change-Id: Ib4b61da14efaf843478b059499c01e34f9c65e4f Reviewed-on: https://chromium-review.googlesource.com/263488 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add FramebufferAttachmentObject base class.  This lets us share objects (Textures/RBs/Surface) in the attachment class. It will let us squash the attachment classes into one type which will in turn let us store them by-value instead of by-pointer.  BUG=angleproject:963  Change-Id: Ia9a43dbc3b99475c00f6bc2ed5475deef55addc3 Reviewed-on: https://chromium-review.googlesource.com/263487 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disable macro redefinition warning for vs2015  From flexint.h (because VS2015 has some of c99 but doesn't define __STDC_VERSION__ yet.  Change-Id: Iff82f4c72dd816dcc1959abb218442a848ea592a c:\program files (x86)\microsoft visual studio 14.0\vc\include\stdint.h(48): error C2220: warning treated as error - no 'object' file generated c:\program files (x86)\microsoft visual studio 14.0\vc\include\stdint.h(48): warning C4005: 'INT8_MIN': macro redefinition d:\src\cr3\src\out\debug\glslang_lex.cpp(83): note: see previous definition of 'INT8_MIN' c:\program files (x86)\microsoft visual studio 14.0\vc\include\stdint.h(49): warning C4005: 'INT16_MIN': macro redefinition d:\src\cr3\src\out\debug\glslang_lex.cpp(86): note: see previous definition of 'INT16_MIN' c:\program files (x86)\microsoft visual studio 14.0\vc\include\stdint.h(50): warning C4005: 'INT32_MIN': macro redefinition d:\src\cr3\src\out\debug\glslang_lex.cpp(89): note: see previous definition of 'INT32_MIN' c:\program files (x86)\microsoft visual studio 14.0\vc\include\stdint.h(52): warning C4005: 'INT8_MAX': macro redefinition d:\src\cr3\src\out\debug\glslang_lex.cpp(92): note: see previous definition of 'INT8_MAX' c:\program files (x86)\microsoft visual studio 14.0\vc\include\stdint.h(53): warning C4005: 'INT16_MAX': macro redefinition d:\src\cr3\src\out\debug\glslang_lex.cpp(95): note: see previous definition of 'INT16_MAX' c:\program files (x86)\microsoft visual studio 14.0\vc\include\stdint.h(54): warning C4005: 'INT32_MAX': macro redefinition d:\src\cr3\src\out\debug\glslang_lex.cpp(98): note: see previous definition of 'INT32_MAX' c:\program files (x86)\microsoft visual studio 14.0\vc\include\stdint.h(56): warning C4005: 'UINT8_MAX': macro redefinition d:\src\cr3\src\out\debug\glslang_lex.cpp(101): note: see previous definition of 'UINT8_MAX' c:\program files (x86)\microsoft visual studio 14.0\vc\include\stdint.h(57): warning C4005: 'UINT16_MAX': macro redefinition d:\src\cr3\src\out\debug\glslang_lex.cpp(104): note: see previous definition of 'UINT16_MAX' c:\program files (x86)\microsoft visual studio 14.0\vc\include\stdint.h(58): warning C4005: 'UINT32_MAX': macro redefinition d:\src\cr3\src\out\debug\glslang_lex.cpp(107): note: see previous definition of 'UINT32_MAX' Reviewed-on: https://chromium-review.googlesource.com/265594 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add support for implicit array size  ESSL3 introduces implicit array size that is determined automatically according to the initializer. Implicit sizes are resolved when parsing constructors and when initializers are evaluated so ANGLE's AST will not contain implicit sizes.  Declarations where there are two differently sized arrays with the same implicitly sized type for example:  float[] a = float[](0.0) b = float[](0.0 1.0);  will be transformed into declarations where the two arrays don't share the array size like this:  float a[1] = float[1](0.0) float b[2] = float[2](0.0 1.0);  so they are not a problem.  Unlike sized arrays implicitly sized arrays don't have a size limit enforced by the parser.  Include a test that verifies that non-initialization of an implicitly sized array defined using ESSL3 type syntax is caught by the parser.  Additionally tested with WebGL 2 test sdk/tests/deqp/data/gles3/shaders/arrays.html  TEST=WebGL 2 conformance tests angle_unittests BUG=angleproject:941  Change-Id: Ib55b7601848102a103af9db284a80f09abaeb021 Reviewed-on: https://chromium-review.googlesource.com/265653 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add parser support for initializing sized arrays  Still missing from this patch: HLSL output implicitly sized arrays.  Tested with WebGL 2 test sdk/tests/deqp/data/gles3/shaders/arrays.html  TEST=WebGL 2 conformance tests BUG=angleproject:941  Change-Id: I900f2af843fd8046f23dd4b77352e77026bbba84 Reviewed-on: https://chromium-review.googlesource.com/265652 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Unify declaration parsing code  Remove the unused identifierSymbol parameter from parseSingleDeclarator and unify the ordering of parameters and the code style of different declaration and declarator parsing functions. Some minor functional changes to array size handling are done mainly to unify error message generation. There's soon going to be more of these functions so it's good to be systematic.  TEST=angle_unittests WebGL conformance tests BUG=angleproject:941  Change-Id: I03b0220de93ca5719fdb7c1790a5999b8cb5b225 Reviewed-on: https://chromium-review.googlesource.com/265202 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add tests for disallowing arrays of arrays  TEST=angle_unittests BUG=angleproject:941  Change-Id: Ie45a8a581bf2931ecccfc41b26db49a257fcaf1d Reviewed-on: https://chromium-review.googlesource.com/265201 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Improve handling of declarator lists with empty declarations  The code previously failed to check for correctness of layout qualifiers in case a declarator followed an empty declaration like so:  layout(packed) uniform float a;  Fix this by running all necessary declaration checks also for declarators which follow an empty declaration.  structQualifierErrorCheck is merged into singleDeclarationErrorCheck.  TEST=angle_unittests WebGL conformance tests BUG=angleproject:969  Change-Id: Idcb0673e3bcf64087744ff0d260f51a7546f024a Reviewed-on: https://chromium-review.googlesource.com/264812 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix structQualifierErrorCheck calls in glslang.y  structQualifierErrorCheck is called incorrectly in glslang.y. Remove one unnecessary call entirely and change another call to samplerErrorCheck. This will enable further changes to merge structQualifierErrorCheck into singleDeclarationErrorCheck.  TEST=angle_unittests BUG=angleproject:969  Change-Id: Ib43233e275fbf4db7e5fda6df6b45a655bdee8a2 Reviewed-on: https://chromium-review.googlesource.com/265200 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add support for arrays as function return values in GLSL output  Output the array brackets and the array size correctly when a function's return value type is array.  Tested with WebGL 2 test sdk/tests/deqp/data/gles3/shaders/arrays.html  BUG=angleproject:971 TEST=WebGL 2 conformance tests  Change-Id: I63aa8c54d2696f65351b23acb0749a487298ddfb Reviewed-on: https://chromium-review.googlesource.com/265410 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
perftests: Fix simple draw call benchmark.  Previously the code was only testing the validation logic. Fix this by testing validation-only and a simple single quad draw benchmark.  BUG=468852  Change-Id: I510deea08fee5932f51ea39883ed91652be476df Reviewed-on: https://chromium-review.googlesource.com/265751 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Release Surface when calling makeCurrent with null.  Refactorings to egl::Surface to enable ref-counting were causing a situation where we could have two Window surfaces alive at the same time. This would confuse the window procedure logic in SurfaceD3D. Releasing the surface fixes this issue and conforms closely to the wording on the spec on when Surfaces should be deleted. Also add a test for message loops and surfaces.  BUG=475085 BUG=angleproject:963  Change-Id: Icdee3a7db97c9b54d779dabf1e1f82a89fefc546 Reviewed-on: https://chromium-review.googlesource.com/265064 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move maxSamples from Extensions to Caps because it is an ES3 limit.  BUG=angleproject:886  Change-Id: Ibcfc2f06e8308e2e6eb1a6c38206b803f689d7af Reviewed-on: https://chromium-review.googlesource.com/265470 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't set a null current WGL context in the Surface destructor.  By setting a null current context there is a brief window where all GL calls will fail.  Since there is only one WGL context just leave in on the unreferenced window until a new window is made current.  BUG=angleproject:890  Change-Id: I51eadf23ca61e274f7d174ac5a9e0592bcdadebc Reviewed-on: https://chromium-review.googlesource.com/265483 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D11: Only use share handles with HW driver.  WARP does not support surface sharing like native D3D11. This combined with a Chromium-side change should fix WARP rendering in Chrome.  BUG=angleproject:973 BUG=429792  Change-Id: I41e778625e8697e45657843f2f337bcffe7ddbe2 Reviewed-on: https://chromium-review.googlesource.com/265611 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Generate blit shaders on demand.  This saves a ms or two on D3D11 startup.  Change-Id: I156c25029a0b2aeb48e5b76b31737c155111e07f Reviewed-on: https://chromium-review.googlesource.com/264936 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add trace events for D3D11 initialization.  This helps a local user profile their D3D11 startup time.  BUG=436191 BUG=angleproject:966  Change-Id: Ib1b3d62194233cd502980d87c316a95e9bd3a04c Reviewed-on: https://chromium-review.googlesource.com/264935 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove SetTraceFunctionPointers and update APIs.  Now that Chromium is switched to ANGLE's new Platform tracing methods we can junk the old APIs.  BUG=angleproject:966 BUG=436191  Change-Id: Ie2564eed9e5ce4604e0dcd4582618e7467b2d590 Reviewed-on: https://chromium-review.googlesource.com/264934 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Add extension EGL_ANGLE_device_d3d  Access to the D3D device is needed for some advanced scenarios. New entry points eglQueryDisplayAttribANGLE and eglQueryDeviceAttribANGLE have been added in this change to implement this extension.  BUG=angleproject:935  Change-Id: Ie39e86a2b6c6d8d05a08964b2907fb9fba5dec13 Reviewed-on: https://chromium-review.googlesource.com/265591 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Support constant folding of trigonometry built-ins"  Part of a chain causing compile errors on Mac. Example:  ../../third_party/angle/src/compiler/translator/IntermNode.cpp:1216:89: error: no member named 'sin' in namespace 'std'; did you mean 'sinf'?  http://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Linux%20Builder/builds/33747  This reverts commit 1767e6b4f9148a6aa462d23e3838810c0080ce78.  Change-Id: Ie39b1bf9a08da61aa0b16e219b34d1ba0b6f6c0f Reviewed-on: https://chromium-review.googlesource.com/265587 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Support constant folding of exponential built-ins"  Part of a chain causing compile errors on Mac. Example:  ../../third_party/angle/src/compiler/translator/IntermNode.cpp:1216:89: error: no member named 'sin' in namespace 'std'; did you mean 'sinf'?  http://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Linux%20Builder/builds/33747  This reverts commit 62e2c8d2bc55c41db4e6095eac012b8861131585.  Change-Id: Id20f7f4efbc3df7756161b192d4858caeeb0572f Reviewed-on: https://chromium-review.googlesource.com/265627 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Support constant folding of common built-ins"  Part of a chain causing compile errors on Mac. Example:  ../../third_party/angle/src/compiler/translator/IntermNode.cpp:1216:89: error: no member named 'sin' in namespace 'std'; did you mean 'sinf'?  http://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Linux%20Builder/builds/33747  This reverts commit 2b1da6ed1dbe5960bed8c1b2fa3d33cb00c6c116.  Change-Id: I5d48932a6254d6d1e78966bb3891913d9450e08e Reviewed-on: https://chromium-review.googlesource.com/265612 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Use nullptr consistently in TIntermConstantUnion::fold"  Part of a chain causing compile errors on Mac. Example:  ../../third_party/angle/src/compiler/translator/IntermNode.cpp:1216:89: error: no member named 'sin' in namespace 'std'; did you mean 'sinf'?  http://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Linux%20Builder/builds/33747  This reverts commit 72ed20d4bb5a5c55d9909d6cc9b7a0e89e4a81a2.  Change-Id: Ia6119f6081b3184deef3deef25b9e3f43ff2e2a6 Reviewed-on: https://chromium-review.googlesource.com/265586 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Add extension EGL_ANGLE_device_d3d"  Compile error on clang: src/libANGLE/Display.cpp:259:23: error: allocation of incomplete type 'egl::Device'         mDevice = new Device(this impl);                       ^~~~~~ src/libANGLE/Display.h:36:7: note: forward declaration of 'egl::Device' class Device;       ^ In file included from src/libANGLE/Display.cpp:11: In file included from src/libANGLE/Display.h:17: In file included from src/libANGLE/Error.h:80: In file included from src/libANGLE/Error.inl:9: src/common/angleutils.h:66:5: error: deleting pointer to incomplete type 'egl::Device' may cause undefined behavior [-Werror-Wdelete-incomplete]     delete resource;     ^      ~~~~~~~~ src/libANGLE/Display.cpp:209:5: note: in instantiation of function template specialization 'SafeDelete<egl::Device>' requested here     SafeDelete(mDevice);     ^ src/libANGLE/Display.h:36:7: note: forward declaration of 'egl::Device' class Device;       ^ 2 errors generated.  This reverts commit 6dacaff4e03d4f6b4c444a3fff018c1297cd25ba.  Change-Id: Ide348e156324a5af668604362c0b249ea73b6083 Reviewed-on: https://chromium-review.googlesource.com/265626 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add extension EGL_ANGLE_device_d3d  Access to the D3D device is needed for some advanced scenarios. New entry points eglQueryDisplayAttribANGLE and eglQueryDeviceAttribANGLE have been added in this change to implement this extension.  BUG=angleproject:935  Change-Id: Id1560b0887fa5882b9858af7bad9043ada67038d Reviewed-on: https://chromium-review.googlesource.com/251610 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use nullptr consistently in TIntermConstantUnion::fold  Newly added code in TIntermConstantUnion::fold uses nullptr where as remaining part of the function uses NULL. This change removes NULL and consistently uses nullptr in complete function.  Change-Id: I600dcf11b686d8d72b2bcdac88b7158288c68105 Reviewed-on: https://chromium-review.googlesource.com/265395 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Support constant folding of common built-ins  This change adds constant folding support for unary common built-ins: abs sign floor trunc round roundEven ceil and fract.  BUG=angleproject:913 TEST= dEQP tests dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.common* (80 out of 210 tests started passing with this change)  Change-Id: I06800ed0e03764c0f7aab6bcd45c4f122de5a3c1 Reviewed-on: https://chromium-review.googlesource.com/265394 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Support constant folding of exponential built-ins  This change adds constant folding support for unary exponential built-ins - exp log exp2 log2 sqrt and inversesqrt.  BUG=angleproject:913 TEST= dEQP tests dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.exponential* (48 out of 56 tests started passing with this change)  Change-Id: Ie7808cd57d6ed7598c642a9a0940b8f5bd293741 Reviewed-on: https://chromium-review.googlesource.com/265393 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Support constant folding of trigonometry built-ins  This change adds constant folding support for trigonometry built-in functions. Constant folding for these functions also fixes constant expression issues where constant initializer is a built-in trignometry function whose arguments are all constant expressions.  BUG=angleproject:913 TEST= dEQP tests dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.angle_and_trigonometry* (112 out of 120 tests pass with this change)  Change-Id: I66275b2ae9faecef63d76763d21a9b67d9bb68fa Reviewed-on: https://chromium-review.googlesource.com/265392 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
perf_tests: Only print final score result.  Don't print all the other measurements and values since they'll just add noise to the perf bot dashboards. Also increase the run time of the DrawCallPerfTest to 10.0 seconds.  BUG=angleproject:744 BUG=468852  Change-Id: If076055ad46b4e6923f39687edcaa25930b188a7 Reviewed-on: https://chromium-review.googlesource.com/265464 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Delete Image.h.  Change-Id: I83135eabfe5c71f8b07338e2552d1ddd89f150c2 Reviewed-on: https://chromium-review.googlesource.com/265233 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Simplify code related to variable declaration  Rename nonInitErrorCheck to declareVariable to clarify that it declares variables. Merge arrayErrorCheck with that so that logic that is common between array and non-array declarations is only in one place. This will simplify adding array initializer handling. This also enables redeclaring gl_LastFragData using ESSL3 array type syntax.  Comments in executeInitializer claimed that the TVariable object was needed for error recovery but that was not actually true so it can also use the new declareVariable method. Make "variable" a local variable instead of a parameter to executeInitializer since the parameter was never used by callers of the function.  TEST=angle_unittests WebGL conformance tests BUG=angleproject:941  Change-Id: Ie133be62afc3e1f997370803cf21cada4e738935 Reviewed-on: https://chromium-review.googlesource.com/264674 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Skip Pbuffer tests depending on Pbuffer support.  BUG=angleproject:890  Change-Id: Ie10276453c35c65ffa0e26f8039db3ec3e65064e Reviewed-on: https://chromium-review.googlesource.com/265187 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Support constant folding of trigonometry built-ins"  Part of a chain breaking the clang build:  http://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Linux%20Builder/builds/33588  This reverts commit af930db15010cacfcdc74bee630372b8f6eb3eeb.  Change-Id: Ic0bf09b4088a1ee285fed0fbd77dfc4c682fcd12 Reviewed-on: https://chromium-review.googlesource.com/265144 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Support constant folding of exponential built-ins"  Part of a chain breaking the clang build:  http://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Linux%20Builder/builds/33588  This reverts commit 1c89caef47a27c63a7d0f988e74816692a9b9b39.  Change-Id: I36e080d8f64d4d4ca5de04bebbd119db83956d0e Reviewed-on: https://chromium-review.googlesource.com/265185 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Support constant folding of common built-ins"  Part of a chain breaking the clang build:  http://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Linux%20Builder/builds/33588  This reverts commit 0273c68c507a10af3e45c6e4a52a44adcd0cf742.  Change-Id: I00d7617a7c380f2a5ea3f38ec14948a598aa5c1a Reviewed-on: https://chromium-review.googlesource.com/265184 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Use nullptr consistently in TIntermConstantUnion::fold"  Part of a chain breaking the clang build:  http://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Linux%20Builder/builds/33588  This reverts commit 5f2feee42971fdbbd7cb389fffe2f632060ec6e3.  Change-Id: I5ad54b05148ae2d4f19e50a67aded2bad4f55f91 Reviewed-on: https://chromium-review.googlesource.com/265143 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add tests for FenceNV and FenceSync objects.  BUG=angleproject:888  Change-Id: Ic5eca4d88854f8127114d6b54666f32d5d6df9f2 Reviewed-on: https://chromium-review.googlesource.com/264588 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix issues with computing discontinuous loops  AST analysis to narrow down usage of [[loop]] and [[unroll]] failed to account for break statements inside switch statements. Add switch statement handling. This fixes asserts/crashes in dEQP tests.  BUG=angleproject:937 TEST=dEQP-GLES3.functional.shaders.switch.*  Change-Id: I04fdfe4733772a2a234934123bbfacf0376df562 Reviewed-on: https://chromium-review.googlesource.com/265191 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use nullptr consistently in TIntermConstantUnion::fold  Newly added code in TIntermConstantUnion::fold uses nullptr where as remaining part of the function uses NULL. This change removes NULL and consistently uses nullptr in complete function.  Change-Id: Ieaada3cf46bf3e16d3ef91b300c86537f778c33f Reviewed-on: https://chromium-review.googlesource.com/264632 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Support constant folding of common built-ins  This change adds constant folding support for unary common built-ins: abs sign floor trunc round roundEven ceil and fract.  BUG=angleproject:913 TEST= dEQP tests dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.common* (80 out of 210 tests started passing with this change)  Change-Id: I09f2f99b3108e0d2fb1919a0631e4317b6a28be3 Reviewed-on: https://chromium-review.googlesource.com/263709 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Support constant folding of exponential built-ins  This change adds constant folding support for unary exponential built-ins - exp log exp2 log2 sqrt and inversesqrt.  BUG=angleproject:913 TEST= dEQP tests dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.exponential* (48 out of 56 tests started passing with this change)  Change-Id: I22af56876d1b7ce305697bf9bf43ad9ec5d8a3a5 Reviewed-on: https://chromium-review.googlesource.com/263708 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Support constant folding of trigonometry built-ins  This change adds constant folding support for trigonometry built-in functions. Constant folding for these functions also fixes constant expression issues where constant initializer is a built-in trignometry function whose arguments are all constant expressions.  BUG=angleproject:913 TEST= dEQP tests dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.angle_and_trigonometry* (112 out of 120 tests pass with this change)  Change-Id: I2ed4360532469fe0d70048d5f2300a8db6f9fcda Reviewed-on: https://chromium-review.googlesource.com/263679 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Clean up arrayErrorCheck  Remove some unnecessary TPublicType/TType conversions from the code and clean up code style. voidErrorCheck is changed to take TBasicType so that it can be used with both TType and TPublicType.  TEST=angle_unittests BUG=angleproject:941  Change-Id: I6f6cbc0761a4fc971299bad48864309009c54e7f Reviewed-on: https://chromium-review.googlesource.com/264673 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix a bunch of mistakes in MalformedShaderTest  A number of mistakes had slipped in to this test that made the compilation of some shaders always fail regardless of the semantic checks applied by the parser.  TEST=angle_unittests BUG=angleproject:941  Change-Id: I9906792e2c7fe3805288255b855afb46840a77a7 Reviewed-on: https://chromium-review.googlesource.com/264811 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove now unused DetectDiscontuinity.h/.cpp  BUG=angleproject:937 BUG=395048  Change-Id: Ie8e520267d594a595201cb7c2438a2202d9adf25 Reviewed-on: https://chromium-review.googlesource.com/263745 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Ignore visual studio profiler and nsight files.  Change-Id: I01cb029300760341262fb27cafc32d4366d161c0 Reviewed-on: https://chromium-review.googlesource.com/265005 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
WGL Pbuffer implementation.  BUG:angleproject:890  Change-Id: Id6e04117ddf7bde3ffb0d9e4cef6db3d07039a54 Reviewed-on: https://chromium-review.googlesource.com/261410 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use the AST analyses to narrow the usage of [[loop]] and [[unroll]]  These attributes are now used exactly in the loops and ifs that require them limiting the number of failed compilations due to excessive unrolling and flattening. Also output Lod0 functions only when needed.  Adds unit tests for LOOP FLATTEN and Lod0 generation.  The patch was tested against the WebGL CTS 1.0.4 for which all the failures existed prior to this patch and seem to be unrelated to this change. It also works correctly on the following sites that had trouble with [[loop]] and [[unroll]]:  * dev.miaumiau.cat/rayTracer "Skull Demo"  * The turbulenz engine particle demo  * Lots of ShaderToy samples (including "Volcanic" and "Metropolis")  * Google Maps Earth mode  * Lots of Chrome Experiments  * Lagoa  * madebyevan.com/webgl-water  * SketchFab  * Unit Tests  BUG=angleproject:937 BUG=395048  Change-Id: I856de9025f10b79781929ec212dbffc2064a940e Reviewed-on: https://chromium-review.googlesource.com/264791 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix and enable warning C4244 (Conversion from 'type1' to 'type2' possible loss of data)  Change-Id: Id0e06d7d6600344d858f00dabc219d79289bbc82 Reviewed-on: https://chromium-review.googlesource.com/265020 Tested-by: Minmin Gong <mgong@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Fix and enable warning C4244 (Conversion from 'type1' to 'type2' possible loss of data)"  Causing a build failure on Mac/Clang:  ./Tokenizer.cpp:551:7: error: extra tokens at end of #else directive [-Werror-Wextra-tokens] #else if defined(_MSC_VER)  http://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Mac%20Builder/builds/29136  This reverts commit 3b26e231d99154814eb428f75a67bbe7a21adadc.  Change-Id: I2d11ddcc18130d908fd2ec3d6f5ab890cfccd5e7 Reviewed-on: https://chromium-review.googlesource.com/264983 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add tests of basic Pbuffer functionality.  BUG=angleproject:890  Change-Id: I8f82414d1875f80269bd9dd1f629e5b7903cb584 Reviewed-on: https://chromium-review.googlesource.com/264380 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix and enable warning C4244 (Conversion from 'type1' to 'type2' possible loss of data)  Change-Id: I73d9a2b9ad16f032be974b9c819de0dc1247c2ea Reviewed-on: https://chromium-review.googlesource.com/264533 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove code related to redeclaration of arrays  It should not be possible to redeclare arrays. This seems to be another thing left over from earlier erroneous code which allowed declaring unsized arrays.  TEST=angle_unittests BUG=angleproject:941  Change-Id: I711565230b35df077f268cec6fdeac6c4c03b4cd Reviewed-on: https://chromium-review.googlesource.com/264672 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Make checking for array non-constness depend on input version  First remove duplicate check for const qualifier on arrays. Only keep the check inside arrayQualifierErrorCheck().  Second ESSL3 will introduce array initializers and by extension constant arrays so it should allow const qualifier on arrays. These checks are somewhat superfluous in ESSL1 as well since the parser already checks for missing initializers but it's useful to keep the informative error messages around.  Add a few tests to make sure that when the ESSL3 implementation progresses it still checks for missing initializers on constant arrays.  TEST=angle_unittests BUG=angleproject:941  Change-Id: Id871c872c5b92e2a5bf81c00080ac23004916a75 Reviewed-on: https://chromium-review.googlesource.com/264671 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "Use the AST analyses to narrow the usage of [[loop]] and [[unroll]]"  Caused linking failures on mac because the unit test asks for TranslatorHLSL which is not compiled.  This reverts commit 3342e01f2a29343ea95961f0194f9d4f422cb840.  Change-Id: I02b2f54ca5b90611f11b7a549e75bf2e8310639d Reviewed-on: https://chromium-review.googlesource.com/264790 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Use the AST analyses to narrow the usage of [[loop]] and [[unroll]]  These attributes are now used exactly in the loops and ifs that require them limiting the number of failed compilations due to excessive unrolling and flattening. Also output Lod0 functions only when needed.  Adds unit tests for LOOP FLATTEN and Lod0 generation.  The patch was tested against the WebGL CTS 1.0.4 for which all the failures existed prior to this patch and seem to be unrelated to this change. It also works correctly on the following sites that had trouble with [[loop]] and [[unroll]]:  * dev.miaumiau.cat/rayTracer "Skull Demo"  * The turbulenz engine particle demo  * Lots of ShaderToy samples (including "Volcanic" and "Metropolis")  * Google Maps Earth mode  * Lots of Chrome Experiments  * Lagoa  * madebyevan.com/webgl-water  * SketchFab  * Unit Tests  BUG=angleproject:937 BUG=395048  Change-Id: If7baddae1cdae0b3a414aa49e5a4c4babedbfe50 Reviewed-on: https://chromium-review.googlesource.com/261263 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Temporarily disable the RenderToMipmap on Intel OpenGL.  BUG=angleproject:905  Change-Id: If398b7f3cb60f3efdafce0f3709f965120977603 Reviewed-on: https://chromium-review.googlesource.com/264665 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement GL_VENDOR and GL_RENDERER strings for RendererGL.  Change-Id: Ib83faa605fd1b992e19ddc2b72c7917d82245d32 Reviewed-on: https://chromium-review.googlesource.com/264664 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement discontinuous loops AST analysis  This will allow narrowing down which usages of [[flatten]] and [[unroll]] are actually useful.  BUG=angleproject:937 BUG=395048  Change-Id: I091e647e3053d22edadd0cabb7c50bd5efa690b2 Reviewed-on: https://chromium-review.googlesource.com/263776 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement gradient operation AST analysis  This will allow narrowing down which usages of [[flatten]] and [[unroll]] are actually useful.  BUG=angleproject:937 BUG=395048  Change-Id: Ib8d7b98431b8cd3563e1eff8ecc9ed5df1a9b7d6 Reviewed-on: https://chromium-review.googlesource.com/263775 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add a compiler option to prune unused function and prototypes  Also adds a simple unit test checking the pruning  BUG=angleproject:937 BUG=395048  Change-Id: I88440378f66178dcebebcd596f8f80235903f20e Reviewed-on: https://chromium-review.googlesource.com/264568 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Add a compiler option to prune unused function and prototypes"  Compile error on Mac:  http://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Mac%20Builder/builds/29051  This reverts commit e423d9ca6e1b340ae06d543419b8a515de5ac3f2.  Change-Id: Ie08d7f2bf86089a006f3177480aa7491a9405257 Reviewed-on: https://chromium-review.googlesource.com/264585 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a compiler option to prune unused function and prototypes  Also adds a simple unit test checking the pruning  BUG=angleproject:937 BUG=395048  Change-Id: I49904c34d1a72949cdc579569967d99c736c7237 Reviewed-on: https://chromium-review.googlesource.com/264415 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implemented a CallDAG to allow for more AST analysis  The CallDAG preprocesses the AST to construct a DAG of functions that can be used for several analyses. Use it to implement check for recursion and max call depth. It will also be used to limit the usage of [[flatten]] and [[unroll]].  BUG=angleproject:937 BUG=395048  Change-Id: I8578703f2d49513f315aecccbcff34914562e4ff Reviewed-on: https://chromium-review.googlesource.com/263774 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Add UBO offset emulation for D3D11.0 and below.  BUG=angleproject:507  Change-Id: I6c5028930051a2af0bd6ffa0ee213e692d3892ef Reviewed-on: https://chromium-review.googlesource.com/261824 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Split Buffer::map into map and mapRange to match the API.  BUG=angleproject:681  Change-Id: Ia4bf2b81134a922265ca762f33ac85d9ddbf1a7c Reviewed-on: https://chromium-review.googlesource.com/261890 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add support for GL_OES_fbo_render_mipmap with OpenGL.  BUG=angle:905  Change-Id: Idde35172cfa495c8b74b961f4ab8c4e657653074 Reviewed-on: https://chromium-review.googlesource.com/263763 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Replace setArray function in TPublicType with functions from TType  Having only one way of setting or clearing arrayness of types clarifies code dealing with arrays.  TEST=angle_unittests BUG=angleproject:941  Change-Id: I98cb7c44fd66440c9de8b4c6c4a02827e9300db7 Reviewed-on: https://chromium-review.googlesource.com/264361 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Remove half-baked non-sized array support  ANGLE used to accept shaders with non-sized arrays in initializer lists. Fix this. Proper support for implicitly sized arrays will be implemented later for ESSL3.  TEST=angle_unittests BUG=angleproject:941  Change-Id: I53c5ccf0f7ef09ad30e142f8350812959fc4846c Reviewed-on: https://chromium-review.googlesource.com/264360 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Temporarily disable TextureTest with OpenGL.  Failures seen on some FYI bots.  Change-Id: I4853438c34ce55a1d803d3a7edf3b3e077905264 Reviewed-on: https://chromium-review.googlesource.com/264462 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Disable all copy image tests on Intel.  Change-Id: I5412daf42777caeac37de4bdc661b01480d887fd Reviewed-on: https://chromium-review.googlesource.com/264451 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix GN Windows component build.  The translator_static dependency is missing from libANGLE. GYP has this dependency.  Change-Id: I30165a041f88f7e3c6f550744d2c7a4103d0f520 Reviewed-on: https://chromium-review.googlesource.com/264425 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add stubs for GL_OES_fbo_render_mipmap.  BUG=angle:905  Change-Id: Idd4964bd2d9d07cd98137770e1cc57397f1dd3a6 Reviewed-on: https://chromium-review.googlesource.com/263762 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add texture format utilities for GL and generate GL texture caps.  BUG=angleproject:884  Change-Id: Ib1b13f59a6b21399c4b35695c704c369f572914e Reviewed-on: https://chromium-review.googlesource.com/264399 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Add texture format utilities for GL and generate GL texture caps."  This reverts commit 69bde01adf1f9d94cb1ea91c2902267ef3340f02.  Change-Id: If21c22e91cf5d72364839bbcc21cb83901a3f2cd Reviewed-on: https://chromium-review.googlesource.com/264418 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add Platform methods for event tracing.  Event tracing requires pulling in timing counters so we can sync with Chromium's timestamps. It may require a bit more tricky stuff to sync ANGLE's GPU timestamps with trace timestamps but should allow us to add GPU trace events in the future.  BUG=chromium:436191 BUG=angleproject:966  Change-Id: Ie1dc2981650d96888f988fa74b6fa435fbe8edc2 Reviewed-on: https://chromium-review.googlesource.com/263781 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement copyImage and copySubImage in TextureGL.  BUG=angleproject:885 BUG=angleproject:884  Change-Id: I083b72059c55157e2a3ee00ec778f819a100be7b Reviewed-on: https://chromium-review.googlesource.com/263179 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add texture format utilities for GL and generate GL texture caps.  BUG=angleproject:884  Change-Id: Iba0108b22e6a404842ec1013d22c00d206c865d3 Reviewed-on: https://chromium-review.googlesource.com/255512 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Only check dynamic type in Impl casting helpers.  We can use the Impl casting helper methods to clean up dynamic type casting.  Change-Id: I5706da74eedd9f3cdc5a728420074a91ad7c95cb Reviewed-on: https://chromium-review.googlesource.com/263520 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use GetAs/GetImplAs whenever possible.  This patch cleans up the rest of our custom casting helper functions.  Change-Id: I41975c736765fca855c4498acca31116df3e8317 Reviewed-on: https://chromium-review.googlesource.com/263477 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Don't delete sysmem storage if it is the latest storage.  BUG=angleproject:965  Change-Id: I9b4b042e3f9bde3ce713a02aa353b5f3a5cff49e Reviewed-on: https://chromium-review.googlesource.com/263711 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Gregoire Payen de La Garanderie <Gregory.Payen@imgtec.com>, 23355681, 619, 169, 619
Support assigning array constructors in HLSL output  This adds support to the following type of shader code where an array constructor is used as a source of assignment:  float a[3]; a = float[3](0.0 1.0 2.0);  The assignment gets replaced in the HLSL code by a function call where the array is an out parameter and the constructor parameters are regular parameters.  Constructors cannot yet be used in initializers.  With this change in place some of the relevant dEQP tests start passing.  TEST=dEQP-GLES3.functional.shaders.arrays.constructor.* BUG=angleproject:941  Change-Id: I13ed603c02a30d9f9950a61c4d562ae9fac058ec Reviewed-on: https://chromium-review.googlesource.com/263403 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add basic support for array constructors  Add limited support for parsing array constructors and writing them out as GLSL code.  Still missing from this version: HLSL output array support in initializer lists arrays with implicit size.  BUG=angleproject:941  Change-Id: I7febf80923c4cd0b730399f1f49f9456cf3668e9 Reviewed-on: https://chromium-review.googlesource.com/260572 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Give Timer a virtual destructor as it's deleted polymorphically.  Found by clang:  ..\..\third_party\angle\src\common/angleutils.h(665) :  error: delete called on 'Timer' that is abstract but has non-virtual destructor [-Werror-Wdelete-non-virtual-dtor]     delete resource;     ^ ..\..\third_party\angle\src\tests\perf_tests\ANGLEPerfTest.cpp(265) :  note: in instantiation of function template specialization 'SafeDelete<Timer>' requested here     SafeDelete(mTimer);     ^  BUG=chromium:82385  Change-Id: I69033b1802b5dffbdf2d80889aca7019d710d481 Reviewed-on: https://chromium-review.googlesource.com/264061 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Implement gradient operation AST analysis"  This reverts commit 2fc57a2ace58b7ae3106344c56be94948f761b2a.  Change-Id: I619297090c8441c1b90099437f8764263cdd68cc Reviewed-on: https://chromium-review.googlesource.com/263728 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Implement discontinuous loops AST analysis"  This reverts commit f30a9ba96bdfa014fc182060c714a2c75451f4cf.  Change-Id: I577cfd1e7d5d6138413c29205cbf4d35b6861226 Reviewed-on: https://chromium-review.googlesource.com/263754 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Implemented a CallDAG to allow for more AST analysis"  failures in angle_unittests and compilation failure on clang (see: https://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Mac%20Builder%20%28dbg%29/builds/30016/steps/compile/logs/stdio) . This reverts commit b34d1d12969496b1b0fb53934b8ce3200304f900.  Change-Id: Ia995fb2db0e891294f3461de01617cb13e5ae381 Reviewed-on: https://chromium-review.googlesource.com/263727 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Return a ref for FBO attachment image indexes.  This cleans up the syntax somewhat. Also place some more of the helper methods in the header.  BUG=angleproject:963  Change-Id: I62419095a7b65486f54d74791027594e8e595e48 Reviewed-on: https://chromium-review.googlesource.com/263629 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move the texture index to attachment base.  This will let us squash the attachment types in a follow-up patch.  BUG=angleproject:963  Change-Id: I1efb2e41aa08766189499995b3150aec6fd61c4e Reviewed-on: https://chromium-review.googlesource.com/263486 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement discontinuous loops AST analysis  This will allow narrowing down which usages of [[flatten]] and [[unroll]] are actually useful.  BUG=angleproject:937 BUG=395048  Change-Id: Icc37abf51a1407c9e7bc708dc08d3ba4050a496a Reviewed-on: https://chromium-review.googlesource.com/261189 Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implement gradient operation AST analysis  This will allow narrowing down which usages of [[flatten]] and [[unroll]] are actually useful.  BUG=angleproject:937 BUG=395048  Change-Id: Ic31e434c7b5bb6c32eff2336e5949391bfee25a5 Reviewed-on: https://chromium-review.googlesource.com/260930 Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Implemented a CallDAG to allow for more AST analysis  The CallDAG preprocesses the AST to construct a DAG of functions that can be used for several analysis. Use it to implement check for recursion and max call depth. It will also be used to limit the usage of [[flatten]] and [[unroll]].  BUG=angleproject:937 BUG=395048  Change-Id: I643e0ed605ad095e4fd7da4977d842be5e6a12e0 Reviewed-on: https://chromium-review.googlesource.com/229352 Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Revert "Move resource storage to attachment base.""  Fix in https://chromium-review.googlesource.com/#/c/263730/  This reverts commit 0d91328b99d2a8b2c3bfe45d64faad3e7907637c.  Change-Id: Ibab792001798eff94652345b7c12fb9a42cddb55 Reviewed-on: https://chromium-review.googlesource.com/263740 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Detect RTTI properly on Clang.  This was giving a compile error on OSX. Also update the logic slightly.  BUG=angleproject:963  Change-Id: I1ac64aa0908a58d9780054084d5c205c61848763 Reviewed-on: https://chromium-review.googlesource.com/263730 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Split DrawCallPerf test from BufferSubData test.  This will give us better dashboard encapsulation when we're running on the Chromium bots. It also paves the way for more specialized draw call tests like for indexed draw with uniform updates instancing etc.  BUG=angleproject:744  Change-Id: I396de28c027f99da18a0904f959d23b59cac2010 Reviewed-on: https://chromium-review.googlesource.com/263505 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Stub simplifying array assignment for HLSL output  Add an AST traverser that rejects shaders with expressions that use the return value of an assignment where an array is assigned to another array. In the future this should be made into a tool that can simplify these expressions so that return values of array assignments are not used.  In its current form this code prevents OutputHLSL from producing garbage code when the original code contains expressions like a = (b = c); where a b and c are all arrays.  BUG=angleproject:960  Change-Id: I11353d7ed7160c853e58a0ef3471ca439cb314c8 Reviewed-on: https://chromium-review.googlesource.com/263070 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add basic support for assigning arrays in HLSL output  Implement support for assignments where the return value of the assignment is not used in another part of the expression.  TEST=WebGL conformance tests BUG=angleproject:960  Change-Id: Ibf9d71a75d27d139d2aabb5162ab04a0974321d3 Reviewed-on: https://chromium-review.googlesource.com/263222 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Move resource storage to attachment base."  Giving compile errors on Clang/OSX.  http://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Mac%20Builder%20%28dbg%29/builds/30008  This reverts commit 7f67b030a8ae26e3ff54f6d33c655fc69c0b9fdb.  Change-Id: I5fb7d237c99ca9f2a8d50538f86dfc334d56ddd9 Reviewed-on: https://chromium-review.googlesource.com/263722 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Assign built-in function return type in promote()  This finishes the refactoring of unary math operation handling so that IntermUnary::promote has the complete code for setting the return type of the node.  BUG=angleproject:952 TEST=angle_unittests WebGL conformance tests  Change-Id: I19bd8d53029e24f734c9436eceb446b37e7fcf26 Reviewed-on: https://chromium-review.googlesource.com/262416 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Refactor unary math operator handling to clarify responsibilities  Shuffle the code around so that each part has a clear responsibility: IntermUnary::promote is responsible for setting the return type of the node Intermediate::addUnaryMath is responsible for creating the node object and ParseContext::createUnaryMath is responsible for validating the operand type.  This removes duplicated bool type check for logical not.  BUG=angleproject:952 TEST=angle_unittests WebGL conformance tests  Change-Id: I9f5a0abb6434ad2730441ea9199ec3f5382ebcda Reviewed-on: https://chromium-review.googlesource.com/262415 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Move resource storage to attachment base.  We can use GetAs() to retrieve the corresponding API object.  BUG=angleproject:963  Change-Id: I472e13664e45f9f05621dea3d28135d4e833fb3d Reviewed-on: https://chromium-review.googlesource.com/263485 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove DefaultAttachment.  This class is no longer necessary or used.  BUG=angleproject:963  Change-Id: I5e6fa64822e637e1cc769be6fe777fa6e13a0d83 Reviewed-on: https://chromium-review.googlesource.com/263484 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add unsigned literal support to GLSL output  BUG=angleproject:964  Change-Id: I8eb3cfd8d49beded4ac55ead97b50c7691e4980a Reviewed-on: https://chromium-review.googlesource.com/263710 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor DefaultAttachments.  Instead of using an Impl type for default attachments store the egl::Surface pointer where possible.  BUG=angleproject:963  Change-Id: I3e34849e8b1ccae0c91a79617ec6f64aaaab6b10 Reviewed-on: https://chromium-review.googlesource.com/263483 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement flush and finish in RendererGL.  BUG=angleproject:883  Change-Id: Idc474c58d3971c5f7c2c2760cd21aefdf65424b4 Reviewed-on: https://chromium-review.googlesource.com/263502 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Only call glInvalidateFramebuffer if it is available.  BUG=angleproject:885  Change-Id: I30a9bcebc80805aea0c12d9c67194b7b0c98200f Reviewed-on: https://chromium-review.googlesource.com/263475 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add drafts for device query extensions.  These extensions give power apps the ability to query raw device pointers from the EGL layer. EGL_EXT_device_query is based on EGL_EXT_device_base which is being split into device_query and device_enumerate. We remove the device enumeration logic and only allow the app to query the current device from a display which matches how ANGLE works internally.  EGL_ANGLE_device_d3d gives the app the ability to query D3D devices associated with a display.  BUG=angleproject:935  Change-Id: I8079661f00d11717ed0e792c9fe8dc5c26f67dcc Reviewed-on: https://chromium-review.googlesource.com/252110 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make egl::Surface ref-counted.  This will let us store references to Surface in FBO attachments even after the surface is destroyed.  BUG=angleproject:963  Change-Id: I7e1cb161d1e08f78b1c4d730a32ad09ac7e61e30 Reviewed-on: https://chromium-review.googlesource.com/263482 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Pass gl::Data to Framebuffer::clear.  This allows the implementation object to also check the caps.  BUG=angleproject:930  Change-Id: I5a48ad942eaa5271b60cffd931829296e5d2a767 Reviewed-on: https://chromium-review.googlesource.com/263481 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix the renderer generation script.  We no longer use the DISALLOW_COPY_AND_ASSIGN macro.  BUG=angleproject:956  Change-Id: I439c4d55612059d6a16ae6351c54c3817be017cf Reviewed-on: https://chromium-review.googlesource.com/263480 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add UBO offset support for D3D11.1.  Also fixes the uniform count upper limit in glGetActiveUniformsiv as well as an assert hit with used but unbound uniform buffer.  BUG=angleproject:507 BUG=angleproject:962  Change-Id: I096fe1c9b4f0f398f3a638cd8311278987dfb7dc Reviewed-on: https://chromium-review.googlesource.com/263404 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Gregoire Payen de La Garanderie <Gregory.Payen@imgtec.com>, 23355681, 619, 169, 619
Revert "Add UBO offset support for D3D11.1."  Failed on 32-bit builds.  See: https://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Win%20Builder/builds/24828/steps/compile/logs/stdio  angle\src\libangle\validationes.cpp(1461) : error C2220: warning treated as error - no 'object' file generated angle\src\libangle\validationes.cpp(1461) : warning C4018: '<' : signed/unsigned mismatch  This reverts commit 381f969315c0c70bacf183e58de7194f42486112.  Change-Id: I05f09f19e40046994d34809c5b79095458f56148 Reviewed-on: https://chromium-review.googlesource.com/263474 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add UBO offset support for D3D11.1.  Also fixes the uniform count upper limit in glGetActiveUniformsiv as well as an assert hit with used but unbound uniform buffer.  BUG=angleproject:507 BUG=angleproject:962  Change-Id: I263b14df41d4e45a67304c1d145646398721cf0a Reviewed-on: https://chromium-review.googlesource.com/263412 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Gregoire Payen de La Garanderie <Gregory.Payen@imgtec.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Enable the OpenGL renderer in some basic end2end tests.  Change-Id: I5c224fe779aed90332d14e463abedf8926516156 Reviewed-on: https://chromium-review.googlesource.com/263337 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Name all windows created by the WGL backend.  When running from within the chrome test harness calls to CreateWindow* in debug builds would return null when the title was an empty string.  Change-Id: I0d5dfb1eb824ff2a1470e7d66d850602e73988a0 Reviewed-on: https://chromium-review.googlesource.com/263430 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Rename SurfaceWGL to WindowSurfaceWGL.  BUG=angleproject:890  Change-Id: I72f28583e3903b273578abb6ed487c0a8d696746 Reviewed-on: https://chromium-review.googlesource.com/261359 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Track more information at the egl::Surface level.  Many of the members of SurfaceImpl could be stored in egl::Surface instead.  This makes SurfaceImpl a pure interface and makes Surface constructors much simpler.  BUG=angleproject:795  Change-Id: Ifa797b4bef84afe66f9fb3f3a6be260f726ca55c Reviewed-on: https://chromium-review.googlesource.com/261358 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Add UBO offset support for D3D11.1."  Was ignoring the uniform block bindings.  This reverts commit 7159ea6778eb73c233736cc2fa59ae9177b75e4b.  Change-Id: Ie7d2b40d3fb2adedd309f1162fb6fd33ab0b4c3c Reviewed-on: https://chromium-review.googlesource.com/263420 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix uninitialized member in BufferD3D.  BUG=angleproject:956  Change-Id: I853f3cf3171b85143e490ef9678aae7d38de0b1f Reviewed-on: https://chromium-review.googlesource.com/262778 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Remove uses of std::unique_ptr in perftests.  This is disallowed in Chromium because it isn't currently portable. We can put it back later if the rules change.  BUG=angleproject:956  Change-Id: I5be28590f494719b8cc995739dde26726283fced Reviewed-on: https://chromium-review.googlesource.com/262777 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Remove shared_utils.h use angle_common instead.  *re-land with fix for Chromium compile*  This saves us from needing to replicate the same code in two places.  BUG=angleproject:956  Change-Id: I68dffee715df03bd25685e3ed5c0506ffc41c3b9 Reviewed-on: https://chromium-review.googlesource.com/263258 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Replace non-copyable macro with a helper class.  This class provides a simpler scheme for blocking default copy and assignment operators. It also reduces the amount of code needed since it's inherited to child classes. This also fixes the conflict between our macro and the same-named macro in Chromium code.  BUG=angleproject:956  Change-Id: If0dc72aa3f63fbc7b8fa34907418821c64c39e2f Reviewed-on: https://chromium-review.googlesource.com/263257 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Implement drawRangeElements  Implement drawRangeElements simply by calling drawElements internally. The start and end parameters passed to the function will be checked against results from index validation and an error is generated if indices fall outside the claimed range.  Most dEQP-GLES3.functional.draw.draw_range_elements.* tests pass after this change. The remaining failures seem to be related to instanced attributes.  BUG=angleproject:957 TEST=dEQP-GLES3.functional.draw.*  Change-Id: Id3923eb8114461b441e593357bc49babfd6b5c15 Reviewed-on: https://chromium-review.googlesource.com/262420 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Revert "Enable the OpenGL renderer in some basic end2end tests."  Failures on Win 7/8 Debug NVIDIA bots.  This reverts commit 1cb0a213a06386745e4ab80a76f622e23be20395.  Change-Id: Ifb6b538e1b784a78c562a4d43d907bd0cdd59abf Reviewed-on: https://chromium-review.googlesource.com/263310 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Enable the OpenGL renderer in some basic end2end tests.  Change-Id: Iee9d9837c6021ad0c9d4f5749402c5d183e90f2a Reviewed-on: https://chromium-review.googlesource.com/263269 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Check for the extension before creating compressed textures in SwizzleTest.  Change-Id: Ia561fc7bb0262ab6974517d9796e4828db5b511c Reviewed-on: https://chromium-review.googlesource.com/263251 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Disable UNIMPLEMENTED in ProgramGL::validateSamplers.  Removing this allows many angle end2end tests to run without hitting any UNIMPLEMENTEDs.  BUG=angleproject:882  Change-Id: Idb55fae7b6fc7b23bc85d0bf376499f28669d771 Reviewed-on: https://chromium-review.googlesource.com/263250 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Remove shared_utils.h use angle_common instead."  Causing a build conflig with Chromium's DISALLOW_COPY_AND_ASSIGN.  http://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Win%20Builder/builds/24738  This reverts commit 3ad467df2817df60ae90a84aae68dc37b46b2b34.  Change-Id: I0cf13e3bc3af90303a123813052cced0ba086515 Reviewed-on: https://chromium-review.googlesource.com/263159 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disable vsync for perf tests and don't report the total time.  BUG=angleproject:955  Change-Id: I8223349622531c8fff7c7cd45bdf4754d7619ae2 Reviewed-on: https://chromium-review.googlesource.com/263062 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix array function parameter syntax in HLSL equality function  The fact that passing shaders to the platform compiler is deferred until linking is performed allowed this bug to pass undetected in earlier manual testing.  TEST=WebGL conformance tests BUG=angleproject:941  Change-Id: Ic12b5d0c5547057551df90086453e897a161d559 Reviewed-on: https://chromium-review.googlesource.com/263221 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Always sync the texture sampler state.  The sampler state may have changed even if the texture is already bound.  BUG=angleproject:884  Change-Id: I591f493099397bb07608096cf30ff46ed5090224 Reviewed-on: https://chromium-review.googlesource.com/263147 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove shared_utils.h use angle_common instead.  This saves us from needing to replicate the same code in two places.  BUG=angleproject:956  Change-Id: Ibc80997eec184d0d5aa9c6c076c9d4507fbf8caa Reviewed-on: https://chromium-review.googlesource.com/262776 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Split ANGLEPerfTest into a Render and basic test.  The basic test we can use for perf testing internal classes with mocks. The render tests are more specific to doing draw calls.  BUG=angleproject:956  Change-Id: Iade393facc30c8d7288b1b94a159ce3afe993021 Reviewed-on: https://chromium-review.googlesource.com/262775 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add an BufferFactoryD3D class to help mocking.  This D3D-only class has one method used to generate the D3D IndexBuffer/VertexBuffer. This can help us mock up IndexDataManager.  At a later point we can refactor the VertexFormat queries from Renderer into a Caps struct that mirrors our Texure Caps.  BUG=angleproject:956  Change-Id: Id8b1220a763873ee871ce92365bbee03633789c7 Reviewed-on: https://chromium-review.googlesource.com/262774 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add stubs for EGL pixmap surface creation.  BUG=angleproject:795  Change-Id: I76b44e837eb6919f9d3c1eb56c2d3af84bc5ab09 Reviewed-on: https://chromium-review.googlesource.com/260943 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove unused streamOffset from IndexRangeCache  This value is now redundant - it is always the same as regular offset.  TEST=angle_end2end_tests BUG=angleproject:956  Change-Id: If4b6c8bcbebf24fbf84723fe081fd058916cc504 Reviewed-on: https://chromium-review.googlesource.com/262423 Reviewed-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Recompute stream offset instead of fetching a cached value  Recomputing the stream offset is relatively cheap now after recent changes. Remove caching it to make the code less complex.  TEST=angle_end2end_tests BUG=angleproject:956  Change-Id: Icb9cc4e4ffd685a78b7f8a45958992a471ebb0f5 Reviewed-on: https://chromium-review.googlesource.com/262422 Reviewed-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Remove unused tests folder.  This is now located in src/ and Chromium no longer refers to it.  BUG=None  Change-Id: I64fd302629ca28aa367d8714bfbac2657774fc3b Reviewed-on: https://chromium-review.googlesource.com/262920 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix maxVertexUniformComponents initialization in GenerateCaps()  Change-Id: Ie10398e148dc0b88e5d7a5330307dc49553c6665 Reviewed-on: https://chromium-review.googlesource.com/263092 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't use a helper function to get the vertex attributes.  The overhead of the function call ended up being a hot spot for draw calls since the attributes are iterated over many times in VertexDataManager.  BUG=angleproject:959  Change-Id: I9bbfcbd115661ad629db9ed93d683cd8d0dc9a78 Reviewed-on: https://chromium-review.googlesource.com/263102 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Don't use a helper function to get the vertex attributes."  Caused a warning on 32-bit builds.  This reverts commit 20d78d241b448aa0b2e3f49d902d3ab63a551932.  Change-Id: I4d61024fb29978e7f1bacdd693fc6f1bc00bd0cc Reviewed-on: https://chromium-review.googlesource.com/262918 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add UBO offset support for D3D11.1.  Also fixes the uniform count upper limit in glGetActiveUniformsiv.  BUG=angleproject:507  Change-Id: Icfc90ed64cf94b1bab2d4cc93a8fb5e11b28d666 Reviewed-on: https://chromium-review.googlesource.com/261874 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move validation from Intermediate::addUnaryMath to ParseContext  Intermediate should only have logic for creating node objects validation of parameter types belongs in ParseContext.  BUG=angleproject:952 TEST=angle_unittests WebGL conformance tests  Change-Id: Ie90697641fabb2a837ccc4571a93616d63ea64e6 Reviewed-on: https://chromium-review.googlesource.com/262414 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Cache std::vectors in ProgramD3D to avoid allocations during draw calls.  BUG=angleproject:959  Change-Id: Ie08e68ae27372a97bd118e61478201b0d3dad955 Reviewed-on: https://chromium-review.googlesource.com/262337 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't use a helper function to get the vertex attributes.  The overhead of the function call ended up being a hot spot for draw calls since the attributes are iterated over many times in VertexDataManager.  BUG=angleproject:959  Change-Id: I6c11d4a5a22c314c69b3403dfdeb2d950b1c7639 Reviewed-on: https://chromium-review.googlesource.com/262336 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Inline commonly used Error methods and add move operators.  The function call overhead of the constructors and assignement operators ended up being a hotspot even though the functions didn't do any significant work.  BUG=angleproject:959  Change-Id: I96769879dabdbba7a222f98d87c5be0a829cb7dd Reviewed-on: https://chromium-review.googlesource.com/262335 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Micro-optimize math in IndexDataManager  Use bitwise operations instead of division which is expensive on multiple CPU architectures.  BUG=angleproject:956 TEST=angle_end2end_tests  Change-Id: I57ab540d447c03dae5a96bafb4975fc37e310261 Reviewed-on: https://chromium-review.googlesource.com/262181 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix float-int conversion return type precision tracking  Float-int conversion functions are defined to always return highp values.  BUG=angleproject:865 TEST=angle_unittests  Change-Id: Idf243b483f7b5edfcb54de2755af11e17c3756d3 Reviewed-on: https://chromium-review.googlesource.com/262413 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Implement RenderbufferGL.  BUG=angleproject:886  Change-Id: I7480943d678b2cdf6e997c3f8316acdef32f5f0d Reviewed-on: https://chromium-review.googlesource.com/260889 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Split Renderbuffer::setStorage into two functions to match the API.  BUG=angleproject:886  Change-Id: I74375351339464b450c2f058adbeed7a1ba18cdd Reviewed-on: https://chromium-review.googlesource.com/262125 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement FramebufferGL.  BUG=angleproject:885  Change-Id: Ifb5818f185236c671cd7f20ed352edb887b49675 Reviewed-on: https://chromium-review.googlesource.com/258420 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix mipmapped GL_ALPHA UBYTE textures on 9_3  Change-Id: I59020f8152d47091533d69d20fe5ff56e5f96bc1 Reviewed-on: https://chromium-review.googlesource.com/262551 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Use switch/case in GetTypeInfo instead of a map lookup  This should be faster and also matches the C++ style rules better: static variables should not have complex class types.  BUG=angleproject:956 TEST=angle_end2end_tests WebGL conformance tests  Change-Id: I628db95febab309e241be216e2998305525da76e Reviewed-on: https://chromium-review.googlesource.com/262421 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Implement EXT_discard_framebuffer in D3D11 renderer"  Causes failures in video related WebGL tests.  Either there is a bug in the implementation or how chrome is using it.  This reverts commit b13daa8f79f4d16a990d968d7d2c04da6b72d302.  Change-Id: Ic0d74840c664bf4de18d85cc3ff7f7153936d9b0 Reviewed-on: https://chromium-review.googlesource.com/262715 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Compile the D3D11 VS and PS on separate threads at GL link time"  Causing a high-volume crashe in Chrome.  This reverts commit 434953e20002666f66d721aaacbcb8410f7dbd56.  BUG=470695  Change-Id: I2062c706ab6ca6b4c3117685df67c33572518da5 Reviewed-on: https://chromium-review.googlesource.com/262704 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fixed compilation with mingw.  Change-Id: I027cedc383efbd215e55a7ddf4e41eb1c368a1ae Reviewed-on: https://chromium-review.googlesource.com/262590 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jacek Caban <cjacek@gmail.com>, 23355681, 619, 169, 619
Implement EXT_discard_framebuffer in D3D11 renderer  Change-Id: I0e39a196796813203c841c46aa2a6b89957f6051 Reviewed-on: https://chromium-review.googlesource.com/261355 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix formatting in compiler tests  Remove extraneous semicolons and fix indentation in a couple of places.  TEST=angle_unittests  Change-Id: Iaa51eb50990c0435f41dfd346ec161216cd8d372 Reviewed-on: https://chromium-review.googlesource.com/261823 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disallow operations on structs containing samplers  ESSL 1.00 spec section 5.9 says that equality operators don't operate on structs containing sampler types. Section 5.7 also suggests this. ESSL 3.00 doesn't have a similar restriction.  ESSL 1.00 spec section 4.1.7 says that structs containing samplers can't be used as l-values. This is interpreted to apply also in the case of ESSL 3.00 which similarly disallows samplers as l-values but doesn't explicitly mention structs.  BUG=angleproject:954 TEST=angle_unittests WebGL conformance tests  Change-Id: I73f74962a192e8d9449990ffa5f3d8c851491601 Reviewed-on: https://chromium-review.googlesource.com/261822 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Support equality between structs containing arrays in HLSL output  This requires sorting all equality functions together so that struct equality functions can have dependencies on array equality functions but support for array equality functions that have dependencies on struct equality functions is also maintained.  There's no automated test coverage for this specifically. The change was tested by manually inspecting shader output and ensuring that there were no test regressions in tests listed below.  TEST=dEQP-GLES3.functional.shaders.* BUG=angleproject:954  Change-Id: If7199ab2446804afae50f103bb625101172882b9 Reviewed-on: https://chromium-review.googlesource.com/261550 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Support array equality operator in HLSL output  This requires adding functions to the shader source that can do the comparison for a specific array size.  There's no automated test coverage specifically for this functionality since all deqp tests that cover this also require array constructors to be supported. The change has been tested by manually inspecting shader output. No regressions were seen in automated tests listed below.  TEST=dEQP-GLES3.functional.shaders.* angle_unittests BUG=angleproject:941  Change-Id: Ie2ca7c016a3f0bcb3392a96d6d20d6f803d28bf0 Reviewed-on: https://chromium-review.googlesource.com/261530 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix redundant index validation on the D3D9 backend  Make sure that the computed index range is added to the cache of the main buffer object instead of just to the static buffer object created for the buffer object. This applies to the code path used for D3D9. This way the front-end code in ValidateDrawElements gets the index range from the cache instead of having to iterate over all the indices used on every draw call.  BUG=chromium:461274 TEST=WebGL conformance tests angle_end2end_tests  Change-Id: I07cf493d2771dab8e76d69bafda7ac49e5a04808 Reviewed-on: https://chromium-review.googlesource.com/262180 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add a perf test for draw call overhead.  These perf tests use the D3D NULL renderers to measure pure CPU time with no GPU limitations. Also fix our D3D9 SwapChain code to skip creating a SwapChain for NULLREF D3D9 devices and the vertex decl code to reinitialize the formats when finding a mismatch with the previous value.  BUG=angleproject:955  Change-Id: I449e63177b48afd1559c36244de0bc252814e813 Reviewed-on: https://chromium-review.googlesource.com/262208 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move buffer::markTransformFeedbackUsage to BufferD3D only.  BUG=angleproject:681  Change-Id: Ia9f4ac9cee2c3e4fa140eba12bdb9ab0cc423f6c Reviewed-on: https://chromium-review.googlesource.com/261709 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Emulate TextureStorage when it is not available.  BUG=angleproject:884  Change-Id: Ie6e809477253502d88f599172eaed17638e58dd3 Reviewed-on: https://chromium-review.googlesource.com/262112 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use the Surface type for validation and fix incorrect window validation.  The window passed to surface creation should not be used by any surface owned by any display not just the current one.  Store a global window surface list for validation.  BUG=angleproject:795  Change-Id: I2314979f2f27848b21fcb00676194d7671d1db68 Reviewed-on: https://chromium-review.googlesource.com/260942 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Pass the Surface type config and attributes to the constructor.  BUG=angleproject:795  Change-Id: I15e7f2f51ecc243edf83d9a9544eba137d8bb599 Reviewed-on: https://chromium-review.googlesource.com/260941 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add dEQP tests.  We integrate dEQP as a console application and a shared library which runs all of the test logic. Using a shared library lets us compile dEQP with all the specific compiler options it needs without conflicting with the compile settings in ANGLE proper.  Currently we only support Windows D3D11 ES 2 and 3. We can add other targets in the future.  We also have a few bugs preventing us from running the test suite in full. We run into infinite loop problems in some shader tests and have crashes or UNIMPLEMENTED in others.  BUG=angleproject:901  Change-Id: Ib6fe66041a6fe547eb2cba497c52de7fd080d667 Reviewed-on: https://chromium-review.googlesource.com/238084 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix copyTexImage2D failures on D3D11 9_3  Change-Id: I16453248c2cb0aaf53a748eb8d6e32c63fa73394 Reviewed-on: https://chromium-review.googlesource.com/261983 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make angle perftests build with clang.  ::testing::WithParamInterface ends up calling deleting an object with the type of the template parameter and the pointer it deletes could arguably point to a subclass of the param object -- so clang warns that there's a delete on a class with a virtual method but without a virtual dtor.  Make the param classes final to let the compiler know that this can't happen in practice.  BUG=chromium:82385  Change-Id: I49a4120b15670d876613b22ba709d50bf4685006 Reviewed-on: https://chromium-review.googlesource.com/261965 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Nico Weber <thakis@chromium.org>, 23355681, 619, 169, 619
Handle client data for draw calls with RendererGL.  BUG=angleproject:880  Change-Id: I67839d4934767db77cff7b501002c5aafbcbaef2 Reviewed-on: https://chromium-review.googlesource.com/257672 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a comment explaining the buffer binding points.  BUG=angleproject:881  Change-Id: If81675ef4931c920edac56249461db7c91cc170c Reviewed-on: https://chromium-review.googlesource.com/261708 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Disallow operations on structures containing arrays in ESSL1  Comparing structures that contain arrays to each other and assigning structures that contain arrays is "not defined" in ESSL 1.00 (section 5.7). Sections 5.8 and 5.9 further suggest that these operations are not allowed. Additionally some platform drivers on Linux seem to reject shaders produced by ANGLE which compare structures containing arrays. This might require changing the output GLSL version for ESSL 3.00.  BUG=angleproject:954 TEST=angle_unittests  Change-Id: I5f3a016f360f940f2fc1ec1ff8e60d13a977eb69 Reviewed-on: https://chromium-review.googlesource.com/261531 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix ResourceManager create-on-bind reallocations.  *re-land with build fix for Clang*  We had a funny bug where the Handle Allocator would re-allocate reserved handles after the app layer creates one with Bind rather than using Gen. This affects Textures Buffers and Renderbuffers.  Fix this by using a different allocation scheme. It should still be fast on the "good" case (using Gen) and use tree lookups on the bind case. Also add some unit tests.  BUG=angleproject:942  Change-Id: I63ce608fcd6a11f92e2b5421f090551934e729ed Reviewed-on: https://chromium-review.googlesource.com/261591 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Fix ResourceManager create-on-bind reallocations."  Build break on GPU FYI Bots on Linux/Mac:  http://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Mac%20Builder/builds/28092  This reverts commit 61ce1a414e74f6a72a520d6adf59bff13aff03a0.  Change-Id: If2e7fb35c769708a783a32932b777dc97eaba8a4 Reviewed-on: https://chromium-review.googlesource.com/261590 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move some validation from IntermBinary::promote to ParseContext  This makes the role of promote() in the system clearer and helps to make the code more understandable since more of the checks are in the same logical place.  BUG=angleproject:952 TEST=angle_unittests WebGL conformance tests  Change-Id: Idb2de927d872e46210d71cf6de06a6f8c1fc5da1 Reviewed-on: https://chromium-review.googlesource.com/260803 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use the GL_COPY_READ_BUFFER binding for copy sources.  Using the ELEMENT_ARRAY binding can cause issues such as rebinding the current VAO's index buffer unexpectedly.  BUG=angleproject:881  Change-Id: Ieeed52ac81c23a46bfe9fc4365239c2b177ff6ac Reviewed-on: https://chromium-review.googlesource.com/261563 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix ResourceManager create-on-bind reallocations.  We had a funny bug where the Handle Allocator would re-allocate reserved handles after the app layer creates one with Bind rather than using Gen. This affects Textures Buffers and Renderbuffers.  Fix this by using a different allocation scheme. It should still be fast on the "good" case (using Gen) and use tree lookups on the bind case. Also add some unit tests.  BUG=angleproject:942  Change-Id: I2e3f4c31b28cb86bd3699035f5d55568a2a1d7d5 Reviewed-on: https://chromium-review.googlesource.com/258904 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Uninitialize the debug annotations when unloading a renderer  Change-Id: I125de997853c9deda365e4827322c29d1f20edf2 Reviewed-on: https://chromium-review.googlesource.com/261253 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use google test to wrap our perf tests.  This provides easy implementation with the Chromium perf bots.  BUG=angleproject:744  Change-Id: I71c04e3d67cae9344ddca9fd95fd3c9849494922 Reviewed-on: https://chromium-review.googlesource.com/260644 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Only sync the VAO state just before the draw call.  BUG=angleproject:880  Change-Id: Ifd59c0f67aeab0e4700b3dca57c1b75e3fae48b8 Reviewed-on: https://chromium-review.googlesource.com/257671 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix incorrect assertion.  BUG=angleproject:884  Change-Id: I3406eec99609b85c407797c50b71611b445a6ca5 Reviewed-on: https://chromium-review.googlesource.com/261462 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update Canary WebGL CTS expectations.  Change-Id: Ia8375595b34e00a48143a568a4a9ab7157a12cd2 Reviewed-on: https://chromium-review.googlesource.com/261171 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make Optional a proper helper class.  Move this to a common area out of perf tests.  Change-Id: I53d36accfe0c53789c007edfb20ba7e964947def Reviewed-on: https://chromium-review.googlesource.com/260643 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Remove hardcoded additional include/lib paths from WinRT projects  Change-Id: Ic78a7dc3a1b3027f4fffc352fa2fb097b6024970 Reviewed-on: https://chromium-review.googlesource.com/261185 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Reduce unnecessary built-in varying usage in D3D renderer  Change-Id: I0c404e77aa3f56ddc5b97a206b06c7907edfb1eb Reviewed-on: https://chromium-review.googlesource.com/259812 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix C4702 issues (unreachable code) in ANGLE excluding <xtree>  Change-Id: Ia7603139af266fd7b14efc8c3465225738456e67 Reviewed-on: https://chromium-review.googlesource.com/261038 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix framebuffer zero used after being destroyed in Context destructor.  BUG=angleproject:950  Change-Id: I06e9e6ccf92ee8ca0b1de98cc48ef68a85107214 Reviewed-on: https://chromium-review.googlesource.com/260573 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Gregoire Payen de La Garanderie <Gregory.Payen@imgtec.com>, 23355681, 619, 169, 619
Accept equality and assignment for arrays in parsing  This is enough to support the operations in GLSL output. HLSL output will likely require additional work to support this.  BUG=angleproject:941  Change-Id: I728d511ab07af94bc3382dc2796c1e9ac79d1442 Reviewed-on: https://chromium-review.googlesource.com/260801 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add #version 300 es to ESSL output when needed  BUG=angleproject:953  Change-Id: Ib9e45fab1d35f8c78abd0ac2209ac4f63afe4465 Reviewed-on: https://chromium-review.googlesource.com/261170 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Move binary op array check to ParseContext  Also piece together an addAssign function in ParseContext that uses the binary op array check. This will make it easier to change the array-related checks in the future to use shaderVersion. Moving validation out from IntermBinary::promote also makes the architecture clearer promote()'s role should be mainly to determine the type of the return value of the binary operation not to do validation.  BUG=angleproject:941 TEST=angle_unittests WebGL conformance tests  Change-Id: If1de33ea250893527be7f0d7930d4678a0864684 Reviewed-on: https://chromium-review.googlesource.com/260571 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Correctly insert unmangled function names to symbol table  This fixes detecting some cases of function parameter mismatch (previously a mangled function name corresponding to no function parameters was added to the symbol table for each user-defined function and this was returned when doing function lookups with no parameters).  Also fixes detection of reusing a function name as a variable/struct name.  New unit tests are added to ensure that these fixes don't regress.  BUG=angleproject:936 TEST=angle_unittests WebGL conformance tests  Change-Id: I2dadde9dcc01c7a4a653c1982c36377b89e6d437 Reviewed-on: https://chromium-review.googlesource.com/260800 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix uninitialized ConfigSorter read.  We were not initializaing the mWant* members to false.  BUG=468638  Change-Id: I90ef131c930c6f9c31e9bc9cec951c1f91816eb0 Reviewed-on: https://chromium-review.googlesource.com/261047 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Replace stray reference to cpu_arch in BUILD.gn.  cpu_arch has been replaced by target_cpu and current_cpu in GN.  R=geofflang@chromium.org BUG=344767  Change-Id: Id1c0e37238db5fac41572244aeac0908ac5a412a Reviewed-on: https://chromium-review.googlesource.com/260971 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Always use static_assert for compile-time assertions and remove META_ASSERT.  BUG=468139  Change-Id: I696ef307f2faa54bb72df66784bc79a055499987 Reviewed-on: https://chromium-review.googlesource.com/260776 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move most of addBinaryMath from Intermediate to ParseContext  Some type checks for binary math will be different based on the shading language version which is easily accessible in ParseContext. Because of this and also for architectural simplicity it makes more sense to have the checks in ParseContext.  BUG=angle:941 TEST=angle_unittests WebGL conformance tests  Change-Id: I92a499f47e1cbc6a7b6391ce0fa04284803e7140 Reviewed-on: https://chromium-review.googlesource.com/260570 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor D3D Debug Annotations code.  This encapsultates the different implementations and allows us to compile debug.cpp in the common libraries without link errors.  BUG=angleproject:513  Change-Id: I16dc4c666fb4266ee5146d64d77eb9925c7584a8 Reviewed-on: https://chromium-review.googlesource.com/256450 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix and enable warning C4245 (signed/unsigned mismatch)  Change-Id: If48043835fcc98341a0626e3ece7d0e3f7958059 Reviewed-on: https://chromium-review.googlesource.com/260630 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Cooper Partin <coopp@microsoft.com> Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix Winrt Project generation  Change-Id: I5688f17d8fc18f36363afbfd2728b0b3475fb2bd Reviewed-on: https://chromium-review.googlesource.com/260606 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix unreferenced function warning.  Change-Id: I66b1821e5effcb761a5a0268f7f375289aa3a621 Reviewed-on: https://chromium-review.googlesource.com/260632 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make Platform methods global.  This will allow them to be imported dynamically without name mangling. This is necessary because sometimes SwiftShader overrides libGLESv2 and libEGL so we need to determine at run-time if we are running with "actual" ANGLE.  BUG=466735  Change-Id: I396d717b79066feb8ed0d577ee7386b33eb1d160 Reviewed-on: https://chromium-review.googlesource.com/259954 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove the non-templated RefCountObjectBindingPointer class.  This allows the regular BindingPointer class to template on const types.  Also added assignment and copy operators that don't leak the resources.  BUG=angleproject:880  Change-Id: If3efa26a7fa89306d783c3e8a5fb92b16861d77a Reviewed-on: https://chromium-review.googlesource.com/257670 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix code duplication in OutputHLSL  While debugging I came across the piece of code in OutputHLSL::OutputHLSL which is unnecessarily duplicated this change just fixes it.  Change-Id: I0549d58696417ccf651bacfa19f489b290d4ba6e Reviewed-on: https://chromium-review.googlesource.com/259960 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Update ANGLE_platform_angle_d3d to be able to disable automatic trim.  BUG=angleproject:946  Change-Id: I5652495842b057998318b1583f8e1a586eba39aa Reviewed-on: https://chromium-review.googlesource.com/258940 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
TextureGL implementation.  BUG=angleproject:884  Change-Id: I877c0a9f753dacff96bbb82486bee71d1996ecb7 Reviewed-on: https://chromium-review.googlesource.com/252982 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move the ANGLE tests project to src/  *re-re-land with fix for Chrome's angle tests*  BUG=angleproject:945  Change-Id: I3c64e2edc776c299791440f65f22450855eb6dfa Reviewed-on: https://chromium-review.googlesource.com/260448 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Move the ANGLE tests project to src/"  Still causing build issues on Chrome.  This reverts commit 64a3b2a92fe3bbd28972638e6759fae0b98d81b9.  Change-Id: I8d40fe3dfd0a877343357153a02b8ef66d571c64 Reviewed-on: https://chromium-review.googlesource.com/260425 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move the ANGLE tests project to src/  *re-land with fix for Chromium build*  BUG=angleproject:945  Change-Id: I82bff1760e681987fb26e479734aa62fb845898a Reviewed-on: https://chromium-review.googlesource.com/260362 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Move the ANGLE tests project to src/"  Causing build break in Chromium.  This reverts commit 71c2d85c4af2f6cb213d4f3e15f0ae16b63790f3.  Change-Id: Iedf001c1f4c60a759f69009610fbce978d193d17 Reviewed-on: https://chromium-review.googlesource.com/260370 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move the ANGLE tests project to src/  BUG=angleproject:945  Change-Id: I2eb44ac43f65b916ddd838d39e6aae62580d7fa0 Reviewed-on: https://chromium-review.googlesource.com/258903 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Use rx::ImplFactory in Framebuffer init.  BUG=angleproject:942  Change-Id: Idf14a4e42148b379b64b129ab649a9222cf1fb52 Reviewed-on: https://chromium-review.googlesource.com/258902 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use rx::ImplFactory in ResourceManager.  This will make mocking easier for unit testing ResourceManager.  BUG=angleproject:942  Change-Id: I24b9d0be550991845225141d6e7d5630383a8718 Reviewed-on: https://chromium-review.googlesource.com/258901 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement pass-through pack state params.  Same as for unpack this allows us to pass through the state reset code of dEQP without UNIMPLEMENTED errors while still throwing asserts if they are set to non-default values.  BUG=angleproject:901angleproject:512  Change-Id: I0ce0258b0e91eb83c066c241693aaa5c164b2989 Reviewed-on: https://chromium-review.googlesource.com/257131 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add pass-through for new unpack store params.  Move the UNIMPLEMENTED checks to where they are used with non-default values. This allows dEQP to pass the prerequisite tests like state reset without throwing assertion failures in debug.  BUG=angleproject:901angleproject:512  Change-Id: I3bd35f6dea61e7d80d1379ba4e8e13437e68431a Reviewed-on: https://chromium-review.googlesource.com/257130 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "A special state to track field selection is not necessary."  This reverts commit f8dc4fb66d2ee473b6ba37626f02756422863f6c.  The special state to track field selection is actually necessary to avoid reduce/reduce conflicts when array constructors are added to the grammar.  BUG=angleproject:941 TEST=WebGL conformance tests angle_unittests  Change-Id: I55476483c9e83241e8978cd58f05ef303c7c8680 Reviewed-on: https://chromium-review.googlesource.com/260260 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add an ImplFactory base class.  This class helps make mocking easier for unit tests.  Also update the back-end generator script.  BUG=angleproject:942  Change-Id: Ib0cee2b40c3a0faaac32b22c986b824b7b2dddde Reviewed-on: https://chromium-review.googlesource.com/258900 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make ClearParameters an rx-only type.  This legacy struct duplicates some methods in the gl::State. We can restrict its use to D3D and on newer back-ends use the State directly.  BUG=angleproject:930  Change-Id: I2c298e76b072ee73f2b3e17f6696693031ce1f91 Reviewed-on: https://chromium-review.googlesource.com/258070 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix EGLQueryContextTest.  BUG=466704  Change-Id: I6d87d6cd155fea347cac50b6cb5d1f9641f23e4a Reviewed-on: https://chromium-review.googlesource.com/259761 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Remove no-op functionality from IdentifyBuiltIns and refactor  Adding array built-ins like gl_FragData and gl_LastFragData to the symbol table with a name that included their size in brackets was incorrect and unnecessary. Remove this. The array built-ins should only be added with their proper name and with an array type.  Also refactor the code to reduce unnecessary repetition of conditions. The previous version attempted to split the built-ins that had dependencies on resources into their own part of the code but this split was not clearly defined and only made the code harder to follow and prone to issues.  TEST=WebGL conformance tests  Change-Id: I7a77865a594864a22f3b566f9d3da1d0ead46466 Reviewed-on: https://chromium-review.googlesource.com/258751 Reviewed-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix formatting of IdentifyBuiltIns  Fix indentation of case labels fix too long lines put braces on their own lines and remove extraneous spacing and comments that didn't contribute to the readability of the code.  TEST=WebGL conformance tests  Change-Id: Ie33d0a7c4412c448081f5d879fa9f64baaf8d537 Reviewed-on: https://chromium-review.googlesource.com/258750 Reviewed-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Compile the D3D11 VS and PS on separate threads at GL link time  Change-Id: Ib534483f2ec3922cfeaf71cf1d9e9c433fe04b08 Reviewed-on: https://chromium-review.googlesource.com/251612 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix WinRT build break due to D3D9 histogram assumption  Change-Id: Id8e8bed76a813e5cf082659671bb6f4a112ecf24 Reviewed-on: https://chromium-review.googlesource.com/254340 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Conditionally enable IEEE strictness for isnan()  ANGLE's ESSL3 built-in function isnan() implementation just uses HLSL intrinsic function isnan(). For HLSL intrinsic function isnan() to work properly IEEE strictness needs to be enabled for D3D compiler.  This change detects use of isnan() in shaders and passes compiler flag D3DCOMPILE_IEEE_STRICTNESS whenever isnan is used in shaders. This change also moves existing workarounds in D3DWorkaroundType to D3DCompilerWorkarounds.  BUG=angle:927 TEST= dEQP tests dEQP-GLES3.functional.shaders.builtin_functions.common.isnan.*  Change-Id: I1ce5b1a7a825fdd720a37dc9aeb71320e55162d9 Reviewed-on: https://chromium-review.googlesource.com/255834 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a D3D11 Debug member var.  This is useful for dumping live objects on exit to debug resource leaks.  Change-Id: Ie88787defa37853d0a33c951b107ceac289e58df Reviewed-on: https://chromium-review.googlesource.com/256461 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move implementation unit tests to angle_unittests.  Now that libANGLE is cross-platform this should work on OSX/Linux and Android. Includes a warning fixes for test comparisons and fix to our META_ASSERT wrapper macro for clang.  BUG=angleproject:773  Change-Id: I6b88a85c62a2e07734ae81fb8276c28c5f8f9f47 Reviewed-on: https://chromium-review.googlesource.com/258300 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix typo "setDepthttachment".  BUG=angleproject:930  Change-Id: I7680bbc912c0d961143c38ad82d19746dc9b113d Reviewed-on: https://chromium-review.googlesource.com/256732 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make getColorAttachmentsForRender D3D-only.  This encapsulates the workaround in the D3D renderer and also optimizes the workaround to only compute a new set of attachments when there is a change to the state.  BUG=angleproject:930  Change-Id: Ibdc15078236e2d19b544fae8e65b7f2554f31844 Reviewed-on: https://chromium-review.googlesource.com/254102 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Cleanups to FramebufferD3D.  With the new shared state structure we can eliminate a lot of the state tracking within the FramebufferD3D implementation.  BUG=angleproject:930  Change-Id: I0953e321bae3afe7cde7b73c55af62546665c890 Reviewed-on: https://chromium-review.googlesource.com/254101 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Share FBO state with object and Impl.  This patch introduces a new Framebuffer::Data class which stores attachment related state. This will eliminate the need to store duplicated state between the classes.  BUG=angleproject:930  Change-Id: I80de4db39ab99d623b0ad8306bf3cbb794cd8bd5 Reviewed-on: https://chromium-review.googlesource.com/254100 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Prefer using caps to system attachment limits.  The caps structure can often give a lower and faster bound as well as being more general. We should gradually move away from the implementation limits.  BUG=angleproject:930  Change-Id: I979472cdb6f59c6f0cc0c80f1c29c51295872bea Reviewed-on: https://chromium-review.googlesource.com/256731 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Initialize fragmentPrecisionHigh in constructor.  This was the only field not initialized by the constructor which looks like an oversight.  Change-Id: If61424d574c663113a4c6d31e94b6ec13b412884 Reviewed-on: https://chromium-review.googlesource.com/257360 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix leaked resources in EGLThreadTest.  We were not calling eglTerminate to clean up.  Change-Id: I022d8158c6dc041664d4b9c01295a67c9760b245 Reviewed-on: https://chromium-review.googlesource.com/256730 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix matrix compound multiplication  Matrix compound multiplication was lacking transposes. Add them so that results match normal multiplication.  BUG=angleproject:938 TEST=dEQP-GLES3.functional.shaders.matrix.mul_assign.*  Change-Id: I4c5159de0727afb4ee2831586f04fa817619de7a Reviewed-on: https://chromium-review.googlesource.com/256366 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Remove unnecessary ifdef APPLE from built-in emulation  The emulation is already toggled by a compilation flag so having it behind an ifdef only adds unnecessary complexity particularly when testing changes to the emulation code.  BUG=angleproject:865  Change-Id: Idf7854c2b5323609880b527ed806440dcc8ac091 Reviewed-on: https://chromium-review.googlesource.com/256365 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Add angle.isolate.  This will allow us to properly layer the isolate dependencies within Chromium. Now that ui/gl will depend on libGLESv2 on Windows and other platforms to come most everything will need to have the ANGLE libraries bundled.  BUG=436191  Change-Id: Ifa6c87d3b7840bfbbd4830b218b6d3524258fe12 Reviewed-on: https://chromium-review.googlesource.com/254063 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Initialize BuiltInFunctionEmulator outside Compiler  This moves GLSL output specific code from the Compiler class to the GLSL/ESSL translators.  BUG=angleproject:865  Change-Id: I2d552e9cdb41f7d8ddfee7b0249a99d629a6d7d7 Reviewed-on: https://chromium-review.googlesource.com/255471 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix FloatCopySubImage tests for RGB  A test was checking that if we have less than 4 channels and no GL_EXT_texture_rg we would expect an invalid operation.  Now that we don't expose GL_EXT_texture_rg on DX9 this is firing and I believe incorrectly.  I've changed the condition to test for less than 3 channals since RGB -> RGB should work fine without texture_rg support.  Change-Id: I9955b143c37df9762e0ef45c987581fab2bbcef0 Reviewed-on: https://chromium-review.googlesource.com/255933 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix regression in addFunctionCallOrMethod  Fix a crash when parsing a shader with incorrect constructor arguments.  BUG=angleproject:911 TEST=WebGL conformance tests  Change-Id: I3459612f36185db861a361fa916cc6b671795037 Reviewed-on: https://chromium-review.googlesource.com/255870 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Move some output out of BuiltInFunctionEmulator subclasses  This paves the way for getting rid of the BuiltInFunctionEmulator subclasses in favor of initializing the BuiltInFunctionEmulator dynamically in Compiler subclasses. The eventual goal is getting rid of GLSL output specific functionality in Compiler which should be language-agnostic.  BUG=angle:865  Change-Id: Ibb114b905785c7343b2726c97699268c982536a0 Reviewed-on: https://chromium-review.googlesource.com/255470 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Refactor addFunctionCallOrMethod out of glslang.y  TEST=angle_unittests BUG=angle:911  Change-Id: I6d4c0f0bfbf9e6252e241ae5bb1b6acdb463fce6 Reviewed-on: https://chromium-review.googlesource.com/255451 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement trunc round roundEven (Emulated roundEven)  BUG=angle:934  Change-Id: If33256bf3707f3f0202147276c71f08c65518205 Reviewed-on: https://chromium-review.googlesource.com/254842 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add authors from Nvidia.  Change-Id: I591bcff55796bc4c731143a4ad43669fe9bd6919 Reviewed-on: https://chromium-review.googlesource.com/255690 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Remove switch fall-through on HLSL  Remove fall-through from non-empty labels in switch statements.  Tested with dEQP-GLES3.functional.shaders.*switch*. All pass except for tests that require dFdx/dFdy which fail for an unrelated reason.  Additional test coverage could still be useful for cases where a label is terminated by a continue or return statement.  BUG=angle:921  Change-Id: I4741867789a9308d66d0adeabdaf83907106e2d2 Reviewed-on: https://chromium-review.googlesource.com/254550 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix derivatives being related to an extension on ESSL3  dFdx dFdy and fwidth are parts of the core language in ESSL3.  This fixes a regression from the patch "Set symbol extension at insertion".  BUG=angle:926  Change-Id: I6c0bbce3afad1f064ff115a16e23ea79bd584e49 Reviewed-on: https://chromium-review.googlesource.com/255450 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Move RendererGL caps generation to renderergl_utils.  Change-Id: Ia385fc9739174472d698367e2c6093ba1963b1fe Reviewed-on: https://chromium-review.googlesource.com/253634 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Disable textureRG for DX9  DX9 emulates GL_R8_EXT using BGR8.  When we made the switch to using GL_R8_EXT for YUV decoding we decreased performance on DX9 machines. DX9 supports luminance which we fall back to when R8 isn't available.  BUG=438736  Change-Id: Iaa8d0518d481927d66130ea1bf3a95a750c5a761 Reviewed-on: https://chromium-review.googlesource.com/255662 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix tests due to added output arg to Translator.  BUG=angleproject:933 TEST=angle_unittests  Change-Id: I548f1f6ae29760bf4251e5dadeac8a27a4027ceb Reviewed-on: https://chromium-review.googlesource.com/255585 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Add an SH_GLSL_CORE_OUTPUT profile.  So we could generate shaders for Apple using core GL profile.  By switching to core profile we still pass most WebGL conformance tests 1.0.2 on Linux but not all so apparently more work is needed.  However I think it's OK to check this CL in because this output profile will be only used behind a chromium switch.  BUG=angleproject:933 TEST=webgl conformance tests  Change-Id: Iad70e1aebf82349d3fc5f4116c1d6bc4448193fd Reviewed-on: https://chromium-review.googlesource.com/255282 Tested-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix min built-in function support  One of the recent change that uses generic types to compact the symbol table initialization has introduced a bug in 'min' function implementation just fixing it here.  TEST= dEQP tests: dEQP-GLES3.functional.shaders.operator.common_functions.min.lowp_uvec*  Change-Id: I0e3d386c89bc07c3b656ec5029b8ce57f663cf46 Reviewed-on: https://chromium-review.googlesource.com/255369 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a StateManagerGL method to sync state required for a draw call.  BUG=angle:883  Change-Id: Iabeb25aef2228a1900bd0209422ddce21771c688 Reviewed-on: https://chromium-review.googlesource.com/252802 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement basic functionality in VertexArrayGL.  No support for raw vertex data pointers yet.  BUG=angle:880  Change-Id: Ifa8099b0f49028a1465edecde495ba725ac79598 Reviewed-on: https://chromium-review.googlesource.com/252801 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Set symbol extension at insertion.  BUG=angle:926  Change-Id: I4c96ae89c79d720d99bde803541c3158ba4629ab Reviewed-on: https://chromium-review.googlesource.com/251662 Tested-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add basic support for HLSL output of switch and case  This patch outputs switch and case statements in HLSL but ignores fall-through. Switch statements that include fall-through cause the platform HLSL compiler to generate errors.  BUG=angle:921  Change-Id: I10efbfb45076cf4fd79840698abafd8111e597d4 Reviewed-on: https://chromium-review.googlesource.com/251527 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add GLSL output of switch and case  BUG=angle:921  Change-Id: I0d752440ce6ffdfcc005f1a6123694bdfeb1b067 Reviewed-on: https://chromium-review.googlesource.com/251526 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix an issue with handling an error case inside ValidateSwitch  In case a condition with a wrong type is given to a case statement it generates an error but the compiler recovers. This caused ValidateSwitch to assert. Fix this.  BUG=angle:921  Change-Id: I7949798cab923c2b168817471896470c6c611878 Reviewed-on: https://chromium-review.googlesource.com/254080 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix and reenable MipmapTests in release mode  Change-Id: Ia702abedc261d717c24152cb207ac80393ac864f Reviewed-on: https://chromium-review.googlesource.com/242980 Reviewed-by: Gregoire Payen de La Garanderie <Gregory.Payen@imgtec.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Set symbol operations at insertion.  BUG=angle:926  Change-Id: Ifc8f62ebe1277214a4d3fbd5c56eb5faeff8e389 Reviewed-on: https://chromium-review.googlesource.com/251650 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Pipe the ProgramBinary functions to the OES implementations.  BUG:462020  Change-Id: Ic567bf3d56d551716f1915a208003a7699abe6e6 Reviewed-on: https://chromium-review.googlesource.com/254300 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update failing WebGL tests list.  Change-Id: Ib141eaebe14a6bf80efa2bcdfec3371ac1a59b09 Reviewed-on: https://chromium-review.googlesource.com/254062 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Temporarily disable OpenGL tests.  Change-Id: I3281b77e9876fc9a336b585af422e790bd73e11f Reviewed-on: https://chromium-review.googlesource.com/254130 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix GL typedef conflicts.  Moved typedefs to the global namespace to avoid future name conflicts.  Change-Id: I70bd47d2516964cd040df48c0b2ca50bc32ba851 Reviewed-on: https://chromium-review.googlesource.com/254090 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Accept mismatching auxiliary interpolations.  The ES3.1 spec and discussion on Khronos.org confirm that dEQP is correct in accepting mismatching centroid specifiers in shader linkage. Mismatching flat/smooth is still a link error.  Fixes: shaders.linkage.varying.rules.differing_interpolation_2  Change-Id: I3016f4147e7c1b16b02371ee95866c8daf826212 Reviewed-on: https://chromium-review.googlesource.com/251205 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add UMA histogram for D3D9 init results.  Similar to D3D11 results this can add statistics for the result of initializing the D3D9 Renderer.  BUG=436191  Change-Id: I746c95a8dbb27456613844fde816e17352dc4b8d Reviewed-on: https://chromium-review.googlesource.com/248660 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add UMA histogram for D3D11 init failures.  This will give ANGLE in Chrome a sense of device init calls fails in D3D11 and why.  BUG=436191  Change-Id: Ia7b1bfa334cec595b6f0265357385d0dcc2d6cbf Reviewed-on: https://chromium-review.googlesource.com/248632 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix shadow samplers with textureProj and vertex shaders.  Fixes: dEQP-GLES3.functional.shaders.texture_functions.textureproj.sampler2dshadow_fragment dEQP-GLES3.functional.shaders.texture_functions.textureproj.sampler2dshadow_bias_fragment dEQP-GLES3.functional.shaders.texture_functions.textureprojoffset.sampler2dshadow_fragment dEQP-GLES3.functional.shaders.texture_functions.textureprojoffset.sampler2dshadow_bias_fragment and some of: dEQP-GLES3.functional.shaders.texture_functions.texture*.sampler2dshadow_vertex  BUG=angle:925  Change-Id: I080e379ded95469f0486ae9c8bb1756842118a2d Reviewed-on: https://chromium-review.googlesource.com/251530 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement basic functionality in BufferGL.  BUG=angle:881  Change-Id: I8d761741d204d26cea1c87eec725bc8ebaaaa584 Reviewed-on: https://chromium-review.googlesource.com/252800 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Rename StateManagerGL::setProgram to useProgram.  BUG=angle:882  Change-Id: I4046e23bf720690869558fa6a5528d40c4b3bfa3 Reviewed-on: https://chromium-review.googlesource.com/254070 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Temporarily disable WGL debug contexts.  Change-Id: I62f29b8012386cd57181621e0854aa5a8ce534dd Reviewed-on: https://chromium-review.googlesource.com/254061 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add validation for the structure of switch statements  Implement a traverser to check for the following errors: -More than one default or replicated constant expression -No statement between a label and the end of a switch statement -Statements in a switch statement before the first case statement -Mismatch between the type of init-expression and type of a case label -Case or default label nested inside other control flow nested within the corresponding switch  Tested by manually disabling shading language version checks for switch and by manually enabling case statements in a Chromium build and checking that the expected errors are generated.  BUG=angle:921  Change-Id: I99c49c17c8b520849adbe4d8521e46cb10e20e41 Reviewed-on: https://chromium-review.googlesource.com/251524 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add stubs for switch and case output  BUG=angle:921  Change-Id: I58bd645a8d53ef5bad9b680e54c8948d50932fca Reviewed-on: https://chromium-review.googlesource.com/251525 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement basic functionality of ProgramGL.  BUG=angle:882  Change-Id: I1d859197011081729c4c5733b78ac10491fe926c Reviewed-on: https://chromium-review.googlesource.com/251542 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add test for very basic operations to enable as GL functionality is added.  Add OpenGL and OpenGLES platform types for the ANGLE tests.  Comment out some UNIMPLEMENTEDs that tests using OpenGL trigger.  BUG=angle:882  Change-Id: I7f85eed184f7cebd25e2521d793fc9c394b704ce Reviewed-on: https://chromium-review.googlesource.com/252252 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update Display to allow for changing implementation objects.  Previously it was possible to change from a D3D9 to D3D11 display because both were implemented with a DisplayD3D.  Now that there is a DisplayGL the DisplayImpl must be updated while maintaining the same EGLDisplay value.  Allow the value of Display::mImplementation to be updated when the display is not already initialized.  BUG=angle:890  Change-Id: Ic18a8a120218cd130a71b9aa044b6ec00006d6a0 Reviewed-on: https://chromium-review.googlesource.com/252250 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Hide gtest and gmock internal standalone targets.  Don't expose these on the Chromium (non-standalone) build. This fixes some missing file warnings for the msvs-ninja build.  BUG=angle:928 BUG=459058  Change-Id: I8932c31223347358070955b33995a3e973c359b7 Reviewed-on: https://chromium-review.googlesource.com/253001 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: bratell at Opera <bratell@opera.com> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Disable the HLSL code in Angle if it is not being used.  We're only using the HLSL code in Windows so it's not necessary to compile and distribute it on other platforms.  This adds a defined ANGLE_ENABLE_HLSL that can be checked in files that are used by non-HLSL code as well. Mostly the HLSL code is just not include by the build system.  Details of the space savings (heavily truncated)  Total change: -165717 bytes ===========================  -606 - Source: angle/src/common/utilities.cpp  -627 - Source: angle/src/compiler/translator/FlagStd140Structs.cpp  -695 - Source: /usr/include/c++/4.8/bits/stl_algo.h  -710 - Source: angle/src/compiler/translator/TranslatorHLSL.cpp  -713 - Source: angle/src/compiler/translator/IntermNode.h  -863 - Source: /usr/include/c++/4.8/bits/stl_map.h  -935 - Source: angle/src/compiler/translator/blocklayout.cpp  -1515 - Source: angle/src/compiler/translator/BuiltInFunctionEmulator.cpp  -1655 - Source: angle/src/compiler/translator/UnfoldShortCircuit.cpp  -2375 - Source: /usr/include/c++/4.8/bits/vector.tcc  -3135 - Source: angle/src/compiler/translator/RewriteElseBlocks.cpp  -4656 - Source: angle/src/compiler/translator/UtilsHLSL.cpp  -5265 - Source: angle/src/compiler/translator/BuiltInFunctionEmulatorHLSL.cpp  -6505 - Source: /usr/include/c++/4.8/bits/stl_tree.h  -11480 - Source: angle/src/compiler/translator/UniformHLSL.cpp  -13580 - Source: angle/src/compiler/translator/StructureHLSL.cpp  -18964 - Source: ??     (constant strings and a few vtbls)  -89332 - Source: angle/src/compiler/translator/OutputHLSL.cpp  Change-Id: I23ccc98abd0a21f847dd34f9482800b3ba679d56 Reviewed-on: https://chromium-review.googlesource.com/251528 Tested-by: bratell at Opera <bratell@opera.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add basic error checks for switch and case  Check that the case labels have constant scalar integers and that switch statements are initialized with scalar integers. Also check that case and default labels do not exist outside switch statements. Allow break statements inside switch statements.  Tested by manually disabling shading language version checks for switch in a Chromium build and checking that the expected errors are generated.  BUG=angle:921  Change-Id: Ibe83d0db52958c493ded5640d4babf670dc02d55 Reviewed-on: https://chromium-review.googlesource.com/251523 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Implement parsing switch statements  Put in some groundwork for parsing switch statements and case labels in the parser including definitions for IntermNode classes. Intermediate functions for adding the statements are stubbed to only generate errors for now.  Tested by manually disabling shading language version checks for switch in a Chromium build and checking that the expected errors are generated.  BUG=angle:921  Change-Id: I064b3e0c4c1b724a083cf5bc78eebfdd3794eb1b Reviewed-on: https://chromium-review.googlesource.com/250380 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Attempt shader compilation without unroll and flatten with error X4014.  BUG=angle:917  Change-Id: Ie5b9a673f4af7241576cbe73ac96a7fb518af798 Reviewed-on: https://chromium-review.googlesource.com/252986 Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Embed rapidjson sources.  This makes integration with Chrome much easier: Chrome won't have to pull sources from github or an internal mirror and it won't duplicate the base json library.  This should also fix warnings about missing headers with building Chromium gyp with the ninja msvs generator.  BUG=459058  Change-Id: Ie97cfde9b848a9099da696e027887bcc07b55e08 Reviewed-on: https://chromium-review.googlesource.com/252073 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor validating jump statements out of glslang.y  Move the logic to ParseContext. This will simplify changing the logic for the break statement that is needed to implement switch.  BUG=angle:921 angle:911 TEST=WebGL conformance tests  Change-Id: Ib8bbc7075c05d345e90377202b5446fb3307f94c Reviewed-on: https://chromium-review.googlesource.com/251522 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Use generic types to compact the symbol table initialization.  Just like in the spec text use symbolic types that represent multiple concrete types. The few signatures that get generated more than once are only added to the symbol table once because it ignores duplicates.  BUG=angle:926  Change-Id: I216f03d22502b724dbefc87c5a021d6021c3a434 Reviewed-on: https://chromium-review.googlesource.com/251620 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Updated instanced pointsprite emulation to be more resilient to driver differences.  Change-Id: I89e5b5a2d2c0363ae07d5ba918187cb0d7056ac5 Reviewed-on: https://chromium-review.googlesource.com/251680 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a state manager for the currently applied GL state.  BUG=angle:883  Change-Id: Ie69c883c5ee539f911480fdcd9e73c46a3001b33 Reviewed-on: https://chromium-review.googlesource.com/250930 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement ShaderGL.  BUG=angle:882  Change-Id: I1a8c7b551b308c9362e56ce564ebde7d579c05a3 Reviewed-on: https://chromium-review.googlesource.com/251541 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update ANGLE_platform_angle_d3d to use a device type enum instead of WARP bool.  BUG=angle:490  Change-Id: I1555e7f09b23138753e52ddf720d088587f7cadb Reviewed-on: https://chromium-review.googlesource.com/232104 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add missing Display::getImplementation.  Change-Id: I220ffefcbf9bc988d986e729961c9a893d6b5159 Reviewed-on: https://chromium-review.googlesource.com/251580 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement missing variants of abs/sign  This change adds ANGLE support for abs/sign variants introduced in ESSL3.  BUG=angle:923 TEST=Unit tests dEQP tests  Unit Tests: TypeTrackingTest.BuiltInAbsSignFunctionFloatResultTypeAndPrecision TypeTrackingTest.BuiltInAbsSignFunctionIntResultTypeAndPrecision  dEQP tests passing 100% because of this change: dEQP-GLES3.functional.shaders.builtin_functions.common.abs dEQP-GLES3.functional.shaders.builtin_functions.common.sign  Change-Id: I2a3b028611f0eaaac3c031f8926d34a0e146663d Reviewed-on: https://chromium-review.googlesource.com/251491 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Disable warning 4251 for ShaderVars.h.  Exporting STL classes from a DLL produces a warning on MSVS. This warning would only show up for component builds.  Change-Id: I1bd9b820a45c04f92b0278d7018507d6a2bc7936 Reviewed-on: https://chromium-review.googlesource.com/251704 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Enable some more MSVS compiler warnings.  Also add comments explaining why the one that are still around are still around.  Change-Id: Id8ce1fa3fe2a3bc97a179018737cc8d027b1068a Reviewed-on: https://chromium-review.googlesource.com/250878 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Nico Weber <thakis@chromium.org> Commit-Queue: Nico Weber <thakis@chromium.org>, 23355681, 619, 169, 619
Implement CompilerGL.  BUG=angle:882  Change-Id: I6fd426b19677b51f4df74d495acc9a6fde9822e8 Reviewed-on: https://chromium-review.googlesource.com/251540 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make Angle code 40 KB smaller by using string literals directly.  The implicit conversion of hundreds of string literals to TString generated a lot of machine code. By keeping them as string literals all the way the code will be smaller and faster.  This is the change with clang for x64 (note VisitUnary in particular): Total change: -41392 bytes ==========================   2 added totalling +469 bytes across 1 sources   2 removed totalling -472 bytes across 1 sources   5 shrunk for a net change of -41389 bytes (54126 bytes before 12737 bytes after) across 1 sources   279692 unchanged totalling 51433327 bytes  ------------------------------------------------------------------------------------------------------------------------------------  -41392 - Source: /home/bratell/src/chromium/src/third_party/angle/src/compiler/translator/OutputHLSL.cpp - (gained 469 lost 41861) ------------------------------------------------------------------------------------------------------------------------------------   New symbols:        +328: sh::OutputHLSL::outputConstructor(Visit TType const& char const* TVector<TIntermNode*> const*) type=t size=328 bytes        +141: sh::OutputHLSL::outputTriplet(Visit char const* char const* char const*) type=t size=141 bytes   Removed symbols:        -133: sh::OutputHLSL::outputTriplet(Visit std::basic_string<char std::char_traits<char> pool_allocator<char> > const& std::basic_string<char std::char_traits<char> pool_allocator<char> > const& std::basic_string<char std::char_traits<char> pool_allocator<char> > const&) type=t size=133 bytes        -339: sh::OutputHLSL::outputConstructor(Visit TType const& std::basic_string<char std::char_traits<char> pool_allocator<char> > const& TVector<TIntermNode*> const*) type=t size=339 bytes   Shrunk symbols:        -388: sh::OutputHLSL::writeEmulatedFunctionTriplet(Visit char const*) type=t (was 628 bytes now 240 bytes)        -714: sh::OutputHLSL::visitBranch(Visit TIntermBranch*) type=t (was 1017 bytes now 303 bytes)       -9738: sh::OutputHLSL::visitAggregate(Visit TIntermAggregate*) type=t (was 17609 bytes now 7871 bytes)      -14132: sh::OutputHLSL::visitBinary(Visit TIntermBinary*) type=t (was 17627 bytes now 3495 bytes)      -16417: sh::OutputHLSL::visitUnary(Visit TIntermUnary*) type=t (was 17245 bytes now 828 bytes)  Change-Id: Id0f87d72f6d7f1ab7b543f0d28d5a8b7c7db9ec7 Reviewed-on: https://chromium-review.googlesource.com/251090 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: bratell at Opera <bratell@opera.com>, 23355681, 619, 169, 619
Load all core WGL functions.  BUG=angle:879  Change-Id: If204156e69480cd7e1e7c43db8496dd150ac9e15 Reviewed-on: https://chromium-review.googlesource.com/251241 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Expose FunctionsWGL::getProcAddress.  Change-Id: I263f00e67eb3243c661de8f949933ea56e34d4b5 Reviewed-on: https://chromium-review.googlesource.com/251220 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Enable MSVS warning 4512.  Fix up the missing DISALLOW_COPY_AND_ASSIGN macros and various small problems preventing us from turning on this warning. This should ensure we more often use the DISALLOW macro going forward.  Change-Id: I2e1a9d23a31a51279a577fad8dffb8c1530e2ee8 Reviewed-on: https://chromium-review.googlesource.com/251100 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Cooper Partin <coopp@microsoft.com> Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Implement missing variants of abs/sign"  This for some reason is failing angle_unittests:  http://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Release%20%28NVIDIA%29/builds/13296  Happens across platforms.  This reverts commit 3e142e47cc5b40564bcdba4252fd326bc28ca343.  Change-Id: Ideb20457546c0dec10c9584182cc8d5ead42309d Reviewed-on: https://chromium-review.googlesource.com/251160 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement the copy from a 3D texture to Image11.  Fixes the generation of 3D texture mipmaps.  BUG=angle:915  Change-Id: Icc0c91099f60713d511ebe1a2248a21b63efddaa Reviewed-on: https://chromium-review.googlesource.com/244720 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Gregoire Payen de La Garanderie <Gregory.Payen@imgtec.com>, 23355681, 619, 169, 619
Implement ESSL3 modf  This is the first built-in function that has an out parameter so l-value checks are added for built-ins.  BUG=angle:918  Change-Id: Ifd5befe955224f706f864e25107879c9cdce9e9f Reviewed-on: https://chromium-review.googlesource.com/250780 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix GetShaderPrecisionFormat to return correct values on DX11  The integer precision is different on DirectX 9 and 11 backends. DirectX 11 guarantees native 32-bit integers.  BUG=angle:919  Change-Id: I7619e66f8aaa1177c32b6da185fe805ce8a19b71 Reviewed-on: https://chromium-review.googlesource.com/250280 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Implement missing variants of abs/sign  This change adds ANGLE support for abs/sign variants introduced in ESSL3.  BUG=angle:923 TEST=dEQP tests Tests passing 100% because of this change: dEQP-GLES3.functional.shaders.builtin_functions.common.abs dEQP-GLES3.functional.shaders.builtin_functions.common.sign  Change-Id: If22032be2c1ed08451275262e311ef5ac613d45e Reviewed-on: https://chromium-review.googlesource.com/251060 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Enable MSVS warning 4530.  This forces us to not use exceptions when they aren't enabled.  Change-Id: I6abaf08ca4c275bd2fa0625905fd1de3448237ce Reviewed-on: https://chromium-review.googlesource.com/250901 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nico Weber <thakis@chromium.org>, 23355681, 619, 169, 619
Revert "Re-resubmit "Compile the D3D11 VS and PS on separate threads at GL link time""  Fails clang-win again. Apparently Clang mimics MSVS.  This reverts commit af1bdff62ec4cc80b47fbac7e5d973f6f7225036.  Change-Id: I48a503889a9e905fcdc9f101dbf98f7cb7912279 Reviewed-on: https://chromium-review.googlesource.com/250882 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add ANGLE platform implementation template.  The platform implementation allows the app layer to pass in an object on which ANGLE can call virtual methods. Our current platform will handle trace events for app profiling and histogram records for statistics. The platform approach gives a much more robust approach than using entry points for every piece of functionality and is based on the interop with Blink.  The default platform implementation does a no-op on every call. The destructor is also private to ensure we do not call the destructor of the passed-in class.  BUG=436191  Change-Id: I05641b89a48a9cff81ced059518fceb5aa6c883b Reviewed-on: https://chromium-review.googlesource.com/248631 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix loaded GL entry points using the wrong call type.  BUG=angle:879  Change-Id: Ida65d67d2935480dfe584026d37fb68cd2ab39d6 Reviewed-on: https://chromium-review.googlesource.com/250823 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Fix constant folding integer modulus  Constant folding % used to generate results from division instead of results from modulus. Fix this and introduce a test for this and other integer constant folding that checks that the right constant values are found in the IntermNode tree.  BUG=angle:916 TEST=angle_unittests  Change-Id: I75e59b7734eb206378a1b2957af0a5437a90097c Reviewed-on: https://chromium-review.googlesource.com/249691 Reviewed-by: Gregoire Payen de La Garanderie <Gregory.Payen@imgtec.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Implement isnan/isinf  This change adds ANGLE support for isnan/isinf.  BUG=angle:922 TEST=dEQP tests: dEQP-GLES3.functional.shaders.builtin_functions.common.isnan.* (high precision tests still fail) Tests passing 100% because of this change: dEQP-GLES3.functional.shaders.builtin_functions.common.isinf.* Reduced number of errors in tests: EQP-GLES3.functional.shaders.constant_expressions.builtin_functions.common.isnan.* dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.common.isinf_*  Change-Id: I52bf18b59365ea7031746ae840550162d7e6b96e Reviewed-on: https://chromium-review.googlesource.com/250761 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Implement missing vector relational functions  This change adds ANGLE support for following vector relational function variants introduced in GLES3: bvec lessThan(uvec x uvec y) bvec lessThanEqual(uvec x uvec y) bvec greaterThan(uvec x uvec y) bvec greaterThanEqual(uvec x uvec y) bvec equal(uvec x uvec y) bvec notEqual(uvec x uvec y)  BUG=angle:920 TEST=dEQP tests Reduced number of errors in tests: dEQP-GLES3.functional.shaders.constant_expressions.builtin_functions.vector_relational.*  Change-Id: Id45ce77b35f39403e587a577622271d8e9815225 Reviewed-on: https://chromium-review.googlesource.com/250377 Reviewed-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Expose the IntermNode tree generated in the compiler for testing  This refactoring makes it possible for tests to access the IntermNode tree produced by compilation by calling compileTree(). Removing ParseContext usage from OutputHLSL has the additional benefit of better separation between parsing and output.  BUG=angle:916  Change-Id: Ib40954832316328772a5c1dcbbe6b46b238e4e65 Reviewed-on: https://chromium-review.googlesource.com/249723 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Do not use std::set::at in Config.cpp.  This is C++11 STL.  BUG=459399  Change-Id: I2e994e6b47535bcb38c193db2aaecc304e388772 Reviewed-on: https://chromium-review.googlesource.com/250581 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
D3D11: Use system memory for dynamic buffer updates.  In our current code we would use a staging texture as the working copy for buffer updates. This would trigger very large memcpy calls in some cases for large buffers with small updates. Instead use a CPU memory buffer storage and work with this storage when the user updates data. This plays much nicer with the VertexDataManager.  BUG=angle:912  Change-Id: I8c32d3d9bb321a06534556ce05b4b99dc3d1e961 Reviewed-on: https://chromium-review.googlesource.com/249183 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Re-resubmit "Compile the D3D11 VS and PS on separate threads at GL link time"  The latest version of this change disables multithreaded D3D shader compilation with any C++ compiler other than VC (e.g. Clang).  Change-Id: If3ef5fd650055ae66397ea2c9121bfcf1792892a Reviewed-on: https://chromium-review.googlesource.com/250328 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a FunctionsGL class for loading GL entry points.  BUG=angle:879  Change-Id: I35384f078d2ed86a6c72cc243753b56bc58617b0 Reviewed-on: https://chromium-review.googlesource.com/250390 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
D3D: Re-init static buffer after invalidate.  This allows the Buffer class to always know if it's intended to use static data vs dynamic. In some cases we would end up with NULL pointers and not know if we started with static or dynamic usage.  BUG=angle:912  Change-Id: I79ca62674543e0cf4b2ba9b31b6d8918723b31ce Reviewed-on: https://chromium-review.googlesource.com/249460 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Generalize NativeBuffer11::setData.  We can replace this method with a base class method which uses our implementation of "map". This allows us to reuse setData in other mappable buffer storage types.  BUG=angle:912  Change-Id: I7848cb9440b806364d9b2a6e2251323e53206921 Reviewed-on: https://chromium-review.googlesource.com/249182 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add Display getters for native display and attribs.  This simplifies the logic in the Renderer init.  BUG=angle:905  Change-Id: I01bf3701dd85f50e369e2c11e0e2a7cb638ccf00 Reviewed-on: https://chromium-review.googlesource.com/247650 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Reduce the calls to get[Width|Height|InternalFormat] in Texture.cpp.  BUG=angle:909  Change-Id: I8a66c1d317bcb7a01d79f9475390deb292e1ae2e Reviewed-on: https://chromium-review.googlesource.com/248052 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Store the texture image information in a std::vector instead of a std::map.  BUG=angle:909  Change-Id: Ib595306f6cf0633b16bff6389373c2bb2cc29ec9 Reviewed-on: https://chromium-review.googlesource.com/248051 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement eglQueryContext  BUG=angle:895  Change-Id: I5e709f772d6222cdb7b5d7c060830a75eac9f815 Reviewed-on: https://chromium-review.googlesource.com/246490 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix cstdint include in MemoryBuffer.h.  This syntax isn't compatible with OSX.  Change-Id: I3ec2bc856843637c4e1e7afb96a93ff6ea8296da Reviewed-on: https://chromium-review.googlesource.com/247660 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move rx::MemoryBuffer to common library.  This class is not D3D-specific so can be shared among other back-ends or other parts of the ANGLE codebase.  Change-Id: Ie00760eb5dae4db52e465ee7a2f97789bae8c0b0 Reviewed-on: https://chromium-review.googlesource.com/246500 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a script to generate a new Renderer.  Also refactor our current Impl headers slightly to facilitate parsing by the generation script.  BUG=angle:905  Change-Id: Ib86cff71d18e7f911cf526b27b8a82757bacd738 Reviewed-on: https://chromium-review.googlesource.com/245497 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Catch errors in TextureStorage creation in TextureD3D::getNativeTexture.  BUG=450257  Change-Id: Iba75d9f0607177fff0bec7fcd2564a8d2e26da8e Reviewed-on: https://chromium-review.googlesource.com/243882 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Only request PostSubBuffer support when the extension is available.  BUG=angle:658  Change-Id: I6828290ef89c57e8c794f0fca6e5991c492b67aa Reviewed-on: https://chromium-review.googlesource.com/242572 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move eglCreatePbuffer* validation into validationEGL.  BUG=angle:658  Change-Id: I25d1be1ef86f82892186b08c9a8ff0133d520ac6 Reviewed-on: https://chromium-review.googlesource.com/242037 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move eglCreateWindowSurface validation into validationEGL.  BUG=angle:658  Change-Id: Iaa7e6033fb323c1089907c9ed753746729887061 Reviewed-on: https://chromium-review.googlesource.com/242036 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move eglCreateContext validation into validationEGL.  BUG=angle:658  Change-Id: Ibdf601725536edf40c0499aba0402fb160b2c841 Reviewed-on: https://chromium-review.googlesource.com/242035 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add EGL validation helper files and move some validation to them.  BUG=angle:658  Change-Id: Id560268a280f2fa7d75a7d0727dac830fe8de9f1 Reviewed-on: https://chromium-review.googlesource.com/242034 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a makeCurrent method to Display.  BUG=angle:658  Change-Id: If1830fb164d31e2ee8092414d012e127ec344d69 Reviewed-on: https://chromium-review.googlesource.com/242033 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implementing gl_InstanceID in the HLSL compiler.  Fixes: dEQP-GLES3.functional.instanced.draw_arrays_instanced.instance_id dEQP-GLES3.functional.instanced.draw_arrays_instanced.mixed dEQP-GLES3.functional.instanced.draw_elements_instanced.instance_id dEQP-GLES3.functional.instanced.draw_elements_instanced.mixed  BUG=angle:601  Change-Id: I6e120eebc90d00e025fc58f096064e6ed1da826b Reviewed-on: https://chromium-review.googlesource.com/246911 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Gregoire Payen de La Garanderie <Gregory.Payen@imgtec.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Revert "Track bound render targets in D3D9 with uintptr_t and dirty them with -1."  Failures on the Chromium GPU FYI bots: http://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Release%20%28Intel%29/builds/8695  This reverts commit 358c8a95aeb3fd01218bc4116e999f4cd0c3fdc1.  Change-Id: I01d674929280364e097e4f65b06d7c3b1f928e92 Reviewed-on: https://chromium-review.googlesource.com/247091 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix instanced point sprites when gl_PointSize is specified but not used  Change-Id: I2350fa60cae55f02d7b484c34544c035acaba6ad Reviewed-on: https://chromium-review.googlesource.com/245703 Reviewed-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Track bound render targets in D3D9 with uintptr_t and dirty them with -1.  BUG=447419  Change-Id: Ia77e3b00db0f327eb278285de14cd438c5cf538b Reviewed-on: https://chromium-review.googlesource.com/244664 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Track bound render targets in D3D11 with uintptr_t and dirty them with -1.  BUG=447419 BUG=452587  Change-Id: Ic36ebf108eca93e1239cc9c2a0d6479c84e93ace Reviewed-on: https://chromium-review.googlesource.com/244663 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move Renderer::getMajorShaderModel to RendererD3D.  BUG=angle:658  Change-Id: Ibf67a96ec9c0e8d6adc4f9c839da1e06058dc32f Reviewed-on: https://chromium-review.googlesource.com/239904 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove swap interval queries from Renderer.  BUG=angle:658  Change-Id: I7cd9cf3693c06c46ec6a4054e8fe1586f399273c Reviewed-on: https://chromium-review.googlesource.com/239903 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Require 8 stencil bits in the BlitFramebufferANGLETest.  The test can fail if it uses a config where the default framebuffer does not have a stencil buffer.  BUG=angle:658  Change-Id: I82eaf5b508182514439e69469e77591e1aceaf66 Reviewed-on: https://chromium-review.googlesource.com/246461 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Generate the full EGL configs in the Renderers.  Specify the default framebuffer formats in GL formats but still use BGRA and ANGLEX formats for now.  BUG=angle:658  Change-Id: I7192db4ca76ab4b0b42daa43785a7ddd9528a9ca Reviewed-on: https://chromium-review.googlesource.com/239902 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Adds new robust initialization extensions.  Change-Id: I66d2ebbb0ce89bbfd1eda648e9ad0fb2edee0f31 Reviewed-on: https://chromium-review.googlesource.com/239286 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Implement ReadBuffer functionality.  This enables ReadPixels from non-0 FBO attachments.  Tested with: dEQP-GLES3.functional.negative_api.buffer.read_buffer  (fails due to a possible error in dEQP) dEQP-GLES3.functional.shaders.fragdata.draw_buffers  (passes)  BUG=angle:903  Change-Id: Ib095e1d50b8fbbc6f197de25f19ec0993309145a Reviewed-on: https://chromium-review.googlesource.com/244841 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Add stubs for primitive restart caps.  Allow dEQP to reset this particular state variable while still throwing an UNIMPLEMENTED error if we try to render with primitive restart enabled.  BUG=angle:901  Change-Id: I1ab46ff4d8bff2775225b083f08d156b9422b9c5 Reviewed-on: https://chromium-review.googlesource.com/244840 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update failing WebGL expectations.  Change-Id: I0bde5c4e896aded773d2b9de7343883264625f52 Reviewed-on: https://chromium-review.googlesource.com/245807 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Change Config to a struct and rename it's members.  BUG=angle:658  Change-Id: I18dab915730fc28815db8080b3614da821f9c8b1 Reviewed-on: https://chromium-review.googlesource.com/239901 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Rewrite ConfigSet and make EGLConfig synonymous with egl::Config.  BUG=angle:658  Change-Id: I3c33faf18af0bfda00dc5babe6356d6c8661f032 Reviewed-on: https://chromium-review.googlesource.com/238862 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Have the DisplayImpl create the Renderer and Contexts.  BUG=angle:658  Change-Id: I726d87b90be8382c5dd8964e4d8686711e404ffe Reviewed-on: https://chromium-review.googlesource.com/238861 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update WebGL expected failures.  A new test 'sampler-struct-function-arg' fails with ToT WebGL.  Change-Id: Ie62208364ceacd4b980cb16f5de31cc4b5c62fa1 Reviewed-on: https://chromium-review.googlesource.com/243594 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use JSON as startup parameters to BufferSubData test.  BUG=angle:744  Change-Id: I60287f3c612011f505f1bc20632efc4dd17001d3 Reviewed-on: https://chromium-review.googlesource.com/221375 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Resize buffer storage on getLatestBufferStorage if needed.  BUG=angle:897  Change-Id: I3d6079b718bb5dd61cbd3098694204aae9bbc932 Reviewed-on: https://chromium-review.googlesource.com/243152 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Gregoire Payen de La Garanderie <Gregory.Payen@imgtec.com>, 23355681, 619, 169, 619
Fix lots of variable shadowing in ANGLE  BUG=angle:877  Change-Id: I3df0fffb19f5ecbe439fbc2a8d6d239a5dc6b638 Reviewed-on: https://chromium-review.googlesource.com/243334 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Avoid precision emulation overhead on unused values  Avoid rounding intermediate values when the intermediate value is not consumed. For example this avoids rounding the return value of assignment so "b = a;" becomes "b = frm(a);" instead of "frm(b = frm(a))".  BUG=angle:874 TEST=compiler_tests  Change-Id: Ifcdb53fb1d07a2cf24e429cc237c2d0262dc32f8 Reviewed-on: https://chromium-review.googlesource.com/241852 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Generate egl configs from the DisplayImpl.  Still do the actual generation in the Renderer9/11 for now but route it through the DisplayImpl.  BUG=angle:658  Change-Id: Ib976fbd1b9e349146dc068bbdd4e6a3d2a5ddc69 Reviewed-on: https://chromium-review.googlesource.com/238860 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Check for EGL extension existance during validation.  BUG=angle:658  Change-Id: I078d7f9ab4ab42bd7d3cd3865572ead8ed1f0b29 Reviewed-on: https://chromium-review.googlesource.com/234763 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move display extension initialization to DisplayImpl.  BUG=angle:658  Change-Id: I44d95fad4e1be5cc76f443d724defd37da4a268f Reviewed-on: https://chromium-review.googlesource.com/234762 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Fix lots of variable shadowing in ANGLE"  Caused WebGL CTS failures on the texture-npot test: https://www.khronos.org/registry/webgl/sdk/tests/conformance/textures/texture-npot.html  This reverts commit c67e6e9fade44ef8938724e82db11db725e9c8e5.  Change-Id: I089e99859231e0d657084ac3647257c650a9da92 Reviewed-on: https://chromium-review.googlesource.com/243041 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix lots of variable shadowing in ANGLE  BUG=angle:877  Change-Id: I15168ae32605b26aee08274464ffe68adb5a7e87 Reviewed-on: https://chromium-review.googlesource.com/242351 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Disable MipMapTests on all renderers.  Change-Id: Ic229ced16f667882521536db5bd483c76b24d600 Reviewed-on: https://chromium-review.googlesource.com/242905 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Enable Windows Phone 8.1 project generation  Change-Id: Iab44f6d634bdcd01348aa49de28b96c3b6086df7 Reviewed-on: https://chromium-review.googlesource.com/241945 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Disable the MipMapTests on D3D11 FL 9.3.  Change-Id: Ibcb72f7b1aabcd98c4bebd91c3a57f5ba57eac3a Reviewed-on: https://chromium-review.googlesource.com/242850 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Improve D3D11 FL9_3 zero-LOD workaround (e.g. TextureCubes)  D3D11 Feature Level 9_3 can't disable mipmaps on a mipmapped texture and sample from level zero of it. A previous commit added a workaround for this in ANGLE to Texture2Ds. This commit fixes some minor issues in that commit and extends the workaround to apply to TextureCubes too.  Change-Id: Ic97321af6f8bbf7ad5d96e58655c342db3978a6a Reviewed-on: https://chromium-review.googlesource.com/241944 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Support for 3D texture transfers with a non-null z offset.  Also fixes the unpack buffer offset which must be in pixel instead of bytes in the shader parameter.  BUG=angle:508  Change-Id: I908460a76c300d96054a02206e1f2e3ad2b8e9d0 Reviewed-on: https://chromium-review.googlesource.com/241440 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Gregoire Payen de La Garanderie <Gregory.Payen@imgtec.com>, 23355681, 619, 169, 619
Use a special flag to mark D3D11 shaders as dirty instead of NULL.  Also remove mCurPointGeometryShader and instead pass the program to drawArrays.  BUG=angle:872  Change-Id: If55517e81d9234705eabcc0e5be7b5b492858e08 Reviewed-on: https://chromium-review.googlesource.com/241421 Tested-by: Gregoire Payen de La Garanderie <Gregory.Payen@imgtec.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Removed Samples and Tests project generation from Windows Store builds.  Change-Id: Ic9a9f498888dba0c1986faa309f78bc71711c751 Reviewed-on: https://chromium-review.googlesource.com/241943 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Create a formatutilsD3D and move some functions from formatutils.  BUG=angle:681  Change-Id: I694073c50dccd05c3117761e446eba0d15c03293 Reviewed-on: https://chromium-review.googlesource.com/238480 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Disable HugeSetDataShouldNotCrash test.  This test flakes out on some Chromium bot configurations. It could be that we need to redesign it to use mocks or something similar to test reliably.  Change-Id: Ib323940d52db052e18d2352e45e029bbb1b64af0 Reviewed-on: https://chromium-review.googlesource.com/242023 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Reduce D3D9 error spam in renderer9 utils.  CheckDeviceFormat with a depth stencil format gives a spurious error when called with a non-depth-stencil format. We can check the number of format bits before we call to reduce the error spam.  Change-Id: Ia2a6e6d756c84e13effe298240f33c8c83379267 Reviewed-on: https://chromium-review.googlesource.com/242030 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Added PointSprites Support for renderers that do not support Geometry Shaders  Change-Id: Iae9ac5f8fbba68dba5e49ccda7bb7eebb05c8e9a Reviewed-on: https://chromium-review.googlesource.com/240450 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add support for bitwise operations in ESSL3  Add support for << >> & | ^ and their compound assignment variants <<= >>= &= |= ^=. Also add support for bitwise not (~).  BUG=angle:870  Change-Id: I5e6a835409589556d5d58d58078fdf505cfd8da5 Reviewed-on: https://chromium-review.googlesource.com/241850 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Only call std::string constructor in gl::Error when necessary  std::string's constructor is very expensive in debug builds. In some applications we have seen it use 10% of the CPU. This change makes (e)gl::Error store a pointer to an std::string and only create a string when necessary.  Change-Id: I78bfbda86568944681517fe32df9d1556e4ebee7 Reviewed-on: https://chromium-review.googlesource.com/240495 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add basic support for ESSL3 vec2 (un)pack functions  The functions are emulated on HLSL and use the native functions on OpenGL 4.2+ and GLES3.0. Emulation for OpenGL versions <= 4.1 is not yet implemented.  BUG=angle:865  Change-Id: I6803a1767dacdb3dca12f13924651fd38fcacb75 Reviewed-on: https://chromium-review.googlesource.com/240961 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add rapidjson library to DEPS.  RapidJSON gives us the ability to use JSON in our performance tests to specific the input. The license is very permissive and according to the author the performance is excellent.  Chromium's JSON library unfortunately seems quite tied to the "base" project.  BUG=angle:744  Change-Id: I64e72aad1ed6fa954acd851607032cb48a461348 Reviewed-on: https://chromium-review.googlesource.com/221374 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move imageformats to the d3d folder.  BUG=angle:681  Change-Id: I83f0e5aaca4aaa84e5868afcde4f27eba011d5f1 Reviewed-on: https://chromium-review.googlesource.com/238479 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move loadimage to the d3d folder.  BUG=angle:681  Change-Id: Id901d9ae66207ac5e7d2844b8cd1f6a58c4492f6 Reviewed-on: https://chromium-review.googlesource.com/238478 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move GenerateMip to the D3D folder.  BUG=angle:681  Change-Id: Icdffe7eb8f975ee0966e9fb241835ac541eb39f0 Reviewed-on: https://chromium-review.googlesource.com/238477 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move copyvertex to the d3d11 folder.  BUG=angle:681  Change-Id: Id37ed1ca617f1d2b6c1bd4a86fc8fcd28b933e8f Reviewed-on: https://chromium-review.googlesource.com/238476 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move copyimage to the D3D folder.  BUG=angle:681  Change-Id: I2ce237281cc75fdae11b5ddb4eca52058c395e7a Reviewed-on: https://chromium-review.googlesource.com/238475 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move vertexconversion.h to the d3d9 folder.  BUG=angle:681  Change-Id: I87ef6856040978a9a6045d1df20fe3117def35a3 Reviewed-on: https://chromium-review.googlesource.com/238474 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Rename ShaderExecutable to ShaderExecutableD3D and move it to the D3D folder.  BUG=angle:681  Change-Id: I097d6591be4e873c9a6f210cc91e3f4eb60f036b Reviewed-on: https://chromium-review.googlesource.com/238473 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Rename SwapChain to SwapChainD3D and move it to the D3D folder.  BUG=angle:681  Change-Id: Idcf24556e590e07cc0b6cf640d4701353a0cda5e Reviewed-on: https://chromium-review.googlesource.com/238472 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Rename RenderTarget to RenderTargetD3D and move it into the d3d folder.  BUG=angle:681  Change-Id: I1946e01ce09d99405c318723c254fe300cc5ac53 Reviewed-on: https://chromium-review.googlesource.com/238471 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Merge the Image class into ImageD3D.  BUG=angle:681  Change-Id: I0c0d41fb3ff9592b08ede58a8c2ec2bd2d94a0b2 Reviewed-on: https://chromium-review.googlesource.com/238470 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use the ImageIndex class for indexing the Texture size information.  BUG=angle:681  Change-Id: I0c8d1c04ca8eefb9b618ee6635c0643d162c0cc1 Reviewed-on: https://chromium-review.googlesource.com/240241 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement matrix inverse built-in  Inverse is emulated in HLSL by calculating the cofactor matrix and dividing that with the determinant. This results in the transpose of the inverse as is required. Better performing options might exist especially for 4x4 matrices but this is enough for a working implementation.  BUG=angle:859  Change-Id: I5185797cc1ed86865f5f4342707abdc2977a186b Reviewed-on: https://chromium-review.googlesource.com/240331 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix issues related to modulus operator  Make sure that "scalar %= vector" is not approved by the compiler and that % and %= are only exposed on GLES3.  BUG=angle:854  Change-Id: I3ac7eb607bd86a6caa905d2bef5d397688ad3fd3 Reviewed-on: https://chromium-review.googlesource.com/241410 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Gregoire Payen de La Garanderie <Gregory.Payen@imgtec.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fixing EVENT message of gl::RenderbufferStorage.  Change-Id: Iaf151d7521e67e8fe8bca331dabdf44d72e77ca1 Reviewed-on: https://chromium-review.googlesource.com/241420 Tested-by: Gregoire Payen de La Garanderie <Gregory.Payen@imgtec.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
MipmapTestES3's SetUp() doesn't conform to standards  Change-Id: I57dba132cd08bb1b3db2cda2fe0c31b97746e1a4 Reviewed-on: https://chromium-review.googlesource.com/241380 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Nico Weber <thakis@chromium.org>, 23355681, 619, 169, 619
Fix WinRT build break. angle_common needs the WinRT flags.  Change-Id: I409527becc9d8d2d91766a4cc5a24f96fd2b7505 Reviewed-on: https://chromium-review.googlesource.com/241070 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Fix off-by-one max mip levels in getSRV.  We would try to create SRVs with zero mip levels when we should be asking for a single mip level. This would happen when the base level is equal to the max level. See the dEQP test:  texture.mipmap.2d.max_level.linear_nearest  Change-Id: I3f231f159dbdecbf7c2e61b373bfc3545875f36e Reviewed-on: https://chromium-review.googlesource.com/240762 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix pixel unpack buffers for some formats.  The renderability test got flipped in 6cf8e1b906ebfc.  See dEQP test: texture.specification.teximage2d_pbo.rgba8_snorm_2d  Note: this test still fails due to a bug in isMipmapComplete which has a fix in a subsequent patch.  Change-Id: Ied8ad7712bbb844132b6ac37426716780c9801c9 Reviewed-on: https://chromium-review.googlesource.com/240761 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disable MipmapTest::ThreeLevelsInitData test due to failure on D3D11  Change-Id: I5d1ee78fceb91c05f3925e753888b10cc81ec2b8 Reviewed-on: https://chromium-review.googlesource.com/241080 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove usage of std::copy_n from the entry points.  This method is c++11 only and caused a build breakage on Mac.  BUG=angle:773  Change-Id: Ib362b8d577aa85b9d6d2b8b87840ec5197240cf2 Reviewed-on: https://chromium-review.googlesource.com/241010 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Work around zero-LOD mipmap issue on D3D11 Feature Level 9_3  In OpenGL ES it is possible to sample from level 0 of a mipmapped texture by setting GL_TEXTURE_MIN_FILTER to GL_NEAREST.  This is possible in D3D9 and D3D11 Feature Level 10_0+ via various methods. It's not possible in D3D11 Feature Level 9_3 though. This change works around this restriction by creating two copies of each texture on 9_3. The textures are identical except one has mipmaps and one doesn't.  The D3D11 renderer figures out which texture to use at the right time and keeps the textures in sync with each other as necessary. Note: each texture is only created when it's needed. It's possible that only one (or even neither) D3D texture will be created for a given GL texture.  Change-Id: I3c17137b4f63b9158b3abf067ad8e5d5c49d2191 Reviewed-on: https://chromium-review.googlesource.com/234522 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Reduce calls to ID3D11DeviceContext::Map() in VertexBuffer11.cpp  This change moves VertexBuffer11::storeVertexAttributes()'s call to Map() outside a for-loop eliminating unnecessary calls to Map(). Since Map() is a relatively expensive operation (even when using NO_OVERWRITE) this change gives a noticeable performance boost in some scenarios.  Change-Id: I320111b32f2bb9eed92efbd240206e12aaa9964e Reviewed-on: https://chromium-review.googlesource.com/240181 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Merge all gl::Texture* classes.  The validation for sampler completeness had a lot of duplicated code. The special cases have been merged into the base class by checking mTarget.  BUG=angle:681  Change-Id: I11d94c1432f8fc70a1edaaf8228bbc43c3c8fff3 Reviewed-on: https://chromium-review.googlesource.com/236932 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix Linux build and update BUILD.gn.  Re-re-land with fixes for Linux and Android.  We were getting multiply defined symbol errors on Linux for some stuff in the common sources. Switch to using a static lib target for the common sources and also sync BUILD.gn with the latest gyp.  BUG=angle:773  Change-Id: Ia2d52978a167c532e5e76cb711de589855eff44e Reviewed-on: https://chromium-review.googlesource.com/240553 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use emmintrin.h for SSE includes.  This header should work on all available platforms instead of the platform-specific intrin.h or x86intrin.h.  BUG=angle:773  Change-Id: Ia012053064838f9893aa647d872e136a47cfad1a Reviewed-on: https://chromium-review.googlesource.com/240552 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fixed WinRT ARM build break.  ARM cannot use SSE.  Change-Id: I9a55d37db148f82b255e2c7ff414e79259e2c4e1 Reviewed-on: https://chromium-review.googlesource.com/240476 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Split the flush and finish commands into separate methods.  Improves the readability of the implementations and more closely mirrors the GL commands.  Change-Id: Ifa7bc55751d50271eb01fd87e4efdc69f00c2c48 Reviewed-on: https://chromium-review.googlesource.com/239845 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move egl texture binding to the base texture class.  It's still only valid to bind a 2D texture but the validation layer verifies that.  BUG=angle:681  Change-Id: I744dc32f9bd0f69b1e1235b8feef7e796167d033 Reviewed-on: https://chromium-review.googlesource.com/236931 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove references to the Image class from gl::Texture and rx::TextureImpl.  BUG=angle:681  Change-Id: I83659f47cbe9f22ff5ad0cf54471544bd14775aa Reviewed-on: https://chromium-review.googlesource.com/236690 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor Texture to track image information for size and format queries.  BUG=angle:681  Change-Id: Ifb3f52d6348e4479181e66f1c39578f49e9dcf76 Reviewed-on: https://chromium-review.googlesource.com/235613 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add Gregoire to CONTRIBUTORS.  Change-Id: I3e2a1f627de891c13964501f78314f84794cbded Reviewed-on: https://chromium-review.googlesource.com/240422 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Clean up BuiltInFunctionEmulator public interface  This removes all language-specific bits from BuiltInFunctionEmulator parent class and makes the public interface of BuiltInFunctionEmulator minimal.  Writing comments around emulated function definitions is removed from OutputHLSL they are not necessary as the emulated function definitions are just another part of the shader header.  Change-Id: I9abf57d86f4e37b0674d7dfafe653298f205dd27 Reviewed-on: https://chromium-review.googlesource.com/240230 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Implement simple ESSL3 matrix functions  Add support for built-in functions outerProduct determinant transpose and the variations of matrixCompMult that were previously unsupported.  BUG=angle:859  Change-Id: Ie2b9cf83cd80c5a886c6d4eb190c7ce25a32d0a4 Reviewed-on: https://chromium-review.googlesource.com/239873 Reviewed-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Use BuiltInFunctionEmulatorHLSL for all emulated functions  Implementation of missing built-in functions is a separate concern from outputting the intermediate tree itself as HLSL so it makes sense to have all of the built-in emulation in a class that is separate from OutputHLSL. Being able to reuse the same logic for different emulated functions also makes the code more compact.  Change-Id: Id503dc3a5c5e743ec65722add56d6ba216a03a7f Reviewed-on: https://chromium-review.googlesource.com/239872 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix null check after addUnaryMath is called for a built-in function  The intermTypedNode pointer null check should be done before the pointer is used not after. In practice the pointer should never be null if IntermUnary::promote() is consistent with the built-in function table but it's useful to have the null check as a fail-safe when developing.  Change-Id: I24e0d7399ef9d628f474e99fbca08dbd67fdd8c3 Reviewed-on: https://chromium-review.googlesource.com/240411 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Fix Linux build and update BUILD.gn."  Still more build failures different ones this time.  This reverts commit 9f8a57c6419f64965fd97fcc0df8e138677febaf.  Change-Id: I7bea8e24403d92ca4ecb2ee0f24f9e065db5366d Reviewed-on: https://chromium-review.googlesource.com/240550 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix Linux build and update BUILD.gn.  Re-land with fixes for Android.  We were getting multiply defined symbol errors on Linux for some stuff in the common sources. Switch to using a static lib target for the common sources and also sync BUILD.gn with the latest gyp.  BUG=angle:773  Change-Id: Id3edecc633b1c4be205558137c91baf87f256156 Reviewed-on: https://chromium-review.googlesource.com/240145 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move the block layout code to translator.  This code is easily accessible from the translator with the proper export calls. This facilitates adding a common static library since this code calls some methods in translator.  BUG=angle:773  Change-Id: I0c50098ec3f67c2df7749b3c2518be0a9fd939e2 Reviewed-on: https://chromium-review.googlesource.com/240093 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement support for ES 3.0 instanced arrays  BUG=angle:863  Change-Id: I3918c478b33b26b2b179a7f8dd6e4210ecb0cf5c Reviewed-on: https://chromium-review.googlesource.com/239170 Tested-by: Gregoire Payen de La Garanderie <Gregory.Payen@imgtec.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add more options to translator sample  Adds precision emulation and WebGL 2 and GLES3 specs as options. The example command line is also fixed.  Change-Id: Ia45eca1815724a63b26662ee0cadecf9dfea51f9 Reviewed-on: https://chromium-review.googlesource.com/236793 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Refactor defining emulated functions in BuiltInFunctionEmulator  This removes the fixed enumeration of emulated functions in favor of a dynamic map. This makes the code more compact and flexible. The main benefit is that maintaining the list emulated functions is a lot simpler now.  Change-Id: Ic9951a496b9f021c76ad5b4c3daccd89af5ac093 Reviewed-on: https://chromium-review.googlesource.com/239871 Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Don't use SSE functions on Android.  These methods are unavailable on ARM platforms.  Also fix a sequencing bug that caused us to incorrectly define the Android platform as Linux.  BUG=angle:773  Change-Id: Id2b47acdd5b574c618ac86641a1a8238fbb4a2c3 Reviewed-on: https://chromium-review.googlesource.com/240095 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't use std::is_fundamental on Android.  This method is unavailable due to being c++11.  BUG=angle:773  Change-Id: I995e03c26b5d3103fab963d8fb1eddc5050cf5b5 Reviewed-on: https://chromium-review.googlesource.com/240096 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Avoid using std::map::at.  This c++11 method call is unavailable on Android.  BUG=angle:773  Change-Id: I08064c3f18e387a2ed2496a3fb2912486546843f Reviewed-on: https://chromium-review.googlesource.com/240094 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Adds microbenchmark for resizing vs. creating new textures  Change-Id: I21a20250492b6b19181386890afd5e1a911ee055 Reviewed-on: https://chromium-review.googlesource.com/240091 Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Adds a sample to demonstrate TRIANGLE_FAN vs TRIANGLES performance.  Change-Id: Ic8f3d3e66904638cfdeab71aa6c19188f2a1b286 Reviewed-on: https://chromium-review.googlesource.com/238520 Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Allow zero output variable ES3 shaders.  We were assuming at least one variable when some shaders could legitimately use zero. This was causing assertions in the dEQP shader.function tests.  BUG=angle:855  Change-Id: I7e4aa52a1c6ba98d4a396f4c642816ff95115fd5 Reviewed-on: https://chromium-review.googlesource.com/240144 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Implement hyperbolic function support for ESSL 3.00  Emulating arc hyperbolic functions is required on HLSL where they do not exist natively. For this BuiltInFunctionEmulator is split into GLSL and HLSL subclasses. The GLSL subclass handles the pre-existing built-in emulation implemented for working around OSX bugs and the HLSL subclass handles emulating asinh acosh and atanh on HLSL.  BUG=angle:855  Change-Id: I0dfeffb862ac27ba7f9ecf5492ec31d9d952b273 Reviewed-on: https://chromium-review.googlesource.com/236861 Reviewed-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix "start" vertex being applied for instanced buffers.  In GLES the start vertex only applies to non-instanced vertex attributes.  BUG=angle:864 BUG=447140  Change-Id: Idd2afbfbd4c2e76e06b2704cc002fae26b353109 Reviewed-on: https://chromium-review.googlesource.com/239843 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update WebGL expecations.  Change-Id: Ic318a929f43a48f0e957add5fab4bc3362be47b0 Reviewed-on: https://chromium-review.googlesource.com/239954 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Fix Linux build and update BUILD.gn."  This reverts commit ed409f938b4fd8db89d8551d2bf7fc6a6b9ad9b7.  Change-Id: I208a2c43c73e99ae95988c6d81ed64691bd8a99f Reviewed-on: https://chromium-review.googlesource.com/239900 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix signed/unsigned missmatch on 32-bit builds.  BUG=angle:681  Change-Id: I6144359acd1611a13b0a582d3a31019138bb941c Reviewed-on: https://chromium-review.googlesource.com/239844 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix Linux build and update BUILD.gn.  We were getting multiply defined symbol errors on Linux for some stuff in the common sources. Switch to using a static lib target for the common sources and also sync BUILD.gn with the latest gyp.  BUG=angle:773  Change-Id: I212284cfa90cd117a784a5f17057f47dd08900d1 Reviewed-on: https://chromium-review.googlesource.com/239193 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Merge the Texture set*Image methods and use objects for sizes and offsets.  BUG=angle:681  Change-Id: If2e981c522ca5ba3eab4484594cb41aa23800ec4 Reviewed-on: https://chromium-review.googlesource.com/236261 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use typed tests for the gles conformance tests.  BUG=angle:497  Change-Id: I396411cc7c07047ef2fab70605de39287aaea879 Reviewed-on: https://chromium-review.googlesource.com/239515 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fixed WinRT compilation to use non static C runtime because of Windows Store requirements.  Change-Id: I310e4909aaa94c90eecd610e6c7cbbde3c19b777 Reviewed-on: https://chromium-review.googlesource.com/238532 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fixed failed compilation for WinRT to use  OutputDebugStringA for non wide strings.  Change-Id: If012660d4b895399fe5e3226dea25a8c7f78c8ac Reviewed-on: https://chromium-review.googlesource.com/239504 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add EGL extensions structs.  BUG=angle:658  Change-Id: Iffb26caf16416313abc114ba779e6311f2c00848 Reviewed-on: https://chromium-review.googlesource.com/234760 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement float-integer conversions for ESSL 3.00  The implementation uses asint asuint and asfloat in the HLSL output.  BUG=angle:865  Change-Id: I6b48298e18c7b3b0bdeac522b375ebc4eab7cf4e Reviewed-on: https://chromium-review.googlesource.com/239520 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix multisample framebuffer validation ASSERT  Change-Id: I1b02ed7209f30549c17f46aeb3726ba1254df3ea Reviewed-on: https://chromium-review.googlesource.com/239270 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Disable some extensions on D3D11 Feature Level 9_3 which aren't supported  BUG=angle:858  Change-Id: Ib2b2b2b54ba25654ea80b5cb1c59b74ed0379b68 Reviewed-on: https://chromium-review.googlesource.com/239271 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Disable shared texture support on D3D11 FL9_3  BUG=angle:858  Change-Id: I0fe3baf811d561584f7d24f6da665c6934e32b2a Reviewed-on: https://chromium-review.googlesource.com/239272 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove an unused mRenderer member from Program and initialize TF members.  BUG=angle:731  Change-Id: Ie11c80ce1f3a8c3d08145dfb4a075ac0e022ae38 Reviewed-on: https://chromium-review.googlesource.com/239218 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a test for rendering to cube map faces.  BUG=angle:849  Change-Id: I9986e45256da6f4cdbd375dad95037464fbcf299 Reviewed-on: https://chromium-review.googlesource.com/239219 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Print ERR() errors to the debug output on Windows.  We can switch this on for Debug only. This will help developers catch bugs more easily and will only show up for internal errors and major performance caveats. Currently it's far too easy to miss these messages - it requires manually modifying debug.h looking at a text file and potentially also running Chromium with an special flag.  BUG=angle:663  Change-Id: I75b3bd05fbc75d21607b9957134db8e8990c77b1 Reviewed-on: https://chromium-review.googlesource.com/239191 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Allow the special format BGR5_A1 in CopyTexImage.  We use this format as a backbuffer texture for the EGL surface in some configs. Thus the app needs to be able to use it since they don't know when they are secretly using BGRA instead of RGBA similar to our existing logic which allows BGRA in CopyTexImage.  BUG=angle:811  Change-Id: I3748d38b3b085aa4ccaae67ce88711b13eb2c98e Reviewed-on: https://chromium-review.googlesource.com/239192 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use gl::Data as a parameter to Texture::isSamplerComplete.  BUG=angle:861  Change-Id: I3fadf954e6d28dd82e361ceac4ba1967dbd7e8bf Reviewed-on: https://chromium-review.googlesource.com/235612 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove all uses of "actual" formats.  BUG=angle:861  Change-Id: I7cd2d1a56772fdf18bcf926456399322d13e7a4f Reviewed-on: https://chromium-review.googlesource.com/236305 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add missing test files to angle_end2end_tests_sources.  Change-Id: I97217f4b4f42d9b9811185706587e2eb55270888 Reviewed-on: https://chromium-review.googlesource.com/239226 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix missing "!" in cube map render target serial check.  BUG=angle:849  Change-Id: I9e4cb31bdc82a1c556908571355387a9698c7528 Reviewed-on: https://chromium-review.googlesource.com/239230 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fixed invalid IsWindow( ) call for WinRT Windows Store applications.  Change-Id: Ic5f2aca0100a842be193cec9e89872187742f2c6 Reviewed-on: https://chromium-review.googlesource.com/238821 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Avoid using std::unordered_map on OSX.  This c++11 standard library class isn't available on Chromium/OSX. For now we can replace it with std::map.  BUG=angle:773  Change-Id: I0b8ab0de5192a23408755d03df2b9f738f28d762 Reviewed-on: https://chromium-review.googlesource.com/238445 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove "mDeviceLost" member from Renderer9 and Renderer11  These classes has base RendererD3D which already have "mDeviceLost". This can lead to errors because this variable is used in the methods from RendererD3D and his derived classes  Change-Id: Ie0814bd1fd604a2f26693a705d127345ba8f77b5 Reviewed-on: https://chromium-review.googlesource.com/239171 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Unwritten shader output variables should not crash.  BUG=angle:862  Change-Id: I8e7fa9b0d00bb1b2a32a8d60d8ceda998cea8e8c Reviewed-on: https://chromium-review.googlesource.com/239160 Tested-by: Gregoire Payen de La Garanderie <Gregory.Payen@imgtec.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix assertion in D3D11 Feature Level 9_3 instancing implementation  BUG=angle:858  Change-Id: I6197d0f86536cb4613aa1aeb2d73a8173b4e4631 Reviewed-on: https://chromium-review.googlesource.com/238530 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use correct SSE header on OSX.  This fixes the compile errors in loadImageSSE2.cpp.  BUG=angle:773  This reverts commit a93192369eb448e932bcdd1e08ae791aacfbe0c4.  Change-Id: I31bc419cd3930ae129903b935f49a3c9b27fc887 Reviewed-on: https://chromium-review.googlesource.com/238448 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a cross-platform rotl implementation.  The _rotl method is unavailable on any platform but Windows so we can implement the method ourselves.  BUG=angle:773  Change-Id: I1342f4cf8a996daf11a36553c3bf7a01a2b182b3 Reviewed-on: https://chromium-review.googlesource.com/238500 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Ensure all source files end in a newline.  This fixes compile errors on OSX.  BUG=angle:773  Change-Id: I11ce9fd470a54b08656a62afc50586e5d2f987d8 Reviewed-on: https://chromium-review.googlesource.com/238446 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move getData from the D3D to the Impl.  We will need this functionality for index validation so we likely can assume an implemenation will need to support such a call. We might redesign this requirement but for now we can't call though to BufferD3D on OSX.  BUG=angle:773  Change-Id: I16187c78ff62471fdf7221a11b9956560e617a14 Reviewed-on: https://chromium-review.googlesource.com/238450 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix standalone OSX build.  We were missing one warning diable flag for bison compatiblity and were missing the appropriate flag to enable c++11 support.  BUG=angle:773  Change-Id: I717ead6e1726920a6c28559503cb98e94dc29c16 Reviewed-on: https://chromium-review.googlesource.com/238449 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't call std::is_fundamental on OSX.  We can't use this method on OSX due to missing c++11 STL support. Instead use a helper function to replace it.  BUG=angle:773  Change-Id: Iddcd2705792217e6356f51e4bb9dce248d7c3be2 Reviewed-on: https://chromium-review.googlesource.com/238447 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix iterator comparison in Context.cpp.  In deleteTransformFeedback we were using a const iterator in a non-const method. Fix the comparison by using auto which delegates more work to the compiler's static type checking.  BUG=angle:773  Change-Id: Ibc362fe49629331811a5302df1b68269dfa128a6 Reviewed-on: https://chromium-review.googlesource.com/238444 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add OSX cases to EGL headers.  These changes we'll have to upstream at a later time.  BUG=angle:773  Change-Id: I18feb84ae58cb16e3e555c9ab65b6925ba35048e Reviewed-on: https://chromium-review.googlesource.com/238443 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't use std::tuple in IndexRangeCache.  std::tuple currently isn't available on Chromium/OSX.  BUG=angle:773  Change-Id: I9f9efc88dcfe904e98a76df8b04086b88f724424 Reviewed-on: https://chromium-review.googlesource.com/238442 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use #include <stdint.h> instead of <cstdint>.  This fixes the compile on OSX.  BUG=angle:773  Change-Id: I68111e178986bb78b73006a1559ba26120275599 Reviewed-on: https://chromium-review.googlesource.com/238441 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't assume c++11 std::map::erase in invalidateRange.  We were using the c++11 iterator return value from std::map::erase. Instead use the post-increment operator to keep a valid iterator after the call to erase even on older stl.  BUG=angle:773  Change-Id: Ieaa21a2b5a3fcd5ca229a31d40bdf9b8f3283a3c Reviewed-on: https://chromium-review.googlesource.com/238440 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement KHR_create_context.  We need the functionality of this extension to support dEQP. Likely we only needed the minor version enum to not generate an error but we can take the time to implement the few cases for the other enums as well.  We don't support any debug context functionality currently but we may want to support it in the future.  BUG=angle:501  Change-Id: Ib74cd2e4581e054f8153bb358824d9296b9f8a1c Reviewed-on: https://chromium-review.googlesource.com/238083 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Advertise EGL_EXT_platform_base.  We were not advertising the extension though we require it for ANGLE_platform_angle. This was blocking dEQP functionality.  Change-Id: I8781867e772b4b1af62f1387faa863f8ce21de76 Reviewed-on: https://chromium-review.googlesource.com/238082 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Accept no attributes in GetPlatformDisplayEXT.  It is quite valid for the app to pass in NULL for the attribs list. In this case we currently crash. We could trigger this error using dEQP.  Change-Id: I64aba1077f9095bd099c6b60f789ec076cb3d385 Reviewed-on: https://chromium-review.googlesource.com/238081 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Restrict depth buffer formats on D3D11 Feature Level 9_3  *_TYPELESS formats weren't supported in D3D10Level9 until Windows 8. Some Win8 D3D9 drivers don't support them either. To workaround this we avoid _TYPELESS formats on D3D11 FL9_3.  BUG=angle:856 BUG=435726  Change-Id: I280dc7f87e3a2c737c14284ebb744188e7f10616 Reviewed-on: https://chromium-review.googlesource.com/237292 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Emulate large and negative viewports on D3D11 Feature Level 9_3  Like D3D9 D3D11 Feature Level 9_3 doesn't support large or negative viewports. We have to emulate these in the vertex shader.  BUG=angle:858  Change-Id: I2bd53e3921dc3590cc7193164d73596deafca9ea Reviewed-on: https://chromium-review.googlesource.com/236040 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix instancing on D3D11 9_3 by ensuring slot zero contains non-instanced data  D3D11 Feature Level 9_3 supports instancing but slot 0 in the input layout must not be instanced. D3D9 has a similar restriction where stream 0 must not be instanced. This restriction can be worked around by remapping any non-instanced slot to slot 0. This works because HLSL uses shader semantics to match the vertex inputs to the elements in the input layout rather than the slots.  BUG=angle:858  Change-Id: I67b2be9095afc206a4b9f107ed61356820551afe Reviewed-on: https://chromium-review.googlesource.com/237270 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Improve standards conformance of ANGLE's testing code.  ANGLE's testing code recently got enabled in Chromium's builds. While it builds fine with cl.exe it isn't quite standards-conformant and doesn't build with clang. Fix this.  There were three issues:  1. ANGLE_TYPED_TEST_CASE() is a variadic macro that tries to use    __VA_ARGS__ as argument to a variadic template and then pass    that template to another macro. However [cpp.replace] describes    that ANGLE_TYPED_TEST_CASE(Test int float) should be expanded    to TYPED_TEST_CASE(Test ::testing::Types<int float>) which    should be interpreted as a "call" of TYPED_TEST_CASE with the    3 macro arguments `Test` `::testing::Types<int` and `float>`.    As a fix use a typedef for the variadic template and refer to    it through the typedef in the macro call.  2. `#version` was used on its own line in a substitution of the    SHADER_SOURCE macro. [cpp]p1 says that every line starting with    a `#` is a preprocessing directive and [cpp.replace]p11 says    "If there are sequences of preprocessing tokens within the list    of arguments that would otherwise act as preprocessing directives    the behavior is undefined" (with a footnote that this includes    non-directives -- # followed by unknown text). As a fix merge the    `#version` line with the previous line. Now the line doesn't start    with `#` and things are fine.  3. Unqualified lookup usually doesn't look into dependent bases. If    this is desired one usually has to make the call qualified a    good explanation for this is at    http://eli.thegreenplace.net/2012/02/06/dependent-name-lookup-for-c-templates    cl.exe doesn't implement this rule and clang tries to emulate    cl.exe's behavior to a certain extend when in Microsoft mode.    However that seems to not work for member templates with explicit    types (filed http://llvm.org/PR22066 for this but since it's not    needed to parse Microsoft headers and not standards-conformant    I'm not sure if we'll fix that). As a fix don't provide an explicit    type the inferred type is the same. This is also consistent with    all the other tests in this file. (We might clean up -Wmicrosoft    warnings in the future; if so I'll add the explicit this->s that    are missing in this file when we do.)  BUG=chromium:445406  Change-Id: I77a2f3ab9601a1f0f39b56ed3d05217f123155b8 Reviewed-on: https://chromium-review.googlesource.com/238090 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix DisplayD3D not initializing mRenderer.  BUG=angle:658  Change-Id: If865910d52154f574f4d488d4c45fcac9a87b050 Reviewed-on: https://chromium-review.googlesource.com/234761 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add format size information for DXGI_FORMATs.  Change-Id: I14d0b8ebd631e5c9c3c3b63c047c9ef7c11bf310 Reviewed-on: https://chromium-review.googlesource.com/236304 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add format size information for D3DFORMATs.  Change-Id: Id8d884df31726546e871d75a719bc419dd767d6b Reviewed-on: https://chromium-review.googlesource.com/236303 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix a translator crash with index expressions.  This crash happened with certain bad shaders which used temporary values as array (or other) index expresisons.  Fixes the crash covered in the WebGL test "conformance/bugs/undefined-index-should-not-crash"  BUG=angle:857  Change-Id: I13e2ba6d5f1ab0846ac902021bc0b57cbb37d759 Reviewed-on: https://chromium-review.googlesource.com/237460 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Enable conditional InfoLog for HLSL link failures.  We don't always have an InfoLog available for dynamic shaders but we can still capture data in some cases for default shaders.  Change-Id: Iccd022f24d5c2b8922e9254580705675cd4e405f Reviewed-on: https://chromium-review.googlesource.com/237328 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Implement support for the binary operator '%' in the translator.  BUG=angle:854  Change-Id: If116de132dc83d93255749b54c1919a75abcb65c Reviewed-on: https://chromium-review.googlesource.com/236330 Tested-by: Gregoire Payen de La Garanderie <Gregory.Payen@imgtec.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update WebGL expectations.  Change-Id: I69795b97ef032838cd43e889119405aaee66fa4f Reviewed-on: https://chromium-review.googlesource.com/237329 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Disable FL9_3 tests because of Windows 7 failures.  These tests were failing on SwapChain11 with errors relating to the Depth Stencil backbuffer.  BUG=angle:856 BUG=435726  Change-Id: Idd371a380e9b302d7d5e40437e9d76589872b750 Reviewed-on: https://chromium-review.googlesource.com/237450 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Update ANGLE's translator to Bison 3.  BUG=angle:462  Change-Id: I2c1c18027dee1c3b4efb87374caaadbf58367841 Reviewed-on: https://chromium-review.googlesource.com/236930 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Support remaining vertex attrib formats on D3D11 9_3  Change-Id: Id0d3ad6ec7764ed84ec504ad92eca81dff29aac8 Reviewed-on: https://chromium-review.googlesource.com/236043 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Prevent usage of GSSetConstantBuffers on D3D11 Feature Level 9_3  Calling GSSetConstantBuffers with real data causes a device removed error on 9_3. We therefore ensure that ANGLE doesn't call it on 9_3.  Change-Id: I151a74ee7ea81fc4b795d8bf10d5e5c42bfe7c86 Reviewed-on: https://chromium-review.googlesource.com/236042 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactored test targets into angle_unittests and angle_end2end_tests.  angle_unittests subsumes the previous:   angle_compiler_tests   angle_preprocessor_tests and will subsume angle_implementation_unit_tests in a follow-on CL.  angle_end2end_tests subsumes the previous:   angle_tests   angle_standalone_tests   angle_implementation_unit_tests  The bulk of these two targets have been factored into their own .gypi files so that a different main.cpp can be trivially plugged in for the gtest harness. This refactoring has been tested both in ANGLE standalone builds and builds within Chromium.  BUG=chromium:435726  Change-Id: I231a3c1989c17e188cc469dcf80fe78b052afe78 Reviewed-on: https://chromium-review.googlesource.com/236681 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Move blit to the Framebuffer object and Impl.  BUG=angle:841  Change-Id: I482e53a90606d9d6b105c7006234215d51ab1a6b Reviewed-on: https://chromium-review.googlesource.com/232692 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move ReadPixels to the Framebuffer object and Impl.  BUG=angle:841  Change-Id: I71deac9e755b5dfa010596cd1f8a213c24d895bf Reviewed-on: https://chromium-review.googlesource.com/232691 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move Framebuffer clearing from Renderer to the Framebuffer object.  BUG=angle:841  Change-Id: I95c9cbdc2d1c99731e19c48e18117358d22b9e94 Reviewed-on: https://chromium-review.googlesource.com/232690 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix normalized GL_BYTE vertex attributes on D3D11 9_3  Feature Level 9_3 doesn't support as many formats for Input Layouts as 10_0+. On 9_3 we have to make sure that GL vertex attributes are converted into formats that 9_3 supports.  Change-Id: I27b9a85a6eb21a37bd36e60bf011b83fce743fd0 Reviewed-on: https://chromium-review.googlesource.com/234523 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Unify duplicated code for both depth and stencil buffer in ValidateBlitFramebufferParameters()  Tested with angle_*_tests and WebGL CTS in Chrome Canary on Windows. Passed with no regressions.  Change-Id: Ied0a32ea75565ef19b8e87bed8bdd555b74edee3 Reviewed-on: https://chromium-review.googlesource.com/234110 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Dongseong Hwang <dongseong.hwang@intel.com> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Link libANGLE against translator_static.  If there are multiple users of translator.dll then one could ShFinalize and destroy the memory of all the others.  libANGLE needs it's own copies of the global pool allocator to make sure this doesn't happen.  There should be no functional changes for non-component builds.  BUG=angle:823  Change-Id: Id6f7d50e86d8950834399b16a7ab14e6e3198d12 Reviewed-on: https://chromium-review.googlesource.com/234594 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Prevent D3D11 Feature Level 9_3 from sampling from SV_Position in Pixel Shaders  D3D11 FL9_3 like Shader Model 2.0 in D3D9 doesn't support reading from SV_Position in the pixel shader. We have to reconstruct gl_FragCoord using dx_ViewCoords instead.  Change-Id: I7e898038d210d73a9d224dcc18b033e5cd4a56f5 Reviewed-on: https://chromium-review.googlesource.com/234277 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Encapulate the ESSL compiler into a GL object that is per-context.   * Allows for multiple contexts have to have different client versions caps    and extensions without causing shader compilation failures.  BUG=angle:823  Change-Id: I523679e90be031b0b7fa385d46d6839b1cf3029f Reviewed-on: https://chromium-review.googlesource.com/227710 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move some structs and enums from Renderer.h to RendererD3D.h  Change-Id: Ib334d2506031466a73f1a233ee68c1658841a882 Reviewed-on: https://chromium-review.googlesource.com/234720 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove D3D11_BIND_STREAM_OUTPUT usage on D3D11 Feature Level 9_3  Change-Id: Ib9d2d155a6e062488ff5bb5ce578036b6187ca70 Reviewed-on: https://chromium-review.googlesource.com/234276 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
In Clear11 use ID3D11DeviceContext1::ClearView when appropriate  Change-Id: I8d9054b5582cfe78beaff07146adc73b4716eaf9 Reviewed-on: https://chromium-review.googlesource.com/233680 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix cube map rendertargets.  We were using the entire level parameter of the cube map instead of using the helper functions for cube map ImageIndexes which set the layer corresponding to the cube map face.  BUG=angle:849 BUG=440701  Change-Id: Id78db5c8281b6b644392bb961d69a7f869755a34 Reviewed-on: https://chromium-review.googlesource.com/234380 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
On D3D11 Feature Level 9 use IDXGIAdapter2::GetDesc2.  On Feature Level 9_3 GetDesc() returns "Software Adapter" in the hardware description string instead of a description of the actual GPU. As a result glGetString(GL_RENDERER) on 9_3 wouldn't return any useful info about the current hardware.  Change-Id: Ie4d329a08a03ee044fc0b594308aaf0bf235c74e Reviewed-on: https://chromium-review.googlesource.com/233663 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Add basic D3D11 Feature Level 9.3 support  Change-Id: I660c74791ddb9917bd4796bb652eefab2a3e4863 Reviewed-on: https://chromium-review.googlesource.com/233660 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Rename Framebuffer::completeness to checkStatus and add an Impl method.  BUG=angle:841  Change-Id: I04b4ffd086424569a15aa21447dd552e0a898928 Reviewed-on: https://chromium-review.googlesource.com/232394 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add set*Attachment methods to FramebufferImpl.  BUG=angle:841  Change-Id: Ie819c253a900d105d768aee168a6a2de89754ccc Reviewed-on: https://chromium-review.googlesource.com/232393 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update generated D3D shaders.  We neglected to regenerate with our switch to the 8.1 SDK.  Change-Id: Idd67dce1147ad0acec9bf933a0fd01f421c784ef Reviewed-on: https://chromium-review.googlesource.com/233844 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move libEGL to compile on all platforms.  BUG=angle:773  Change-Id: I377c6df9b1f10e2756b7f000099847dc910c965c Reviewed-on: https://chromium-review.googlesource.com/232793 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Allow implementation tests to compile on all platforms.  BUG=angle:773  Change-Id: I9fb56c1d8332b1529460eb3962bae1b756f58e91 Reviewed-on: https://chromium-review.googlesource.com/232791 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Move the Image::copy implementation to ImageD3D.  This method uses rx::RenderTarget which is D3D-only.  BUG=angle:773  Change-Id: I2cb523fa98bda96661260d37a8c69c2ed8e7aa84 Reviewed-on: https://chromium-review.googlesource.com/233441 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move GetAttachmentRenderTarget and GetAttachmentSerial to FramebufferD3D.h.  BUG=angle:841  Change-Id: Ic341239e848f1daf7cf38f233d79a58f221780f4 Reviewed-on: https://chromium-review.googlesource.com/232969 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move some D3D-specific stuff into ProgramD3D.  BUG=angle:773  Change-Id: I48b42e7a3e82a43d3dde16a8d1016d28280eae39 Reviewed-on: https://chromium-review.googlesource.com/232968 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix texture format support queries on AMD-D3D9.  We were allowing calls to the device to check support for D3DFMT_NULL which AMD reports as a usable texture type. This was causing crashes with the WebGL CTS and angle_end2end_tests when the user tries to use an sRGB or other type which we incorrectly reported as available.  BUG=angle:839  Change-Id: I4941baac6a2b14a09c0ad2c924f29189ccfc6a07 Reviewed-on: https://chromium-review.googlesource.com/232728 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Mark the exported entry points as stdcall.  Because they may be returned as stdcall from eglGetProc address the entry point functions must be stdcall.  Fixes issues on 32-bit builds.  BUG=angle:733  Change-Id: Ia20046a67fdc28c702837ec59b8299c6bb722006 Reviewed-on: https://chromium-review.googlesource.com/233471 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Have libGLESv2 compile tls.cpp.  BUG=angle:733  Change-Id: Ief3ddabdc441eb7e46581337a511cec2a90ede48 Reviewed-on: https://chromium-review.googlesource.com/233431 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use the static CRT.  Remove a test that expects a crash it has become flaky.  BUG=angle:733  Change-Id: Ia1d4e0b3dd09fa755f678b97b8deceee3ef0a35b Reviewed-on: https://chromium-review.googlesource.com/232963 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement all entry points in libGLES and have libEGL act as a shim.  This allows libANGLE to only be included in libGLESv2 and moves all TLS data to libGLESv2.dll.  BUG=angle:733  Change-Id: I34f0b47987a5efbe906c290d3ca656142e69ea9a Reviewed-on: https://chromium-review.googlesource.com/232962 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Reject compound assignments of the type scalar op= vector/matrix  scalar op vector/matrix produces a vector/matrix which can't be assigned to a scalar. Handle this correctly for addition subtraction and division. Multiplication was already handled correctly as a special case.  BUG=angle:832 TEST=WebGL conformance tests  Change-Id: I318cae8bf353a5c58c588876ce3f29d18389263c Reviewed-on: https://chromium-review.googlesource.com/232601 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fix double delete with invariant varyings.  The compiler would leave some TString variables lying around after the pool gets released leading to a potential crash.  BUG=angle:846  Change-Id: I484ed9b14bba9bf653f6ed4001ae79f87791b0dd Reviewed-on: https://chromium-review.googlesource.com/232780 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Fix ASSERT not covering full range of drawbuffer counts.  BUG=angle:841  Change-Id: I59cc281e4848572010cbba3d45382a98063e8db2 Reviewed-on: https://chromium-review.googlesource.com/233210 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move Framebuffer invalidation into the impl.  BUG=angle:841  Change-Id: Ibcf58c4f676491f3b2582198c6cf9fd4a7a38b42 Reviewed-on: https://chromium-review.googlesource.com/232392 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Set all the drawbuffer state at once instead of one buffer per call.  BUG=angle:841  Change-Id: I988c7c0cd45317c78b8fd16df8324028ff1cb25d Reviewed-on: https://chromium-review.googlesource.com/232391 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix doubly defined variables in libANGLE and libGLESv2.  We can get by with only including these in libANGLE since libGLESv2 pulls in libANGLE.  BUG=angle:773  Change-Id: Iccbdb968b3c55528e2a7e1dd55f4f1280a70bfe9 Reviewed-on: https://chromium-review.googlesource.com/232967 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Fix event tracer linking on Linux.  We were including the cpp in multiple targets which was causing a multiply defined error.  BUG=angle:773  Change-Id: I1e31756faee2d7734f1fc6cfb086d0e7ec6519bc Reviewed-on: https://chromium-review.googlesource.com/232966 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move native display check to the DisplayImpl.  This fixes another Linux compile error in the EGL layer.  BUG=angle:773  Change-Id: Iba643a72fb7b0d5994fe69e46184256e07aa3aad Reviewed-on: https://chromium-review.googlesource.com/232945 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update WebGL CTS expectations.  Change-Id: I04f232b560dda470d589f8afbe8601d5cf7abeef Reviewed-on: https://chromium-review.googlesource.com/232965 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Skip BlitStencil test on Intel D3D9.  We seem to fail this config. It could be driver bug or other problem in ANGLE. Disable the test until we can find an answer.  BUG=angle:809  Change-Id: I90d773d2047569d71fa8a25c8919a8e46b5676b1 Reviewed-on: https://chromium-review.googlesource.com/232980 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove polymorphism of egl::Display.  This was causing a warning on GCC and is no longer necessary.  BUG=angle:773  Change-Id: I6cb09e79bff9035e3e38966dcad2cc7ba74701a1 Reviewed-on: https://chromium-review.googlesource.com/232944 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Move native window check to the DisplayImpl.  This hides the D3D-specific methods from the EGL side of things.  BUG=angle:773  Change-Id: I5a1c2bbff865e02bc1a07b3295347469ef9792e3 Reviewed-on: https://chromium-review.googlesource.com/232943 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Fix stray ANGLE_EXPORT.  BUG=angle:733  Change-Id: Ia4a84bea483ac11a2326d2402649affe10d661c9 Reviewed-on: https://chromium-review.googlesource.com/232942 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove support for compiling libANGLE as a dynamic library.  BUG=angle:733  Change-Id: Iacef45b89f234091eb5df505437adabece1e564b Reviewed-on: https://chromium-review.googlesource.com/232961 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Rename IsSampler to IsSamplerType.  BUG=angle:733  Change-Id: I62aece16c11aefdbf13c0b5faf83040fdb8555e6 Reviewed-on: https://chromium-review.googlesource.com/232960 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Disable support for shader model 2 in Renderer9.  Change-Id: I2fc6e1b440cbdd72c99971d355637819a13951be Reviewed-on: https://chromium-review.googlesource.com/232091 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Merge some special cases of the default framebuffer into the Framebuffer class.  BUG=angle:841  Change-Id: Id4b5ac38926bc90fa015584d966aaef3a7101849 Reviewed-on: https://chromium-review.googlesource.com/232390 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Only generate shader debug info on Windows.  This was messing up the Linux build with some recent changes.  BUG=angle:773  Change-Id: I9ca201f08ddde0a36224872b2c78d1d666cf458d Reviewed-on: https://chromium-review.googlesource.com/232792 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Improve image update perf by re-using a MemoryBuffer.  Instead of allocating a new MemoryBuffer every frame we can store one scratch buffer in the Renderer and occasionally re-create it to ensure we aren't stuck using the maximum amount of memory.  BUG=angle:842  Change-Id: Id7c1912921ed8f84b151413453c3268d853352db Reviewed-on: https://chromium-review.googlesource.com/230861 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Bruce Dawson <brucedawson@google.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Ignore GCC's always inline warnings in MurmurHash.  These were benign and treated as errors. The always inline attribute may still have some value so I left it in.  BUG=angle:773  Change-Id: I78c5f792485e8f8d890123ee861cfecf2a5649be Reviewed-on: https://chromium-review.googlesource.com/232790 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Move the SystemInfo helpers to Win32 only.  BUG=angle:773  Change-Id: I53938837d925b14d8fc86c94a38d23bb86d82de5 Reviewed-on: https://chromium-review.googlesource.com/232699 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Remove src/libANGLE from default includes.  This is unnecessary and was breaking Linux builds because of a conflict with features.h.  BUG=angle:773  Change-Id: Ic704ac24a0e8f5781f67cadca396bef779495efe Reviewed-on: https://chromium-review.googlesource.com/232698 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Do not use std::strlen.  GCC doesn't use the std:: namespace for these methods.  BUG=angle:773  Change-Id: I0d887f103298cdd184b3f7825c5e44363edb9b92 Reviewed-on: https://chromium-review.googlesource.com/232697 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Make compile optimization level hidden outside D3D.  BUG=angle:773  Change-Id: Ia6f16d2e4644c02d94cf99b73f70d05486886925 Reviewed-on: https://chromium-review.googlesource.com/232696 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Remove unrefed texture validation variables.  These were causing unused variable warnings in Linux GCC builds.  BUG=angle:773  Change-Id: I860d425a1caef07a58f6ff1b6c113ad7b63283dc Reviewed-on: https://chromium-review.googlesource.com/231856 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Add missing cstring include to Uniform.cpp.  This file was missing on GCC builds.  BUG=angle:773  Change-Id: I6222b5ee563d64967d878c422abd464c8c92e646 Reviewed-on: https://chromium-review.googlesource.com/231855 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Use memset to zero out ClearParameters.  Using the C struct initialization syntax was giving errors on Linux.  BUG=angle:773  Change-Id: I298c851df7246eeb1772837c5678f3c578483b63 Reviewed-on: https://chromium-review.googlesource.com/231854 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Remove RendererD3D header from Renderbuffer.cpp.  BUG=angle:773  Change-Id: Idb9f840c0a83550bd9a58c3c4599c65ee916fa3c Reviewed-on: https://chromium-review.googlesource.com/231853 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Remove RemoveAllTreeNodes since it was a no-op  IntermNode operator delete() or any of the IntermNode destructors don't do anything since all the AST memory is allocated on the PoolAllocator. Because of this RemoveAllTreeNodes was simply a no-op and redundant with the PoolAllocator deallocation procedure and could confuse people reading the code to think that IntermNodes should be deleted individually when in fact this is not the case.  BUG=angle:831  Change-Id: Ie1ccaa51986aabf267280d92a8e76ca9f97a19e5 Reviewed-on: https://chromium-review.googlesource.com/230730 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add GLSL/ESSL validator/translator support for GL_EXT_shader_framebuffer_fetch.  BUG=angle:834  Change-Id: I2d4e25909a8e1266b9bb7f1d4421324143157c8a Reviewed-on: https://chromium-review.googlesource.com/231032 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Erik Dahlstrm <ed@opera.com>, 23355681, 619, 169, 619
MANGLE egl::Display.  BUG=angle:794  Change-Id: Id131f3119100030d6ee630e357a8d28396a6a813 Reviewed-on: https://chromium-review.googlesource.com/231852 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Merge the ProgramBinary class into Program.  BUG=angle:731  Change-Id: I2ee97155841dc62f04bb71c1f2035d210fd3883c Reviewed-on: https://chromium-review.googlesource.com/232694 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Merge the ProgramBinary class into Program."  Issues appeared on the FYI waterfall content_gl_tests hangs.  This reverts commit 2195a6d6032883ed05468d5ecd019e7cb9a27bce.  Change-Id: I9fe1a53cf40887ae5a98fd77b4872f41085fcea7 Reviewed-on: https://chromium-review.googlesource.com/232386 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Merge the ProgramBinary class into Program.  BUG=angle:731  Change-Id: Ia0a356c0684f3a3576c71dfd04b00874318dd084 Reviewed-on: https://chromium-review.googlesource.com/228701 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Create stubs for the FramebufferImpl class.  BUG=angle:841  Change-Id: I089409981604abe9c65c3019765d8d9eeffe38f5 Reviewed-on: https://chromium-review.googlesource.com/232381 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove Display::recreateSwapChains.  This method was unused and dead code.  BUG=angle:794  Change-Id: I1348f5ffc62ff57f3c6503c6842cc68bcbefb550 Reviewed-on: https://chromium-review.googlesource.com/231851 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Fix override keyword in Renderer9.h.  BUG=angle:773  Change-Id: I1d69b79ed8f85a2e9238cee1ffada11ee362cffb Reviewed-on: https://chromium-review.googlesource.com/232395 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Clean up Adapter LUID queries.  We might need to revisit this when we implement other GL back-ends.  BUG=angle:773  Change-Id: I6e742254bd0df8cc899ea02a523992b4d66dfd68 Reviewed-on: https://chromium-review.googlesource.com/229061 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Support compiling libANGLE as a static or shared library.  BUG=angle:733  Change-Id: If27d3330534bce0f5b691010ea7d97bcb7579122 Reviewed-on: https://chromium-review.googlesource.com/231052 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make some FramebufferAttachment methods const.  BUG=angle:841  Change-Id: I4670e417c1976ebd2198ea4c8927a00fff7bb15c Reviewed-on: https://chromium-review.googlesource.com/232380 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make getAdapterIdentifier D3D-only.  We only use this Renderer method in ProgramD3D so we can hide it from the GL-side API.  BUG=angle:773  Change-Id: I7a8092a7e3bceb1498f4e4022f84486e0295759d Reviewed-on: https://chromium-review.googlesource.com/229060 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Do not check format caps for D3DFMT_NULL."  Seems to be causing problems on the AMD Release GPU FYI bot.  http://build.chromium.org/p/chromium.gpu.fyi/builders/Win7%20Release%20%28ATI%29/builds/6378  This reverts commit 533f0a1d6a9510c3380dc791457883274fbdc997.  Change-Id: I94ae0f72303ad5bc6e84e56c35a683d01844309a Reviewed-on: https://chromium-review.googlesource.com/232192 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
MANGLE egl::Surface.  This class has its fingers in a lot of other classes. In particular we will likely need to revisit the context lost handling methods when we implement the robustness extensions on top of desktop GL. For now we can leave them tied pretty tightly to the D3D implementation.  BUG=angle:795  Change-Id: I9b3ac90dfd393f52c5b49bc2bd6b97fb5536ed91 Reviewed-on: https://chromium-review.googlesource.com/228916 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Do not check format caps for D3DFMT_NULL.  On AMD systems the driver was reporting these textures as usable. This was causing crashes in the sRGB extension tests.  BUG=angle:839  Change-Id: I8e9924ed44f82a2a6bc891d1df76c0f9a19084ad Reviewed-on: https://chromium-review.googlesource.com/232062 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add Fence implementation tests back to project.  Somehow they had been neglected.  Change-Id: Ibe8b063758be8e99978fdd2723192be7bcea6d04 Reviewed-on: https://chromium-review.googlesource.com/232220 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update WebGL expected failures.  Change-Id: I8d90f9189340b6a8f8535bab595fd1e8f65fe9ff Reviewed-on: https://chromium-review.googlesource.com/231965 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Optimize LoadL8ToRGBA8.  We can save some work by re-using the color value in a temporary.  BUG=angle:842  Change-Id: Ib64b34ca7bc77c73368e159527ad84419079f958 Reviewed-on: https://chromium-review.googlesource.com/231997 Reviewed-by: Bruce Dawson <brucedawson@google.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Disable EXT_depth_textures on AMD D3D9 devices.  BUG=angle:839  Change-Id: Ia8c24db98a31141994e22b25efbdfddaa4eced49 Reviewed-on: https://chromium-review.googlesource.com/231996 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix error in dumping direct struct indexes.  The parser would become confused over the purported array size of struct indexes. In reality they were always a single direct index into a struct but it would take the object size of the represented type (EG a vec4 would have size 4) and deference out-of-bounds memory.  BUG=434033  Change-Id: I92349aa04e6faadc766cb28c04e28d5f19c4e1ec Reviewed-on: https://chromium-review.googlesource.com/230530 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Remove the libGLESv2_static target.  BUG=angle:733  Change-Id: Ia33a67d8422c6c31a1f07f2a8778537e023b2dd2 Reviewed-on: https://chromium-review.googlesource.com/230781 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add mediump and lowp precision emulation support for GLSL output  This implements the rounding as specified in WEBGL_debug_shader_precision extension proposal for desktop GLSL and ESSL output. The bulk of the new functionality is added in the form of a new EmulatePrecision AST traverser which inserts calls to the rounding routines angle_frm and angle_frl in the appropriate places and writes the rounding routines themselves to the shader.  Compound assignments which are subject to emulation are transformed from "x op= y" to "angle_compound_op_frm(x y)" a call to a function which does the appropriate rounding and places the result of the operation to x.  The angle_ prefixed names should not clash with user-defined names if name hashing is on. If name hashing is not on the precision emulation can only be used if the angle_ prefix is reserved for use by ANGLE.  To support the rounding routines in output a new operator type is added for internal helper function calls which are not subject to name hashing.  In ESSL output all variables are forced to highp when precision emulation is on to ensure consistency with how precision emulation performs on desktop.  Comprehensive tests for the added code generation are included.  BUG=angle:787  Change-Id: I0d0ad9327888f803a32e79b64b08763c654c913b Reviewed-on: https://chromium-review.googlesource.com/229631 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Add querySurfacePointerANGLE method to Surface.  This method will more closely match the desktop GL implementation.  BUG=angle:795  Change-Id: I796b46bb6e8e895dad8d9824e8405edcc12e8a4f Reviewed-on: https://chromium-review.googlesource.com/228915 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use cross-platform enum for Vendor ID.  BUG=angle:795  Change-Id: Ibe9bbb79b92730ba80ca7275528c8b61d5d44c59 Reviewed-on: https://chromium-review.googlesource.com/228914 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move as many files as possible from common to libANGLE.  BUG=angle:733  Change-Id: If01c91cd52ac5c2102276a9fdc4b68ebc13e47f9 Reviewed-on: https://chromium-review.googlesource.com/231850 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use EGLClientBuffer in place of HANDLE in EGL.  BUG=angle:795  Change-Id: I7af47e9306e0e12b980cfd3f061bbbe0951ac4e4 Reviewed-on: https://chromium-review.googlesource.com/228913 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Move as many files as possible from common to libANGLE."  Chromium directly includes our common/version.h and couldn't build after this change.  This reverts commit f0a2c7727f9863c38a435a16a69d513c481fbbdd.  Change-Id: Iafc41b1a3973f609518fe3588fdb64cecc285332 Reviewed-on: https://chromium-review.googlesource.com/231840 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move as many files as possible from common to libANGLE.  BUG=angle:733  Change-Id: I40cee6e2e305ac493acbc8649f858785c0569aed Reviewed-on: https://chromium-review.googlesource.com/231051 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "In Clear11 use ID3D11DeviceContext1::ClearView when appropriate"  Causing failures on GPU Windows bots  This reverts commit 3b23162968cdb7fb76aef74e979d8ea1fd256a8d.  Change-Id: Ie1806db36b13f8b03dc1a1ae10f237260c99de7b Reviewed-on: https://chromium-review.googlesource.com/231701 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix handling of shader source with fixed length.  BUG=angle:837  Change-Id: Ie9c3059ad2973b0733be92b7548525ee694bb1fa Reviewed-on: https://chromium-review.googlesource.com/231612 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
In Clear11 use ID3D11DeviceContext1::ClearView when appropriate  Change-Id: I81fe722973aa3c89ea03501543ab74d92e26b02b Reviewed-on: https://chromium-review.googlesource.com/228620 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix include guards.  BUG=angle:733  Change-Id: I08b2c11c4831f1161c178c1842b10e807185aced Reviewed-on: https://chromium-review.googlesource.com/230831 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make device lost flag a RendererD3D member.  This flag we used in both D3D renderers and hence we can move it to the base class to share a bit of common code.  BUG=angle:795  Change-Id: I8bd60796bfeb9590bdf798f9d044f8e20c7ad779 Reviewed-on: https://chromium-review.googlesource.com/228912 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove notify parameter from testDeviceLost.  We can get rid of this parameter now that we call notify directly on the display in cases where we need to.  BUG=angle:795  Change-Id: I2024b70d0d725e755f7aa742ba221c2d0179d8b6 Reviewed-on: https://chromium-review.googlesource.com/228911 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Do not use notify feature of testDeviceLost.  This is part one of a simplification of testDeviceLost. This patch changes the instances where we would use the notify parameter to notify the Display directly. We can do this by using the Display attached to the Renderer in some cases.  BUG=angle:795  Change-Id: I24fd827989d47b0b2cefef7afb99fa62581ddc1b Reviewed-on: https://chromium-review.googlesource.com/228910 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fixed Mac and Linux build breakage.  Introduced in 1edac3b1bdcc54a4b0f0449cb727bda84ab3ee53 .  BUG=none  Change-Id: Ia5c5e38b794e9c991ec8624de34681dcf13a651f Reviewed-on: https://chromium-review.googlesource.com/231441 Tested-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Rename and slightly reorganize test targets.  Use "angle_" prefix for all targets to disambiguate them from any potential Chromium-side targets.  Combine compiler and preprocessor tests into angle_compiler_tests. (Chromium's "angle_unittests" target contains both.) Deleted preprocessor_test_main.cpp.  BUG=angleproject:833  Change-Id: I7acc5a76f49c15d0064c16d2ace256f9cc86e9e8 Reviewed-on: https://chromium-review.googlesource.com/231185 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Fixed Visual Studio 2013 Update 4 build failures for WinRT  Change-Id: I393e9800d1c2e902f60728e1f7d0debca66b76a0 Reviewed-on: https://chromium-review.googlesource.com/231140 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update the README to match the one on the google code page.  Change-Id: I05b61d9a7c80a6e53df1b12a99b0c107b570496c Reviewed-on: https://chromium-review.googlesource.com/231223 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update the DISALLOW_COPY_AND_ASSIGN macro to use c++ operator deletion.  Also remove the TSymbol copy constructor which is not used.  BUG=angle:836  Change-Id: I4f35f554c90d01dc2132d244a1974d9a8dc89bbd Reviewed-on: https://chromium-review.googlesource.com/231231 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix releasing textures after we kill D3D11.  This bug was crashing the IncompleteTextureTest in Release mode. Fix this by releasing the textures before we free the D3D11 libraries.  BUG=angle:838  Change-Id: I771e4cc6876e3529c5d26f36711dea9181e631f0 Reviewed-on: https://chromium-review.googlesource.com/231247 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Merge libGLESv2 and libEGL classes into libANGLE.  BUG=angle:733  Change-Id: Ic491c971411fe82c56cd97c5c8325ac14ec218df Reviewed-on: https://chromium-review.googlesource.com/230830 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Disallow copying of the MemoryBuffer class.  BUG=angle:836  Change-Id: Ie3f674ef6c321770209a37b1af06ea21d788f476 Reviewed-on: https://chromium-review.googlesource.com/231232 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix leaked ID3D11Resource object.  BUG=427245  Change-Id: If4833df5dc405a2a8d87a577bbd47b954613e321 Reviewed-on: https://chromium-review.googlesource.com/231246 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor gmock and gtest dependencies for ANGLE's tests.  This change allows these targets to be referenced from Chromium's build projects.  BUG=angleproject:833  Change-Id: I14694f610921d28ddcd8664887086ca30375b7a2 Reviewed-on: https://chromium-review.googlesource.com/231072 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Fix bugs in 2D Array Texture support.  This fixes assertion failures and other errors reproducible by running the dEQP Texture Format tests.  BUG=angle:813  Change-Id: I3b97f89323f9656b45f617211fb4579a24013951 Reviewed-on: https://chromium-review.googlesource.com/229351 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix failure initting 2D Array textures.  Our code currently failed in retrieving a NULL Image internally when we relied on getting texture dimensions on an unitialized texture.  BUG=angle:813  Change-Id: Iaf6791ee291e45daae9c80d6452c4d9154227fdb Reviewed-on: https://chromium-review.googlesource.com/229350 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Adds a file to track known failures in the WebGL CTS  Because ANGLE does not have a framework for testing directly against the WebGL CTS we're unable to suppress failing tests at runtime. Instead we'll document them in the repository for the reference of contributors.  Change-Id: Ieea68a9aaa0b7bfebda2900265e3c4a857a0ce64 Reviewed-on: https://chromium-review.googlesource.com/230582 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Trivial change to allow translator to be compiled via Emscripten.  BUG=none  Change-Id: Ifdb02d4b7c061f403f50d2e1fbea4ab117462475 Reviewed-on: https://chromium-review.googlesource.com/230813 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Remove pre-generated projects.  BUG=angle:829  Change-Id: I220ffb0929cf20f2834e7e0ea163105b45a9e03b Reviewed-on: https://chromium-review.googlesource.com/229065 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove includes of libGLESv2/main.h.  It was mostly being included for gl::error or the debug.h include.  BUG=angle:733  Change-Id: If40d511c5422ac9265fbd809f647a91bcc802d41 Reviewed-on: https://chromium-review.googlesource.com/230551 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove includes of libEGL/main.h.  It was mostly being included for querying the current state and EGL includes.  BUG=angle:733  Change-Id: Ia985dbc9de5739f6ea7fa5bb6eb2e187cc1d60f3 Reviewed-on: https://chromium-review.googlesource.com/230780 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Create a DefaultAttachment type and an implementation for it.  This allows for dynamically sized default attachments instead of calling Context::makeCurrent each time the surface changes size.  BUG=angle:824  Change-Id: Ic39c0d7dc4269db53a34c01c4d915cb1a3cfbd08 Reviewed-on: https://chromium-review.googlesource.com/228180 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix memory leak when default framebuffer has 0 depth bits and 0 stencil bits  Change-Id: If9dbcfc7eac3295b2523dd41dc87198d1b1e2d76 Reviewed-on: https://chromium-review.googlesource.com/229022 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
Limit D3D11 Feature Level 9 to GL ES 2.0 and say it's not conformant  Change-Id: I2ce88217c9b78e83bac6df5975d9edfbbf90e557 Reviewed-on: https://chromium-review.googlesource.com/225251 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Change the component type of STENCIL_INDEX8 to UNSIGNED_NORMALIZED  That way RenderbufferStorageMultisample accepts STENCIL_INDEX8 as an internal format for a multisampled buffer (samples > 0) as it isn't concerned by the restriction on integer component types anymore. This is consistent with the component type returned by the NVIDIA driver.  BUG=angle:812  Change-Id: Ic03f502ffa082b1011e8127213a5c1df0617ef43 Reviewed-on: https://chromium-review.googlesource.com/227470 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Copy the D3D compiler dll in the GN build.  Change-Id: I773a411d07991d9ae160267eba8325c327146554 Reviewed-on: https://chromium-review.googlesource.com/229007 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: John Abd-El-Malek <jam@chromium.org>, 23355681, 619, 169, 619
Unset SRVs which resource are being bound to an RTV  This is the extension of a previously debug-only workaround for D3D doing the unsetting by itself (with a warning). It made our state tracking of the bound SRVs out of sync with D3D's and caused some rendering to not take place.  BUG=427245  Change-Id: Id378030b64fddafbb3d406872a7dfd2c84793221 Reviewed-on: https://chromium-review.googlesource.com/229066 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Revert "Revert "Switch to 8.1 SDK and d3dcompiler_47.dll""  This reverts commit 3cbdc34d4e90f6b51d5612e6f1d3ae632da47234.  This reverts back to using 8.1 and d3dcompiler_47 as chrome is now rolled forward.  Change-Id: I7ef4ebdbc32146b9ba6f551e376ac03ac71131ba Reviewed-on: https://chromium-review.googlesource.com/229990 Reviewed-by: John Abd-El-Malek <jam@chromium.org> Reviewed-by: Scott Graham <scottmg@chromium.org> Commit-Queue: Scott Graham <scottmg@chromium.org> Tested-by: Scott Graham <scottmg@chromium.org>, 23355681, 619, 169, 619
Revert "Switch to 8.1 SDK and d3dcompiler_47.dll"  This reverts commit e1425d95ba0ab095c5d64536bbeb3f78adcbf79f.  This is to keep the GPU fyi bots green until the chrome side is landed. Chrome will be rolling to e1425d95...  Change-Id: Iff1c60eeb7143fb72afa8525b31f8f0de9385897 Reviewed-on: https://chromium-review.googlesource.com/229497 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Switch to 8.1 SDK and d3dcompiler_47.dll  Change-Id: If43c7861ab7f47448fd726fd0b5c35f3a6eeb362 Reviewed-on: https://chromium-review.googlesource.com/229616 Commit-Queue: Scott Graham <scottmg@chromium.org> Tested-by: Scott Graham <scottmg@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Added Trim support for Windows Store application certification requirement  Change-Id: Iff58863bf4af756d77521aadb1ccbaa977f0b78a Reviewed-on: https://chromium-review.googlesource.com/227530 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix precision tracking of constructor return values  Precision should be set for constructor return values if they are of a built-in type. Structs should not be precision qualified.  BUG=angle:787  Change-Id: Ie5efd5be25a788ff6f01c5b989254572c00231eb Reviewed-on: https://chromium-review.googlesource.com/229560 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Remove redundant rx:: scoping prefixes.  In many places we can get rid of this scoping operator.  BUG=angle:789  Change-Id: If6c40c435a97473d2fd9d6f1fb5a2c709393eb00 Reviewed-on: https://chromium-review.googlesource.com/225566 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove the unused Renderer client version methods.  Previous patches enable us to get rid of this workaround. We should in subsequent patches also try to clean up code that uses the internal Renderer-only version of the context caps.  BUG=angle:789  Change-Id: Ic054090303cdc3f7ee8e45e4577c157559955472 Reviewed-on: https://chromium-review.googlesource.com/227714 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Pass GL context data into shader creation.  This allows us to remove the hack where we store the current GL client version in the Renderer.  BUG=angle:789  Change-Id: I6526f11eaa922325a9a41df0df48b2152e022e26 Reviewed-on: https://chromium-review.googlesource.com/227713 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use the [[flatten]] attribute only when a loop is present.  Flattening branch-heavy shaders that contained no loops caused regressions. As a temporary workaround we only flatten ifs when there exists a loop.  BUG=395048  Change-Id: I95c40f0249643b98c62304a0f2a4563561d1fbbc Reviewed-on: https://chromium-review.googlesource.com/228722 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Corentin Wallez <cwallez@chromium.org>, 23355681, 619, 169, 619
Fix ProgramBinary being disabled when it should be enabled.  Change-Id: I6a21bca32ae5bf1e0e638c0cf46102bd964cd066 Reviewed-on: https://chromium-review.googlesource.com/229064 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor Framebuffer attachment application.  Instead of passing texture and renderbufer IDs which requires a call to gl::getNonLostContext to resolve the objects pass the Texture and Renderbuffer objects directly.  BUG=angleproject:733  Change-Id: Ia500a781643e43a17c8e9cea9f95847a7ff7b25d Reviewed-on: https://chromium-review.googlesource.com/228280 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Pass GL caps and version to compiler.  This allows us to get rid of some of the reliance on storing the current context client version in the Renderer. A subsequent patch will allow us to remove the client version ugly hack.  BUG=angle:789  Change-Id: I139e0f66e1d39e5cd41a484c841a7101b1f29540 Reviewed-on: https://chromium-review.googlesource.com/227712 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move the Context ReadPixels logic into RendererD3D.  BUG=angle:789  Change-Id: I0a678f8fe31a3e7ddd9a675a0e3cb0342299b0e3 Reviewed-on: https://chromium-review.googlesource.com/226064 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move BlitFramebuffer logic into RendererD3D.  BUG=angle:789  Change-Id: Ib3f830ba2f915a5fa4fa552dccc13c24575aa843 Reviewed-on: https://chromium-review.googlesource.com/226063 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Split the RenderTarget classes based on if they are backing a SwapChain.  bug=angle:824  Change-Id: I89e475d4065102dbaa7fa1f1bfd02c7207def75c Reviewed-on: https://chromium-review.googlesource.com/227600 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix compilation failure with Visual Studio 14.  Change-Id: If009cec928318c90a2f6d445ea8b4b06c4e45209 Reviewed-on: https://chromium-review.googlesource.com/228919 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Pass 0 for the sample count to RenderTarget when there is no multisampling.  BUG=angle:520  Change-Id: Idc9a19ece620d107b87110dac8e1ef7a24f565cc Reviewed-on: https://chromium-review.googlesource.com/228551 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move Clear logic into RendererD3D.  BUG=angle:789  Change-Id: I56d4398e4c49fe980f649327b105cdba9d944a00 Reviewed-on: https://chromium-review.googlesource.com/226062 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Move Context draw call logic into RendererD3D.  Also move a lot of supporting code.  BUG=angle:789  Change-Id: I098bf7d072ece1f414605783c32ec5354ba63e19 Reviewed-on: https://chromium-review.googlesource.com/226061 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Fixes a bug in program ID validation for GetUniform* calls.  BUG=angle:571  Change-Id: I7080f0f7ea0def29d1b67c9d954ee5d9d41fb348 Reviewed-on: https://chromium-review.googlesource.com/228560 Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
MANGLE the ANGLE Renderer class.  BUG=angle:789  Change-Id: Ib6d9d47a9353ea3c1a931b793baba85a2698b659 Reviewed-on: https://chromium-review.googlesource.com/225472 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix zero texture application.  Patch https://chromium-review.googlesource.com/#/c/227711/ would allow NULL Textures sometimes from State::getSamplerTexture. Fix this by always setting the zero "Default" textures instead of NULL in the State.  This was breaking the ES2-CTS test 'framebuffer_objects' on Windows.  BUG=angle:826  Change-Id: Ie08a89cff0555f21c769759e0c0ed73456a2f91c Reviewed-on: https://chromium-review.googlesource.com/228275 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Remove the gl::error function.  BUG=angle:520  Change-Id: Iefd4345aa347041143d5452cc2fcf48c071d494b Reviewed-on: https://chromium-review.googlesource.com/222839 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add error handling to RenderTarget creation.   * RenderTarget9/11 don't create any resources themselves anymore.  * Pass the real internal format to RenderTarget creation so that it is    not lost by converting to D3D formats and back.  BUG=angle:520  Change-Id: If420970d42f0bf6ce392d64f9cb7efa4df0b8f8e Reviewed-on: https://chromium-review.googlesource.com/222838 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Regenerate projects.  Disabled warnings were reordered.  Change-Id: I29772c1522e7428c3e66607fda82d14d2b182702 Reviewed-on: https://chromium-review.googlesource.com/228273 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix possible crash when the info log length is zero.  BUG=angle:822  Change-Id: I01cb590cc9c1ba05f4d63dd088eef7e176a09d2f Reviewed-on: https://chromium-review.googlesource.com/227264 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Corentin Wallez <cwallez@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add RendererD3D as a layer between GL and Renderer9/11.  BUG=angle:789  Change-Id: I6107e6cbdeb5e3466f96a4bdf98181b8e5a25467 Reviewed-on: https://chromium-review.googlesource.com/225471 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use Context caps in Framebuffer completeness check.  This frees the Framebuffer from any dependency on the Renderer.  BUG=angle:789  Change-Id: I0e9ae0edf93674e32ae4f6538a934cddbdc804d5 Reviewed-on: https://chromium-review.googlesource.com/225470 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a base for GL essential data.  The data holds the GL state caps extensions texture caps and current client version.  BUG=angle:789  Change-Id: Icd15d806e14490f39041dea663ab2461a6a76090 Reviewed-on: https://chromium-review.googlesource.com/226060 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Merge zero textures into the state texture map.  We can treat these textures the same as the rest saving a bit of code and complexity cost.  BUG=angle:789  Change-Id: I14b426c817cbe3c5bb737410378b6a80e274689b Reviewed-on: https://chromium-review.googlesource.com/227711 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Fix platform if defined build error on Linux.  Using #if instead of #if defined() was giving an error when ANGLE_PLATFORM_WINDOWS was undefined. Instead of defining it as zero for all platforms use #if defined() to ensure our legacy usage of #ifdef doesn't get messed up by #define <value> 0.  BUG=angle:825  Change-Id: Ibad51c45c4337a30feb68561b6cf54ed5dc05d9d Reviewed-on: https://chromium-review.googlesource.com/228270 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Switch to new APIs in samples/translator/translator.cpp  Also fix a few issuse for ninja build "all" to finish.  BUG=angle:775 TEST=translator.cc compiles OK  Change-Id: I6507e9143882a628a7737dd139efb6d8d358b0db Reviewed-on: https://chromium-review.googlesource.com/227490 Tested-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fixes for Angle to build with Windows GN.  Change-Id: Id38c4b11dba31b2779efa7beade481cd50f3d935 Reviewed-on: https://chromium-review.googlesource.com/227692 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix fuzzy color check in ClearTest.  This test was failing on some systems because of overly stringent color expectations.  BUG=angle:809  Change-Id: I817de315ff6de46fb87f8ed1c21e3bb62c133176 Reviewed-on: https://chromium-review.googlesource.com/225262 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fixes for Angle to build with Windows GN.  Change-Id: I5af7a1305e5a190de5367ad940186edd6baee5bc Reviewed-on: https://chromium-review.googlesource.com/227665 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use an ES3 shader spec for ES3 contexts.  BUG=angle:823  Change-Id: I377b4483b3835660e7fd45d923bf7f560cf2e5f6 Reviewed-on: https://chromium-review.googlesource.com/227593 Tested-by: Geoff Lang <geofflang@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Fixed a typo in generatePointSpriteHLSL.  Change-Id: I104bbca6442835ab5e8e78580c6cbbb58d32a9b2 Reviewed-on: https://chromium-review.googlesource.com/227570 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Name mangle function prototypes and print them in interm output  This patch changes function prototype handling so that they get assigned the same kind of a mangled name as function definitions and function calls. This name is now also printed in interm output so that function prototypes can be accurately identified in the interm output.  BUG=angle:821 TEST=compiler_tests  Change-Id: Ia150b8ac5b816b8096c964767cd8666bdee28539 Reviewed-on: https://chromium-review.googlesource.com/227390 Reviewed-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Commit-Queue: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Changes gl::RenderbufferStorage to rx::RenderbufferImpl  BUG=angle:782  Also eliminates Colorbuffer/DepthStencilBuffer and related friends and adds the RenderbufferD3D implementation of RenderbufferImpl.  This version fixes problems with the prior CL's handling of render target serial issuance.  Change-Id: I7ddfbec1097723d7ea6ce93a9c034f941349108a Reviewed-on: https://chromium-review.googlesource.com/227195 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix an incorrect iteration over EGL attributes.  BUG=angle:490  Change-Id: If7a86ee0a5226f2b45e26bbadf4a84f8f605d1c2 Reviewed-on: https://chromium-review.googlesource.com/227231 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Added ISwapChainPanel support  Change-Id: I26faa32804ee47cb6ad8458c90abeb93a01dfbdf Reviewed-on: https://chromium-review.googlesource.com/224991 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Regenerate projects.  BUG=angle:820  Change-Id: Ifb392fbfc7399ee504fc20abbe63218668a0574b Reviewed-on: https://chromium-review.googlesource.com/227165 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update ANGLE_platform_angle to allow requesting of Renderer versions.  Added enums to allow users to request major and minor versions of the underlying API and if a WARP device is used.  BUG=angle:490  Change-Id: I0bfb2ac8d327da28a47cc8e6346300e47ab9538c Reviewed-on: https://chromium-review.googlesource.com/225081 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Added an egl::Error class and updated libEGL to use it.  BUG=angle:520  Change-Id: I792c8ddd8e8b76184f566294196d089bc9d1902a Reviewed-on: https://chromium-review.googlesource.com/223270 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Change ShaderLang APIs from c style to c++ style.  BUG=angle:816 TEST=gpu_unittestsangle_unittestswebgl_conformance  Change-Id: I0b46c11f6055a82511bb946a6dc491360835526e Reviewed-on: https://chromium-review.googlesource.com/226410 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Revert "Changes gl::RenderbufferStorage to rx::RenderbufferImpl"  This reverts commit 9fc51d90176dcf4273cd6689968e1ca5d1c9fe16.  Change-Id: I4134ebe5ef6b8f509f4cc5cc22a2d526ec43ef6d Reviewed-on: https://chromium-review.googlesource.com/226374 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fixed comments around choice of C runtime.  BUG=angle:733  Change-Id: Ia1add30d54c3a7d08effca6660f98c99cb3981c2 Reviewed-on: https://chromium-review.googlesource.com/226377 Tested-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix angle_unittests failures.  BUG=angle:815 TEST=angle_unittests  Change-Id: I4d59f227b7c72f4f456d0a60d8507d097ef05dec Reviewed-on: https://chromium-review.googlesource.com/226463 Tested-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Changed feature macros to reduce accidental enabling/disabling  Change-Id: Ieb1a0c55f412f2a1bb858522b2dfaa7a60aa7ddb Reviewed-on: https://chromium-review.googlesource.com/226304 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Reject shaders of a version that the compiler doesn't support.  For example WebGL 1.0 compiler should not compile WebGL 2.0 shaders.  BUG=angle: TEST=815  Change-Id: Iaec66fa5127426778aff6e3891e2c214048d7457 Reviewed-on: https://chromium-review.googlesource.com/226380 Tested-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Changes gl::RenderbufferStorage to rx::RenderbufferImpl  BUG=angle:782  Also eliminates Colorbuffer/DepthStencilBuffer and related friends and adds the RenderbufferD3D implementation of RenderbufferImpl.  Change-Id: Ibe72c9589b3c238b952744e7cfd70d97ec898eb9 Reviewed-on: https://chromium-review.googlesource.com/222925 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Updated Image9 to use gl::Errors for staging texture manipulation.  BUG=angle:520  Change-Id: I527a2bcadbf1abb05bd461d35ddbd7e28d487639 Reviewed-on: https://chromium-review.googlesource.com/221396 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use D3D11 Debug Annotations when D3D9 is unavailable  Change-Id: I37ac5fe7f0b2fe5e71bd7f0afca55e9894f3463c Reviewed-on: https://chromium-review.googlesource.com/224512 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove ShGetVariableInfo() and related code.  BUG=angle:775 TEST=chromium builds and runs fine  Change-Id: Ic62d3a3c9a8f034880b77a96f7f1c6be2691985e Reviewed-on: https://chromium-review.googlesource.com/226004 Tested-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Moving Uniform handling into ProgramD3D.  Moves the last references to HLSLBlockEncoder out of ProgramBinary. Only one reference to ShaderD3D remains.  BUG=angle:731 Change-Id: Ie23e24e09fbed4c8c5fab3bab814b7092a383c7f Reviewed-on: https://chromium-review.googlesource.com/220940 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Updated Image11 to use gl::Errors for staging texture manipulation.  BUG=angle:520  Change-Id: I5792b139ddd69c2cabc3b901a7067438c1ee363b Reviewed-on: https://chromium-review.googlesource.com/221395 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Updated mipmap generation to return Error objects.  BUG=angle:520  Change-Id: Ic4e57148d031d6c452b3054efad98f6e730c7691 Reviewed-on: https://chromium-review.googlesource.com/221394 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix an issue with separate invariant statement.  Basically we end up with an extra "invariant xxx ;;" on GL backend.  This is not handled correctly by Mac drivers and also out shader translator.  BUG=angle:776 TEST=webgl conformance on mac/windows  Change-Id: If32867efba64ab0d3e6e690155790b90d736439f Reviewed-on: https://chromium-review.googlesource.com/225780 Tested-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add ANGLE_ENABLE_DEBUG_TRACE_TO_DEBUGGER to output trace to debugger window  Change-Id: I7be71c41b0ec3a77f508c90c2de3331c9522a11b Reviewed-on: https://chromium-review.googlesource.com/223592 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Rename ANGLE_ENABLE_TRACE -> ANGLE_ENABLE_DEBUG_TRACE  Change-Id: Ib70c456c8d01161e370b9165ff4daa2f0f90c840 Reviewed-on: https://chromium-review.googlesource.com/223591 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Rename ANGLE_ENABLE_PERF -> ANGLE_ENABLE_DEBUG_ANNOTATIONS  Change-Id: I701cd5ee749797428171e9c58a46fce626b9a969 Reviewed-on: https://chromium-review.googlesource.com/223590 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fixed D3DDisassemble function dynamic GetProcAddress failure on WinRT  Change-Id: I32a345803c9183e0b9b77d529027711f8c8e1ad8 Reviewed-on: https://chromium-review.googlesource.com/225847 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix build failure on WinRT due to missing Sleep definition.  Change-Id: I9032484dde6e690fcd175d6d76192724e5bc0357 Reviewed-on: https://chromium-review.googlesource.com/225893 Reviewed-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Only use the Windows 8.1 SDK for WinRT configurations.  BUG=angle:772 BUG=395405  Change-Id: If26a0ec34e6bfd0e22d20803a0bb3ac2000a8e34 Reviewed-on: https://chromium-review.googlesource.com/225531 Reviewed-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix precision tracking for built-in function return values  Previously the type of the return value of all function calls was set to the type of the return value in the function signature. This did not carry precision information.  This patch changes this so that the return value precision is set correctly for built-in functions. For single-argument math functions it mostly depends on that addUnaryMath sets the type of the return value to be the same as the type of the operand. The type is replaced but the precision information from the operand type is retained when needed. For multi-argument math functions precision is determined based on all the nodes in the aggregate after the type has been set. For texture functions the precision is set according the sampler type as per ESSL 1.0 spec. For textureSize the precision is always highp as per ESSL 3.0 spec.  BUG=angle:787  Change-Id: I48448e3ffe38656b91177dee9b60dd07a03cd095 Reviewed-on: https://chromium-review.googlesource.com/224951 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Olli Etuaho <oetuaho@nvidia.com>, 23355681, 619, 169, 619
Fixed some configuration data not being added to 64-bit builds.  The Debug and Release configurations are 32-bit only.  The Debug_Base and Release_Base configurations should be used in these cases.  In the future we should not rely on defines being placed in these configurations because if ANGLE is included in another project they may not have the same configuration names and the defines will not be added. To combat this always make sure that there are appropriate #ifdef's in the headers and don't add defines that would result in poor performance if they do not exist.  BUG=angle:772  Change-Id: I2b26ffb934f8b3d5e6e556a1e87c1c5ee209c430 Reviewed-on: https://chromium-review.googlesource.com/225051 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove getData from BufferImpl.  We only ever call this method inside the D3D Renderer so we can downcast to BufferD3D and call getData on the D3D-specific type.  Leave a FIXME for handling index range validation which will need a CPU-side data cache.  Change-Id: Iaf71bc8055869a8561777b6b36f67e376a1d0b81 Reviewed-on: https://chromium-review.googlesource.com/224654 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Support compressed textures with unpack buffers.  BUG=angle:792  Change-Id: I32f32422232bd4cb04c8a70005cb51482224bf3e Reviewed-on: https://chromium-review.googlesource.com/224655 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix ASSERT failure in XFB test.  With the invariant handling changes we're also exporting gl_Position and other builtin variables from the translator where we were not previously. This was causing an assert in the XFB code where we would inadvertently assign a register to gl_Position and trip up logic further in the varying handling logic.  BUG=angle:808  Change-Id: I674902da75c572e969f9516033a85c7a7170d7d1 Reviewed-on: https://chromium-review.googlesource.com/225261 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add robust D3D11 SRV state tracking.  This will ensure our currently set pixel and vertex SRVs match with the underlying D3D state and reduce the need for resetting them as often.  BUG=angle:756 BUG=417424  Change-Id: I42e9e25182b279871ac4cdf8da5e2ab62c8cf71f Reviewed-on: https://chromium-review.googlesource.com/225052 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Defer the creation of textures in TextureStorage9 and use Error objects.  BUG=angle:520  Change-Id: I5db70189d95babef14d48548054af4c7ff2bfc47 Reviewed-on: https://chromium-review.googlesource.com/219334 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Defer the creation of textures in TextureStorage11.  BUG=angle:520  Change-Id: If1c1f7519a84900f594701b6298b64ebf8798073 Reviewed-on: https://chromium-review.googlesource.com/219333 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove build_angle.gyp.  This file is a duplicate of angle.gyp and we can remove it now that Chrome and Blink are finished with it.  BUG=angle:460  Change-Id: Ida68c8343921ebe9a37b5bcd982e114c91febc3d Reviewed-on: https://chromium-review.googlesource.com/225053 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Compiler flags and macros added to shader debug report  The list of D3D compiler flags and macros used if compilation of a shader succeeds is added to the shader debug output.  BUG=angle:751  Change-Id: Ie84a586010787fe8d9c0dedfe9208f881058a588 Reviewed-on: https://chromium-review.googlesource.com/224970 Tested-by: Tibor Ouden den <tibordenouden@gmail.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use a new class name for each window.  If a previous window was not cleaned up properly due to a crash in a test the subsequent windows can fail to be created because the class is not destroyed.  Work around this by always creating a unique class before creating the window.  Change-Id: Ied6b2818ef03fa12b07111d8204c3c1a6a5bd5ac Reviewed-on: https://chromium-review.googlesource.com/225080 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Get rid of use of "static const std::string".  BUG=angle:807 TEST=angle_unittests  Change-Id: Ifa4d713deeb25d52a7aafc362a7e4630024fd511 Reviewed-on: https://chromium-review.googlesource.com/225004 Tested-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Regenerate public projects.  Change-Id: Ifcff7cba0c16775fdc99812539416ad07d88bf5a Reviewed-on: https://chromium-review.googlesource.com/225050 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix initialization sequence translation bug.  BUG=angle:805 TEST=https://www.khronos.org/registry/webgl/sdk/tests/conformance/glsl/misc/expression-list-in-declarator-initializer.html  Change-Id: I94fbdd0824dbe73034f8bf022aa53627582ad48b Reviewed-on: https://chromium-review.googlesource.com/224813 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix varying interpolation parsing.  This was broken sometime in the CollectVariables refactor.  BUG=angle:803  Change-Id: Iaa09449f02290c4547f87c1560465dc8998d957c Reviewed-on: https://chromium-review.googlesource.com/224104 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Delete the ShaderImpl on gl::Shader object destruction.  BUG=angleproject:804  Change-Id: I4d68f9283299e9fb6b907a6406c37f92f8b08dbe Reviewed-on: https://chromium-review.googlesource.com/224106 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Change the C runtime from static to dynamic.  BUG=angle:733  Change-Id: Iab9a3fbc8aa1e05f4d969016ab28bac868089487 Reviewed-on: https://chromium-review.googlesource.com/224482 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove last uses of gl::error in the Buffer classes.  BUG=angle:520  Change-Id: Id18e93b440da64360a6845a42a2664ae531b06f9 Reviewed-on: https://chromium-review.googlesource.com/218769 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Always include precision in interm output if it's available  This helps with debugging precision propagation issues.  BUG=angle:787  Change-Id: Ia969481c8d933455cdafef4ae25c6ab3946bc1c2 Reviewed-on: https://chromium-review.googlesource.com/224281 Reviewed-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Use windows_sdk_path for the 8.0 SDK path and windows_8_1_sdk_path for 8.1.  Change-Id: I0cb4262552852ccbc772ca828a0faa7d3e63784b Reviewed-on: https://chromium-review.googlesource.com/224483 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make ShBuiltInResources comparable with memcmp  Chromium builds a std::map with ShBuiltInResources as part of the key. Comparator for == and < are needed for the map implementation.  Currently Chromium uses memcmp as the comparator. Padding in ShBuiltInResources causes uninitialized reads.  Fix this by clearing the padding with memset during ShBuiltInResources initialization.  Change-Id: I78aa3c59ce165503831aa2a67c96cf8af316c152 Reviewed-on: https://chromium-review.googlesource.com/223431 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Make commitRegion a base method of TextureD3D.  Use a helper method isValidIndex to preserve ASSERT checks.  Refactoring patch only.  BUG=angle:741  Change-Id: Ie19fa21db51cd0239a3b391de362584a9fbab2df Reviewed-on: https://chromium-review.googlesource.com/222268 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Restrict use of TexStorage more in CopyImage.  We were being too permissive in some copyImage methods when checking if we can create a render target or not. This would lead us to trying to use an inconsistent TexStorage in some cases.  Note that we do need to create inconsistent TexStorage in cases where we are doing a FBO copy *from* a mipmap-incomplete texture attachment.  BUG=angle:780  Change-Id: I5a849b5d8c53713e38cb5f5052a8bb88b3f56260 Reviewed-on: https://chromium-review.googlesource.com/224480 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix missing include of common_defines.gypi.  Change-Id: I308956a700df4d440573fbae89e67cab0f2cf482 Reviewed-on: https://chromium-review.googlesource.com/224653 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Invariant related processing.  * Fix a bug in PreProcessor for STDGL pragma. * Record all invariant settings and set them in ShaderVariable. * Write #pragma STDGL invariant(all) in GL  BUG=angle:776 TEST=https://www.khronos.org/registry/webgl/sdk/tests/conformance/glsl/misc/shaders-with-invariance.html  Change-Id: Ie28b75480deed79f0c9f26e3b98f1778d1290182 Reviewed-on: https://chromium-review.googlesource.com/223610 Tested-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove getNativeTexture from TextureImpl.  We can stop exposing this method on the GL-side now that we only use it on the D3D back-end.  BUG=angle:781  Change-Id: I3a9ecc277dcd21147881b8780849782f68b3e62e Reviewed-on: https://chromium-review.googlesource.com/222924 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Remove getSamplerStateWithNativeOffset.  This method returned a sampler state as normal with the base level automatically offset by the one or two levels we use in the D3D workaround for small compressed textures. Since this is D3D-only we can move all of the logic into the D3D classes themselves.  BUG=angle:781  Change-Id: Ie0a60877efebb41f02f4e57625a44e5fb5cce074 Reviewed-on: https://chromium-review.googlesource.com/222923 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Move Texture Serials to the base class.  It's reasonable to use the serial logic on both the GL and all other translated Renderers since we check the logic on the GL-side. Serials give us a way to identify Textures that aren't raw pointers and aren't "id". "id" has issues when Textures are deleted then re-allocated with the same value.  BUG=angle:781  Change-Id: I1a2a8b6f4ea3db915574c957c143a81e0210ec7d Reviewed-on: https://chromium-review.googlesource.com/222922 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Use immutable level count in gl::Texture.  Instead of storing a binary flag indicating if we've created immutable storage store a level count. This indicates if or if not we've created immutable storage as well as avoiding the call to the native storage to return the level count.  BUG=angle:781  Change-Id: I08a6bd086d00ddf3255262a7711628be5212b4b7 Reviewed-on: https://chromium-review.googlesource.com/222921 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Added IInspectable EGLNativeWindowType and ICoreWindow support  Change-Id: I6dd7fef72a73572d4a3deda7ce36a11da3a75c81 Reviewed-on: https://chromium-review.googlesource.com/224366 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Defer the creation of Blit9's geometry and return Errors if it fails.  BUG=angle:520  Change-Id: I5e51fec38c513419beea5ff612a6ec2fb0e81a26 Reviewed-on: https://chromium-review.googlesource.com/218768 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use a constant for the number of faces in a cube map.  BUG=angle:520  Change-Id: Ia35103059526aff2fc1b29a160d8471f4b5cbd42 Reviewed-on: https://chromium-review.googlesource.com/223107 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Removed declaration of getAttachedShaders() without implementation.  Found while working on BUG=angle:751  BUG=angle:751  Change-Id: I8a5c5383f88ecb379395d1a23e36148145ebe34d Reviewed-on: https://chromium-review.googlesource.com/224090 Tested-by: Tibor Ouden den <tibordenouden@gmail.com> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update the getRenderTarget functions to return gl::Error objects.  BUG=angle:520  Change-Id: If1f4f71972b669704eff70b5f60927d8e6ac07b3 Reviewed-on: https://chromium-review.googlesource.com/218767 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Merge the copyToStorage methods.  BUG=angle:741  Change-Id: I67380748ee875cc2dea61eb82a9b0d600144dc85 Reviewed-on: https://chromium-review.googlesource.com/222267 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Added IInspectable EGLNativeWindowType and ICoreWindow support"  Causing regressions in the build: http://build.chromium.org/p/chromium.gpu.fyi/builders/GPU%20Mac%20Builder/builds/20182  This reverts commit 756aebfc7afa6d0de14e96637ef396dd7b290c2d.  Change-Id: I2f4bdb5aeb429c9bbc5e655a1761704f33737841 Reviewed-on: https://chromium-review.googlesource.com/224221 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Added IInspectable EGLNativeWindowType and ICoreWindow support  Change-Id: I34e443b1e194800460e441ac6cee42cf68430564 Reviewed-on: https://chromium-review.googlesource.com/224302 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix TextureD3D::setData for depth-stencil textures.  D3D11 requires us to NULL the update region parameter when updating depth stencil textures. For these textures we can't always use the subdata workaround so disable it entirely for these textures.  BUG=angle:729 BUG=365078  Change-Id: I44258dd1b8937b1aebcb3a73de835698805537e0 Reviewed-on: https://chromium-review.googlesource.com/222911 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix CopyBufferSubData validation.  We were checking readTarget twice instead of both read and write.  BUG=angle:800  Change-Id: I4096a9c4e0fdec9c77bfc25250923c188d2b43db Reviewed-on: https://chromium-review.googlesource.com/224102 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add c++0x flag to cflags on non-win platforms.  Our previous change to use static_assert leads the new wave of c++11 features.  BUG=  Change-Id: Id6d382475daa7029109dab1017a59b5ef07c18df Reviewed-on: https://chromium-review.googlesource.com/221267 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
We managed to disable NPOT textures on AMD. Reenable them.  BUG=angle:799  Change-Id: Iaa8aee1f09c8c2ac3669d6709572f76f40f21847 Reviewed-on: https://chromium-review.googlesource.com/224042 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Revert "Added IInspectable EGLNativeWindowType and ICoreWindow support" due to build failures on Chromium FYI bots.  This reverts commit 406a3be91cc8175df95bd390425e35830778f2d5.  Change-Id: Ica2abd2e557a4fd9852d85b7fc018e3d272b6edf Reviewed-on: https://chromium-review.googlesource.com/224051 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Added IInspectable EGLNativeWindowType and ICoreWindow support  Change-Id: I9ad82b7819bcca1c05e7aa60dc2baec4a7bc403c Reviewed-on: https://chromium-review.googlesource.com/222360 Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Enhance shader debug output  glGetTranslatedShaderSourceANGLE() returns the glsl code the initial translated hlsl code the final translated hlsl code and the disassembly of the generated binary with the compiler configuration. This enhancement is only available if the define ANGLE_GENERATE_SHADER_DEBUG_INFO exists. This define is set in the debug configurations for the Windows platform.  BUG=angle:751  Change-Id: I8b15e8b25fbb0c0575a73cc876bf8f1fa7ed142a Reviewed-on: https://chromium-review.googlesource.com/221059 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use attributes to avoid unrolling and flatten conditionals.  [loop] and [flatten] help avoid unrolling make more shaders compile successfully. When unrolling has to happen an error X3531 is generated so we have to try compiling again without these attributes.  BUG=395048395286  Change-Id: I91ea8ac3a822ab1f1ac24907d42326e3c6c9d9af Reviewed-on: https://chromium-review.googlesource.com/222810 Tested-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update Renderer11::packPixels to return Error objects.  BUG=angle:520 BUG=394361  Change-Id: I95f2f806210ac7aea8b0c57bece610eb22d018ed Reviewed-on: https://chromium-review.googlesource.com/222481 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor TLS management.  Use cross-platform APIs and constants and conditionally compile the Windows-specific DllMain.  BUG=angleproject:783  Change-Id: I8fd2708ab0925cb3207010eb0e759cfc055183ab Reviewed-on: https://chromium-review.googlesource.com/222955 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Split FenceImpl into FenceNVImpl and FenceSyncImpl and refactor.  Move Windows-specific code out of Fence.cpp. Split FenceImpl based on suggestions on previous review https://chromium-review.googlesource.com/221805/ . Refactored further based on code review feedback and added first unit tests.  BUG=angleproject:774  Change-Id: I630034e1788e48ddb7722016ca22da474e785798 Reviewed-on: https://chromium-review.googlesource.com/222954 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Fix compile error on 32-bit builds.  BUG=angle:520  Change-Id: Ibd3f46ca565ddd96820ef52b140f7e99cf28a5c2 Reviewed-on: https://chromium-review.googlesource.com/223168 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Updated TextureStorage11 to use Error objects for D3D11 object creation.  BUG=angle:520  Change-Id: I2b4d3d2be99d4185ff1ff1c6521fbd66a1e771ae Reviewed-on: https://chromium-review.googlesource.com/217337 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update the TextureStorage calls to associate textures to use Errors objects.  BUG=angle:520  Change-Id: Ied81c25a04d7239985cc83bb20493ce0bfd372d3 Reviewed-on: https://chromium-review.googlesource.com/217336 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Added test to ensure ProgramBinary saving and loading works correctly  Change-Id: I7fa88e7e3ecf812659967867e856cc1677b8359d Reviewed-on: https://chromium-review.googlesource.com/222931 Tested-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix PBO missing unmap in some edge cases.  We had missed a few unmap calls in NativeBuffer11::copyFromStoage. This method is only called when PBOs are used in conjunction with SubData updates or when drawing with PBOs.  BUG=angle:667  Change-Id: I04a2b78e830edb9439e25661a2676af374df439e Reviewed-on: https://chromium-review.googlesource.com/222920 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix a crash with the WebGL conformance test suite.  Undefined behavior caused by an overflowed enum was causing the translator symbol table stack to not get popped correctly when the compiler completed causing dangling symbols who's storage was reclaimed and reused when the allocation pool was popped. The error occurred in the "shader-with-reserved-words" test which passes when the compiler fails due to the use of reserved words as identifiers. As such this test would pass even if the GPU process crashes but further tests in the test suite would fail.  BUG=angle::785 786  Change-Id: I365cb55f962f8dfe409f40532effeb10b8189432 Reviewed-on: https://chromium-review.googlesource.com/223093 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Gus Fernandez <gusfernandez@chromium.org>, 23355681, 619, 169, 619
Fix D3D11 Hazard warnings in Debug.  BUG=angle:756 BUG=417424  Change-Id: I827f1db6bb0a3ba33f116e4cfbf8556da0e884d1 Reviewed-on: https://chromium-review.googlesource.com/221220 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Implement support of unary operator "+" in translator.  BUG=angle:779 TEST=conformance/glsl/misc/struct-unary-operators.html  Change-Id: Ia827e07dcfc8ad3bbbc078e54336815be9027945 Reviewed-on: https://chromium-review.googlesource.com/222720 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Improve the TextureStorage11 SRV cache.   * Use a std::map instead of std::vector for logarithmic search time.  * Reduce the number of structs and make them private instead of    protected since they arn't used outside of the base class.  * Fix the SRV cache member name.  BUG=angle:520  Change-Id: I5158c1d46523f46158c51cd68044f7c915a3de03 Reviewed-on: https://chromium-review.googlesource.com/217335 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor Texture::storage methods to use gl::Error objects.  BUG=angle:520  Change-Id: I33bc8479815a587749bddc722ac9fe5a85f554cb Reviewed-on: https://chromium-review.googlesource.com/216648 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor Texture::copy*Image methods to use gl::Error objects.  BUG=angle:520  Change-Id: I8b6bf5d50ee0d1f796eff52919ee65823fdee6cb Reviewed-on: https://chromium-review.googlesource.com/216647 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make OSWindow a non-static member of ANGLETest.  BUG=angle:611  Change-Id: I455e1dd0ad5582191621e316c4808a2d753e9aaa Reviewed-on: https://chromium-review.googlesource.com/219867 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add workaround for Unicode compile error.  Chromium builds define UNICODE while we don't which confuses the built-in IDC_ARROW macro.  With this fix and http://crbug.com/415983 we can build angle_perf_tests in Chromium.  BUG=angle:744  Change-Id: I268a7c11a5b5355cb2485bf10faf750972cf4e30 Reviewed-on: https://chromium-review.googlesource.com/220363 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove perf tests dependency on gtest.  BUG=angle:744  Change-Id: I9272e0009238680db1a87e6cb1c1c48b2ed48dd6 Reviewed-on: https://chromium-review.googlesource.com/220362 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use Chromium perf bot output style for perf test.  The Chromium style output will allow the perf bots to collect data from our performance tests.  BUG=angle:744  Change-Id: I2ffdace688004edf2918ead2a3e2aa2a6c4daf95 Reviewed-on: https://chromium-review.googlesource.com/220361 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Import the testing/perf module from Chromium.  We can use these perf routines to make our performance test output compatible with the Chromium perf bots.  BUG=angle:744  Change-Id: I75a44786d4521fc0c7d8226f10575fcfda0fa221 Reviewed-on: https://chromium-review.googlesource.com/220360 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use GL_APIENTRY and EGLAPIENTRY instead of __stdcall directly.  BUG=angleproject:773  Change-Id: Iab098f787b966bf3999c22687af113cc9909593b Reviewed-on: https://chromium-review.googlesource.com/221796 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Refactor libGLESv2.gypi to allow libANGLE to be built on all platforms.  Required pulling angle_enable_d3d{911} into angle.gypi and definition of angle_libangle_win_sources. Pull in those sources in BUILD.gn.  Tested with local GYP build on Windows. Did not test GN build yet.  BUG=angleproject:773  Change-Id: Ia3703fe4fa2bc8a1682c1fa1667ca36268b36cc7 Reviewed-on: https://chromium-review.googlesource.com/221785 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Updated Renderer::sync to return Error objects.  BUG=angle:520  Change-Id: I8f1f095977bab3848b9215cda1127a71982858b8 Reviewed-on: https://chromium-review.googlesource.com/220800 Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Perform short-circuit unfolding on separate declarations.  BUG=415694  Change-Id: I812abb21d2ab4af0b63631a23026d5860df61672 Reviewed-on: https://chromium-review.googlesource.com/221945 Tested-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Split combined declarations into separate statements.  BUG=415694  Change-Id: I7afb08a8a5ed10bbc6f7d23638daca6982f7c88b Reviewed-on: https://chromium-review.googlesource.com/221455 Tested-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Updated the FenceSync and FenceNV objects to use Error objects.  BUG=angle:520  Change-Id: I1e49b35905d8916baadb129c8aa58a11bd721500 Reviewed-on: https://chromium-review.googlesource.com/220781 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add type comparison type retrieval original name retrieval to ShaderVariable.  This is needed to effectively use the new APIs to get shader variable info.  BUG=angle::770 TEST=ShaderVariableTest  Change-Id: Ia591eb567868ebe898f4a7449c64167ad212f59b Reviewed-on: https://chromium-review.googlesource.com/221388 Tested-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Add needed static_casts to GLenum for compilation on Linux.  BUG=angleproject:773  Change-Id: I8b01a1f187456eb8997fc7a620b5ecdffb872c19 Reviewed-on: https://chromium-review.googlesource.com/221810 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Enable TexSubImage workaround on D3D11.  This workaround uses UpdateResource instead of staging buffers for texture data updates. It improves performance for highly dynamic textures especially in some benchmarks eg the turbulenz particle demo.  Re-land with fix to the issue with glGenerateMipmaps.  BUG=angle:729 BUG=365078  Change-Id: I4c9398e0645176c296bf95e35eab97a44eae4319 Reviewed-on: https://chromium-review.googlesource.com/221493 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use ImageIndex in copyToStorage.  Also change the image association methods in TexStorage to use ImageIndex for consistency and compatibility.  BUG=angle:729  Change-Id: I05afa803735c9b93ae7d623fee5e6899c9ccec28 Reviewed-on: https://chromium-review.googlesource.com/221722 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use mTopLevel in getSubresourceIndex.  We need to include this in every call so might as well handle it automatically.  BUG=angle:729  Change-Id: I5c230408a9eb80c8cfcc3f0d3a4ea531fa173aed Reviewed-on: https://chromium-review.googlesource.com/221760 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix image index iterator unit test.  This test was checking out-of-bounds. The bug only showed up in Linux.  BUG=angle:741  Change-Id: I4cb45fc00dbb0bf9713f735a20fb6fd04bc95140 Reviewed-on: https://chromium-review.googlesource.com/221057 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Use ImageIndex as a parameter to TextureD3D::setImage.  This will allow us to call the TexureStorage::setData easily.  BUG=angle:729  Change-Id: I16ada583894c8c427c78de5050f7f462c96d1fd1 Reviewed-on: https://chromium-review.googlesource.com/221492 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make blit extension check for internal format mismatch.  The extension spec dictates a format mismatch generates invalid operation. Since we can't have the same internal format map to different actual/native formats this check is more strict and we can replace the previous one.  BUG=angle:769  Change-Id: Ic1b5c335ba38a4f2feaffa1478a65e7fcf7f75ea Reviewed-on: https://chromium-review.googlesource.com/221065 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Enable TexSubImage workaround on D3D11."  Probably causing WebGL CTS failures:  http://build.chromium.org/p/chromium.gpu.fyi/builders/Win8%20Release%20%28NVIDIA%29/builds/6148  This reverts commit 2d337ce0503db5f91fcf0a11591cd436dfb32cd7.  Change-Id: Ic032640f44adf337c4b3eedd4d7f3551d565a5cb Reviewed-on: https://chromium-review.googlesource.com/221397 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Enable TexSubImage workaround on D3D11.  This workaround uses UpdateResource instead of staging buffers for texture data updates. It improves performance for highly dynamic textures especially in some benchmarks eg the turbulenz particle demo.  BUG=angle:729 BUG=365078  Change-Id: Idd82c27845a772199caef3695111c96735e8843e Reviewed-on: https://chromium-review.googlesource.com/219864 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use COM object dynamic cast for RT resource queries.  BUG=angle:729  Change-Id: I55af209211329a7a71728e3c6d55d87154cfb45e Reviewed-on: https://chromium-review.googlesource.com/221269 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use gl::Rectangle as a param to Image::copy.  BUG=angle:729  Change-Id: I13194760df35cb18db6ac43d567e6b393e838d56 Reviewed-on: https://chromium-review.googlesource.com/221268 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Accept a second form of WARP Test renderer string.  On our Renderer test we would be overly restrictive in the forms of Renderer string we would accept for WARP. On this machine it returns a different string than the one we had in the test. Expand the test to accept both.  BUG=angle:769  Change-Id: If27644d32d6d7d0eff77ff9cca81faee3b2be4e1 Reviewed-on: https://chromium-review.googlesource.com/221066 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Restrict the tests that use ClearBuffer to ES3.  We had changed the configurations to run them in ES2 mode while ClearBuffer is an ES3-only method.  BUG=angle:769  Change-Id: I63d92af4702a133aa8bbf52444dfef59a4f602b0 Reviewed-on: https://chromium-review.googlesource.com/221064 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Updated authorship and contributors for Borbitsoft/Tibor den Ouden  Removed Borbitsoft from the AUTHORS file added Tibor den Ouden. Removed Borbitsoft from CONTRIBUTORS file company section. Moved Tibor den Ouden in CONTRIBUTORS file from company section to individual section  Change-Id: I3ab47d637d0879fde8f9dc0f714e2cb44562c897 Reviewed-on: https://chromium-review.googlesource.com/221054 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Update Program ProgramBinary and HLSLCompiler to use Error objects.  BUG=angle:520  Change-Id: Ibbe8c95780fecfb68f4558e99e3a761107da6aee Reviewed-on: https://chromium-review.googlesource.com/220790 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add option to support EXT_draw_buffers with NV_draw_buffers  After this patch it is possible to set a flag to change EXT_draw_buffers extension directives to NV_draw_buffers in ESSL. This enables users of ANGLE to emulate EXT_draw_buffers by using NV_draw_buffers in combination with GLES3.0.  Change-Id: I5dacdbd6cd0d0362424ea3791557342c42efd4bd Reviewed-on: https://chromium-review.googlesource.com/219941 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Tested-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add TextureStorage::setData.  Usually we copy data from the Image classes into the Storage. This method which will only apply to D3D11 is useful for our SubData performance workaround.  BUG=angle:729  Change-Id: I50ca8158ee9e0638f59f617b9e6170b508eaeb44 Reviewed-on: https://chromium-review.googlesource.com/219837 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use the virtual commitRegion in TextureD3D::subData.  This allows us remove the duplicated code in the various typed methods that checks for an error before committing.  BUG=angle:729  Change-Id: Icd0ad2be55ac423baec3855e05c53f4b624b6764 Reviewed-on: https://chromium-review.googlesource.com/220275 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Introduce new method commitRegion to TextureD3D.  Replacing commitRect with commitRegion which takes generic parameter types will allow us to call it directly from the base class TextureD3D. This will be useful in subsequent patches that introduce the SubData performance workaround.  BUG=angle:729  Change-Id: I37bf12f847b43f7c961b403321de19f547258b01 Reviewed-on: https://chromium-review.googlesource.com/220274 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix building angleutils.cpp on Linux  vsnprintf is defined in stdio.h according to the standard. It was not in the include chain of angleutils.cpp which broke the build on Linux on some configurations. Seems like other toolchains include the function in some non-standard way.  BUG=angle:761  Change-Id: Idcd75776e8a9b83dad182d1b4bac0beac006c6ac Reviewed-on: https://chromium-review.googlesource.com/221053 Reviewed-by: Olli Etuaho <oetuaho@nvidia.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix typos in caps generation method names.  Change-Id: I7efa752b2276cb92b4ca12ffaf7aa37c514525f0 Reviewed-on: https://chromium-review.googlesource.com/219807 Tested-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Store XFB buffers in a vector in State.  BUG=angle:685  Change-Id: I4bff717f716ba21633c59244560fd56f41f587ed Reviewed-on: https://chromium-review.googlesource.com/219806 Tested-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use a caps-dependent sized vector to store Uniform Buffers  BUG=angle:685  Change-Id: I3f2e9fcccf27aebbb4ec5485286eec9828851887 Reviewed-on: https://chromium-review.googlesource.com/219805 Tested-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Change mVertexAttribCurrentValues from fixed-size array to STL container.  BUG=angle:685  Change-Id: I42fc6c919f42cd6ab1c11531742f9a2c5ad0cd3d Reviewed-on: https://chromium-review.googlesource.com/219353 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Vertex management functions can take a State reference instead of pointers to attrib data.  BUG=angle:685  Change-Id: I0bfc26c53eb1358a023ac5d4ec20be06f9c90f4a Reviewed-on: https://chromium-review.googlesource.com/219352 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Remove context pointer from State  BUG=angle:685  State needs only to track a few variables from Context's caps so store those instead of a pointer to Context.  Change-Id: I36d448dcaccf9780d6df2cfc82ef975b2ba0346f Reviewed-on: https://chromium-review.googlesource.com/219804 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Disable broken D3D9 GLSL Varying tests.  Not sure at the moment if we can only disable tests in D3D9/etc but these tests are broken for D3D9 and hence we can disable them to return angle_tests to passing.  BUG=angle:769  Change-Id: I3c13f985fde99c3d885f825de60af841c8f3f0f1 Reviewed-on: https://chromium-review.googlesource.com/221067 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't run the DrawBuffers tests in D3D9.  We only support MRT on the D3D11 Renderer for now so we can skip running these tests entirely on the D3D9 back-end.  BUG=angle:769  Change-Id: I442936fe987ae1749d5ee7626f6a4737e824ac6f Reviewed-on: https://chromium-review.googlesource.com/221063 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix D3D9 varyings limits.  We were off by one varying since D3D9 treats PSIZE specially.  BUG=angle:769  Change-Id: Id5242d12c3ca42da3f3f528ff4a21445dba89701 Reviewed-on: https://chromium-review.googlesource.com/221062 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix a bug in MaxTextureSizeTest.RenderToTexture.  This bug only presented itself in our D3D9 Renderer. In D3D11 we would stretch the texture to fit -- this is behaviour correct in ES3 but not in the ANGLE spec draft.  BUG=angle:769  Change-Id: Iddb8551c9645aa6f0841e2dc9d96fbd196bc6788 Reviewed-on: https://chromium-review.googlesource.com/221061 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Accept RenderTargets as parameters to Image::copy.  This gives us the flexibility to use copy internally for Textures as well as FBO attachments. This will be useful for the TexSubImage performance workaround.  BUG=angle:729  Change-Id: I4df8ef3a5a928d44ef84100cd96a5d35f12b47fa Reviewed-on: https://chromium-review.googlesource.com/219863 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Roll gyp dependency to 1987  Change-Id: Id063785b1d0c2a4badc73d6ec828060b7893e58c Reviewed-on: https://chromium-review.googlesource.com/220843 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Cooper Partin <coopp@microsoft.com> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fixed mingw compilation.  Change-Id: I8ae33c752feb19e291e4a3b128d21a0ced883c90 Reviewed-on: https://chromium-review.googlesource.com/220761 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Freed temporary info log buffer and removed explicit destruction of char[]  BUG=angle:758  Removed explicit destruction of char[] by using std::vector<char> object.  Added Borbitsoft to AUTHORS and Tibor den Ouden to CONTRIBUTORS  Change-Id: I9c4017eb81ce3fab8b7fb4a5b4ad52a758d14a2d Reviewed-on: https://chromium-review.googlesource.com/219940 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add check for size before setting buffer data.  If data is non-null and size is zero the memory buffer may have a NULL pointer.  BUG=angle:765  Change-Id: I4cb8f54ec85fea886e37ee2d4469d26e651a916b Reviewed-on: https://chromium-review.googlesource.com/220801 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Replace usages of std::vector::data in most cases.  In some parts of ANGLE code we were using std::vector::data to get a pointer to the first element. Sadly this is c++11 only which isn't currently supported on Chromium. This was causing a breakage on Android. We should probably refrain from using data except on D3D-only code which we know will be Visual Studio.  BUG=angle:767  Change-Id: Ibc10577368435a13f62d74d77c95076482cd8f82 Reviewed-on: https://chromium-review.googlesource.com/220920 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Configure Google Tests to run against multiple renderers/GLES versions  BUG=angle:611  Change-Id: I7d43612171c439045038db9ae82fd8716c0b31c6 Reviewed-on: https://chromium-review.googlesource.com/220400 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Austin Kinross <aukinros@microsoft.com>, 23355681, 619, 169, 619
More TextureD3D cleanups.  The getLayers method was redundant and the getBaseLevelImage method we can replace with a shared TextureD3D method rather than a specialized method for each type.  BUG=angle:729  Change-Id: I80c94a765dbc369fb0bb60ec8273e9e3ba6ffeed Reviewed-on: https://chromium-review.googlesource.com/219862 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Clean up ensureRenderTarget().  We can use the same code for this method with the only difference being in when we determine a texture image holds no pixels.  BUG=angle:729  Change-Id: I3356f5deb900c24b1a5c739ce8de99e9ce1371c0 Reviewed-on: https://chromium-review.googlesource.com/219861 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix d3d9 copyToStorage dirty flag.  This flag wasn't being set in the 2D version of this method. The bug would only cause a performance penalty on Windows XP machines.  BUG=angle:729  Change-Id: I516206740becc90438d613ae9abb3ac550733aed Reviewed-on: https://chromium-review.googlesource.com/219860 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove copyToRenderTarget methods.  These Renderer methods can be replaced with virtual TextureStorage methods now that we do not have TextureStorageInterface to complicate matters. This reduces the number of stubs in Renderer as well as allowing cleaner code re-use.  BUG=angle:729  Change-Id: I6d2004d4f1abdb1041420144cee1c173e5ab199e Reviewed-on: https://chromium-review.googlesource.com/219839 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Moved the responsibility for releasing the dest surface out of copyToSurface.  BUG=angle:520  Change-Id: I4c6c39462b43eeb0a202f731c4a54007ef16445c Reviewed-on: https://chromium-review.googlesource.com/219866 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor Texture::compressed*Image methods to use gl::Error objects.  BUG=angle:520  Change-Id: I8fd7ebf3edb3edef06e77b79776c363672931a61 Reviewed-on: https://chromium-review.googlesource.com/216646 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Merge the various TextureCube::setImage* methods.  BUG=angle:520  Change-Id: I4e8191dd827744ef380348a31dce7181d99fbf30 Reviewed-on: https://chromium-review.googlesource.com/216645 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor Texture::setImage and subImage to use gl::Error objects.  BUG=angle:520  Change-Id: Ib43ace0fbdab59086ae4314cce139636d9045e65 Reviewed-on: https://chromium-review.googlesource.com/216644 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix the ANGLE_ENABLE_TRACE build.  We needed to include angleutils.cpp in libtranslator for this to compile. Also allow the event helpers to record API calls even if ANGLE_ENABLE_PERF is off.  BUG=angle:513  Change-Id: I2646d5ebeae536a4a7f1cd7ecaf0ce019ce5ff76 Reviewed-on: https://chromium-review.googlesource.com/219756 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Updated the PixelTransfer class to use Error objects.  BUG=angle:520  Change-Id: I7e21acbfd5726607ea62c8fcf64d76bbf5877860 Reviewed-on: https://chromium-review.googlesource.com/216643 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a centralized workarounds module.  This is a temporary home for the various workarounds we use for performance or to solve driver issues. Eventually we will want a standalone library we can use as part of Chromium or in ANGLE standalone.  Re-land with member variable initialized.  BUG=angle:729  Change-Id: If7f8f9596a39b2855366d9a67caebf6dd4197b55 Reviewed-on: https://chromium-review.googlesource.com/219868 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Add a centralized workarounds module."  Was missing an initialization in Renderer.cpp.  This reverts commit 815a1dc3710c48ecc84539b7ffb15860f6738f6c.  Change-Id: Ia4666911c2ff58660e0ab5c7cec4431b1c30a1e1 Reviewed-on: https://chromium-review.googlesource.com/220420 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a centralized workarounds module.  This is a temporary home for the various workarounds we use for performance or to solve driver issues. Eventually we will want a standalone library we can use as part of Chromium or in ANGLE standalone.  BUG=angle:729  Change-Id: Ib0254262cad9f8fb779886dacb967be646ea96ae Reviewed-on: https://chromium-review.googlesource.com/219838 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Reduce code duplication in generateMipmap.  Using the newly introduced image index struct we can simplify our code somewhat in TextureStorage.  BUG=angle:729  Change-Id: Iff274fd1df7a0dc36dd34e0cb31ad42831b4f5d5 Reviewed-on: https://chromium-review.googlesource.com/219836 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add TextureD3D::getIndex.  This is a simple virtual method which gives an ImageIndex at a particular level and layer. It's useful for handling all the texture types uniformly which all treat levels and layers differently.  BUG=angle:729  Change-Id: I72db560287272c195b1ff8555f99ab2258ac7e6d Reviewed-on: https://chromium-review.googlesource.com/219835 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add ImageIndexIterator.  We can use image index iterators to iterate over all images in a Texture. This allows us to do some operations in TextureD3D rather than in the typed subclasses and save on some repeated code.  BUG=angle:729  Change-Id: I3ba47b2eebad2cfca313117fd501ff76d5107044 Reviewed-on: https://chromium-review.googlesource.com/219834 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Fix gyp linux build.  ANGLE implementation unit tests was enabled by mistake on Linux.  BUG=angle:761  Change-Id: Ibdca214466a6177aa50bdb3a3f55031dc0957b90 Reviewed-on: https://chromium-review.googlesource.com/220272 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove include of util.gyp from all.gyp.  Since util.gyp doesn't have any executables there isn't any need to include it from all.gyp.  It should only be included by targets that depend upon it.  BUG=angle:761  Change-Id: Iabad2da7bca0f161d092c044ab0021568f9b6f59 Reviewed-on: https://chromium-review.googlesource.com/219759 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Moving Shader Executables into ProgramD3D  BUG=angle:731 Change-Id: I677fc9773914307184bcdd9ab7ac564956d77f6a Reviewed-on: https://chromium-review.googlesource.com/219814 Tested-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Added SurfaceHost to enable additional hosts and abstract access for EGLNativeWindowType.  Change-Id: I590b52925c6b9127d08eaf0e5ba2a0bde30505c3 Reviewed-on: https://chromium-review.googlesource.com/219488 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update Renderer::copyToRenderTarget to return Error objects.  BUG=angle:520  Change-Id: Ieab2d031d638056676e07d80aa024b6c6f12f3d6 Reviewed-on: https://chromium-review.googlesource.com/216642 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Benchmark point sprites test with several varyings.  A potential performance slowdown could be our geometry shader using extra logic in packing varyings. Test this by adding a variable number of varyings to the point sprites benchmark.  Initial tests show it could slow down the test by about 30-40% or so stil not catastrophic compared to D3D9.  BUG=angle:705  Change-Id: Ia815f0ee28e2af2d3dc4d9f5675c27bbeb4cb119 Reviewed-on: https://chromium-review.googlesource.com/216468 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a point sprite benchmark.  This benchmark will attempt to reproduce the slowdown we see in D3D11 on the turbulenz GPU particles demo.  BUG=angle:705  Change-Id: I9c4c2f09d4282feae30f448fd374cdbb6bceae9b Reviewed-on: https://chromium-review.googlesource.com/216467 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update Renderer::copyImage to return Error objects.  BUG=angle:520  Change-Id: I1bb7a53bc75ebb8bf324935b673ea636bdff6931 Reviewed-on: https://chromium-review.googlesource.com/216641 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update blit calls to return Error objects instead of calling gl::error.  BUG=angle:520  Change-Id: I94c3ad327433cf275744e98be6cb2ba91be49c0f Reviewed-on: https://chromium-review.googlesource.com/216640 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move the code that writes the temporary shader file to the shader compiler.  BUG=angle:755  Change-Id: I5fdc3ae112ea3f59694a22da6199b99a568ed0a1 Reviewed-on: https://chromium-review.googlesource.com/219530 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor HLSLCompiler to use stl objects and encapulate workarounds.   * Pass std::strings for the source and profile.  * Create a wrapper struct for storing the compile configurations and pass    them to the compiler with an std::vector.  * Remove function typedefs they're available from the platform.h header.  BUG=angle:755  Change-Id: I19dd2be1655a12f76fc5718450db974a7ec324ec Reviewed-on: https://chromium-review.googlesource.com/219287 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Removed the last references to Renderer from ProgramBinary.  BUG=angle:731 Change-Id: I8829a434e59279b1b9c37e9a1922ae05d467b376 Reviewed-on: https://chromium-review.googlesource.com/219421 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Rename GN public variables.  forward_dependent_configs_from => public_deps direct_dependent_configs => public_configs  Change-Id: I93beca2109181a2aac8d5793c3464b3af8b6ab9b Reviewed-on: https://chromium-review.googlesource.com/219695 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Brett Wilson <brettw@chromium.org>, 23355681, 619, 169, 619
Removed the last references to DynamicHLSL from ProgramBinary.  Migrated several more non-generic values from ProgramBinary the D3D impl.  BUG=angle:731 Change-Id: Ic043dd75328cffbc6bef6556da801c382b4138bc Reviewed-on: https://chromium-review.googlesource.com/219390 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Fix some texture support queries ORing extensions instead of ANDing.  A couple of formats that required two extensions would OR the checks together when they should have ANDed them and allowed the validation to be too permissive.  Fixed the checks and added a new one that needs to OR the extension checks together to verify GL_DEPTH24_STENCIL8_OES support.  BUG=angle:752  Change-Id: I2e1e12fd428358e975cd22eb685b9a8fb797161f Reviewed-on: https://chromium-review.googlesource.com/219094 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove the requirement that a format must be texturable to be renderable.  Previously to determine if a texture format was renderable the texturable and renderable fields had to be and-ed together.  This caused issues for formats such as D24S8 which can be renderable but not texturable depending on available extensions.  Made the renderable flag a complete check that may be different than the textureable flag and removed assumptions that a format is texturable if renderable from the code.  GL_DEPTH24_STENCIL8 now checks for ANGLE_depth_textures for texturability and ANGLE_depth_textures or OES_packed_depth_stencil for renderability.  BUG=angle:752  Change-Id: I6d197cee72cc249e5996fa395303bdf43d246a87 Reviewed-on: https://chromium-review.googlesource.com/219093 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update the draw calls to return Error objects.  BUG=angle:520  Change-Id: I3330ba2dbe095fc9460789822a938420a80a149f Reviewed-on: https://chromium-review.googlesource.com/213823 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Updated the swizzle generation functions to use Error objects.  BUG=angle:520  Change-Id: I01b3cdb7d6719582fa8a57f21218705f6743a7b0 Reviewed-on: https://chromium-review.googlesource.com/217103 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Create test configuration include guards  BUG=angle:501  Change-Id: I0281cf6de4fbf8ddd142b7af4ea2917f0a0a1569 Reviewed-on: https://chromium-review.googlesource.com/218840 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Use a D24S8 format to back GL_DEPTH_COMPONENT32_OES in D3D9.  Looks like the D3D9 D32 format isn't available on most GPUs (and doesn't exist in D3D11) so back GL_DEPTH_COMPONENT32_OES with D24S8 instead to match D3D11.  BUG=angle:750  Change-Id: I0f7a124544c1c14ba21db20fbf6765d07e244966 Reviewed-on: https://chromium-review.googlesource.com/219080 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix a NULL dereference on buffer initialization.  In some cases where the user would create a buffer with NULL (empty) data we would attempt to dereference NULL when drawing with the buffer as a vertex attribute.  BUG=angle:749  Change-Id: Ied5ecbab4608c85890cdf7cc32a8dae46989e33b Reviewed-on: https://chromium-review.googlesource.com/219090 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Remove rx::TextureStorageInterface entirely.  This class provides no added benefit now that we've scrapped the type-specialized classes. We can squash it's functionality into TextureStorage instead.  BUG=angle:741  Change-Id: I04984806719a01f299986265fe09b3cccf04dca5 Reviewed-on: https://chromium-review.googlesource.com/218316 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Squash the TextureStorageInterface heirarchy.  Since there are no longer any significant differences in the child classes of TextureStorageInterface we can scrap the different implementations. This involves changing the function names of some Renderer functions which relied on overloading.  BUG=angle:741  Change-Id: I074797e4ac0bf3ecf8fe4bddf84eaed28b1a2c23 Reviewed-on: https://chromium-review.googlesource.com/218315 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move generateMipmap to storage interface base class.  Using a little bit more of code repetition allows us to move the implementation of the mipmaps to a simple virtual interface in TextureStorage.  BUG=angle:741  Change-Id: I7661d0cc3bdb02b646da0802cba285650d7832b2 Reviewed-on: https://chromium-review.googlesource.com/218314 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use ImageIndex in getRenderTargetSerial.  Also move getRenderTargetSerial to the TextureStorageInterface base class since it shares a common interface.  BUG=angle:741  Change-Id: I1bc1cfac6426e241ac91d373884a7dd8a1c5b188 Reviewed-on: https://chromium-review.googlesource.com/218313 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Updated the vertex buffer classes to use Error objects.  BUG=angle:520  Change-Id: Id003e66b2acbf37dbbe66aaca2fa336c3c884be2 Reviewed-on: https://chromium-review.googlesource.com/217102 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix Renderer11 signed/unsigned warning in 32-bit.  Change-Id: I1e11f54b0ae245cdd7e090ab0748821738ad6314 Reviewed-on: https://chromium-review.googlesource.com/218761 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use dynamically sized containers for texture and sampler bindings.  BUG=angle:685  Change-Id: I7af97a95deee69fbdebca2b57403244f45516e67 Reviewed-on: https://chromium-review.googlesource.com/216564 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use ImageIndex in getRenderTarget.  Also change ImageIndex to allow invalid indexes for layer. In 3D indexes sometimes the layer parameter is invalid indicating we index an entire mip level instead of a layer of a mip level.  BUG=angle:741  Change-Id: I7b410f9aaf568f215bb93ae063934669a8fa09bd Reviewed-on: https://chromium-review.googlesource.com/218312 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't skip draw calls on zero-sized viewports.  If transform feedback is active primitives still need to be rendered even if no pixels are written to the framebuffer.  Instead of checking for active transform feedback simply remove the draw call skipping optimization since it is most likely an application mistake to draw with a zero sized viewport and we shouldn't optimize for this case.  This change doesn't affect the clear calls because the viewport is set to the framebuffer size which is non-zero.  BUG=angle:743  Change-Id: I04af9d6de5aad3040e3c6b3c24990e107e21ad36 Reviewed-on: https://chromium-review.googlesource.com/218508 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Improve D3D11 varying packing when there are more varyings than registers.  BUG=angle:738  Change-Id: I0599840fc79d571230acf26105d512322bcffdcd Reviewed-on: https://chromium-review.googlesource.com/214108 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix incorrect error check.  The registers variable became a pointer but this error check was not updated.  BUG=angle:743  Change-Id: Id2cd7b5ba39180281a3bbc408cd7c31bc663500c Reviewed-on: https://chromium-review.googlesource.com/218507 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Merge the sampler uniform application into ProgramBinary::setUniform.   * Fixes incorrect dirty checks for the dirty sampler mappings flag.  * Fixes WebGL tests:    * conformance_canvas_texture_bindings_unaffected_on_resize    * conformance_reading_read_pixels_test    * conformance_uniforms_uniform_default_values  BUG=414450  Change-Id: I132dbc301a236aef153fb6da4c6b64c36b0ba3f3 Reviewed-on: https://chromium-review.googlesource.com/218501 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix enum in FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE query.  We were using DEPTH_STENCIL instead of DEPTH_STENCIL_ATTACHMENT.  BUG=angle:739  Change-Id: I0c746c374577dca2b965dfd7ccfac793f7075efb Reviewed-on: https://chromium-review.googlesource.com/218592 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Accept ImageIndex in TextureD3D::subImage and getImage.  This paves the way for setting data on the TextureStorage directly instead of working through the Image objects.  BUG=angle:741  Change-Id: I3be3d5f9b2e45707c1630b74ad3f4789e034c3fd Reviewed-on: https://chromium-review.googlesource.com/218311 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix the varying sort comparator in ShaderD3D.  The comparator was actually a <= operator while sort requires a strict < operator. This was causing a potential assertion failure.  Bug report from Kerim Borchaev.  BUG=angle:742  Change-Id: I37c2925ab0b85e70ee1b2be3c72c6ddc062e8d28 Reviewed-on: https://chromium-review.googlesource.com/218506 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move validation of ANGLE_instanced_arrays to the validation layer.  BUG=angle:520  Change-Id: Idb3c50235a7029e72c58bc202aba0cfab735202a Reviewed-on: https://chromium-review.googlesource.com/218510 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Don't modify the function parameters in ProgramBinary::setUniform.  BUG=414450  Change-Id: Ib5ebf18e57af671b8694ffcfc3cb152557f7f002 Reviewed-on: https://chromium-review.googlesource.com/218500 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add several missing header guard comments  These were causing build failures under GCC.  Change-Id: Iba19ed166f909fe559d19731f31849770619f412 Reviewed-on: https://chromium-review.googlesource.com/218580 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
gn: Fix source paths  Change-Id: Idf0c746d7e4e9f03b176744e8ff027be2d5f25ad Reviewed-on: https://chromium-review.googlesource.com/218520 Reviewed-by: Brett Wilson <brettw@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Cem Kocagil <ckocagil@chromium.org> Tested-by: Cem Kocagil <ckocagil@chromium.org>, 23355681, 619, 169, 619
Update Queries to return Error objects instead of calling gl::error.  BUG=angle:520  Change-Id: If8f2bb1c4de7b9cc30861a06aab1d89c97305b26 Reviewed-on: https://chromium-review.googlesource.com/216699 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Moving more D3D-only logic into ProgramBinaryD3D  BUG=angle:731  Change-Id: Ia62ec9a912c8bd63fcee51ca206d52688dd999da Reviewed-on: https://chromium-review.googlesource.com/217495 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Remove dead RenderbufferStorage::getDepthBuffer.  This code was unused.  BUG=angle:732  Change-Id: I764d7c5624bdb81650e05a22c4ef0431c2002b18 Reviewed-on: https://chromium-review.googlesource.com/217331 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a helper to replace FBO attachment's getSerial.  Ideally we could store a render target serial in the render target itself. For now this helper function allows us to finally stop exposing rx::RenderTarget from gl::Texture.  BUG=angle:732  Change-Id: I4ffc5e0af6f0542212ad4e74adced21ebbd89462 Reviewed-on: https://chromium-review.googlesource.com/217330 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add an attachment helper to replace getRenderTarget.  We would like to stop exposing rx::RenderTarget to any GL-layer code like the Context or Framebuffer. Then we can pull any necessary information inside the Renderer back-ends.  BUG=angle:732  Change-Id: Ifa35218f097c528e616d732bda4bcd8e5f1c3843 Reviewed-on: https://chromium-review.googlesource.com/217029 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix signed-unsigned mismatch  Change-Id: Ie7fba8a0fd0475a395205139c4f7169cc94e61b7 Reviewed-on: https://chromium-review.googlesource.com/217510 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Updated the index buffer classes to use Error objects.  BUG=angle:520  Change-Id: Ifc249058a3ed3ffffe163a9e3ec21d6fc8c75bd0 Reviewed-on: https://chromium-review.googlesource.com/217101 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Only allocate the streaming index buffers when they are first needed.  BUG=angle:520  Change-Id: I111e4fd830ad19f6a4ff50749ba891fc14f9154b Reviewed-on: https://chromium-review.googlesource.com/217100 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move the counting IB from IndexDataManager to Renderer9.  BUG=angle:520  Change-Id: Ice0a04b296af6c0a61a604f629b08603e594bb0b Reviewed-on: https://chromium-review.googlesource.com/216919 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update the RenderStateCache to use Error objects.  BUG=angle:520  Change-Id: I14e2a84c6d2e6f98a50395b63ac206e32bc10f8b Reviewed-on: https://chromium-review.googlesource.com/216918 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add queries for attachment targets.  Queries for the FBO attachment Textures and Renderbuffers allow us more options than specific methods for querying the texture storage or texture serial.  BUG=angle:732  Change-Id: Ieb4ddca3955fcf716dbf54331524d0c1e25fe946 Reviewed-on: https://chromium-review.googlesource.com/217028 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Add a TexSubImage benchmark.  Currently we are about 2x as slow on this micro-benchmark in D3D11. Preliminary testing suggests using CopySubresourceRegion gives improved performance across the board but testing could disprove this hypothesis.  Modified from a sample from bajones.  BUG=angle:705  Change-Id: Iedf36a4e7b9b9bbed308302fd2bf3912acacbd2c Reviewed-on: https://chromium-review.googlesource.com/216272 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix Win32Window::resize breaking angle_tests.  We were messing up the client rect on resize which caused the ReadPixels checks to mess up around the window edges. Disabling the window styles on the test windows masked this bug. Fix this by using a style-less child window inside the parent window. This gives us access to window styles for the samples project along with the ability to use tiny 1x1 windows for testing.  BUG=angle:730  Change-Id: Ic6dd931df7b4e32fbbcacbb004d3bbc49917f658 Reviewed-on: https://chromium-review.googlesource.com/217024 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Get stencil buffer clear parameters format directly.  The state layer should not be querying render targets directly since they are not a GL concept.  BUG=angle:732  Change-Id: I5ee96ae54cced8a32c5082ddd9f8796a975e2591 Reviewed-on: https://chromium-review.googlesource.com/213971 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Only use direct buffers for static data in D3D11.  For highly dynamic data which gets updated every frame or almost every frame we're better off using our existing dynamic buffer path. We could further optimize the dynamic buffer path by only uploading changed data every frame.  BUG=angle:705  Change-Id: Icbb357b889be789b30f73067f75b13664c806929 Reviewed-on: https://chromium-review.googlesource.com/217280 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Starting refactor of ProgramBinary  This is gonna take a while...  BUG=angle:731 Change-Id: Ief72c3361b6429f3f6e0bc2d2ea0810d523ff178 Reviewed-on: https://chromium-review.googlesource.com/215661 Tested-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Squash the Texture attachment classes into one.  BUG=angle:732  Change-Id: Ib6b26fe1351bc09e729178f6ec8b8d2ec1f7ff58 Reviewed-on: https://chromium-review.googlesource.com/213970 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Optimize dynamic buffers."  This reverts commit 3e3813f787ee5e8bb7808eed539a606a4e2e3fd3.  Conflicts: 	src/libGLESv2/renderer/d3d/d3d11/Buffer11.cpp  Change-Id: I6470059672d3b377ce0fafbc8b637318a91f62c8 Reviewed-on: https://chromium-review.googlesource.com/217106 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move assertion into if-block.  Since the loop always goes up to MAX_VERTEX_ATTRIBS the ASSERTION may be triggered even though no more attributes are enabled.  BUG=angle:740  Change-Id: I2bb30d7e9f426ae1a0b8250e65c1fd02107973ac Reviewed-on: https://chromium-review.googlesource.com/217027 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update the ReadPixels calls to return Error objects instead of calling gl::error.  BUG=angle:520  Change-Id: I2ead221e7d1f02cf088b60d0e98376fcd68dde8e Reviewed-on: https://chromium-review.googlesource.com/211441 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update clear calls to return Error objects instead of calling gl::error.  BUG=angle:520  Change-Id: I474a6ed29b882963f7f3425515e7d65f8f69b3e4 Reviewed-on: https://chromium-review.googlesource.com/211440 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update Buffers to return Error objects instead of calling gl::error.  BUG=angle:520  Change-Id: I4b6af8e2d4fae97639518e2acd26e2d4be93c925 Reviewed-on: https://chromium-review.googlesource.com/209881 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Eliminate typed render target Texture attachment method.  More convergance to the base TextureAttachment class.  BUG=angle:732  Change-Id: I9aae1a49ab3908a4eb4cec4bce201b88a7d93926 Reviewed-on: https://chromium-review.googlesource.com/213859 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Use ImageIndex to return Texture attachment properties.  This and subsequent patches will eliminate the need for typed attachments.  BUG=angle:732  Change-Id: Ia1cfa672855b577f7a2ce219e6ed8ca1e3e16cc1 Reviewed-on: https://chromium-review.googlesource.com/213858 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix typo in "PixelShaderOuputVariable".  Change-Id: I2b223c9b80faa3ff2a0f94bd52ca73edf3d67cf7 Reviewed-on: https://chromium-review.googlesource.com/216273 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Drop support for the old "full multiplexed" MRT shaders.  This will simplify the code somewhat. It should no longer be necessary now that we have the nVidia workaround.  BUG=angle:705  Change-Id: I1abe1abd9f03472341ce4315975a76c56b252bb4 Reviewed-on: https://chromium-review.googlesource.com/216111 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Enable MRT pixel shader rewriting.  Writing to all 8 pixel outputs was causing performance problems on Intel and AMD. Enabling Geoff's work to rewrite our pixel shaders solves the regression.  This patch also includes a workaround to the nVidia driver bug where it would ignore NULL RT values in OMSetRenderTargets by compacting the RT list to skip NULL values.  BUG=angle:705 BUG=365078  Change-Id: Ia68af6f0ccd5f10c484d6f76297a0bec694948f0 Reviewed-on: https://chromium-review.googlesource.com/214852 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use attachment binding points for dynamic PS key.  Because our output signature is only dependent on the arrangment of the attachments not the attachment type use the output layout key for now. If we need to we could store both in the future.  BUG=angle:705  Change-Id: I3b99954d30b91a4741fdd6f48f8ffcf88c0bea7a Reviewed-on: https://chromium-review.googlesource.com/215846 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Declare commit_id a gyp 'hard_dependency'.  Hard dependencies are marked for static library targets unlike normal soft dependencies which the static libraries ignore. This change ensures we run the commit_id script before compiling any static libraries that depend on it.  Change-Id: Ic29652012883273810c2863132d6f49bd6ada4b8 Reviewed-on: https://chromium-review.googlesource.com/216461 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix MSVC librarian warning about no target machine.  We had the appropriate setting in our linker settings but were missing the entry in our librarian settings. The new static lib target exposed the error.  Change-Id: I689ccb3cd6dbf2218c869b33500aaef43b8a421f Reviewed-on: https://chromium-review.googlesource.com/216460 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a new TextureAttachment class to simplify FBO attachments.  This single class will eventually replace the four child classes.  BUG=angle:732  Change-Id: Ie2862b4458c8b1302ff4fc5fbe0e4ded3b81894d Reviewed-on: https://chromium-review.googlesource.com/213857 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add an ImageIndex helper struct to index into tex levels.  This encapsulates the three values needed to index into the image array. It will simplify the logic for querying texture images from the base calss.  BUG=angle:732  Change-Id: I31c55b3f972fd4d96ab540ec8498ef4b9b2ba16b Reviewed-on: https://chromium-review.googlesource.com/213856 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor Framebuffer::invalidateSub.  Use our new helper methods to simplify this method.  BUG=angle:732  Change-Id: I56b837678d5efbc60de6de4bdb01447ca811e71d Reviewed-on: https://chromium-review.googlesource.com/213855 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Use libANGLE to reduce duplicated ANGLE source compiles.  libGLESv2_static and libGLESv2 can re-use the same object files.  BUG=angle:733  Change-Id: I894f4b5b6fbc1fc47812609d9e996691daf9f318 Reviewed-on: https://chromium-review.googlesource.com/214188 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Retrieve render colorbuffers as a single vector.  Making all our render methods query FBO attachments for rendering in one place will allow us to easily control the MRT peformance workaround and simplify the implementation.  BUG=angle:705  Change-Id: I6c476d45b81228d6ffe8831347443994237e3593 Reviewed-on: https://chromium-review.googlesource.com/215843 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Mark shared and std140 UBOs as always active.  This aligns ANGLE with the GL spec. With this fix we pass all of the dEQP conformance tests in Functional / Uniform Buffer Object that don't rely on single buffers.  BUG=angle:507  Change-Id: I6063a416e3f7ee6d5327d96850e3d0cc8521c817 Reviewed-on: https://chromium-review.googlesource.com/213506 Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move CollectVariables to sh namespace.  BUG=angle:466  Change-Id: I903ea840e333dfeb44f242a1759aed39974d0510 Reviewed-on: https://chromium-review.googlesource.com/213505 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use the CollectVariables path on the HLSL translator.  This approach consolidates our two methods and lets us reuse the same code for both methods of variable collection.  BUG=angle:466  Change-Id: Ie92f76ff0b6d0d0dbfd211a234d0ab86290fa798 Reviewed-on: https://chromium-review.googlesource.com/213504 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Compact the D3D shader specializations into one.  BUG=angle:731  Change-Id: I4f35a05aeea130f9011ec62cfe931ed23e2681c9 Reviewed-on: https://chromium-review.googlesource.com/214871 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move shader variables into the base impl.  These variable types apply across shader types. Either we'll want a way to cache them after we query them or we'll do a pre-parse pass similar to our current Chromium GLSL to GLSL pre-pass where we store the variables in ANGLE. In either case they're shared across GL implementations so make sense as queries from gl::Shader.  BUG=angle:731  Change-Id: I23f5541423abb4af87a2bc2fc1e9f4047fd2ff90 Reviewed-on: https://chromium-review.googlesource.com/214870 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix memory leaks in angle_unittests.  Call ShDestruct() to destroy the compiler objects to avoid memory leaks.  BUG=angle:737  Change-Id: I71a8ddfe67c9d8c7b4e5b5683c69dd578fc38c66 Reviewed-on: https://chromium-review.googlesource.com/215860 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Sudarsana Nagineni <sudarsana.nagineni@intel.com>, 23355681, 619, 169, 619
Use GL-like methods for InvalidateFramebuffer calls.  This will faciliate the MANGLE implementation.  BUG=angle:732  Change-Id: I0e4d569667e03305c9cca8d7c23154c70fb71eeb Reviewed-on: https://chromium-review.googlesource.com/213854 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Move logic of InvalidateFramebuffer to Framebuffer.cpp.  This method will translate to an implementation call.  BUG=angle:732  Change-Id: Ida1e3c9cccd94f7d166cc9a785708c12bfc52da5 Reviewed-on: https://chromium-review.googlesource.com/213853 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix use of references with va_start  BUG=angle:736  va_start behavior is undefined if the second parameter is a function array or reference type. clang produces a warning for this while MSVC does not.  Change-Id: I0bc2805e312e3542aac816f10a257e2f1cfad128 Reviewed-on: https://chromium-review.googlesource.com/216010 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nico Weber <thakis@chromium.org> Tested-by: Nico Weber <thakis@chromium.org>, 23355681, 619, 169, 619
Replace getDepthStencil with getRenderTarget.  In all places where we called this method we treated a NULL return value as an internal error. This implies to me that we don't need the two getRenderTarget and getDepthStencil methods since we aren't using them to check if a surface is depth or stencil.  BUG=angle:732  Change-Id: I4d1dc148abf3383b1b101bbff4f4d22de27ad03e Reviewed-on: https://chromium-review.googlesource.com/213852 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Clean up Query classes.  BUG=angle:717  Change-Id: I8f29f24964a9661d9f0bea5dca48cebddbf9b0b2 Reviewed-on: https://chromium-review.googlesource.com/211136 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Expand the SubData benchmark.  BUG=angle:705  Change-Id: I9bd29bb35ad6c240bf141b9449bb613d2e00f828 Reviewed-on: https://chromium-review.googlesource.com/213811 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Added BufferSubData benchmark.  BUG=angle:705  Change-Id: I65d557f35e4c9f1d94853a775330a92b7d428847 Reviewed-on: https://chromium-review.googlesource.com/213810 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix 64-bit use of Win32Window.  An incorrect call to SetWindowLongPtr was crashing the 64-bit test.  BUG=angle:705  Change-Id: I3815bb0a1308f5e66e74faead37c0ae09f975a10 Reviewed-on: https://chromium-review.googlesource.com/214883 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Converted ProgramBinary to use Context caps instead of Renderer  BUG=angle:731 Change-Id: I9bbce69cabf767fb5fb2c94f437a9950bc79d1aa Reviewed-on: https://chromium-review.googlesource.com/215370 Tested-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use the specified Program instead of current in GetUniform.  This bug slipped in with the GetUniform validation refactor.  BUG=angle:571  Change-Id: I2b87e6fe98224ba99c5b21a71d66b197fd618741 Reviewed-on: https://chromium-review.googlesource.com/214872 Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update validation functions to use new error mechanisms.  BUG=angle:520  Change-Id: I1c64af2e57cf2d89138bd23da2b07d5873742e4e Reviewed-on: https://chromium-review.googlesource.com/209880 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add caps for transform feedback limits from table 6.34.  BUG=angle:658  Change-Id: Ifd8c620080c8de486ffb7c8f9e985be1aba516c1 Reviewed-on: https://chromium-review.googlesource.com/207376 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add caps for the aggregate shader limits from table 6.33.  BUG=angle:658  Change-Id: I59d0cd131114fcb925f01d83d218a657f4498a2a Reviewed-on: https://chromium-review.googlesource.com/207375 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a README file for the ANGLE github page.  Change-Id: I8f1dfe43521f9a7a8f8d0a388e1b70f2e70a6e24 Reviewed-on: https://chromium-review.googlesource.com/214482 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a performance tests target.  Include a preliminary implementation of a simple benchmark app.  BUG=angle:705  Change-Id: I627450f6fdf01ed2054a50bd2327b7b9128c86f5 Reviewed-on: https://chromium-review.googlesource.com/214230 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Removed common_includes.h reordered includes.  Since we are not using precompiled headers anymore remove common_includes.h so that fewer files are included in cpp files.  Reordered includes to be in the following order:  1) Local ANGLE project headers ordered by directory in descending depth  2) GL headers  3) STL headers This helps enforce the include-what-you-use principal by reducing the number of STL headers unexpectedly shared between files.  This include order conflicts with some of the Google c++ style guide which states that STL includes should be first but this helps us catch more issues.  Change-Id: I8f7785f4ad574e253dd3c7b4fb1e54d3ce3b99fc Reviewed-on: https://chromium-review.googlesource.com/214850 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make OSWindow destructor virtual.  BUG=angle:734  Change-Id: I6deb639abc26a314dd890189613e0a3a2e1be1d2 Reviewed-on: https://chromium-review.googlesource.com/214714 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Moved DynamicHLSL into renderer/d3d  Obviously D3D-only class is obvious. :)  BUG=angle:731  Change-Id: Ide54e76a8b9bacb9b6834e2cb0a801140eecfe46 Reviewed-on: https://chromium-review.googlesource.com/213862 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
More shader refactor cleanup  Removed VertexShader and FragmentShader in favor of using a single Shader object Used VertexShaderD3D and FragmentShaderD3D directly when appropriate.  BUG=angle:731 Change-Id: Ib1ffdf85ee0bfa7c88bb9ddb1029ccbd63a9dbe1 Reviewed-on: https://chromium-review.googlesource.com/213840 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Revert "Fixes a compilation error when ANGLE_DEFAULT_D3D11 is defined."  The condition would always evaluate to true since we define ANGLE_DEFAULT_D3D11 as zero.  This reverts commit 10f05630a9a65514e74ec235a129104a5101d582.  Change-Id: I39304398be149d09a8f65a6cf44400b3672ed730 Reviewed-on: https://chromium-review.googlesource.com/214715 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix a compilation error for the ES3 CTS in 64bit.  The generated obj file was too large it required an extra MSVC flag for this particular project.  BUG=angle:497  Change-Id: I833a78611da78b0ac5a308547d11a911428ea04c Reviewed-on: https://chromium-review.googlesource.com/214684 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove remnants of old PCH code.  Remove the precompiled.cpp file which was producing a build warning and rename the header to make it clear we no longer support PCH.  BUG=angle:  Change-Id: I944081ae477b1478ca9c18924fb02bb920d420a7 Reviewed-on: https://chromium-review.googlesource.com/214187 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix row-major layout tracking in interface blocks.  Some block field types such as nested structs were bugged. This only affects our "CollectVariables" path not our current HLSL UBO path.  BUG=angle:466  Change-Id: I2b8daf58aa7ec1ad06a80d38f57e76087eacccdc Reviewed-on: https://chromium-review.googlesource.com/213503 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Refactoring Shader objects (Take 2)  This change refactors shaders to no longer be dependent on D3D-only concepts.  BUG=angle:731 Change-Id: I1006112f1d31b7e41bd14bd3225ea157b7d6c6c9 Reviewed-on: https://chromium-review.googlesource.com/214467 Tested-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Refactoring Shader objects"  This reverts commit 537dfde52a33d621ab1198c949a81b09a1269b2e.  Change-Id: I5eb8923ac8f78877e6e77a8cd897021e56ee004a Reviewed-on: https://chromium-review.googlesource.com/214466 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Refactoring Shader objects  This change refactors shaders to no longer be dependent on D3D-only concepts.  BUG=angle:731 Change-Id: I4fc1efeba9df4f873b3d7c8ba6f67f00b6532b9c Reviewed-on: https://chromium-review.googlesource.com/213803 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Fix GetUniform validation.  We were missing a check for an out-of-bounds Uniform which could cause us to miss an error and also give assertion failures.  BUG=angle:571  Change-Id: I844658a82ce13ea179a2358a202733c54bc2c0c7 Reviewed-on: https://chromium-review.googlesource.com/212934 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor GetUniform validator helpers.  BUG=angle:571  Change-Id: I7b36c7af38b102a24dc0e5d5d87fc042533e90af Reviewed-on: https://chromium-review.googlesource.com/212933 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move GetUniform size validation to top layer.  BUG=angle:571  Change-Id: Ie7064cf85f6a125ccd6cdf1bff89443520e2a06d Reviewed-on: https://chromium-review.googlesource.com/212932 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use shared compile helpers in the ANGLE tests.  BUG=angle:730  Change-Id: Ib3bd646c73355449105e6cf79bdcf0a14b391fd2 Reviewed-on: https://chromium-review.googlesource.com/213550 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add some shared utility methods to the utils project.  BUG=angle:730  Change-Id: I268c7f76ee9a14ab82f646ae8ebf4eed100bf86d Reviewed-on: https://chromium-review.googlesource.com/213509 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use EGLWindow in ANGLETests.  This completes the refactor to use the same code for EGL and OS Window creation for samples and tests.  BUG=angle:730 TEST=angle_tests  Change-Id: Ib6de89f5bf83c0730a66f662cd1f87351f36a5f7 Reviewed-on: https://chromium-review.googlesource.com/213297 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move GetUniform validation to the validation layer.  BUG=angle:571  Change-Id: Id1b7afb22d8bd52dbf7f95f4e8cac3fc8f798596 Reviewed-on: https://chromium-review.googlesource.com/212931 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fixes a compilation error when ANGLE_DEFAULT_D3D11 is defined.  Change-Id: I09853b4565d5458ce4c318611a6495ec265fa8de Reviewed-on: https://chromium-review.googlesource.com/213899 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Allow app to specify EGL Window extra parameters.  Extra parameters include pixel bit sizes swap interval and if we want multisampling. This gives parity between the tests and samples EGL creation options.  BUG=angle:730  Change-Id: I68d619c2ea141794f0089456bb6bba3d3b1c2a07 Reviewed-on: https://chromium-review.googlesource.com/213296 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use OSWindow with angle_tests for Window management.  BUG=angle:730  Change-Id: I409fd4f4e00eb0d8d964b0ac199fa6f675a36df8 Reviewed-on: https://chromium-review.googlesource.com/213295 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Fix interface block static use tracking.  The current code couldn't handle some uses of interface blocks such as blocks with instance names.  BUG=angle:466  Change-Id: I0a3746f277af0538cede30232532c6788412da1c Reviewed-on: https://chromium-review.googlesource.com/213502 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Refactor ShaderVariables to store fields in the base.  Instead of only storing structure information in Varyings Uniforms and Interface Block Fields store it in the base class. Also only store base variable information for struct fields instead of fully typed information. This works because stuff like interpolation type invariance and other properties are for the entire variable not individual fields.  Also add new fields for interface block instance name varying invariance and structure name for all struct types.  BUG=angle:466  Change-Id: If03fc071e6becb7aad6dea5093989bba7daee69e Reviewed-on: https://chromium-review.googlesource.com/213501 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Reduce CPU texture usage in D3D11 where possible  Change-Id: I3186d78fa0a5c676611806c6f553c5c7ad06f56a Reviewed-on: https://chromium-review.googlesource.com/212118 Tested-by: Austin Kinross <aukinros@microsoft.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix some MSVC warnings about possible truncation of int -> char.  BUG=81439 TEST=none  Change-Id: Iedf02bf374e4992fc4c8ee050eff76f4f05708ac Reviewed-on: https://chromium-review.googlesource.com/214065 Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Peter Kasting <pkasting@chromium.org>, 23355681, 619, 169, 619
Refactored TransformFeedback for multi-platform ANGLE and added tests.  Added angle_implementation_unit_tests target designed for testing the cross-platform code in libGLESv2 and libGLESv2_static target as a dependency. The goal is to incorporate these tests into Chromium's angle_unittests target on all platforms; however more work is needed to make libGLESv2's common code compile on non-Windows platforms so this is an intermediate step.  BUG=angle:719  Change-Id: Ifc44a779352294e857d6e913d9b997a60674c443 Reviewed-on: https://chromium-review.googlesource.com/214105 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Move some methods of VertexDataManager to helper methods.  Refactoring patch only.  BUG=angle:571  Change-Id: Ic318b4c4366e33b8d33f6003dd39f660f40d354a Reviewed-on: https://chromium-review.googlesource.com/210649 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Move validation from IndexDataManager to the API.  This validates all necessary buffer sizes for element array buffers in the validation layer before we start the draw.  BUG=angle:571  Change-Id: I602744ca1ea493e9f0f7e1ccbeb85fc4ae5c9f5a Reviewed-on: https://chromium-review.googlesource.com/210648 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add OSWindow::setVisible.  BUG=angle:730  Change-Id: I9c9e2f3b694ba57df359906cd8517ede60af632d Reviewed-on: https://chromium-review.googlesource.com/213294 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a Resize method to OSWindow.  BUG=angle:730  Change-Id: I64106f05eb4188305eb34bbabe7d1cde037e1948 Reviewed-on: https://chromium-review.googlesource.com/213293 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Extract validation from VertexDataManager.cpp to the API.  We can check for buffer overflow at draw validation time before processing any vertex data.  BUG=angle:571  Change-Id: I4f49629b98c17ca28e25baed74cad4ae5341b20f Reviewed-on: https://chromium-review.googlesource.com/210647 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Hard-limit the number of uniform vectors in D3D11.  Before the Caps were added the maximum fragment and vertex shader uniform vectors were hard-limited to 1024.  When increasing them to the D3D11 maximums the WebGL test uniforms/gl-uniform-arrays would time out. Reverting the limit until the test can succeed with higher limits.  BUG=407309  Change-Id: Ifb7015bdeb3d32d7dcd124cfedbea5f7e2c25a5e Reviewed-on: https://chromium-review.googlesource.com/213824 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a new invariant declaration operator.  BUG=angle:711  Change-Id: I54a48b636a68c317b8d44ee2d578847b80095289 Reviewed-on: https://chromium-review.googlesource.com/213500 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Clean up copyimage.h  Change-Id: Ie4b81bb37dbbe6a9584dfc6a6c92670a9b73cda5 Reviewed-on: https://chromium-review.googlesource.com/207374 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Adds a required EGL_BAD_MATCH case to eglMakeCurrent  BUG=angle:723  Change-Id: I12bb763acc70cb0737adf460226242023357b368 Reviewed-on: https://chromium-review.googlesource.com/212701 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Optimize dynamic buffers.  In D3D11 we would previously always use a staging buffer to proxy data to the GPU. This change allows users which specify DYNAMIC_DRAW to skip the staging buffer as long as they only write to index or vertex buffers.  This improves performance on all tested GPU vendors but in D3D11 on AMD and Intel our SubData calls are still significantly slower than in D3D9.  BUG=angle:705 BUG=365078  Change-Id: I4f83164176d67ff00119bdd0a6a80d7c84fd0f03 Reviewed-on: https://chromium-review.googlesource.com/213813 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add BufferStorage11::setData.  This helper method will be useful for implementing dynamic buffers.  BUG=angle:705  Change-Id: I8461a59724fb8866b36059c9ef5b838f072cc63a Reviewed-on: https://chromium-review.googlesource.com/213812 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Clean up copyvertex.h   * Move "private" functions into copyvertex.inl.  * Capitalize global function names give them more descriptive names.  * Use size_t for all dimensions.  * Use uint8_t pointers instead of unsigned char pointers.  Change-Id: I408cf7ebb28655c5811ad18979a20f4273d278cd Reviewed-on: https://chromium-review.googlesource.com/207373 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add caps for vertex and fragment shader limits from tables 6.31 and 6.32.  BUG=angle:658  Change-Id: I98509aa16caf74c3e4e28852e8b59aedd903f03a Reviewed-on: https://chromium-review.googlesource.com/207372 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add caps from the 6.29 table.  BUG=angle:658  Change-Id: I392f581b1aea445d60f507c1fa897c4348c1a137 Reviewed-on: https://chromium-review.googlesource.com/207371 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix compilation error due to bad merge.  Change-Id: I54b3e0423e41b86b28d93fdce8d4d2d3304d56cf Reviewed-on: https://chromium-review.googlesource.com/213822 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Added check to avoid accessing possible NULL renderer pointer.  Change-Id: I38524e7d3c74656902151e004d3aa47555531fd5 Reviewed-on: https://chromium-review.googlesource.com/211203 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fixed memory leak in  Renderbuffer class. Offscreen objects backbuffer texture /shader resource view depth stencil texture/shader resource views were leaking during swapchain resize operations.  Change-Id: Iee83a14d043eecc465e6ffb8e21a6449def38e9b Reviewed-on: https://chromium-review.googlesource.com/211834 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Create an Error object to represent GL errors.  BUG=angle:520  Change-Id: I1a54e6f308b5b0f310c725a7771af737a77ecd42 Reviewed-on: https://chromium-review.googlesource.com/209619 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move the index range cache to gl::Buffer.  Because we want to move all validation to the API layer we need to move the index validation to the API layer. This means exposing the index cache to the validation layer.  In the future we will probably want a way to skip index validation when it's not necessary or the chosen back-end handles index validation on its own.  BUG=angle:571  Change-Id: Iee1618e669bc28abf7e0709ca4a03b4727b1383e Reviewed-on: https://chromium-review.googlesource.com/210646 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix std140 UBO layouts.  A call to "prePadding" instaed of "prePaddingString" was confusing the HLSL output engine.  A separate bug was causing HLSL errors because HLSL puts all cbuffer members in a flattened namespace which caused our internal padding variables to overlap.  BUG=angle:725  Change-Id: I69a01fefa430a83e433385c64a532a69e6851ae8 Reviewed-on: https://chromium-review.googlesource.com/212930 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Prevent accessing more arguments than provided.  BUG=390111  Change-Id: Iecc2ac2354a82cca937a823e5c588c662264e36c Reviewed-on: https://chromium-review.googlesource.com/213551 Tested-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use Range type for index ranges.  This compacts a lot of parameter passing. Refactoring patch only.  BUG=angle:571  Change-Id: Ic918478d0c6b81093bfea6154ce0f6bf1d2b5be2 Reviewed-on: https://chromium-review.googlesource.com/210645 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Split vertex translation into helper methods.  Refactoring patch only.  BUG=angle:571  Change-Id: I17e8c1eb80bdf7c3ec7cc4bad4e70e81590e4a89 Reviewed-on: https://chromium-review.googlesource.com/210644 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix "Reize" to "Re*s*izeWindow".  BUG=angle:730  Change-Id: I7d4e5a36cec2b3a5c61ae768ec4c816553031baf Reviewed-on: https://chromium-review.googlesource.com/213292 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make the EGLDisplay a non-static member of ANGLETest.  We would create and destroy the display with every test as it was not part of the environment.  BUG=angle:730  Change-Id: Iae003f13c8e975ae57d3af2d74f9f058a560046f Reviewed-on: https://chromium-review.googlesource.com/213291 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make the sample app own the OS Window object.  This allows us to use OS Windows and EGL contexts differently for different implementations - eg tests and samples.  BUG=angle:730  Change-Id: I65e69fd829c3dbf2f1b406d90045bc296798ebb6 Reviewed-on: https://chromium-review.googlesource.com/213290 Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a util project to share between samples and tests.  This code shares the Window and EGL logic between the two projects.  BUG=angle:730  Change-Id: I8940371226a8f7b02579c332f51679c4a5d0e2a5 Reviewed-on: https://chromium-review.googlesource.com/212799 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Only set declaration operator if not already set.  This allows us to return different operators from single declarations which will be useful for treating invariant declarations as different operators.  BUG=angle:711  Change-Id: Id278b91854bbefe8e635380d7b27198198236fef Reviewed-on: https://chromium-review.googlesource.com/212939 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Add a helper method to parse invariant declarations.  This pulls out more functionality from the grammar into simple c++ source files.  BUG=angle:711  Change-Id: I19121d710dc1543585361cb53a0deb2ea0479db9 Reviewed-on: https://chromium-review.googlesource.com/212938 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Add a getNamedVariable helper method to TParseContext.  This method will be useful in more than one place since we need to get a TType from an indentifier when parsing invariant declarations.  BUG=angle:711  Change-Id: I1c1befbdcc93ea626428fb4e313b8c6326c158f6 Reviewed-on: https://chromium-review.googlesource.com/212937 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Moved some validation back to Texture unified all TextureImpl variants  BUG=angle:688 Change-Id: Ie2df18277c84345fceaa31d4f63f5cbbb47540c6 Reviewed-on: https://chromium-review.googlesource.com/211387 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Rename intermediate.h to Intermediate.h.  This was breaking the Linux build.  Change-Id: I8f63527cfa37ee774ea5d1e6eb0043a4c7ccc734 Reviewed-on: https://chromium-review.googlesource.com/213300 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Call addRef when creating a new Fence Sync object.  BUG=angle:728  Change-Id: Iafd838c3ceb1a88afd4d3b0994e8d841945df499 Reviewed-on: https://chromium-review.googlesource.com/213142 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Rename compiler intermediate source files.  This prevents confusion between "TIntermediate" and "TIntermNode".  BUG=angle:711  Change-Id: Ib7a086382a479db3f77bf2ab06ce321aa7b35d13 Reviewed-on: https://chromium-review.googlesource.com/212936 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Fix reversed shift in the huge SetData test.  BUG=angle:716  Change-Id: I1b621668b78373e0566f6eab6034993ec09aa4b9 Reviewed-on: https://chromium-review.googlesource.com/213221 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix swizzle formats being assigned incorrectly.  * Non-4 component formats cannot be used as swizzle formats. * Unsized formats should not have swizzle formats.  BUG=angle:721  Change-Id: Ic4e2642f5dc4c9811768961fbab00f6edd200ce1 Reviewed-on: https://chromium-review.googlesource.com/211241 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove the gclient file it should be generated now.  BUG=angle:713  Change-Id: Icd3e9c5212baf4c1dc781df6fef68c078b054e1a Reviewed-on: https://chromium-review.googlesource.com/210883 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Simplify the creation of OS-specific windows and timers in the samples.  BUG=angle:521  Change-Id: I9550269e9cd67fc24246853bec3c1f67cb16da2a Reviewed-on: https://chromium-review.googlesource.com/211130 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Amend comment about nameless structs & layout qualifiers  Change-Id: I1177c808bffd2beba7d52bd8f8869125a1624698 Reviewed-on: https://chromium-review.googlesource.com/212700 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Minor cleanup to Query constructor to normalize it with other interfaces  Change-Id: I562245cf6323edc7a127480e8de6ac16c6f97c03 Reviewed-on: https://chromium-review.googlesource.com/211641 Tested-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Initialize TranslatedAttributes  BUG=398337  Uninitialized TranslatedAttributes were causing false positives in checks for nonzero attrib divisor.  Change-Id: I44655d3fbe4f5478ca3757e05db38799d014e4c7 Reviewed-on: https://chromium-review.googlesource.com/211931 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix application of vertex divisor for non-instanced draws in D3D9  BUG=398337  *Re-land*  ANGLE_instanced_arrays defines the behavior of the non-instanced draw calls (glDrawArrays glDrawElements) such that they behave as single-instance draws so the vertex divisor should still apply. We were handling this correctly in D3D11 but not D3D9.  This fixes a new WebGL conformance test: https://www.khronos.org/registry/webgl/sdk/tests/conformance/extensions/angle-instanced-arrays.html  Change-Id: I5ed09d41229c8996a78a3b55893c6a655a423644 Reviewed-on: https://chromium-review.googlesource.com/211930 Tested-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix nameless struct handling.  BUG=401296  The addition of layout qualifier handling in es3 development inadvertently broke handling of nameless structs.  Change-Id: I805bab7a981d1f7f6227ae043720296fc3454662 Reviewed-on: https://chromium-review.googlesource.com/211860 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Revert "Fix application of vertex divisor for non-instanced draws in D3D9"  Other issues turn up on the FYI bots with this patch applied; reverting until this is investigated further.  This reverts commit 9f6907bfdd4cf95d20408831b1776a6efd221ab3.  Change-Id: Ib30c51b2c905e87973c73b06baa4b8ebba31d210 Reviewed-on: https://chromium-review.googlesource.com/211683 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix application of vertex divisor for non-instanced draws in D3D9  BUG=398337  ANGLE_instanced_arrays defines the behavior of the non-instanced draw calls (glDrawArrays glDrawElements) such that they behave as single-instance draws so the vertex divisor should still apply. We were handling this correctly in D3D11 but not D3D9.  This fixes a new WebGL conformance test: https://www.khronos.org/registry/webgl/sdk/tests/conformance/extensions/angle-instanced-arrays.html  Change-Id: Ib50e189d866d6dc97612e46460db4ca1723b3662 Reviewed-on: https://chromium-review.googlesource.com/211445 Tested-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Regenerate default projects for recently added shader translator changes.  Change-Id: Ic9b8758477d334a0dcd564f5f2548b5a64584fc7 Reviewed-on: https://chromium-review.googlesource.com/211444 Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
For SCALARIZE_VEC_AND_MAT_CONSTRUCTOR_ARGS assign precision to temp variables.  Otherwise on Windows or other platforms with GLES backend using this workaround will trigger shader compile failure.  For the moment to simplify the workaround for any missing precisions in float we always assign the highest available precion to it.  BUG=angle:695 TEST=webgl conformance tests  Change-Id: I810579442bc7fc61d6a52b76aff31a779046fa22 Reviewed-on: https://chromium-review.googlesource.com/211253 Tested-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Unifying the various texture interfaces where possible  Also fixed diamond inheritance pattern that was causing trouble on Windows 8  BUG=angle:688 angle:720 Change-Id: I678826bd4f3927c68ca1eb2e018dbb5aad33a8cc Reviewed-on: https://chromium-review.googlesource.com/211037 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix GN build with missing ShaderVars.cpp.  Change-Id: I29be6cdda643f83a40a6adc9b76153667aafcc51 Reviewed-on: https://chromium-review.googlesource.com/211400 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Add compiler option SH_REGENERATE_STRUCT_NAMES.  BUG=angle:701 TEST=webgl conformance tests  Change-Id: I13b35900956e7d840d5891a5bab90a400347cd6f Reviewed-on: https://chromium-review.googlesource.com/209229 Tested-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org>, 23355681, 619, 169, 619
Export shader variables from the translator DLL.  This will allow us to use these methods when compiling the translator as a DLL.  BUG=angle:466697  Change-Id: Ic9169fb7c69fe0bf5f98addfc128a30ee6b2159d Reviewed-on: https://chromium-review.googlesource.com/208752 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Move implementation of hasMappedBuffer to State.  Refactoring patch only.  BUG=angle:571  Change-Id: Ib9f3145eaa457d94e488fd42eb4c4b9133768996 Reviewed-on: https://chromium-review.googlesource.com/210643 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix incorrect validation of ES3 internal format/format/type combinations.  * Fix wrong internal format being passed to ValidateTexImageFormatCombination. * Fix ValidateTexImageFormatCombination validating the format instead of   internal format for general support. * Fix support checks for format and type comparing with wrong format and   type fields. * Add an early-out in format and type check loop to reduce iterations.  BUG=angle:658  Change-Id: I05e1b9f58b2e5ac4b5e1c0fa5a45cf37fb6a4ccd Reviewed-on: https://chromium-review.googlesource.com/210884 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Generate VS2013 public projects.  Allows us to support 64 bit builds in the packaged project files.  BUG=angle:714  Change-Id: I7e2f57ec87d1c46b348a4821821d1e21be671e49 Reviewed-on: https://chromium-review.googlesource.com/210825 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove the unusused Renderer::getSRGBSupport method.  BUG=angle:658  Change-Id: I3c8331dfc9c1046b528e9c4a7da3411d84f8ae3c Reviewed-on: https://chromium-review.googlesource.com/207120 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix wrong comparison in Buffer ASSERT.  We were using >1 instead of <=1. Caused false errors in Debug.  BUG=angle:716  Change-Id: I7072df99f208bd2e0a687143faeef6c9be79728e Reviewed-on: https://chromium-review.googlesource.com/210990 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make the HugeSetDataTest more robust.  By starting from a near-maximum size and trying until we reach a a valid allocatable size we can guarantee the test can run. Previously the allocation could fail under some systems and succeded in others leading to flakiness.  BUG=angle:716  Change-Id: If1690349f7028c4e6a88f20649fb255ea2dd2587 Reviewed-on: https://chromium-review.googlesource.com/210992 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Simplify formatutils9 by exposing the internal structures.  BUG=angle:658  Change-Id: I8134cde4d72796c51613594e15aded86e83c4af7 Reviewed-on: https://chromium-review.googlesource.com/206837 Reviewed-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix single buffer copies.  In D3D11 the device doesn't allow overlapped buffer copies unless the D3D11_FEATURE_DATA_D3D11_OPTIONS::CopyWithOverlap feature is enabled. This isn't technically available until D3D11.1.  Get around the restriction by using a different storage buffer as the source of the copy.  Fixes funcional.buffer.copy.single_buffer.* in dEQP.  BUG=angle:715  Change-Id: I03fea8a1c6180a29e07e05022e3454524e320803 Reviewed-on: https://chromium-review.googlesource.com/210902 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Fix a stray quote that snuck into GLSLTest.cpp.  This was causing a test failure in TwoElseIfRewriting.  BUG=angle:716  Change-Id: I75e21ff586cdef10f0c35985a97fbb7c4783d2fe Reviewed-on: https://chromium-review.googlesource.com/210991 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Prettify HLSL compile retry error messages.  We were inserting excess newlines in several places.  Change-Id: I746334d3696e9e3be585ab02074384ae63535ea5 Reviewed-on: https://chromium-review.googlesource.com/210823 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Simplify formatutils11 by exposing the internal structures.  BUG=angle:658  Change-Id: I8a4ce5f45054a1fa829a9647a94cf2bd0ba93bc0 Reviewed-on: https://chromium-review.googlesource.com/206836 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix shaders with invariant keyword.  We would trigger assertion failures in Debug mode and fail to parse and translate correctly in Release.  BUG=angle:711  Change-Id: Ibb7f33b288376617598578f48c7bbdbdec044279 Reviewed-on: https://chromium-review.googlesource.com/210822 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Fix non-square matrix-to-matrix constructors.  This fixes some broken tests in dEQP: functional.shaders.conversions.matrix_to_matrix  BUG=angle:712  Change-Id: I0538595f2913a2c1d4f0da901d65d608a6580d19 Reviewed-on: https://chromium-review.googlesource.com/210882 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Fix non-square scalar-to-matrix constructors.  This fixes some broken tests in dEQP: functional.shaders.conversions.scalar_to_matrix  BUG=angle:712  Change-Id: Ia01d720307ea6ca70da266b2085a878eaaab2412 Reviewed-on: https://chromium-review.googlesource.com/210881 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Allow gyp to generate 64 bit project files for VS2012.  Visual Studio 2010 express was the last version to not support 64 bit configurations.  BUG=angle:714  Change-Id: Ie4383a437a98cecfc82702e766a460ade96062f8 Reviewed-on: https://chromium-review.googlesource.com/210824 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix VertexBuffer11::getSpaceRequired for instanced attribs.  The computation could copy more data than needed. Although benign it could cause performance degredation compared to the D3D9 back end.  Change-Id: I3cf1dc79085c33d44040fd55153e63a4e5e63cb1 Reviewed-on: https://chromium-review.googlesource.com/210640 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Simplify formatutils.h by exposing the info structures.  Removed all the separate query functions and simply expose the internal info structures.  This reduces the number of std::map/std::set operations that were hidden behind the API.  Moved the validation tables for ES3 format combinations and effective internal formats into validationES3.cpp so that formatutils.h only has generic GL format queries.  BUG=angle:658  Change-Id: Ieb60d42b8eafcdb4f21dcbec130b39478ce5f7c5 Reviewed-on: https://chromium-review.googlesource.com/206835 Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add missing cache clears to D3D buffer classes.  BUG=angle:709  Change-Id: I93f92b916a0da26975cd459399cc2873cb4ab9f0 Reviewed-on: https://chromium-review.googlesource.com/210642 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Fix CopyBufferSubData.  We were passing the arguments from the gl::Buffer stub to the implementation class which was breaking the call.  Also clean up a few comments.  BUG=angle:709  Change-Id: Ib92a36d1c52d60d8929f567d0daf54e9d6a2d127 Reviewed-on: https://chromium-review.googlesource.com/210641 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Fix GN build for libEGL.  Our build in GN differed slightly from our gyp build causing the linker to complain about inconsistent linkage. Also remove some stray definitions of EGLAPI from our headers.  Change-Id: I5d3a09ccb0cec528ead33944ce0996cceed32d86 Reviewed-on: https://chromium-review.googlesource.com/210821 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix GN build for libGLESv2.dll.  In a previous fix to a Clang build error we had neglected to update the GN build. Broken in commit 07d49ef535.  BUG=angle:707  Change-Id: Ic11aa907d591540e915bec60f3bafaea471689d5 Reviewed-on: https://chromium-review.googlesource.com/210652 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brett Wilson <brettw@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add new shader inspection APIs.  Each new entry point corresponds to one of the variable types: varyings attributes uniforms output variables and interface blocks. They return a pointer to the vector with all of the parsed variables which then the app can copy to its own memory.  Currently we do not support the staticUse field in the HLSL translator.  BUG=angle:466  Change-Id: I7dc09e761ab070feef5360ad27740110c44853b3 Reviewed-on: https://chromium-review.googlesource.com/208750 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Move shader variables header to include folder.  This allows the API to query for clear type introspection into the parsed GL types from the translator. The returned types are not expanded and have properly nested fields.  This patch uses the types from ShaderVars.h to return GL type information. The app must include this header to get access to the types structs.  BUG=angle:466  Change-Id: I28ad0d6f11a964804dd234ef0d00651f665d1ae3 Reviewed-on: https://chromium-review.googlesource.com/208751 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Move shadervars constructors to cpp files.  This avoid unnecessary binary bloat from STL default constructors and assignment operators.  BUG=angle:466697  Change-Id: I679e524d3e3dbd0d3866fc30a5a01967d8769249 Reviewed-on: https://chromium-review.googlesource.com/208356 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: bratell at Opera <bratell@opera.com> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Update non-default constructors in shadervars.h.  Most of these constructors are unused. Remove the unused ones and change the usage of existing constructors to be consistent.  BUG=angle:466697  Change-Id: I455dd314036e1dfcb8c4690bab577b81dd0e060c Reviewed-on: https://chromium-review.googlesource.com/208355 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Revert "Unifying the various texture interfaces where possible"  This reverts commit 8c9038d6f57a4b53c97c4fb803259e7a50ab4cea.  Change-Id: I29c25121870e6f8d12144d235029f46fff90be7c Reviewed-on: https://chromium-review.googlesource.com/210651 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Unifying the various texture interfaces where possible  BUG=angle:688 Change-Id: I43be738e0a42f7a7e1448e1d9300b30d4bc54125 Reviewed-on: https://chromium-review.googlesource.com/209343 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Add a test for multisampled PBOs.  We don't allow ReadPixels from multisampled targets in GL.  Also update the assertions in Buffer11 to reflect our expectations.  BUG=angle:511  Change-Id: Ia3d5f796f5405fbae1187f3d45b0080d7f24b6d9 Reviewed-on: https://chromium-review.googlesource.com/210053 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Remove the MajorShaderModel member from Context.  BUG=angle:658  Change-Id: Iab7906309f6603d5364d891bb332af8c3bf457fe Reviewed-on: https://chromium-review.googlesource.com/206834 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Use the FormatCaps for multisample validation and queries.  BUG=angle:658  Change-Id: Ic9fa53fb62d7eff62f07b68d7ddada461ecad859 Reviewed-on: https://chromium-review.googlesource.com/206832 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Avoid D3D11 primitive restart index using 32-bit indices  D3D11 interprets an index value of 0xFFFF in a 16-bit index buffer as a primitive restart marker. This behavior can't be toggled off. http://msdn.microsoft.com/en-us/library/windows/desktop/bb205124(v=vs.85).aspx We work around it by converting to 32-bit indices.  BUG=angle:708  Change-Id: Ibc92d6ba98e5f11a98d76cae14f90ca050a19964 Reviewed-on: https://chromium-review.googlesource.com/209883 Tested-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use D3D11 Renderer for ANGLE Tests.  Many of our tests rely on extensions and ES3 support. Until we have the ability to switch between Renderers for specific tests the D3D11 Renderer should enable many failing tests to pass.  Also fix a double-delete crash in the test cleanup routine.  BUG=angle:702  Change-Id: I5e615ca1a35bd109d9f7bcbb5fa90b88e09157bd Reviewed-on: https://chromium-review.googlesource.com/209102 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Removing D3D-isms from gl::Texture  BUG=angle:688 Change-Id: I0cdc758000993f2d54240c69a84f5ae149306d9e Reviewed-on: https://chromium-review.googlesource.com/209332 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Fix Clang warning with preloaded D3DCompiler string.  Clang was complaining that we were casting a char* to a wchar_t*.  BUG=angle:707  Change-Id: I063165e9add4e9b57d131181da30c05e5abbc1c2 Reviewed-on: https://chromium-review.googlesource.com/209618 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix masked ClearBuffer.  We were not properly setting the masked channels for these APIs. Since we use a std::vector for tracking the render targets for a particular ClearBuffer call we lose the indexing into the clear parameters. Fix this by storing the information in the std::vector along with the Render Target.  BUG=angle:702  Change-Id: Ie3b1e870aa04054411c4f155682b86a340ec00cf Reviewed-on: https://chromium-review.googlesource.com/209103 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove try-catch blocks from entry points.  BUG=angle:700  Change-Id: I036901c397053a75677923304d7e1ed697c82aa2 Reviewed-on: https://chromium-review.googlesource.com/209570 Reviewed-by: <ehsan@mozilla.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix Clang warnings.  MSVC's more permissing validator missed a dependent typename and deleting a void pointer.  BUG=angle:703704  Change-Id: I227b94c9c1590973d7b11b0ed0bfda32f2a71cec Reviewed-on: https://chromium-review.googlesource.com/209613 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a MemoryBuffer type to safely allocate large user data buffers.  MemoryBuffer has a similar interface to std::vector but returns a bool on resize to do error checking.  BUG=angle:700  Change-Id: Ib201eeb91b07f5b7f970e153f5d1e110f9b2fa55 Reviewed-on: https://chromium-review.googlesource.com/209612 Reviewed-by: Nico Weber <thakis@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactored Texture2DArray separated out D3D logic  BUG=angle:688 Change-Id: Ie3e5ac2bedcffb816ef1537575f09afb3f5e7a35 Reviewed-on: https://chromium-review.googlesource.com/208381 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Export include directories to dependents in GN.  Translator headers that are included by dependent code (example: ShaderLang.h) expect to be able to include files from "includes" (example: "KHR/khrplatform.h"). This automatically applies this include path to dependent targets.  Change-Id: I6990f66132562f142a6cdf8b8c434d2dbaad1c98 Reviewed-on: https://chromium-review.googlesource.com/209452 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Brett Wilson <brettw@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update the format table to check support for filtering and rendering.  Since filerability and renderability may depend on separate extensions use functions to determine their support.  Context now uses these functions to fill it's own TextureFormatCaps.  BUG=angle:658  Change-Id: Ib4dc877ba7c24f84a3823fd5aa2e01a3b3621705 Reviewed-on: https://chromium-review.googlesource.com/206831 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix ASSERT when rewriting else-if blocks with no else.  The code assumed an else-if would end in an else. We can also save a few allocations in the cases where there is no else.  BUG=angle:699  Change-Id: I550857366775b4a34aea97e117ef732297d3f448 Reviewed-on: https://chromium-review.googlesource.com/208681 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Fix buffer tests.  The names of the tests were not properly capitalized and the huge buffer test could fail unexpectedly when it was run after several prior tests which allocated large amounts of memory.  Change-Id: Ied5d1b6f56354e748f0df9d52658d14de9a559ac Reviewed-on: https://chromium-review.googlesource.com/209611 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove sh::InterfaceBlock member info.  We can compute the interface block member info entirely on the API side. This will allow us to get rid of some un-necessary code in the compiler.  BUG=angle:466  Change-Id: I664ffc82de5f2723156e51f4e9ffc07e4de162aa Reviewed-on: https://chromium-review.googlesource.com/207781 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Remove sh::Uniform::registerIndex and elementIndex.  With the previous cleanups these fields aren't needed any longer. We can also clean up some unused methods and simplify existing code.  BUG=angle:466  Change-Id: I96df8d152324bda5e6868b5eccdf52bdc09155e9 Reviewed-on: https://chromium-review.googlesource.com/207256 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Use the block encoder class to store uniform offsets.  This will allow us to use the same code path for assigning register information in all places. Because of this it fixes some long-broken dEQP struct uniform tests.  BUG=angle:466 BUG=angle:505  Change-Id: I4161a388503aa09bbe2d21ff47bfb3352ec93881 Reviewed-on: https://chromium-review.googlesource.com/207255 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Add a uniform register query to the translator.  This returns the uniform index that we assigned for default uniforms. All the dependent structure offsets can be determined from the base register so we won't have to store uniform information in the shader variable.  BUG=angle:466  Change-Id: I0dd05251e8dba00c20d09fd865dfb150de56738e Reviewed-on: https://chromium-review.googlesource.com/207254 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Added virtual destructors to VertexArrayImpl and BufferImpl  Change-Id: Ib9d8b2fc85b63f0cd52a2b19129a88ba7acbc017 Reviewed-on: https://chromium-review.googlesource.com/209380 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Nico Weber <thakis@chromium.org> Tested-by: Nico Weber <thakis@chromium.org>, 23355681, 619, 169, 619
Reduce the number of TextureFormatCaps members.  Since GL has no notion of texture formats that can be used for different types of textures merge the TextureFormatCaps texture support members.  Also merge the various renderability members since the texture type is enough to determine what type of renderable a format is.  BUG=angle:658  Change-Id: I7cba50b147fcca8f3880d65c06c57df9c65ed19c Reviewed-on: https://chromium-review.googlesource.com/206830 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix missing EGL extension function exports.  BUG=angle:490  Change-Id: Ie4e7b0075f60676aa5f9fb51a0d6fb8f84b9ed90 Reviewed-on: https://chromium-review.googlesource.com/207140 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update the samples and tests to use eglGetPlatformDisplayEXT.  BUG=angle:490  Change-Id: I5a685e42089377b5c600cd1f7ca8bd9a6654b3ba Reviewed-on: https://chromium-review.googlesource.com/204939 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add support for ANGLE_platform_angle.  BUG=angle:490  Change-Id: If3c897a9ae3d27b96e4b9bf9475a9ac23a1090ba Reviewed-on: https://chromium-review.googlesource.com/185396 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactored Texture3D separated out D3D logic  BUG=angle:688 Change-Id: I6cda73c2e4c8a026b8c5222bc40cea93ad4e0ba3 Reviewed-on: https://chromium-review.googlesource.com/208102 Tested-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactored TextureCubeMap separated out D3D logic  BUG=angle:688 Change-Id: I2300aaad4fab25df484e0bc3613ac3b176addc93 Reviewed-on: https://chromium-review.googlesource.com/208191 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Refresh generated projects.  Change-Id: I46845edcd6e8334ca56b411ecb8677dfaebf8a07 Reviewed-on: https://chromium-review.googlesource.com/208861 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Explicitly list files for the build.  Removes shelling out to enumerate_files for the main targets (tests and examples are currently unchanged) in favor of explicitly listing out the files in the build.  There are a number of reasons. My immediate reason is that doing this allows the file lists to be shared with the GN build so the GYP and GN builds of angle should mostly automatically stay in sync now. In addition I don't think we should be enumerating files in GYP. No other Chrome sub-projects do this and Chrome engineers expect files to be listed in .gyp* files. It's also slower to shell out a bunch of times to get the file lists (this matters more in the GN build which runs very quickly).  Updates the GN build to share these file lists. This unbreaks the Windows GN Angle build.  BUG=angle:698  Change-Id: Iab8829628aeb7232bb64f4c247c35c6485bba3ee Reviewed-on: https://chromium-review.googlesource.com/208461 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Brett Wilson <brettw@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix style violations.  BUG=angle:650 TEST=no behavior change  Change-Id: I3096615a181b1ec2c18ce60566c3d6249975b84e Reviewed-on: https://chromium-review.googlesource.com/208569 Tested-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix test class names to reflect their class-ness.  Style guide dictates a camel case scheme for classes. Since the tests are actually classes update their names to reflect that.  Change-Id: Ib7422b6d8c5de8414765439704fc103eae8b2d63 Reviewed-on: https://chromium-review.googlesource.com/208680 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix "error: extra qualification 'rx::ImageD3D::' on member 'makeImageD3D'"  As reported by GCC 4.8.1/MinGW.  Change-Id: If62d234074a0a9180f1f3c3619dbb2dd8047d0f3 Reviewed-on: https://chromium-review.googlesource.com/208670 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Brandon Jones <bajones@chromium.org> Tested-by: Andrew Knight <andrew.knight@digia.com>, 23355681, 619, 169, 619
Do not create dummy variables when linking uniforms.  This cleanup prepares us for removing the uniform register info from the shader translator types.  BUG=angle:466  Change-Id: I86f47970b793135f410a5ef698fc96d44219ee96 Reviewed-on: https://chromium-review.googlesource.com/207253 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Refactor ProgramBinary uniform linking code.  This prepares us for moving most of the register assignment to the ProgramBinary class itself and cleans up the various methods.  BUG=angle:466  Change-Id: Ie2965ed41ac50617584fd7a6d7b0ec2784e7dfaf Reviewed-on: https://chromium-review.googlesource.com/207252 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Add a compiler option to rewrite vec/mat constructors  If one of the parameters is a vec/mat expand it into scalars.  This is to work around Linux NVIDIA/AMD and Mac NVIDIA driver bugs.  BUG=angle:695 TEST=webgl conformance test  Change-Id: I35e1e25167d99f873dcb03bfb57a30e84b1aeed5 Reviewed-on: https://chromium-review.googlesource.com/207479 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Remove the sh::InterfaceBlock::dataSize member.  We can replace this by doing the same calculation in the HLSL-side code.  BUG=angle:466  Change-Id: Iecae4a92e9037e851419ce73e6267094ee8071a2 Reviewed-on: https://chromium-review.googlesource.com/207251 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Remove sh::InterfaceBlock::registerIndex.  This value is HLSL-only and we can use the new query API to hide it from GLSL programs.  BUG=angle:466  Change-Id: I75dc2fbbf1b29b1f6d561568174a15dea1f5b130 Reviewed-on: https://chromium-review.googlesource.com/207250 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Refactored Texture2D separated out D3D logic  BUG=angle:688 Change-Id: I93c2ff0b125278234d61324844b79cc58135d4d8 Reviewed-on: https://chromium-review.googlesource.com/207675 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Refactors State to be a fully-qualified class  BUG=angle:685  Change-Id: I36cff2da985a12c7180fe2850ccd471f4cebbaad Reviewed-on: https://chromium-review.googlesource.com/206634 Tested-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Removes sub-entry-point Framebuffer validations  BUG=angle:685  Change-Id: I2d630396a5971972f858cca9c39ceb6509492aa4 Reviewed-on: https://chromium-review.googlesource.com/205836 Tested-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Cache bound FBO and VAO objects themselves in State  BUG=angle:685  Change-Id: I19ae6752d1a7490122dd9ca076efb08564e1901d Reviewed-on: https://chromium-review.googlesource.com/205835 Tested-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fixes for re-enabling more MSVC level 4 warnings: angle/ edition  This contains fixes for the following sorts of issues: * Signedness mismatch  BUG=81439 TEST=none  Change-Id: Ief116d4b79b63479641259119246bb1465bbfd1f Reviewed-on: https://chromium-review.googlesource.com/207418 Reviewed-by: Alok Priyadarshi <alokp@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Moved TextureStorage and Image into d3d  BUG=angle:688 Change-Id: I98ffa1082340a829a77fe5082958898b9c6ab1a2 Reviewed-on: https://chromium-review.googlesource.com/207054 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Move more draw call validation to the API.  The GL expects us to reject invalid draw calls before we start doing any work so we can prevent internal unnecessary state changes.  Also update the program binary's cached sampler data when we validate. The previous patch was breaking draw calls in Google Earth WebGL.  BUG=angle:571 BUG=390412  Change-Id: I1c4e204ae2467afc36b76af975a3a49e26349639 Reviewed-on: https://chromium-review.googlesource.com/206482 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix CollectVariablesTest GCC/Clang compile errors.  BUG=angle:696  Change-Id: I193f6771d85f2b777e84dc4d650b50fb31875489 Reviewed-on: https://chromium-review.googlesource.com/207770 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Store a map of interface block registers.  The shader translator can return the assigned register for a block via a new API. This will let us delete the member variable in interface blocks for the register -- a nice thing for GLSL.  BUG=angle:466  Change-Id: I9bc38e0cd031e32f90787be42c2324fc7c79dbf9 Reviewed-on: https://chromium-review.googlesource.com/206828 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a default constructor to sh::ShaderVariable.  This cleans up a few repeated lines of code in shadervars.h.  BUG=angle:466  Change-Id: Ie77130e8420d28df790bf9bc036d52fd053b3ce9 Reviewed-on: https://chromium-review.googlesource.com/206827 Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Collect shader outputs and interface block information.  This paves the way for returning ES3-specific info from the shader translator with the new query methods.  BUG=angle:466  Change-Id: Ib13cdb604854cdf11e9dc00dd94f18eadc946561 Reviewed-on: https://chromium-review.googlesource.com/206770 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix 64-bit warnings.  BUG=angle:631  Change-Id: I76439ca2549916d594a54a4a9a35387d80b023ba Reviewed-on: https://chromium-review.googlesource.com/207441 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Split Caps into Caps Extensions and TextureFormatCaps.  Context now holds it's own Caps Extensions and TextureFormat caps so that it can modify them based on client version or work-arounds.  BUG=angle:658  Change-Id: Id71b6c89b7aa36e1f3dc42b0e4720eaed1851fb9 Reviewed-on: https://chromium-review.googlesource.com/206480 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Clean up generatemip.h.  * Move "private" functions into generatemip.inl. * Use size_t for all dimensions. * Use uint8_t pointers instead of unsigned char pointers.  BUG=angle:666  Change-Id: I8a1324802e4d670c042e0961c2b6f6fd53f4ebc7 Reviewed-on: https://chromium-review.googlesource.com/202503 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Clean up the functions in loadimage.h/cpp.  * Capitalize the function names to fit the style guide. * Use explicit sizes in the function names to avoid any confusion about   input or output sizes. * Use explicit sized types in the functions to avoid potential issues on   new platforms since a lot of bit-twiddling is used. * Use size_t for all sizes. * Use uint8_t for all binary data for input and output data so that pointer   arithmetic is much easier. * Move templated function definitions into an .inl file so that   loadimage.h looks as clean as possible.  BUG=angle:665  Change-Id: Id7173ed66d9e1b7ee3261eea11e77d838cbd2951 Reviewed-on: https://chromium-review.googlesource.com/202590 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix build errors in validationES.cpp.  This was caused by a bad auto-merge with the Caps patch.  BUG=angle:694  Change-Id: I589d4dafb7ed890d7c340c9ae98080dff945c69a Reviewed-on: https://chromium-review.googlesource.com/207540 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove redundant FBO query methods.  Several query methods simply wrapped a NULL check with a default return value. Most of these safety checks were unnecessary.  BUG=angle:660  Change-Id: I0ac6897f06be082c8efab8721920d1b51ba999ee Reviewed-on: https://chromium-review.googlesource.com/205606 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor common attachment validation to base method.  Split the validation of FBO attachment binding to common methods and separate logic for layers and for 2D attachments.  BUG=angle:571  Change-Id: I9a59055cca60dd853311751be355440ad1e5ead0 Reviewed-on: https://chromium-review.googlesource.com/205605 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Store compact and expanded shader variables.  The current shader API ShGetVariableInfo relies on an expanded list of shader variables. That means that struct or user-defined variables are expanded into separate entries for the app to easily query struct members. The new API will preserve the struct layout so we can store both to support both the old and new queries.  BUG=angle:466  Change-Id: Id30a1d7d1bb49c7e745510e0d699f94ad3184b9c Reviewed-on: https://chromium-review.googlesource.com/206569 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Add caps for texture size limits and other caps in the 6.28 table.  BUG=angle:658  Change-Id: Ia265fe1d3713db7701b41e8430d6d186f352ab4a Reviewed-on: https://chromium-review.googlesource.com/201363 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a GetVariableInfo helper method.  This method replaces the similar logic in storing uniforms varyings and interface blocks when collecting variable info. We can also re-use this method for both GLSL and HLSL programs.  BUG=angle:466  Change-Id: Ie6c13abe0f09f38b2f9b36e117caae4833eaccbf Reviewed-on: https://chromium-review.googlesource.com/206566 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Add missing limits include to angleutils.h  This missing include was breaking the build on Linux.  BUG=angle:692  Change-Id: Id502f477d6e3373519b011e75c144782e9101944 Reviewed-on: https://chromium-review.googlesource.com/206633 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor style in VariableInfo.cpp.  This patch simplifies the functionality change in a subsequent patch.  BUG=angle:466  Change-Id: Ib1c360438fad74fb15cd6cbf983240229c0eee76 Reviewed-on: https://chromium-review.googlesource.com/206568 Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Share ArrayString and Str helper methods.  Placing these string helper methods allows us to re-use them in the relevant place of the shader translator.  BUG=angle:466  Change-Id: Idd638542027d3b1035bc79fc941e80bf436c82af Reviewed-on: https://chromium-review.googlesource.com/206567 Reviewed-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fixed an issue with Streaming Vertex data overflowing it's buffer.  Bug=angle:689 Change-Id: Ia0ee6f951822901560888ea300a3889601fa1d89 Reviewed-on: https://chromium-review.googlesource.com/207010 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Improve the const correctness.  This improvement to the const correctness makes ProgramBinary::save compile with clang-cl as well which is more strict than MSVC.  Change-Id: Iae091643fa1df7f094b89dbe7529c4e173f04a6d Reviewed-on: https://chromium-review.googlesource.com/206714 Tested-by: <ehsan@mozilla.com> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a ValidateAttachmentTarget helper method.  This helper returns the appropriate error with the user specifies an attachment that is invalid or out-of-range (for indexed color attachments).  BUG=angle:571  Change-Id: I80ed347e3540579110e40e742fbacb0467cb85fd Reviewed-on: https://chromium-review.googlesource.com/205604 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add helper methods for FBO attachment validation.  Subsequent refactoring will eliminate duplicate code.  BUG=angle:571  Change-Id: I086320beb5c432c326d29d047931575e6f2a1d64 Reviewed-on: https://chromium-review.googlesource.com/205603 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Removed sampler state getters and setters from gl::Texture  BUG=angle:688 Change-Id: I3f203e4d10059c12a0c00e967ad6c7d3b3a18074 Reviewed-on: https://chromium-review.googlesource.com/206335 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Brandon Jones <bajones@chromium.org>, 23355681, 619, 169, 619
Fix HLSL compiler error with else-rewriting in functions.  In functions with return types where we would use if-else rewriting we would potentially generate a spurious HLSL error that warned of branches with no return value in the function.  This was causing a maps regression where overlays would not draw in Earth mode.  BUG=346463 BUG=391697  Change-Id: I9f4fa959057a3a2dab6cdd98f8381b5871cabf03 Reviewed-on: https://chromium-review.googlesource.com/206824 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Add a new TIntermRaw node type to translator.  This raw node stores text strings that we directly copy to the output. This allows for more tricky substitutions that don't fit in to the HLSL/GLSL shared parsing model.  BUG=346463 BUG=391697  Change-Id: Ibbde6db4fc98ef6d892f219631ca1a258a902a86 Reviewed-on: https://chromium-review.googlesource.com/206823 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix not rewriting else-if blocks.  We would miss expanding the else-if clauses in a chain of selection statements.  BUG=346463 BUG=391697  Change-Id: Iee644b875cf68d0ed3dc0b73542efc49ecb23242 Reviewed-on: https://chromium-review.googlesource.com/206822 Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Add ANGLE_NO_EXCEPTIONS macro  This macro allows us to hide angle's usage of try/catch so that we can properly hide them from compilers that do not support exceptions properly (such as clang-cl and gcc/clang with -fno-exceptions).  Change-Id: I75f466a5322e5840e007711ea851f444bd6ca299 Reviewed-on: https://chromium-review.googlesource.com/206562 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: <ehsan@mozilla.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Support building angle with clang-cl  This works around http://llvm.org/PR20013.  Change-Id: Ibbd8ab4678cf1caf39b329ea304bdbdc21075ddf Reviewed-on: https://chromium-review.googlesource.com/206481 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: <ehsan@mozilla.com>, 23355681, 619, 169, 619
Allow ConvertPrecision to return undefined.  The overly-restrictive check would fail on sampler types or other GL types with no defined precision.  This fixes failures on the Debug GPU FYI bots.  BUG=angle:691  Change-Id: I443b7038a7b7a05675898b9b21e6112b1ac4c5ca Reviewed-on: https://chromium-review.googlesource.com/206552 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix ConvertPrecision.  This method had never been fully implemented and was returning "highp" for every case value.  This should fix problems with the GPU FYI bots.  BUG=angle:691  Change-Id: Ie6ffa80cf2c063e506df06fb25d622227edeffa3 Reviewed-on: https://chromium-review.googlesource.com/206565 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix GCC warning about initialization order.  Shifting these fields was breaking the build in Linux GCC.  BUG=angle:690  Change-Id: I34286753f7ab636900f25f880187dbb297e9c040 Reviewed-on: https://chromium-review.googlesource.com/206632 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Consolidate shader variable storage in Compiler.  The Compiler base class now stores all the shader variables and interface block information instead of duplicating the information in the HLSL translator.  BUG=angle:466  Change-Id: Ia69079fde64fbd6b0cbfc66defd5e37d99ee3e6e Reviewed-on: https://chromium-review.googlesource.com/206020 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use shader variable types for variable collection.  Retire the old TVariableInfoList structure and use the new objects which we will expose more directly through the API.  BUG=angle:466  Change-Id: I999a97369bfb67cf73cd659c4fe885b41429d304 Reviewed-on: https://chromium-review.googlesource.com/205839 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Add GLES 3 types to the VariablePacker test.  These include the new sampler types non-square matices and unsigned int vectors.  BUG=angle:466  Change-Id: I0d88fadfc3f81a2d9be604ee1dffefd5a4a343c5 Reviewed-on: https://chromium-review.googlesource.com/205838 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Consolidate varying packing sort order methods.  We were using the same list in the shader varying sorting as well as in the varying packing validation in the translator.  BUG=angle:466  Change-Id: Ic11758288e7a522d7c18a293de9e137e487e3978 Reviewed-on: https://chromium-review.googlesource.com/205595 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Remove duplicate SH and GL functions.  In several places we were using variable query methods that were duplicated between the old SH enums and the corresponding GL enums. We can use the common GL enum versions now.  BUG=angle:466  Change-Id: Ib8797fe6bc75828e05aed37b1f5fbd4b9ba03d22 Reviewed-on: https://chromium-review.googlesource.com/205594 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Return shader variable information using GLenum values.  Instead of duplicating GL header define values explictly return GLenum for variable queries in the shader inspection API. This reduces the duplicate defines in the shader compiler header.  BUG=angle:466  Change-Id: Iddaaff597b188251fa2e546f352bf77ab3ac43bc Reviewed-on: https://chromium-review.googlesource.com/205860 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Nicolas Capens <capn@chromium.org>, 23355681, 619, 169, 619
Add support for EGL_EXT_client_extensions.  BUG=angle:490  Change-Id: Iafc476cef7a3d11b3bb3640e673c28c6df3cf2a1 Reviewed-on: https://chromium-review.googlesource.com/204566 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix d3dcompiler_46.dll case to be consistent unblocks swarming.  src/copy_compiler_dll.bat defines the case of the file copied to the build output directory. It is then referenced by build systems. The case must be consistent with the uses in isolate files and the .gypi file defining output.  BUG=390210  Change-Id: I90c305a0c3663d46d2448e0adfa3103d0ce457d1 Reviewed-on: https://chromium-review.googlesource.com/206305 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Revert "Move more draw call validation to the API."  BUG=390412  This reverts commit 9efa581d0e8f251b88f5a2f432ddb20655036c77.  Conflicts: 	src/libGLESv2/validationES.cpp  Change-Id: I78457e1dfec8b75fecef8dc40c549adbde680a2a Reviewed-on: https://chromium-review.googlesource.com/206340 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Revert "Return variable type queries using GLenum values."  Breaks the FYI bots until we get Chromium patched.  BUG=angle:466  This reverts commit 53221f5a0382887155d90f7f286e41190d4f5bfb.  Change-Id: Ib28548df5c10a6f76f46e4cf8f2013dca5cf0ee2 Reviewed-on: https://chromium-review.googlesource.com/205850 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Return variable type queries using GLenum values.  Instead of duplicating GL header define values explictly return GLenum for variable queries in the shader inspection API. This reduces the duplicate defines in the shader compiler header.  BUG=angle:466  Change-Id: If631b20ce68747297a946e1371def7709027a613 Reviewed-on: https://chromium-review.googlesource.com/204937 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix null pointer dereference in glGetBufferPointerv  BUG=angle:687  Change-Id: If8f215d4a86332b9e6e791263bdeeb44b23a42a2 Reviewed-on: https://chromium-review.googlesource.com/205711 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix double delete in Framebuffer.cpp.  Depth-stencil buffers were using the same pointer for both attachments which was causing a double-delete in the Framebuffer destructor.  BUG=angle:686  Change-Id: I8b263e5a084c33b495ce18ef2a2a810918ef6540 Reviewed-on: https://chromium-review.googlesource.com/205639 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactoring Buffers  BUG=angle:681 Change-Id: I6c3809e0b9468dfe38465c55759c2572c21485da Reviewed-on: https://chromium-review.googlesource.com/204896 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove the clientVersion parameter from the format utils.  clientVersion was only useful for intitial validation of formats and not required for queries.  Only use the client version and caps structure to validate if a format is available and then trust that it is supported past the validation layer.  Fixed some inconsistancies between tables such as missing formats or incorrect load functions in the ES3 tables.  BUG=angle:659  Change-Id: I8d33c902156ee6fb41efe937d93b0586191726e5 Reviewed-on: https://chromium-review.googlesource.com/201167 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add the BUILD.gn file to the ANGLE source.  The script currently lives in Chromium's build/secondary.  BUG=angle:683  Change-Id: I3ce11913fd27e0a01a1763d6ed973b250cf101d8 Reviewed-on: https://chromium-review.googlesource.com/205244 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use a common include for GL headers.  A common place to define required GL includes gives us a nice point to centralize GL customizations. In the header currently are the basic GLES headers with extensions and a define carried over from desktop GL.  BUG=angle:466  Change-Id: I6fc61947b4514654ec21355a786904eac04656c0 Reviewed-on: https://chromium-review.googlesource.com/204936 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Rename ShHandle.h to Compiler.h.  Since the above source file matches Compiler.cpp more closely follow our standard naming convention.  BUG=angle:466  Change-Id: Ib1422f87f16097f91f2bcdad550ec5bd940ce711 Reviewed-on: https://chromium-review.googlesource.com/204681 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Use the sh namespace for shader variables.  Since these types originate from the translator use an appropriate namespace. Also rename some of the gl helper functions to be more specific to their functionality.  BUG=angle:466  Change-Id: Idc29987b2053b3c40748dd46b581f3dbd8a6fd61 Reviewed-on: https://chromium-review.googlesource.com/204680 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Remove gl::IsInternalTextureTarget.  This function was a duplicate of ValidTexture2DDestinationTarget. Also clean up a bit of the code in Framebuffer::completeness.  BUG=angle:660  Change-Id: Iee8d011274bfb2e426346e3ccdde7342fbb7ef44 Reviewed-on: https://chromium-review.googlesource.com/202595 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove obsolete Renderbuffer types.  RenderbufferProxySet and FramebufferTextureBindingPointer aren't necessary any more with our refactored renderbuffer classes and ownership of attachments by the Framebuffer.  We can also consolidate the FramebufferAttachment and implementation to a single class and no longer need to store ref counted objects in the Framebuffer class directly.  BUG=angle:660  Change-Id: Idcc06dfb42b47242b33494e797a0ba06d6669511 Reviewed-on: https://chromium-review.googlesource.com/201838 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Moved D3D specific files and folders under the D3D folder.  Change-Id: I8afd67e08ee558fe94532c377d079673357a7192 Reviewed-on: https://chromium-review.googlesource.com/205229 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix npot Texture level 0 validation.  We were rejecting npot textures for level 0 even though it is valid in GLES 2 for non-mipped textures to have npot size.  BUG=381495  Change-Id: Iacc3ab50d6487ecba804fd8963aa0a2ada2f1cae Reviewed-on: https://chromium-review.googlesource.com/205220 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Regenerate project files  Change-Id: I6d3cc10335686922c028f5fba4525f62c71c3e59 Reviewed-on: https://chromium-review.googlesource.com/204951 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Remove the ES version check for buffer to texture copies in D3D11.  With PBOs being exposed through an extension in ES2 now this check is uneccessary.  Change-Id: I609a4bcd944194d104e0774e5f6ea34e072c8d9c Reviewed-on: https://chromium-review.googlesource.com/201320 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move FBO check from applyRenderTarget to the API.  We would traverse the applyRenderTarget path from several entry points which could then trigger a GL error. In-line with our validation refactoring move all error checks prior to executing any state logic.  BUG=angle:571  Change-Id: I51f5bcfa41be7cdba7771eb87d5a831fa622f984 Reviewed-on: https://chromium-review.googlesource.com/203772 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Move draw call primitive type check to the API.  A part of a larger refactoring to clean up the draw call validation.  BUG=angle:571  Change-Id: I0b220d68c04524a81ca11dc58e10c90e458cabde Reviewed-on: https://chromium-review.googlesource.com/203771 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Move more draw call validation to the API.  The GL expects us to reject invalid draw calls before we start doing any work so we can prevent internal unnecessary state changes.  BUG=angle:571  Change-Id: Ic71218b3c2d5dc310280d3738bb1387753a10e03 Reviewed-on: https://chromium-review.googlesource.com/203770 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Move stencil mask validation to before the draw.  ANGLE (and WebGL) restrict the back and front stencil masks on draw due to D3D restrictions. We would previously only validate this if the stencil was enabled in D3D9. In D3D11 we would validate the stencil masks even if the stencil is disabled which is the behaviour the spec suggests.  Moving the error check to before the draw also prevents any issue with interrupting a draw call mid-way through.  BUG=angle:571 BUG=378754  Change-Id: If7651c2be559eef64a872082e144dafa3b2c524b Reviewed-on: https://chromium-review.googlesource.com/203299 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Clean up libEGL.def.  BUG=angle:490  Change-Id: I6f0f707862066c9906aa38601aa6839b78a5cc39 Reviewed-on: https://chromium-review.googlesource.com/204565 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Update to the latest EGL headers.  BUG=angle:490  Change-Id: I205e680a40af18f2657096d4219bdac0f613fb11 Reviewed-on: https://chromium-review.googlesource.com/204563 Reviewed-by: Brandon Jones <bajones@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor and unify HLSL varying signatures.  We would use different code for all of our input and ouput stages in HLSL (vertex output GS input GS output PS input). This was causing an HLSL error and some bugs in certain transform feedback instances.  Fix this by using a helper method to use compatible code for each of the stages.  BUG=angle:667  Change-Id: Idada969a775eccb5788723e0c7fa3ade9cb2d9ec Reviewed-on: https://chromium-review.googlesource.com/203778 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Use a const_iterator in structsHeader().  This was breaking the build for some compilers (GCC on android).  Change-Id: Ibfe5603710961497b6c15aa2d9cb568096ca1dd4 Reviewed-on: https://chromium-review.googlesource.com/204897 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add end-of-file newline to StructureHLSL.cpp.  BUG=angle:680  Change-Id: I37aee0d136021a1ce1c3c398d680cdbc4820e6d0 Reviewed-on: https://chromium-review.googlesource.com/204905 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Disable dynamic pixel shader generation.  Always generate the same pixel shader no matter what framebuffer is bound.  BUG=angle:670  Change-Id: I3fa91ff43363d49b38a19d3815ea523946c675d5 Reviewed-on: https://chromium-review.googlesource.com/204573 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Split OutputHLSL uniform code into new module.  Refactoring patch only should have no externally visible changes.  BUG=angle:466  Change-Id: I01088a3b2979b96702d0a3c424d26928eb72b5b2 Reviewed-on: https://chromium-review.googlesource.com/203731 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Split OutputHLSL structure code into new module.  Refactoring patch only.  BUG=angle:466  Change-Id: I2c57096e1e24574e7de3d35d608645fde3b0c681 Reviewed-on: https://chromium-review.googlesource.com/203730 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Move OutputHLSL utility methods to other files.  OutputHLSL was become a large unweildy file. Some were also useful to other classes even on the GL back-end but were inacessible.  Refactoring patch only.  BUG=angle:466  Change-Id: Id216147122ca105c6ccdf0ba0c5f6c5038726965 Reviewed-on: https://chromium-review.googlesource.com/203459 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add support for EXT_sRGB.  BUG=angle:672  Change-Id: I001ff3dde7a39e545a535a399c02f3a6d91634c8 Reviewed-on: https://chromium-review.googlesource.com/203460 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Always store GL_DEPTH_COMPONENT32_OES as a 24-bit depth format.  Greatly simplifies the format utils by not having any internal format <-> DXGI format conversions depend on the client version. 32 bit floats and 24bit integers have very close precision in the [01] range so there should be no precision issues.  BUG=angle:659  Change-Id: Ife64445ef35f77283fc4c70c98754f5e87b6fb19 Reviewed-on: https://chromium-review.googlesource.com/202507 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix validation of LUMA formats in glGenerateMipmap.  BUG=angle:673  Change-Id: I6c106962d8a50ed8f69d208c537166a30e4f92c6 Reviewed-on: https://chromium-review.googlesource.com/203292 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix transform feedback type.  We were using the wrong enum for the varying type as well as using the row count of the type. We should be using the column count but for matrices we treat them as transposed.  BUG=angle:679  Change-Id: I0eb7f68f629a4372c6822f65b2de51ecc88a03ed Reviewed-on: https://chromium-review.googlesource.com/204520 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix buffer bugs affecting transform feedback.  Running dEQP-GLES3.functional.transform_feedback would trigger a few assertion failures because of some regressions that crept into our code.  Among the regressions is assuming we can't map a buffer that has no underlying storage object. This is valid since we sometimes allow setData without creating a native storage.  Additionally we should free our existing data store on a new call to SetData to prevent old but "new" data revisions from complicating our storage.  BUG=angle:679  Change-Id: Icd96a8a55a2b957d29382d8b8bbd7e8a7ab0cf65 Reviewed-on: https://chromium-review.googlesource.com/204342 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add queries for level and layer to FBO attachments.  BUG=angle:660  Change-Id: I03e76dd7743267dc0b57cf53a4d27cd75a5d5adf Reviewed-on: https://chromium-review.googlesource.com/201837 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add queries for object id and type to FBO attachments.  BUG=angle:660  Change-Id: Id91f6f2ae84eaefd59f9d568736bd99e3a27ef5d Reviewed-on: https://chromium-review.googlesource.com/201836 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix link error when using varyings with "dx_".  Varyings beginning with "dx_" would not get decorated properly or at all which could cause potential internal variables and certainly caused link errors. Fix this by no longer treating the "dx_" prefix differently.  Also fix our naming of "dx_Position" to be consistent with our other internal types.  BUG=angle:678  Change-Id: I03da0494a3d934d82ae7b3f8f12a576ff9bc3869 Reviewed-on: https://chromium-review.googlesource.com/203777 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Duplicate reused symbol table entries.  BUG=angle:651  Change-Id: Ifce3c19d41a0a5a5ca5ee90ede528adf397d1da5 Reviewed-on: https://chromium-review.googlesource.com/204290 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Split the ANGLE_platform_angle_d3d extension by adding child extensions.  Renames the ANGLE_platform_angle_d3d extension to ANGLE_platform_angle which acts as an umbrella extension for all the angle display types but requires the sub-extensions (d3d opengl software) to be present for the enums to be valid (similar to the OES_framebuffer_object extension).  BUG=angle:668  Change-Id: I2c00021558d8b781b20f948f5e0df03f734bd033 Reviewed-on: https://chromium-review.googlesource.com/202597 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a macro for unused trace variables.  This fixes the standalone 64-bit Debug build.  Change-Id: I348b71a96ada435867367e565bc84b570d2bfb67 Reviewed-on: https://chromium-review.googlesource.com/204292 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix compile warnings with attributes.  BUG=angle:676  Change-Id: I291c0b618854179f726cb4c969fb65182d3b591e Reviewed-on: https://chromium-review.googlesource.com/204340 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Implement support for constructing a 2x2 matrix from a vector.  BUG=380353  Change-Id: Ica0b94104e39f87b4a3439df40221b1f682fd678 Reviewed-on: https://chromium-review.googlesource.com/203293 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Refactoring VertexArrays  BUG=angle:676 Change-Id: If17b05ab667d79adcaacfbd1811ed92c0ce47fff Reviewed-on: https://chromium-review.googlesource.com/203294 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove Renderer pointer from FBO attachments.  Removing the Renderer pointer is one step towards making FBO attachments a minimal state object. Eventually we will be able to store them as arrays instead of arrays of pointers.  BUG=angle:660  Change-Id: Idce34e06c339ecb18c60fef12d2ed911d0c4e0f6 Reviewed-on: https://chromium-review.googlesource.com/201835 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Add new ref-counted Renderbuffer class.  Renderbuffers are a clear object type in GL and this patch adds a more consistent state representation for them. They're managed by the ResourceManager and have a storage implementation similar to Textures but much simpler.  BUG=angle:660  Change-Id: Ia17199bb8cb570d48db42e1f28ccbcc12a902fcf Reviewed-on: https://chromium-review.googlesource.com/201834 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix buffer overflow error on buffer resize.  We were using the new larger size for our buffer data copy step instead of the old smaller size. This bug was causing a crash on older nVidia drivers during normal browser usage.  Reproducible with the index-validation-large-buffer WebGL test.  BUG=angle:667 BUG=384420  Change-Id: I98ee893e0d8ba0bfc9adfe5a338da9b940248879 Reviewed-on: https://chromium-review.googlesource.com/203776 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix build warnings about unused private variables on clang  BUG=angle:638677  Change-Id: Id9e80f0b86d9c24633b2d353a409844c22441d21 Reviewed-on: https://chromium-review.googlesource.com/203429 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix dependent typename build error on non-MSVC compilers  BUG=angle:677  Change-Id: Ic0d257ef41e8c80baeddd664eb6c2cc5db94ee43 Reviewed-on: https://chromium-review.googlesource.com/203428 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix ifdef complaints in clang  BUG=angle:677  Change-Id: Iee457dfc0990e5ffd61932b1f286f3c0208568bc Reviewed-on: https://chromium-review.googlesource.com/203427 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Re-enable MRT on D3D 10 and 10.1 cards.  BUG=angle:670  Change-Id: I88b4823f25ec28fa52831d856ff9fb836fdfc533 Reviewed-on: https://chromium-review.googlesource.com/203120 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Generate pixel shader output to match the bound framebuffer.  Only generate pixel shader output variables for render targets that are currently bound.  Fixes some performance issues with D3D10 cards that were slow to discard unused outputs.  Fixed memory leaks in ProgramBinary by refactoring the freeing of the current state into a reset function.  BUG=angle:670  Change-Id: I40f83e15724fb9a1a9ae61363a056999f1fa26d2 Reviewed-on: https://chromium-review.googlesource.com/202977 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Eliminate conversion operations.  They've been replaced by using constructor nodes so any code handling conversion operators can be removed.  BUG=380353  Change-Id: I70413179e7443efccbf997a5dd0f053c23689589 Reviewed-on: https://chromium-review.googlesource.com/203453 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor draw validation functions.  We use a significant amount of code duplication in our draw validation that we can consolidate.  BUG=angle:571  Change-Id: I96787cbddf00d9289e368456fb85079d8acec513 Reviewed-on: https://chromium-review.googlesource.com/202975 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move draw call validation to new functions.  Separate draw call validation functions will give us a flexible base for refactoring and cleaning up all draw call validation.  BUG=angle:571  Change-Id: Ia8e3c83cfe48fedb8f2c7aef1fb282f646c66e82 Reviewed-on: https://chromium-review.googlesource.com/202974 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a std140 padding helper class.  Using a helper class keeps our main parser stateless as we define std140 structs which need padding. The only functional change should be that we no longer use a global counter for struct padding hidden variables but a local padding per-struct.  BUG=angle:466  Change-Id: I8b92d65884b86571c8b2f052b0cba6150a4bbab0 Reviewed-on: https://chromium-review.googlesource.com/202911 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Use a Caps structure to store extension and texture format support.  Removes support for fallbacks in D3D9 texture formats. The fallback formats did not work properly anyways.  BUG=angle:658  Change-Id: Idfa5183bf71fd8ebf4608f940f9d93177b9eff08 Reviewed-on: https://chromium-review.googlesource.com/200813 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use commit_id.py on Windows and handle missing git.  This allows us to delete the Windows batch file.  Changes the commit_id script to take the working directory so that it can be called from a different working directory than the angle repository is in.  Renames the generated commit header to angle_commit.h. This is being written to the shared generated code directory for the entire build and "commit.h" is insufficiently unique.  BUG=angle:669  Change-Id: I35e80411a7e8ba1e02ce3f6a4fc54ed4dbc918f3 Reviewed-on: https://chromium-review.googlesource.com/202048 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix crash on zero size but non-NULL bufferData.  Could cause a crash when running the WebGL CTS with Firefox.  BUG=angle:675  Change-Id: I58bf9eed622660d4702b775f368ff9cbd693197a Reviewed-on: https://chromium-review.googlesource.com/203456 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Produce constructors instead of conversions.  GLSL only supports explicit conversion through constructors. Therefore the conversion nodes are redundant.  BUG=380353  Change-Id: Id871c34750191dac431bf72aac9afed7b0db7f8e Reviewed-on: https://chromium-review.googlesource.com/203452 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Create constructors just once.  BUG=380353  Change-Id: I9828a3f193ccfdda2013fa3de0e41e6e28953ea2 Reviewed-on: https://chromium-review.googlesource.com/203451 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add constant casting support.  BUG=380353  Change-Id: I5a350ca09e2b7e7abb9fa079365adb5aad5af607 Reviewed-on: https://chromium-review.googlesource.com/203450 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Fix constructing vectors from matrices.  BUG=380353  Change-Id: I3b0fe55b829602554bb63bbd281ad58d47364502 Reviewed-on: https://chromium-review.googlesource.com/202966 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Restrict the size of shader arrays.  This prevents overflow issues in the HLSL translator and some drivers. The limit it hard-coded to 65536 to be larger than the Shader Model 5 register limit (4096) to account for register allocation optimizations and future hardware.  BUG=379799  Change-Id: I20f05c9dd230fbfc1c92af52533cd2b50f2ff994 Reviewed-on: https://chromium-review.googlesource.com/202939 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Refactor platform related functionality into platform.h and tls.h.  Since libGLESv2 and libEGL will eventually be cross platform it will be useful to have platform defines and TLS functions that work everywhere.  BUG=angle:664  Change-Id: Ia357925a0992d82e8b446d88d32a1984d319e6e8 Reviewed-on: https://chromium-review.googlesource.com/202133 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Report zero bit sizes for channels that shouldn't exist.  If the actual format has more channels than the internal format of a framebuffer bits counts greater than zero will be returned for channels that should not exist.  While it is not against the spec to return more bits than exist in the format it can be confusing for users or break tests.  get*Bits will now only return greater than zero bit counts when the format should have the given channel.  Since this is the only location that we return information about the "real" internal format we're using it's safe to only make the modifications here.  BUG=angle:653  Change-Id: I43ef4c6290c8c70737d579d7e9a2dd30d653330b Reviewed-on: https://chromium-review.googlesource.com/202594 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Store the std140 layout offsets in a pre-pass.  Instead of recording data and mutating a local table as we parse store all of the offsets for the std140 structs when we first generate the struct. This should have no behavioural change as structs should always be defined first in any case.  BUG=angle:466  Change-Id: I1b732d67bd4f5b908211410e5e7796d72d836174 Reviewed-on: https://chromium-review.googlesource.com/202910 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Refactor GLSL scoped structure handling.  With a unique ID similar to how we handle scoped structures in the HLSL translator we can simplify the declared structure check.  BUG=angle:618  Change-Id: I5fe61c8d353650ac67a7c7ecdf53a70b91a9b717 Reviewed-on: https://chromium-review.googlesource.com/202500 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Prevents multisample depthstencil from being bound as an SRV  BUG=381413  Multisample textures can only be bound as both depth stencil views and shader resource views at feature level 10_1 and above. We don't need to bind textures as SRVs if they're multisample depth targets so we should avoid the SRV flag in that case.  Change-Id: I28ca98bdc4a86eb5442b39ea3cf2b42aa9216aab Reviewed-on: https://chromium-review.googlesource.com/202921 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Move FBO attachment code to new source file.  Since FBO attachments and Renderbuffers are semantically distinct make a new location for attachments to live.  BUG=angle:660  Change-Id: I51753f8a814e89641637c5d8293f7e9a573a7ba5 Reviewed-on: https://chromium-review.googlesource.com/201833 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Rename Renderbuffer to FramebufferAttachment.  Part of the refactoring effort to clean up our classes for FBO attachments and Renderbuffers.  BUG=angle:660  Change-Id: Id23df904f56499568159611b66c8922b9dce6a3d Reviewed-on: https://chromium-review.googlesource.com/201832 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix up some validation bugs in Texture functions.  In several places we weren't handling certain errors or were returning the wrong error code. Several dEQP negative API tests are affected in functional.negative_api.texture.  BUG=angle:571  Change-Id: I19d7250aab2c15d709fd591b8df90ce883f9ac60 Reviewed-on: https://chromium-review.googlesource.com/201250 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Redesign HLSL scoped structures to a unique ID.  A unique ID gives a more flexible renaming scheme than our current method of using nested scope identifiers. The reduced complexity allows for fewer points of breakage and fixes an outstanding bug with scoped structures (with added test).  BUG=angle:618  Change-Id: I6551248bb9fa2d185ab67248721f898dd50151f0 Reviewed-on: https://chromium-review.googlesource.com/202183 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Regenerate public projects.  Change-Id: I57817666faca834e075216e63d7b0353d7a4d72c Reviewed-on: https://chromium-review.googlesource.com/202596 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix unused variable in validationES.cpp.  Broken in 560a8d889b6866d7d29d.  BUG=angle:571  Change-Id: Idb2414e11ad397cc45c2bdf5f357fd1b8e7fe6c2 Reviewed-on: https://chromium-review.googlesource.com/202602 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor CopyTexImage validation.  Move the common validation code to a shared base function.  BUG=angle:571  Change-Id: Id70b413b408a21f0a8933cfd4a09e261e637bae1 Reviewed-on: https://chromium-review.googlesource.com/200559 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix missing bracket in translator source.  Broken in ed14b79dc8e9ec4f4a831bb5213ab67ef01af196.  BUG=angle:628  Change-Id: Ia6b92dd13362bb51f0aa17a14278039d568f5434 Reviewed-on: https://chromium-review.googlesource.com/202182 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix edge case scoped structures name conflict.  Structures with names ending in "_#" such as "_0" could conflict with the internally rewritten scoped structures. Fix this by using a prepending rule instead of appending.  Also includes a test and fixes a WebGL test in Firefox. (Chrome is not affected because of the variable hashing step.)  BUG=angle:618  Change-Id: I3d441f1de268b6d7e74a0834b43e889b7bfe578c Reviewed-on: https://chromium-review.googlesource.com/201468 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Move the GL_APICALL and similar defines to the project level.  BUG=angle:658  Change-Id: Ib4fa10bb89a6658efbc20d5a763d8ec9c3a5506f Reviewed-on: https://chromium-review.googlesource.com/201465 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add include of common_defines.gypi for the angle_path variable.  BUG=skia:2272  Change-Id: I29540e009c41a1638e1a0399950621abbbbf2904 Reviewed-on: https://chromium-review.googlesource.com/201839 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix uniform bug from duplicate D3D9 shader pointers.  In D3D9 sometimes the compiler would return the same shader pointer on different calls to compile if the programs were similar. Work around this quirk by storing an applied serial for the program so we know when to refresh uniform data.  BUG=angle:661  Change-Id: I9750ee2298701dbe3f121dac6626198d24a2d1b2 Reviewed-on: https://chromium-review.googlesource.com/201562 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't allocate unused swap chain buffers  According to msdn.microsoft.com/en-us/library/windows/desktop/bb173075(v=vs.85).aspx the front buffer is the desktop and is not a dedicated part of the swap chain. Thus we should only need 1 swap chain buffer instead of the currently allocated 2. Samples in the DirectX SDK also only allocate just one.  BUG=angle:662  Change-Id: If88eeab1954cbc92b39ac7cf42f924515c4b77f9 Reviewed-on: https://chromium-review.googlesource.com/201860 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix warnings about unreferenced local variables.  BUG=skia:2272  Change-Id: Ibf03efedc662fea2a389ad2dc5af5b7b014181a8 Reviewed-on: https://chromium-review.googlesource.com/201900 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix register packing for structs in d3d9.  Fixes WebGL test misc/shader-with-array-of-structs-uniform  BUG=angle:656  Change-Id: If79a19db4d40bab9110422f7876de32e7f85e506 Reviewed-on: https://chromium-review.googlesource.com/200620 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Add a compiler query for the translator output type.  This is useful for determining if we are compiling to a D3D9 or D3D11 shader outside of the internal translator classes.  BUG=angle:656  Change-Id: Ib1c1d3de569edaa2b65c24c09d05aa4dd229d3e4 Reviewed-on: https://chromium-review.googlesource.com/201564 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use 'inout' qualifiers in generated HLSL for 'out' parameters.  With our added padding to some structures using only 'out' in the generated HLSL can cause warnings because not all of the structure members are initialized.  BUG=angle:286  Change-Id: I866960883de487f19883fb2bc086c02703ea6271 Reviewed-on: https://chromium-review.googlesource.com/201364 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Regenerate public projects.  Change-Id: Ibaccaa46457e9ee4379c137182673153a17f207d Reviewed-on: https://chromium-review.googlesource.com/201461 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix placement of windows.h include for Win 8.1 SDK.  The windows header must be included before versionhelpers.h.  BUG=angle:649  Change-Id: Ifee95b2918ea039f9a1c93ad0244bf2d35bd8570 Reviewed-on: https://chromium-review.googlesource.com/201462 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Make available EGL surface parameters queryable.  BUG=angle:331  Change-Id: Idb3c3ddc6ddd6bfc21b15b7e8942975ce4cd051f Reviewed-on: https://chromium-review.googlesource.com/200811 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Move state query validation out of Context.  Generate all GL errors in the validation helper functions instead of within the state manipulation logic and internals of Context.  BUG=angle:571  Change-Id: I7a3f540e2ae0f5f8c7126e2593717cc3200dd7e5 Reviewed-on: https://chromium-review.googlesource.com/200551 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Automate the DEQP tests by wrapping them in the gtest suite.  BUG=angle:497  Change-Id: If0a72c053bccccc4369ec78dd70173bbadb1be7b Reviewed-on: https://chromium-review.googlesource.com/200044 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Automate the es conformance tests by wrapping them in the gtest suite.  BUG=angle:497  Change-Id: If12b2dd79f9f666c5d686237d5663f316171b15c Reviewed-on: https://chromium-review.googlesource.com/200043 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix arrays-of-struct and nested struct uniforms.  Our computation of register offsets had a few errors that messed up nested structs and arrays of structs.  This fixes a WebGL test as well as several dEQP tests.  BUG=angle:505 TEST=WebGL CTS 1.0.3 dEQP-GELS3.functional.uniform-api  Change-Id: Id5a0f39481e079fe5ef5ef856943dc1f91ee3639 Reviewed-on: https://chromium-review.googlesource.com/200045 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move all uniform validation from ProgramBinary to API layer.  This will have the contract of having a successful API call once we call into the ANGLE internals having successfully passed valiation.  BUG=angle:571  Change-Id: Ia8d6eccc1e42bdf9e9cc5c10094a08729b42778a Reviewed-on: https://chromium-review.googlesource.com/200075 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor Uniform validation to validationES.cpp.  This patch also incidentally fixes some bugged validation in the new ES3 unsigned int uniform API entry points.  BUG=angle:571  Change-Id: I89bd909467bd9418fe5ce3f246561765cf27a5e9 Reviewed-on: https://chromium-review.googlesource.com/200074 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor UniformMatrix validation.  Move the shared validation logic to validationES.cpp.  BUG=angle:571  Change-Id: I2fb06a012703c647de2176914238b48665145c6f Reviewed-on: https://chromium-review.googlesource.com/200073 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix build warnings in x64.  A std::min/max with size_t and unsigned int.  Popped up in f98e63a54b8a2.  BUG=  Change-Id: I25f26ddbe7fb333f895be8a8dce3d3d73044c3f9 Reviewed-on: https://chromium-review.googlesource.com/200484 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix build on Windows 8.1 SDK.  The Windows 8.1 SDK includes a new DLL compiler DLL and is useful to test against so we should fix the few deprecated functions and warnings.  BUG=angle:649  Change-Id: I28bcf49564f3f7d7403d939d61dd78d3972281ba Reviewed-on: https://chromium-review.googlesource.com/199341 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Adds resource string generation to ANGLE  This will avoid Chrome source having to be updated each time that ANGLE's ShBuiltInResources changes.  BUG=374942  Change-Id: If54dba8351de9b261ff269e885f231547c08ff0a Reviewed-on: https://chromium-review.googlesource.com/200171 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Explicitly set the swap effect.  swapChainDesc.SwapEffect wasn't being set. The whole structure was initialized to 0 and DXGI_SWAP_EFFECT_DISCARD has value 0 so this should have no effect. Also sorted the field initialization in the order they're declared.  BUG=373360  Change-Id: If0113e7468c0bad024a07fec6ad9e223e19494b5 Reviewed-on: https://chromium-review.googlesource.com/200046 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Don't discard serials of zero from the set of bound framebuffer serials.  A serial of zero is a valid texture serial but it was used by RenderbufferStorage to denote a non-texture binding. Added a isTexture method to Renderbuffers and RenderbufferStorage has been updated to return -1 as the current texture serial to avoid collisions.  BUG=angle:633  Change-Id: Ie27e4b185ac09b48b593ae0dea02aeff5950a44f Reviewed-on: https://chromium-review.googlesource.com/200123 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Handle interface blocks in getVariableInfo and getUserDefinedVariableInfo.  BUG=angle:654  Change-Id: I07a230bbf2387e85168c50cb3719c669a7890f8a Reviewed-on: https://chromium-review.googlesource.com/199687 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix binary serialization to use explicit size and type.  Loading program binaries across different architectures would cause runtime errors due to use of size_t.  Also fix the ANGLE major and minor version that were clobbered in an earlier commit.  BUG=angle:647 BUG=371435  Change-Id: I9473cc7e119592fce336aa47881839543e337b69 Reviewed-on: https://chromium-review.googlesource.com/199633 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Optimize texture application in draw calls.  Gather all bound textures and samplers first and then pass them to generateSwizzles and applyTextures to reduce redundant get calls.  BUG=260069  Change-Id: I5b10dddb01a6bfd756c58b76218838cfc1fd59b6 Reviewed-on: https://chromium-review.googlesource.com/199343 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move validation of EndQuery out of gl::Context.  BUG=angle:571  Change-Id: I8913eb1b565a4282d9d84d06933e8b854453f17d Reviewed-on: https://chromium-review.googlesource.com/199349 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor BeginQuery validation out of gl::Context.  Part of our effort to relocate all validation logic to a preliminary pass outside of our state tracking or rendering layers.  BUG=angle:571  Change-Id: I5241daef6249910a781e78fd066debe0ab1d3f2b Reviewed-on: https://chromium-review.googlesource.com/199348 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use lowercase d3d header includes to fix ANGLE compilation on case sensitive OSes  The actual D3D header filenames are all lowercase.  Change-Id: I8f78d618d44360d34b5b01eb5a1972b35f2f15b7 Reviewed-on: https://chromium-review.googlesource.com/199692 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Add READ/DRAW_FRAMEBUFFER_BINDING_ANGLE to getQueryParameterInfo  Change-Id: I3e7f5cb0b4d2829eef86b878ffede0ac86279f57 Reviewed-on: https://chromium-review.googlesource.com/199684 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix code style violation in compiler/preprocessor  BUG=angle:650 TEST=no behavior change  Change-Id: Ib52f15f6471fc7897b66d11baee11216cf08158a Reviewed-on: https://chromium-review.googlesource.com/199591 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Track if uniform data has been updated to avoid extra Map calls.  Compare all uniform data to the values currently stored in the uniform and only mark the uniform as dirty if the data is new.  This saves lots of buffer map calls when the same data is set on a uniform many times.  BUG=260069  Change-Id: Ic4df8a276a81b074211712ff50e5cc4d0d9bb612 Reviewed-on: https://chromium-review.googlesource.com/199346 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove references to software rendering in Renderer9.  BUG=angle:641  Change-Id: I3724c2504d43eae0528e8c72eb51e96c9d7c7a71 Reviewed-on: https://chromium-review.googlesource.com/198377 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Minimize the API calls done by InputLayoutCache::applyVertexBuffers.  Reduce the number of IASetInputLayout calls to 1 in all cases and set the fewest number of buffers at once.  BUG=260069  Change-Id: I059337fc6601ecefd801ef37546935becaa0d355 Reviewed-on: https://chromium-review.googlesource.com/199345 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Optimize Texture*::updateStorage by iterating over fewer levels.  Only update the storage on levels that exist.  Especially helps for cube maps which have 90 images that would be iterated over in all cases.  Added an additional early-out check if the image is dirty for cube maps to match the other texture types.  BUG=260069  Change-Id: I3d298f4f9ebdc23136a31138a3ef8364667fa78c Reviewed-on: https://chromium-review.googlesource.com/199344 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Split register allocation of varyings from the translator.  The translator gl::Varying struct does not need to know about register allocation. We can put that entirely in the API library. This makes exposing Varying variables with the new translator types cleaner.  BUG=angle:466  Change-Id: Ib85ac27de003913a01f76d5f4dc52454530859e6 Reviewed-on: https://chromium-review.googlesource.com/199736 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove gl::Varying::elementIndex.  We only assigned to elementIndex and never referenced the value at any point in our code.  BUG=angle:466  Change-Id: I541a353110bcd1863b07b21bcf21fad38be19ca1 Reviewed-on: https://chromium-review.googlesource.com/199735 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Fix binary serialization to use explicit size and type."  This reverts commit 261988513e89479a0d121d045a8d89b64dc68214.  Change-Id: I959ca14fcbb257f12005f7f0b64a600e906a118c Reviewed-on: https://chromium-review.googlesource.com/199630 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Attempt an Mac build fix  BUG= TEST=mac bots build on GPU.FYI  Change-Id: I3dd2b07702e8c0a40d64ab973eb969ba50954640 Reviewed-on: https://chromium-review.googlesource.com/199611 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix code styles in OutputGLSLBase SymbolTable and Types.  I came across these three classes in the last CL so do some cleanup as I touched these classes.  BUG= TEST=webgl conformance no regressions  Change-Id: I2819bab5965fcb4917f85c2eded571a7f95ab9a2 Reviewed-on: https://chromium-review.googlesource.com/199423 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix missing <algorithm> include.  Change-Id: Id6952fa07223217c9dde6798d3ea701b49e6089e Reviewed-on: https://chromium-review.googlesource.com/199313 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Regenerate public projects.  BUG=angle:618  Change-Id: I516ad4a5639b021fb467aa7c7889a5f9f9bf4b33 Reviewed-on: https://chromium-review.googlesource.com/199342 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix nested struct scope support in GL backend.  Basically we should be able to reuse a struct name once the previous use is out of the scope or we can reuse it if we are in a inner scope than where it is defined before.  BUG=368910 BUG=angle:618 TEST=conformance/glsl/bugs/nested-structs-with-same-name.html  Change-Id: Icfac76b844deaca0c8a0501d7426ff3802e657dc Reviewed-on: https://chromium-review.googlesource.com/199137 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix binary serialization to use explicit size and type.  Loading program binaries across different architectures would cause runtime errors due to use of size_t.  Also fix the ANGLE major and minor version that were clobbered in an earlier commit.  BUG=angle:647 BUG=371435  Change-Id: If2ad4c8fc246cc9ff0b4d95ba87b7d1ed109a064 Reviewed-on: https://chromium-review.googlesource.com/199102 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Attempt skipping D3D11 shader optimization if compilation fails.  BUG=angle:648chromium:371868  Change-Id: I1de854aad6e002bd1349f08eb8d6b597c535c90b Reviewed-on: https://chromium-review.googlesource.com/199312 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Brandon Jones <bajones@google.com> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Attempt skipping validation if D3D11 shader compilation fails.  Some shaders fail to compile with validation error messages that make no sense.  BUG=angle:648chromium:372016  Change-Id: Ief0e28efa6bc7eaa483c95f45c00ce4f9f20e541 Reviewed-on: https://chromium-review.googlesource.com/199311 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor attempting shader compilation with different flags.  BUG=angle:648  Change-Id: Ie340eaa708820cc13be6d1f5ba04555b6c1918ea Reviewed-on: https://chromium-review.googlesource.com/199310 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix D3D11 'units' polygon offset bias.  D3D11 DepthBias is an integer corresponding directly to GL polygon offset units.  BUG=371604  Change-Id: I20a126bd9c6298efff95f3edbf1babc0dd495b18 Reviewed-on: https://chromium-review.googlesource.com/199200 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Allow non-4x4 compressed blocks for small mip layers.  CompressedTexSubImage would disallow 1x1 or 2x2 mips being set for any mip level except 0.  This made it impossible to set the data in the lowest mip levels.  BUG=angle:623  Change-Id: I623414ae4fd5d6b051579285160296b03fd36486 Reviewed-on: https://chromium-review.googlesource.com/197250 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org> (cherry picked from commit cc84a853eb5ab63a744657da704f84905565ab9e) Reviewed-on: https://chromium-review.googlesource.com/197654, 23355681, 619, 169, 619
Verify that the compiler has been initialized before freeing it.  BUG=angle:625  Change-Id: I8bba0dea26eacf02df4568cfb6840aa332bd0df8 Reviewed-on: https://chromium-review.googlesource.com/197655 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix scoped structure references.  We had neglected to reference scope bracket values when initially constructing the scoped struct name. Fixes the new WebGL test.  BUG=angle:618  Change-Id: Ie78a8264c9e16c5a6574cecd662adbd5475d6495 Reviewed-on: https://chromium-review.googlesource.com/197252 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Lazy creation of the BufferStorage staging buffer.  Only creating the staging buffer on use saves us from allocating a D3D11 staging buffer for pack buffers. This saves some memory and time when we're only using a buffer object for asynchronous readback.  BUG=angle:511  Change-Id: I97b37cc27aba4a4526025815b5935b9e74abae2e Reviewed-on: https://chromium-review.googlesource.com/195367 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> (cherry picked from commit ebf396c1dd243223240bac6ea7f01a23893f9a28) Reviewed-on: https://chromium-review.googlesource.com/197281, 23355681, 619, 169, 619
Implementation of buffer map for pack buffers.  Internally pack buffers are CPU pointers with an associated staging texture. In the map call we copy the data out of the staging memory to CPU memory and return a pointer to the CPU buffer.  BUG=angle:511  Change-Id: I2a82addd2f21241d8d49554b2fc71d890a166386 Reviewed-on: https://chromium-review.googlesource.com/195366 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> (cherry picked from commit 0b44a455b5a81b84662e57f30348f4e791f62358) Reviewed-on: https://chromium-review.googlesource.com/197272, 23355681, 619, 169, 619
Add an ANGLE test for the permissive blit fix.  BUG=361931  Change-Id: Ib44667422f524e5dcc3035692e8f725c24e92821 Reviewed-on: https://chromium-review.googlesource.com/194981 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> (cherry picked from commit 6795ca48559cedbc94c2a5c1e24ce9bd0139571a) Reviewed-on: https://chromium-review.googlesource.com/197251 Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Reduce translator sources compile count to one.  With this change the common sources shared between translator and translator_static are compiled in a static library. There is only one file with exported functions which needs to be compiled for each target. This should reduce ANGLE and chromium build times.  BUG=angle:569  Change-Id: I3ce011872323ec988befbd6db731add4fce5787b Reviewed-on: https://chromium-review.googlesource.com/197271 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix a bug in init_varyings_without_static_use workaround.  The TType constrcuted is using es2 signature which is different from the es3 signature.  BUG=angle:568 TEST=webgl conformance tests with --init_varyings_without_static_use commandline switch  Change-Id: I15347c7a6fe67e9214e4c96b156a50806a90c97c Reviewed-on: https://chromium-review.googlesource.com/197294 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Early-out of *TexSubImage* calls when the width height or depth is zero.  BUG=angle:622  Change-Id: I74ef5b684151895b24a15fa8f799a633174622c2 Reviewed-on: https://chromium-review.googlesource.com/197270 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix a mem corruption in ANGLE translator.  Basically outside TCompile::compile() the global parse context is invalid and should never be queried.  BUG=angle:568 TEST=webgl conformance tests no crash  Change-Id: I5573ce2bf3bf838ab24f59dda00948f60a0b023d Reviewed-on: https://chromium-review.googlesource.com/197178 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Remove gmock the dependency from angle_tests and compiler_tests.  BUG=angle:611  Change-Id: Ieb250bda25d62cda3e0690d05d814a4a39062d92 Reviewed-on: https://chromium-review.googlesource.com/197042 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Force a compiler release when we terminate the Renderer.  Forcing the release ensures we always manually deallocate resources and allows us to compile for different shader model versions after releasing the renderer.  BUG=angle:619  Change-Id: I0c9d68a454c7779a024f4fcc4f4987c2abe12e60 Reviewed-on: https://chromium-review.googlesource.com/196820 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update the VertexAttribute test expectations.  When we switched from converting 8-bit normalized signed int from a full 32-bit float expansion to a 4-channel 8-bit format we broke an ANGLE test. Giving the test a slightly looser bound produces the correct output due to floating point rounding.  BUG=angle:612  Change-Id: I8781e6efe83341e22d31d35b35e0048889bcd540 Reviewed-on: https://chromium-review.googlesource.com/196532 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add validation for unsized BGRA texture formats.  BUG=angle:620  Change-Id: I956b7fc4ed0be99239e4ed1c63b51732727cc87f Reviewed-on: https://chromium-review.googlesource.com/196840 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix validation in TexSubImage.  We weren't properly checking the x and y offsets against the texture boundary and were in some cases producing D3D errors with out-of-bounds writes. This was popping up in IncompleteTextureTest. The test itself was also bugged.  BUG=angle:610  Change-Id: Id58cac088fed03cae2aabbf00bce234f17208753 Reviewed-on: https://chromium-review.googlesource.com/195410 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix Linux GCC unit test build.  In a Chromium build we must respect initializer order due to extended warnings.  BUG=angle:568  Change-Id: I4d86fdd2c5663524c2ffd17e3e3c26da1ff3ccdb Reviewed-on: https://chromium-review.googlesource.com/196291 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix GCC Release build.  The release build was complaining about a missing size_t definition in blocklayout.h.  BUG=angle:568  Change-Id: I9757f3ac45627a2a73d4f90cc507f8620674820e Reviewed-on: https://chromium-review.googlesource.com/196290 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix signed/unsigned comparison warning.  BUG=angle:560  Change-Id: I9d0e8ce01db91a828bc7ae2da74c8ddce60f0184 Reviewed-on: https://chromium-review.googlesource.com/196192 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add newline to fix clang compile  Change-Id: I9e0e32d94f24fb32e9971772fb7cd68cd36ab47d Reviewed-on: https://chromium-review.googlesource.com/196280 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Re-enable RTTI and fix compilation errors.  BUG=angle:616  Change-Id: I964ddc4a3d51d5f202608e3162edb684290cbc6a Reviewed-on: https://chromium-review.googlesource.com/195731 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix build with Clang.  Clang's validation is a bit more thorough than GCC's or MSVC's and picked up a few new errors and warnings. We missed a few default cases in switches and used an improper type for default arguments.  BUG=angle:568  Change-Id: I34239c6c5c785ad1e62917fc37c3243f4c5b5f1b Reviewed-on: https://chromium-review.googlesource.com/195472 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix Linux build.  We were missing several header includes necessary for GCC. Also our static assert macro had a bug preventing us from using the same assert in multiple places.  BUG=angle:568  Change-Id: I01bcdef033a9380f436cbf4bd2a9f11b1553887c Reviewed-on: https://chromium-review.googlesource.com/195471 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Report unknown swap error as EGL_BAD_MATCH.  EGL_BAD_NATIVE_WINDOW is exclusively for indicating that the native window handle is invalid. Since we're seeing this error on switches between full-screen and windowed EGL_BAD_MATCH seems like a better fit.  BUG=361553  Change-Id: If0e2c4e5efd90838629b2769f20fcffdad4c30a9 Reviewed-on: https://chromium-review.googlesource.com/195363 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Implement asynchronous readback with PBOs.  This patch covers the basic implementation in the buffer storage.  BUG=angle:511  Change-Id: Ie7dcb11e42e568115521cc3e4ed479d3486ac957 Reviewed-on: https://chromium-review.googlesource.com/193621 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor Renderer11 to accomodate pixel pack.  Splitting the readTextureData call allow a pack buffer read to return asynchronously after the D3D11 CopySubresource call.  Refactoring patch only.  BUG=angle:511  Change-Id: I3459ddfa7b48497b25fb2f4890e1cc1341e2cf75 Reviewed-on: https://chromium-review.googlesource.com/193620 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove forced windows version macros.  These macros were causing conflicts when chrome redefines them and since we don't rely on any specific windows versions we can remove them.  BUG=angle:568  Change-Id: Ie6bf31d03cea07bf2a71ffa6d815dad2b4d204f8 Reviewed-on: https://chromium-review.googlesource.com/195364 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a pack buffer storage to BufferStorage11.  This new storage implementation uses CPU memory to read back pixel data from a texture. We use this class to implement pack buffers for asynchronous pixel readback.  BUG=angle:511  Change-Id: Ifebd242047291af6b34c981231b69987b87d290d Reviewed-on: https://chromium-review.googlesource.com/193243 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't include the test main files in the source listings.  Since chrome adds the ANGLE test source directly to it's own projects the main function is defined twice.  Remove the main file from the source listings and only add it for our test executables.  BUG=angle:568  Change-Id: I30b481a23d5de80341d7f339583a43ad2f4391bb Reviewed-on: https://chromium-review.googlesource.com/195345 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move ShaderVariables to common shared source.  Also move the block layout encoding utilities to the common folder. The combined changes allow us to include the shader and block code into both libGLESv2 and the translator separately. This in turn fixes the Chromium component build where we were calling internal translator functions directly from libGLESv2.  BUG=angle:568  Change-Id: Ibcfa2c936a7c737ad515c10bd24061ff39ee5747 Reviewed-on: https://chromium-review.googlesource.com/192891 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Remove the second translator target only using static."  This reverts commit d51df461e52ac9421201234fff488104f788a7c3.  Conflicts: 	projects/build/all.sln 	projects/samples/samples.sln 	src/compiler.gypi  Change-Id: I6e1d77531df61de28e4402ed1916f6ecdebb68fd Reviewed-on: https://chromium-review.googlesource.com/192890 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add validation for GL_RED and GL_RG in glReadPixels.  EXT_texture_rg adds support for these readback formats but validation was not added.  BUG=angle:609  Change-Id: Iddd94bb8d8cf3b244a0d8a59cd4445ffa2ae61fe Reviewed-on: https://chromium-review.googlesource.com/195176 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix a semantic index not being written for gl_FragCoord.  BUG=angle:608  Change-Id: Iebf7577a7a0c54cef25cfa7706840e8ad26b7a08 Reviewed-on: https://chromium-review.googlesource.com/195163 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement EXT_shader_texture_lod  BUG=angle:551  Change-Id: I81d7574a15861f1b24ddf6147cf71adbf20e10f3 Reviewed-on: https://chromium-review.googlesource.com/194960 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix comparing TextureFunction structures.  Test each field for smaller or larger than and when they're equal test the next field.  BUG=angle:605  Change-Id: I2c5a90d95c7ff73b83f3067381c14b74a213ef05 Reviewed-on: https://chromium-review.googlesource.com/194602 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix Lod0 texture functions that take a bias parameter.  Texture functions that are in a divergent path can still take a bias parameter. Treat the bias parameter as an explicit lod. The logic behind this is that the implicit lod is considerd to be 0 like with other Lod0 functions and then the bias is added to it.  BUG=angle:604  Change-Id: I2dbc309c497d37e960209f08849f9d2bc9e1fbcc Reviewed-on: https://chromium-review.googlesource.com/194544 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Implement BASE/MAX_LEVEL and MIN/MAX_LOD functionality.  BUG=angle:596  Change-Id: I0c818fdc1575be1ee16966acf7b6daa067a24282 Reviewed-on: https://chromium-review.googlesource.com/193236 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement state tracking for BASE/MAX_LEVEL and MIN/MAX_LOD.  BUG=angle:596  Change-Id: I773720a19b766c7a6930967983db0a34e84f2790 Reviewed-on: https://chromium-review.googlesource.com/193235 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move common SRV management into TextureStorage11.  BUG=angle:596  Change-Id: I0de2e3826e18ee769c27577b40677f0ca4da083b Reviewed-on: https://chromium-review.googlesource.com/193234 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Homogenize the parameter list for all SRV creation functions.  BUG=angle:596  Change-Id: Idd13aea4b4074aabbc4c183a3814226c31dda994 Reviewed-on: https://chromium-review.googlesource.com/193233 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Cache previously created SRVs.  BUG=angle:596  Change-Id: I15ac729388177a2ac89df4caffad5e12c7317bd7 Reviewed-on: https://chromium-review.googlesource.com/193232 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Deduplicate SRV creation.  BUG=angle:596  Change-Id: I2f4e0c4dd5c1182db1f67589f72dafef3717b363 Reviewed-on: https://chromium-review.googlesource.com/193231 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Rename getBaseTexture to getResource and refactor swizzleRequired.  BUG=angle:596  Change-Id: I72d8796172c5db57ddeb86bbc6c08cbb2ec125f1 Reviewed-on: https://chromium-review.googlesource.com/193230 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move the map logic to the buffer storage implementation.  Refactoring patch only.  BUG=angle:511  Change-Id: Id69efe15ecb32d711a79cc5ff612853e29377368 Reviewed-on: https://chromium-review.googlesource.com/193242 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix non-square matrix vertex attributes.  When we generate an input signature for a vertex shader we should use the transpose of the matrix type instead of the matrix type itself. This was breaking dEQP tests 'shaders.functions.datatypes'.  BUG=angle:594  Change-Id: Ia945ffd865d7255500f7a62394bcd5bdfbbedef4 Reviewed-on: https://chromium-review.googlesource.com/191461 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Stop shader local variables from using invalid qualifiers.  Local variables in GLSL can't use any other storage qualifier than 'const' but we weren't checking properly. For example the can't have 'in' or 'out' storage. This was causing a dEQP conformance test failure.  BUG=angle:593  Change-Id: Ibb333950f2d0990a47d1a96caecc455497d5e57e Reviewed-on: https://chromium-review.googlesource.com/191460 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Regenerate the compiled lexer.  The lexer was missing some recent changes.  BUG=angle:593  Change-Id: I8fa598e5a4ae35ebc9f9a48789632b6a326bc4d3 Reviewed-on: https://chromium-review.googlesource.com/194136 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix warnings about unreferenced local variables.  BUG=angleproject:602  Change-Id: I2eb04fe6eed60b3877b14628e81c0b1fe3b68647 Reviewed-on: https://chromium-review.googlesource.com/193431 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Handle an unknown error when exiting fullscreen on Windows 8.  BUG=361553  Change-Id: I6d3e843a8ae06f1bbd5313ed95e338cb0b74fef3 Reviewed-on: https://chromium-review.googlesource.com/194233 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Insert missing sampler cases in TType::buildMangledName.  We were missing the cases for 2D Rect samplers and external OES samplers. This was causing an assert in the WebGL CTS in Debug.  BUG=angle:550  Change-Id: Ieefeef6ff0f9a486bf7667c7efc60dee766f03ef Reviewed-on: https://chromium-review.googlesource.com/194122 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use shader optimization level 3 selectively.  Default to HLSL compiler optimization level 1 and work around a compiler bug with break in nested loops by using optimization level 3.  BUG=angle:603  Change-Id: I4f7985a5648f1b5f54d80554c21aced7fc1777c2 Reviewed-on: https://chromium-review.googlesource.com/194129 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Refactor buffer storage to split backing stores.  A more flexible representation of a buffer storage implementation allows us to represent storage for D3D11 buffers and also pack buffer as CPU memory.  Refactoring patch only.  BUG=angle:511  Change-Id: Ie123099f6217bec6edc98594e49333d16f006a0b Reviewed-on: https://chromium-review.googlesource.com/191033 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Pass pack state arguments instead of split parameters.  Similar to unpack state the PixelPackState struct encapsulates all the parameters related to pixel pack buffers. Passing the packstate makes functions more consise.  BUG=angle:511  Change-Id: If6954a5085e9b8f828cfc8892a73e7c7514b0c8a Reviewed-on: https://chromium-review.googlesource.com/191032 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Clamp ReadPixels calls to unsigned limits in D3D11.  GL allows reads beyond the defined pixel rectangle although their resultant values are undefined. D3D11 gives an error when reading out-of-bounds hence clamping the area satisfies both APIs.  This fixes a Renderer crash in our ReadPixels out of bounds test and also fixes the test to test the correct area of pixels.  BUG=angle:590  Change-Id: I12439c22d53ec6a2d69e1b8cf80f53e9c18e11f7 Reviewed-on: https://chromium-review.googlesource.com/191080 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Allow sample projects to choose ES3 & D3D version.  Passing parameters from the sample constructor allows us to test ES3 functionality as well as choose between D3D9 and 11.  BUG=angle:521  Change-Id: I7b9543b399450f62c5415654e8026a7c218b7e37 Reviewed-on: https://chromium-review.googlesource.com/193292 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a common include in the project definitions.  Any projects that may be included by gyp files outside our project (chrome or skia) may not have the same defines or ignored compiler warnings.  To make sure that we can always compile each project now includes a common file with all required definitions and gyp variables.  BUG=angleproject:583  Change-Id: I702bee975d0554c51bfa03981920dfb295ffbafa Reviewed-on: https://chromium-review.googlesource.com/189458 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove the angle_relative_path gyp variable.  Add a separate step to copy the scripts to the intermediate directory and run them from there.  BUG=angleproject:583  Change-Id: I307a2810ac03c00248cba1f227f128a1517c6574 Reviewed-on: https://chromium-review.googlesource.com/193432 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove max level from texture storage.  BUG=angle:596  Change-Id: I174e3b73c0cb675b5c9aea5722a7051a34639831 Reviewed-on: https://chromium-review.googlesource.com/192340 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove base level from texture storage.  BUG=angle:596  Change-Id: I66173f77b6c5aed3b8836cd2c9f1da02ae769429 Reviewed-on: https://chromium-review.googlesource.com/192056 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Rename lod offset to top level.  BUG=angle:596  Change-Id: Ic256445528d6587adcf0adfd8aaba5e47778988b Reviewed-on: https://chromium-review.googlesource.com/192055 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Create a single-level SRV when not mipmapping.  BUG=angle:596  Change-Id: Iec5a9e43a23c0743ff8b01985a86a72c5f18a7f7 Reviewed-on: https://chromium-review.googlesource.com/192052 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Pass all sampler state to getSRV.  BUG=angle:596  Change-Id: I4f97ea7c43bf12f5d986db39ae67d87074f98e82 Reviewed-on: https://chromium-review.googlesource.com/192051 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Remove the es_util project.  BUG=angle:521  Change-Id: Iad633bf210c36db340490f21923534697e27891b Reviewed-on: https://chromium-review.googlesource.com/188741 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Port the PostSubBuffer sample to the new sample framework.  Add a swap method on the SampleApplication class so that samples can override the default eglSwapBuffers function call.  BUG=angle:521  Change-Id: I3f0ba6ed182b368e6f5fe502de67d1a14267a857 Reviewed-on: https://chromium-review.googlesource.com/188740 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Port the TextureWrap sample to the new sample framework.  Refactor the generation of checkerboard textures since they're used by this sample and MipMap2D.  BUG=angle:521  Change-Id: I1ba8bc4927a7944eb8efad0c8aa71eba4619e457 Reviewed-on: https://chromium-review.googlesource.com/188729 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Port the Stencil_Test sample to the new sample framework.  Rename Stencil_Test to stencil_operations a more fitting name for a sample.  BUG=angle:521  Change-Id: I5412ecef12d80c3dbf54539bc7509678a35c44d5 Reviewed-on: https://chromium-review.googlesource.com/188728 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove excess dereferences and casts.  The behaviour of dereferencing an array on the stack is the same as simply using the array but it is counter-intuitive error prone and requires a cast to fit the required type.  Change-Id: Ib14e902293cf6dc71aaf944d57f53ea895a680ab Reviewed-on: https://chromium-review.googlesource.com/188875 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix off-by-one error with the number of storage mip levels.  This caused there to be too few mip levels in the TextureStorage and it would be discarded if there was a modification to a lower mip.  Also modified Texture::mipLevels to return the number of mip levels rather than the index of the smallest mip to avoid confusion.  Fixes WebGL D3D9 conformance failures in:     mipmap-fbo  BUG=angleproject:550  Change-Id: Idf3f543487232edceb520337331b39dab2bd26ba Reviewed-on: https://chromium-review.googlesource.com/192341 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Port the Simple_VertexShader sample to the new sample framework.  Add a Matrix type and cube gemetry generation helper functions.  BUG=angle:521  Change-Id: Ia50be1790d6f440499eea052f427762637f3c876 Reviewed-on: https://chromium-review.googlesource.com/188727 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Port the Simple_TextureCubemap sample to the new sample framework.  Added helper functions for generating cube maps and sphere geometry.  BUG=angle:521  Change-Id: Ic1e8584d69793233ec6a97744b13097d55b9f287 Reviewed-on: https://chromium-review.googlesource.com/188726 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a B8G8R8X8 type for mipmaping reading and writing D3D9 BGR textures.  Fixes WebGL D3D9 conformance failures in:     context-attributes-alpha-depth-stencil-antialias     copy-tex-image-2d-formats.html     texture-attachment-formats.html  BUG=angle:550  Change-Id: I09d42c5e6cf7d880841207627fd20698ed188a6a Reviewed-on: https://chromium-review.googlesource.com/191935 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Port the Simple_Texture2D sample to the new sample framework.  BUG=angle:521  Change-Id: Idd1889b13a751d473b1e99c4c593cd4cded972ae Reviewed-on: https://chromium-review.googlesource.com/188725 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Port the MultipleRenderTarget sample to the new sample framework.  Renamed to MultipleDrawBuffers and added shader loading from file.  BUG=angle:521  Change-Id: Iffeb589a95eee4409d3624c56fe3a5e4a7d5be63 Reviewed-on: https://chromium-review.googlesource.com/188724 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Port the SimpleInstancing sample to the new sample framework.  Add a Vector2 type for storing texcoords and improve the sample by having it draw several thousand instances instead of two.  BUG=angle:521  Change-Id: I87996a90000a83bc66d091c7537ea411080d7e9f Reviewed-on: https://chromium-review.googlesource.com/188723 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix D3D11 resource leaks.  A few bugs like missing destructors or Release calls were leaking D3D resources in a few places on exit. This patch should fix all the unreleased D3D object warnings on exit when running a sample app.  BUG=angle:589  Change-Id: Ib50df3229998938cddc2859d6f2d19ddd3a4db47 Reviewed-on: https://chromium-review.googlesource.com/190079 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix D3D9 short attributes to int component type.  In the component type lexicon we only use float/int/uint/norm and we were marking the D3D9 short vertex attributes as short.  This fixes the WebGL Test gl-vertexattribpointer-offsets.  BUG=angle:550  Change-Id: I3853df8bad5c98b8d0986bfa4ea73d254264ad56 Reviewed-on: https://chromium-review.googlesource.com/191950 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use correct input stride for disabled attribs.  We were using the input stride from the disabled vertex attribute. This was breaking the gl-disabled-vertex-attrib test in D3D9.  BUG=angle:550  Change-Id: Ia5a37dc39105fe8ec92f4adbee3cfb2905e82676 Reviewed-on: https://chromium-review.googlesource.com/191932 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix stack overflow when parsing huge expressions.  The expression limit validation check needs to be in front of other tree traversal to prevent stack overflows. Also call depths of sufficient size (80k+) could overflow the depth check itself necessitating an upper bound on initial tree traversal.  This fixes crashes in the WebGL long-expressions bug test.  BUG=angle:584  Change-Id: Ib48294bf77a5923d230f237fbd63a36a5662e317 Reviewed-on: https://chromium-review.googlesource.com/191931 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use a heap-memory traversal to free compiler resources.  The stack-memory traversal is prone to stack overflow. See the WebGL conformance test long-expressions-should-not-crash.  BUG=angle:584  Change-Id: I02d72bc2e4101b7141d609c50303403ea8298e60 Reviewed-on: https://chromium-review.googlesource.com/191930 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Port the ParticleSystem sample to the new sample framework.  BUG=angle:521  Change-Id: I6d00333ac7761f15ee83a47dc3e6e3cc13c675cd Reviewed-on: https://chromium-review.googlesource.com/188195 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Compile shaders with the best profile available.  Instead of always compiling D3D11 shaders with shader model 4 compile with the latest profile that the current feature level allows.  BUG=angle:495  Change-Id: I478d3d4a1aadf24d893508eee1a8c11e501bc084 Reviewed-on: https://chromium-review.googlesource.com/190340 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add support for drawing with transform feedback.  BUG=angle:495  Change-Id: Ib9c19130dfbc44a99998c5d6d8160bfc2b683eb9 Reviewed-on: https://chromium-review.googlesource.com/185037 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Port the MultiTexture sample to the new sample framework.  BUG=angle:521  Change-Id: I72f063664b43d3cfafe03c8f060076596bedea0f Reviewed-on: https://chromium-review.googlesource.com/188194 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Port the MipMap2D sample to the new sample framework.  BUG=angle:521  Change-Id: I3b1d3a02214850bf52c1d5c468f5696076065b88 Reviewed-on: https://chromium-review.googlesource.com/188193 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Adds support for EXT_map_buffer_range  BUG=angle:581  Change-Id: I0ab637db35afd51ff4c516bb97e954f4f2cdad3d Reviewed-on: https://chromium-review.googlesource.com/191710 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Adds support for OES_mapbuffer  BUG=angle:581  Change-Id: I05824051789a77c8169ec5830731e6155c507fc4 Reviewed-on: https://chromium-review.googlesource.com/191650 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Port the Hello_Triangle sample to the new sample framework.  BUG=angle:521  Change-Id: I887257193af3130447c4691bb72303cc978b96fe Reviewed-on: https://chromium-review.googlesource.com/188192 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add an ANGLE sample framework.  BUG=angle:521  Change-Id: If1fc6198dbbe44f0ade5539cff540e3e086f2a3b Reviewed-on: https://chromium-review.googlesource.com/188722 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Make D3D9 default again.  BUG=angle:568  Change-Id: I4b60084f2be0c04bb2f7dd78e78e2ef2825adc00 Reviewed-on: https://chromium-review.googlesource.com/191552 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Added transform feedback shader generation.  BUG=angle:495  Change-Id: I41a0177fd3eb43c9f4ab9e54faeadac3eb483c2c Reviewed-on: https://chromium-review.googlesource.com/185035 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add remaining transform feedback queries.  BUG=angle:493  Change-Id: I8841af50dcb90e7fb8a811b95d015bfdd2c5d226 Reviewed-on: https://chromium-review.googlesource.com/191035 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Allow creating fixed-size window surfaces.  BUG=320021  Change-Id: I97cdd65ac17ee142700dbf0f363891500e967571 Reviewed-on: https://chromium-review.googlesource.com/184205 Reviewed-by: John Bauman <jbauman@chromium.org> Tested-by: John Bauman <jbauman@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/190563 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Clean up gyp build scripts.  We can use angle_path instead of angle_build_scripts_path to locate enumerate_files.py. Also pass angle_path to the post-build script hook as this information is necessary to locate the root angle folder.  BUG=angle:592  Change-Id: I06b3f0201751d90b7c1efdefe8db07d114bd87dd Reviewed-on: https://chromium-review.googlesource.com/191082 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fixed error message for exceeding maximum struct nesting.  It got broken in r2423. We were referring to field-name as struct-name. This patch fixes the regression and also improves the error message by adding the field-name.  BUG=angle:459 R=kbr@chromium.org  Review URL: https://codereview.appspot.com/12891043  Change-Id: I9ac9a8dafcad1857f7d39e6d494e457d1fc50f70 Reviewed-on: https://chromium-review.googlesource.com/190530 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Revert "Add remaining transform feedback queries."  This reverts commit 4251b75830f91df68df80a096a0713830c73b1cc.  Change-Id: I95afebcaf91ee38a121df20f403eb06f19b2510a Reviewed-on: https://chromium-review.googlesource.com/190560 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Validate target parameter in CopyTexImage calls before using to check mip level  Would cause UNREACHABLE to be triggered if target was invalid and INVALID_VALUE to be returned instead of INVALID_ENUM if it were the only erroneous argument.  Change-Id: I2606e77379fa2832a50b3a299e6474a4b2f68afa Reviewed-on: https://chromium-review.googlesource.com/189701 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Add remaining transform feedback queries.  BUG=angle:493  Change-Id: Ibeae41da2b83ab63d237912602ba5d2aad0bbec2 Reviewed-on: https://chromium-review.googlesource.com/185036 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Only use map-write instead of map-write-discard.  In D3D11 map-discard is reserved for DYNAMIC usage buffer which are resources that live on the GPU. Staging buffers don't have the notion of map-discard and using them with discard gives a D3D11 error.  This patch fixes crashes in dEQP buffer.map.write.invalidate.  BUG=angle:587  Change-Id: Ie225e72d4e226c69e73826c9fb67bbb940bbc466 Reviewed-on: https://chromium-review.googlesource.com/190072 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix unsigned integer R10G10B10A2 vertex formats.  We were incorrectly setting the signed parameter to true in the vertex format table. This fixes a dEQP test in vertex_arrays.output_types.  BUG=angle:586  Change-Id: I84dcdee89a95369cc8e41d451f96dbb8daa37b6d Reviewed-on: https://chromium-review.googlesource.com/190056 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix linking of struct varyings.  The dEQP varying struct linkage tests were triggering asserts when we tried to query component info of struct types.  BUG=angle:580  Change-Id: I61e33573c5577a327c58fec7a07ae7718690ac42 Reviewed-on: https://chromium-review.googlesource.com/189194 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix matrix input attributes and formats.  We can't assume we have a simple mapping between input attribs and shader attribs. The app specifies matrix input attribs as several vector inputs while the shader uses a single matrix type.  BUG=angle:576  Change-Id: I4e3cdde4a14a5f06b86052dfe0325113cbe8e599 Reviewed-on: https://chromium-review.googlesource.com/189193 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Amends CopyTexImage validation to conform to new language in the ES 3.0.3 spec.  bug=angle:582  Also performs format checks for non-subimage copies and permits unsized format textures as destination for the copy.  Change-Id: Id647bb968416fbd35e1c70e5da21c81367e08f07 Reviewed-on: https://chromium-review.googlesource.com/189431 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Draft spec for ANGLE_platform_angle_d3d  This is the initial draft of a spec that extends EGL_EXT_platform_base to allow choosing a particular ANGLE D3D backend.  Change-Id: I1d80fa8b3c4a59fe998f6d15aa0f393bdb9d26c1 Reviewed-on: https://chromium-review.googlesource.com/184975 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Scott Graham <scottmg@chromium.org> Tested-by: Scott Graham <scottmg@chromium.org> (cherry picked from commit dc18dc306d554665b5764ab3281bbb16a5a5569e) Reviewed-on: https://chromium-review.googlesource.com/190026 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Disable MRT support when using D3D10 feature levels.  D3D10 cards perform poorly when the pixel shader outputs to multiple render targets that are not bound.  BUG=325581  Change-Id: I13f6f98861ffeb77cd21f7401ded4425e4ea7841 Reviewed-on: https://chromium-review.googlesource.com/185400 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/190341, 23355681, 619, 169, 619
Update gclient configuation for new git repository.  Cherry-pick of bd79517a4d160bdcbbc799b5ab545bf24c6d7abe.  Change-Id: I87d790c14d68789524df76f63a61fc30a8792e4e Reviewed-on: https://chromium-review.googlesource.com/190350 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Cache bound vertex and index buffers by ID3D11Buffer instead of serial.  Since a DirectBuffer11 may return different buffers from getBuffer depending on the required buffer type and if the internal buffers are dirty or not the current serial is not reliable.  Use the actual buffer object so that there can be no missmatch.  BUG=350581  Change-Id: I6ea1616273346117a17646edb68e6518e584f2b1 Reviewed-on: https://chromium-review.googlesource.com/189435 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix incorrect path usage in generate_projects.  We should use the cross-platform os.path.join() to support platforms other than Windows.  BUG=angle:577  Change-Id: I9d96fc1b13731a57ffcd97469632f0acedb8e5c7 Reviewed-on: https://chromium-review.googlesource.com/188879 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>  Conflicts:  	generate_projects  Change-Id: I76cacb8ee3acf477c0e99cd73cf91622efc3c9b4 Reviewed-on: https://chromium-review.googlesource.com/189131 Tested-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix incorrect function forward declaration.  Change-Id: I135c4457fdc95f2d331e2924104a30f90a40bd1a Reviewed-on: https://chromium-review.googlesource.com/189456 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Refactor ReadPixels validation.  Move ReadPixels error generation out of the implementation and into the API level.  BUG=angle:571  Change-Id: I0b32294f359fedd13d1af2c95baf37a3e5ac1d5b Reviewed-on: https://chromium-review.googlesource.com/188014 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement queries and enums for buffer mapping.  GetBufferPointerv GetBufferParameteri64v and new values for GetBufferParameteriv.  BUG=angle:565  Change-Id: I179a3193987b2bff1b0628e47f6a0d627541b0cf Reviewed-on: https://chromium-review.googlesource.com/188203 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't attempt to perform constant folding with an uninitialized constant variable.  BUG=348205  Change-Id: I9be17832b1a35d2995725ab147977992c2732274 Reviewed-on: https://chromium-review.googlesource.com/188711 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/189471, 23355681, 619, 169, 619
Regenerate public projects.  Change-Id: I0a385ff823ef492b4fced89a734d8053fdb0ffd0 Reviewed-on: https://chromium-review.googlesource.com/189474 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Remove SH_MAP_LONG_VARIABLE_NAMES  We use hashing to map all variables/strcuture field names etc so we no longer need this option.  Checked with Firefox and WebKit they no longer use this option either. Time to remove it.  Change-Id: Ie3e79b91a05258b04af419a9c42b2fd1b00e67c4 Reviewed-on: https://chromium-review.googlesource.com/189236 Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/189568, 23355681, 619, 169, 619
Regenerate default Windows projects  Change-Id: I2fe1d02cdf59409cb2d8a68b407bbd01ab7d8c0a Reviewed-on: https://chromium-review.googlesource.com/188954 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Improvement on loop unrolling with loops indexing sampler arrays      1) Before this workaround is hardwired on mac now we move it behind a compil     2) Fix the issue where "break" inside the loop isn't handled while unrolled.      BUG=338474     TEST=webgl conformance test sampler-array-using-loop-index.html  Change-Id: I4996a42c2dea39a8a5af772c256f8e3cb383f59a Reviewed-on: https://chromium-review.googlesource.com/188079 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>  Conflicts: 	include/GLSLANG/ShaderLang.h 	src/compiler/translator/ValidateLimitations.cpp Change-Id: I546197bd7df1634ebccdd380be14c3250cd56151 Reviewed-on: https://chromium-review.googlesource.com/189061 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix compile errors on pre-C++11 compilers.  BUG=angle:575  Change-Id: Ibad77fda193c850c29483aa56d0d2275c131429a Reviewed-on: https://chromium-review.googlesource.com/189163 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Keep the debug log file open and flush with each message.  Instead of opening and closing the debug log file with each message keep it open permanently and flush it with each message allowing the OS to flush to disk as needed.  With debug logging enabled performance is improved by 100x!  Also dynamically size the output buffer to the max message size.  When running all the samples the largest debug message was 318 characters so an initial size of 512 (instead of 32768) seems reasonable.  BUG=angle:575  Change-Id: If4a1387431fc2d32a6b2d1f9ca1f2590473feb86 Reviewed-on: https://chromium-review.googlesource.com/188713 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement buffer map related entry points and errors.  BUG=angle:565 Change-Id: I14cee4eec032d4b6b8d9479da4234b81e4ec6bec Reviewed-on: https://chromium-review.googlesource.com/188202 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add helper methods for buffer enum tagets.  A query helper method in Context and a validation helper method reduce code redundancy quite a bit.  BUG=angle:565  Change-Id: I96b9ecc4614e7e31240e31594223e8b9636d22c2 Reviewed-on: https://chromium-review.googlesource.com/188201 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Added methods for applying the current transform feedback buffers.  BUG=angle:495  Change-Id: I2d9fbf9c245bc519b8c5a724ca3912aaa7a23d97 Reviewed-on: https://chromium-review.googlesource.com/185034 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix default bits for 3-channel un-normalized int.  GPU conversion means we should be using a default of 1 as for int types instead of the MAXINT value for normalized types.  Fixes the WebGL test for vertex attribs with offsets.  BUG=angle:550  Change-Id: I1aa1b1bae2282e8eda96366adeec492ffe1d5728 Reviewed-on: https://chromium-review.googlesource.com/188433 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Combine widen and defaultBits params of copyVertexData.  Since we never and never will use a default value of zero for the alpha channel we can use a value of zero to indicate no widening. This has the benefit of not needing a default value where it does not apply.  BUG=angle:550  Change-Id: Ifdfedcb16039aa1d7f8ee644b65c6b4d89f9a384 Reviewed-on: https://chromium-review.googlesource.com/188432 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Emulate integer cube texture sampling as an array of six 2D textures.  BUG=angle:525  Change-Id: I3c3ec2cecebf9e745f0c02a132433e3076a6fdea Reviewed-on: https://chromium-review.googlesource.com/187534 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update enumerate_files.py to ignore "hidden" files.  Skip over files that begin with '.' since they are often hidden temporary files.  BUG=angle:553  Change-Id: I74f8412e6959c49bfca7f0ae063af42027e12549 Reviewed-on: https://chromium-review.googlesource.com/188035 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove the second translator target only using static.  Because libGLESv2 needs a static translator to link against internal types like Attribute and Varying as well as using some other internal methods we can for now disable the component build for the translator. In the future we can support a proper component build with exports across library boundaries.  BUG=angle:568  Change-Id: Ie3efc0a29342d02491e91952c3c2398568f83576 Reviewed-on: https://chromium-review.googlesource.com/187699 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix crash on multiple calls to ShInitialize().  The previous fix would allow the calling app to trigger an ASSERT if it did not first call ShFinalize. Chrome would do this in some cases causing a test failure.  BUG=344043  Change-Id: I33fa0c4668dac8750ca949febc7f02cc7d3d95e7 Reviewed-on: https://chromium-review.googlesource.com/187849 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Prevent overflow in the variable packer by sanity checking each variable.  BUG=346489  Change-Id: I28f5751580729a4d4d77fa6fdee0b4a6628a05de Reviewed-on: https://chromium-review.googlesource.com/188030 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Re-initialize shader translator properly after one shutdown.  Because of a local static we could get stuck and never re-initialize the translator after calling ShFinalize.  BUG=344043  Change-Id: Ib4d18da886eac28f3e1bc959a7eadf5b34d9410f Reviewed-on: https://chromium-review.googlesource.com/186975 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/187848, 23355681, 619, 169, 619
Implement BufferStorage11 mapping functions.  BUG=angle:565 Change-Id: I4f416981bc63098f0364653ff279b3f54eeb756e Reviewed-on: https://chromium-review.googlesource.com/186979 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement state and interface for map in gl::Buffer.  Mostly these calls pass through to BufferStorage.  BUG=angle:565 Change-Id: I38ab7d4f49bfad940773428f5bb330de55d3f573 Reviewed-on: https://chromium-review.googlesource.com/187080 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update codereview.settings to point to gerrit.  BUG=angle:570  Change-Id: I6654c60aab69861771b6917081baaecbded71bab Reviewed-on: https://chromium-review.googlesource.com/187840 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Add in gypi scripts for preprocessor and compiler tests.  Chromium directly includes our .gypi files in its own standalone tests hence we need to keep files where it looks for includes. Previously we had removed the gypi files with the new project structures.  BUG=angle:568  Change-Id: I2cf87bdd3d9635ca8e58b991b9a3e55e00261851 Reviewed-on: https://chromium-review.googlesource.com/187650 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix long error messages breaking InfoLog::append.  Using two calls to vsnprintf allows us to correctly determine maximum buffer size as well as fixing garbage characters from a missing NULL terminator.  Bug report from roland@lagoa.com.  BUG=angle:561  Change-Id: I4eb156342d9106d40783a3cf57c0c1d1889390e2 Reviewed-on: https://chromium-review.googlesource.com/186988 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
texture(sampler2DArrayShadow ...) should not take a bias parameter.  BUG=angle:564  Change-Id: I3b86e8d52ebae0e1efd0805671bd58580a712b23 Reviewed-on: https://chromium-review.googlesource.com/187082 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement textureProjGrad and textureProjGradOffset.  BUG=angle:564  Change-Id: Ice6a3715b0fda13324b3162940de875c932627c9 Reviewed-on: https://chromium-review.googlesource.com/186992 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement textureGradOffset.  BUG=angle:564  Change-Id: Iad0e452f53469208d55755e14a350b5d2ca83e9d Reviewed-on: https://chromium-review.googlesource.com/186987 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement textureGrad.  BUG=angle:564  Change-Id: I95dcd95a274f6d560250c197be0d6e64a5b23516 Reviewed-on: https://chromium-review.googlesource.com/187081 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use a stable ordering when enumerating files.  Output the enumerated files in sorted order when running enumerate_files.py from gyp to prevent unnecessary buildfile churn that makes comparing revisions noisy.  Change-Id: Ic644053d0a1cc9c986ae47fbe983221d6a62b50b Reviewed-on: https://chromium-review.googlesource.com/187690 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix missing generate projects call.  BUG=angle:550  Change-Id: I6c9cfa1d5ceb1660af504982b7abdc39f3024b84 Reviewed-on: https://chromium-review.googlesource.com/187542 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix commit header generation on non-Windows platforms.  Previously we relied on a batch file which for obvious reasons isn't cross-platform.  BUG=angle:529  Change-Id: Ia1e3944f8ed2096773e68c39d48ae2dd7370897b Reviewed-on: https://chromium-review.googlesource.com/186974 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/186985 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Add Map-related stubs to BufferStorage.  BUG=angle:565  Change-Id: I7db13e8e5fb386f5e40dd2a2e273e35f01c1f28c Reviewed-on: https://chromium-review.googlesource.com/186978 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix multiple variables named i in the same scope.  Change-Id: I575e1d80d103f554892feb6369e9b76c199bf20a Reviewed-on: https://chromium-review.googlesource.com/185881 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement texelFetch and texelFetchOffset.  BUG=angle:564  Change-Id: I7ad3484061f5d6912d7842bdadc6297de3e82ef8 Reviewed-on: https://chromium-review.googlesource.com/186990 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix redefinition of variables.  Change-Id: I04b0577c8af45fca938d8fb7cf0b9fe2eadafcf2 Reviewed-on: https://chromium-review.googlesource.com/185883 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement textureProjLod and textureProjLodOffset.  BUG=angle:564  Change-Id: I547c69908d0aa1809f844a50230bc019e6dd5893 Reviewed-on: https://chromium-review.googlesource.com/186685 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Implement textureProjOffset and textureLodOffset.  BUG=angle:564  Change-Id: I647abed0609afd178d2e9522f139d25dd3c7fda4 Reviewed-on: https://chromium-review.googlesource.com/186684 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix commit id versioning when building with Chrome.  The GYP syntax would cause problems with the ninja build.  BUG=angle:529  Change-Id: I84a30afc9bd8900535e44f5d5f9d8f766a4686e8 Reviewed-on: https://chromium-review.googlesource.com/186610 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/186984 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Fix breaking the build with missing GetGlobalMaxTokenSize.  Because the preprocessor is used independently from the compiler we need a way to track max token size when we don't have access to the parse context with the current spec.  BUG=angle:550  Change-Id: Idf5035ec2c001ee75f264151ab3c4e92f3cd44d7 Reviewed-on: https://chromium-review.googlesource.com/187140 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Use generic sampler types to compact symbol table initialization.  BUG=angle:564  Change-Id: Idbca76a4c8360d34652b571227fbb068d8d017c4 Reviewed-on: https://chromium-review.googlesource.com/186683 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix incorrect cast.  Change-Id: I1a41593dbe598dfef301c9df0f47a5105b5705cf Reviewed-on: https://chromium-review.googlesource.com/185882 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Define generic sampler types.  BUG=angle:564  Change-Id: I627f55152000371e73f3e5b4ba6938119fab0223 Reviewed-on: https://chromium-review.googlesource.com/186682 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Simplify the creation of global types.  BUG=angle:564  Change-Id: If611947f7e8ceb603001165c3c1d61d7686f1d30 Reviewed-on: https://chromium-review.googlesource.com/186681 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add functionality to create and destroy TransformFeedback objects.  BUG=angle:491  Change-Id: I3ee3c2aec1878ad656a8f522943a29fea6f7e215 Reviewed-on: https://chromium-review.googlesource.com/185033 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Regenerate public projects.  Change-Id: Ica5add561a1c095d1b2fca863f2d94e9f8d44e50 Reviewed-on: https://chromium-review.googlesource.com/187280 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Remove dependence on dxguid.lib for release builds.  BUG=angle:559  Change-Id: I10c93b312b4bf206e45d061eace2d00e598403bd Reviewed-on: https://chromium-review.googlesource.com/185690 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Detect cross-process HWNDs and verify DXGI 1.2 exists in D3D11.  DXGI 1.2 is required to create a swap chain for a HWND owned by another process.  This fix will allow us to fall back to creating a Renderer9 if DXGI 1.2 is not available instead of failing to create the swap chain later.  BUG=angle:562  Change-Id: I01b08ffb262bc3f9c86d244168df14eba52c5bdc Reviewed-on: https://chromium-review.googlesource.com/186980 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix git call syntax in commit_id.bat  BUG=angle:566  Change-Id: I437bdec916dbfe12cb310a20d4f38c18072eacd0 Reviewed-on: https://chromium-review.googlesource.com/187210 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org> (cherry picked from commit aacedfcffbca780c56dda2ab03ee07faccf0fbec) Reviewed-on: https://chromium-review.googlesource.com/187201 Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix standalone Linux build.  We can include Makefiles in the ignore list and need a few extra flags to fix the GCC build on Linux.  BUG=angle:563  Change-Id: Iacd386359f0c0d9bb87ddc544dd8b4da2cb8fee0 Reviewed-on: https://chromium-review.googlesource.com/186902 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/186989, 23355681, 619, 169, 619
Implement EXT_blend_minmax.  BUG=angle:555  Change-Id: I1ae6a9783e718d16ee08bda5463f11cd52ad0967 Reviewed-on: https://chromium-review.googlesource.com/186123 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Add defines to enable or disable specific renderers.  BUG=angle:559  Change-Id: I88c168205b142701ec843aa394c82c3a5857ed0d Reviewed-on: https://chromium-review.googlesource.com/185569 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Proper support for token max size in WebGL+ES3.  WebGL specifies a maximum token size of 256 characters while ES3 specifies 1024 characters. We can determine the proper max size to support from the spec.  BUG=angle:550 Change-Id: I6aeabe8af3b6184a27b456248ce2f84f361b76e4 Reviewed-on: https://chromium-review.googlesource.com/186973 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Don't include symbols in release builds of the public projects.  Change-Id: Ic21ca93133b6234d2756507ab43252071f04717d Reviewed-on: https://chromium-review.googlesource.com/185691 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add preprocess bison files to the gyp files.  We had accidentally left out the y and l files from our generation scripts causing us to miss several instances of updated enum names.  BUG=angle:550 Change-Id: I8790742fbaab5435e4c0db4f61c3e8194a231550 Reviewed-on: https://chromium-review.googlesource.com/186972 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix unsized formats in GenerateMipmap.  We had accidentally blocked mipmap generation for all unsized formats in ES3 because they were marked as non-renderable. The spec specifically allows for mipmaps with unsized formats in GenerateMipmap.  BUG=angle:550 Change-Id: Iee7eddd011f4fe86b690422723620593f8049ba6 Reviewed-on: https://chromium-review.googlesource.com/186971 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix bugged tokens marked as reserved/free in ES2.  We had accidentally marked 'smoooth' 'centroid' and 'case' as reserved in ES2 when they are available as identifiers. Additionally 'sampler2DShadow' was marked as free instead of reserved.  BUG=angle:550  Change-Id: I33ec1b790ad5b4d9a6f4d2ea2e91cec1ca8e7320 Reviewed-on: https://chromium-review.googlesource.com/186970 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Enable GPU dynamic conversion for unnormalized int formats.  This patch turns on the dynamic conversion logic for integer formats that we must convert to floating point for ESSL 1.0 compatibility. The converted formats are 1 2 and 4 channel unnormalized integer.  BUG=angle:560 Change-Id: I3bcc45f1103290613029bc54fdd6012dddb0a03d Reviewed-on: https://chromium-review.googlesource.com/186700 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor HLSL compilation out of Renderer.  This moves the start-up and tear-down code for D3DCompiler.dll into an object that Renderer9 and Renderer11 use.  This will help future efforts to remove references to HLSL at the GL/Renderer interface level.  BUG=angle:558  Change-Id: I18fcf9b237265d69c1d7d2ea345696c8fd31df29 Reviewed-on: https://chromium-review.googlesource.com/185568 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add logic for dynamic converstion of int to float vertex data.  We can use the format tables and input layout to determine when we need to generate conversion code in the vertex shader.  BUG=angle:560 Change-Id: Ib64fb16823bf78ed6432fba283b0d24bcb673a76 Reviewed-on: https://chromium-review.googlesource.com/185195 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add logic for inserting vertex conversion code in HLSL.  The patch refactors the vertex input HLSL to allow for dynamic conversion in the future. Using a placehold keyword the code replaces that stub with the vertex input conversion logic.  BUG=angle:560 Change-Id: I100c50cb4decd45b0f0c10d7c2c22583368b773e Reviewed-on: https://chromium-review.googlesource.com/185194 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Store un-linked shader attributes in ProgramBinary.  Our caching of compiled vertex shaders according to their input signature needs a consistent input signature to match up shaders. Since the linking step currently shuffles attributes according to API specified locations we need a separate list.  BUG=angle:560 Change-Id: Icc4d5df1d37ae895d5c882b86e60f05b5c268461 Reviewed-on: https://chromium-review.googlesource.com/185193 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Store multiple vertex executables in the program binary.  With dynamic vertex conversion the GPU we will have different input layouts resulting in different executables. This patch adds a way of mapping the input layouts to vertex executables.  BUG=angle:560 Change-Id: Ie36f2f8ac2dfcb96f562af577d31f57d6d89b447 Reviewed-on: https://chromium-review.googlesource.com/185192 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Moved all HLSL-related code from ProgramBinary to DynamicHLSL.  DynamicHLSL encapsulates all HLSL generation we need outside the the shader translator such as for linking between input and output stages and point sprite geometry shaders.  BUG=angle:560 Change-Id: Ib5079aa102000a7c37b166bcbe26b09cc82f8932 Reviewed-on: https://chromium-review.googlesource.com/185191 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Optimize masked clearing of missing channels.  Instead of doing a masked clear when a texture has mismatched channel counts set the clear color to the default for the missing channels and do a regular clear.  This catches es3proto up to master in terms of clear performance.  BUG=angle:557  Change-Id: I4f16976154af7735f5bb2b0b17adb3a264872ec0 Reviewed-on: https://chromium-review.googlesource.com/186611 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Merge 'Tie program binary version to commit hash.'  Port changes from master branch with commit hash embedding to the development branch.  BUG=angle:529 Change-Id: I307bf44103913aaaeb875a2e3ade1fab77838c48 Reviewed-on: https://chromium-review.googlesource.com/186390 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Align static and streaming vertex data to 16-byte boundaries.  Certain vertex formats using fewer than 4 bytes could confuse our buffer code giving us improperly aligned offsets. Aligning vertex data across the board should fix the problem and minimal cost.  Change-Id: I6884b4ddcfb91ef309a970593aaf7932cb65712e Reviewed-on: https://chromium-review.googlesource.com/185196 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add an option to initialize varyings without static use in vertex shaders  ANGLEBUG=554 TEST=webgl conformance test on mac: shaders-with-varyings.html r=kbr@chromium.orgnicolascapens@chromium.org cc=alokp@chromium.orgshannonwoods@chromium.org  Change-Id: I2e692d43fb15f1cf3ade3e398020d1fedb2b32f0 Reviewed-on: https://chromium-review.googlesource.com/185922 Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>  Conflicts: 	src/common/version.h 	src/compiler/translator/Compiler.cpp Change-Id: If7db13ef345bd6199d4ea0d7786f0de20885f2f3 Reviewed-on: https://chromium-review.googlesource.com/186144 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Kenneth Russell <kbr@chromium.org> Reviewed-by: Zhenyao Mo <zmo@chromium.org> Tested-by: Zhenyao Mo <zmo@chromium.org>, 23355681, 619, 169, 619
Fix checking for a NULL pointer after using the pointer.  Change-Id: I0ead14916ec677c97afb53f4c31a903e71fbc70f Reviewed-on: https://chromium-review.googlesource.com/185862 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix depth texture validation in ES2 contexts.  We were checking for extra conditions that apply to ES3 within all ES2 contexts causing the webgl depth texture conformance test to fail.  BUG=angle:550  Change-Id: Iae9a4880b9efc6be8c6857bce27a47d42fecc23a Reviewed-on: https://chromium-review.googlesource.com/186122 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move ShaderCache.h to the d3d directory.  Change-Id: I56e0f5ff11cebd8b9415081b930a804dcce9530c Reviewed-on: https://chromium-review.googlesource.com/185566 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix variable being used to initialize itself.  Change-Id: Ied10d866627485c6cd3eb09e23c14937efc465f4 Reviewed-on: https://chromium-review.googlesource.com/185864 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Mark destructors of Surface and Context as virtual.  Change-Id: If09d621cc249754caa57b057f76ff84726c18265 Reviewed-on: https://chromium-review.googlesource.com/185861 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix wrong enum type being compared.  Change-Id: I020bbf8179c08574f5fc0a207db03d7456eeeba1 Reviewed-on: https://chromium-review.googlesource.com/185860 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add TransformFeedback object.  Change-Id: I1f836575824ff9df17fe3832997f06acc7464746 Reviewed-on: https://chromium-review.googlesource.com/185032 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix wrong variable being compared.  Change-Id: I83b68286b6f3dd369081cb2188af27c86b3de6eb Reviewed-on: https://chromium-review.googlesource.com/185865 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove references to D3D formats in the Texture class.  Change-Id: I67add42cc69ec372840c67656bd2c77c623b23d0 Reviewed-on: https://chromium-review.googlesource.com/185567 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix comparing blend states with the wrong structure size.  Change-Id: I0e4c79cb7eaacf5403203b7b65094a54405ad47a Reviewed-on: https://chromium-review.googlesource.com/185863 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add support for transform feedback queries.  Change-Id: I0aab43b146f87259898db57acb9f74fdbfdb1b96 Reviewed-on: https://chromium-review.googlesource.com/184580 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Improve the enumerate_files.py script.  Cleaned up the agument parsing and added support for excluding files/folders.  BUG=angle:552  Change-Id: I6dcf965f9b92ce4aa1c0b64bd4f9a0420883bcf6 Reviewed-on: https://chromium-review.googlesource.com/185204 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Move the enumerate_files script to the build directory.  BUG=angle:552  Change-Id: I9f357c68c258c7731cf0d5c2ceed3a2875b21228 Reviewed-on: https://chromium-review.googlesource.com/185142 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Implement GL_RASTERIZER_DISCARD.  BUG=angle:498  Change-Id: Ib60c39e206003ae67c93769e35f7f9ef790ce9f4 Reviewed-on: https://chromium-review.googlesource.com/184396 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add GL headers to libGLESv2 libEGL and translator projects.  Change-Id: I66f36623eb5fb60fbb92d16af4f9854688b9484c Reviewed-on: https://chromium-review.googlesource.com/185190 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Relax alignment restrictions to allow more direct storage.  Our restriction to 4-byte alignments caused us to always convert formats like R8 or R16 or R8G8 instead of allowing D3D to handle these formats naturally.  From experimentation the proper rule seems to be "4-bytes unless the vertex format is 1- or 2-byte size." I couldn't find supporting documentation on MSDN but it seems common sense.  Change-Id: I9e38fe86790e34024d1ae912a809a3d3cdc02ccf Reviewed-on: https://chromium-review.googlesource.com/184523 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Remove VertexBuffer::requiresConversion.  Since we now have Renderer methods to query formats for vertex inputs we can get rid of the remaining calls to VertexBuffer which we used to query properties of vertex formats.  Change-Id: I9e57d1d9bf80296aef271877fdd97a16d29114af Reviewed-on: https://chromium-review.googlesource.com/184522 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix initializing the MaxExpressionComplexity and MaxCallStackDepth compiler limits.  BUG=339860  Change-Id: I64600db4bef62236c6acd8728902471df06a8f0a Reviewed-on: https://chromium-review.googlesource.com/185380 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Add vertex format queries to Renderer.  With the new support for vertex formats living in the format utils we can use the Renderer class to query vertex properties instead of the VertexBuffer class.  Change-Id: Id76bd4dbf63855016faccef703521887f50da3b9 Reviewed-on: https://chromium-review.googlesource.com/184521 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move D3D9 vertex format tables to formatutils9.  Vertex format information is useful for querying format properties with the new vertex translation logic with dynamic shaders.  Change-Id: I1935c75f1e3920dc1d4a364a2d6968c82692e476 Reviewed-on: https://chromium-review.googlesource.com/184520 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Add D3D11 vertex format tables to our format utils.  Moving the vertex format information to a globally accessible helper file makes them available for the dynamic shaders logic.  Change-Id: I67d6280c0603d9c601ca504751c8905677c2426f Reviewed-on: https://chromium-review.googlesource.com/184399 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add VertexFormat internal struct to represent vertex inputs.  A VertexFormat is similar to a simplified VertexAttribute without extra unncessary data. VertexFormats will be useful for GPU vertex conversions with dynamic shader compilation.  Change-Id: I4e60e0a12d5f081fb52d95c8977c43d481b33bff Reviewed-on: https://chromium-review.googlesource.com/184398 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move storage for uniform blocks to the program binary.  With dynamic shaders we may have multiple shader executables per program binary. We must store the uniforms outside the executable in the program binary to be consistent between variations.  Change-Id: I1b29a5d78c72dede8562d4878569b609536ba074 Reviewed-on: https://chromium-review.googlesource.com/183586 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Move the storage for uniform blocks to its own class.  With dynamic shaders we may have multiple shader executables per program binary. We must store the uniforms outside the executable in the program binary to be consistent between variations.  Change-Id: I1bec83dfb83ee9bb422448b157338a46e8e7ba56 Reviewed-on: https://chromium-review.googlesource.com/183585 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Refactor BufferStorage11.  In preparation for transform feedback BufferStorage11 needs to be able to handle a non-staging buffer being updated.  Each D3D11 buffer now has an incrementing data revision associated with it so the most up-to-date buffer is always known.  Staging buffers are now represented like any other DirectBuffer.  Change-Id: I6e881867cb2bd02d600213d08cce3ebba316c525 Reviewed-on: https://chromium-review.googlesource.com/184395 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Add work-around for D3D9 shader compiler bug.  With certain selection statements with a vertex input in the condition and side-effects in the else-block we'd run in to a D3D9 compiler bug which would cause incorrect results.  We can work around this bug in D3D9 by selectively rewriting these statements to use an 'else if' clause instead of 'else'.  BUG=322794  Change-Id: I93c96fb201ff4959c00d9a36321faac7e0343278 Reviewed-on: https://chromium-review.googlesource.com/184681 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix wrong allocator being used for sampler deletion.  Change-Id: I5e5aca5cda2bf1a96db05d594c64970ebf54fd29 Reviewed-on: https://chromium-review.googlesource.com/184572 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fixed missing break statement.  Change-Id: I83e3091243be442eafa4d16e4a4ce247a326c493 Reviewed-on: https://chromium-review.googlesource.com/184570 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Refactor buffer existance check into Buffer::invalidateStaticData.  Change-Id: I28a7654d152865c236831636f00554a71784667b Reviewed-on: https://chromium-review.googlesource.com/184394 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a GetComponentType method to query a DXGI format.  Also add a few missing DXGI formats related to vertex inputs.  Change-Id: Ia39234a164000d11eef3806ba4f06b6426f1cbb7 Reviewed-on: https://chromium-review.googlesource.com/183584 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Split DXGI format info to a GL mapping and info block.  The GL mapping depends on context client version (for certain depth textures) but the DXGI base format info is consistent across versions. Also add DXGI component type information to the table and add a few missing formats related to vertex inputs.  Change-Id: I2d1a8ca92b1cb39f4592d94d7d435ae0ada1de65 Reviewed-on: https://chromium-review.googlesource.com/183583 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Track dirty D3D shaders instead of program serial.  With dynamic shaders we can have multiple vertex shaders in one program binary. Hence the binary serial by itself isn't enough to determine when we need to apply new shaders to D3D.  Change-Id: I5a8b8616d353b506790ffc809e2d459bfc2b831d Reviewed-on: https://chromium-review.googlesource.com/184370 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Minor optimizations to texture functions.  By shuffling some parameters and calls around we can reduce the number of function calls we run for texture operations.  Change-Id: If6d14cb6dff668cdfcb2f1fe6705e0d488dbc03f Reviewed-on: https://chromium-review.googlesource.com/183582 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add the missing GL_DEPTH enum to the fbo attachment query.  This enum is only availabe in GLES 3. We were failing a dEQP state query test (fbo.draw_framebuffer_default_framebuffer)  Change-Id: I4cfb07b8597899561b8cc7956a9eb4cd4b0a99a8 Reviewed-on: https://chromium-review.googlesource.com/181782 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove system.h.  The gyp files already define NOMINMAX and WIN32_LEAN_AND_MEAN.  windows.h is also included via the D3D includes.  This ends up speeding up the build process significantly by not having windows.h included in nearly every file.  Also fixes issues on non-windows systems by not having stdarg.h included in debug.cpp.  Change-Id: Id32d9aac37a5a29df832a062dd8024302a798a1c Reviewed-on: https://chromium-review.googlesource.com/183251 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix FramebufferRenderbuffer validation.  We were not checking for an invalid renderbuffer when attaching to a framebuffer.  Change-Id: Ie29dca1833cc8c2b974f746d51dbee848f52a741 Reviewed-on: https://chromium-review.googlesource.com/181558 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix gl::ValidTextureTarget to work on all enum values.  Change-Id: I347583ae1adcaaae9feeb1276f6150ceb8739885 Reviewed-on: https://chromium-review.googlesource.com/181557 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Refactor validation of FramebufferRenderbuffer.  Consolidate a lot of duplicated code into helper methods. Also move GetTargetTexture to the context class.  Change-Id: I8e3990a5e3c1976cb533941d0a0946466accec30 Reviewed-on: https://chromium-review.googlesource.com/181556 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Remove __stdcall from non-windows builds.  Change-Id: I424cb538808ec64137c85af3bbe8742043e1c573 Reviewed-on: https://chromium-review.googlesource.com/183260 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Rework tracing and perf defines.  Changed ANGLE_DISABLE_* to ANGLE_ENABLE_* for perf and tracing defines so they are disabled by default.  Updated the gyp files to only turn on perf by default for windows debug builds.  Change-Id: I71706674e6d12fbf4208acc8f100d963b82c7674 Reviewed-on: https://chromium-review.googlesource.com/183250 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Clamp stencil reference value to D3D11 8-bit limitations.  D3D11 can only mask 8 bits of a stencil reference value so the upper bits are ignored. GL however expects the reference value to be able to scale to 32-bits.  We will expect to fail certain edge cases where the reference value and mask both use particular 9+ bit values.  Change-Id: I8c7451270d9e40310f4154955d38e51bbf7de4df Reviewed-on: https://chromium-review.googlesource.com/181555 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Only use 4-channel shaders for unpack buffers.  D3D11 supports sampling other channel sizes of backing object and declaring them as 4-vectors in HLSL. This allows us to simplify the logic for fast unpack shaders significantly.  Source: http://msdn.microsoft.com/en-us/library/windows/desktop/bb509700(v=vs.85).aspx (Default Values for Missing Components in a Texture)  Change-Id: I7f645372f266f57bd94cdb1c795f1d30bf2a60a4 Reviewed-on: https://chromium-review.googlesource.com/181901 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix zero-size textures and unpack buffers.  We would sometimes attempt to use a NULL staging texture when initializing a zero size texture when using unpack buffers.  Change-Id: I2e03141c19d9c47eeffb0d56c03bcfe476a9e48d Reviewed-on: https://chromium-review.googlesource.com/181781 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix build on Visual Studio 2013.  A breaking change in VS2013 necessitates we include <algorithm> to use std::min/max.  BUG=angle:547  Change-Id: Ia1b21e61d22148ab6d268b34dbfe9a707ca3e59d Reviewed-on: https://chromium-review.googlesource.com/182512 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Properly clamp stencil mask query values to max int.  We could overflow when casting from max unsigned int to integer and return a negative mask.  See dEQP functional.state_query.stencil_value_mask_getfloat  Change-Id: I59189a40b662ad9d8ded79cdfeded923b98f0b85 Reviewed-on: https://chromium-review.googlesource.com/181780 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Added a utility application to generate c headers from dds textures.  Change-Id: Idb4c2ca318c84433f2b06bd4f0c66045f43e56de Reviewed-on: https://chromium-review.googlesource.com/182191 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add swizzle tests.  Change-Id: If04bc249b9da8306896c89c28bb057c2cf4da511 Reviewed-on: https://chromium-review.googlesource.com/181771 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Replaced Stanford model images.  Change-Id: I76d568ce7b1acb84aba99adf8e6ca921e0933ac4 Reviewed-on: https://chromium-review.googlesource.com/182190 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add more D3D11 buffer usages.  Works around performance regressions when index and vertex buffer bind flags are used on the same buffer.  Change-Id: I28bc0d3147c6bd70cec507f20e41d97ec4cc45a5 Reviewed-on: https://chromium-review.googlesource.com/181911 Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Don't include windows.h on non-windows systems.  Change-Id: I8cf650073ead5b52bac44e31c8c3c894bc31e01c Reviewed-on: https://chromium-review.googlesource.com/182320 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Clean up state query methods.  Consolidate a lot of the code duplication in GetIntegerv GetFloatv GetBooleanv and GetInteger64v.  BUG=angle:540  Change-Id: I7b4a5803ea76e5eeb0ebf25c5caadec4c647b485 Reviewed-on: https://chromium-review.googlesource.com/180971 Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix remaining discrepencies between master and es3proto project files.  Change-Id: I335c9346ac268beab25184e2b18ccfdd0b15c7b1 Reviewed-on: https://chromium-review.googlesource.com/182150 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Renderer11 tracks applied textures as SRVs.  Since swizzled textures have multiple SRVs and the same serial it was possible that the bound SRV would not be updated if the texture became swizzled while already bound.  Change-Id: Id06e82f4002aa7f7661c7a69243692aa65a83b48 Reviewed-on: https://chromium-review.googlesource.com/181772 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix using wrong value for array size in 2D array storage.  We were incorrectly calling Texture::getBaseLevelDepth() which was correctly reporting the number of 3D slices of the texture (1).  Also rename Texture2DArray::getDepth to getLayers for clarity.  Change-Id: I1968cbcb0a3528bb76ec3e4ea4148e5dc0f302c7 Reviewed-on: https://chromium-review.googlesource.com/181553 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Added missing depth swizzle backing formats and fixed compressed texture bit calculation.  Change-Id: I2390ace1fe5297f9fcad0c873c55dae564a09c43 Reviewed-on: https://chromium-review.googlesource.com/181773 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Remove unnecessary int cast in ParseContext.  BUG=angle:536  Change-Id: I72287f5ce9736cd48fc241022e09446db717cf92 Reviewed-on: https://chromium-review.googlesource.com/181770 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix improper deferencing of a zero-size vector.  When doing a masked clear with only a depth-stencil buffer we would look for the zero-th element of an empty vector.  Change-Id: I17d61cf582c6e91fd46f8a8e13e35c6d32dfa109 Reviewed-on: https://chromium-review.googlesource.com/181554 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Create HLSL texture offset functions.  BUG=angle:541  Change-Id: I63dd47c40d693724aa6bed93e9967e3b1f8535bd Reviewed-on: https://chromium-review.googlesource.com/181521 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Add NetBSD and DragonFly to posix-compliant OS list  BUG=angle:428  Change-Id: I282a6bf138b4e2a2c17baf428cbe1e636f43bdd6 Reviewed-on: https://chromium-review.googlesource.com/181640 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/181670 Commit-Queue: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add textureOffset intrinsics to the symbol table.  BUG=angle:541  Change-Id: Ied96edd073017a507369319a781b8ed23f60790b Reviewed-on: https://chromium-review.googlesource.com/181520 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix default vertex attribute component size to 4.  The GL spec states that by default a vertex attribute has a size of 4.  Change-Id: Ic4c977fb936cc0b232ed4742eeb061d6ba6843be Reviewed-on: https://chromium-review.googlesource.com/181480 Reviewed-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix compressed formats breaking swizzle bits checks.  We defautled to zero max bit depth which breaks the swizzle format lookup.  Change-Id: I4d1cd8bcfb79db3460950fa22630c259f90fa432 Reviewed-on: https://chromium-review.googlesource.com/181481 Reviewed-by: Jamie Madill <jmadill@google.com> Commit-Queue: Jamie Madill <jmadill@google.com> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix compiler crash.  Create a fake variable for function identifiers used as a variable identifier to allow continuing compilation after reporting the error.  BUG=chromium:330222  Change-Id: I96c330694e3503fe2df66621375d2bf76115e325 Reviewed-on: https://chromium-review.googlesource.com/181491 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Regenerate the parser using Bison 2.7.12.  The next patch requires a parser grammar change but Cygwin's Bison version got updated so this separates the changes caused by that update from the ones for the actual bug fix.  Change-Id: I6a596e02198725c7dbc6a1a356fdbe388ee512d7 Reviewed-on: https://chromium-review.googlesource.com/181490 Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Update guards in ShaderVariable.h.  We neglected to update the text of the guards when we renamed the file from Uniform.h to ShaderVariable.h.  BUG=angle:533  Change-Id: I59969113536b69a418cf233ef0d7dd797e666ea9 Reviewed-on: https://chromium-review.googlesource.com/180978 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix allowing ES3 enum queries to call through to ES2 contexts.  In some cases we would not validate the enums against the context version allowing the app to call through to unimplemented features.  BUG=angle:540  Change-Id: Ic89422a3a48882314c054f133961af0b4d8d739a Reviewed-on: https://chromium-review.googlesource.com/180970 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add in fixes for dEQP state reset.  dEQP relies on a couple specific enums to reset state (see the prerequisites test) which we don't currently implement. Prior changes require us to implement a few query parameter to allow dEQP to work.  BUG=angle:540  Change-Id: Ibd7caa08ffb821ea2de120717beedb2f82428da2 Reviewed-on: https://chromium-review.googlesource.com/180981 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Fix sorting uninitialized attribute semantics to the end.  A missing condition would produce a sort order where sometimes -1 was shifted to the front of the semantic array instead of the end.  BUG=angle:527  Change-Id: I69b2e5ccc03f6523771601cd59293d6cd325be2f Reviewed-on: https://chromium-review.googlesource.com/180651 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Implement max elements indices and vertices.  ES3 has integer queries for the maximum recommended number of vertices and indices per draw call. These are roughly correlated to D3D's resource limits -- however while ES3 has recommended limits D3D has hard limits.  Change-Id: Ib653bc27e61607c78d0c5e70b0d97fea7af6464f Reviewed-on: https://chromium-review.googlesource.com/179670 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Trigger lost device on an error in D3D9 Present.  This fixes device remove handling on AMD systems as well as notifying the app layer there may have been an internal problem during Present.  BUG=313210 Change-Id: I843ffb3946dd9ef34fbd24b3a46a7b97e3c0fd16 Reviewed-on: https://chromium-review.googlesource.com/179140 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-on: https://chromium-review.googlesource.com/180450 Reviewed-by: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Added a read pixels test.  Change-Id: Ia4c5a0290e62e2c312d86fa18ef4e76d782a4a41 Reviewed-on: https://chromium-review.googlesource.com/179357 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Added compressed texture tests.  Change-Id: Id6090b134b957ca195afa615d61a10f8b008208e Reviewed-on: https://chromium-review.googlesource.com/179358 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Added tests for maximum texture size.  Change-Id: I3bce6ce2a04a3347933bfe515bcaa9b5eaebf255 Reviewed-on: https://chromium-review.googlesource.com/179356 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Added line loop tests.  Change-Id: I77a8997ccdf1b0918127d6d46a145039a941ce06 Reviewed-on: https://chromium-review.googlesource.com/179355 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Added incomplete texture tests.  Change-Id: Ie223404eb3b36664a6fbaefc45d9ff24d0be5cb1 Reviewed-on: https://chromium-review.googlesource.com/179354 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Moved the compiler test initialization and tear down into a gtest environement class.  Change-Id: I1fd05a188830567b04b9341793e64488da027894 Reviewed-on: https://chromium-review.googlesource.com/179353 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Added a gtest environment class to initialize the ANGLETest class window.  Change-Id: I6fa59201364960cc8fe1cb44e2d09a14cf61dd8a Reviewed-on: https://chromium-review.googlesource.com/179352 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org> Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix initializer type bug when using list declarations.  We were using the first type as the type for each declaration which could cause erros for arrays eg "float one[4] two;"  BUG=angle:431 TEST=WebGL CTS 1.0.2  Change-Id: I104d6701cc019ae3b3831a2d568ffe2b656b45a2 Reviewed-on: https://chromium-review.googlesource.com/179351 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Fix initialization of thread local storage in libGLESv2.  When an app would load libGLESv2.dll via LoadModule then would call methods on a thread that was already created we could creash because of uninitialized thread local storage.  BUG=angle:488  Change-Id: I9b05de462232a16d639c58ec07386b7c38a01793 Reviewed-on: https://chromium-review.googlesource.com/179132 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix initialization of thread local storage in libEGL.  When an app would load libEGL.dll via LoadModule then would call methods on a thread that was already created we could creash because of uninitialized thread local storage.  BUG=angle:488  Change-Id: If3f73fb59dcc5f0713f5b6fb9ca9f8535ee23c73 Reviewed-on: https://chromium-review.googlesource.com/179131 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix build on QNX.  InfoSink.h needs stdlib.h for abs(int) and free() in the global namespace.  ExpressionParser needs malloc.h because bison needs malloc and free in the global namespace but "#include <cassert>" will put it only in the std:: namespace on QNX.  BUG=500 R=geofflang@chromium.org jmadill@chromium.org shannonwoods@chromium.org zmo@chromium.org  Review URL: https://codereview.appspot.com/19330044  Change-Id: Ifa30a8ba5eced1156123416d4a24b490620721af Reviewed-on: https://chromium-review.googlesource.com/178993 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix build on QNX.  InfoSink.h needs stdlib.h for abs(int) and free() in the global namespace.  ExpressionParser needs malloc.h because bison needs malloc and free in the global namespace but "#include <cassert>" will put it only in the std:: namespace on QNX.  BUG=500 R=geofflang@chromium.org shannonwoods@chromium.org  Review URL: https://codereview.appspot.com/19330044  Conflicts:  	src/compiler/translator/InfoSink.h  Change-Id: Ie480d5c293d099f21dafc8c1e7997c0b4cda7207 Reviewed-on: https://chromium-review.googlesource.com/178998 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Disable automatically resizing swapchain if window is iconified  The size of the window is changed if the window is iconified but that change should be ignored.  BUG= R=shannonwoods@chromium.org  Review URL: https://codereview.appspot.com/19460043  Conflicts:  	src/libEGL/Surface.cpp  Change-Id: Ia5053a2f210b29d39551796de3d8a394d7897ac9 Reviewed-on: https://chromium-review.googlesource.com/178997 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Add an option to unfold short circuiting in AST.  We replace "a || b" with "a ? true : b" "a && b" with "a ? b : false".  This is to work around short circuiting bug in Mac drivers.  ANGLEBUG=482 TEST=webgl conformance tests R=alokp@chromium.org kbr@chromium.org  Review URL: https://codereview.appspot.com/14529048  Conflicts:  	src/build_angle.gypi 	src/compiler/translator/Compiler.cpp  Change-Id: Ic2384a97d58f54294efcb3a012deb2007a9fc658 Reviewed-on: https://chromium-review.googlesource.com/178996 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix a traverse bug.  In loop node the init part was skipped in traversing.  BUG= TEST= R=kbr@chromium.org  Review URL: https://codereview.appspot.com/14366043  Change-Id: If3200f1dbcafda1147820b2d47b758b897de0fc6 Reviewed-on: https://chromium-review.googlesource.com/178992 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Style violation cleanup for IntermTraverse.cpp  Per suggested by kbr in https://codereview.appspot.com/14366043/ we clean up the stype violation in a separate CL.  BUG= TEST=no behavioral change TBR=kbr@chromium.org  Review URL: https://codereview.appspot.com/14371043  Change-Id: I27e15f632eff3a9d0d22ae955b5a952793128661 Reviewed-on: https://chromium-review.googlesource.com/178991 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Add unit tests for proper TLS initialization.  The test creates a worker thread which initializes EGL then calls EGL methods which check for thread local storage values. This can cause a crash of the values are uninialized.  BUG=angle:488  Change-Id: Ibaffede0605c720ba9ca47910690a1334ee9e20e Reviewed-on: https://chromium-review.googlesource.com/179130 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Clear11 will not clear channels that are not supposed to exist in the render target's format.  Change-Id: I9c2bb927ec63d67d315893d44f199ceab4b5df82 Reviewed-on: https://chromium-review.googlesource.com/176856 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Renderer classes now set their blend states to mask out channels that do not exist in the render target.  Change-Id: Ia49bf8de07bbdfa31275ec9835de28adc3717485 Reviewed-on: https://chromium-review.googlesource.com/176855 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Re-add jschuh's TODO comment for 64-bit warnings  Change-Id: I690cfd9146c51cd1e19dc2bcd2cc227b4d156cd0 Reviewed-on: https://chromium-review.googlesource.com/178995 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Merge preprocessor test changes from f84ef70bc729506184b052e5e9cf78796a5a4704  Change-Id: I672f8b37f1e8189e43273abb59bce23ff1d580c1 Reviewed-on: https://chromium-review.googlesource.com/178994 Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Store the commit date in version.h and in the DLL properties.  This will allow Chrome or other apps who reference ANGLE internally to pull chronological version information about ANGLE.  Change-Id: I7dbd5b60b533f176b34f7248d70a1d9757ae99d6 Reviewed-on: https://chromium-review.googlesource.com/179100 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Roll gyp and regenerate public projects to have the cleaned paths.  With gyp r1804 we can support having nice project folders without nested subfolders. We must disable the parallel build for gyp as it is currently broken in our project and turned on by default.  Change-Id: Ie147ce423115009e254447d51cc30da0cfb2704f Reviewed-on: https://chromium-review.googlesource.com/178782 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Fix indices not being offset to the bound vertex buffer when drawing indexed points in D3D9.  bug=angle:535  Change-Id: I5b86874cddbd3b90fe141e94085f5a4afb9f3db3 Reviewed-on: https://chromium-review.googlesource.com/179101 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Adds algorithm.h dependency to support VS2013 builds.  Change-Id: I1c254be3532d9b69380f8e2b0dde0be76a8ad262 Reviewed-on: https://chromium-review.googlesource.com/178990 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Image and RenderTarget classes now initialize their textures if required.  Change-Id: I2cce6f4ffdc7e2a6c23c50d663c6316f9b125880 Reviewed-on: https://chromium-review.googlesource.com/176854 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Add functions to check if texture data initialization is required.  Change-Id: I54c3b90780c304d6001b9e52278672981c96cb83 Reviewed-on: https://chromium-review.googlesource.com/176853 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Removed extra AddRef and Release calls on D3D11 objects.  Change-Id: I5918c67735658912663c79e964b8edfb288784a3 Reviewed-on: https://chromium-review.googlesource.com/178450 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix the compiler copy script in the public projects.  This patch silences the copy message fixes the public projects and makes the copy step a separate target so it won't run on every incremental build.  Change-Id: Ie6df39737ad466b6431865b3ca19f66d16437ba9 Reviewed-on: https://chromium-review.googlesource.com/178432 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix the backwards slashes in the commit header generation.  These backwards slashes happen with some versions of gyp.  Change-Id: I6c61e212aa34999fb82d74d9f1605d674f34fce0 Reviewed-on: https://chromium-review.googlesource.com/178522 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add missing swizzle files to the generated projects.  Change-Id: Ic99319d0ee6dfad1fe435197f9aa7edbae679370 Reviewed-on: https://chromium-review.googlesource.com/178451 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Add a relative source path variable to our gyp build process.  This path lets us locate the src folder with respect to the generated output folder for the pregenerated projects.  Change-Id: I5cf36f35f68638572bc1a8aec1f570edf76a1c74 Reviewed-on: https://chromium-review.googlesource.com/178521 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix swapchain resize errors when sizing to 0 width or height.  BUG=angle:519  Change-Id: I3d3d0746b2b3027d04c91cc5fdcd301930e3b22a Reviewed-on: https://chromium-review.googlesource.com/178439 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix unused variable warning in compiler/debug.cpp.  BUG=angle:534  Change-Id: I893e552628c7deba4bc67baae6e5e28b6161c5d4 Reviewed-on: https://chromium-review.googlesource.com/178438 Reviewed-by: Geoff Lang <geofflang@chromium.org> Commit-Queue: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org>, 23355681, 619, 169, 619
Fix device removed handling for systems which do not immediately allow recreating a new device.  On Intel systems there's a cool-down period when you must wait before recreating the device.  BUG=313210  Change-Id: I22cdf41eecf0eae5058b59e1b0863173d604d606 Reviewed-on: https://chromium-review.googlesource.com/178437 Tested-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix the display not updating after a call to eglSwapInterval.  This could happen because we reset the dirty swap interval flag before we called makeCurrent.  BUG=angle:481  Change-Id: I15750db8908eb379d89b2b20104dac87c1399987 Reviewed-on: https://chromium-review.googlesource.com/178520 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Include the current commit as part of the build process.  BUG=angle:529 Change-Id: I6d1d227b495e9bae6e017c88642679210c6d2355 Reviewed-on: https://chromium-review.googlesource.com/177233 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Add NULL init for swizzle SRVs with eglBindTexImage textures.  Change-Id: I8a1069013f37988632db07359d65f8215041978e Reviewed-on: https://chromium-review.googlesource.com/178431 Reviewed-by: Geoff Lang <geofflang@chromium.org> Tested-by: Geoff Lang <geofflang@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Renderer11 now generates swizzles and invalidates the cached swizzles.  Change-Id: If5c998a91195942297beeb26a0ec635ff6a466ea Reviewed-on: https://chromium-review.googlesource.com/177035 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Added a RenderBuffer/RenderBufferInterface getTextureStorage method.  Change-Id: I710fba737524e735349ce1c0b09fa535555bd029 Reviewed-on: https://chromium-review.googlesource.com/177034 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Context now detects if a texture needs to be swizzled and calls Renderer::generateSwizzles.  Change-Id: I89f30e028b1d6ec384536cdbeedd91bb98359e8f Reviewed-on: https://chromium-review.googlesource.com/178440 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix enum names in preprocessor tests.  Change-Id: I6c08c43ecb2ad593119f85c05a802473348cafb7 Reviewed-on: https://chromium-review.googlesource.com/178430 Reviewed-by: Jamie Madill <jmadill@chromium.org> Reviewed-by: Nicolas Capens <nicolascapens@chromium.org> Commit-Queue: Nicolas Capens <nicolascapens@chromium.org> Tested-by: Nicolas Capens <nicolascapens@chromium.org>, 23355681, 619, 169, 619
Added a swizzle cache to TextureStorage11.  Change-Id: Iebf297ef5b8560bb468428fc369eb3df8f43ec11 Reviewed-on: https://chromium-review.googlesource.com/177032 Reviewed-by: Jamie Madill <jmadill@chromium.org> Commit-Queue: Jamie Madill <jmadill@chromium.org> Tested-by: Jamie Madill <jmadill@chromium.org>, 23355681, 619, 169, 619
Add a rule to copy the D3D compiler DLL to the output folder.  BUG=315387  Change-Id: I293798ecb7ec167691a1f490c050a48970b17be3 Reviewed-on: https://chromium-review.googlesource.com/177695 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Add GetSwizzle*Format functions to formatutils11.  Change-Id: Idcd4aa5fd18c1629168ba7cdd41e8fb3f6c3ead3 Reviewed-on: https://chromium-review.googlesource.com/177031 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix errors in the gyp projects when we build with ninja.  Ninja does not like having targets named 'all' and the post-build step had some ninja-incompatible variables.  BUG=angle:529  Change-Id: Ia2bf701c997ec072b18bcbd62f7d05a2e40a1578 Reviewed-on: https://chromium-review.googlesource.com/178072 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Added TEXTURE_SWIZZLE_* parameters to the texture sampler state and API queries.  Change-Id: I20aff392ec4cd9e49424afae94a862fdd8eef9b8 Reviewed-on: https://chromium-review.googlesource.com/177030 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Added a swizzleTexture method to Blit11.  Change-Id: I0af836f761893c8928a84d138a6b2d07a3e04da6 Reviewed-on: https://chromium-review.googlesource.com/176989 Reviewed-by: Shannon Woods <shannonwoods@chromium.org> Commit-Queue: Shannon Woods <shannonwoods@chromium.org> Tested-by: Shannon Woods <shannonwoods@chromium.org>, 23355681, 619, 169, 619
Fix issues with the conditional discard workarounds to do with assignments.  The old modifiesState method really checked if an operator was an assignment so restored that behaviour and use the new side effects detection only for the new code.  ANGLEBUG=486 BUG= R=nicolascapens@chromium.org zmo@chromium.org  Review URL: https://codereview.appspot.com/22130043  Change-Id: I84d4e95a0457e63f237a814d80e4f72dd861496b, 23355681, 619, 169, 619
Disable optimizations for shaders with conditional discard in D3D9 and only use expanded short-circuiting conditionals for expressions with potential side-effects.  Conservatively assume aggreate and selection operators have side effects for now.  BUG= ANGLEBUG=486 R=geofflang@chromium.org kbr@chromium.org nicolas@transgaming.com shannonwoods@chromium.org  Review URL: https://codereview.appspot.com/14441075  Conflicts: 	src/common/version.h 	src/compiler/translator.vcxproj 	src/compiler/translator.vcxproj.filters 	src/compiler/translator/OutputHLSL.cpp 	src/libGLESv2/ProgramBinary.cpp 	src/libGLESv2/Shader.cpp 	src/libGLESv2/Shader.h  Change-Id: Iaf9f10b5de7b33c927ef032f3c4fe9d5095f64dd, 23355681, 619, 169, 619
Ensure stream source frequency for stream 0 is set to 1 in swapRect for D3D9.  This prevents D3D errors which we could see when using the Debug runtime.  BUG=321834  Change-Id: I1dd66d9d80def5e558fc13c218fde9c4047ab2b4, 23355681, 619, 169, 619
Add .rc files back to the new gyp build process.  Change-Id: I8798d9dd4a31bb0ced6f695ec5b21a354adeca51, 23355681, 619, 169, 619
Proper handling of D3D9Ex device removed.  BUG=313210  Change-Id: I85dae10bc2ec38a1e9c09f318b8f6b9196466d60, 23355681, 619, 169, 619
Bump version.h  Change-Id: Iaefd68999cf7e378561d2136b6aed28058a767c4, 23355681, 619, 169, 619
Merge "Renamed some Blit11 types and methods to imply they are for blitting (as opposed to swizzleing)." into es3proto, 23355681, 619, 169, 619
Merge "Don't let mBufferSize fall out of sync with the actual buffer size.  Pervents unnecessary buffer re-creations." into es3proto, 23355681, 619, 169, 619
Use 64-bit safe constant union indexes.  BUG=angle:450  Change-Id: I4a16733e3e6aebf2939f8255ae2e4e8c5febc606, 23355681, 619, 169, 619
Don't let mBufferSize fall out of sync with the actual buffer size.  Pervents unnecessary buffer re-creations.  Change-Id: Ie40300865dcd7830fe8eafbccfaa3edad46c7b52, 23355681, 619, 169, 619
Merge "Manual merge of Ehsan Akhgari's change to add include guards to ForLoopUnroll.h" into es3proto, 23355681, 619, 169, 619
Manual merge of Ehsan Akhgari's patch to rename Diagnostics enums to avoid collision with Windows.h  (See https://chromium-review.googlesource.com/#/c/177181/3)  Change-Id: I2978d06ec96789b3ee1696b65a84c2a9f31f7ba4, 23355681, 619, 169, 619
Manual merge of Ehsan Akhgari's change to add include guards to ForLoopUnroll.h  (See https://chromium-review.googlesource.com/#/c/177180)  Change-Id: I353b6ff868dbfd5764d4fa3fb0af88891cf5b436, 23355681, 619, 169, 619
Renamed some Blit11 types and methods to imply they are for blitting (as opposed to swizzleing)., 23355681, 619, 169, 619
Add a step to the gyp projects which can run a python script after a build of ANGLE is complete.  We can use this hook to do things like copy DLLs to user-configured output folders.  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang ANGLEBUG=503  Change-Id: Iecf86b8c211b2a9933894c631c32107c8fda096a, 23355681, 619, 169, 619
Fix the shader calculation for the level of detail for certain samplers.  We were using an extra sqrt function for some cases.  TRAC #23591  Change-Id: I7d5d2b4b78586085396a281daf7975be316a1386 Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang, 23355681, 619, 169, 619
Remove usages of the auto keyword from the translator.  TRAC #22875  Change-Id: I3ecf30843a82962fbfa5c38f026425fa8acf4657 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Fix bug with nested struct uniforms.  TRAC #22875  Change-Id: I204cea18a710f6b9206a578a69f1dbc1e13fbd71 Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang, 23355681, 619, 169, 619
Fix improper getSamplerState in Context::applyTextures.  Introduced in cdf22f94acaf86.  R=geofflang@chromium.org BUG=  Review URL: https://codereview.appspot.com/20320043, 23355681, 619, 169, 619
Fix glGetUniform for non-square matrices.  TRAC #22846  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang, 23355681, 619, 169, 619
Remove use of DXGI_FORMAT_R32G32B32_FLOAT as a backing format for GL_LUMINANCE32F_EXT.  TRAC #24036  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Don't apply textures that are currently bound to the framebuffer.  BUG=496 Review URL: https://codereview.appspot.com/18450045, 23355681, 619, 169, 619
Fixed a bug where the vertex data manager was not caching the current value attributes properly.  ANGLEBUG=489 Review URL: https://codereview.appspot.com/18670043, 23355681, 619, 169, 619
Fix incorrectly named test class members and wrong shader compilation function being used.  TRAC #23776  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Silence a warning present in Release mode with a lack of exported symbols in compilerdebug.obj.  TRAC #24052  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang, 23355681, 619, 169, 619
Added unpack alignment tests.  TRAC #23776  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Added occlusion query tests.  TRAC #23776  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Added tests for clear issues.  TRAC #23776  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Added tests for NULL buffer data.  TRAC #23776  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Added BlitFramebufferANGLE tests.  TRAC #23776  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Added vertex attribute tests.  TRAC #23776  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Added an angle_tests project and base class for tests.  TRAC #23776  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add support for GL_EXT_color_buffer_float.  TRAC #23794  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Remove TextureStorage::GetActualLevelCount.  TRAC #23978, 23355681, 619, 169, 619
Modify texture storage classes to store a base and max level instead of a range of levels.  TRAC #23978  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add helper functions for returning the dimensions of a level in a texture storage.  TRAC #23978  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Remove Texture::levelCount() and replace it with isValidLevel().  TRAC #23978  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang, 23355681, 619, 169, 619
Replace API queries of immutable texture level count with a specialized function.  TRAC #23978  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Remove Texture::getStorage which is no longer needed after the previous refactorings.  TRAC #23976  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Refactor storage management in Texture2DArray.  TRAC #23976  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Refactor storage management in Texture3D.  TRAC #23976  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Refactor storage management in TextureCube.  TRAC #23976  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Refactor texture storage management in the Texture2D.  TRAC #23976  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Rename Texture and Image methods which operate on storage objects to refer to storage instead of textures.  TRAC #23961  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Make a virtual method Texture::mipLevels to return the value of mip levels defined as in the GL spec.  Also known as the "q" function.  TRAC #23961  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Use a consistent naming scheme for the cube map face index variables in Texture.cpp.  TRAC #23961  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang, 23355681, 619, 169, 619
Simplify passing the texture usage parameters through the texture classes.  Avoid passing a raw GLenum when possible.  TRAC #23961  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Change Texture::convertToRenderTarget to ensureRenderTarget which tries to convert a storage to a RT if it isn't already.  TRAC #23961  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Added support for EXT_texture_rg in D3D9 and D3D11.  TRAC #22423  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
24bit depth formats need to flip the depth and stencil bits when loading.  TRAC #23540  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Fixed the GL_FLOAT_32_UNSIGNED_INT_24_8_REV type having the incorrect number of bytes and allowed the depth stencil formats to specify that they have unused bits.  TRAC #23540  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
SwapChain11 now stores a SRV of it's depth stencil.  TRAC #24025  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Instead of checking if a texture is mipmap complete before we update the storage only update complete storage levels.  TRAC #23996  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Only update the currently active render target level in getRenderTarget instead of the whole texture.  Also add a few more ASSERTs to the texture level update methods.  TRAC #23996  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Re-enable hazard warnings for setting render targets that are currently bound as SRVs.  We can manually unset applied textures in SetRenderTargets. This should fix the spurious warnings while still showing a warning on error cases.  TRAC #24039  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add a method to return the Texture serial of a Renderbuffer or zero if this is a non-texture Renderbuffer.  TRAC #24039  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Do not allow context sharing between egl Displays.  This is an explicit error according to the EGL specification.  ANGLEBUG=487 BUG= Test=WebGL CTS R=shannonwoods@chromium.orggeofflang@chromium.org, 23355681, 619, 169, 619
Regenerate public Visual Studio projects.  TRAC #24044  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Update the GYP dependency to a revision with Visual Studio 2010 Express solution generation working correctly.  TRAC #24044  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Expose the textureLod functiosn to GLES 3.00 shaders.  We should have support for these methods but they were not exposed to the shaders.  TRAC #23991  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang, 23355681, 619, 169, 619
Ignore output from new Visual Studio projects.  TRAC #24020, 23355681, 619, 169, 619
Regenerate project files.  TRAC #24020  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Public project generation script is now a python script and generates projects into the projects directory.  TRAC #24020  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Remove un-referenced functions.  TRAC #23785  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Fix mis-printed type in event message.  TRAC #23785  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Use GLenum instead of GLint to store internal format variables.  TRAC #23785  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Move the PBO unpack shaders to the proper folder.  These were not properly merged with the project changes.  TRAC #24028  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang, 23355681, 619, 169, 619
Regenerate public project files., 23355681, 619, 169, 619
Updated the gyp build system for the ninja generator to work.  TRAC #24018  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Added a 64 bit build target to the gyp file.  TRAC #24018  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Disable warnings about size_t conversion and fix ambiguous template parameters in 64 bit builds.  TRAC #23409  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Support pixel unpack buffers in TexSubImage3D.  TRAC #23847  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Support the "fast path" (GPU copies) for pixel unpack buffers in TexImage3D.  TRAC #23846  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add support for pixel unpack buffers to TexImage3D.  TRAC #23846  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang, 23355681, 619, 169, 619
Add support for pixel unpack buffers to TexSubImage2D.  TRAC #23845  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add support for the "fast path" (GPU copy) pixel unpack buffers in TexImage2D.  TRAC #23844  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Refactor direct buffer storage to only create two backing buffers for constant buffers and all other bindings.  This simplifies the logic used in retrieving the ID3D11Buffer.  TRAC #23844  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add precompiled D3D11 shaders for pixel unpack buffers.  TRAC #23844  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add a helper method to return the native format backing a GL texture type.  TRAC #23844  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Refactor the fast path for pixel unpack buffers and fix a few validation gaps with texture completeness.  TRAC #23997  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Place the method responsible for checking for fast pixel unpack buffer support into the Renderer.  TRAC #23997  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Rename ParseHelper.cpp/h to ParseContext.cpp/h.  TRAC #24002  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang, 23355681, 619, 169, 619
Add support for querying major and minor GL version in ES3 contexts.  TRAC #23989  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Expose gl_MaxDrawBuffers to ESSL 3.00 shaders.  Previously was only exposed in ESSL 1.00.  TRAC #23990  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Regenerate project files., 23355681, 619, 169, 619
Add a project update script.  TRAC #24017  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Fixed issues compiling gtest in using the visual studio 2012 compiler., 23355681, 619, 169, 619
Regenerate project files., 23355681, 619, 169, 619
Merge a0bd8ef0aca9eab29a0e5a437b803c5d95a777c6 from master.  Use ANGLE_TRANSLATOR_STATIC to enforce a static build of the translator in chromium.  This prevents strange warnings from defining COMPONENT_BUILD=0. Also rename COMPILER_IMPLEMENTATION to ANGLE_TRANSLATOR_IMPLEMENTATION for better consistency in chromium.  ANGLEBUG=477 R=zmo@chromium.org BUG=, 23355681, 619, 169, 619
Merge 7692ca41dbfe20e6acf3319a37aa38b8160f51c6 from master.  Remove %(AdditionalDependencies) from gyp linker deps and add full windows dependency library list.  ANGLEBUG=477 BUG= R=zmo@chromium.org  Review URL: https://codereview.appspot.com/14161043, 23355681, 619, 169, 619
Merge 49cbc5768c15d930d5d8751f5263e9546a07d037 from master.  Fix a typo introduced in "GCC Compiler Fixes".  ANGLEBUG=478 BUG= R=shannonwoods@chromium.org  Review URL: https://codereview.appspot.com/14155043, 23355681, 619, 169, 619
Merge 16a3eb3e9fdee83ab9ed15769ec629eab4bc4174 from master.  Fix compiler test initialization issues.  We should call ShInitialize() / ShFinalize() once per process so moving them out of individual test's Setup() / Shutdown() to the test main().  BUG= R=alokp@chromium.org  Review URL: https://codereview.appspot.com/13568048, 23355681, 619, 169, 619
Merge 366229430ea056cf7f33917a4fa37b721512a42c from master.  Create a static translator project and allow the previous translator project to be used in component builds., 23355681, 619, 169, 619
Deleted manually maintained visual studio projects and replaced them with gyp generated ones., 23355681, 619, 169, 619
Enabled multiprocessor compilation., 23355681, 619, 169, 619
Added flags to disable or enable generation of samples and test projects., 23355681, 619, 169, 619
Fixed the DEPS folder and added a .gclient file so gclient sync will now work., 23355681, 619, 169, 619
Added a define that removes d3d includes from the common directory so that d3d9 headers are not included in the translator project., 23355681, 619, 169, 619
Refactored the tests.gyp file., 23355681, 619, 169, 619
Refactored the samples.gyp file., 23355681, 619, 169, 619
Moved the gyp libGLESv2 and libEGL projects into their own gyp files. Renamed build_angle.gpy* to angle.gyp* but kept build_angle.gyp for chrome compatability., 23355681, 619, 169, 619
Moved the compiler source files into directories based on their project and added a compiler.gypi to generate the compiler projects., 23355681, 619, 169, 619
Split the d3d9 and d3d11 backends into folders and updated the gyp file to use a python script to generate the file lists for the libGLESv2 and libEGL projects., 23355681, 619, 169, 619
Fix D3D9 attributes being marked as requireing conversion when they did not.  R=jmadill@chromium.orgshannonwoods@chromium.org  Review URL: https://codereview.appspot.com/14737043, 23355681, 619, 169, 619
Remove an assert statement to do with uniforms and element indexes.  This assert could trigger false positives on sampler types. We should eventually replace our uniform handling logic with something more consistent with D3D11's "everything is a constant buffer" model.  TRAC #23749  Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Only check for missmatched HWND process IDs if swap chain creation fails.  R=shannonwoods@chromium.orgzmo@chromium.orgjmadill@chromium.org  Review URL: https://codereview.appspot.com/14540050, 23355681, 619, 169, 619
Do not dereference a NULL pointer when retrieving the base level image of an empty 2D array texture.  TRAC #23957  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Use cube textures as 2D texture arrays in rendertarget SRVs  This fixes mipmapping for renderable cube textures in D3D11.  Signed-off-by: Geoff Lang Signed-off-by: Jamie Madill, 23355681, 619, 169, 619
Add a define to force off the vertical sync for profiling.  TRAC #23973  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Fix incorrect mip sizes for cube maps when creating them with TexStorage2D.  TRAC #23913  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Fix incorrect targets for TexStorage2D with cube maps.  TRAC #23913  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Implement META_ASSERT with static_assert if the compiler supports it.  TRAC #23948  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add missing ES3 unsized internal formats and properly return 1 for alpha in integer formats with no alpha channel.  TRAC #23949  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Fall back to LoadLibrary if preloading d3d compiler modules fails.  TRAC #23985  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Move validation of API errors out of Texture*::generateMipmaps() to the API.  TRAC #23959  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Clean up the validation logic in glGenerateMipmap by using the generic base format property methods.  TRAC #23959  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang, 23355681, 619, 169, 619
In GenerateMipmap determine if texture is a compressed or depth texture via generic methods instead of from the typed class.  Part of GenerateMipmap cleanups.  TRAC #23959  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add methods to return the properties of the base level image of a texture. We can call these of any texture type.  These methods are only well-defined for complete textures (IE not cube maps with one face defined in one level).  TRAC #23957  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Update to most recent khrplatform.h  Signed-off-by: Geoff Lang Signed-off-by: Jamie Madill, 23355681, 619, 169, 619
Eliminate bitfield enum members to avoid GCC compile error.  BUG=448 R=shannonwoods@chromium.org  Review URL: https://codereview.appspot.com/14302044, 23355681, 619, 169, 619
Refactored the generate_shaders.bat script to use a function to compile the shaders and have the option of creating debug shaders.  TRAC #23907  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Removed parameter validation from Texture::set* calls since validation is already done in ValidateTexParamParameters.  TRAC #23908  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Validate compressed texture dimensions based on the per-format compressed block sizes rather than hard-coded values.  TRAC #23630  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Context now returns maximum texture levels per texture type updated validation to validate mip level based on the texture target.  TRAC #23630  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Defer early-exit due to zero-sized copies until after all other validation for CopyTex*Image.  TRAC #20925  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Enable unpack buffer support for initializing 2D textures in TexImage2D.  TRAC #23843  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add the proper API errors for pixel unpack buffers.  1. For overflowing the currently bound pixel unpack buffer in TexImage and TexSubImage calls. 2. Enforce unpack buffer offset alignment for TexImage and TexSubImage calls. We'll have to check for currently mapped buffers when we implement map.  TRAC #23842  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add helper functions to determien if addition and mulutiplication of unsigned values will cause an overflow.  TRAC #23842  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add a couple missed files types to .gitattributes's CRLF list.  TRAC #23896, 23355681, 619, 169, 619
Use the same mechanism to process int/float literals  This also fixes the float overflow errno leaking bug.  BUG= R=alokp@chromium.org  Review URL: https://codereview.appspot.com/13368050, 23355681, 619, 169, 619
Add an option in ANGLE shader translator to initialize gl_Position to vec4(0.0 0.0 0.0 1.0).  This is to work around driver bugs where shader compile or program link would fail incorrectly if gl_Position is not set in vertex shader.  At the moment at least Linux NVIDIA driver has this bug.  ANGLEBUG=472 R=alokp@chromium.org kbr@chromium.org  Review URL: https://codereview.appspot.com/13509043, 23355681, 619, 169, 619
Expose the packing function so we can check varyings packing per program  ANGLEBUG=471 R=kbr@chromium.org  Review URL: https://codereview.appspot.com/13322043, 23355681, 619, 169, 619
Clamp numeric overflow rather than failing with an error  BUG=249086 ANGLEBUG=468 TEST= R=alokp@chromium.org kbr@chromium.org  Review URL: https://codereview.appspot.com/13195043, 23355681, 619, 169, 619
Fix compile errors in the essl to hlsl standalone translator.  ANGLEBUG=469 R=shannonwoods@chromium.org  Review URL: https://codereview.appspot.com/13281043, 23355681, 619, 169, 619
Add static_use to shader variable info query.  BUG=249018 ANGLEBUG=465 R=kbr@chromium.org  Review URL: https://codereview.appspot.com/13158043, 23355681, 619, 169, 619
Build fix: not all types support precisions.  Currently Angle translator made the wrong assumption that all variables have a precision and ASSERT that.  BUG=276031 TBR=alokp@chromium.org  Review URL: https://codereview.appspot.com/13113044, 23355681, 619, 169, 619
Support precision for sampler types.  BUG= R=alokp@chromium.org  Review URL: https://codereview.appspot.com/12833045, 23355681, 619, 169, 619
Minor refactoring of TSymbolTable.  Used pointers for precision-stack entries as well to avoid unnecessarily re-allocating PrecisionStackLevel whenever the vector needs to resize.  Added a scoped class to properly restore symbol-table level after each compile.  R=kbr@chromium.org  Review URL: https://codereview.appspot.com/12583047, 23355681, 619, 169, 619
Expose varying variables and also precision for all variables.  ANGLEBUG=457 R=alokp@chromium.org kbr@chromium.org  Review URL: https://codereview.appspot.com/12487043, 23355681, 619, 169, 619
add TRACE_EVENT to ANGLE (reland)  Tracing code the same as previous CL: https://codereview.appspot.com/12699047/  Setup code simplified and follows the GetProcAddress model of other gl functions.  R=shannonwoods@google.com, 23355681, 619, 169, 619
Print token string into the syntax error message.  Bison calls yyerror("syntax error") when it cannot match any grammar rule. We used to append current token string to the error message which got broken in r2202.  This patch restores the original behavior.  BUG=442 R=kbr@chromium.org  Review URL: https://codereview.appspot.com/12876043, 23355681, 619, 169, 619
Fixed memory leak associated with TLS.  We used to allocate thread-local memory on each compile. If the compile did not happen on the same thread as ShInitialize we leaked the thread-local memory.  It turns out that there is no need to allocate any thread-local memory. This patch cleans up all the unnecessary junk around TLS.  BUG=crbug.com/181691 R=kbr@chromium.org  Review URL: https://codereview.appspot.com/11679046  Conflicts: 	src/compiler/ConstantUnion.h 	src/compiler/ShaderLang.cpp 	src/compiler/Types.h 	src/compiler/ValidateLimitations.cpp, 23355681, 619, 169, 619
Generate a new grammar with the Bison 2.7.1 the latest cygwin version.  TRAC #23854  Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Normalize line endings of tracked files in the repository.  TRAC #23896  Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add .gitattributes to handle end-of-line normalization on commit and checkout.  TRAC #23896  Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Re-generate our compiled shaders with the new version of FXC.  TRAC #23838  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Support the Windows 8 SDK version of fxc by default in generate_shaders.bat.  TRAC #23838  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add pixel unpack buffer stubs to the Renderer classes.  TRAC #23841  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add initial implementation for PixelTransfer11 which will enable GPU buffer to texture and texture to buffer copies.  This is necessary for fast implementation of ES3 PBOs.  TRAC #23841  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Expose and generalize Clear11's CompareStates function and add methods for equality test and initialization.  TRAC #23841  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add a helper method to gl::RenderTarget to return the extents of the texture (width/height/depth).  TRAC #23841  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Make CompilePS a shared utility method in the d3d11 namespace and add methods for vertex and geometry shaders.  TRAC #23841  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Move and adjust the name of the Blit11 local functions to be consistent with our coding style.  TRAC #23841  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add a helper method to return the number of components in a texture format.  TRAC #23841  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Fix compile error regressions in OutputGLSL and OutputESSL.  These were broken back with the symbol table changes.  TRAC #23857  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Use the context's PixelUnpackState as an argument to Texture's implementation of setImage and subImage.  We need to access the current unpack buffer for our implementation of PBOs.  TRAC #23840  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Move the pixel pack and unpack related state into separate structs for easy parameter passing.  TRAC #23840  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Ensure the 'slice' pixel unpack/pack alignment is only aligned based on the row stride.  TRAC #23837  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add missing varying in and out qualifiers to the interpolation qualifier switch statement.  This was causing a benign assert in Debug mode with GLSL ES 1.00 shaders.  TRAC #23746  Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Remove an unnecessary and non-compliant format check from the SubImage family of calls.  We were overly restricting the user's input data for SubImage calls.  TRAC #23834  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
InputLayoutCache only hashes input layout keys up to last used element.  R=geofflang@chromium.org  Review URL: https://codereview.appspot.com/12676043  Conflicts:  	src/common/version.h 	src/libGLESv2/libGLESv2.vcxproj 	src/libGLESv2/renderer/InputLayoutCache.cpp, 23355681, 619, 169, 619
Revert "Eliminate bitfield enum members."  This reverts commit 56702e6d60883f2d1e33641b907680a852cdb15a., 23355681, 619, 169, 619
Ignore files generated by GYP.  R=shannonwoods@chromium.org  Review URL: https://codereview.appspot.com/12865044, 23355681, 619, 169, 619
Presort reverse mapping of ProgramBinary::mSemanticIndex., 23355681, 619, 169, 619
Made multiple calls to ShInitialize not assert.  BUG=456 R=apatrick@chromium.org kbr@chromium.org  Review URL: https://codereview.appspot.com/11916046  Conflicts:  	src/common/version.h 	src/compiler/ShaderLang.cpp, 23355681, 619, 169, 619
Change the backing for integer 32-bit three-channel textures internally to four components.  On some systems three-channel int textures are not renderable in D3D11.  TRAC #23822  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Fix an incorrect type entry for RGB565 in the ES3 formats table.  TRAC #23823  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Fix the format table entry for RGB10_A2UI to be RGBA_INTEGER instead of RGBA. Also add a missing format mapping.  TRAC #23823  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add GL_STRUCT_ANGLEX case handling to the variable row and column count methods.  TRAC #23749  Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Add full support for uniform structs.  TRAC #23750  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Add a field to uniforms to track which element within a register the uniform should be uploaded to.  This is necessary to support HLSL-backed uniform structs.  TRAC #23750  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Add support for struct varyings and more robust varying link validation.  TRAC #23749  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Ensure struct varyings maintain the proper interpolation qualifier for the child fields.  TRAC #23749  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Use the proper register count for structs in HLSL uniforms and varyings.  We must respect HLSL packing rules when uploading structs to D3D.  TRAC #23748  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Rename some constants in BlockLayoutEncoder for clarity.  TRAC #23748  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Consolidate the register counting functions to a single location in the HLSL layout encoder source.  This new method explicitly depends on HLSL packing rules instead of a GL idiom.  TRAC #23748  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Allow block encoders to work with a NULL pointer for the output list structure.  TRAC #23748  Signed-off-by: Nicolas Capens Signed-off-by: Geoff Lang, 23355681, 619, 169, 619
Remove the gl::Varying class and replace all usages with sh::Varying.  TRAC #23746  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Simplify the gl::Varying struct to be more like sh::Varying.  The subsequent patches will remove gl::Varying entirely.  TRAC #23746  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Change the varyings list type from a linked list to a vector type.  TRAC #23746  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Rename compiler/Uniform.cpp+h to ShaderVariable.cpp+h.  TRAC #23754  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Pass varyings to the GLES API from the translator using a direct pointer.  Instead of parsing them indirectly from HLSL the pointer will allow us to more flexibly support new types especially compound types such as structures.  TRAC #23754  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Refactor sh::Uniform and sh::ShaderVariable into a shader variable base type with different child types.  This change gives us better memory usage (many fields are unnecessary in different types) with better static typing and clear type abstraction for specific methods that might take Attributes or Varyings etc.  TRAC #23754  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Allow the block encoder classes to encode types directly passed by value instead of as a compound type.  TRAC #23754  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Simplify the varying priority sorting logic and add more verbose comments.  TRAC #23746  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Worked around an issue that causes a TDR timeout when Blit11::copyDepthStencil is called repeatedly.  TRAC #23650  Author: Geoff Lang Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Moved the clipping of blit rectangles to bounds or scissors into the Renderers since rounding to integers can cause errors when stretching in ES3.  TRAC #23650  Author: Geoff Lang Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Added a Context::getScissorParams method.  TRAC #23650  Author: Geoff Lang Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Prepend the GLSL code in a comment to the generated HLSL shaders when compiled in debug mode.  TRAC #23775  Author: Geoff Lang Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Replaced the char pointers with std::strings in the Shader classes.  TRAC #23775  Author: Geoff Lang Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Implemented glClearBuffer*  TRAC #23475  Author: Geoff Lang Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Perform validation of glClear parameters at the API level.  TRAC #23475  Author: Geoff Lang Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Refactored the ClearParameters type and moved Renderer11's clear logic into a Clear11 helper class.  TRAC #23475  Author: Geoff Lang Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add support for the remaining ES3 framebuffer attachment parameter queries.  TRAC #23474  Author: Geoff Lang Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add Renderbuffer::getComponentType and Renderbuffer::getColorEncoding methods.  TRAC #23474  Author: Geoff Lang Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Replaced the custom component type and SRGB bool with GLenums.  TRAC #23474  Author: Geoff Lang Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Fix some missing UBO qualifier link validation errors.  TRAC #23747  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add more robust support for interpolation and storage qualifiers with varyings for GLSL ES 3.00.  This fixes some conformance failures in the dEQP varying link tests particularly with ints and the flat keyword.  TRAC #23745  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Moved the code to combine interpolation and stoarge qualifiers to the parse helper.  TRAC #23745  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Fix using the incorrect vertex count in instancing drawing using the streaming buffer.  This could cause visual corruption from reading past the end of initialized vertex data.  R=geofflang@chromium.org shannonwoods@chromium.org ANGLEBUG=467 Review URL=https://codereview.appspot.com/12937045 Test=WebGL CTS 1.0.2, 23355681, 619, 169, 619
Make gl::Buffer::size() a const method.  R=geofflang@chromium.org shannonwoods@chromium.org ANGLEBUG=467 Review URL: https://codereview.appspot.com/12937045 Test=WebGL CTS 1.0.2, 23355681, 619, 169, 619
Fix Texture2DArray calling Texture::set/subImage with invalid pointers when the pixels pointer is NULL.  TRAC #23767  Author: Geoff Lang Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods, 23355681, 619, 169, 619
Add the validation files to the gyp file.  TRAC #23733  Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Adds API-level functionality for indexed query functions  TRAC #23468  Author: Shannon Woods Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Implements indexed query functionality  TRAC #23468  Author: Shannon Woods Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Adds size and offset queries to BindingOffsetPointer  TRAC #23468  Author: Shannon Woods Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
TextureStorage11::updateSubresourceLevel will now use the blitter if it is updating a depth stencil texture.  TRAC #23531  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Fixed a bug where the frontFace shader constant would not be updated if the drawMode or frontFace changed but not the viewport.  TRAC #23719  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Add support for GL_NUM_EXTENSIONS.  TRAC #23704  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Eliminate bitfield enum members.  TRAC #23653 Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Author: Nicolas Capens, 23355681, 619, 169, 619
Removed checks for DXGI_FORMAT_R32G32B32_FLOAT support since GL_RGB32F is converted to DXGI_FORMAT_R32G32B32A32_FLOAT.  TRAC #23651  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Capitalized the first letter of all validation function names.  TRAC #23629  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Refactored entry point validation functions into their own files.  TRAC #23629  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Load 1 into the alpha channel of RGB integer formats instead of 0.  TRAC #23651  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Add GL_DEPTH_STENCIL_ATTACHMENT attachment handling to glFramebufferRenderbuffer.  TRAC #23668  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Fixed the rounding of the source lookup in Blit11's copy depth stencil.  TRAC #23669  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Fixed ES3 incorreclty not allowing 2D array textures to accept depth stencil formats.  TRAC #23669  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Fixed a bug where height was used instead of width to calculate a mip size.  TRAC #23669  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Fixed a bug where the parameters to gl::GetDepthPitch were passed in the wrong order.  TRAC #23669  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Split the overflow check into explicit multiplication and addition overflow checks.  TRAC #23671  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Change the offset variable to an unsigned int since it cannot be negative and is assigned to streamOffset which is an unsigned int.  TRAC #23671  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Releases a resource that was leaking.  TRAC #23656  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Implement mipmapping for integer samplers.  TRAC #23655 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Updated gl::IsInternalTextureTarget to have a client version parameter.  TRAC #23470  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Refactored validation for glFramebufferTexture* and implemented glFramebufferTextureLayer.  TRAC #23470  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Added Renderbuffers for 3D and 2DArray textures.  TRAC #23470  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Updated Renderbuffers Textures and TextureStorageInterface to be aware of render targets which are based on miplevels and layers other than zero.  TRAC #23470  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Framebuffer now uses mip level and texture layer for binding textures.  TRAC #23470  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
The Texture class now stores the target instead of using a virtual method.  TRAC #23470  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Added a new type of binding pointer for framebuffer texture bindings which stores type mip level and layer.  TRAC #23470  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Removes auto from compiler.  TRAC #23604  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Updated VertexBuffer's getSpaceRequired and storeVertexAttributes methods to return bools and fixed some validation of parameters to prevent under and overflows.  TRAC #23643  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Fix assert side-effects.  TRAC #23446 Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Remove uses of the HASH_MAP define since unordered_map is already used in several places.  TRAC #23618  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Use SafeRelease and SafeDelete to make sure released objects are NULL and will cause proper errors if referenced again.  TRAC #23617  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Initialize the vertex current value data.  TRAC #23619  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Fixed uninitialized local variable warning.  TRAC #23619  Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Fix additional overflow and underflow issues with triangle fans and line loops.  Issue #444  Signed-off-by: Shannon Woods Signed-off-by: Chris Evans Author: Geoff Lang, 23355681, 619, 169, 619
Fixed a bug where cube depth stencils used the wrong format and didn't set the D3D11_DEPTH_STENCIL_VIEW_DESC::Flags member.  TRAC #23608  Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Implement the DEPTH_STENCIL attachment point for FBOs.  Trac #23469  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Emulate RGB32F textures with DXGI_FORMAT_R32G32B32A32_FLOAT so that sampling is always supported.  Trac #23523  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Bump ANGLE version., 23355681, 619, 169, 619
Cache the index ranges at the gl::Buffer and rx::IndexBuffer levels so that ranges do not need to be re-calculated for direct buffers.  Issue #451  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
RenderTarget11::get* calls no longer add references to the D3D resources.  Issue #451  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Cache applied primitive topology.  Issue #451  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Cache applied constant buffers.  Issue #451  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Cache applied vertex buffers and input layout.  Issue #451  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Add a missing case to build manged names of uint types.  TRAC #23590  Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Provide a pass-through mechanic for the new ES3 Query methods to use the old ES2 query extension.  We will need to add the new transform feedback queries in a later patch.  TRAC #23347  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Implement the API entry points for fence sync objects in GLES 3.  TRAC #23446  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add state for the new fence sync objects in ES3.  TRAC #23446  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Make a slight style change to clarify that VAOs are not stored in the ResourceManager.  TRAC #23446  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Rename the old Fence class and associated methods to show an NV suffix for differentiation with ES3 fences sync objects.  ES3 fences are shared across contexts while NV fences are not.  TRAC #23446  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Move the API parameter validation out of Fence.cpp to libGLESv2.cpp.  TRAC #23446  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Move the GL_NV_fence-specific stuff stuff out of the Fence implementation class to gl::Fence.  This will allow us to re-use the same Fence implementation for GLES 3 Fence Sync objects.  TRAC #23446  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Fixes handling in eglMakeCurrent to allow for null displays.  TRAC #23577  On behalf of callow.mark@artspark.co.jp Landed-by: Shannon Woods Signed-off-by: Jamie Madill Signed-off-by: Geoff Lang, 23355681, 619, 169, 619
Diverges version for ES3 ANGLE, 23355681, 619, 169, 619
Remove some accidentally committed compiled shaders.  TRAC #23573  Authored-by: Jamie Madill, 23355681, 619, 169, 619
Implement support all sampler object associated GLES 3 API entry points.  TRAC #23454  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add a helper method to return the selected texture for the TexParameter* and GetTexParameter* family of functions.  TRAC #23454  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Refactor the validation logic for the TexParameter* series of API entry points to use the same shared method.  TRAC #23454  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add internal accessor functions for querying sampler object parameters.  TRAC #23454  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Use the currently bound sampler object combined with the internal texture state to determine the current filtering and address modes at draw time.  TRAC #23453  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Pass a SamplerState as a parameter to Texture::isSamplerComplete instead of using the internal SamplerState.  TRAC #23453  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Change the checks for texture completeness in Texture*::copySubImage to only check if the specified level is complete.  This removes the dependency between copySubImage and isSamplerComplete which makes operation with sampler objects simpler.  TRAC #23453  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Do not check the texture's filtering mode in Texture*::updateTexture instead check the texture's dirty flags.  With sampler objects it becomes difficult to rely on the texture filtering mode state to determine if mipmapping is going to be enabled in the texture as sampler object may or may not override the texture internal state.  TRAC #23453  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add mutator methods for modifying sampler object parameters.  TRAC #23453  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add state for sampler objects.  TRAC #23453  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Replace the logic for doing vector and matrix equivalence tests in the shader with a much simpler formula.  We can use the HLSL fragment "all(a == b)" for all matrix and vector types.  TRAC #23535  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Align the vertical whitespace in the big switch in Context::getIntegerv.  TRAC #23082  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add new GLES 3 enum cases.  TRAC #23082  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Implement the glGetInteger64v entry point.  TRAC #23082  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Added Context::getInteger64v for 64-bit integer state queries.  TRAC #23082  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add a method to round GLfloat parameters to the nearest integral value for use in state-setting API methods.  TRAC #23545  Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens Authored-by: Jamie Madill, 23355681, 619, 169, 619
Added support for TEXTURE_COMPARE_MODE and TEXTURE_COMPARE_FUNC sampler states.  TRAC #23394 Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Make all depth formats texture filterable.  TRAC #23532 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Create the HLSL shadow texture function.  TRAC #23394 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Compact sampler type translation.  TRAC #23394 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Remove intrinsic parameter names.  TRAC #23394 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Add shadow texture intrinsics to the symbol table.  TRAC #23394 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Add shadow samplers to the compiler front-end.  TRAC #23394 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Eliminate isVariableBuiltIn.  TRAC #21840 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Detect redefinition of functions and variables.  TRAC #21840 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Fix the reported shader gl_MaxDrawBuffers to be compliant with the new EXT_draw_buffers spec.  From the extension spec:  "8) What value should gl_MaxDrawBuffers in the shading language report?"  "RESOLVE: It should match MAX_DRAW_BUFFERS_EXT from the API. None of the API or GLSL specifications explicitly state the linkage between API and SL constants but it seems logical that one would expect them to match regardless of whether or not an extension directive is used in the shading language."  TRAC #23509  Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens Authored-by: Jamie Madill, 23355681, 619, 169, 619
Only allow zero indexes for gl_FragData when the draw buffers extension is disabled.  TRAC #23509  Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens Authored-by: Jamie Madill, 23355681, 619, 169, 619
Implement textureSize.  TRAC #23485 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Use the simpler form of GetDimensions.  TRAC #23485 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Add support for copying from BGRA formats in CopyTexSubImage*.  This is necessary for copying from the offscreen texture which we keep in BGRA to align with Chrome's D3D9 format.  TRAC #23501  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Fix the internal conversion of DXGI DEPTH_COMPONENT32F formats to be DEPTH_COMPONENT_OES in GLES 2 contexts.  TRAC #23483  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add a client version parameter to several D3D11-specific texture format queries.  TRAC #23483  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
In ShaderExecutable delete mFunction with delete[] instead of delete.  BUG=chromium:253578 R=shannonwoods@chromium.org  Review URL: https://codereview.appspot.com/10658043, 23355681, 619, 169, 619
Protect against integer overflows in the IndexBuffer class by validating that the new write position will not overflow.  Issue 444  Signed-off-by: Jamie Madil Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Protect against integer overflows in the VertexBuffer class by validating the reserved space.  Issue 444  Signed-off-by: Jamie Madil Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Protect against integer overflows when generating index buffers for line loop and triangle fan drawing.  Issue 444  Signed-off-by: Jamie Madil Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Move VAO buffer clearing code to the destructor instead of the constructor.  This fixes assertion failures during the VertexArray destructor in Debug mode.  TRAC #23390  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Authored-by: Jamie Madill, 23355681, 619, 169, 619
Implement array sampler support.  TRAC #23472 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Add intrinsics that take a bias parameter.  TRAC #23472 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Support 3D textures.  TRAC #23472 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Generate HLSL code for integer sampling.  TRAC #23472 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Handle new sampler types.  TRAC #23472 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Add the missing HALF_FLOAT_OES type to the type info table.  TRAC #23479  Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Simplified TType class by carving out TStructure and TField.  R=kbr@chromium.org  Review URL: https://codereview.appspot.com/9866043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@2423 736b8ea6-26fd-11df-bfd4-992fa37f6226  TRAC #23415 Authored-by: alokp@chromium.org Signed-off-by: Shannon Woods Signed-off-by Nicolas Capens Merged-by: Jamie Madill, 23355681, 619, 169, 619
Include stddef.h so NULL is defined. Review URL: https://codereview.appspot.com/10025043  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@2422 736b8ea6-26fd-11df-bfd4-992fa37f6226  TRAC #23333 Authored-by: alokp@chromium.org Signed-off-by: Shannon Woods Signed-off-by Nicolas Capens Merged-by: Jamie Madill, 23355681, 619, 169, 619
Added support for EXT_frag_depth  This change also required that support be added for associating built-in variables with an extension similar to how functions could be associated with extensions previously.  R=alokp@chromium.org  Review URL: https://codereview.appspot.com/9827044  git-svn-id: https://angleproject.googlecode.com/svn/trunk@2248 736b8ea6-26fd-11df-bfd4-992fa37f6226  TRAC #23333 Authored-by: bajones@chromium.org Signed-off-by: Shannon Woods Signed-off-by Nicolas Capens Merged-by: Jamie Madill, 23355681, 619, 169, 619
Removed checks for zero-length arrays because you can never define such arrays. Also removed support for max-array-size. You can only define a fixed-size array.  TEST=WebGL conformance tests  Review URL: https://codereview.appspot.com/9697044  git-svn-id: https://angleproject.googlecode.com/svn/trunk@2247 736b8ea6-26fd-11df-bfd4-992fa37f6226  TRAC #23333 Authored-by: alokp@chromium.org Signed-off-by: Shannon Woods Signed-off-by Nicolas Capens Merged-by: Jamie Madill, 23355681, 619, 169, 619
Removed code for unsupported pack-unpack language.  Review URL: https://codereview.appspot.com/9685045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@2246 736b8ea6-26fd-11df-bfd4-992fa37f6226  TRAC #23333 Authored-by: alokp@chromium.org Signed-off-by: Shannon Woods Signed-off-by Nicolas Capens Merged-by: Jamie Madill, 23355681, 619, 169, 619
Add expression complexity and call stack depth limits.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@2242 736b8ea6-26fd-11df-bfd4-992fa37f6226  TRAC #23333 Authored-by: gman@chromium.org Signed-off-by: Shannon Woods Signed-off-by Nicolas Capens Merged-by: Jamie Madill Conflicts:  	src/common/version.h, 23355681, 619, 169, 619
Used size_t for object size instead of signed int. BUG=crbug 179653 R=aedla@chromium.org kbr@chromium.org  Review URL: https://codereview.appspot.com/8834048  git-svn-id: https://angleproject.googlecode.com/svn/trunk@2211 736b8ea6-26fd-11df-bfd4-992fa37f6226  TRAC #23333 Authored-by: alokp@chromium.org Signed-off-by: Shannon Woods Signed-off-by Nicolas Capens Merged-by: Jamie Madill, 23355681, 619, 169, 619
Clamped negative index access.  Fixed error that allowed negative index for accessing vector matrix and array. Now we report compile error and clamp the index to 0.  Re-arranged code around it to handle negative index at the one location.  BUG=crbug.com/239411 TEST=bug test case R=aedla@chromium.org kbr@chromium.org  Review URL: https://codereview.appspot.com/9193045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@2207 736b8ea6-26fd-11df-bfd4-992fa37f6226  TRAC #23333 Authored-by: alokp@chromium.org Signed-off-by: Shannon Woods Signed-off-by Nicolas Capens Merged-by: Jamie Madill, 23355681, 619, 169, 619
Refactor location tracking.  R=kbr@chromium.org  Review URL: https://codereview.appspot.com/9078046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@2202 736b8ea6-26fd-11df-bfd4-992fa37f6226  TRAC #23333 Authored-by: alokp@chromium.org Signed-off-by: Shannon Woods Signed-off-by Nicolas Capens Merged-by: Jamie Madill, 23355681, 619, 169, 619
Remove dead code left over from the old preprocessor.  Review URL: https://codereview.appspot.com/9309044  git-svn-id: https://angleproject.googlecode.com/svn/trunk@2200 736b8ea6-26fd-11df-bfd4-992fa37f6226  TRAC #23333 Authored-by: alokp@chromium.org Signed-off-by: Shannon Woods Signed-off-by Nicolas Capens Merged-by: Jamie Madill, 23355681, 619, 169, 619
Delete dead code for cloning various types.  R=kbr@chromium.org  Review URL: https://codereview.appspot.com/9242043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@2197 736b8ea6-26fd-11df-bfd4-992fa37f6226  TRAC #23333 Authored-by: alokp@chromium.org Signed-off-by: Shannon Woods Signed-off-by Nicolas Capens Merged-by: Jamie Madill, 23355681, 619, 169, 619
Marks formats renderable which had been missed and corrects table headers.  TRAC #23273  Authored-by: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Enables glGetInternalformativ API function  TRAC #23273  Authored-by: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Implements queriability for internal format sample counts.  TRAC #23273  Authored-by: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Adds a function to retrieve the renderable DXGI format for a GL internal format.  TRAC #23273  Authored-by: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Fixes a typo in the spelling of GetTextureFormat.  TRAC #23273  Authored-by: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Fix a missing case in OutputHLSL::textureName for 3D texture sampler translation.  TRAC #23377  Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Fix an incorrect instance of getCols which should be getNominalSize.  TRAC #23263  Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Handle the new error case with VAOs introduced in GLES 3 involving a user VAO and non-null data pointers.  TRAC #23392  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Authored-by: Jamie Madill, 23355681, 619, 169, 619
Enable the new Vertex Array Object entry points.  TRAC #23392  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add support for new GetAttrib queries for integer and unsigned integer vertex attributes.  TRAC #23391  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Authored-by: Jamie Madill, 23355681, 619, 169, 619
Support querying if a vertex attribute is an un-normalized integer.  TRAC #23391  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Authored-by: Jamie Madill, 23355681, 619, 169, 619
Refactor the validation for GetAttrib functions to a single shared method.  TRAC #23391  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add support for querying the currently bound vertex array object.  TRAC #23391  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add implementation for Vertex Array Object state.  TRAC #23390  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Authored-by: Jamie Madill, 23355681, 619, 169, 619
Refactor VertexAttribute to split the "current value" for generic attributes into its own class.  VAOs in GLES 3 do not store the current values so these must be handled separately from other Vertex Attribute data.  TRAC #23390  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Authored-by: Jamie Madill, 23355681, 619, 169, 619
Move VertexAttribute to its own header file.  This is in preparation for VAO support.  TRAC #23390  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Authored-by: Jamie Madill, 23355681, 619, 169, 619
Fixes tabs-vs-spaces that have crept into the project.  TRAC #23251  Authored-by: Shannon Woods Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Adds a null check in one additional location in setData  TRAC #23251  Author: Shannon Woods Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Add support for passing nested structs in standard layout by value.  We add support for this by using global scratch values as storage for the structs in uniform blocks. Any structs in std140 layouts that are referenced by value are initialized in the shader scope without any packing so the type of the structs are equivalent with what a GLSL program would expect.  TRAC #23327  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add padding to nested structs packed with standard layout to address HLSL's more liberal packing rules.  TRAC #23327  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add support for structs in uniform blocks with standard layout.  TRAC #23327  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Fix a typo when reporting too many interface blocks in a fragment program.  TRAC #23326  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Move the D3DCompile call to after the check for API link errors.  This avoids producing unhelpful internal D3D errors.  TRAC #23326  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Implemented 2D array sampler HLSL translation.  TRAC #23377 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Support sampler2DArray throughout the compiler.  TRAC #23377 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Add 2D array samplers to the lexer/parser.  TRAC #23377 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Add array texture intrinsics to the symbol table.  TRAC #23377 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Fix unconditionally supporting derivative functions in ES3.  TRAC #23377 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Construct texture functions from stored characteristics.  TRAC #23377 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Implemented 3D sampler HLSL translation.  TRAC #23365 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Support sampler3D throughout the compiler.  TRAC #23365 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Add 3D samplers to the lexer/parser.  TRAC #23365 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Add 3D texture intrinsics to the symbol table.  TRAC #23365 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Fixed texture2DProjLod for DX11.  TRAC #23360 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Implemented unsigned integer sampler HLSL translation.  TRAC #23360 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Support usampler throughout the compiler.  TRAC #23360 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Add unsigned integer samplers to the lexer/parser.  TRAC #23360 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Add unsigned integer texture intrinsics to the symbol table.  TRAC #23360 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Implemented integer sampler HLSL translation.  TRAC #23359 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Support isampler throughout the compiler.  TRAC #23359 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Add integer samplers to the lexer/parser.  TRAC #23359 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Add integer texture intrinsics to the symbol table.  TRAC #23359 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Restore using the depth-stencil typed DXGI format for checking for maximum supported samples.  This regression was breaking the es3proto D3D11 testing in Canary.  TRAC #23410  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Fix missing spaces in the Display extensions string.  TRAC #23397  Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add comments to the remaining unimplemented API entry points to prevent automerge from janking code to the wrong place.  TRAC #23399  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
We don't need to keep the param variable around for function prototypes.  Saves 20% memory for global symbol initialization  R=alokp@chromium.org  Review URL: https://codereview.appspot.com/9152043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@2196 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added load functions to depth texture formats.  TRAC #23262  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Added ES3 internal format information about GL_DEPTH_COMPONENT32_OES and mapped DXGI_FORMAT_R32_TYPELESS textures to GL_DEPTH_COMPONENT32F.  TRAC #23262  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Disallow depth textures to be used as destinations of glCopy*Image*.  TRAC #23262  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Fix wrong reading functions being used for some D3D formats.  TRAC #23256  Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Fix potential segfault when calling glBufferData with NULL data pointer.  TRAC #23311  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Geoff Lang, 23355681, 619, 169, 619
Add support for std140 uniform block layout for basic types.  This support does not include structures.  TRAC #23083  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
For the reported std140 layout to be consistent with the spec.  TRAC #23083  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Redesign the code that uses block layouts to use a generic base class.  The cleaner code also has the benefit of allowing us to separate the HLSL-specific parts out of the shader validator.  TRAC #23083  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add two utility matrix functions.  The first returns the number of components in a matrix column/row and the second the number of columns/rows in matrix uniforms.  TRAC #23083  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add parsing for default block storage qualifiers.  Also add in a missing layout qualifier error check.  TRAC #23083  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Alter array instanced uniform buffer objects to use direct references to HLSL constant buffers.  This avoids using a shader scoped static storage buffer with copies.  TRAC #23299  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add support for column/row major layout qualifiers in generated HLSL.  TRAC #23271  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Refactor code for generating structure strings to a separate function.  This could fix a potential regression which might define structs multiple times in generated HLSL.  TRAC #23271  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Pass matrix packing qualifier data back from the shader translator to the GLES API.  TRAC #23271  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add parsing support for global and interface block scoped matrix packing qualifiers.  TRAC #23271  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Enforce shader input and output variables with a specified location to be single declarations.  This prevents using in and out qualifiers on multiply declared vertex inputs and fragment outputs.  TRAC #23311  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Move the parsing of declarator lists into the ParseHelper.  TRAC #23311  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add support for specifying locations of vertex inputs using layout qualifiers for GLSL ES 3.00.  TRAC #23269  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add a new path for querying active attributes from the shader translator for use with layout qualifier support.  TRAC #23269  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill, 23355681, 619, 169, 619
Fix an improper use of VariableRowCount to AttributeRegisterCount in ProgramBinary.  This is a regression from the non-square matrix uniforms implementation.  TRAC #23269  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Authored-by: Jamie Madill, 23355681, 619, 169, 619
Implement GetFragDataLocation often used by applications with MRT shaders in GLSL ES version 300.  TRAC #22704  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Authored-by: Jamie Madill, 23355681, 619, 169, 619
Proper support for fragment output variables for GLSL ES shader version 300.  TRAC #22704  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Authored-by: Jamie Madill, 23355681, 619, 169, 619
Validate fragment shader outputs and produce a compile error on missing or conflicting assignments.  TRAC #22704  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Authored-by: Jamie Madill, 23355681, 619, 169, 619
Blit11 can now blit depth stencils.  TRAC #23321  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Added depth stencil format info to format utils 11.  TRAC #23321  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Seperated the blit depthstencil parameters in the blit methods.  TRAC #23321  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Renderer11::blitRenderbufferRect now can handle stretching a blit rectangle and different interpolation methods.  TRAC #23211  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Refactored validation to glBlitFramebufferANGLE and implemented glBlitFramebuffer.  TRAC #23211  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
RenderTarget11 now always attempts to create an SRV if the format exists and specifies the bind parameters based on which formats are available.  TRAC #23211  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Made sure all the depth stencil DXGI variants that are used as SRVs RTVs and DSVs have entries in the DXGI format info table.  TRAC #23211  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Added a non-default rasterizer state to Blit11 so it can preform inverted blits.  TRAC #23211  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Added support for copying GL_RG GL_RED and integer texture formats in Blit11.  TRAC #23256  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Refactored the Renderer11::copyTexture method into a Blit11 class.  TRAC #23256  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Added a dimension type and added constructors to Color Rectangle Box and Dimension for easy construction.  TRAC #23256  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Renamed the Blit class to Blit9.  TRAC #23256  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Replaced switches in Renderer::readPixels with calls to color reading and writing functions.  TRAC #23256  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Added table entries for reading colors from D3D and DXGI formats and writing colors to format/type combinations.  TRAC #23256  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Added new image formats to match new ES3 formats and added read and write functions to various color types that they can represent.  TRAC #23256  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Moved the image format types into their own header.  TRAC #23256  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Templated the Color structure so it can be used for the new integer and unsigned integer color types.  TRAC #23256  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Initialize the symbol table without invoking the parser.  TRAC #23359 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Assign unique id's to symbols inserted directly into a symbol table level.  TRAC #23359 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Properly report error when layout qualifiers are specified outside uniform blocks.  TRAC #23357  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Authored-by: Jamie Madill, 23355681, 619, 169, 619
Fix non-multisampled line rasterization.  #23334 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Delete a "rej" file that was accidentally committed.  This was a relic from a preliminary lexer 64-bit compliance patch.  TRAC #23158  Authored-by: Jamie Madill, 23355681, 619, 169, 619
Fixed cube map getRenderTarget for DX9.  TRAC #22705 Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Implemented the remaining non-compressed load functions for ES3.  TRAC #23229  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Fix API reported packing rules for matrices and arrays in shared layout to be consistent with HLSL.  HLSL does not round up the final array/matrix block to the register alignment allowing for more compact order.  TRAC #22856  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Fix nested uniforms in interface blocks to have the proper API-visible names.  TRAC #22856  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Fix alignment of HLSL packed structs in interface blocks.  TRAC #22856  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add parsing (but not full support) for global default layout qualifiers for block storage and matrix packing.  TRAC #23268  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Authored-by: Jamie Madill, 23355681, 619, 169, 619
Redesign layout qualifier parsing to be simpler and more storage efficient.  TRAC #23268  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Authored-by: Jamie Madill, 23355681, 619, 169, 619
Move the parsing of single declarations into TParseContext.  TRAC #23268  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Authored-by: Jamie Madill, 23355681, 619, 169, 619
Rename UniformLocation to VariableLocation and add an arrayString helper method to ProgramBinary.  TRAC #23268  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Authored-by: Jamie Madill, 23355681, 619, 169, 619
Properly recognize error cases for 'centroid out' and 'centroid in'.  TRAC #23268  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Authored-by: Jamie Madill, 23355681, 619, 169, 619
Update the shader translator to use new enums for ES3 shader vertex input and fragment outputs.  This fixes many corner cases and error messages with ES3 syntax.  TRAC #23268  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Authored-by: Jamie Madill, 23355681, 619, 169, 619
A special state to track field selection is not necessary.  Identifier is sufficient to parse struct fieldname.  TRAC #23158  Signed-off-by: Nicolas Capens Merged-by: Jamie Madill Authored-by: alokp@chromium.org  git-svn-url: https://code.google.com/p/angleproject/source/detail?r=2195 Review URL: https://codereview.appspot.com/8709048, 23355681, 619, 169, 619
Lexer does not need to handle unknown-char case.  It is handled by the preprocessor. Added an assert.  TRAC #23158  Signed-off-by: Nicolas Capens Merged-by: Jamie Madill Authored-by: alokp@chromium.org  git-svn-url: https://code.google.com/p/angleproject/source/detail?r=2194 Review URL: https://codereview.appspot.com/8653052, 23355681, 619, 169, 619
Lexer does not need a state stack now that it does not handle comments.  TRAC #23158  Signed-off-by: Nicolas Capens Merged-by: Jamie Madill Authored-by: alokp@chromium.org  git-svn-url: https://code.google.com/p/angleproject/source/detail?r=2193 Review URL: https://codereview.appspot.com/8983043, 23355681, 619, 169, 619
Robust distinction between IDENTIFIER and TYPE_NAME tokens.  To distinguish the tokens we used to track the lexer context which is fragile. This patch implements a better way - combine the two tokens into a common parser rule and let the parser context decide if the declaration is valid which it already does by checking the naming conflicts.  TRAC #23158  Signed-off-by: Nicolas Capens Merged-by: Jamie Madill Authored-by: alokp@chromium.org  git-svn-url: https://code.google.com/p/angleproject/source/detail?r=2190 Review URL: https://codereview.appspot.com/8797044, 23355681, 619, 169, 619
Delete dead-code for handling comments and invalid octal integers. These are already handled by the preprocessor.  TRAC #23158  Signed-off-by: Nicolas Capens Merged-by: Jamie Madill Authored-by: alokp@chromium.org  git-svn-url: https://code.google.com/p/angleproject/source/detail?r=2189 Review URL: https://codereview.appspot.com/8632053, 23355681, 619, 169, 619
Deleted unnecessary TParseContext::AfterEOF.  TRAC #23158  Signed-off-by: Nicolas Capens Merged-by: Jamie Madill Authored-by: alokp@chromium.org  git-svn-url: https://code.google.com/p/angleproject/source/detail?r=2188 Review URL: https://codereview.appspot.com/8927045, 23355681, 619, 169, 619
Reformat tokenizer. No functional changes.  TRAC #23158  Signed-off-by: Nicolas Capens Merged-by: Jamie Madill Authored-by: alokp@chromium.org  git-svn-url: https://code.google.com/p/angleproject/source/detail?r=2187 Review URL: https://codereview.appspot.com/8925044, 23355681, 619, 169, 619
Ignore .orig files which result from merge conflicts.  TRAC #23158  Signed-off-by: Nicolas Capens Authored-by: Jamie Madill, 23355681, 619, 169, 619
Add 64bit safety patch step to generate_parser.sh scripts.  TRAC #23274  Authored-by: Shannon Woods Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Adds patch files for 64 bit safety fixes  TRAC #23274  Authored-by: Shannon Woods Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Makes generate_parser.sh executable  TRAC #23274  Authored-by: Shannon Woods Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens, 23355681, 619, 169, 619
Fixed a bug that allowed reading to an integer format from a non-integer frame buffer.  TRAC #23276  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Fixed a bug where ES3 was validating the texture size in non-CopySubImage calls.  TRAC #23276  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Image11 now determines if a format is renderable by checking the RTV format exists rather than the SRV format. Added several more RTV DXGI formats to the table to allow fast copies.  TRAC #23276  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Fixed a bug where GetBlueBits was returning the count of green bits.  TRAC #23278  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Disambiguate getRenderTarget calls.  TRAC #22705 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Fix some uint handling.  TRAC #23185 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Renamed UnsignedInt to UInt in the compiler.  TRAC #23185 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Eliminate unused clone/dump methods.  TRAC #23185 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens, 23355681, 619, 169, 619
Fix an improper usage of getCols which should be getNominalSize in unsigned int vector code.  TRAC #23263  Signed-off-by: Shannon Woods Author: Jamie Madill, 23355681, 619, 169, 619
Marked unsized format load functions as unreachable and added a comment why.  TRAC #23228  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Refactored glGenerateMipmap and added ES3 validation.  TRAC #23277  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
D3D9 will now use D3DFMT_R5G6B5 textures when GL_RGB565 is requested if the device supports it.  TRAC #23279  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Fixed a bug where GL_RBG565 was labled as a GL_RGBA internal format.  TRAC #23279  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Capitalized the first letter of all private format util functions.  TRAC #23212  Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Refactored glRenderBufferStorage* validation and implemented glRenderBufferStorageMultisample.  TRAC #23212  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Added a Renderer::getMaxSupportedFormatSamples method to query the max support samples for a specific internal texture format.  TRAC #23212  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Added Functions for gathering all referenced D3D and DXGI formats. Renderers now use these functions to generate the multisample support maps.  TRAC #23212  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Fix matrix accessor getCols to correct getNominalSize in code that could trigger a debug assertion failure.  Was breaking the ES2-CTS build test in Debug mode.  TRAC #23263  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill, 23355681, 619, 169, 619
Fixed GL_RGB4 not being marked as color renderable in ES3.  TRAC #23243  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Update GYP file to be in sync with vs projects.  TRAC #23244  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang, 23355681, 619, 169, 619
Diverges version for es3proto branch from mainline., 23355681, 619, 169, 619
Adds README.chromium for third-party integration., 23355681, 619, 169, 619
Bump version for es3proto branch.  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2417 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix calling the right overloaded method for getting a cube map face's render target.  TRAC #22705 Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2416 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Restore 64-bit support of the GLSL lexer.  TRAC #23185 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2415 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented lexing support for the floating-point suffix.  TRAC #23185 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2414 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added preprocessor support for parsing the float suffix.  TRAC #23185 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2413 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added preprocessor support for parsing the unsigned integer suffix.  TRAC #23185 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2412 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Restore 64-bit support of the preprocessor tokenizer.  TRAC #23185 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2411 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminated an unused parameter.  TRAC #23185 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2410 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add partial support for parsing layout qualifiers added in the GLES SL 3.00 spec.  This allows us to run a lot of ES3 unit tests and sample apps.  TRAC #23089  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2409 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add several cases to API entry points to handle enum values that dEQP uses to reset state.  The support for these methods is incomplete and unimplemented but will not return INVALID_ENUM.  TRAC #23089  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2408 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Advertise EGL_KHR_create_context so dEQP can successfully create an ES3 context.  We will need to investigate fully supporting this extension in the future.  TRAC #23089  Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2407 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Allow ANGLE developers to toggle unimplemented assertion failures with preprocessor define.  TRAC #23089  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2406 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for unsigned integer literals in the shading language.  TRAC #23080  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2405 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for unsigned integer vector types to the shader translator.  TRAC #23080  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2404 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for the unsigned integer scalar type to the shader translator.  TRAC #23080  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2403 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move the code for parsing constructor functions from the grammar to TParseContext.  TRAC #23080  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2402 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add unsigned integer types to the compiler ConstantUnion class.  TRAC #23080  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2401 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add full integer support to the shader language.  TRAC #23080  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2400 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Put GL to HLSL type string code to a separate helper function in ProgramBinary.  TRAC #23080  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2399 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move logic for parsing fully specified types out of the grammar file to TParseContext.  TRAC #23080  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2398 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add non-square mat support to the shader language interface.  TRAC #23081  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2397 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for folding non-square matrix multiplications.  TRAC #23081  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2396 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix up the indentation and alignment of TIntermConstantUnion::fold to be consistent with the coding style.  TRAC #23081  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2395 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for non-square matrices to the shader translator.  TRAC #23081  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2394 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactor Shader::compareVarying to use a table instead of nested switch statements.  TRAC #23081  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2393 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add a secondary size field to the shader language types to account for matrix rows. Also add some extra logic to the promote method to check that the sizes of the arguments to multiplications are properly formed.  We require this extra information for non-square matrix support.  TRAC #23081  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2392 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactor TIntermBinary::promote to use the required coding style.  TRAC #23081  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2391 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add a helper function to the lexer to tokenize strings that can be identifiers in ES2 and are keywords in ES3.  For instance uint or the non-square matrix keywords.  TRAC #23218  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2390 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add helper functions to the lexer to tokenize strings that have different classifications in ES2 and ES3.  TRAC #23218  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2389 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for arrays of aggregates (aka structs) in uniform blocks.  TRAC #23018  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2388 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for structures in interface and uniform blocks.  Also redesigns the uniform block layout computation to be more general.  TRAC #23018  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2387 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix loading function for GL_RGB32F with D3D9.  TRAC #23224  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2386 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed the patching location of the previous commit.  TRAC #23063 Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2385 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement glRenderbufferStorageMultisample using glRenderbufferStorageMultisampleANGLE.  TRAC #23063 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2384 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement glBlitFramebuffer using glBlitFramebufferANGLE.  TRAC #23055 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2383 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
New functions are only unimplemented when there's a context.  TRAC #23055 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2382 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added some missing format table entries.  TRAC #23215  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2381 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for SRGB textures.  TRAC #23046  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2380 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a function to determine if an internal format is SRGB.  TRAC #23046  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2379 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for the remaining floating point textures.  TRAC #23048  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2378 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved the defines of constant float values into more visible constants.  TRAC #23048  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2377 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactored getFastPixelCopySize to use the format conversion functions.  TRAC #23049  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2376 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added validation for CopyTexImage with integer textures.  TRAC #23049  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2375 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added helper functions for determining if an internal format is an integer or floating point format.  TRAC #23049  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2374 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for integer and unsigned integer texture formats.  TRAC #23049  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2373 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for SNORM texture formats.  TRAC #23051  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2372 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for GL_R11F_G11F_B10F textures.  TRAC #23052  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2371 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Report correct name length for array variables in GetActiveUniformiv.  TRAC #23018  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2370 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Report correct name length for active uniform block arrays.  TRAC #23186  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2369 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add the shader version of the compiled shaders to the program binary.  Also increment the binary version.  TRAC #23182  Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2368 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add adapter LUID to EGL vendor string.  This is so Chrome can create another D3D device on the same adapter that can share resources with ANGLE's D3D device. Review URL: https://codereview.appspot.com/9225046 SVN URL: https://code.google.com/p/angleproject/source/detail?r=2210 TRAC #23166  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Merged-by: Jamie Madill Author: apatrick@chromium.org  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2367 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix using incorrect width and height in transposeMatrix.  This caused issues with non-square matrix uniforms.  TRAC #22840  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2366 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed missing case statements for GL_TEXURE_2D_ARRAY.  TRAC #23162  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2365 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Merged the d3d format info and mip generation tables since both used the same keys.  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2364 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for the GL_RGB9_E5 format.  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2363 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for GL_RED and GL_RG texture formats.  TRAC #22955  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2362 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a templated load function for loading data formats that match.  TRAC #22955  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2361 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented glTexStorage and refactored glTexStorage2DEXT.  TRAC #22869  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2360 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed a bug where immutable textures could not have glTexSubImage called on them.  TRAC #22869  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2359 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed check that width == height for cube maps during SubImage call.  TRAC #22956  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2358 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed missing cases for creating incomplete 3D and 2DArray textures.  TRAC #22956  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2357 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for GL_UNSIGNED_INT_2_10_10_10_REV textures.  TRAC #22956  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2356 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added ES3 validation for glReadPixels and glReadnPixelsEXT.  TRAC #22956  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2355 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactored validation for gl*Tex*Image2D.  TRAC #22956  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2354 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Reorganized the parameters to validateES3CopyTexImageParameters and fixed a bug with compressed destination textures.  TRAC #22956  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2353 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update the libGLESv2 project file to include the new generated pass-through shaders.  TRAC #23189  Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2352 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add new cases for GLES3 SRC_ALPHA_SATURATE blend modes.  TRAC #23125  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2351 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix CONSTANT_ALPHA and ONE_MINUS_CONSTANT_ALPHA blend modes in the D3D11 path.  TRAC #23124  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2350 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Increase the maximum token length in the preprocessor to be 1024 to comply with the GLSL ES 3 specification.  TRAC #23077  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2349 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Regenerate the preprocessor source files with the new versions of the compiler tools.  Will have to be resolved with 64-bit compatible bison in the future.  TRAC #23077  Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2348 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support to the HLSL translator for arrays of named interface blocks.  TRAC #22930  Signed-off-by: Nicolas Capens Signed-off-by: Geoff Lang Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2347 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Enable the translator to pass parsed interface blocks back to the ANGLE API via the shader translator layer.  TRAC #22930  Signed-off-by: Nicolas Capens Signed-off-by: Geoff Lang Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2346 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support to the GLSL to HLSL translator for interface blocks with instance names.  TRAC #22930  Signed-off-by: Nicolas Capens Signed-off-by: Geoff Lang Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2345 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support to the HLSL translator to output interface blocks to constant buffers using HLSL register packing rules.  TRAC #22930  Signed-off-by: Nicolas Capens Signed-off-by: Geoff Lang Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2344 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add logic to compute the size and offsets of interface blocks stored in shared (packed) and standard layouts.  The shared layout follows the standard HLSL packing rules for optimal shader performance.  TRAC #22930  Signed-off-by: Nicolas Capens Signed-off-by: Geoff Lang Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2343 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved utilities.h/cpp and mathutils.h to the shared common code folder.  The HLSL translator needs to compute the sizes of various GL types for computing block layouts.  TRAC #22930  Signed-off-by: Nicolas Capens Signed-off-by: Geoff Lang Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2342 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for parsing interface blocks to the shader translator.  TRAC #22930  Signed-off-by: Nicolas Capens Signed-off-by: Geoff Lang Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2341 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move the logic for parsing structs and index/field selection expressions from the grammar into TParseContext.  TRAC #22930  Signed-off-by: Nicolas Capens Signed-off-by: Geoff Lang Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2340 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Pass uniform buffers active bound to uniform blocks of the active program to HLSL/D3D constant buffers.  TRAC #22892  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2339 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add uniform block linking between the API the program binary and the compiler.  TRAC #22892  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2338 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ensure we have enough space in our reported max uniform buffer counts for our dedicated internal constant buffers.  TRAC #22892  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2337 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Properly validate struct uniform linking between the vertex and pixel shaders.  This also implements proper struct validation for uniform blocks.  TRAC #22932  Signed-off-by: Nicolas Capens Signed-off-by: Geoff Lang Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2336 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented glInvalidateFramebuffer and glInvalidateSubFramebuffer.  TRAC #23133  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2335 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added an abstract invalidate method to rx::RenderTarget.  TRAC #23133  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2334 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Validate allocation size in PoolAllocator. Note that I am planning to get rid of PoolAllocator entirely.  BUG=crbug 179654  Review URL: https://codereview.appspot.com/8662046  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2333 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Store optimization level in program binaries and do not load those compiled with a different level. Review URL: https://codereview.appspot.com/9427043   Conflicts:  	src/libGLESv2/renderer/Renderer9.cpp  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2332 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Bump version.h for dx11proto. Review URL: https://codereview.appspot.com/9330043  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2331 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Merge r2002 to dx11proto: Remove dependency on dwmapi.dll. Review URL: https://codereview.appspot.com/9279048  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2330 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add an extension describing the new D3D renderer chooser behavior in eglGetDisplay.  TRAC #23029  Author: Shannon Woods Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2329 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Control the creation of DX9 or DX11 renderers through eglGetDisplay.  TRAC #23029 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2328 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed old texture conversion functions.  TRAC #22972  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2327 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Replaced remaining uses of old texture conversion functions in gl entry points.  TRAC #22972  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2326 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Replaced remaining uses of old texture conversion functions in gl objects.  TRAC #22972  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2325 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Replaced remaining uses of old texture conversion functions in rx objects.  TRAC #22972  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2324 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renderer initializes the client version to 2 since the renderer is used to create a SwapChain object before the Context has been created and the client version is known.  TRAC #22972  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2323 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Updated the RenderTarget and TextureStorage classes to use new texture format functions.  TRAC #22972  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2322 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Texture storage classes determine the bind flags through the new helper methods.  TRAC #22972  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2321 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Image9 and Image11 determine the d3d formats through the new helper methods.  TRAC #22972  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2320 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Replaced the Image::generateMipmap switch statements with function calls to get the mip generation function.  TRAC #22972  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2319 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed the static Image data loading functions.  TRAC #22972  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2318 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Image::loadCompressedData now uses new loading functions.  TRAC #22972  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2317 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Texture image setting functions use the refactored texture conversion and loading functions.  TRAC #22972  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2316 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Put the renderer*_utils functions into the rx namespace.  TRAC #22972  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2315 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Texture::setImage methods now have an internal format parameter if the internal format is unsized a sized one is computed so that Texture classes always store sized internal formats.  TRAC #22972  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2314 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Created new helper functions for converting texture formats loading images and generating mipmaps."  TRAC #22972  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2313 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Split the floating point texture queries into individual methods and mark all support methods as const.  TRAC #22972  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2312 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for querying number of active uniform blocks/block name max length from a program object.  TRAC #22858  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2311 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement glGetActiveUniformBlockiv.  TRAC #22858  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2310 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement glGetActiveUniformBlockName.  TRAC #22858  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2309 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement UniformBlockBinding and necessary state to track uniform block bindings on the API side.  TRAC #22858  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2308 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement the API-side logic GetUniformBlockIndex. Functionality depends on shader support.  TRAC #22858  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2307 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add state for uniform blocks to ProgramBinary along with loading and saving of the new binary format.  Updated Version.h with this patch.  TRAC #22858  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill Conflicts:  	src/common/version.h  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2306 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactor Uniform::[vp]sRegisterIndex to unsigned integers.  TRAC #22858  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2305 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix line endings in the Uniform source and header files to be UNIX-style.  TRAC #22858  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2304 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add a helper routine to parse out uniform array indices.  TRAC #22858  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2303 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for querying uniform block related enums.  TRAC #22858  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2302 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update the shader compiler/translator bison-generated source files with the latest cygwin releases.  TRAC #22934  Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2301 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix the off-by-one errors in the indexed binding functions BindBufferBase and BindBufferRange.  TRAC #22958  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2300 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ensure non-zero transform feedback buffers must only be bound with an offset and size of a multiple of four.  TRAC #22958  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2299 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Allow the application to implicitly create buffers by binding them at indexed binding points without previously calling GenBuffers or BufferData.  TRAC #22958  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2298 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Return correct GL version and GLSL ES version strings when we are running in an ES3 context.  TRAC #22865  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2297 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement glGetStringi for querying specific extension strings.  TRAC #22865  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2296 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Not not allow the app to query uniform locations of basic types with "[0]" appended to the uniform name.  TRAC #22865  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2295 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement glGetActiveUniformsiv querying specific uniform properties.  TRAC #22865  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2294 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement GetUniformIndices for retrieving active uniform indices from their names.  TRAC #22865  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2293 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for querying gl_DepthRange as an active uniform via GetActiveUniform.  TRAC #22865  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2292 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix binding of the generic uniform buffer bind point when setting the transform feedback binding point in BindBuffer.  TRAC #22852  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2291 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add a path to BufferStorage11 to point to D3D11 constant buffer data storage for uniform buffer objects.  TRAC #22852  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2290 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add and implement Renderer::getMaxUniformBufferSize() returning the maximum uniform buffer/block size.  TRAC #22852  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2289 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Call BufferStorage::markUsage when we retrieve a buffer pointer for rendering instead of when we prepare data.  The automatic call eliminates function calls from other points in the library.  TRAC #22852  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2288 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Redesign BufferStorage11 to support simultaneously managing constant buffers and vertex/index buffers.  TRAC #22852  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2287 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add a roundUp math utility function that rounds an integral value up to a nearest multiple.  TRAC #22852  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2286 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add state queries for uniform buffer object count and alignment and enforce a large alignment.  This will allow us to force the app to bind uniform buffers with zero offset. Zero offset allows us to map uniform blocks one-to-one to uniform buffers then subsequently map UBOs to constant buffers.  TRAC #22852  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2285 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make the sentinel value for glBindBufferBase whole-buffer binding zero instead of -1 to harmonize with the spec.  TRAC #22852  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2284 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented mipmap generation for 3D textures.  TRAC #22926  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2283 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renderer11::copyTexture can now copy 3D textures.  TRAC #22926  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2282 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added 3D versions of the passthrough shaders.  TRAC #22926  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2281 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
TextureStorage11_3D can generate render targets for the entire texture now as well as each layer.  TRAC #22926  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2280 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
RenderTargets now store a depth value.  TRAC #22926  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2279 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renamed the passthrough shaders to show that they are for 2D.  TRAC #22926  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2278 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactored CPU mipmap generation and added 3D texture mipmap generation functions.  TRAC #22926  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2277 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented mipmap generation for 2D array textures.  TRAC #22927  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2276 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a map type parameter to Image11::map since it was always being mapped for writing but mipmap generation was reading.  TRAC #22927  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2275 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add new GLSL ES 3.0 built-in constants and split off 1.0 ones.  TRAC #22863 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2274 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented basic GLSL ES 3.0 texture intrinsics.  TRAC #22954 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2273 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Skip symbol table levels with built-ins for a different shader version.  TRAC #22954 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2272 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Insert GLSL ES 1.0 built-in variables at the right level.  TRAC #22954 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2271 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Place built-in intrinsics into their corresponding symbol table level.  TRAC #22954 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2270 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
GLSL ES 1.0 operator built-ins are all common with GLSL ES 3.0.  TRAC #22954 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2269 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Split the built-in symbols over multiple symbol table levels.  TRAC #22954 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2268 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Texture2DArray now uses dynamically allocated arrays to store Image objects.  TRAC #22918  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2267 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fall back to creating a Release runtime Direct3D device if Debug device creation fails.  TRAC #22881  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2266 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add a fast path for single render target masked clears in Renderer11.  TRAC #22898  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2265 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Migrate calls to releasing COM objects in Renderer11 to new SafeRelease helper method.  TRAC #22898  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2264 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add a helper method to gl::Framebuffer to check if we are drawing to color attachment 0 only.  TRAC #22898  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2263 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Enable base address randomization.  TRAC #22937 Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2262 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Bump version.h  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2181 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented GL_TEXTURE_2D_ARRAY targets for glTex* functions.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2180 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a binding point for TEXTURE_2D_ARRAY.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2179 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Created the Texture2DArray class.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2178 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added GL_MAX_ARRAY_TEXTURE_LAYERS.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2177 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Created the TextureStorageInterface2DArray class.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2176 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a TextureStorage11_2DArray class.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2175 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Image::redfine now takes a target parameter Image11 creates an appropriate resource based off of the target.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2174 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Updated glGenerateMipmap to accept the GL_TEXTURE_3D target.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2173 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented 3D texture entry points.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2172 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Updated the parameter validation functions to include 3d versions.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2171 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a binding point for TEXTURE_3D.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2170 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Created a gl::Texture3D class.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2169 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added the GL_TEXTURE_WRAP_R parameter.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2168 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added parameters for maximum 3D texture size. Renamed maximum 2D texture size methods and variables.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2167 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Updated Image::copy to have a zoffset parameter.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2166 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added 3D versions of Renderer::copyToRenderTarget and Renderer::copyImage.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2165 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed some extra overloads of TextureStorage::getRenderTarget and added a method to get the render target of a Texture3D layer.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2164 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
RenderTarget11 now stores a Resource instead of a Texture2D.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2163 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Image11 now stores an ID3D11Resource for the staging texture and creates 3D staging textures if depth is greater than one.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2162 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added 3D texture classes for TextureStorage and TextureStorageInterface.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2161 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a helper function for generating pointer offsets and changed type names to include size for clarity.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2160 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added depth parameters to all image loading functions.  TRAC #22705  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2159 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for renderbuffer formats used by the CTS.  TRAC #22890 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2158 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Enable broadcasting gl_FragColor to all draw buffer color attachments in ES2 contexts.  TRAC #22888  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  Conflicts: 	src/libGLESv2/ProgramBinary.cpp  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2157 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix not correctly allowing the 'require' keyword in shaders enabling EXT_draw_buffers.  TRAC #22888  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2156 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Report gl_MaxDrawBuffers as 1 when the MRT extension is disabled and the implementation value otherwise.  TRAC #22888  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2155 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement flat and centroid interpolation in HLSL.  TRAC #22857 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2154 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Generate the same code once for fragment and vertex varyings.  TRAC #22857 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2153 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds Jamie and Geoff to CONTRIBUTORS file  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2152 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Revert device lost display mode changed handling in the D3D9 path.  See https://codereview.appspot.com/8038044  TRAC #22882  Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2151 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix zero-sized buffer copies to complete successfully in BufferCopySubData.  TRAC #22878  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2150 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented interpolation qualifier parsing.  TRAC #22857 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2149 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for unsigned int uniform types to the getUniform series of methods.  TRAC #22845  Signed-off-by: Geoff Lang Signed-off-by: Shanon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2148 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactor the ProgramBinary::getUniform family of calls to use a private generic method.  TRAC #22845  Signed-off-by: Geoff Lang Signed-off-by: Shanon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2147 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactor getUniform for matrix types to use a single shared internal method.  TRAC #22845  Signed-off-by: Geoff Lang Signed-off-by: Shanon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2146 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add a utility method to determine if a gl enum type is a matrix type and some supporting methods.  TRAC #22845  Signed-off-by: Geoff Lang Signed-off-by: Shanon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2145 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add handling of non-square matrix uniform types to utility methods.  TRAC #22845  Signed-off-by: Geoff Lang Signed-off-by: Shanon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2144 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for unsigned integer uniforms. Depends on shader language support for the same.  TRAC #22842  Signed-off-by: Geoff Lang Signed-off-by: Shanon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2143 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add handling of unsigned int uniform cases to utility functions.  TRAC #22845  Signed-off-by: Geoff Lang Signed-off-by: Shanon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2142 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactor ProgramBinary::setUniform[XX] to use a generic template function reducing duplicated code.  TRAC #22842  Signed-off-by: Geoff Lang Signed-off-by: Shanon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2141 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Modify the glUniform[X]ui calls to call the corresponding glUniform[X]uiv functions internally.  TRAC #22842  Signed-off-by: Geoff Lang Signed-off-by: Shanon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2140 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for the transpose parameter of the glUniformMatrix family of functions in ES3.  TRAC #22839  Signed-off-by: Geoff Lang Signed-off-by: Shanon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2139 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for non-square matrix uniforms. Depends on implementing shader support for the same.  TRAC #22839  Signed-off-by: Geoff Lang Signed-off-by: Shanon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2138 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make ProgramBinary::setUniformMatrix[X]fv a generic template method.  TRAC #22840  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2137 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix a bug in transposeMatrix for correct use with non-square matrices.  TRAC #22839  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2136 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed a bug where BufferStorage11 was unable to handle NULL data being set.  TRAC #22811  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2135 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented glCopyBufferSubData.  TRAC #22811  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2134 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a copyBufferSubData method to Buffer.  TRAC #22811  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2133 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added an abstract BufferStorage::copyData method and implemented it for BufferStorage9 and BufferStorage11.  TRAC #22811  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2132 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added pixel pack and unpack buffer bindings.  TRAC #22811  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2131 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added binding points for the copy read and copy write buffers.  TRAC #22811  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2130 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added methods to Context to get and set the current (non-indexed) bound uniform and transform feedback buffers.  TRAC #22811  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2129 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Enable MRT support via glDrawBuffersEXT.  TRAC #22704  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2128 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Alter the precompiled header to import prototypes for the gl extension functions for internal use.  TRAC #22704  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2127 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Only support ES3 contexts on Shader Model 4+ hardware.  TRAC #22854 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2126 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for packed integer vertex attributes.  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2125 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Output all fragment data to gl_Color.  TRAC #22715 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2124 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Support in/out as type qualifiers.  TRAC #22715 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2123 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for new ESSL 3.00 keywords.  TRAC #22715 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2122 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Accept shader version 300 on ES3 contexts.  TRAC #22712 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2121 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add min and max blend modes.  TRAC #22836  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2120 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for GL_INT and GL_UNSIGNED_INT vertex attributes.  TRAC #22693  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2119 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added conversion rules for GL_INT and GL_UNSIGNED_INT for VertexBuffer11.  TRAC #22693  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2118 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Merged the current value attributes into the regular vertex attributes so they follow the same conversion rules.  TRAC #22693  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2117 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Created a structure for holding current attribute data.  TRAC #22693  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2116 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix glDrawBuffersEXT to be compliant with the spec.  Bind GL_NONE to buffers beyond the specified input count and require a buffer count of one for the default framebuffer.  TRAC #22835  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2115 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add an ExternalCompilerOptions parameter for use with MSBuild on the command line.  This is necessary for continuous integration to pass D3D11 mode build flags.  TRAC #22555  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2114 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added new acceptable es3 usage tokens for glBufferData.  TRAC #22794  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2113 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented glBindBufferBase and glBindBufferRange.  TRAC #22753  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2112 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added uniform and transform feedback state and setting on context.  TRAC #22753  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2111 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a new type of binding pointer which stores offset and size.  TRAC #22753  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2110 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added getter methods to renderer for checking maximum uniform and transform feedback buffers.  TRAC #22753  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2109 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed build failure.  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2108 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add SwapChain::recreate for dealing with certain cases of lost devices.  See https://code.google.com/p/angleproject/source/detail?r=1993  TRAC #22826  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2107 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
When CheckDeviceStats returns S_PRESENT_MODE_CHANGED reset display mode and retest for device lost.  Unless the display mode is reset CheckDeviceLost can keep returning S_PRESENT_MODE_CHANGED potentially masking a device lost on account of a GPU hang causing ANGLE to fail to report context lost. Review URL: https://codereview.appspot.com/7381061  TRAC #22720  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2106 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix a warning in the cast of Renderer9::mDeviceCaps.MaxAnisotropy.  See http://code.google.com/p/angleproject/source/detail?r=2000  TRAC #22826  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2105 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fast path for BGRA to RGBA readPixels conversions.  From http://code.google.com/p/angleproject/source/detail?r=1999  TRAC #22825  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2104 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented glVertexAttribDivisor.  TRAC #22816  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2103 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Do not broadcast output of gl_FragColor to all attached render targets when using a GLES 3.0 context.  TRAC #22704  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2102 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Relax the requirement for all color attachments to have the same number of bitplanes for ES 3.0 contexts.  TRAC #22704  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2101 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Store the current context client version in the Renderer for ease of access.  TRAC #22704  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2100 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add a multiple render targets sample using EXT_draw_buffers. Requires the D3D11-enabled ANGLE.  TRAC #22797  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2099 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Enable MRT support by exposing glDrawBuffersEXT to the application.  TRAC #22710  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2098 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix an improper upper case case 'B' in getFirstColorbuffer.  TRAC #22679  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2097 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix D3D11 depth/stencil framebuffer blit.  D3D11 requires the pSrcBox parameter to be NULL for depth/stencil CopySubresourceRegion calls.  TRAC #22679  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2096 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement multiple render target support in glBlitFramebufferANGLE.  TRAC #22679  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2095 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactor Renderer11::blit to use simpler control flow.  TRAC #22679  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2094 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added flag to suppress D3D11 warnings about missing render target views when drawing multiple render targets.  TRAC #22679  Signed-off-by: Geoff Lag Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2093 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added Renderer11 methods to set a one-time render target and unapply render target state.  TRAC #22679  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2092 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for HALF_FLOAT vertex attributes.  TRAC #22703  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2091 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Modified the default value used in the vertex widen rule so that it is specified as a template argument.  TRAC #22703  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2090 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Advertise ES3 renderable in available configs  TRAC #22806  Signed-off-by: Geoff Lang Signed-off-by: Jamie Madill Author: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2089 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Updates EGL headers  TRAC #22805  Signed-off-by: Jamie Madill Signed-off-by: Geoff Lang Author: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2088 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds ES3 functions to .def file for export  TRAC #22805  Signed-off-by: Jamie Madill Signed-off-by: Geoff Lang Author: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2087 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for line continuations.  TRAC #22713 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2086 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Pixel shaders support MRT output.  TRAC #22668  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2085 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Shader and Compiler track uses of gl_FragCoord and gl_FragData and MRT extension usage.  TRAC #22668  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2084 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
BuiltInResources initialized with MRT limits from renderer.  TRAC #22668  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2083 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Store the BuildInResources in the Compiler class so the draw buffer data can be read during shader output.  TRAC #22668  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2082 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for multiple render targets in glClear.  TRAC #22659  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2081 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added DRAW_BUFFERx_EXT support to getIntegerv and related functions.  TRAC #22656  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2080 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add and implement glDrawBuffersEXT entry point to libGLESv2.  TRAC #22657  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2079 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactor Renderer11::getRenderTargetResource to accept a gl::Renderbuffer instead of a gl::Framebuffer.  TRAC #22656  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2078 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Enable multiple render targets in Renderer11::applyRenderTarget.  TRAC #22656  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2077 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add helper functions to safely release Windows COM resources and arrays of COM resources.  TRAC #22656  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2076 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Rename renderbufferObject to colorbuffer in Renderer11::applyRenderTarget.  TRAC #22656  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2075 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Safely promote uninitialized constants.  TRAC #22676 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2074 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't assume unary operations on constants will be folded into a constant.  TRAC #22676 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2073 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ignore constants that have not been initialized.  TRAC #22676 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2072 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Provide safer and more convenient constant union accessors.  TRAC #22676 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2071 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added stubs for all the new ES3 entry points with events and an error check to verify that the context is an ES3 context.  TRAC #22694  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2070 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added the GLES3 headers and updated all locations where the GLES2 headers were included to also include the GLES3 headers.  TRAC #22694  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2069 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Updated gl2.h and gl2ext.h.  TRAC #22694  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2068 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
eglCreateContext passes the client version to the context. gl::Context stores the client version to validate gl function parameters.  TRAC #22694  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2067 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove the old single-color-attachment calls from gl::Framebuffer preferring the new multiple-attachment versions.  TRAC #22656  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2066 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add multiple color buffer attachments points to gl::Framebuffer.  Also addded the checks for framebuffer completeness as defined by the ES2 spec and EXT_draw_buffers.  TRAC #22656  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2065 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add const qualifiers to several methods in gl::Framebuffer.  TRAC #22656  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2064 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Allow the application to query the maximum number of color attachment point values with GetIntegerv.  TRAC #22656  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2063 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added getMaxRenderTargets() to Renderer for a runtime-specific value for the maximum simulatenous render targets.  We will report this as our maximum draw buffer and color attachment count.  TRAC #22656  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2062 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add necessary defines and function prototypes for EXT_draw_buffers and multiple color attachment points to gl2ext.h  TRAC #22656  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2061 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Bump ANGLE_SH_VERSION to 110.  The bump to 109 in r1984 collided with a similar version change in dx11proto branch (r1738). Review URL: https://codereview.appspot.com/7446050  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2060 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Enabled FRAGMENT_PRECISION_HIGH unconditionally for ANGLE. Review URL: https://codereview.appspot.com/7460048   Conflicts: 	src/libGLESv2/Shader.cpp  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2059 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added preprocessor support for GL_FRAGMENT_PRECISION_HIGH. I will send the tests in a separate patch because I need to refactor the way compiler_tests are setup. Review URL: https://codereview.appspot.com/7402051  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2058 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed compile error for preprocessor tests. Review URL: https://codereview.appspot.com/7388051  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2057 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes infinite recursion in QueryX::getResult due to similarly named base class accessor.  TRAC #22716  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2056 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make position the first vertex output varying on DX9 again to work around an NVIDIA driver issue.  TRAC #22688 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2055 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Creating branch for ES3 prototype  git-svn-id: https://angleproject.googlecode.com/svn/branches/es3proto@2054 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix warning as error in Renderer.cpp. Review URL: https://codereview.appspot.com/7420046  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1981 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix build_angle.gypi so libGLESv2 and libEGL can find precompiled.h. Review URL: https://codereview.appspot.com/7450045  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1980 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update build revision  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1977 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed plain integer pointers being passed to ShGetInfo which expects size_t pointers.  TRAC #22678  Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1976 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Updated the error handling of compressed image sizes based on the ANGLE_texture_compression_dxt spec.  TRAC #13332  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1975 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed a bug where the texture would not be marked as dirty if mLodOffset was not zero.  TRAC #13332  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1974 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed lod level subtraction since TextureStorage::levelCount already subtracts the lod level.  TRAC #13332  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1973 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Image11 now generates multiple mip levels in its staging texture if a lod offset is required. TextureStorage11::updateSubresourceLevel now takes a subresource index on the source texture and copies to the correct subresource if mLodOffset is non-zero.  TRAC #13332  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1972 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Made Image11::getStagingTexture private and removed the undefined Image11::updateStagingTexture method.  TRAC #13332  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1971 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed a bug where the wrong number of mip levels would be generated if levels was zero and the lod offset was non-zero.  TRAC #13332  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1970 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a utility function to determine if a dxgi format is compressed.  TRAC #13332  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1969 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Convert(Min/Max)Lod now takes into account the lod offset so that it always falls within the min and max.  TRAC #13332  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1968 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Updates ANGLE_depth_texture to reflect proposed changes in requirements for g and b channels.  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1967 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Build fix for qt-wk2 Review URL: https://codereview.appspot.com/7381049  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1966 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix ANGLE patching/building issues.  1) Remove an empty file: this causes patch apply failures when updating WebKit side ANGLE. 2) Fix a 64-to-32 conversion issue. 3) Append a change to Tokenizer.l that's left out in a previous CL. (cpp is already updated). Review URL: https://codereview.appspot.com/7378051  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1965 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
This pulls in mvujovic's build fix in WebKit ANGLE.  Original patch: http://trac.webkit.org/changeset/139665 Review URL: https://codereview.appspot.com/7392044  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1964 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for extension EXT_draw_buffers. Review URL: https://codereview.appspot.com/7308107  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1963 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix signed / unsigned warning in ParseHelper.cpp. Review URL: https://codereview.appspot.com/7330046  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1962 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed one remaining 64-bit truncation issue missed in the last CL.  BUG=396 Review URL: https://codereview.appspot.com/7323055  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1961 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed 64-bit integer truncation issues in shader translator.  This is an incompatible API change but one which is necessary in order to improve correctness of the code. The API version in ShaderLang.h is updated and unfortunately the define renamed to something less ambiguous due to conflicts on some Android buildbots. Temporary patches in Chromium and WebKit will be landed separately to support this upgrade.  BUG=403404405406407408409 Review URL: https://codereview.appspot.com/7300058   Conflicts: 	include/GLSLANG/ShaderLang.h  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1960 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix a 64-bit error in ProgramBinary::load  ProgramBinary::save writes a size_t so ProgramBinary::load needs to read it as the same type.  Landed for jschuh. Original review: https://codereview.appspot.com/7304057/ Review URL: https://codereview.appspot.com/7310052  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1959 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Check that the incoming type to a default precision qualifier statement is valid.  Fixes new WebGL conformance tests shader-with-illegal-default-precision.frag.html and shader-with-illegal-default-precision.vert.html per http://www.khronos.org/bugzilla/show_bug.cgi?id=781 . Also ran WebGL 1.0.1 conformance tests; no regressions.  BUG=none Review URL: https://codereview.appspot.com/7302043  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1958 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Revert the change to treat S_PRESENT_MODE_CHANGED always as device lost on D3D9.  See: https://codereview.appspot.com/7398052/  TRAC #22492  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1957 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Place each info log message on a new line.  TRAC #22635 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1956 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Provide an error message when uniform linking fails.  TRAC #22635 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1955 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Only discard the storage texture when there is a mismatch with its mipmap chain.  TRAC #20587 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1954 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11::getDepthTextureSupport.  TRAC #22587  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1953 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Scale the vertex coordinates when the viewport has been clamped.  TRAC #22649 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1952 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed a bug where a static buffer could sometimes be used if it had not had data written to it.  TRAC #22665  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1951 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix ViewDimension for texture cube SRVs to always be specified as a texture cube.  This caused a D3D11 error on D3D10-only systems.  TRAC #22662  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1950 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Revert changes to markAllStateDirty that cleared D3D11 shader resources.  TRAC #22642  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1949 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Disable two D3D11 warnings that would sometimes spam the output log for certain WebGL content.  These warnings identified when we set a render target that was bound as a shader resource and were benign.  TRAC #22642  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1948 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Only allow direct vertex buffers binding with attribute with 4 byte aligned offsets.  TRAC #22647  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1947 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix D3D11 errors from specifying the order of FragCoord PointCoord etc different between GS and PS.  TRAC #22646  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1946 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ensure nested ternary operator unfolding uses a new scope to avoid redefinition of the same temporary variable.  TRAC #22629 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1945 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Only retrieve the precision of integer and floating-point types.  TRAC #22635 Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1944 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use ArraySize to determine size of static arrays.  TRAC #22558  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1943 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fall back to drawing indexed points without indices in d3d9.  TRAC #22633  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1942 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Validate matching uniform precisions.  TRAC #22635 Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1941 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Store the precision of uniforms.  TRAC #22635 Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1940 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Clamp the depth passed from glClearDepthf to (01) in Renderer11::clear.  This fixes potential out of range D3D11 errors.  TRAC #22643  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1939 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add precompiled header support for the libGLESv2 project.  TRAC #22518  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1938 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove a lot of unnecessary include files and break include chains.  This should speed up incremental compile times when modifying headers by reducing the number of dependencies.  TRAC #22518  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1937 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add a new header for some constants from Context.h.  TRAC #22518  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1936 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't discard texture storage when redefining and image to generate mip maps.  TRAC #22632  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1935 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Clear all applied texture resources in Renderer11::markAllStateDirty.  This fixes some D3D11 warnings about having the current render target bound to a shader resource view.  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1934 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Pass through the PSIZE semantic all the way to the fragment shader in D3D11 fixing a register error.  In some cases when the app would draw triangles and writes to gl_PointSize the vertex shader would output PSIZE and the pixel shader would not read it as an input.  TRAC #22561  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1933 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix the D3D11 errors being produced about using wrong input layout register signatures.  This was caused by using the same input layout for vertex shaders with different input signatures.  TRAC #22561  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1932 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Sort the elements of the D3D11 input layouts before we store them in the cache.  This prevents a D3D11 error complaining that the input layout uses a different ordering of the vertex elements than the vertex shader.  TRAC #22561  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1931 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make some getter functions in ProgramBinary const.  TRAC #22561  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1930 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix regression in point sprite geometry shader scaling.  Broken in #22428.  TRAC #22551  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1929 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Validate the number of uniform vectors.  TRAC #22571 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1928 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add handling for certain cases of D3D9Ex device lost.  This will allow us to handle TDR restarts on newer machines. We still don't handle D3DERR_DEVICEREMOVED.  TRAC #22492  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1927 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use optimization level 0 for D3D11.  TRAC #22516 Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1926 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't split loops on Shader Model 4+.  TRAC #22516 Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1925 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix D3D11 errors where the application passes in QNAN to glPolygonOffset or for the viewport bounds.  TRAC #22565  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1924 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix using polygonOffsetUnits in place of polygonOffsetFactor in the D3D11 path.  TRAC #22565  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1923 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use actualFormat instead of internalFormat for checking if we can do a fast copy in Image11::copy.  TRAC #22586  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1922 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add the proper data offset in Image11::copy for the slow pixel copy method.  TRAC #22586  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1921 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Clear the Geometry Shader state in Renderer11::maskedClear.  TRAC #22569  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1920 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Expand GL sampler arguments to a texture and sampler argument for D3D11.  TRAC #22593 Signed-off-by: Shannon Woods Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1919 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Initialize shader resource view member to NULL.  TRAC #22595  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1918 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed the alpha blend mask not being initialized for masked clears.  TRAC #22590  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1917 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11:getDXT1/3/5TextureSupport.  TRAC #22422  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1916 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Image11 and TextureStorage11 make sure sizes are aligned properly.  TRAC #22422  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1915 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved common members in TextureStorage11_2D and TextureStorage11_Cube into TextureStorage11.  TRAC #22422  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1914 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a utility function to determine required texture size alignments.  TRAC #22422  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1913 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Change the max reported viewport size to be the same as the maximum texture size in D3D11.  This fixes a regression in the WebGL conformance test "drawingbuffer-test".  TRAC #22582  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1912 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix the y offset of Renderer11::copytexture to correct the inverted output image.  Was breaking the WebGL conformance test copy-tex-image-and-sub-image.  TRAC #22589  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1911 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use Map/Unmap instead of UpdateSubResource for uniforms.  TRAC #22480 Signed-off-by: Geoff Lang Signed-off-by: Jamie Madill Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1910 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renamed and reorganized the vertex conversion tables in VertexBuffer9.  TRAC #22552  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1909 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
TextureStorage11 classes now create shader resource views for depth stencils.  TRAC #22500  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1908 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added utility functions for converting depth stencil DXGI_FORMATs.  TRAC #22500  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1907 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Declare vertex varyings which have not been written to allow successful linking.  TRAC #22581 Signed-off-by: Jamie Madill Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1906 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Isolate D3DCompiler.h include to just the cpp files that need it instead of every file that uses the renderer.  TRAC #22499  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1905 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Break some of the include chains that cause unneeded dependencies between headers.  TRAC #22499  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1904 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Change filter organization for the Renderer source files further subdivided between 9 and 11.  TRAC #22499  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1903 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove D3D9 header included in the D3D11 path and some references to D3DERR.  TRAC #22499  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1902 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed a bug where the streaming buffer would not get space reserved if a higher index static buffer was invalidated.  TRAC #22543  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1901 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactored calculation if a vertex buffer can do direct storage into a helper function.  TRAC #22543  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1900 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved duplicate code.  TRAC #22428 Signed-off-by: Geoff Lang Signed-off-by: Jamie Madill Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1899 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Optimized applying DX11 uniforms with memcpy.  TRAC #22428 Signed-off-by: Geoff Lang Signed-off-by: Jamie Madill Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1898 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Store integer and boolean uniforms in 4-element vectors.  TRAC #22428 Signed-off-by: Geoff Lang Signed-off-by: Jamie Madill Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1897 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Store boolean uniforms as 32-bit integers.  TRAC #22428 Signed-off-by: Geoff Lang Signed-off-by: Jamie Madill Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1896 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminate unused DX11 driver uniforms.  TRAC #22428 Signed-off-by: Geoff Lang Signed-off-by: Jamie Madill Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1895 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix the conversion of textures to rendertargets to use the right number of mip levels if we already initialized storage.  When a texture was initialized with glStorage2DEXT or similar the conversion to RT could change the number of mips.  TRAC #22560  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1894 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix clearing the geometry shader state in copytexture and errors generated by a BGRA backbuffer format.  TRAC #22545  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1893 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Only advertise postSubBuffer extension if we can actually present less than the whole buffer.  This is not available in D3D11 though it is added in D3D11.1.  TRAC #22506  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1892 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix the SwapChain11::swapRect x and y coordinates to reference the lower left corner at (00).  TRAC #22506  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1891 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Allow zero sized system window FBO to be declared complete and let the application use them for rendering.  TRAC #22548  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1890 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ensure we do not try to create a swapchain with dimensions smaller than 1x1.  TRAC #22548  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1889 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix a regression when drawing point sprites with a non-one-valued w coordinate.  TRAC #22551  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1888 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Index data manager uses direct buffers for indices if possible.  TRAC #22297  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1887 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
VertexDataManager now supports direct buffers when vertex conversion is not needed.  TRAC #22297  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1886 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
VertexBuffer has a new abstract method to determine if conversion is required for a given attribute type.  TRAC #22297  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1885 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added an identity flag to VertexBuffer11's conversions.  TRAC #22297  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1884 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
gl::Buffer now uses an rx::BufferStorage to store the data.  TRAC #22297  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1883 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a BufferStorage creation method to renderer.  TRAC #22297  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1882 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Created a BufferStorage11 class.  TRAC #22297  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1881 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Created a BufferStorage9 class.  TRAC #22297  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1880 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Created a BufferStorage abstract class.  TRAC #22297  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1879 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11::getFloat*TextureSupport.  TRAC #22502  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1878 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a utility function for determining the size of an array.  TRAC #22502  Signed-off-by: Jamie Madill Signed-off-by: Nicolas Capens Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1877 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix a regression with point sprites where the geometry shader state was not properly updated.  This was breaking the ES2 point sprites conformance test.  TRAC #22544  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1876 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement larger bounds for viewports and scissor rectangles in D3D11.  This fixes a bug where we would not allow the application to draw outside the viewport which is valid.  TRAC #22497  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1875 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add a simple Range type to represent an integer 1D range.  TRAC #22497  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1874 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Enable anisotropic filtering support on the D3D11 path.  TRAC #22504  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1873 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for resizing the window without recreating the swap chain in D3D11.  TRAC #22406  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1872 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't convert normalized integer types they are interpreted as floating-point in the shader.  TRAC #22440 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1871 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11::getLuminance*TextureSupport  TRAC #22503  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1870 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Changed the rectangle arguments of Renderer11::blitRect from pointers to const references since they are never null or modified.  TRAC #22416  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1869 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11::blitRect for render targets.  TRAC #22416  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1868 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a texture object to RenderTarget11.  TRAC #22416  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1867 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a helper Renderer11::resolveMultisampledTexture method.  TRAC #22416  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1866 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed a rounding bug in copyTexture and removed a redundant parameter blend state setting.  TRAC #22416  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1865 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
RenderTarget11 now creates multisampled render targets.  TRAC #22417  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1864 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
RenderTarget11 converts the format again for mActualFormat to match RenderTarget9.  TRAC #22417  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1863 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a Renderer11::getNearestSupportedSamples method.  TRAC #22417  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1862 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11::getMaxSupportedSamples.  TRAC #22417  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1861 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Preserve the D3D11 offscreen texture contents when the swap chain is reset (ie from window resize).  TRAC #21929  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1860 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move the code related to creating and resetting offscreen texture resources to its own method.  TRAC #21929  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1859 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Only allocate offscreen texture resources when we need them not every time we reset the swapchain.  This fixes a memory leak that caused the swapchain to initialize unbounded amounts of resources.  TRAC #21929  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1858 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add the ability to recover from a removed device (TDR or driver removal) to the D3D11 code path.  TRAC #22411  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1857 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Enclose error(GLint) and error(EGLint) into gl and egl namespaces.  This should generate a compile time error if we try to call the wrong function.  TRAC #22411  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1856 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move the call to notify device lost to the Renderer.  TRAC #22411  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1855 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Enclose isDeviceLostError and checkDeviceLost in their corresponding d3d9/d3d11 namespaces.  TRAC #22411  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1854 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix regressions in the unit tests related to setting gl_PointSize and using other draw modes.  This had two regressions using gl_PointSize and drawing triangles and drawing points and triangles with the same binary program.  TRAC #22526  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1853 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use the D3D11 adapter LUID for our adapter identifier check in ProgramBinary.  TRAC #22498  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1852 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for more depth buffer formats in our EGLConfigs.  This includes no depth buffer and 16-bit depth buffer with no stencil buffer.  TRAC #22496  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1851 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix the order of the channels in readPixelColor which was messing up BGRA to RGBA readPixels.  TRAC #22529  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1850 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Enabled vsync in SwapChain11.  TRAC #22505  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1849 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Updates to extensions from public registry  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1848 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Created Fence11.  TRAC #22420  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1847 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Created Query11.  TRAC #22419  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1846 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Integrated the new rx::Fence class into gl::Fence.  TRAC #22418  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1845 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a fence creation method to Renderer.  TRAC #22418  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1844 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Created Fence9.  TRAC #22418  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1843 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Created an abstract rx::Fence class.  TRAC #22418  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1842 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed some circular includes.  TRAC #22418  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1841 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
gl::Query now uses the abstract rx::Query.  TRAC #22418  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1840 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added query creation methods to Renderer.  TRAC #22418  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1839 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Created Query9.  TRAC #22418  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1838 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Created an abstract rx::QueryImpl class.  TRAC #22418  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1837 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for derivative instructions in D3D11.  TRAC #22424  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1836 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update ANGLE_texture_compression_dxt  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1822 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added an ANGLE instancing sample to a new folder in samples.  This sample will show a user how to use the ANGLE-specific extensions for geometry instancing.  TRAC #22452  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1819 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update version to r1818  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1818 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Do not hash mapping field names of a reserved struct.  With this fixed Chrome behaves the same on WebGL conformance tests 1.0.2 with/without --enable-shader-name-hashing  BUG= TEST=WebGL conformance tests Review URL: https://codereview.appspot.com/7229043  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1817 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11::sync.  TRAC #22351  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1816 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix mat2 packing to use 2 rows as per spec.  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1815 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix a memory out-of-bound visit bug.  So len could equal = max_len and at this point name[len] is out of the range.  BUG= TEST= Review URL: https://codereview.appspot.com/7223045  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1814 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Rename ANGLE_multiple_render_targets to EXT_draw_buffers  Trac #21120  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1813 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Updates to MRT extension.  Trac #21120      01/30/2013  dgkoch  add issue 6 and clear interactions                         renamed to EXT_draw_buffers based on feedback                         changed resolution of issue 3.  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1812 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix D3D11 instancing support check to test against the current feature level.  TRAC #22414  Signed-off-by: Daniel Koch Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1811 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Do not use dynamic_cast if RTTI is disabled. Review URL: https://codereview.appspot.com/7250043  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1808 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Updated version number to 1801  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1801 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Attempt different fix for unknown #pragma on Linux.  BUG=none TEST=compiled on Linux and Mac OS Review URL: https://codereview.appspot.com/7133076  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1800 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Changed optimization level to D3DCOMPILE_OPTIMIZATION_LEVEL1. With this optimization level it appears that array index clamping can be enabled on Windows without destabilizing WebGL content.  Tested this change with array index clamping enabled with MapsGL a previous failing test from AlteredQualia many Three.js demos the Julia Set tutorial from acko.net the WebGL 1.0.1 conformance suite and other content; all worked.  BUG=none Review URL: https://codereview.appspot.com/7197054  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1799 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Incorporated patch from haixia@ changing the default implementation of array index clamping to use the clamp intrinsic. This works more reliably on pure OpenGL ES devices and on Windows.  Added a mechanism in ShBuiltInResources to choose the strategy for array index clamping.  BUG=none TEST=various out-of-bounds array indexing tests and various WebGL content Review URL: https://codereview.appspot.com/7194051  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1798 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed compiler warning on Linux resulting in build failures.  BUG=none TEST=compiled on Linux Review URL: https://codereview.appspot.com/7201056  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1797 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed the programBinary argument from Renderer::setViewport.  TRAC #22478  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1796 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented D3D11 non-pow2 texture support.  TRAC #22425  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1795 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed rounding error in SwapChain11::swapRect vertex coordinates.  #22472  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1794 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove DXSDK_DIR from search paths.  Chrome now builds ANGLE against the Windows 8 Platform SDK.  Move the include and lib search paths to common.gypi so that downstream projects can specify the location of the Platform SDK or alternatively use the DirectX SDK instead. Review URL: https://codereview.appspot.com/7193052   Conflicts:  	src/common/version.h  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1793 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Roll gyp dependency to 1564.  This is to fix the standalone gyp build. It couldn't handle changes made in r1721. This is the latest version. Review URL: https://codereview.appspot.com/7204049  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1792 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement instancing support in D3D11.  TRAC #22414  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1791 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Include windows.h from one place to ensure that min and max macros are not defined.  These conflict with the STL functions of the same name.  This is to make the standalone ANGLE gyp build work again. Review URL: https://codereview.appspot.com/7211043   Also includes r1729 which adds the missing new file.  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1790 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use TEXT macro to define ANGLE_PRELOADED_D3DCOMPILER_MODULE_NAMES macro.  This is to make the standalone gyp build work again. Review URL: https://codereview.appspot.com/7199046  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1789 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Treat return statements in loops as loop discontinuities.  This is so that texture2D is converted to texture2DLod in loops with return statements. HLSL does not seem to allow gradient operations in loops with return statements. It considers them to be breaks. Review URL: https://codereview.appspot.com/7131057  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1788 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix an issue with instanced drawing in the D3D9 path.  TRAC #22447  Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1787 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement gl_PointSize point sprite emulation using D3D11 geometry shaders.  TRAC #22412  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1786 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactor gl_FragCoord and gl_PointCoord usage in ProgramBinary::linkVaryings.  TRAC #22412  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1785 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move the call to packVaryings outside of linkVaryings.  TRAC #22412  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1784 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add a new internal enum for shader type instead of re-using GL enums.  TRAC #22412  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1783 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix a missing variable initialization in ProgramBinary.  TRAC #22412  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1782 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make other angle targets compile on Win64  Addendum to https://codereview.appspot.com/7011048/  BUG=391 chromium:166496 chromium:167187  Landing for jschuh Original patch: https://codereview.appspot.com/7075044/ Review URL: https://codereview.appspot.com/7190044  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1781 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add comments to ArrayBoundsClamper about why 'clamp'  was not used to do the bounds clamping.  BUG=397  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1780 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Reorganized new sources from recently applied patch into third_party directory.  Review URL: https://codereview.appspot.com/7105049  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1779 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Document GetIntegerv errors in ANGLE_framebuffer_blit.  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1778 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Updates for ANGLE_multiple_render_targets  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1777 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Avoid calling getContext() for resource limits.  TRAC #22243 Signed-off-by: Jamie Madill Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1776 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Increase the varying register count to what the feature level supports.  TRAC #22243 Signed-off-by: Jamie Madill Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1775 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Increase DX11 uniform count to 1024.  TRAC #22243 Signed-off-by: Jamie Madill Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1774 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Retrieve the maximum uniform register count from the renderer.  TRAC #22243 Signed-off-by: Jamie Madill Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1773 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented D3D11 offscreen texture share handle support.  Chrome uses this to for composited rendering. Currently Chrome uses a BGRA texture format for surface sharing so we must create our offscreen textures this way. See EGL_ANGLE_query_surface_pointer EGL_ANGLE_surface_d3d_texture_2d_share_handle EGL_ANGLE_d3d_share_handle_client_buffer.  TRAC #22410  Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1772 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement proper BGRA extension support on D3D11.  See GL_EXT_texture_format_BGRA8888.  TRAC #22410 Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1771 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add .opensdf files to .gitignore.  TRAC #22410  Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1770 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix assert error triggered in D3D11 path when we redefine textures to GL_NONE.  Instead internally convert them between GL_NONE and DXGI_FORMAT_UNKNOWN.  TRAC #22463  Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1769 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Only update a constant buffer when any of its uniforms are dirty.  TRAC #22327 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1768 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Reuse the constant buffers of the shader executable.  TRAC #22327 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1767 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add constant buffers to ShaderExecutable11.  TRAC #22327 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1766 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use a single set of constant buffers for the driver uniforms.  TRAC #22327 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1765 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Store DX11 driver uniforms in a separate constant buffer.  TRAC #22327 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1764 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements generateMipmap for CPU-side textures  TRAC #22350  Author: Shannon Woods Signed-off-by: Jamie Madill Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1763 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements Image::copy for nonrenderable textures.  TRAC #22349  Author: Shannon Woods Signed-off-by: Jamie Madill Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1762 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds a function to get the texture resource of a framebuffer's color render target.  TRAC #22349  Author: Shannon Woods Signed-off-by: Jamie Madill Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1761 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Since we can't create a swap chain for another process' window error out gracefully.  Was triggered from Chrome trying to use a Windows XP path on the DX11 side of things.  TRAC #22438  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1760 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented masked clearing in Renderer11.  TRAC #22343  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1759 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Reordered the logic of Renderer11::clear to determine earlier if a masked clear is required.  TRAC #22343  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1758 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for vertex texure fetch in DX11 mode.  Trac #22354  Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1757 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add ipch folders and debug.txt to .gitignore.  TRAC #22441  Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1756 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed a gl_FrontFacing regression.  TRAC #22426 Signed-off-by: Jamie Madill Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1755 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove the ResourceLimits.h reference which was causing the translator_common to always rebuild.  Also tinker with the deps a bit to allow for more parallelism during the build process.  TRAC #22437  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1754 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminate the D3DCOMPILE_ENABLE_BACKWARDS_COMPATIBILITY flag.  TRAC #22426 Signed-off-by: Jamie Madill Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1753 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use SV_IsFrontFace to implement gl_FrontFacing on DX11.  TRAC #22426 Signed-off-by: Jamie Madill Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1752 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Convert all vertex data to floating-point.  TRAC #22426 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1751 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented TextureStorage11*::generateMipMap.  #22355  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1750 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11::copyImage.  TRAC #22358  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1749 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Created a basic position and texcoord vertex and helper method in renderer11 utils.  TRAC #22358  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1748 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renderer::copyImage now uses the ANGLE rectangle structure instead of the windows one.  TRAC #22358  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1747 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renamed the passthrough pixel shader to  PS_PassthroughRGBA.  TRAC #22358  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1746 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Image11::isRenderableFormat.  TRAC #22358  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1745 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
RenderTarget11 now stores a shader resource.  TRAC #22358  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1744 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Texture storage now has deferred creation of all render targets and shader resources.  TRAC #22358  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1743 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Reorganized the getter methods of SwapChain11 and added a method to get the offscreen texture shader resource.  TRAC #22358  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1742 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed the levels parameter from initializeSRV since it is the same as mMipLevels.  TRAC #22358  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1741 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix and extend essl_to_hlsl to support DX11 HLSL.  TRAC #22330 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1740 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use the DX11 syntax for GLSL samplers and textures.  TRAC #22330 Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1739 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Pass the desired HLSL version down to the HLSL generator.  TRAC #22330 Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1738 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move the get maximum point size logic to Renderer9.  Trac #22413  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1737 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
TextureStorage11 classes now store a render target to each mip level.  Signed-off-by: Jamie Madill Signed-off-by: Shannon Woods Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1736 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove dependency on DirectX SDK. Review URL: https://codereview.appspot.com/7135062  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1723 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update version to 1717  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1717 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix a few unnecessary uses of Renderer9  Trac #22394 Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1716 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove all possible libEGL includes from libGLESv2  Trac #22394 Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1715 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Cleanup extraneous D3D9_REPLACE comments  Trac #22394 Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods  Blit.cpp and Renderer9.h/.cpp will remain d3d9-specific. Remove various unused includes and a typedef.  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1714 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move dirty DX constant tracking from Context to the Renderers.  TRAC #22308 Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1713 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Initialize uninitialized pointers in SwapChain11 to NULL.  This could cause invalid calls in the destructor in debug builds.  TRAC #22393  Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1712 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Change line ending type on compiled shaders and delete now empty shader folder   git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1711 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update version to 1710  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1710 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add D3D version and shader models to renderer string reported by GetString.  It looks like this now: ANGLE (NVIDIA Quadro 600 Direct3D9Ex vs_3_0 ps_3_0)  I also noticed that the strings returned by GetString are not all static so I fixed that as well. Review URL: https://codereview.appspot.com/7068058   Author: apatrick@chromium.org <apatrick@chromium.org@736b8ea6-26fd-11df-bfd4-992fa37f6226>  Manual merge from Master by daniel@transgaming.com  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1709 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented DX11 GL_TRIANGLE_FAN emulation using a scratch index buffer.  TRAC #22345  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Jamie Madill  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1708 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Build fix.  BUG= TEST=build fine in Linux Review URL: https://codereview.appspot.com/7071056  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1707 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
In generated shaders output +INF and -INF as largest single precision floating point number.  C++ streams seem to use the representation 1.$ for INF and that isn't valid syntax in GLSL or HLSL.  Also preserve the sign of INF in constant expressions that divide by zero. I can't figure out what to do about 0/0 because the shader models we are using do not support NaN. Treating it as +INF as before. Review URL: https://codereview.appspot.com/7057046  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1706 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update Copyright years on the LICENSE file  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1705 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Disable GL_OES_standard_derivatives when ps_2_x or later is not available.  BUG=392 Review URL: https://codereview.appspot.com/7027051   Author:    bsalomon@google.com  (manual merge from master by daniel@transgaming.com)  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1704 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Upstream various build fixes from WebKit to ANGLE to make updating ANGLE in WebKit easier.  a) http://trac.webkit.org/changeset/127747 b) http://trac.webkit.org/changeset/128539 c) http://trac.webkit.org/changeset/122870 - Specifically items #3 and #4 in this changeset's commit message.  Review URL: https://codereview.appspot.com/7040045   Author:    maxvujovic@gmail.com ------  Upodate preprocessor.vcxproj to reflect changes in r1640.  Review URL: https://codereview.appspot.com/7061044  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1703 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make angle compile on Win64  BUG=http://crbug.com/166496 BUG=http://crbug.com/167187  Landing this for Justin Schuh: https://codereview.appspot.com/7011048/ Review URL: https://codereview.appspot.com/7040045   Conflicts:  	src/common/version.h  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1702 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Incorporated BSD-licensed changes implementing array bounds clamping.  BUG=none TEST=ran associated WebKit layout tests in Chromium Review URL: https://codereview.appspot.com/6999052  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1701 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Optimize copyVertexData.  TRAC #2237 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1700 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed the dirty parameters flag from Texture.  TRAC #22248  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1699 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved applied texture and sampler caching from Context into the Renderers.  TRAC #22248  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1698 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Release leaked SRVs in TextureStorage11.  TRAC #22231  Signed-off-by: Jamie Madill Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1697 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
D3D11 device context clears and flushes the state to release internal references before destruction.  TRAC #22231  Signed-off-by: Jamie Madill Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1696 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added debug names to swap chain resources.  TRAC #22231  Signed-off-by: Jamie Madill Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1695 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a utility function to set the debug name on D3D11 resources.  TRAC #22231  Signed-off-by: Jamie Madill Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1694 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Caches MipLevel in TextureStorage11 to avoid repeated GetDesc calls.  TRAC #22341  Author: Shannon Woods Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1693 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved the shaders from libGLESv2 to the libGLESv2/renderer.  TRAC #22230  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1692 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Completed D3D11 line loop rendering.  TRAC #22344  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1691 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Disable large point rendering for DX11.  TRAC #22352 Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1690 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented gl_FragCoord support for DX11.  TRAC #22375 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1689 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renderer11::readPixels queries the RenderTarget11 for the correct subresource to read from.  TRAC #22368  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1688 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
RenderTarget11 now stores the subresource that it represents.  TRAC #22368  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1687 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented support for DX11 integer and boolean uniforms.  TRAC #22364 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1686 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Color blend options may not be used for SrcBlendAlpha and DestBlendAlpha in D3D11.  TRAC #22365  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1685 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
D3D11 uses 1 as the default sampling level not 0.  TRAC #22365  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1684 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes bugs in rendering to textures.  TRAC #22365  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1683 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented support for DX11 driver uniforms by assigning fixed register slots.  TRAC #22369 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1682 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed a bug with sampler state comparison size.  TRAC #22378  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1681 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
SwapChain11::swapRects now correctly sets the viewport to the size of the window.  TRAC #22374  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1680 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed applied index buffer offset not being cached.  TRAC #22371  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1679 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11::readPixels.  TRAC #22247  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1678 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Reverses the D3D11 vertex winding order WRT GL's.  TRAC #22353  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1677 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use an agnostic renderer in Buffer rather than D3D9-specific.  TRAC #22362  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1676 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements missing Image::loadData cases.  TRAC #22347  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1675 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes an incorrect dirty marking in generateMipmaps.  TRAC #22356  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1674 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements Renderer11::createRenderTarget  TRAC #22340  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1673 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed code style mistakes.  TRAC #22251  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1672 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Made the D3D objects returned by RenderStateCache into weak pointers.  TRAC #22339  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1671 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
When creating ShaderResourceViews -1 should be used for 'all MipLevels' not 0.  TRAC #22337  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1670 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds Renderer11::createTexture functions.  TRAC #22336  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1669 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Cached texture and event support on Renderer9.  TRAC #22232  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1668 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11::setTexture.  TRAC #22252  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1667 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed a typo in an error message.  TRAC #22251  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1666 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11::setSamplerState.  TRAC #22251  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1665 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented sampler state caching in the RenderStateCache.  TRAC #22251  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang/Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1664 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add sampler state conversion functions.  TRAC #22251  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1663 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move sampler state structure to angle types header.  TRAC #22251  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang/Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1662 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes places where TextureStorage could have leaked memory during initialization.  TRAC #22250  Author: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1661 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Create ShaderResourceViews for TextureStorage objects  TRAC #22250  Author: Shannon Woods  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1660 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use identical types for VS and PS varyings.  TRAC #22241 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1659 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
DX11 wants VS output and PS input to be in the exact same order.  TRAC #22241 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1658 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
DX11 index buffer offset is in bytes.  TRAC #22332 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1657 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed the number of vertices for DrawIndexed to draw.  TRAC #22332 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1656 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
SUCCEEDED assertions fixed.  Author: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1655 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Patch fixes that should have made it into prior patch for renderable migration.  TRAC #22211  Author: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1654 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Migrates textures to render targets with copyToRenderTarget in DX11.  TRAC #22211  Author: Shannon Woods Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1653 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Copies data from the staging texture to the default texture.  TRAC #22210  Author: Shannon Woods Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1652 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds a function to update a level of a TextureStorage from another resource.  TRAC #22210  Author: Shannon Woods Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1651 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds getStagingTexture to Image11  TRAC #22210  Author: Shannon Woods Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1650 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds cube descendant of TextureStorage11  TRAC #22209  Author: Shannon Woods Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1649 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds TextureStorage11 class and 2D descendant  TRAC #22009  Author: Shannon Woods Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1648 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use shader D3D optimization level 0.  Review URL: https://codereview.appspot.com/6943062  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1637 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ensured that the mUsesPointSprites flag is properly preserved when loading shaders from binary cache.  BUG=https://code.google.com/p/angleproject/issues/detail?id=389 Review URL: https://codereview.appspot.com/6884053  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1636 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminated storing decorated uniform names.  TRAC #22326 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1635 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminated D3DConstantTable.  TRAC #22326 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1634 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Always link uniforms directly retrieved from the compiler.  TRAC #22326 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1633 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed declaring arrays within structures.  TRAC #22326 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1632 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Assign register indexes to dx_ constants and intercept them.  TRAC #22326 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1631 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented support for DX11 sampler uniforms.  TRAC #22242 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1630 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented support for DX11 uniform arrays.  TRAC #22239 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1629 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented basic applying of uniform values for DX11.  TRAC #22239 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1628 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Link uniforms.  TRAC #22239 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1627 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Retrieve active uniforms.  TRAC #22239 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1626 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Provide an API for accessing the uniform array.  TRAC #22239 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1625 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Declare active uniforms.  TRAC #22239 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1624 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Collapsed register indexes into one.  TRAC #22293 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1623 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Assign constant registers manually in HLSL.  TRAC #22293 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1622 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add utility methods for determining register count.  TRAC #22293 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1621 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Simplified uniform/varying/attribute output.  TRAC #22293 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1620 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed a bug in Renderer11::clear where the wrong render target is fetched.  TRAC #22246  Author: Geoff Lang Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1619 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11::drawElements.  TRAC #22246  Author: Geoff Lang Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1618 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds new functions to support load*Data for DX11-supported formats  TRAC #22294  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1617 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renames current load*Data functions to clarify destination format.  TRAC #22294  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1616 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removes extraneous D3D9-ims in TextureStorage code.  TRAC #22300  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1615 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moves creation of renderer-specific texture storage objects to the renderer.  TRAC #22300  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1614 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renames classes in the TextureStorage heirarchy for clarity  TRAC #22300  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1613 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moves TextureStorage class to TextureStorage9 mostly.  TRAC #22300  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1612 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Creates the TextureStorageInterface class  TRAC #22300  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1611 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11::applyVertexBuffer and Renderer11::applyIndexBuffer.  TRAC #22238  Author: Geoff Lang Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1610 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Created InputLayoutCache for D3D11 input layouts and vertex buffer application.  TRAC #22235  Author: Geoff Lang Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1609 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented IndexBuffer11.  TRAC #22237  Author: Geoff Lang Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1608 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Integrated new IndexBuffer into IndexDataManager and Renderer9.  TRAC #22237  Author: Geoff Lang Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1607 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added an IndexBuffer creation method to Renderer.  TRAC #22237  Author: Geoff Lang Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1606 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented IndexBuffer9.  TRAC #22237  Author: Geoff Lang Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1605 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added abstract IndexBuffer class.  TRAC #22237  Author: Geoff Lang Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1604 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renamed IndxBuffer to IndexBufferInterface.  TRAC #22237  Author: Geoff Lang Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1603 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved IndexBuffer into its own file.  TRAC #22237  Author: Geoff Lang Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1602 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed some paths in the angle gypi project file.  TRAC #22237  Author: Geoff Lang Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1601 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed missing files in visual studio project filters.  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1600 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added an additional null check in VertexBuffer9::discard.  TRAC #22227  Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1599 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented VertexBuffer11.  TRAC #22227  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1598 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Combine major minor and build revision as the program binary version.  TRAC #22245 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1597 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Provide a stub for Renderer11::applyUniforms.  TRAC #22245 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1596 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move Uniform to separate files.  TRAC #22245 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1595 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move setting the uniforms to the Renderer implementation.  TRAC #22245 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1594 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove special handling of DX constants as uniforms.  TRAC #22245 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1593 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Creates Image11 class  TRAC #22208  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1592 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renames "dx9" utility namespace to "d3d9"  TRAC #22208  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1591 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds a utility function to calculate the size of a pixel given a DXGI format.  TRAC #22208  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1590 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Change VertexBufferInterface and VertexDataManager to use new VertexBuffer.  TRAC #22226  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1589 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added vertex buffer creation methods to renderer.  TRAC #22226  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1588 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented VertexBuffer9.  TRAC #22225  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1587 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add abstract VertexBuffer class.  TRAC #22225  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1586 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renamed VertexBuffer to VertexBufferInterface.  TRAC #22225  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Geoff Lang  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1585 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Apply DX constants directly.  TRAC #22245 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1584 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't expose DX constants as GL uniforms.  TRAC #22245 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1583 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Combine dx_Depth and dx_FrontCCW into dx_DepthFront.  TRAC #22245 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1582 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move isTriangleMode to utilities.h.  TRAC #22245 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1581 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compute gl_FrontFacing using a single float constant.  TRAC #22245 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1580 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Merged the VertexBuffer and ArrayVertexBuffer classes.  TRAC# 22224  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1579 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved VertexBuffer and derivations into VertexBuffer.h/cpp.  TRAC# 22224  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1578 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed line endings in visual studio project files.  TRAC# 22224  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1577 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move program binary serial caching to renderer  Trac #22249 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1576 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ensure state caching variables are handled consistently in markAllStateDirty  Trac #22249 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1575 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moves renderer-agnostic portions of GenerateMip to their own header  TRAC #22254  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1574 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renames TextureSSE2 to ImageSSE2 and moves it to the renderer directory.  TRAC #22254  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1573 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Migrate Image to Image9 and add an abstract base  TRAC #22254  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1572 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moves GenerateMipmap function to the Renderer  TRAC #22254  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1571 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Passes a base-class Renderer pointer to Image where needed instead of Renderer9  TRAC #22254  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1570 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds a function to the Renderer which will return a newly created Image.  TRAC #22254  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1569 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Changes the Image array contained in Texture classes to an array of Image pointers.  TRAC #22254  Author: Shannon Woods Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1568 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move NullColorbuffer handling from Framebuffer to Renderer9  Trac #22229  Uses a 12-entry LRU cache to avoid recreating them unnecessarily.  Signed-off-by: Nicolas Capens Signed-off-by: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1567 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix implicit vector truncation warnings.  TRAC #22218 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1566 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add explicit std:: namespace to code from <cXYZ> includes.  Some platforms seem to implicitly include the <XYZ.h> headers which also add some types and functions (like strlen size_t...) into the global namespace.  On other platforms though this can result in compile errors which is noticeable in WebKit on e.g. QNX. See also: https://bugs.webkit.org/show_bug.cgi?id=95468  https://codereview.appspot.com/6843083/  Contributed by Milian Wolff Klaralvdavens Datakonsult AB.  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1565 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Limit struct size to size of full shader constant.  The HLSL compiler can optimize out the last elements of a struct which caused ANGLE to overwrite constants right after the end of the struct. Each element in a struct should be limited by the size of the entire struct.  BUG=  Review URL: https://codereview.appspot.com/6856100  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1564 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix mixed line endings in generateshader.bat  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1552 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove empty preprocessor/new directory    git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1551 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update version on dx11proto branch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1550 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Scissor test state is set as part of the Renderer::setScissor method.  TRAC #22206  Moved scissorTest out of RasterizerState. Fixes buffer-offscreen-test and buffer-preserve-test CTS regressions.  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1549 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Changed D3DConstant table IndexDataManagerVertexDataManager and vertexconversion namespaces.  TRAC #22198  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1548 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved D3DConstantTable IndexDataManager VertexDataManager and vertexconversion files.  TRAC #22198  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1547 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move HLSL compilation to Renderer.  TRAC #22205 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1546 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move constant table retrieval out of compileToBinary.  TRAC #22205 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1545 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11::drawArrays.  TRAC #22153 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1544 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed setting write masks when not alpha blending.  TRAC #22153 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1543 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed the semantic for SM4+ vertex output position.  TRAC #22153 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1542 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement Renderer11::applyShaders.  TRAC #22153 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1541 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented SwapChain11::swapRects.  TRAC #21930  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1540 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a SM4 pass through shader.  TRAC #21930  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1539 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
SwapChain11 is now created with the correct dimensions.  TRAC #21930  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1538 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renamed SwapChain11's textures and views.  TRAC #21930  Renamed SwapChain11's textures and views to better represent if they are for the back buffer or offscreen texture.  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1537 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Apply the input topology.  TRAC #22151 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1536 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Store the shader bytecode in ShaderExecutable to pass it to CreateInputLayout.  TRAC #22191 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1535 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Create and set a basic vertex buffer.  TRAC #22153 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1534 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Create and set a basic input layout.  TRAC #22153 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1533 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement applyPrimitiveType for Renderer11.  TRAC #22153 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1532 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11::loadExecutable.  TRAC #22191 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1531 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add ShaderExecutable11 files.  TRAC #22191 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1530 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11::compileToExecutable.  TRAC #22191 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1529 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Load the compiler module for D3D11.  TRAC #22191 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1528 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use SV_Target semantic for gl_Color when compiling for Shader Model 4+.  TRAC #22191 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1527 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Skip applying uniforms for the D3D11 renderer (unimplemented for now) to make ProgramBinary back-end independent.  TRAC #22191 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1526 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove getRenderer9 from Display  Trac #22200 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1525 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove unnecessary d3d9.h includes  Trac #22200 Signed-off-by: Geoff Lang Signed-off-by: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1524 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11::clear for basic clear operations.  TRAC #22150  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1523 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed an incorrect return value.  TRAC #22149  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1522 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11::applyRenderTargets.  TRAC #22149  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1521 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added getter methods to RenderTarget11 for the render target and depth stencil views.  TRAC #22149  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1520 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed the mRenderTargetDesc member from Context.  TRAC #22145  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1519 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added an ignoreViewport parameter to Renderer::setViewport.  TRAC #22145  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1518 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactored Renderer::setDepthStencilState to no longer require the stencil size parameter.  TRAC #22145  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1517 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactored Renderer::setRasterizerState to no longer need a depthSize parameter.  TRAC #22145  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1516 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactored Renderer::setViewport to no longer take render target size arguments.  TRAC #22145  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1515 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactored Renderer::setScissor to no longer require render target size.  TRAC #22145  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1514 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added currently set render target information to Renderer11.  TRAC #22145  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1513 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Release Blob after creating executables.  Trac #22155 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1512 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix line endings on a number of files  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1511 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Get rid of ShaderExecutable9 usage in ProgramBinary  Trac #22155 Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1510 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make shaderExecutable::getConstantTable virtual  Trac #22155 Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens  Should be temporary until we figure out what we're doing in ProgramBinary for d3d11 shaders  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1509 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add a get*Function method to the ShaderExecutable interface  Trac #22155 Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens  This allows ProgramBinary::save to avoid knowing about D3D9 shaders  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1508 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix pointer type for GUID in ProgramBinary::load  Trac #22155 Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1507 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Inline the Renderer9::compilerShaderSource function  Trac #22155 Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1506 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Store ShaderExecutables on the ProgramBinary instead of d3d9 shaders  Trac #22155 Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens  Also hooks up binary loading to the loadExecutable function. The other notable change is that getVertex/Pixel shader no longer add reference counts to the returned objects.  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1505 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add loadExecutable function to Renderer  Trac #22155 Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens  factored out of compileToExecutable as we also need this when loading binaries from disk.  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1504 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move compileToBinary to Renderer  Trac #22155 Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens  The body of compileToBinary was moved to Renderer9 and the ProgramBinary simply calls compileToExecutable which does both the compilation to binary and creation of the shaders which are then wrapped into a ShaderExecutable and then returned.  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1503 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove the ConstantTable member variables  Trac #22155 Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens  Since we no longer keep them as member variables we need to make sure we delete them before leaving the function.  This made it necessary to reflow some of the logic.  We can now attempt more parts of linking even if it will ultimately fail but sometimes the partial link information is useful (ie for attributes).  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1502 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Explicitly pass constant tables to linkUniforms  Trac #22155 Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1501 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Explicitly pass the constant tables to the defineUniform function  Trac #22155 Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1500 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove default parameter from ProgramBinary::defineUniform and make it explicit  Trac #22155 Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1499 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add ShaderExecutable and ShaderExecutable9 classes to encapsulate back-end specific shader-isms.  Trac #22155 Signed-off-by: Geoff Lang Signed-off-by: Nicolas Capens Author: Shannon Woods & Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1498 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use convenience function for downcasting the renderer.  TRAC #22016 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1497 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Silence unimplemented asserts and implement retrieving adapter information.  TRAC #22072 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1496 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Retrieve the shader model number instead of a shader model 3 support boolean.  TRAC #22072 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1495 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminate D3D9 from Context.  TRAC #22016 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1494 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Clean up passing around translated index data.  TRAC #22016 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1493 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move the index data manager and draw calls into the renderer implementation.  TRAC #22016 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1492 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove Intel specific workaround.  TRAC #22179 Reverts https://codereview.appspot.com/6460100 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1491 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved VertexDeclarationCache to its own header and source file.  TRAC #22016 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1490 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move blitter creation / destruction to device specific initialization / release.  TRAC #22016 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1489 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer11::setViewport.  TRAC #22148  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1488 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed clear implementation from Context.  TRAC #22125  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1487 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer9::clear.  TRAC #22125  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1486 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Changed the Renderer::clear method parameters to use the new ClearParameters structure.  TRAC #22125  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1485 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added clear type enum and clear parameters structure.  TRAC #22125  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1484 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moves checkDeviceLost to renderer9_utils.h  TRAC #22141  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1483 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moves applyShaders to Renderer  TRAC #22154  Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1482 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds RenderTarget11 type  TRAC #22134  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1481 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removes getSurface function from base RenderTarget  TRAC #22134  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1480 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds makeRenderer9/11 functions  TRAC #22134  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1479 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moves creation of RenderTargets to the renderer.  TRAC #22134  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1478 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds makeSwapChain9/11 functions.  TRAC #22134  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1477 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes line endings on SwapChain9 and SwapChain11  TRAC #22134  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1476 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add applyVertexBuffer stub for D3D11 renderer.  TRAC #22016 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1475 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move the vertex data manager and vertex declaration cache from Context to Renderer9.  TRAC #22016 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1474 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Pull Context dependencies out of applyVertexBuffer().  TRAC #22016 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1473 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed bug with scissor rectangles Y values being clamped incorrectly.  TRAC #22167  Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1472 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't call gl::output unless perf is enabled.  gl::output allocates a pretty large stack buffer so it has to call _chkstk. This is rather slow so avoid calling gl::output if perf and tracing are disabled.  BUG=  Review URL: https://codereview.appspot.com/6843043  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1471 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update version.  tbr=kbr Review URL: https://codereview.appspot.com/6826081   Conflicts:  	src/common/version.h  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1470 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement user-defined name hashing.  ANGLEBUG=315 Review URL: https://codereview.appspot.com/6818109  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1469 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update version.  Review URL: https://codereview.appspot.com/6818111  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1468 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove dependency on d3dcompiler import library.  It is now loaded with LoadLibrary.  Added compile time option of having ANGLE enumerate various versions of d3dcompiler_nn.dll that the application can preload before eglInitialize(). Review URL: https://codereview.appspot.com/6816074  Author: Al Patrick (applied to branch)  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1467 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Interface design for user-defined name hashing.  1) We use BuiltInResources to pass the hash function to    ANGLE deciding whether we applies hash function or not. 2) We use 64 bits hashing function because 64 bits is 16    bytes using hex representation plus the "webgl_" prefix    we can keep the names under 128 (WebGL allows 5 levels of    nesting in structures).  If chooseing 128 bits we will    go beyond 128 characters and some drivers can't handle    that safely.  ANGLEBUG=315 Review URL: https://codereview.appspot.com/6822077  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1466 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use D3D compiler optimization level 3.  The is to try and fix some three.js lighting issues. It appears optimization level 0 has a loop unrolling bug. The compiler returns success but the shader does not work. All other optimization levels work. http://crbug.com/153105.  Repro here:  http://alteredqualia.com/tmp/tests/angle-issues/webgl_materials_normalmap_test.html  Both heads should look the same. Review URL: https://codereview.appspot.com/6821060  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1465 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed some warnings on GCC  Mozilla has recently made using NULL as integer an error (via -Werror=conversion-null GCC flag) which caused ANGLE to no longer compile on mingw in Mozilla tree. The ones that may not be obvious are removal of some <0 checks. They are not needed because they were done on unsigned types.  Author: Jacek Caban http://codereview.appspot.com/6679049  (With changes to apply to dx11proto branch)  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1464 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed the setRenderTarget and setDepthStencil methods from the Renderers.  TRAC #22124  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1463 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Context::applyRenderTargets now uses Renderer::applyRenderTargets.  TRAC #22124  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1462 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented Renderer9::applyRenderTarget using Context::applyRenderTarget's code.  TRAC #22124  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1461 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renderer::applyRenderTarget now returns a success/failure bool.  TRAC #22124  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1460 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Created a Renderer9::markAllStateDirty method and moved state initialization into it.  TRAC #22124  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1459 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Invalidate client window area when resetting swap chain  Resizing a window larger results in the newly exposed region being invalidated but the old region is treated as valid. This can result in the old region no longer updating. This has been observed on Windows 7 64-bit with Aero theme using NVIDIA GeForce GTS 250 and driver version 301.42. Invalidate the entire client window area when resetting the swap chain so that it updates properly.  Original bug report: https://bugreports.qt-project.org/browse/QTBUG-27822 Review: http://codereview.appspot.com/6812076/ Author: Jonathan Liu  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1458 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Revision 5 of ANGLE_MRT  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1457 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented SwapChain11 initialization.  TRAC #21928 Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1456 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Context now uses Renderer::setViewport.  TRAC #22116  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1455 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Context now uses a Rectangle struct for storing viewport.  TRAC #22116  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1454 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add an abstract Renderer::setViewport method and implemented it for Renderer9.  TRAC #22116  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1453 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed unused Display member of Context.  TRAC #22116  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1452 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes the include guards on RenderTarget9  TRAC #22140  Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1451 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removes calls from Context to retrieve d3d9 surfaces  TRAC #22094  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1450 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Pass the RenderTarget not the D3D surface up the Renderbuffer heirarchy.  TRAC #22094  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1449 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds a function to Framebuffer to retrieve depth OR stencilbuffer.  TRAC #22094  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1448 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds RenderTarget pointer to TextureStorage.  TRAC #22094  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1447 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove SwapChain.cpp from the GYP project.  TRAC #21926 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1446 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Split the swap chain into an abstract interface and a D3D9 implementation.  TRAC #21926 Signed-off-by: Daniel Koch Signed-off-by: Geoff Lang Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1445 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds renderer functions for rendertarget operations.  TRAC #22093  Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1444 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use ANGLE's rect instead of D3D's in blitFramebuffer.  TRAC #22093  Signed-off-by: Geoff Lang Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1443 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
IDXGISwapChain1::Present1 supports a sync interval of 0 to 4 for all devices.  TRAC #22056 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1412 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Test for valid back buffer and depth stencil formats.  TRAC #22056 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1411 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add stubs for missing virtual method implementations.  TRAC #22056 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1410 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moves copyToRenderTarget to Renderer  TRAC #22000  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1409 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removes getDisplay and getContext calls  TRAC #22000  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1408 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moves ConvertTextureInternalFormat to the Renderer  TRAC #22000  Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1407 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Passes the Renderer to various objects at construction time.  TRAC #22000  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1406 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Passes pointer to Renderer to Framebuffer at construction.  TRAC #22000  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1405 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Pass the Renderer to the ResourceManager at construction time.  TRAC #22000  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1404 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminates usage of Display from Context::makeCurrent.  TRAC #22000  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1403 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Pass the Renderer to the Context at construction time  TRAC #22000  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1402 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Contain DX9 back buffer and depth stencil surface formats.  TRAC #22056 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1401 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement texture dimension limits and 32-bit index queries.  TRAC #22056 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1400 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Create a Direct3D 11 device if enabled and available.  TRAC #21925 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1399 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved Renderer creation/destruction out of Context.cpp into Renderer.cpp.  TRAC #21925 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1398 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved declarations of EGL dependencies to main.h.  TRAC #21925 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1397 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add a Renderer11 class for the d3d11 backend.  Trac #21925  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1396 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update minor version number for branch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1382 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
fix early return value from resetSwapChain  Trac #22003  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1381 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Misc fixes to renderer  Trac #22003 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1380 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Rename renderer namespace to rx  Trac #21999 Author: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1379 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Handle software device creation at the Renderer9 level.  TRAC #21963 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1378 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Explicitly retrieve a Renderer9 or Renderer interface from Display.  TRAC #21963 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1377 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moves portions of utilities specific to D3D9 to the Renderer's domain  TRAC #21931  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1376 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Alters the blitter's copy function so that you can pass a framebuffer to it directly.  TRAC #21910  Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1375 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moves mipmap generation to texture storage and image objects.  TRAC #21910  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1374 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moves copyToRenderTarget operation into texture storage object.  TRAC #21910  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1373 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminates getD3DTexture instead returning the texture storage object.  TRAC #21910  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1372 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Passes texture storage object to image directly to update its surfaces  TRAC #21910  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1371 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Passes the swapchain to texture storage constructor instead of d3d texture.  TRAC #21910  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1370 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Initializes storage from GL params instead of D3D params  TRAC #21910  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1369 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moves static d3d texture format conversion utilities to TextureStorage.  TRAC #21910  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1368 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Mostly eliminates usage of getD3DFormat in Texture.  TRAC #21906  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1367 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds functions to derive R/G/B/A/Stencil/Depth sizes from GL formats instead of D3D.  TRAC #21906  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1366 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix the project filter.  Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1365 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added missing files to the GYP file.  TRAC #21963 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1364 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moves TextureStorage class to its own file in the Renderer directory  TRAC #21909  Author: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1363 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moves Image class to its own file in the Renderer's directory.  TRAC #21909  Author: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1362 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix minor spacing issue blocking merge  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1361 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminated the dependency of VertexDataManager and IndexDataManager on Context.  TRAC #21963 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1360 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Encapsulated memory pool details for vertex and index buffer creation.  TRAC #21963 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1359 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Split Renderer into version independent interface and Renderer9 implementation.  TRAC #21963 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1358 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminated isD3d9ExDevice().  TRAC #21963 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1357 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminated D3DADAPTER_IDENTIFIER9 uses.  TRAC #21963 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1356 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Pass swapchain to DepthStencil constructor instead of d3d9 surface  Trac #21810 Signed-off-by: Nicolas Capens  Also get rid of unused StencilBuffer and Depthbuffer constructors  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1355 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Pass swapchain to Colorbuffer constructor instead of a d3d9 surface  Trac #21810 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1354 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove min/max swapinterval from Display. Get from Renderer if needed.  Trac #21810 Signed-off-by: Nicolas Capens  Also have the Surface explicitly hang onto the Renderer  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1353 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix share handle usage  Trac #21810 Signed-off-by: Nicolas Capens  I don't think it was possible to use the sharehandle passed in and if one was we shouldn't clear it on release()  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1352 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add renderer::SwapChain class and move functionality from egl::Surface  Trac #21810 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1351 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moves Config generation to Renderer.  TRAC #21819  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1350 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds D3DFMT_UNKNOWN to depth stencil format conversion function.  TRAC #21819  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1349 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds constant format arrays to Renderer class  TRAC #21819  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1348 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removes D3D types from the Config class  TRAC #21819  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1347 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Temporarily adds format conversion functions to EGL.  TRAC #21819  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1346 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removes mConfig from Context as it was only used for setting unused default values.  TRAC #21819 Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1345 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removes the unused setDefaults function  TRAC #21819  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1344 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removes getContext calls from Colorbuffer and DepthStencilbuffer constructors.  TRAC 21817  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1343 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moves multisample support data to Renderer from Context.  TRAC #21817  Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1342 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removes d3d9 device usage from IndexDataManager and subjugate classes.  TRAC #21816  Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1341 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove d3d9 devices from use in VertexDataManager and subjugate classes  TRAC #21816  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1340 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removes D3DCaps from Context and Display instead querying Renderer for support status.  TRAC #21611  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1339 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix merge compilation errors    git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1338 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move SetTexture calls to the renderer class  Trac #21727  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1337 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move sampler state setting to the Renderer  Trac #21727  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1336 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move texture sampler state into a separate sampler state structure.  Trac #21727  Conflicts:  	src/libGLESv2/Texture.cpp  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1335 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminate use of global getDevice() function.  Trac #21727  Everything must go through the renderer.  Conflicts:  	src/libGLESv2/Texture.cpp  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1334 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move shader cache into Renderer  Trac #21727  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1333 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make testDeviceLoss able to perform the notifications  Trac #21727  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1332 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move query and sync support to Renderer  Trac #21727  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1331 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move Sharehandle support query to renderer  Trac #21727  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1330 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add Renderer class and move functionality from Display  Trac #21727  Conflicts:  	src/libGLESv2/Texture.cpp 	src/libGLESv2/libGLESv2.vcxproj  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1329 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
creating branch for dx11 prototype  git-svn-id: https://angleproject.googlecode.com/svn/branches/dx11proto@1328 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Issue 354: remove ANGLE_USE_NSPR (revert r454)  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1327 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move the new preprocessor out of the 'new' directory.  TRAC #21966 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1326 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed the old preprocessor source interface and license.  TRAC #21966 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1325 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed the compile flag to select between preprocessors always using the new one.  TRAC #21966 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1324 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Avoids uploading levels other than 0 for incomplete textures.  TRAC #21815  Fixes compressed texture test assertion in WebGL top-of-tree conformance suite when running with debug build  Signed-off-by: Daniel Koch Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1323 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix Float16ToFloat32.py. Issue #376. Review URL: https://codereview.appspot.com/6651047  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1320 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add missing <string> include in D3DConstantTable.h  Issue=379  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1318 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add Variable Packing checks to ANGLE  BUG=373 TEST=unit tests    git-svn-id: https://angleproject.googlecode.com/svn/trunk@1317 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
.gitignore: Add *.target.mk generated when building as part of ChromiumOS  BUG=None TEST=Build Chromium and ChromiumOS from source and run "repo status"     with and without this change.  Contributed by Josh Triplett <josh.triplett@intel.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1316 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update project includes to remove explicit DXSDK usage.  Trac #21647  This allows ANGLE to be built with either the Win8 SDK or the DX SDK with appropriate configuration on a VS2010 install.  See wiki for details.  Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1315 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Only replace image surfaces with equal-sized managed surfaces.  TRAC #21621 Issue=311 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1314 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed support for updating from managed surfaces.  TRAC #21621 Issue=311 Signed-off-by: Daniel Koch Author: Nicolas Capens (Fixes XP path that was broken in r1308)  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1313 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminated D3DXLoadSurfaceFromSurface from glGenerateMipmaps.  TRAC #21621 Issue=311 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1312 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminated D3DXLoadSurfaceFromSurface from Image::copy.  TRAC #21621 Issue=311 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1311 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminated D3DXLoadSurfaceFromSurface from copyToRenderTarget.  TRAC #21621 Issue=311 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1310 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminate D3DXLoadSurfaceFromSurface from setManagedSurface.  TRAC #21621 Issue=311 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1309 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed an unreachable path in texture loading code  TRAC #21621 Issue=311 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1308 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Also prototype the Lod0 function variant if needed.  TRAC #21842 Issue=374 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1307 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make DllMain have C linkage.  TRAC #21839 Issue=377 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1306 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't promote packed RGB textures to RGBA d3d surfaces.  TRAC #21591 Issue=362  Signed-off-by: Daniel Koch  Author: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1305 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Some cleanup after the previous sized internal format patches  TRAC #21609  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1304 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removes D3D format usage from framebuffer completeness check.  TRAC #21609  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1303 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds BGRA packed sized internal formats  TRAC #21609  Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1302 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Tracks sized internal formats for textures.  TRAC #21609  Signed-off-by: Daniel Koch  Author:    Shannon Woods <shannon.woods@transgaming.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1301 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add filter files for VS2010 Solution browser  Trac #21647  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1300 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes cases where desired destination format was ignored by CopyTexImage.  TRAC #21595 Issue=339  Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1299 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Delete old .vcproj files that were replaced by .vcxproj files  Trac #21647 Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1298 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add DXSDK_DIR include and lib paths  Trac #21647 Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1297 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adjust dependencies for samples  Trac #21647 Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1296 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add auto converted .vxcproj files for VC++ 2010 Express  Trac #21647 Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1295 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update standalone solution files to VC++ 2010 Express  Trac #21647 Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1294 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Changed the name of the extension exposed to shaders to GL_ANGLE_multiple_render_targets in order to match the GL extension name. Using XYZ_draw_buffers as in GL_ARB_draw_buffers and GL_NV_draw_buffers was causing inconsistencies. Review URL: https://codereview.appspot.com/6715045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1293 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Based on feedback from Al Patrick Nicolas Capens and Daniel Koch removed the restriction about draw buffer 0 having to be non-NULL if any higher draw buffers are non-NULL. Appears this can be supported with a NULL FOURCC render target. Removed issue and adjusted introductory text. Review URL: https://codereview.appspot.com/6725048  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1292 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed issues pointed out by gman; removed references to GetDoublev and ReadBuffer which don't exist in either OpenGL ES 2.0 or 3.0. Review URL: https://codereview.appspot.com/6681043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1291 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add draft ANGLE_multiple_render_targets extension. Review URL: https://codereview.appspot.com/6642069  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1290 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Retry D3DCompile with different compile settings if it fails.  Now also tries with D3DCOMPILE_AVOID_FLOW_CONTROL and D3DCOMPILE_PREFER_FLOW_CONTROL. Review URL: https://codereview.appspot.com/6593069  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1289 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Optimized adding dirty rectangles.  TRAC #21588 Issue=353 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1288 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make sure the driver knows the texture is dirty when only lower level mipmaps are updated.  TRAC #21588 Issue=353 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1287 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Generate a more descriptive error when trying to initialize a const array.  TRAC #21589 Issue=359 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1286 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Only look at whether the member variable has an array prefix.  TRAC #21593 Issue=367 Signed-off-by: Daniel Koch Signed-off-by: Shannon Woods Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1285 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds missing formats to ComputePixelSize  TRAC #21607  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1284 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds support for per-framebuffer IMPLEMENTATION_COLOR_READ_FORMAT and TYPE  TRAC #21607  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1283 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix bug 368: Specify the Levels parameter of CreateCubeTexture and CreateTexture correctly.  This fixes ATS test cases 3884038841 (while making sure that 44095 44096 44097 44100 44101 44102 still work)  The Direct3D spec for the 'Levels' parameter of IDirect3DDevice9::CreateCubeTexture (and IDirect3DDevice9::CreateTexture) says: "If this is zero Direct3D will generate all cube texture sublevels down to 1x1 pixels for each face for hardware that supports mipmapped cube textures."  The 'levels' parameter can be 0 (which means "generate all texture sublevels") or a non-zero value for the actual number of levels to create (often 1 if mapmapping is disabled). But 1x1 and 2x2 mipmapped textures are not supported so textures with these dimensions will actually create a 4x4 texture and set mLodOffset to 2 or 1 respectively so that the level index can be offset as appropriate. There is only one special case (for textures with dimensions smaller than 4): when levels=1 and the texture is 2x2 it is unnecessary to create all miplevels since the 1x1 texture will never be used.  For all other cases all miplevels must be generated even though the upper ones will be unused in order to generate the lower ones.  If 'levels' is zero all miplevels must always be generated. It's important to preserve the special case to ensure that attempting to access the non-existant level produces the correct error. So if 'levels' is zero the 'Levels' parameter should always be zero otherwise it's the sum of 'levels + mLodOffset'  Also the calls to 'creationLevels' from the TextureCubeMap methods were not quite right.  Passing a zero for the second parameter causes this API to always fail since '0' is not a power of two.  There is already a version of 'creationLevels' that takes just one parameter and works correctly so just deleting the extra parameter fixes this problem.  BUG=https://code.google.com/p/angleproject/issues/detail?id=368  TEST=Run test cases 38840 38841 44095 44096 44097 44100 44101 44102 in http://ats.macromedia.com/Players/ATS/ATS10AS3/Staging/ATS.html?dynamicXML=false&wmode=direct&section=Manual&xmlSetURL=http://fpqa.macromedia.com/crospepperbuild/XMLSets/ATS10AS3ManualPepper.xml  Review URL: https://codereview.appspot.com/6492098  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1279 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Returns early from createTexture if its width or height are zero.  TRAC #21594 Bug=350  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1278 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Skip drawing points when gl_PointSize isn't written.  Trac #21574 Bug=365 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1277 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ensure texture level count accounts for lod offset.  The lower texture levels (below the lod offset) aren't used and can't be seen so don't count them in levelCount.  BUG=  Review URL: https://codereview.appspot.com/6492084  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1275 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add D3DConstantTable.* to build_angle.gypi. Review URL: https://codereview.appspot.com/6497092  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1274 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Emit "#version 120" if the shader has array as out parameter. Review URL: https://codereview.appspot.com/6494082  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1273 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix bad commit. Review URL: https://codereview.appspot.com/6499078  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1272 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement D3DConstantTable.  Remove ProgramBinary dependencies on D3DX. Review URL: https://codereview.appspot.com/6485061  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1271 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Replace D3DXFloat16To32Array.  Method described here: ftp://ftp.fox-toolkit.org/pub/fasthalffloatconversion.pdf Review URL: https://codereview.appspot.com/6506058  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1270 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Reconcile AUTHORS and CONTRIBUTORS files  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1269 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move targets from src\build_angle.gyp to src\build_angle.gypi  This enables Skia to compile ANGLE Review URL: https://codereview.appspot.com/6492063  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1268 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Allow glUniform to set nth element of array of structs uniform where n != 0. Review URL: https://codereview.appspot.com/6477046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1267 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Avoid storing references to temporary strings in RenameFunction  Issue=360 Review URL: https://codereview.appspot.com/6483045/   git-svn-id: https://angleproject.googlecode.com/svn/trunk@1266 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Disable npot texture support on AMD cards on XP.  We had been seeing some BSODs due to this.  BUG=  Review URL: https://codereview.appspot.com/6485058  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1264 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add Jacek Caban to Authors list  Issue=358  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1263 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved SSE2 code to separated file to allow using different compiler flags on GCC  To use SSE2 in GCC a compiler -msse2 flag is needed. It adds both possibility to write SSE2 code in the file but also allows compiles to optimize the whole file with SSE2. To make sure that the code works on non-SSE2 machines moving SSE2 functions to separated file and compiling only that file with -msse2 is the common practice.  Issue=358 Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1262 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Minor GCC fixes  - Added missing typename keyword - Use proper filenames includes (this matters when cross compiling on case sensitive OSes) - Added <string> include where GCC requires it - Avoid collision between enum variables and template params  Issue=358 Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1261 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use unordered_map instead of hash_map on GCC  stdext namespace is a non-standard extension. Use standard std::unordered_map on GCC.  Issue=358 Signed-of-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1260 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed preprocessors errors on GCC  - Preprocessor variables need to be separated from string constants to be separated token - Use ##__VA_ARGS__ GCC extension to support empry __VA_ARGS__ (should be no-op on MSVC). See: http://www.delorie.com/gnu/docs/gcc/gcc_44.html for details.  The following series fixes compilation on GCC (from mingw-w64) and allows cross compiling the source on Linux. It was tested in Mozilla tree since ANGLE has no support for GCC in its build system.  Issue=358 Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1259 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Only round back buffer to 64 pixels when vendor ID in Intel.  This is actually to fix AMD / Intel switchable systems when using integrated Intel where the source rectangle to Present is not respected. Review URL: https://codereview.appspot.com/6459101  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1254 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Reset shaders to null in makeCurrent. Review URL: https://codereview.appspot.com/6460100  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1253 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed version number  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1247 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Shader translator converted single-element vector swizzle to direct index access. It is not wrong but unnecessary and moreover it triggers a MESA optimizer bug. Review URL: https://codereview.appspot.com/6460074  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1246 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Round swap chain surfaces to 64 pixels in width. Review URL: https://codereview.appspot.com/6449123  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1245 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add angle_code var to common.gypi and build_angle.gyp. Add GCC and clang warning flags from WebKit to ANGLE Mac and Linux builds.  The angle_code var differentiates between core ANGLE code vs. test code sample code and third party code.  Review URL: https://codereview.appspot.com/6427049/   git-svn-id: https://angleproject.googlecode.com/svn/trunk@1244 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Revert r1230.  See https://codereview.appspot.com/6427049/. Review URL: https://codereview.appspot.com/6422063  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1243 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make ProgramBinary a refcount object and use Binding pointers to maintain it's lifetime on context and program.  Trac #21270 Bug=351 Signed-off-by: Nicolas Capens  This fixes the underlying bug since it allows the context to keep the program binary alive after a relink has occurred.    git-svn-id: https://angleproject.googlecode.com/svn/trunk@1242 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Restore the explicit isLinked() method for Programs and fix link().  Trac #21270 Bug=351 Signed-off-by: Nicolas Capens  If link fails we still need to keep the failed binary around for information such as number of active attributes varyings etc. Thus we can no longer use the presence of a binary to tell us if we've successfully linked a program object.    git-svn-id: https://angleproject.googlecode.com/svn/trunk@1241 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Install new program binary when current program is successfully relinked or reloaded  Trac #21270 Bug=351 Signed-off-by: Nicolas Capens    git-svn-id: https://angleproject.googlecode.com/svn/trunk@1240 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make Program link() and setProgramBinary() return the status of the operation  Trac #21270 Bug=351 Signed-off-by: Nicolas Capens    git-svn-id: https://angleproject.googlecode.com/svn/trunk@1239 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
redirect the LinkProgram and ProgramBinary calls through the context.  Trac #21270 Bug=351 Signed-off-by: Nicolas Capens    git-svn-id: https://angleproject.googlecode.com/svn/trunk@1238 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Explicitly track the current program binary instead of just caching it.  Trac #21270 Bug=351 Signed-off-by: Nicolas Capens    git-svn-id: https://angleproject.googlecode.com/svn/trunk@1237 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't erase the cached program binary on deletion.  Trac #21270 Bug=351 Signed-off-by: Nicolas Capens  This is unnecessary since the current program can never be deleted only flagged for deletion.    git-svn-id: https://angleproject.googlecode.com/svn/trunk@1236 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Cache the current program binary instead of the current program.  Trac #21270 Bug=351 Signed-off-by: Nicolas Capens  Everywhere we used the currentProgram it was immediately used to get the program's binary.   git-svn-id: https://angleproject.googlecode.com/svn/trunk@1235 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove Program serial tracking. It is no longer useful (or used).   Trac #21270 Bug=351 Signed-off-by: Nicolas Capens     git-svn-id: https://angleproject.googlecode.com/svn/trunk@1234 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use the ProgramBinary's serial to track changed D3D9 shaders instead of the Program's  Trac #21270 Bug=351 Signed-off-by: Nicolas Capens  This is necessary since the shaders can change every time a new ProgramBinary is created (eg when re-linking or loading a new binary).    git-svn-id: https://angleproject.googlecode.com/svn/trunk@1233 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add serial tracking to ProgramBinary  Trac #21270 Bug=351 Signed-off-by: Nicolas Capens    git-svn-id: https://angleproject.googlecode.com/svn/trunk@1232 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Pass the programBinary directly to applyDeclaration  Trac #21270 Bug=351 Signed-off-by: Nicolas Capens    git-svn-id: https://angleproject.googlecode.com/svn/trunk@1231 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add GCC and clang warning flags from WebKit to ANGLE Mac and Linux builds  Review URL: https://codereview.appspot.com/6427049/   git-svn-id: https://angleproject.googlecode.com/svn/trunk@1230 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Embed Blit shader byte code in binary.  Ran a WebGL conformance test that exercises the blitter - copy-tex-image-2d-formats. Review URL: https://codereview.appspot.com/6403043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1229 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix always true condition in assert in MacroExpander.cpp.  Issue: 349 Review URL: https://codereview.appspot.com/6420046/   git-svn-id: https://angleproject.googlecode.com/svn/trunk@1228 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Do not call MacroExpander::popMacro() from MacroExpander::~MacroExpander(). MacroExpander::popMacro() assumes that the macro being popped has been fully parsed. This may not be true for MacroExpander destructor which may get called anytime the compiler decides to abort the compilation process. This patch just deletes the macro-contexts pushed in the stack without validating the parse state of current macro.  BUG=348 Review URL: https://codereview.appspot.com/6415043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1227 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Bump version.h  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1226 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Cache D3D vertex and pixel shader objects so they can be reused and shared by multiple contexts.  WebGL conformance tests did not regress. I verified they exercise the Blit code. Review URL: https://codereview.appspot.com/6345105  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1225 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make the new preprocessor backwards compatible with Bison 2.3  Review URL: http://codereview.appspot.com/6356098/   git-svn-id: https://angleproject.googlecode.com/svn/trunk@1224 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Recognize QNX as POSIX.  Review URL: https://codereview.appspot.com/6353097/   git-svn-id: https://angleproject.googlecode.com/svn/trunk@1223 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Scale up non-multiple-of-4 dxt textures  D3D doesn't support DXT textures that aren't a multiple of 4 in size so multiply the sizes by 2 or 4 so they work. Then ensure sampler parameters are set up correctly so they don't sample the unuploaded miplevels.  BUG=https://code.google.com/p/angleproject/issues/detail?id=237 TEST=  Review URL: https://codereview.appspot.com/6287045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1222 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement Anisotropic Texture filtering support  Bug=297 Authored-by: Conor Dickinson Cloud Party Inc. Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1219 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove dos-style line-endings (EOL changes only)  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1218 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update version Review URL: https://codereview.appspot.com/6352103  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1217 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Enable OES_get_program_binary. Review URL: https://codereview.appspot.com/6349053  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1216 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make ProgramBinaries binary rather than text + binary. Review URL: https://codereview.appspot.com/6351082  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1215 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix vertex texture fetch.  The texture v coordinate was still being flipped.  Fixes http://code.google.com/p/chromium/issues/detail?id=136650. Review URL: https://codereview.appspot.com/6345095  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1214 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't set the Break flag on the last loop fragment.  TRAC #21167 ISSUE=338 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1213 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't check for Break on the first loop fragment.  TRAC #21167 ISSUE=338 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1212 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Indicate breaking out of an excessive loop using the loop index name.  TRAC #21167 ISSUE=338 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1211 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Keep track of the index name of excessive loops.  TRAC #21167 ISSUE=338 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1210 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use a single index for excessive loops.  TRAC #21167 ISSUE=338 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1209 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Limit HLSL loop scope to match that of GLSL for excessive loops.  TRAC #21167 ISSUE=338 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1208 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Disable debug logging on Release builds.  TRAC #21169 ISSUE=322 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1207 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Disallow redefinition of built-in functions.  TRAC #21173 Issue=343 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1206 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
This patch reverts r1203 but in slightly different way. It seems there is a problem with the config of memory bots. The usage of std::locale in ANGLE is fine. Review URL: https://codereview.appspot.com/6392052  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1205 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Reconstructed preprocessor.vcproj from libGLESv2.vcproj.  There was something different about the project properties in release builds that caused std::vector to have different member variable offsets leading to the samples crashing in Release builds. Removed stuff that was specific to libGLESv2.vcproj. Project now builds in all configs including x64. Review URL: https://codereview.appspot.com/6374050  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1204 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Builds for chrome memroy bots (windows only) do not link due to the usage of std::locale the reason for which is still unknown. This patch avoids the usage of std::locale while still enforcing "C" locale and checking for overflow. Review URL: https://codereview.appspot.com/6392046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1203 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement binary streams. Review URL: https://codereview.appspot.com/6357050  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1200 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Support for serializing a linked program to binary.  The format has a text section followed by a binary section. The binary section contains an image of the device caps and the two shader executables. The text section has everything else newline deliminated.  Ran WebGL conformance tests with temporary change to glLinkProgram that round trips all linked programs through glGetProgramBinary and glProgramBinary. No regressions. Review URL: https://codereview.appspot.com/6295092  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1199 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Handle all INTZ format queries.  TRAC #20959 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1155 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed static destructors in DependencyGraphBuilder.  Review URL: https://codereview.appspot.com/6296079/   git-svn-id: https://angleproject.googlecode.com/svn/trunk@1154 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed compile error for translator_hlsl.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1153 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed compile error on linux.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1152 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed compile error on linux.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1151 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Preparation of hooking up the new preprocessor. - Added custom Diagnostics class. Routed all info-log messages via this new class. - Added custom DirectiveHandler class. Moved directive-handling code to this class and routed the old path. - Deleted lexer_glue because it is not needed anymore. The new preprocessor is almost ready! - Killed a bunch of dead code related to PragmaTable. Review URL: https://codereview.appspot.com/6308074  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1150 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented line directive. Review URL: https://codereview.appspot.com/6307083  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1149 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented macro expansion. Review URL: https://codereview.appspot.com/6303052  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1148 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove an unused variable from readCPPline()  This causes problems with -Wunused-but-set-variable in GCC 4.6.  Review: http://codereview.appspot.com/6296o59/  Author: Steve Block  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1147 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add placeholder entry points for GL_OES_get_program_binary. Review URL: https://codereview.appspot.com/6279054  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1146 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add the SH_CSS_SHADERS_SPEC flag.  Review URL: https://codereview.appspot.com/6270050/   git-svn-id: https://angleproject.googlecode.com/svn/trunk@1145 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move ProgramBinary into new file. Review URL: https://codereview.appspot.com/6299058  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1144 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactor Program into Program and ProgramBinary.  Program manages the state and lifetime of the program object.  ProgramBinary holds the linked program and the code to do the linking.  There should be no functional change. WebGL conformance tests did not regress. Review URL: https://codereview.appspot.com/6267047  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1143 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Program::link() and callees do not access mPixelHLSL mVertexHLSL mFragmentShader mVertexShader mAttributeBinding.  mPixelHLSL and mVertexHLSL are deleted because they are only used during linking. Review URL: https://codereview.appspot.com/6306047  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1141 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Initial specification for ANGLE_program_binary. Review URL: https://codereview.appspot.com/6267048  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1140 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
If a uniform was created before still set the register type index since it can be different.  TRAC #20948 Issue=337 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1139 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed redundant registerCount > 0 checks. The register indices now indicate presence.  TRAC #20948 Issue=337 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1138 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactored setting the register information.  Avoided calling GetConstantByName.  TRAC #20948 Issue=337 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1137 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Store multiple register indices per uniform.  TRAC #20948 Issue=337 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1136 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Error out if depth textures have more than one level.  Trac #20959 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1135 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix error checking for glTexSubImage2D  Trac #20959 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1134 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix error checking for glTexImage2D  Trac #20959 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1133 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Updates to ANGLE_depth_texture  Trac #20959  - fix a number of incorrect error values  - disallow multi-level depth textures  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1132 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Apply SH_TIMING_RESTRICTIONS to all samplers.  Issue: 332 Review URL: https://codereview.appspot.com/6273044/   git-svn-id: https://angleproject.googlecode.com/svn/trunk@1131 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Disallow GL_ALPHA for framebuffer attachment rendering.  TRAC #20943 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1129 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Generate Lod0 functions even if they don't contain gradients so we can call them from discontinuous loops.  TRAC #20737 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1128 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix gyp build and disable warning that is an error in Chrome. Review URL: https://codereview.appspot.com/6260063  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1127 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added PreprocessorTest::preprocess that preprocesses the input string and compares the output with that of the expected string. Renamed other *Test::preprocess methods to something different and clearer.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1126 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed the location of EOF token. Added three new location tests for EOF.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1125 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Return 0 for dFdx dFdy and fwidth for discontinuous arguments.  TRAC #20737 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1124 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Call Lod0 functions when inside a loop with a discontinuity.  TRAC #20737 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1123 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Output Lod0 copies of functions containing gradient operations when the shader contains a discontinuity.  TRAC #20737 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1122 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a traverser for detecting gradient operations.  TRAC #20737 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1121 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add analysis utility to detect discontinuities.  TRAC #20737 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1120 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added Lod0 versions of texture sampling intrinsics.  TRAC #20737 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1119 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Output the complete function at once to avoid having to erase the function arguments.  TRAC #20737 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1118 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adjust the maximum loop iterations to keep the HLSL compiler happy  Trac #20913 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1117 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Advertise support for ANGLE_depth_texture  Trac #20875 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1116 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Apply the depth texture correctly as the DepthStencil surface in applyRenderTarget  Trac #20875 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1115 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ensure all getDepthStencil and getRenderTarget calls consistently handle references to the underlying d3d surfaces  Trac #20875 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1114 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update FBO completeness checks for depth textures  Trac #20875 Signed-off-by: Nicolas Capens  - improve missing attachment logic to allow no color attachments - disallow depth texture color attachments - allow texture depth and stencil attachments - update simulaneous depth/stencil logic  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1113 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
do some cleanup in Framebuffer::completeness  Trac #20875 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1112 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add an IsDepthFormat helper function  Trac #20875 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1111 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add TextureStorage support for INTZ depth textures and ensure Images never create INTZ surfaces  Trac #20875 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1110 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Factor renderability check into GetTextureUsage  Trac #20875 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1109 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Pass the usage parameter into TextureStorage instead of passing a boolean  Trac #20875 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1108 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactor texture usage logic to helper function  Trac #20875 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1107 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move glTexSubImage early out check after more of the error checks are done.  Trac #20875 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1106 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Report errors for unsupported Depth/stencil texture operations  Trac #20875 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1105 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Allow depth and depth-stencil formats and types for textures and update utility functions  Trac #20875 Signed-off-by: Nicolas Capens  TexImage2D accepts   formatinternalformat=DEPTH_COMPONENT type=UNSIGNED_SHORT   formatinternalformat=DEPTH_COMPONENT type=UNSIGNED_INT   formatinternalformat=DEPTH_STENCIL_OES type=UNSIGNED_INT_24_8_OES  TexSubImage2D accepts   format=DEPTH_COMPONENT type=UNSIGNED_SHORT   format=DEPTH_COMPONENT type=UNSIGNED_INT   format=DEPTH_STENCIL_OES type=UNSIGNED_INT_24_8_OES  TexStorage2DEXT accepts   internalformat=DEPTH_COMPONENT16   internalformat=DEPTH_COMPONENT32_OES   internalformat=DEPTH24_STENCIL8_OES  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1104 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Detect depth texture support using INTZ and NULL textures  Trac #20875 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1103 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add ANGLE_depth_texture specification  Trac #20893  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1102 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add the SH_TIMING_RESTRICTIONS compile flag and dependency graph implementation.  Description of the algorithm: http://code.google.com/p/mvujovic/wiki/ShaderControlFlowAnalysis  This flag is one potential solution to timing attacks on textures containing cross-domain content or user agent data. This kind of analysis could be useful for both WebGL and CSS Shaders.  The SH_TIMING_RESTRICTIONS flag will reject a shader if it uses texture dependent data to affect control flow.  Other ways of affecting shader timing such as using NaNs in basic arithmetic operations or using built-in functions (e.g. atan) with different inputs are still under investigation.  Issue=329 Review URL: http://codereview.appspot.com/6195062/    git-svn-id: https://angleproject.googlecode.com/svn/trunk@1101 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Updated VersionTest to use the same pattern as other tests.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1100 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed compile errors on linux.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1099 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed the unnecessary usage of GTEST_HAS_PARAM_TEST and GTEST_HAS_COMBINE. I would rather have tests fail to compile than be silently ignored.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1098 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactored all tests to derive from a common PreprocessorTest. This avoids some code duplication. Review URL: https://codereview.appspot.com/6257048  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1097 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renamed UNEXPECTED_TOKEN_IN_DIRECTIVE to UNEXPECTED_TOKEN.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1096 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented #extension and #version directives. Review URL: https://codereview.appspot.com/6242045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1095 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented #error and #pragma directives. Added new tests and updated old ones for the new preprocessor API. Review URL: https://codereview.appspot.com/6213066  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1094 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Token::value now contains text for all types of tokens - not just CONST_INT CONST_FLOAT and IDENTIFIER. This makes it easier to report diagnostics and various preprocessor directives.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1093 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented #define and #undef directives. Review URL: https://codereview.appspot.com/6215072  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1092 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Deleted old unused files.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1091 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed compile warnings on linux.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1090 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed compile error in lexer_glue.cpp.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1089 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed compile errors and warnings on linux.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1088 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved error-handling to a separate class - Diagnostics. We were earlier returning errors as tokens which did not work very well when error occured while parsing a preprocessor directive. Now all returned tokens are valid. Errors are reported via an abstract Diagnostics interface. Updated unit-tests with the new scheme. Review URL: https://codereview.appspot.com/6203089  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1087 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added svn:ignore property for googlemock.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1086 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added DEPS for gmock library. Review URL: https://codereview.appspot.com/6203086  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1085 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Reafactored Lexer class to allow chaining. The full chain when parsing #if directive looks like this: Preprocessor -> MacroExpander -> DirectiveHandler -> MacroExpander -> DefinedFilter -> Tokenizer. This chain dynamically changes depending on the current context.  Also added an incomplete implementation of #if handling and ExpressionParser to illustrate how this design is supposed to work. Review URL: https://codereview.appspot.com/6203060  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1084 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove duplicate error checks from Texture subImage and subImageCompressed.  Issue=306 Signed-of-by: Nicolas Capens  These errors are validated by validateSubImageParams* now no need to do it twice.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1083 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make TextureCubeMap size/format/compressed checks explicit about the level and face they are checking  Issue=306 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1082 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make Texture2D format and compression checks be explicit about the level they are checking  Issue=306 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1081 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove unused base class Texture methods and make them non-virtual in derived classes  Issue=306 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1080 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
make sure all texture->isCompressed calls are type-specific  Issue=306 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1079 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Split RenderbufferTexture into 2D and CubeMap specific variants  Issue=306 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1078 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove the unused Texture::getType method  Issue=306 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1077 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Split validateSubImageParams into a texture type-specific check  Issue=306 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1076 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move the internal format check for compressed subImage commands to the API layer  Issue=306 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1075 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Texture: Avoid attempting to create 0 sized D3D textures  Issue=301 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1074 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Optimize Context::applyTextures by avoiding repeated getTextureSerial calls  Issue=301 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1073 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Memory associated with allTokens is never freed due to early return in "case -1" in CPPpragma(yystypepp*) in cpp.c  ISSUE=328 Signed-off-by: Daniel Koch Author: David Kilzer  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1072 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ensure that strings produced by getVariableInfo are always null-terminated Issue 326    git-svn-id: https://angleproject.googlecode.com/svn/trunk@1070 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Minor refactoring for Input class. Chnaged a raw array to std::vector.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1068 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement SSE2 version of loadAlphaData  http://codereview.appspot.com/6050054/ Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Authored-by: Jin Yang  With this patch my HTML5 2D canvas benchmark with Chromium on Windows7 with GPU acceleration can boost about 4% though the most execution time is in GPU.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1067 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Using yy_scan_string which flushes the old buffer does not work. GLSL requires that each input string is concatenated but yy_scan_string treats each string individually. Added a custom YY_INPUT which maintains the continuity between each string. Review URL: https://codereview.appspot.com/6130045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1066 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added operator test. Review URL: https://codereview.appspot.com/6129055  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1065 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added missing files from the renaming of UnfoldSelect to UnfoldShortCircuit.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1064 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make sure the internal DX uniforms get updated after re-linking.  TRAC #20659 Issue=321 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1063 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renamed UnfoldSelect to UnfoldShortCircuit.  TRAC #11866 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1062 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented short-circuiting for logical OR and AND operators.  TRAC #11866 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1061 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ensure that non-sequence single-statement conditional blocks and loop bodies get unfolding of short-circuiting operators.  TRAC #11866 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1060 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Changes to handle comments properly and associated tests. Review URL: https://codereview.appspot.com/6111059  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1059 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added tests for token location. Review URL: https://codereview.appspot.com/6118062  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1058 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ugly hack to fix compile error on windows. VC++ does not support C99 and hence snprintf. BUG=308 Review URL: https://codereview.appspot.com/6120055  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1057 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Replaced Token::Location::string with Token::Location::file.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1056 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Changed Token::Location::string to Token::Location::file to keep it consistent with __FILE__ inbult macro.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1055 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed the usage of testing::Range. I was assuming that the range is closed interval i.e. it includes the max value. But it does not. Review URL: https://codereview.appspot.com/6112055  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1054 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added rules for ignoring comments.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1053 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Stop using unsafe sprintf method.  ISSUE=308 Signed-off-by: Kenneth Russell Author: David Kilzer  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1052 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Drastically simplified Input class. Now most of the heavy lifting is done by in-built yy_scan_string and yy_scan_bytes. Comment handling will be done by the lexer.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1051 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added tests for the whole character set. Review URL: https://codereview.appspot.com/6105044  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1050 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
The default implementation in flex only handles LF characters. GLSL supports all three newline characters - LF CR and CR+LF. Use a custom newline handler. Review URL: https://codereview.appspot.com/6105045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1049 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Do not return newline and number sign. They are for internal purposes only.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1048 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a catch-rule for invalid numbers.  Note that we do not need such a rule for identifiers because they will always be either terminated by a space a punctuator or an invalid character. Space and punctuator are both valid cases. The invalid character will be caught by another rule specifically for invalid characters. I will cover this case when I add tests for valid character set. Review URL: https://codereview.appspot.com/5978048  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1047 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Build fix for chromeos.  BUG= TEST=chromeos bots compile when we roll ANGLE TBR=alokp  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1046 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix signed 16.16 fixed-point conversion.  TRAC #20561 ISSUE=320 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1045 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't append '_' to the end of prefix in long name mapping if the original name starts with '_'  Otherwise we will have '__' which is illegal. Review URL: https://codereview.appspot.com/5978058  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1044 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added tests for identifiers. Review URL: https://codereview.appspot.com/6038043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1042 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Handle hex int constant in preprocessor  The patch is provided by jdashg and committed by zmo.  (see angle issue 178)  ANGLEBUG=178 TEST=shader-with-hex-int-constant-macro.html TBR=zmo Review URL: https://codereview.appspot.com/6037044  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1041 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added tests for number types. Review URL: https://codereview.appspot.com/6022045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1040 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Minor formatting change in pp.l.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1039 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed compile error in lexer_glue.cpp. TBR=zmo@chromium.org Review URL: https://codereview.appspot.com/6035044  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1038 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed unnecessary includion of Token.h in various files.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1037 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added tests for pp::Token interface and white-space handling by the preprocessor. By the magic of test-case generators we have 74 tests! Review URL: https://codereview.appspot.com/6009054  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1036 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Mac/Linux build fix.  BUG= TEST=compile fine TBR=alokp Review URL: https://codereview.appspot.com/6013048  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1035 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update emulated functions.  It turns out there are bugs in our tests so kbr fixed them a while ago.  Now we had another look at the tests and it turned out some functions we don't have emulate and some functions we need to also emulate in fragment shaders.  BUG= TEST= R=kbr Review URL: https://codereview.appspot.com/6011056  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1034 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Modified the interface of Preprocessor. Added it to the build file. Lexer changes to record leading space.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1033 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added HAS_LEADING_SPACE flag to pp::Token. Split the new preprocessor into a separate target.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1032 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update reserved keywords.  TRAC #20514 ISSUE=317 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1031 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix a few compilation warning/errors on Linux/Mac. Review URL: https://codereview.appspot.com/6009045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1030 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Decorate (and undecorate) struct fields too (when not built-in).  Trac #20510 Issue=316317 Authored-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1027 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Guard against null surface in Image::updateSurface. Review URL: https://codereview.appspot.com/5985051  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1026 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added googletest to svn:ignore list.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1025 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added infrastructure for adding gtest-based tests. I need to use it for the new preprocessor. Review URL: https://codereview.appspot.com/5988069  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1024 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed the unnecessary usage of InputSrc::getch and InputSrc::ungetch when handling pragma. These functions are not supported by the new lexer.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1020 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added an alternate lexer for the existing preprocessor. It is still behind a compile-time flag. Review URL: https://codereview.appspot.com/5976072  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1019 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Increase Vertex Decl cache size to 32 entries.  This should reduce the risk of running out of cache entries inside a frame while being small enough that iterating through it to find the correct entry shouldn't be too expensive.  BUG=310 TEST=  Review URL: https://codereview.appspot.com/5969077  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1018 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed info log regressions.  TRAC #20443 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1017 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Return a sequence when optimizing constant conditions so that brackets will be added to the HLSL output.  TRAC #20052 ISSUE=252 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1016 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed line number reporting. Each newline was being counted twice.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1015 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added lexer rules for operators. Review URL: https://codereview.appspot.com/5966072  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1014 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make Image::lock and unlock private and call them from Image::loadData.  This is because I want loadData to be able to decide whether to use LockRect/UnlockRect or UpdateSurface as the method to load the data depending on whether the Images are backed by textures in the default pool or not.  I think it actually cleans up the code a bit.  Also fixed a bug in subImageCompressed. The associated WebGL conformance test now passes. Review URL: https://codereview.appspot.com/5948043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1013 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Punted on bison parser. It was turning out to be more complicated than necessary. Manual parsing combined with a flex lexer is easier.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1012 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
More prep work for macro expansion. Off-loaded lexing from Context class to a new Lexer class. Review URL: https://codereview.appspot.com/5059048  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1011 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Selection nodes are temporaries.  Issue=156 TRAC #16816 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1010 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix comma operator precedence.  TRAC #20059 ISSUE=290 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1009 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fence has pointer to the associated egl::Display.  I think the assumption that getDisplay() returns a valid display in the Fence destructor is wrong.  I'm trying to fix a crash in the field that looks like this:  Thread 0 *CRASHED* ( EXCEPTION_ACCESS_VIOLATION_READ @ 0x00000000 )  0x69582e38	 [libglesv2.dll	 - fence.cpp:27	gl::Fence::~Fence() 0x69582f29	 [libglesv2.dll	 + 0x00022f29]	gl::Fence::`scalar deleting destructor'(unsigned int) 0x6958077d	 [libglesv2.dll	 - context.cpp:1020	gl::Context::deleteFence(unsigned int) 0x69582b9b	 [libglesv2.dll	 - context.cpp:195	gl::Context::~Context() 0x69582dcb	 [libglesv2.dll	 + 0x00022dcb]	gl::Context::`scalar deleting destructor'(unsigned int) 0x69582df2	 [libglesv2.dll	 - context.cpp:4259	glDestroyContext 0x73166ab8	 [libegl.dll	 - display.cpp:768	egl::Display::destroyContext(gl::Context *) 0x73168393	 [libegl.dll	 - libegl.cpp:861	eglDestroyContext 0x6e18f1db	 [chrome.dll	 - gl_context_egl.cc:76	gfx::GLContextEGL::Destroy() 0x6e18f40d	 [chrome.dll	 - gl_context_egl.cc:43	gfx::GLContextEGL::~GLContextEGL()  Here's the disassembly:  69582E21  push        esi   69582E22  mov         esiecx  69582E24  cmp         dword ptr [esi+4]0  69582E28  mov         dword ptr [esi]695CBBE0h  69582E2E  je          69582E3F  69582E30  call        695743F5 // this is getDisplay() 69582E35  push        dword ptr [esi+4]  69582E38  mov         edxdword ptr [eax] // crashes here because EAX is zero 69582E3A  mov         ecxeax  69582E3C  call        dword ptr [edx+24h] // this is freeEventQuery() 69582E3F  pop         esi   69582E40  ret     It looks like getDisplay() returns null.  http://code.google.com/p/chromium/issues/detail?id=117817 Review URL: https://codereview.appspot.com/5875044  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1008 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed missing semicolon for do-while.  TRAC #20055 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1007 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Avoid adding duplicate struct constructors.  TRAC #20057 ISSUE=285 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1006 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
The function parameters and function body belong to the same scope.  TRAC #20056 ISSUE=256 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1005 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Define constructors for structures defined in argument lists.  TRAC #20056 ISSUE=256 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1004 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Detect when declaring previously undeclared variables as invariant and avoid using an uninitialized type.  TRAC #20042 ISSUE=241 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1002 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Start a new scope for conditional statements even when there are no curly brackets. Also fix the DO WHILE grammar.  TRAC #20052 ISSUE=252255 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1001 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Regenerate the parser using Bison 2.4.2.  TRAC #20052 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1000 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Limit HLSL loop scope to match that of GLSL.  TRAC #19197 ISSUE=260 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@999 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Revert "Fixed test for 16-bit index range".  TRAC #19988 Issue=304 Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@998 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make essl_to_glsl target windows only.  This is a quick fix for gclient runhooks error on Mac/Linux.  BUG= TEST=gclient runhooks --force on Mac/Linux Review URL: https://codereview.appspot.com/5732047  git-svn-id: https://angleproject.googlecode.com/svn/trunk@997 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Provide multi-dimensional atan intrinsics.  TRAC #19989 Issue=302 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@996 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed test for 16-bit index range.  TRAC #19988 Issue=304 Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@995 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Updates to ANGLE_pack_reverse_row_order  git-svn-id: https://angleproject.googlecode.com/svn/trunk@994 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't use strlen inside of loop  This could hurt performance quite a bit.  BUG=296 TEST=  Review URL: https://codereview.appspot.com/5675086  git-svn-id: https://angleproject.googlecode.com/svn/trunk@993 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Support reloading the shader compiler  Trac #19900 Issue=291  - Move compiler initialization to a separate function - all this function to ensure the compiler is loaded when a compile is attempted (previously if the compiler was released you'd have to create a new shader object to get it reloaded).  Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@992 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add ability to recompile shader source  Trac# 19900 Issue=291  - add an 'uncompile' function to clear all results from any previous compile attempts - allow compiling to be done multiple times on the same shader - allow a shader to be compiled with no source specified (to produce an appropriate error).  Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@991 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Rename the Shader 'varyings' member to 'mVaryings' to follow coding standard  Trac #19900 Issue=291  Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@990 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Provide better encapsulation for Shader member variables  Trac 19900 Issue=291  Moved a bunch of member variables from 'protected' to 'private'  Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@989 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update ANGLE_instanced_arrays spec.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@986 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move translator_hlsl target into Windows specific section of build_angle.gyp. Review URL: https://codereview.appspot.com/5639055  git-svn-id: https://angleproject.googlecode.com/svn/trunk@985 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove 'chromium_code' from build_angle.gyp.  This is because the ninja build system unlike make builds translator_hlsl and fails on the clang warnings. Review URL: https://codereview.appspot.com/5647048  git-svn-id: https://angleproject.googlecode.com/svn/trunk@984 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Create D3D device when eglInitialize is called.  This is because some GPUs / drivers are unable to create the device once the Chromium GPU process sandbox has been locked down and waiting for the first context / surface to be created is too late. Review URL: https://codereview.appspot.com/5647046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@983 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Disable getting share handles when PIX is enabled.  PIX doesn't seem to work with share handles so disable them when we detect that pix is enabled.  BUG= TEST=  Review URL: https://codereview.appspot.com/5625048  git-svn-id: https://angleproject.googlecode.com/svn/trunk@982 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
The normalized argument of vertexAttribPointer should not affect float and fixed.  Issue=155 Signed-off-by: Nicolas Capens Author: Pierre Leveille  git-svn-id: https://angleproject.googlecode.com/svn/trunk@981 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Enabled MSVC warning 4389 : signed/unsigned mismatch.  I also fixed Config.cpp so it compiles without the warning.  This is because this is now a warning as error in Chromium. Review URL: https://codereview.appspot.com/5600047  git-svn-id: https://angleproject.googlecode.com/svn/trunk@980 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added missing printf format type.  %z was actually just a modifier. Review URL: https://codereview.appspot.com/5569082  git-svn-id: https://angleproject.googlecode.com/svn/trunk@979 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed _HAS_TR1 macro definition from common.gypi. Review URL: https://codereview.appspot.com/5569078  git-svn-id: https://angleproject.googlecode.com/svn/trunk@978 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix printf format specifier in PoolAlloc.cpp.  %Iu is used for size_t printf arguments in MSVC. The GCC equivalent is %z. MSVC does not support %z though. Review URL: https://codereview.appspot.com/5578050  git-svn-id: https://angleproject.googlecode.com/svn/trunk@977 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Centralize detection of instancing support.  TRAC #19489 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@976 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Expose the ANGLE_instanced_arrays extension.  TRAC #19489 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@975 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Work around a bug observed with ATI graphics cards where instanced draw calls fail when all attributes are non-instanced by repeating the draw call.  TRAC #19489 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@974 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Re-implement line loops by constructing a 'looping' index buffer so it is compatible with instanced draws.  TRAC #19489 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@973 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement glDrawArraysInstanced by constructing a 'counting' index buffer since D3D9 only supports instancing on indexed draw calls.  TRAC #19489 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@972 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ignore the 'first' parameter of glDrawArraysInstanced for instanced attributes.  TRAC #19489 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@971 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adjust the amount of streaming buffer space required for instanced attributes.  TRAC #19489 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@970 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Set the stream source frequencies for instanced draw calls. Searches for an indexed (non-instanced) attribute to ensure it gets mapped to stream 0.  TRAC #19489 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@969 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add entry points and constants for GL_ANGLE_instanced_arrays.  TRAC #19489 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@968 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add ANGLE_instanced_arrays spec  Trac #18156  git-svn-id: https://angleproject.googlecode.com/svn/trunk@967 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix warning in PoolAlloc.cpp.  Use "I" instead of "l" as printf type prefix for size_t. Review URL: https://codereview.appspot.com/5572071  git-svn-id: https://angleproject.googlecode.com/svn/trunk@966 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed more warnings.  Clang warns about missing case in enum glslang_lex.cpp so I disabled that one as well.  MSVC as Chromium is built at least warns about things in its own STL headers in SymbolTable.cpp so disabled the warning for that file.  esTransform.c had a struct that the compiler could not determine was initialized so I explicitly initialized it. Review URL: https://codereview.appspot.com/5577048  git-svn-id: https://angleproject.googlecode.com/svn/trunk@965 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Increase MSVC warning level to 4.  There are some exceptions a subset of the exceptions used by Chromium. They didn't seem to be useful warnings.  In code which we don't change much like the preprocessor I just suppressed the warnings in the specific files rather than changing the code.  There should be no functional changes in this patch. Review URL: https://codereview.appspot.com/5570066  git-svn-id: https://angleproject.googlecode.com/svn/trunk@964 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Explicitly disable warnings for auto-generated files.  I think this is better than modifying the auto-generated files. Review URL: https://codereview.appspot.com/5569058  git-svn-id: https://angleproject.googlecode.com/svn/trunk@963 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix remaining compiler warnings in translator_common.  One MSVC warning and one GCC warning.  I also added a variable to build_angle.gyp that will enforce various rules not normally applied to third party software when built as part of chromium. Review URL: https://codereview.appspot.com/5570061  git-svn-id: https://angleproject.googlecode.com/svn/trunk@962 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove calls to new when modifying shader constants.  There were some unnecessary temporary copies we can remove and the rest have a maximum size so we can allocate them on the stack.  BUG=276 TEST=  Review URL: https://codereview.appspot.com/5540071  git-svn-id: https://angleproject.googlecode.com/svn/trunk@961 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Enable warnings as errors.  I didn't do it for translator_common though because it contains automatically generated code.  This is improve the signal to noise ratio in the chromium build logs. Review URL: https://codereview.appspot.com/5572055  git-svn-id: https://angleproject.googlecode.com/svn/trunk@960 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix MSVC warning in DetectRecursion.cpp.  In preparation for turning on warnings as errors. Review URL: https://codereview.appspot.com/5564053  git-svn-id: https://angleproject.googlecode.com/svn/trunk@959 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added EGL_KHR_image_base and GL_OES_EGL_image_external entry points to esUtil. Review URL: https://codereview.appspot.com/5574051  git-svn-id: https://angleproject.googlecode.com/svn/trunk@958 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix float texture support test  Trac #19573 Issue=281 Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@957 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved RefCountObject to common so it can be used by libEGL. Review URL: https://codereview.appspot.com/5557064  git-svn-id: https://angleproject.googlecode.com/svn/trunk@956 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Rename IslTextureTarget to IsInternalTextureTarget.  TEXTURE_EXTERNAL is not considered an internal texture target. Review URL: https://codereview.appspot.com/5556067  git-svn-id: https://angleproject.googlecode.com/svn/trunk@955 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Detect GNU Hurd and Debian kFreeBSD as ANGLE_OS_POSIX  See https://bugzilla.mozilla.org/show_bug.cgi?id=711353  Patch by Mike Hommey    git-svn-id: https://angleproject.googlecode.com/svn/trunk@954 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Increase size of output buffer for pix to 32768  We output entire hlsl shaders into this buffer so 4096 bytes was too small.  BUG= TEST=  Review URL: https://codereview.appspot.com/5532094  git-svn-id: https://angleproject.googlecode.com/svn/trunk@953 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds support for EXT_occlusion_query_boolean  TRAC #19360 Signed-off-by: Daniel Koch Authored-by: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@951 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use a global ref-counted singleton for long name map.  This makes sure the same varying/uniform variables maps to the unique name in vertex/fragment shader.  BUG= TEST=webgl conformance tests Review URL: https://codereview.appspot.com/5556065  git-svn-id: https://angleproject.googlecode.com/svn/trunk@950 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Rollback r942.  MapLongVariableNames inherits from TIntermTraverser and TIntermTraverser uses ANGLE's memory allocator thus the memory is released per compilation.  Our design is for MapLongVariableNames to be a singleton across all compilations thus this is not working.  BUG= TEST= TBR=kbr Review URL: https://codereview.appspot.com/5556053  git-svn-id: https://angleproject.googlecode.com/svn/trunk@949 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Changes the pointer from textures to their renderbuffer proxies to non-refcounted (2/2)  TRAC #19335 Issue=271 Instead the texture maintains an internal refcount which causes the pointer to behave kind of like a "weak" shared pointer-- its reference won't prevent the renderbuffer from being deleted but if the renderbuffer's refcount drops to zero the texture should set its pointer to the renderbuffer to null so that a new one can be created at the next getRenderbuffer call.  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@948 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Stores texture in RenderbufferTexture via a BindingPointer (1/2)  TRAC #19335 Issue=271  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@947 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Finished off the GLSL compiler's support for parsing shaders using OES_EGL_image_external.  The GLSL to HLSL translator work is not done yet so the extension is disabled in Shader.cpp. Review URL: https://codereview.appspot.com/5530081  git-svn-id: https://angleproject.googlecode.com/svn/trunk@946 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update extension numbers for published extensions.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@945 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refresh EGL/eglext.h from Khronos  git-svn-id: https://angleproject.googlecode.com/svn/trunk@944 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refresh GLES2/gl2ext.h from Khronos  git-svn-id: https://angleproject.googlecode.com/svn/trunk@943 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Long name mapping needs to be consistent between vertex/fragment shaders.  For example: varying variables uniforms.  This CL makes MapLongVariableNames a ref-counted singleton and therefore the map is shared by all shaders.  Also function/variable names changes from Varying to Global because uniforms also need to be consistent not just varying variables.  ANGLEBUG=279 TEST=webgl conformance tests especially invalid-passed-params.html and glsl-long-variable-names.html Review URL: http://codereview.appspot.com/5539046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@942 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Allocate D3D queries from a pool for the Display.  This is a workaround for an Intel bug.  The crash looks like this:  0x5f816c53	 [d3d9.dll	 + 0x00036c53]	CQuery::~CQuery() 0x5f816bec	 [d3d9.dll	 + 0x00036bec]	CQuery::`vector deleting destructor'(unsigned int) 0x5f7e8129	 [d3d9.dll	 + 0x00008129]	CBaseObject::~CBaseObject() 0x5f9e19c7	 [libglesv2.dll	 + 0x000319c7]	gl::Fence::`vector deleting destructor'(unsigned int) 0x5f9de78e	 [libglesv2.dll	 - context.cpp:975]	gl::Context::deleteFence(unsigned int) 0x5f9e1491	 [libglesv2.dll	 - context.cpp:198]	gl::Context::~Context() 0x5f9e182f	 [libglesv2.dll	 - context.cpp:3936]	glDestroyContext 0x717654ec	 [libegl.dll	 - display.cpp:749]	egl::Display::destroyContext(gl::Context *) 0x7176a3da	 [libegl.dll	 - libegl.cpp:907]	eglDestroyContext 0x64fbaf33	 [chrome.dll	 - gl_context_egl.cc:75]	gfx::GLContextEGL::Destroy()  The vendor ID is always 8086 (Intel). Not an XP issue - it's happening on Win 7.  With this change D3D queries are only released when the display is destroyed or reset or if a very high number of D3D queries have been allocated.  Tested by stepping exercising the NV_fence entry points in a debugger. Review URL: http://codereview.appspot.com/5534065  git-svn-id: https://angleproject.googlecode.com/svn/trunk@941 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move Context::sync to Display::sync.  This is a workaround for an Intel bug.  The crash looks like this:  0x5f816c53	 [d3d9.dll	 + 0x00036c53]	CQuery::~CQuery() 0x5f816bec	 [d3d9.dll	 + 0x00036bec]	CQuery::`vector deleting destructor'(unsigned int) 0x5f7e8129	 [d3d9.dll	 + 0x00008129]	CBaseObject::~CBaseObject() 0x5f9e19c7	 [libglesv2.dll	 + 0x000319c7]	gl::Fence::`vector deleting destructor'(unsigned int) 0x5f9de78e	 [libglesv2.dll	 - context.cpp:975]	gl::Context::deleteFence(unsigned int) 0x5f9e1491	 [libglesv2.dll	 - context.cpp:198]	gl::Context::~Context() 0x5f9e182f	 [libglesv2.dll	 - context.cpp:3936]	glDestroyContext 0x717654ec	 [libegl.dll	 - display.cpp:749]	egl::Display::destroyContext(gl::Context *) 0x7176a3da	 [libegl.dll	 - libegl.cpp:907]	eglDestroyContext 0x64fbaf33	 [chrome.dll	 - gl_context_egl.cc:75]	gfx::GLContextEGL::Destroy()  This is a crash in deleteFence but the same could happen in flush. Fix for the former to follow.  The vendor ID is always 8086 (Intel). Not an XP issue - it's happening on Win 7.  Tested by stepping through a call to glFinish in the debugger and ensuring that it sleeps but eventually returns. Review URL: http://codereview.appspot.com/5503094  git-svn-id: https://angleproject.googlecode.com/svn/trunk@940 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix a bug in long variable name mapping.  Originally we only match varying variables in vertex/fragment shaders.  However we should also match uniform names.  For example if a uniform variable name is used in both vertex and fragment shader and after mapping the names are different then the name mapping table is no longer 1:1.  BUG=106638 (crbug) TEST=http://seanseefried.com/chrome-bug/simple-broken.html shows a magenta square Review URL: http://codereview.appspot.com/5520051  git-svn-id: https://angleproject.googlecode.com/svn/trunk@939 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix off-by-one error in enforcement of WebGL's maximum struct nesting.  BUG=http://code.google.com/p/angleproject/issues/detail?id=275 TEST=WebGL conformance suite TBR=nicolas Review URL: http://codereview.appspot.com/5520049  git-svn-id: https://angleproject.googlecode.com/svn/trunk@938 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removes an unneeded GetDesc call from Clear  TRAC #19330 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Authored-by: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@930 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ensure texture storage exists before retrieving serial  Trac #19330 Signed-off-by: Nicolas Capens  In some cases we were trying to retrieve a serial from a rendertarget texture which didn't have the storage allocated yet. This was resulting in a 0 serial which was indistinguishable from the case where context was just marked dirty and we assumed the target was up-to-date. This resulted in failing to apply the correct rendertarget and as a result some d3d clear calls were failing (picked up by debug runtime).  git-svn-id: https://angleproject.googlecode.com/svn/trunk@929 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Only allow renderable d3dformats to be flagged as rendertarget texstorage  Trac #19356 Issue=273 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@928 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
rename TextureStorage renderable flag to reflect it's actual usage  Trac #19356 Issue=273 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@927 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactor image renderability lookup  Trac #19356 Issue=273 Signed-off-by: Nicolas Capens Based on preliminary patch from Ken Russell  Images are never renderable directly so renaming the Image::isRenderable function clarifies that we are only checking on the renderability of the format. Also factor out the lookup to a static helper function (it will be used elsewhere in the next patch)  git-svn-id: https://angleproject.googlecode.com/svn/trunk@926 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed gl_FragCoord.y calculation  TRAC #19349 ANGLEBUG=272 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@925 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Check device loss between GetData calls when blocking  Trac #19246 Issue=262  Some drivers don't properly return device lost  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@924 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Re-enable advertising EXT_texture_storage  Trac #19259 Issue=268  The problems on d3d9/winxp have been fixed.  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@923 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
make the renerable usage consistant and const  Trac #19259 Issue=268  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@922 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add TextureStorage::getPool method  Trac #19259 Issue=268  Use it to avoid duplicate calls to getTexturePool  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@921 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Let TextureStorage track the texture pool explicitly  Trac #19259 Issue=268  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@920 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Rename various mTexture variables to mTexStorage to reflect what they really are  Trac #19259 Issue=268  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@919 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Cache the computation of getD3DFormat  Trac #19259 Issue=268  Instead of looking this up every time we'll just compute it when the type/format changes.  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@918 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move ConvertTextureFormatType  Trac #19259 Issue=268  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@917 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Track the texture pool explicitly in the Image class  Trac #19259 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@916 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix managed texturestorage textures  Trac #19259 Issue=268  managed textures need to be set on the images so they can be updated properly and to avoid the additional system memory copy of the surfaces. Also make sure track the managed state properly.  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@915 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use the correct d3dformat for texstorage textures.  Trac #19259 Issue=268  The image we were trying to get the d3dformat from hadn't been initialized yet.  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@914 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add a static helper function to convert a GL format/type to d3dformat and call this from Image::getD3DFormat  Trac #19259 Issue=268  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@913 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use the correct function to determine texture pool  Trac #19259 Issue=269  git-svn-id: https://angleproject.googlecode.com/svn/trunk@912 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update version.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@911 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
(Landing this on behalf of groby@chromium.org.  Review the CL at http://codereview.appspot.com/5482053/)  Fix issue-242 (failure to compile any shader using cos() with SH_EMULATE_BUILT_IN_FUNCTIONS)  ANGLEBUG=242  git-svn-id: https://angleproject.googlecode.com/svn/trunk@910 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ensure the device states are reinitialized after a device Reset  Trac #19246 Issue=262  After a device lost the "mSceneStarted" variable was getting out of sync and thus we were never restarting the scene before drawing. It's probably best to ensure that any default states we need are also set after a reset.  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@909 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix more rendertarget leaks  Trac #19246 Issue=262  FBO rendertargets are explicitly refcounted.  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@908 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Stop advertizing GL_EXT_texture_storage until issue 266 is resolved. Review URL: http://codereview.appspot.com/5484055  git-svn-id: https://angleproject.googlecode.com/svn/trunk@907 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix error reporting for lost contexts  Trac #19246 Issue=262  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@906 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Guard against releasing NULL textures.  ANGLEBUG=265 TRAC #19196 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@905 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update version to 904. Review URL: http://codereview.appspot.com/5449113  git-svn-id: https://angleproject.googlecode.com/svn/trunk@904 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed leak of render target associated with ColorBuffer.  Following r853 I am assuming that any render target returned by FrameBuffer::getRenderTarget has to be released. Updating the usage of getRenderTarget to reflect that.  This is not reproducible in Chrome at the moment but it will be once I start rendering to pbuffers.  I ran the WebGL conformance tests. No regressions or crashes. Review URL: http://codereview.appspot.com/5451110  git-svn-id: https://angleproject.googlecode.com/svn/trunk@903 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented EGL_NV_post_sub_buffer.  The change to the sample is just to demonstrate how I tested it. I won't check in the stuff under samples/.  It's not clear to me what eglPostSubBufferNV should do if EGL_POST_SUB_BUFFER_SUPPORTED_NV is false. At the moment it fails silently as though it was called on the wrong surface type:   "If <surface> is a back-buffered surface then the requested portion     of the color buffer is copied to the native window associated with     that surface. If <surface> is a single-buffered window pixmap or     pbuffer surface eglSwapBuffers and eglPostSubBufferNV have no     effect." Review URL: http://codereview.appspot.com/5345050  git-svn-id: https://angleproject.googlecode.com/svn/trunk@902 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Creates helper function for common subimage param checking  TRAC #18802 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@901 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds missing parameter checks to texture functions  TRAC #18802 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@900 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds a level parameter to texture getWidth and getHeight  TRAC #18802 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@899 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Checks parameters of matrices for under-fullness in shader constructor check.  TRAC #18906 Issue=218 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@898 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix post-build steps when spaces appear in directory names  TRAC #18901 Issue=245 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@897 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update major version.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@895 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add another contributor  git-svn-id: https://angleproject.googlecode.com/svn/trunk@894 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update contributors  git-svn-id: https://angleproject.googlecode.com/svn/trunk@893 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix rendering for the closing line of line loops.  Trac #19035 Signed-off-by: Nicolas Capens  Line loops via DrawArrays were incorrect because the vertex buffer already has the vertex offset factored in. Line loops via DrawElements were incorrect because the vertex buffer was offset by the minIndex. We need to use the same minIndex when rendering the closing loop.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@892 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Avoid rendering the last pixel of lines.  Trac #19035 Issue=257 Author: Yuriy O'Donnell  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@891 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix HLSL translation for mod(vec2vec2)  ANGLEBUG=258 Signed-off-by: Daniel Koch Signed-off-by: Nicolas Capens Author: Sam Hocevar  git-svn-id: https://angleproject.googlecode.com/svn/trunk@890 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add GL_ANGLE_pack_reverse_row_order. Performs vertical flip in readPixels and may write direct to client ptr.  Bug=none Test= Tested in a modified version of Chromium using canvas2D. Review URL: http://codereview.appspot.com/5373104  git-svn-id: https://angleproject.googlecode.com/svn/trunk@889 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for GL_ARB_texture_rectangle to shader validator.  Parser was regenerated with the flex/bison shipped with Ubuntu 10.04.  BUG=251 TEST=tested with new Core Animation plugin rendering path on Mac OS X Review URL: http://codereview.appspot.com/5432044  git-svn-id: https://angleproject.googlecode.com/svn/trunk@888 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Upstream android's change for angle   BUG= TEST= Review URL: http://codereview.appspot.com/5410050  git-svn-id: https://angleproject.googlecode.com/svn/trunk@887 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Checks level on relevant gl calls against implementation maximum.  TRAC #18905 Issue=243 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@885 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix count of elements in buffer  There can be one extra element at the end even if an entire stride doesn't fit.  BUG= TEST=  Review URL: http://codereview.appspot.com/5401046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@884 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Immutable textures are always mipmap complete.  TRAC #18730 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@883 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Split completeness tests into sampler and mipmap completeness.  TRAC #18730 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@882 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Correct texture storage levels count validation.  TRAC #18730 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@881 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed vertex sampler index retrieval.  TRAC #18865 ANGLEBUG=247 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@880 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed the incorrect TQualifier on gl_FragData.  Signed-off-by: Daniel Koch Author: Mark Callow  git-svn-id: https://angleproject.googlecode.com/svn/trunk@879 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add extension specifications  git-svn-id: https://angleproject.googlecode.com/svn/trunk@878 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add new function prototypes to gl2ext.h  Trac #18608 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@877 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Resync version #876  git-svn-id: https://angleproject.googlecode.com/svn/trunk@876 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use the texture surfaces as image surfaces when managed.  TRAC #14743 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@875 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Used the MANAGED pool for non-renderable textures on XP.  TRAC #14743 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@874 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update revision info  git-svn-id: https://angleproject.googlecode.com/svn/trunk@873 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix uniform component size calculation for booleans.  Trac #18608 Boolean Uniforms are treated as either ints or floats both internally and when being loaded. A GLBoolean is effectively a char which is incorrect.  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@872 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Export new entry points via GetProcAddress and def file  Trac #18608 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@871 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for glGetnUniform*vEXT  Trac #18608  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@870 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add UniformExternalSize function  Trac #18608  Will be used in upcoming patch Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@869 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Rename UniformTypeSize to UniformInternalSize  Trac #18608 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@868 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Rename UniformComponentCount to UniformExternalComponentCount  Trac #18608 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@867 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix warning from uniform conversion template.  Trac #18606 The data loss is as required by the spec.  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@866 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add the ReadnPixelsEXT command  Trac #18608 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@865 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
update revision  git-svn-id: https://angleproject.googlecode.com/svn/trunk@864 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Advertise GL_ANGLE_texture_usage.  TRAC #18732 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@863 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Advertise GL_EXT_texture_storage.  TRAC #18730 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@862 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Create a render target texture when intended as framebuffer attachment.  TRAC #18732 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@861 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added the texture usage parameter.  TRAC #18732 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@860 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for floating-point and BGRA storage textures.  TRAC #18730 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@859 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for compressed storage textures.  TRAC #18730 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@858 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented glTexStorage2DEXT.  TRAC #18730 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@857 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added the immutable parameter.  TRAC #18730 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@856 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Issue render target serials per texture storage.  TRAC #18730 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@855 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move serial management to TextureStorage.  TRAC #18730 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@854 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Create D3D textures within Storage classes. Fixed render target reference counting.  TRAC #18730 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@853 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Simplified cube face handling and render target conversion.  TRAC #18730 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@852 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Encapsulate D3D textures into Storage classes.  TRAC #18730 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@851 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Advertise robustness extension strings.  Trac #18607 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@850 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Disable automatic device resets when using reset notification.  TRAC #18607 Signed-off-by: Daniel Koch Authors: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@849 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented context creation with reset notification.  TRAC #18607 Signed-off-by: Daniel Koch Authors: Shannon Woods Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@848 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented reset status.  TRAC #18607 Signed-off-by: Daniel Koch Authors: Shannon Woods Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@847 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ignore GL calls when the context is lost.  TRAC #18606 Signed-off-by: Daniel Koch Author: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@846 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Notify the display of a lost device and mark all contexts lost.  TRAC #18606 Signed-off-by: Daniel Koch Author: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@845 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Check for all device lost errors.  TRAC #18606 Signed-off-by: Daniel Koch Author: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@844 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add device error checking utility functions.  TRAC #18606 Signed-off-by: Daniel Koch Author: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@843 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
maxLevels is always 0.  TRAC #18714 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@842 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Release the D3D texture on any actual redefine.  TRAC #18714 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@841 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Separate Colorbuffer into storage and texture variants implementing a common interface.  TRAC #16284 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@840 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Be more explicit about floating-point format support.  TRAC #16284 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@839 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Issue a new serial for every new D3D texture.  TRAC #16284 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@838 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed unsafe casting.  TRAC #16284 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@837 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Always release pbuffer surfaces on redefine.  TRAC #18714 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@836 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
mIsRenderable is only valid when there is a texture.  TRAC #18714 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@835 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move copyToImage to Image::copy.  TRAC #18714 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@834 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
New image surfaces are not dirty (nothing to copy over). Lock marks images as dirty.  TRAC #18714 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@833 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminated the format parameter.  TRAC #18714 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@832 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved load*Data methods to Image.  TRAC #18714 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@831 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminated GetDesc calls.  TRAC #18714 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@830 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Encapsulate image surface creation.  TRAC #18714 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@829 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Defer image surface creation.  TRAC #18714 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@828 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Abstracted image locking/unlocking.  TRAC #18714 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@827 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Turned Image into a class to improve encapsulation.  TRAC #18714 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@826 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved Image outside of Texture.  TRAC #18714 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@825 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactored texture dirtiness.  TRAC #18714 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@824 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't redefine at copySubImage.  TRAC #18714 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@823 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactored redefine.  TRAC #18714 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@822 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved createSurface() to Image.  TRAC #18714 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@821 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Clear the dirty flag on copied images.  TRAC #18495 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@820 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Only destroy the redefined image level.  TRAC #18495 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@819 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use commitRect within updateTexture to avoid duplicate logic.  TRAC #18495 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@818 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
CreateAdditionalSwapChain can return D3DERR_DEVICELOST.  TRAC #18386 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@817 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Call ResetEx on lost or hung Ex devices. Attempt calling Reset/ResetEx at most 3 times.  TRAC #18386 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@816 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Perform proper Reset sequence.  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@815 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Bump version  BUG= TEST=  Review URL: http://codereview.appspot.com/5320073  git-svn-id: https://angleproject.googlecode.com/svn/trunk@813 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Resend viewport on render target change.  The viewport is reset upon SetRenderTarget so make sure to do SetViewport again.  BUG= TEST=  Review URL: http://codereview.appspot.com/5334048  git-svn-id: https://angleproject.googlecode.com/svn/trunk@812 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented new restrictions on nesting of structs in WebGL shaders. Added previously missing check for embedded structs; even though these attempts would be caught by an underlying GLSL compiler the shader validator should not let them through.  BUG=http://code.google.com/p/angleproject/issues/detail?id=235 TEST=WebGL conformance tests Review URL: http://codereview.appspot.com/5327046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@809 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix compilation due to merge issue.  Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@808 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement glFinish using event queries.  ANGLEBUG=232 TRAC #18650 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@807 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Avoid repeated getDevice() calls when applying uniforms.  TRAC #18399 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@806 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminate getDisplay() and getDevice() calls within the Context.  TRAC #18399 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@805 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Limit copied uniform and vertex attribute names to the implicit size of the buffers passed in. Increase the size of the buffer the client will allocate for mapped names to be equal to the maximum token length.  BUG=http://code.google.com/p/angleproject/issues/detail?id=234 TEST=WebGL conformance test to be checked in soon Review URL: http://codereview.appspot.com/5306063  git-svn-id: https://angleproject.googlecode.com/svn/trunk@804 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Checked in change that should have been in r801. Review URL: http://codereview.appspot.com/5318051  git-svn-id: https://angleproject.googlecode.com/svn/trunk@803 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Issue 220 - let mCurrentValueOffsets be an array of size_t's to fix a 64bit compilation error    git-svn-id: https://angleproject.googlecode.com/svn/trunk@802 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Allowed translator_hlsl and glsl to be built as shared libs on windows.  The problem was gyp was out-of-date (I rolled it to 1080) and ShaderLang.cpp exports were not being exported because it was in translator_common which is a static lib.  I tested shared library and static library builds in debug and release and also the checked in ANGLE.sln build. See original attempt: http://codereview.appspot.com/5305052/. Review URL: http://codereview.appspot.com/5305053  git-svn-id: https://angleproject.googlecode.com/svn/trunk@801 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Avoid unnecessarily copying uniforms  Transpose and expand matrices and float vectors when copied on setUniform (and getUniform) to avoid allocating an array and doing that on applyUniform. Then use straight D3D calls not D3DX to possibly avoid another copy. Gets NaCl donuts test from 19->25 fps.  BUG= TEST=webgl conformance tests  Review URL: http://codereview.appspot.com/5229056  git-svn-id: https://angleproject.googlecode.com/svn/trunk@800 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix contribution  git-svn-id: https://angleproject.googlecode.com/svn/trunk@799 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
VC11 fails to build angle because oppl_allocator::operator= does not exist  ANGLEBUG=229 Signed-off-by: Nicolas Capens Author: Ehsan Akhgari  git-svn-id: https://angleproject.googlecode.com/svn/trunk@798 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix for bogus "Bad aggregation op" error when dumping intermediate tree  Bug=228 Author: Mark Callow  git-svn-id: https://angleproject.googlecode.com/svn/trunk@797 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add token to ANGLE_software_display extension  git-svn-id: https://angleproject.googlecode.com/svn/trunk@796 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Avoid iterating over unused samplers.  Keep track of the maximum used sampler to avoid expensive iterations in applyTextures and validateSamplers.  BUG= TEST=webgl conformance tests  Review URL: http://codereview.appspot.com/5246061  git-svn-id: https://angleproject.googlecode.com/svn/trunk@795 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Cache currently-bound draw buffer.  Avoids a hash table lookup  BUG= TEST=webgl conformance tests  Review URL: http://codereview.appspot.com/5261042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@794 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't reupload DX uniforms unless necessary  Makes Donuts NaCl test go from 14->16 fps.  BUG= TEST=webgl conformance tests  Review URL: http://codereview.appspot.com/5233056  git-svn-id: https://angleproject.googlecode.com/svn/trunk@793 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Iterate directly over uniforms when applying them  Directly iterate over uniforms not over uniform locations so we don't waste time looking at locations in the middle of arrays. Gets about 1 fps on a NaCl benchmark.  BUG= TEST=webgl conformance tests  Review URL: http://codereview.appspot.com/5210042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@792 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update contributor list  git-svn-id: https://angleproject.googlecode.com/svn/trunk@791 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix compiler warnings in translator.cpp  Bug=227 Author: Mark Callow  git-svn-id: https://angleproject.googlecode.com/svn/trunk@790 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix essl_to_hlsl project configurations  Bug=226 Author: Mark Callow  git-svn-id: https://angleproject.googlecode.com/svn/trunk@789 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix link errors caused by static use of perf related functions even when ANGLE_DISABLE_PERF is defined.  Bug=225 Author: Mark Callow  git-svn-id: https://angleproject.googlecode.com/svn/trunk@788 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Improve performance of applyRenderTarget and applyTextures  Get rid of unnecessary GetSurfaceLevel/Release calls move invariants out of the applyTextures loop and fix the if in getSemanticIndex so we can avoid calling getMaximumCombinedTextureImageUnits. Gets donuts NaCl demo from 14->16 fps.  BUG= TEST=webgl conformance tests  Review URL: http://codereview.appspot.com/5248057  git-svn-id: https://angleproject.googlecode.com/svn/trunk@787 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Cache the current program pointer  Hash table lookups are somewhat expensive so cache a pointer to the current program for on a context. This gains about 3 fps (from 58) on a Native Client demo.  BUG= TEST=webgl conformance tests  Review URL: http://codereview.appspot.com/5206042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@786 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Assign proper enum to GL_TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE  Trac #18416 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@785 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Support multiple nested ternary operators per statement  TRAC #18382 ANGLEBUG=203208 Signed-off-by: Daniel Koch Author: Nicolas Capens  - by incrementing the temporary index adding 1 for every nesting level and rewinding it after each traverse. Also fixed multiple ternary operator unfolding for loops.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@784 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use a different name for ternary operator unfolding temporaries to avoid clashes with T x = x handling.  TRAC #18382 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@783 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Correct glFramebufferRenderbuffer behavior for renderbuffer = 0.  TRAC #18388 ANGLEBUG=211 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@782 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't unlink when detaching shaders.  TRAC #18385 ANGLEBUG=221 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@781 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add an extension for querying translated HLSL shader source. Review URL: http://codereview.appspot.com/5149046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@780 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix the version number. Review URL: http://codereview.appspot.com/5132054  git-svn-id: https://angleproject.googlecode.com/svn/trunk@774 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix memory corruption in ANGLE shader translator.  The bug is that within each compilation cycle all the memory allocated through T* types are freed to be reused.  So if certain information is meant to outlive the cycle it should use the std type instead of the T* type:  1) emulated function vector 2) mapped long names map  BUG=none TEST=webgl conformance test conformance/glsl/glsl-feature-mod-gentype.html does not crash in Win Debug. Review URL: http://codereview.appspot.com/5137047  git-svn-id: https://angleproject.googlecode.com/svn/trunk@773 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Reset mUnmodifiedDataUse after bufferSubData  Without this enough draws from a buffer modified only with bufferSubData will cause it to switch become static.  BUG= TEST=  Review URL: http://codereview.appspot.com/5123042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@769 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Sort EGL extension string  Trac #18320 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@768 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Enumerate GL extensions in sorted order  Trac #18320 Sort order is OES EXT vendor  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@767 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Create structure definitions for structures in a return statement.  TRAC #18319 ANGLEBUG=185 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@766 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix single statement loops.  TRAC #18301 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@765 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Disable FLIPEX when the formats are not 32-bit and when swap interval is 0.  TRAC #18108 ANGLEBUG=209 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@764 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Validate the stride of static buffer attributes.  TRAC #18268 ANGLEBUG=213 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@763 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Save stream source 0 in stateblock when doing masked color clear.  BUG=214 TEST=webgl conformance tests  Review URL: http://codereview.appspot.com/5085046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@762 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Optimize string comparisons by avoiding the creation of temporary substrings.  TRAC #16567 Bug=136 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@761 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Decorate arrays uniforms with "ar_" to identify arrays of size 1.  TRAC #16567 Bug=136 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@760 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Optimize uniform handling by storing both decorated and undecorated names. Use a consistent naming scheme to clarify decorated/undecorated name usage.  TRAC #16567 Bug=136 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@759 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Further work on the function emulation.  This is to work around driver bugs.  We added more functions and removed some unnecessary ones.  Remove the function group because we have flags for each function now.  Use more macros instead of functions.  Don't emit global precision because that will affect all later code.  ANGLEBUG=196 TEST=build and test on Mac ATI/NVIDIA fixes the failing webgl glsl conformance tests. Review URL: http://codereview.appspot.com/5011053  git-svn-id: https://angleproject.googlecode.com/svn/trunk@754 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Recognize ANDROID as a POSIX OS BUG=207 Review URL: http://codereview.appspot.com/5016050  git-svn-id: https://angleproject.googlecode.com/svn/trunk@753 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Complete implementation for handling #define directive. Review URL: http://codereview.appspot.com/4963062  git-svn-id: https://angleproject.googlecode.com/svn/trunk@752 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove path info without GetCurrentDirectory  Bug=162 TRAC #16902 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@751 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix resetting of non-existing device  TRAC #18139 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@750 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Avoid an unnecessary MFC header dependency.  Bug=180 TRAC #18128 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@749 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add/remove more functions to use shims.  Remove normalize and add cos instead to avoid a crash in Mac with ATI cards (angle bug 193 202).  Also add atan and mod as it's also buggy on Mac/Win with NVIDIA cards.  Also trying to minimize emulated functions by adding masks for fragment/vertex shaders.  ANGLEBUG=196 Review URL: http://codereview.appspot.com/4992047  git-svn-id: https://angleproject.googlecode.com/svn/trunk@748 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Updating ANGLE version in version.h  git-svn-id: https://angleproject.googlecode.com/svn/trunk@747 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adding code to try and reset the device if eglCreateWindowSurface and eglCreateSurface are called while the device is reported as lost.  Currently only eglCreateContext attempts to reset the device. This is a short term fix until the whole device lost issue can be revisited.  One of the issues here is that if any of these egl entry points are called while the device is lost (e.g. while the screen saver is on in XP) ANGLE will spin until the device comes back. Review URL: http://codereview.appspot.com/4961070  git-svn-id: https://angleproject.googlecode.com/svn/trunk@746 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix extension behavior in shader validation.  If an extension is not specified it is disabled by default thus a shader should fail compiling if features from that extension are used.  ANGLEBUG=204 TEST=webgl conformance/extensions/oes-standard-derivatives.html Review URL: http://codereview.appspot.com/4974071  git-svn-id: https://angleproject.googlecode.com/svn/trunk@745 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Avoid recreating constant vertex buffers unnecessarily.  To avoid continually recreating constant vertex buffers instead use streaming buffers to hold that data.  BUG= TEST=  Review URL: http://codereview.appspot.com/4437072  git-svn-id: https://angleproject.googlecode.com/svn/trunk@744 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Avoid resending lots of D3D state  This change uses trivial caching to determines whether to reset shaders the viewport and the currently set vertex declaration. It also caches the render target desc to avoid rereading that. Serial numbers are added to vertex and index buffers so resending those can be avoided.  These changes can give a big speedup (30% has been measured) on simple content particularly when used directly or through pepper/native client.  BUG= TEST=bunch of pages using webgl  Review URL: http://codereview.appspot.com/4964057  git-svn-id: https://angleproject.googlecode.com/svn/trunk@743 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use std::map to find correct index range  Instead of iterating through every range to find the one we're looking for instead put them all in a map and find them with that. This helps performance with index buffers that contain a bunch of different ranges.  BUG= TEST=  Review URL: http://codereview.appspot.com/4974051  git-svn-id: https://angleproject.googlecode.com/svn/trunk@742 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Preparation for macro expansion. Review URL: http://codereview.appspot.com/4919045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@741 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix a bug introduced in r738.  ANGLEBUG=201 TEST=chrome gpu bots green no complaint from Firefox/Benoit Review URL: http://codereview.appspot.com/4956050  git-svn-id: https://angleproject.googlecode.com/svn/trunk@740 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Issue 199: invalid assertion in Surface.cpp makes debug browser crash on conformance test drawingbuffer-static-canvas-test.html  This patch fixes assertions that were wrongly asserting that only OOM errors could occur when allocating a D3D texture/surface. The drawingbuffer-static-canvas-test.html test tries a 32768x150 size and that fails because of the too large width without being OOM.    git-svn-id: https://angleproject.googlecode.com/svn/trunk@739 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Emulate certain buil-in functions to work around driver bugs.  This is implemented by adding a new compile option SH_EMULATE_BUILT_IN_FUNCTIONS.  The emulated functions are names as webgl_originalName_emu so there will never be naming conflicts.  At the moment only three functions are emulated: normalize abs sign.  Also the compile option will emulate all three.  However the mechanism to emulate only a selected subset is also imeplemented.  It can be turned on easily.  ANGLEBUG=196 TEST=with this option the failed test with abs.frag passes. Review URL: http://codereview.appspot.com/4916043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@738 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Modified Token class to store various types of data. Added debug code to dump token to an output stream. Review URL: http://codereview.appspot.com/4920041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@737 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix version.  BUG=none TEST=none Review URL: http://codereview.appspot.com/4898057  git-svn-id: https://angleproject.googlecode.com/svn/trunk@736 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix the standalone translator_common.vcproj  BUG=none TEST=build fine with that .vcproj TBR=daniel@transgaming.com Review URL: http://codereview.appspot.com/4902049  git-svn-id: https://angleproject.googlecode.com/svn/trunk@735 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add an compile option to unroll for-loops with integer indices.  ANGLEBUG=193 TEST=with this option for-loops with integer indices will be unrolled. Review URL: http://codereview.appspot.com/4899047  git-svn-id: https://angleproject.googlecode.com/svn/trunk@734 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement more detailed GetString(GL_RENDERER)  Trac #17815 Issue=161 Signed-off-by: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@733 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Output the precision for the return type in function declarations.  Tested with GLSL ES conformance suite (which doesn't test this) and the WebGL conformance suite which now contains tests to ensure that these constructs compile correctly.  Chromium bug: http://crbug.com/86952 Review URL: http://codereview.appspot.com/4897045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@731 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
General cleanup of compiler directory and ParseHelper. Review URL: http://codereview.appspot.com/4801084  git-svn-id: https://angleproject.googlecode.com/svn/trunk@730 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix the revision in version.h.  Revision r727 didn't set the number correctly so r728 got it wrong too.  BUG=none TEST=none Review URL: http://codereview.appspot.com/4879044  git-svn-id: https://angleproject.googlecode.com/svn/trunk@729 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add an option to support for GL_OES_EGL_image_external.  Comes with this extension is the new sampler type samplerExternalOES.  ANGLEBUG=175 TEST=compile the attached shader file Review URL: http://codereview.appspot.com/4809076  git-svn-id: https://angleproject.googlecode.com/svn/trunk@728 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed compiler/unistd.h reference from build_angle.gyp. Review URL: http://codereview.appspot.com/4844062  git-svn-id: https://angleproject.googlecode.com/svn/trunk@725 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
bump version.h  git-svn-id: https://angleproject.googlecode.com/svn/trunk@724 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
One more DXT bug Review URL: http://codereview.appspot.com/4844057  git-svn-id: https://angleproject.googlecode.com/svn/trunk@723 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix bugs in DXT support Review URL: http://codereview.appspot.com/4857045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@722 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for DXT3 and DXT5  TEST=none BUG=none Review URL: http://codereview.appspot.com/4809068  git-svn-id: https://angleproject.googlecode.com/svn/trunk@721 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Release cube map surfaces on successful conversion (avoiding a memory leak).  TRAC #17749 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@720 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Catch all CreateOffscreenPlainSurface errors in readPixels  Issue=194 TRAC #17748 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@719 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Beginnings of a new preprocessor. Review URL: http://codereview.appspot.com/4830050  git-svn-id: https://angleproject.googlecode.com/svn/trunk@718 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove unnecessary Visit function overloading.  BUG=none TEST=build ok run as before Review URL: http://codereview.appspot.com/4814063  git-svn-id: https://angleproject.googlecode.com/svn/trunk@715 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
update version number  git-svn-id: https://angleproject.googlecode.com/svn/trunk@714 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed standalone visual studio projects by adding DetectRecursion files.  Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@713 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix Static buffer invalidation regression  Bug=139 Trac=#15143 Signed-off-by: Daniel Koch Author: Michael Braithwaite  git-svn-id: https://angleproject.googlecode.com/svn/trunk@712 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Detect function recursion and reject a shader if detected.  ANGLEBUG=191 TEST=shaders with function recursion are rejected. Review URL: http://codereview.appspot.com/4808061  git-svn-id: https://angleproject.googlecode.com/svn/trunk@711 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add Wayland typedefs to eglplatform.h  Issue=188 Author: Daniel Nicoara  git-svn-id: https://angleproject.googlecode.com/svn/trunk@709 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refresh EGL and GLES2 headers from Khronos registry  Based on SVN r15167  git-svn-id: https://angleproject.googlecode.com/svn/trunk@708 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Win64: fix return value from lookupAttribute  Issue=190 Author: Makoto Kato  git-svn-id: https://angleproject.googlecode.com/svn/trunk@707 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add extension to create software device.  Add an extension so that users can receive a device that renders in software. Currently this is done by loading a swiftshader dll.  BUG= TEST=  Review URL: http://codereview.appspot.com/4631093  git-svn-id: https://angleproject.googlecode.com/svn/trunk@705 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update version information  git-svn-id: https://angleproject.googlecode.com/svn/trunk@704 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Changed two assertions to explicit tests and added an error code to those checked during ReadPixels. These changes are needed to avoid having ANGLE assert in debug builds when running WebGL test cases which provoke a GPU reset.  BUG=none TEST=slow-shader-example and lots-of-polys-example in WebGL test suite Review URL: http://codereview.appspot.com/4684042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@703 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix an overflow issue when a static buffer is invalidated.  Issue=104139179 TRAC #15143 Signed-off-by: Daniel Koch Author: Nicolas Capens Original-patch-by: Yore Apex  git-svn-id: https://angleproject.googlecode.com/svn/trunk@702 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix DelayLoadDLLs deps for dwmapi in release builds  Issue=177  git-svn-id: https://angleproject.googlecode.com/svn/trunk@701 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix GrowAtomTable() on out-of-memory.  Issue=173 Signed-off-by: Daniel Koch Author: Benoit Jacob  git-svn-id: https://angleproject.googlecode.com/svn/trunk@699 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add x86-64 project settings.  Bug=55 TRAC #15606 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@698 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix 64-bit support.  Bug=55 TRAC #15606 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@697 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Map long for-loop control variable names in shaders.  Look at TIntermLoop::traverse() in IntermTraverse.cpp the control init part is not handled explicitly there (unlike the other two parts).  It is expected hat visitLoop will cover the init part.  The bug in the MapLongVariableNames is that the visitLoop doesn't do anything.  This CL fixes it.  BUG=171 TEST=conformance/glsl-long-variable-names.html passing. Review URL: http://codereview.appspot.com/4644045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@696 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Always emit precision in shader variable declarations.  After the shader compile (and before code output) the precision scopes are already lost.  In order to correctly output precisions we need to emit precision in each variable declaration therefore each variable should have its precision set.  This CL fixes the bugs that the precisions are lost for variables using default precsions and struct fields.  Also this CL fixes a bug in the grammar: constructors are not type_specifier and they shouldn't have precisions.  BUG=168 TEST=webgl conformance tests gles2 conformance tests. Review URL: http://codereview.appspot.com/4617041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@695 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Emit precisions in function arguments and return type for GLES2.  BUG=none TEST=Translator with GLES2 output backend emit precisions for function arguments and return type. Review URL: http://codereview.appspot.com/4643042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@694 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Attempt to ensure pipeline flush on rendertarget change  Some ATI cards appear not to flush the pipeline correctly causing textures not to pick up newly-drawn contexts so do an extra no-op draw when necessary.  BUG=169 TEST=chromium on hulu.com  Review URL: http://codereview.appspot.com/4576051  git-svn-id: https://angleproject.googlecode.com/svn/trunk@693 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added .rc files to gyp file so the version number appears in the resource section for gyp builds. Review URL: http://codereview.appspot.com/4568080  git-svn-id: https://angleproject.googlecode.com/svn/trunk@692 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Set max vertex correctly when drawing closing line  We were setting the max vertex way too low causing AMD cards to draw the line with an incorrect vertex.  BUG= TEST=enable "Composited render layer borders" in chromium  Review URL: http://codereview.appspot.com/4588042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@691 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
update revision  git-svn-id: https://angleproject.googlecode.com/svn/trunk@689 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Correct usage of GetVersion() windows calls.  Review:  http://codereview.appspot.com/4579049  git-svn-id: https://angleproject.googlecode.com/svn/trunk@688 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement ES2 backend for Angle translator.  With this CL we have the option to select a code output backend: GLSL GLSL ES or HLSL.  Note that we always emit the highest supported float precision for fragment shader due to anglebug 168.  Although this is a temporary solution it's not against GLSL ES spec because it's ok for implementation to upgrade precision.  Tested with WebGL conformance test suite GLES2 conformance test suite (only failed 2/1198) and a few webgl demos including worlds of webgl aquarium etc.  anglebug=81 test=translator emitting correct GLSL ES code when ES2 backend is selected. Review URL: http://codereview.appspot.com/4550129  git-svn-id: https://angleproject.googlecode.com/svn/trunk@687 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix crlf newlines in surface.cpp TBR=apatrick@chromium.org  git-svn-id: https://angleproject.googlecode.com/svn/trunk@686 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Revert copyImage changes from r682 as they cause regressions on some webpages  git-svn-id: https://angleproject.googlecode.com/svn/trunk@684 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Recommit r668 which got undone accidentally by r673.  Review URL: http://codereview.appspot.com/4589043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@683 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
No need to update texture before overwriting it with CopyImage.  Issue=163 TRAC #17019 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@682 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix multi-sample state management.  Issue=160 TRAC #16817 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@681 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add missing DWM libraries to Release project.  Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@680 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Purge associated render buffer object when texture is resized.  Similar fix for cube maps to follow. Review URL: http://codereview.appspot.com/4532124  git-svn-id: https://angleproject.googlecode.com/svn/trunk@678 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Do not set a WNDPROC on a window created by another thread.  It turns out SetWindowLong succeeds for other threads in the same process but we do not want the WNDPROC to be called from threads other than the thread on which EGL is running on. This was one of the reasons --in-process-gpu was not working with ANGLE in Chrome. Review URL: http://codereview.appspot.com/4576045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@677 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use DwmAPI if available to minimize queueing of presents.  Review URL: http://codereview.appspot.com/4559065  git-svn-id: https://angleproject.googlecode.com/svn/trunk@673 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Made it possible to turn off D3D9Ex support with a command-line compiler option. The "Debug This Pixel..." feature in PIX often fails when using the D3D9Ex interfaces.  In order to get debug pixel to work on a Vista/Win 7 machine define "ANGLE_ENABLE_D3D9EX=0" in your project file.  Review URL: http://codereview.appspot.com/4526106  git-svn-id: https://angleproject.googlecode.com/svn/trunk@672 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Handle additional lost device error codes that may be returned when using IDirect3DDevice9Ex.  Review URL: http://codereview.appspot.com/4529113  git-svn-id: https://angleproject.googlecode.com/svn/trunk@671 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update and alphabetize contributors list. Review URL: http://codereview.appspot.com/4574041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@670 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update version number for recent commits  git-svn-id: https://angleproject.googlecode.com/svn/trunk@669 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Disable use of FlipEx for problematic use cases.  It seems that DWM will when given an HWND that has an associated FlipEX swap chain stretch the contents of the HWND to fill the new window IF you don't issue draw calls to that HWND before the WM_PAINT returns. This leads to horrendous sizing artifacts.  For Chromium this is a show stopper.  But FlipEx is definitely a good thing for regular single process applications.  So is there a clean way to conditionally disable FlipEX for these problem cases? The heuristic in this patch basically says "if your hwnd is not in-process then you're probably not painting in its HWND so don't sue FlipEX."  This catches the Chromium use case. There is still the possibility of a regular single-process EGL application that tries to draw outside WM_PAINT that would experience sizing artefacts. But maybe that's OK.  Anyways I'm not married to this technique. Just throwing something out there to start the discussion. :)  Review URL: http://codereview.appspot.com/4536102  git-svn-id: https://angleproject.googlecode.com/svn/trunk@668 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Insert a new-line ('\n') before the #line directive in HLSL source. Without this sometimes the #line directive shows up at the end of the previous line of shader source.  This was causing syntax errors when trying to compile shaders during a PIX session.  Review URL: http://codereview.appspot.com/4561059  git-svn-id: https://angleproject.googlecode.com/svn/trunk@667 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Generate an error in the parser for unsized array declarations.  BUG=164 TEST=none Review URL: http://codereview.appspot.com/4539101  git-svn-id: https://angleproject.googlecode.com/svn/trunk@666 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Redid gyp changes in last commit to support debugging of samples on Linux. Fixed bug in translator sample where it was confusing arguments and filenames on POSIX platforms. Review URL: http://codereview.appspot.com/4532108  git-svn-id: https://angleproject.googlecode.com/svn/trunk@665 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added missing depth argument to GYP which causes the top-level Makefile to be generated into the correct directory on Linux. Added missing library for clients of translator (the samples in particular).  Built all ANGLE targets on Linux and Windows to test these changes.  BUG=none TEST=none Review URL: http://codereview.appspot.com/4556072  git-svn-id: https://angleproject.googlecode.com/svn/trunk@664 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove path from D3DCompiler warning messages  Issue=162 Trac #16209 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@662 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented OES_texture_npot support.  TRAC #16871 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@661 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix the bug that long varying varibales are mapped into different names in fragment/vertex shaders.  ANGLEBUG=144 TEST=the same long varying variable name in fragment/vertex shaders map to the same shortened name if using the same translator. Review URL: http://codereview.appspot.com/4547063  git-svn-id: https://angleproject.googlecode.com/svn/trunk@660 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix version error from r658. Review URL: http://codereview.appspot.com/4524071  git-svn-id: https://angleproject.googlecode.com/svn/trunk@659 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add long name mapping option to the translator test. Review URL: http://codereview.appspot.com/4529091  git-svn-id: https://angleproject.googlecode.com/svn/trunk@658 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix lost context recovery for Windows XP.  Issue=138 TRAC #16271 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@657 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Revert pending surface destruction (part of revision 632). TRAC #16271 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@656 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Only use D3DSWAPEFFECT_FLIPEX on D3D9Ex devices. TRAC #16271 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@655 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use D3DSWAPEFFECT_FLIPEX on Windows 7.  Reduces frame rate jitters on Windows 7 reported in crbug.com/82925 Review URL: http://codereview.appspot.com/4517096  git-svn-id: https://angleproject.googlecode.com/svn/trunk@654 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add missing newlines to source files  Issue=154  git-svn-id: https://angleproject.googlecode.com/svn/trunk@653 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Improve robustness of Context::finish and flush  Trac #16690 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@652 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix the order of the error() parameters in Surface.cpp and advertise EGL_ANGLE_d3d_share_handle_client_buffer extension  Trac #16711  Also rename the extension file to match the extension name  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@651 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for eglCreatePbufferFromClientBuffer taking as input a D3D share handle corresponding to the enum EGL_D3D_TEXTURE_2D_SHARE_HANDLE_ANGLE. No spec as of yet but it does the obvious thing.  BUG=129 TEST=  Review URL: http://codereview.appspot.com/4325048  git-svn-id: https://angleproject.googlecode.com/svn/trunk@650 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use SSE2 to swizzle RGBA to BGRA  Using SSE2 can drastically reduce the amount of time it takes to do glTexImage2D. I've also added a plain-C path that's much faster than the one that was there before.  BUG=151 TEST=  Review URL: http://codereview.appspot.com/4465052  git-svn-id: https://angleproject.googlecode.com/svn/trunk@649 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Cache result of D3DPERF_GetStatus.  I profiled the WebGL acquarium with AMD CodeAnalyst and it turns out this function got a lot of hits. Top 10 before change:  CS:EIP     	Symbol + Offset                                                              	64-bit 	Timer samples 	 0x62a87260 	CBatchFilterI::ProcessBatch                                                  	       	13.41         	 0x62a171f1 	D3DPERF_GetStatus                                                            	       	6.04          	 0x629ce831 	CD3DBase::SetVertexShaderConstantF_FP                                        	       	5.12          	 0x62a88bea 	CBatchFilterI::GetBatchBufferPointer<_LH_SETPIXELSHADERCONSTIMM_TOKEN_SMALL> 	       	4.61          	 0x6298060b 	UpdateViewportCache                                                          	       	4.2           	 0x6298da3a 	CD3DBase::UpdateTextures                                                     	       	3.58          	 0x6298db6b 	CD3DDDIDX10::SetTexture                                                      	       	2.76          	 0x6298df1d 	CD3DDDIDX10::InsertStreamSource                                              	       	2.46          	 0x629d1c1a 	CD3DBase::SetPixelShaderConstantF_FP                                         	       	2.25          	 0x6297efc4 	CD3DHal::SetSamplerState_FP                                                  	       	2.05          	  10 functions 186 instructions Total: 454 samples 46.47% of shown samples 2.51% of total session samples   And after:  CS:EIP     	Symbol + Offset                                                              	64-bit 	Timer samples 	 0x69317260 	CBatchFilterI::ProcessBatch                                                  	       	13.87         	 0x69318bea 	CBatchFilterI::GetBatchBufferPointer<_LH_SETPIXELSHADERCONSTIMM_TOKEN_SMALL> 	       	5.84          	 0x6921060b 	UpdateViewportCache                                                          	       	5.29          	 0x6925e831 	CD3DBase::SetVertexShaderConstantF_FP                                        	       	4.93          	 0x6921da3a 	CD3DBase::UpdateTextures                                                     	       	4.38          	 0x6921e034 	CD3DBase::SetStreamSource_FP                                                 	       	3.65          	 0x69261c1a 	CD3DBase::SetPixelShaderConstantF_FP                                         	       	3.65          	 0x69227651 	CD3DBase::DrawIndexedPrimitive                                               	       	2.74          	 0x6920efc4 	CD3DHal::SetSamplerState_FP                                                  	       	2.37          	 0x6925e9f7 	CD3DBase::SetVertexShaderConstantIntF                                        	       	2.37          	  10 functions 152 instructions Total: 269 samples 49.09% of shown samples 0.80% of total session samples   UpdateViewportCache looks like it might be low hanging fruit as well. Review URL: http://codereview.appspot.com/4535049  git-svn-id: https://angleproject.googlecode.com/svn/trunk@648 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix gl_FragCoord.  Landing patch from this Chromium issue:  http://code.google.com/p/chromium/issues/detail?id=82166 Review URL: http://codereview.appspot.com/4528055  git-svn-id: https://angleproject.googlecode.com/svn/trunk@647 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update contributors list  git-svn-id: https://angleproject.googlecode.com/svn/trunk@646 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix compilation warnings.  Issue=95 TRAC #16568 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@645 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Enable vertex texture fetch support.  Issue=95 TRAC #16568 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@644 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Comment some (vertex) texture lookup functionality.  Issue=95 TRAC #16568 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@643 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Validate the sampler uniform against the number of (combined) texture image units.  Issue=95 TRAC #16568 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@642 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Validate shaders so they don't exceed the texture unit counts.  Issue=95 TRAC #16568 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@641 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Correct the sizes of the (combined) texture unit arrays for VTF.  Issue=95 TRAC #16568 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@640 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Apply vertex textures and sampler states to the D3D9 device.  Issue=95 TRAC #16568 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@639 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Rename SamplerType to TextureType (refactoring).  Issue=95 TRAC #16568 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@638 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Report the VTF texture unit limits.  Issue=95 TRAC #16568 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@637 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Detect support for vertex shader texture lookups.  Issue=95 TRAC #16568 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@636 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Translate vertex texture lookup functions.  Issue=95 TRAC #16568 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@635 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix depth test state management.  TRAC #16655 Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@634 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix for issue 150 - HandleAllocator asserts on framebuffer 0 release  Issue=150 Signed-off-by: apatrick  git-svn-id: https://angleproject.googlecode.com/svn/trunk@633 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented semantics for eglDestroySurface when surface is current on thread.  The spec has this to say.  " All resources associated with surface which were allocated by EGL are marked for deletion as soon as possible. If surface is current to any thread (see section 3.7.3) resources are not actually released while the surface remains current. Future references to surface remain valid only so long as it is current; it will be destroyed and all future references to it will become invalid as soon as any otherwise valid eglMakeCurrent call is made from the thread it is bound to." Review URL: http://codereview.appspot.com/4449064  git-svn-id: https://angleproject.googlecode.com/svn/trunk@632 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Validate cube texsubimage based on current face  Apps can load cube faces in an arbitrary order so validating texsubimage based on the format of only the first face won't work.  BUG=149 TEST=  Review URL: http://codereview.appspot.com/4445085  git-svn-id: https://angleproject.googlecode.com/svn/trunk@629 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move attrib-list handling into Display  Move the handling of attrib-lists in eglCreatePbufferSurface and eglCreateWindowList into methods in Display so we can keep libEGL.cpp as a thin layer.  BUG= TEST=  Review URL: http://codereview.appspot.com/4453051  git-svn-id: https://angleproject.googlecode.com/svn/trunk@628 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adding ANGLE_timer_query draft extension spec.  Issue=142 Signed-off-by: Daniel Koch   git-svn-id: https://angleproject.googlecode.com/svn/trunk@627 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix compilation errors in translator.cpp. Review URL: http://codereview.appspot.com/4445073  git-svn-id: https://angleproject.googlecode.com/svn/trunk@626 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't constantly recreate index buffers.  Recreating index buffers for closing loops can take a long time so use a streaming index buffer instead.  BUG= TEST=  Review URL: http://codereview.appspot.com/4438080  git-svn-id: https://angleproject.googlecode.com/svn/trunk@625 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Updating resource types on Context (Framebuffers and Fences) to use hash_map as done to other types in r615.  Issue=148 Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@624 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Unifying resource handle allocation code with an allocator optimized for O(1) allocs/releases.  Issue=143 Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@623 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Handle null pointer produced by vertex buffer lock  Issue=120 TRAC #16558 Signed-off-by: Daniel Koch Author: Nicolas Capens (original patch by Jacob Benoit)  git-svn-id: https://angleproject.googlecode.com/svn/trunk@622 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add MapLongVariableNames files to standalone vcproj  git-svn-id: https://angleproject.googlecode.com/svn/trunk@620 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement shader identifier name mapping.  The name mapping happens when an identifier is longer than 32 characters.  The name mapping is behind a flag so it won't happen by default.  Also functions to query the mapped names are added.  The purpose of this CL is for the drivers that can't handle long names.  For example linux NVIDIA driver can't handle 256 character name whereas WebGL spec requires that.  This CL also fixes the issue that some of the TIntermSymbols' ids are 0s.  ANGLEBUG=144 TEST=test manually with shaders with long identifier names. Review URL: http://codereview.appspot.com/4428058  git-svn-id: https://angleproject.googlecode.com/svn/trunk@619 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use StretchRect to speed up simple blits.  Fixed copy position transformation. TRAC #16494 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@618 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Advertise depthbuffer-less surface configs.  TRAC #16493 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@617 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Heuristically optimize buffer usage.  TRAC #16343 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@616 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use a hash map for faster resource lookups. TRAC #14871 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@615 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Optimized prepareVertexData and protect against NULL pointers.  TRAC #14871 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@614 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move the vertex declaration cache to a helper class.  TRAC #14871 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@613 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminate lookupAttributeMapping.  TRAC #14871 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@612 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Profiling shows that creating and destroying vertex declarations is extremely expensive so we can keep a 16-element cache around to speed that up.  BUG= TEST=JSGameBench  Review URL: http://codereview.appspot.com/4358051  git-svn-id: https://angleproject.googlecode.com/svn/trunk@609 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add ANGLE extension specifications  git-svn-id: https://angleproject.googlecode.com/svn/trunk@608 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Unroll for-loop if sampler array uses loop index as its index.  If inside a for-loop sampler array index is the loop index Mac cg compiler will crash.  This CL unroll the loop in such situation.  The behavior is: 1) If the for-loop index is a float we reject the shader. 2) If it is an integer we unroll the for-loop.  Things that should be done in the future are: 1) Add line number macros. 2) Add a limit to unroll iteration count.  anglebug=94 Review URL: http://codereview.appspot.com/4331048  git-svn-id: https://angleproject.googlecode.com/svn/trunk@606 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix resizing the string buffer.  Issue=117 TRAC #15793 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@605 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for eglBindTexImage and eglReleaseTexImage  With this patch we can bind pbuffers as textures. Once we add support for using a sharing handle to create a pbuffer we can use this to allow us to use it as a texture as well.  BUG=129 TEST=modified Simple_Texture2D works Review URL: http://codereview.appspot.com/4291066/  git-svn-id: https://angleproject.googlecode.com/svn/trunk@604 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use D3DX to copy between renderable texture surfaces.  TRAC #16118 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@598 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Retrieve the D3D texture format per image.  TRAC #16118 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@597 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Consistently use the virtual keyword on virtual overloaded methods. TRAC #16118 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@596 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix Visual C++ linking in stand-alone project TRAC #16118 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@595 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix angle version in version.h  BUG=none TEST=none TBR=apatrick@chromium.org Review URL: http://codereview.appspot.com/4309046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@594 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix a typo in r592.  (I developped on Windows and typed in on Mac and submit).  BUG=135 TEST=build fine  TBR=kbr@chromium.org Review URL: http://codereview.appspot.com/4285066  git-svn-id: https://angleproject.googlecode.com/svn/trunk@593 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
glGetProgramiv(GL_ACTIVE_UNIFORM_MAX_LENGTH) should count an extra 3 if uniform is an array because "[0]" is appended.  BUG=135 TEST=the attached htm in the bug runs ok Review URL: http://codereview.appspot.com/4287077  git-svn-id: https://angleproject.googlecode.com/svn/trunk@592 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Switched to D3D10 shader compiler.  I figured out how to call in to D3DCompiler_xx.dll and still get the ID3DXConstantTable metadata used by ANGLE. There are more optimization levels available with this compiler and the lowest level (0) allows MetaTunnel and MandelBox to compile their shaders quickly. MetaTunnel still does not render correctly unfortunately.  I benchmarked eight of the ShaderToy demos and did not notice any performance regression on an nVidia Quadro FX 380. Intel might be adversely affected. I built ANGLE against D3DCompiler_43.dll while Chrome still ships with 42. I'm not sure if that will make a difference but I'll rev Chrome soon.  I also checked WebGL Aquarium and ran the WebGL conformance tests.  This will also let me roll r590 into Chromium. It turns out the ForceSymbolReferences setting I added to the libGLESv2 target caused the linker to sometimes crash when making changes and the changes between r577 and r590 consistently lead to a crash. libGLESv2 now has a hard dependency on D3DCompiler_xx.dll via the call in Program.cpp and this seems to not make the linker crash. Review URL: http://codereview.appspot.com/4275063  git-svn-id: https://angleproject.googlecode.com/svn/trunk@591 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Track dirty texture parameters and images separately.  TRAC #15703 Issue=86 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@590 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Track texture serials instead of id's.  TRAC #15703 Issue=86 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@589 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Keep track of applied textures and dirty state to minimize D3D calls.  TRAC #15703 Issue=86 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@588 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix checking for floating-point render target texture support.  TRAC #15703 Issue=86 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@587 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Copy texture data of incomplete textures to the image arrays.  TRAC #15703 Issue=86 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@586 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Retrieve current texture properties from the image array to avoid D3D call.  TRAC #15703 Issue=86 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@585 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Retrieve texture width height and type from the top-level image.  TRAC #15703 Issue=86 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@584 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Texture image refactoring.  TRAC #15703 Issue=86 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@583 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove redundant dirtyImageData() check.  TRAC #15703 Issue=86 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@582 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Check image type in texture completeness test.  TRAC #15703 Issue=86 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@581 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
InternalFormat and format are the same.  TRAC #15703 Issue=86 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@580 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix dirty texture state management.  TRAC #15703 Issue=86 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@579 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminate the weak base texture pointer. TRAC #15703 Issue=86 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@578 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed framebuffer-object-attachment WebGL conformance test.  We updated it with WebGL conformance test r14153 to exercise zero-size FBO attachments which failed with ANGLE. The new conformance test passes with OpenGL and Mesa.  See this Chromium bug: http://code.google.com/p/chromium/issues/detail?id=75666  D3D fails if you try to create a zero size depth buffer but OpenGL ES2 allows it. D3D / drivers seem to sometimes crash rather than fail normally though this might just be because some users have enabled the D3D debug runtime and break on error and we're getting the reports.  It was also returning unexpected results when calling GetRenderbufferParameter for parameters that do not apply to a particular buffer. For example RED_SIZE for a zero sized depth buffer should be 0.  Tested by running WebGL conformance test with retail D3D runtime (passes) and debug D3D runtime (passes and does not assert in D3D or ANGLE). Review URL: http://codereview.appspot.com/4284053  git-svn-id: https://angleproject.googlecode.com/svn/trunk@577 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update contributors and version  git-svn-id: https://angleproject.googlecode.com/svn/trunk@576 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix clang warnings in PoolAlloc.cpp  Issue=127 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Part 4 of 5: <http://webkit.org/b/56337> Enable -Werror on ANGLE  Upstream bug: <http://code.google.com/p/angleproject/issues/detail?id=127>  Fixes the following static analyzer warnings:      src/compiler/PoolAlloc.cpp:154:26:{154:24-154:25}{154:28-154:42}: warning: comparison of unsigned expression < 0 is always false [-Wtautological-compare2]          for (size_t x = 0; x < guardBlockSize; x++) {                             ~ ^ ~~~~~~~~~~~~~~     src/compiler/PoolAlloc.cpp:159:55:{159:54-159:56}{160:30-160:34}: warning: conversion specifies type 'unsigned int' but the argument has type 'size_t' (aka 'unsigned long') [-Wformat7]                  sprintf(assertMsg "PoolAlloc: Damage %s %u byte allocation at 0x%p\n"                                                           ~^                                                           %lu     fix-it:"src/compiler/PoolAlloc.cpp":{159:54-159:56}:"%lu"  * src/compiler/PoolAlloc.cpp: (TAllocation::checkGuardBlock): Changed '%u' to '%lu' for size_t variable.  Put for loop inside #ifdef GUARD_BLOCKS/#endif macros to fix tautological-compare warning. (TAllocation::checkAllocList): Added newline to end of file.  Author:    David Kilzer <ddkilzer@apple.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@575 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix clang warnings: Intermediate.cpp: warning: '&&' within '||'  Issue=126 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Part 3 of 5: <http://webkit.org/b/56337> Enable -Werror on ANGLE  Upstream bug: <http://code.google.com/p/angleproject/issues/detail?id=126>  Fixes the following static analyzer warnings:      src/compiler/Intermediate.cpp:1008:55:{1008:17-1008:54}: warning: '&&' within '||' [-Wlogical-op-parentheses2]                  if (left->isMatrix() && right->isVector() ||                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ^     src/compiler/Intermediate.cpp:1008:55: note: place parentheses around the '&&' expression to silence this warning [2]                  if (left->isMatrix() && right->isVector() ||                                                            ^                      (                                    )     fix-it:"src/compiler/Intermediate.cpp":{1008:17-1008:17}:"("     fix-it:"src/compiler/Intermediate.cpp":{1008:54-1008:54}:")"     src/compiler/Intermediate.cpp:1008:55:{1009:17-1009:54}: warning: '&&' within '||' [-Wlogical-op-parentheses2]                  if (left->isMatrix() && right->isVector() ||                                                            ^     src/compiler/Intermediate.cpp:1008:55: note: place parentheses around the '&&' expression to silence this warning [2]                  if (left->isMatrix() && right->isVector() ||                                                            ^     fix-it:"src/compiler/Intermediate.cpp":{1009:17-1009:17}:"("     fix-it:"src/compiler/Intermediate.cpp":{1009:54-1009:54}:")"     src/compiler/Intermediate.cpp:1020:55:{1020:17-1020:54}: warning: '&&' within '||' [-Wlogical-op-parentheses2]                  if (left->isMatrix() && right->isVector() ||                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ^     src/compiler/Intermediate.cpp:1020:55: note: place parentheses around the '&&' expression to silence this warning [2]                  if (left->isMatrix() && right->isVector() ||                                                            ^                      (                                    )     fix-it:"src/compiler/Intermediate.cpp":{1020:17-1020:17}:"("     fix-it:"src/compiler/Intermediate.cpp":{1020:54-1020:54}:")"     src/compiler/Intermediate.cpp:1020:55:{1021:17-1021:54}: warning: '&&' within '||' [-Wlogical-op-parentheses2]                  if (left->isMatrix() && right->isVector() ||                                                            ^     src/compiler/Intermediate.cpp:1020:55: note: place parentheses around the '&&' expression to silence this warning [2]                  if (left->isMatrix() && right->isVector() ||                                                            ^     fix-it:"src/compiler/Intermediate.cpp":{1021:17-1021:17}:"("     fix-it:"src/compiler/Intermediate.cpp":{1021:54-1021:54}:")"  * src/compiler/Intermediate.cpp: (TIntermBinary::promote): Added parnetheses.  Author:    David Kilzer <ddkilzer@apple.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@574 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix clang warning: ParseHelper.cpp:264:13: warning: 8 enumeration values not handled in switch  Issue=125 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Part 2 of 5: <http://webkit.org/b/56337> Enable -Werror on ANGLE  Upstream bug: <http://code.google.com/p/angleproject/issues/detail?id=125>  Fixes the following static analyzer warning:      src/compiler/ParseHelper.cpp:264:13: warning: 8 enumeration values not handled in switch: 'EbtVoid' 'EbtBool' 'EbtGuardSamplerBegin'... [-Wswitch-enum2]          switch( type ){                  ^  * src/compiler/ParseHelper.cpp: (TParseContext::precisionErrorCheck): Added a default case.  Author:    David Kilzer <ddkilzer@apple.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@573 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix clang warning: ConstantUnion.h:56:17: warning: 7 enumeration values not handled in switch  Issue=124  Part 1 of 5: <http://webkit.org/b/56337> Enable -Werror on ANGLE  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Upstream bug: <http://code.google.com/p/angleproject/issues/detail?id=124>  Fixes the following static analyzer warning:      In file included from src/compiler/debug.cpp:14:     In file included from src/compiler/ParseHelper.h:10:     In file included from src/compiler/localintermediate.h:11:     In file included from src/compiler/intermediate.h:21:     src/compiler/ConstantUnion.h:56:17: warning: 7 enumeration values not handled in switch: 'EbtVoid' 'EbtGuardSamplerBegin' 'EbtSampler2D'... [-Wswitch-enum2]              switch (type) {                      ^  * src/compiler/ConstantUnion.h: (ConstantUnion::operator==): Added a default case.  Author:    David Kilzer <ddkilzer@apple.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@572 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
ANGLE depends statically on D3DCompiler_x.dll.  This prevents D3DX9 from loading and unloading the DLL whenever D3DXCompileShader is called. Apart from being slow especially when a debugger is attached it is not possible for ANGLE to load DLLs after the Chrome sandbox has been enabled.  Review URL: http://codereview.appspot.com/4282046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@571 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix NULL dereference for empty constructors. Issue=123 Patch by Jacob Benoit.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@570 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Newlines in multi-line comments don't count as a newline. TRAC #15791 Issue=114 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@569 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Improve debug log formatting. TRAC #15791 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@568 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed a floating-point parsing assert. TRAC #15790 Issue=99112 Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@567 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Avoid division by zero in the preprocessor Trac #15792 Issue=115  Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@566 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Delete geometry folder   git-svn-id: https://angleproject.googlecode.com/svn/trunk@565 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move geometry files. TRAC #15649 Signed-off-by: Daniel Koch  Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@564 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Minor refactoring. TRAC #15551 Signed-off-by: Daniel Koch  Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@563 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added new line after generated HLSL break continue and kill statements.  This is consistent with return statements. It means that when PIX is attached the #line directive lands on a new line.  Review URL: http://codereview.appspot.com/4179054  git-svn-id: https://angleproject.googlecode.com/svn/trunk@562 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix varying packing. TRAC #15550 Issue=111 Fix by Ranger Harke Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@561 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix varying relinking. TRAC #15527 Issue=100 Signed-off-by: Daniel Koch  Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@560 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix invalid compare operation asserts. TRAC #15551 Issue=116 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@559 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Issue=91 -- implement pbuffers in ANGLE; add D3D share handle support  git-svn-id: https://angleproject.googlecode.com/svn/trunk@558 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Check for device lost with CheckDeviceState when using D3D9Ex.  According to the docs TestCooperativeLevel is a no-op with D3D9Ex.  http://msdn.microsoft.com/en-us/library/bb174348(VS.85).aspx  I believe it is safe to ignore the additional return values from CheckDeviceState. Some appear to be to allow optimization when a window is occluded. The new errors seem to be best treated as device lost as we were before. Although if the device is removed (!) I'm not sure what to do. It might also be useful to communicate D3DERR_DEVICEHUNG to Chromium in the future so it can use it as a hint to back off.  Tested that D3D9 and D3D9Ex take the appropriate paths through Display::isDeviceLost.  Bug: http://code.google.com/p/angleproject/issues/detail?id=113  Review URL: http://codereview.appspot.com/4154042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@557 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix anti-aliased clears. TRAC #15445 Issue=82 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@556 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix loop splitting. Trac #15446 Issue=98 Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@555 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
fix pedantic compiler warnings Issue=108  git-svn-id: https://angleproject.googlecode.com/svn/trunk@554 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix FBO/Texture/renderbuffer class hierarchy issues TRAC #14744 Issue=51/52 Delegated format queries to RenderbufferStorage. Eliminated TextureColorbufferProxy by merging it into Colorbuffer. Abstracted texture colorbuffer queries. Moved some conversion functions to the right namespace. Fixed line-endings in Texture.cpp Signed-off-by: Daniel Koch  Author:    Nicolas Capens <nicolas@transgaming.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@553 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Allow variable names with length of up to 256 characters (this is required by WebGL spec). BUG=109 TEST=the 256-character variable test in glsl-conformance.html passes  Review URL: http://codereview.appspot.com/3981050  git-svn-id: https://angleproject.googlecode.com/svn/trunk@552 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed commitRect so it correctly flips the source rectangle and dest point on Y.  Review URL: http://codereview.appspot.com/4047050  git-svn-id: https://angleproject.googlecode.com/svn/trunk@551 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Reject non-ASCII characters in shader source at the preprocessor level.  Review URL: http://codereview.appspot.com/4094047  git-svn-id: https://angleproject.googlecode.com/svn/trunk@545 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Map D3D calls and HLSL shaders back to GLES2 calls and GLSL ES shaders in PIX.  This makes debugging and profiling using PIX a lot more convenient. The top level of events are the GLES calls with their arguments. Those can be expanded to see the D3D calls that were issued for a particular GLES call.  When PIX is attached the shaders are saved out to temporary files and referenced from the translated HLSL shaders via #line directives. This enabled source level debugging of the original GLSL from PIX for pixel and vertex shaders. The HLSL is also saved to a temporary file so that intrinsic functions like texture2D can be stepped into.  It also avoids creating a text file in the current working directory which has continued to be an issue.  I made the dependency on d3d9.dll static again so it can be accessed by GetModuleHandle witihin DllMain.  I added an EVENT macro that issues D3DPERF_BeginEvent and D3DPERF_EndEvent around a C++ block. I replaced TRACE with EVENT for all the entry points.  I removed the tracing of shader source since the source is visible in PIX.  The means by which the filename of the temporary shader file is passed into the shader compiler is a little clunky. I did it that way to avoid changing the function signatures and breaking folks using the translator.  I plan to make the compiler respect #pragma optimize so that optimization can be disabled for debugging purposes. For now it just disables shader optimization in debug builds of ANGLE.   Review URL: http://codereview.appspot.com/3945043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@541 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix issues with preprocessor on very malformed shaders Trac #15236#15237#15238#15239  Error out instead of continued processing when we already know the preprocessor directives are bungled. Generally be more careful about the order in which cpp->elsetracker and cpp->ifdepth are checked/operated on. Validate all accesses of cpp->elsedepth to ensure no out of bounds accesses occur. Also slipped in a few indentation/spacing fixes.  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@540 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added version info resources. TRAC #15181 Signed-off-by: Daniel Koch  Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@539 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Applying patch from pkasting to svn:ignore files generated during the build process.  BUG=none TEST=none TBR=apatrick   git-svn-id: https://angleproject.googlecode.com/svn/trunk@538 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed gl_PointCoord Y coordinate.  I forgot to flip (or rather unflip) the Y coord in r536. Tested particle system sample and ran conformance tests. All conformance tests passed.  Review URL: http://codereview.appspot.com/4093043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@537 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
All surfaces follow D3D Y convention i.e. (0 0) is "top-left" rather than GL's "bottom-left". This eliminates the need to flip the default FBO to the D3D convention using additional blits when presenting and reduces VRAM usage for redundant window sized surfaces.  I took out the gl_Position.y flip from the vertex shader so FBOs are rendered according to D3D conventions.  Texture lookups are flipped on Y to compensate. Cube map +Y and -Y faces are swapped. Y is now flipped in various other places including uploading and reading back texture data from / to system memory functions that take pixel space coordinates winding order for culling the implementation of ddy the calculation of gl_Position and gl_FragCoord in fragment shaders and the flipping of compressed texture tiles. Review URL: http://codereview.appspot.com/3265041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@536 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Build fix needed on certain platforms. Explicitly cast away const.  BUG=none TEST=built within WebKit on Mac OS X in release mode TBR=daniel  Review URL: http://codereview.appspot.com/4043042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@535 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Increase GLSL version to 1.20 if the shader contains any matrix constructor calls taking a matrix as argument; these were reserved in GLSL 1.10. This makes http://sio29.sakura.ne.jp/tmp/webgl/index_eruru.html load correctly once https://bugs.webkit.org/show_bug.cgi?id=52390 is fixed.  BUG=103 TEST=none  Review URL: http://codereview.appspot.com/4034041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@534 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
add glRenderbufferStorageMultisampleANGLE support to glGetProcAddress Trac #15095 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@533 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
BlitFramebuf: reuse local size variables Trac #15095 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@532 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Review: http://codereview.appspot.com/3969041/  Fixed dangling pointers in Surface.  When the surface is reset either because of device lost or a window resize and any of these fail:  CreateDepthStencilSurface CreateTexture  Some subsset of mSwapChain and/or mDepthStencil would be left uninitialized. This seemed to happen frequently on WIndows XP boxes.  Example crash dumps:  Thread 0 *CRASHED* ( EXCEPTION_ACCESS_VIOLATION_READ @ 0xffffffff800f0004 )  0x014f1aac       [libegl.dll     - surface.cpp:479]        egl::Surface::getDepthStencil() 0x1001324c       [libglesv2.dll  - context.cpp:301]        gl::Context::makeCurrent(egl::Display *egl::Surface *) 0x10018c7e       [libglesv2.dll  - main.cpp:85] gl::makeCurrent(gl::Context *egl::Display *egl::Surface *) 0x10017366       [libglesv2.dll  - context.cpp:3524]    glMakeCurrent 0x014f607c       [libegl.dll     - libegl.cpp:884]      eglMakeCurrent  Thread 0 *CRASHED* ( EXCEPTION_ACCESS_VIOLATION_READ @ 0xffffffffe95b5a5d )  0x01131a14       [libegl.dll     - surface.cpp:433]     egl::Surface::swap() 0x01136310       [libegl.dll     - libegl.cpp:1043]     eglSwapBuffers 0x0214ac64       [chrome.dll     - gl_context_egl.cc:240]  gfx::NativeViewEGLContext::SwapBuffers()   git-svn-id: https://angleproject.googlecode.com/svn/trunk@531 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Re-implemented line loop support. TRAC #14870 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@530 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Create dynamic buffers in the default pool. TRAC #14889 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@529 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Optimized non-static usage of static buffers. Validate buffer pointers. TRAC #14889 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@528 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Create buffers in the managed pool on Windows XP. TRAC #14888 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@527 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
rewrite buffers implementation to support static buffers more efficiently Bug=89 Trac #13565  Signed-off-by: Daniel Koch Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@526 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed compile errors that show up when _UNICODE is not defined. Review URL:  http://codereview.appspot.com/3772045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@525 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a compile flag so that writing to the debug log file can be turned off. Review URL: http://codereview.appspot.com/3733043/   git-svn-id: https://angleproject.googlecode.com/svn/trunk@524 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix for loading L/LA images into a native (8/16-bit) D3D surface. Review URL: http://codereview.appspot.com/3805044  git-svn-id: https://angleproject.googlecode.com/svn/trunk@523 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented copying from A1R5G5B5 to L8 and A8L8. Fixed the copying range. TRAC #14885 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@515 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update .gitignore file  git-svn-id: https://angleproject.googlecode.com/svn/trunk@512 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix structure parsing regression. TRAC #14717 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@511 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix support for arrays of sampler uniforms. TRAC #14840 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@510 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix querying active attributes. TRAC #14849 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@509 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix support for arrays of samplers. TRAC #14840 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@507 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix infinite loops in preprocessor when EOF encountered while scanning for newlines. Trac #14837 Issue=42 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@506 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update contributors list  git-svn-id: https://angleproject.googlecode.com/svn/trunk@505 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix memory leak in float literal parsing Issue=93  Contributed by Benoit Jacob  git-svn-id: https://angleproject.googlecode.com/svn/trunk@504 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix infinite loop in eglCreateWindowSurface Issue=90  Contributed by vladimirv  git-svn-id: https://angleproject.googlecode.com/svn/trunk@503 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
fix comparison between signed and unsigned integer expressions in TParseContext::constructorErrorCheck Issue=78  Contributed by timeless  git-svn-id: https://angleproject.googlecode.com/svn/trunk@502 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix TType::TType constructors to initialize members in correct order Issue=77  Contributed by timeless  git-svn-id: https://angleproject.googlecode.com/svn/trunk@501 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix potential sscanf overflows in Shader.cpp Issue=76  Contributed by ddefrostt  git-svn-id: https://angleproject.googlecode.com/svn/trunk@500 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't unsubclass the surface's output window if the window has been destroyed.  Review URL: http://codereview.appspot.com/3357041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@499 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add missing files to the Visual Studio project.  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@498 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Increase the number of fragment uniform vectors. TRAC #14504 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@497 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Increase the number of vertex uniform vectors. TRAC #14504 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@496 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement gl_DepthRange using a single uniform vector. TRAC #14504 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@495 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Increase the number of supported vertex attributes. TRAC #14504 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@494 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Render directly to a render target texture. TRAC #14506 This speeds up surface swapping by avoiding an unnecessary StretchRect from a render target surface to a render target texture (anti-aliased surfaces are unsupported so no resolve is needed). Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@493 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Increase the number of varying vectors to 10 on Shader Model 3.0 devices. TRAC #14503 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@492 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented validation for loop and indexing limitations specified by GLSL ES spec 1.0 Appendix A Section 4 and 5. A couple of things to note: - This CL only validates the "form" of loop and indexing. It does not detect number-of-iterations or out-of-bound access. This will require more involved analysis/heuristics. - I haved combined SH_VALIDATE_CONTROL_FLOW and SH_VALIDATE_INDEXING into one flag - SH_VALIDATE_LOOP_INDEXING. Validating both together is much easier. BUG=48 Review URL: http://codereview.appspot.com/3225041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@491 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
glGenerateMipmap now does not force textures to become render targets.  For textures that are not already render targets use the CPU to filter them and mark them as dirty.  I tested it by modifying the "mip_map_2d" demo to call glGenerateMipmap instead of generating the mipmaps itself. I also used the debugger to force it to take the render target path and verified that it still worked.  We've been having problems with the display being reset when video memory pressure is heavy with one of our demos. This patch made a noticable improvement on Vista but I don't think it will necessarily help on XP.  Review URL: http://codereview.appspot.com/3262041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@490 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved the global-pool-allocator to TCompiler so that all memory allocated by the compiler can be de-allocated. Earlier the global-pool-allocator kept accumulating memory from all compilers (symbol-table in particular). The memory was only de-allocated when gpu-process exited or ShFinalize() was called. This was a problem for Chromium which keeps the GPU process around for the browser session. Now the memory is de-allocated as soon as the compiler is deleted which happens when a tab is closed. BUG=58808 (crbug.com) Review URL: http://codereview.appspot.com/3280041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@489 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix active texture handling. TRAC #14429 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@488 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add an array index to arrays of structures. TRAC #13625 This patch ensures that (member variables of) arrays of structures are listed separately by glGetActiveUniforms(). Their location can also be retrieved individually with glGetUniformLocation() using the array operator. Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@487 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Resize surface on receipt of WM_SIZE to avoid corruption during resize. We hook WM_SIZE using window subclassing.  This is a continuation of http://codereview.appspot.com/3038042/   Review URL: http://codereview.appspot.com/3122041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@486 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed actions for generating parser-lexer now that they have been checked in. Also removed hooks to pull cygwin - it was only required for flex and bison that are not required anymore. If a developer needs to modify grammar files he is expected to install cygwin. Review URL: http://codereview.appspot.com/3177042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@485 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed compile error introduced in r482.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@484 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed skipping over internal uniforms in getActiveUniform. TRAC #14390 Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@483 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Replaced TIntermLoop::testFirst with TIntermLoop::loopType to clearly indicate which type of loop it is. In some cases it is not possble to differentiate between a for-loop and while-loop. BUG=48 Review URL: http://codereview.appspot.com/3123041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@482 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Made GL_RGB textures map to D3DFMT_X8R8G8B8.  I suspect there is a subtle reason why this is the wrong thing to do.  The issue I am trying to address is glBlitFramebufferANGLE generating an error when bliting from a GL_RGB8_OES renderbuffer to a GL_RGB texture bound to the read framebuffer and draw framebuffer respectively. It verifies that both surfaces have the same underlying D3DFMT but GL_RGB8_OES renderbuffers are backed by X8R8G8B8 and GL_RGB textures were previously backed by A8R8G8B8.  Since textures cannot as far as I know be created GL_RGB8_OES it would be useful to have a way to blit from a GL_RGB8_OES renderbuffer to a GL_RGB texture.     Review URL: http://codereview.appspot.com/2822041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@481 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Check that IDirect3DVertexBuffer9 and IDirect3DIndexBuffer9::Lock succeed.  I've been seeing crashes like this on Windows XP:  0x013319aa 	[libglesv2.dll 	- memcpy.asm:188] 	memcpy 0x0130989a 	[libglesv2.dll 	- vertexdatamanager.cpp:164] 	gl::VertexDataManager::preRenderValidate(intintgl::TranslatedAttribute *) 0x01304f66 	[libglesv2.dll 	- context.cpp:1996] 	gl::Context::applyVertexBuffer(unsigned intintintbool *gl::TranslatedIndexData *) 0x013061a7 	[libglesv2.dll 	- context.cpp:2648] 	gl::Context::drawArrays(unsigned intintint) 0x012f7721 	[libglesv2.dll 	- libglesv2.cpp:1741] 	glDrawArrays 0x01c54f1e 	[chrome.dll 	- gles2_cmd_decoder.cc:3179] 	gpu::gles2::GLES2DecoderImpl::DoDrawArrays(unsigned intintint) 0x01c59122 	[chrome.dll 	- gles2_cmd_decoder_autogen.h:640] 	gpu::gles2::GLES2DecoderImpl::HandleDrawArrays(unsigned intgpu::gles2::DrawArrays const &)  Review URL: http://codereview.appspot.com/3043042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@480 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Only initialize through a temporary variable if the same symbol name is used in the initialization expression. TRAC #13627 The previous patch can generate a lot of unnecessary temporary variables. By first checking whether the same symbol name is reused the clutter is reduced to an absolute minimum (typical shaders won't rely on this odd GLSL semantic behavior so the workaround is hardly ever needed). Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@479 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Define new variables after evaluating the initialization expression. TRAC #13627 GLSL allows to write things like "float x = x;" where a new variable x is defined and the value of an existing variable x is assigned. HLSL uses C semantics (the new variable is created before the assignment is evaluated) so we need to convert this to "float t = x x = t;". Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@478 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added API to enforce GLSL limitations mandated by WebGL. BUG=48 Review URL: http://codereview.appspot.com/3005042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@476 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactored glslang grammar files to make: - lexer and parser reentrant - line number handling automatic  Caveats: - The preprocessor is still not thread-safe and full of bugs. I have another not-yet-ready patch to replace the preprocessor. - The grammar files use options that are not supported by the old versions of flex and bison checked into compiler/tools. So I need to check-in the generated lexer-parser along with a shell script to generate them.  Review URL: http://codereview.appspot.com/2992041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@475 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix ternary operator unfolding TRAC #14155 Issue=70 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@474 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed gl_FragCoord emulation for point sprites of size > 1 using VPOS semantic for x and y coordinates rather than previous per-vertex emulation when running on Shader Model 3.  Verified fix in Chromium with test case from bug.  BUG=http://code.google.com/p/angleproject/issues/detail?id=71 TEST=test case from bug TBR=nicolas (LGTM'd by dgkoch)  Review URL: http://codereview.appspot.com/2921041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@473 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Preserve the scissor and viewport rectangles on swap and blit TRAC #14054 The SetRenderTarget calls used in Blit::boxFilter() and Surface::swap() implicitly reset the scissor and viewport rectangles. So we need to ensure that the original rectangles get captured and restored afterwards (the Context only keeps track of explicitly changed state). Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@472 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed null dereference when null passed as attribute list to eglCreateContext.  I tested that the samples still work and that they fail as expected but do not crash if the attribute list argument is null.  Review URL: http://codereview.appspot.com/2725042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@471 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use C locale for atof to ensure using a dot as decimal mark. TRAC #14055 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@470 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed infinite loops and buffer overflow in byte_scan when scanning for integers and floating-point numbers. - The byte_scan and associated functions are not very well written. I tried to clean them as much as possible without re-writing the whole thing. - Replaced lBuildFloatValue function with atof. lBuildFloatValue was returning incorrect value anyway. The only reason it was working so far because we never used that value. BUG=59623(crbug.com) 603333(bugzilla.mozilla.org) Review URL: http://codereview.appspot.com/2655042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@469 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
eglCreateContext checks client version is 2.  I believe we don't support version 1 since we are missing things like the fixed function pipeline.  This is motivated by consistency with other EGL implementations which return a v1 context if the EGL_CONTEXT_CLIENT_VERSION attribute is not specified.   Review URL: http://codereview.appspot.com/2760041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@468 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add missing break statements to Context::getBooleanv  Trac #14114 Reported in Bug=69  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@467 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
We were not reporting anything in the info-log for empty shader. This CL reports "unexpected EOF". BUG=66 Review URL: http://codereview.appspot.com/2619041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@466 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactored ReadFileData() function in the translator sample to fix many issues: - Memory leaks - Made compiling using multiple strings default. This was not getting exercised. - Removed redundant copies of file data - Handled empty files properly which were getting ignored BUG=66 Review URL: http://codereview.appspot.com/2579041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@465 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed stack overflow in CPPextension function. An arbitrary size buffer was being used for extension name. Changed it to use MAX_SYMBOL_NAME_LEN. - Also formalized the values for MAX_SYMBOL_NAME_LEN and MAX_STRING_LEN. They were being used as if there was a confusion whether it included the NULL terminator or not. - Fixed some minor issues with code releated to the usage of MAX_SYMBOL_NAME_LEN and MAX_STRING_LEN. BUG=59625 (crbug.com) Review URL: http://codereview.appspot.com/2585042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@464 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Support copying R5G6B5 to L8. TRAC #13792 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@463 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed an unnecessary call. TRAC #13792 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@462 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented glCopyTex[Sub]Image for non-renderable formats. TRAC #13792 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@461 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Initialize renderbuffer variables. Make serials constant. Removed X1R5G5B5 support. TRAC #13792 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@460 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Validate glCopyTex[Sub]Image source and destination format combinations. TRAC #13792 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@459 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Validate framebuffer attachment formats. TRAC #13792 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@458 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Disallow rendering to L/LA textures. TRAC #13792 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@457 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Create and load L/LA textures. TRAC #13792 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@456 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Detect L8 and A8L8 texture support. TRAC #13792 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@455 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added NSPR support for thread-local storage. Patch submitted by vladimirv. I have slightly modified the patch to still define ANGLE_OS_WIN and ANGLE_OS_POSIX. BUG=54 Review URL: http://codereview.appspot.com/2497041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@454 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed redundant null-check. Patch submitted by timeless. BUG=58 Review URL: http://codereview.appspot.com/2470042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@453 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Initialized TPoolAllocator::totalBytes. Patch submitted by timeless. BUG=60 Review URL: http://codereview.appspot.com/2494041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@452 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
GLSL backend was assuming that a for-loop will always have a condition. But according to GLSL ES 1.0 the condition is optional. BUG=50 Review URL: http://codereview.appspot.com/2489042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@451 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed redundant dereference. Patch submitted by timeless. BUG=64 Review URL: http://codereview.appspot.com/2495041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@450 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Replaced delete with delete[]. Patch submitted by timeless. BUG=59 Review URL: http://codereview.appspot.com/2493041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@449 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
GLSL backend now emits "#version 120" to legally access invariant keyword and gl_PointCoord built-in variable. BUG=35 Review URL: http://codereview.appspot.com/2341043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@448 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add proper detection for maximum texture and renderbuffer size Trac #13849  Increased the maximum possible texture & renderbuffer size to 16384 (the minimum required for DX11 cards). Limit the actual maximum texture & renderbuffer size to the maximum that it reported by the underlying D3D9 device.  Note that creating textures and renderbuffers at the maximum size will quickly exhaust video memory!  Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@447 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
- Check for D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES capability during initialization to fail on DirectX8 drivers. - Fail in GetDeviceCaps loop after one second.  Review URL: http://codereview.appspot.com/2354042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@446 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Made debug log filename compile time configurable.  Define TRACE_OUTPUT_FILE macro to change filename. Default remains "debug.txt" for Visual Studio solution based build. Gyp based build uses "angle-debug.txt".  Review URL: http://codereview.appspot.com/2327043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@445 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed NULL dereference in glClear.  6 crashes on Windows XP 1 crash on Windows 7  This was Canary 7.0.530.0 using ANGLE r429.  0x011f523b 	[libGLESv2.dll 	- context.cpp:2412] 	gl::Context::clear(unsigned int) 0x011e5f41 	[libGLESv2.dll 	- libglesv2.cpp:611] 	glClear 0x020c400d 	[chrome.dll 	- gl_context.cc:33] 	gfx::GLContext::InitializeCommon() 0x020bb757 	[chrome.dll 	- gl_context_egl.cc:138] 	gfx::NativeViewEGLContext::Initialize() 0x020b8946 	[chrome.dll 	- gl_context_win.cc:502] 	gfx::GLContext::CreateViewGLContext(HWND__ *bool) 0x01c4f6f8 	[chrome.dll 	- gpu_processor_win.cc:35] 	gpu::GPUProcessor::Initialize(HWND__ *gfx::Size const &gpu::GPUProcessor *unsigned int) 0x01d6e669 	[chrome.dll 	- gpu_command_buffer_stub.cc:88] 	GpuCommandBufferStub::OnInitialize(intvoid * *)  It's crashing upon creation of the GL context possibly the first context. Device lost would possibly explain the XP crashes. The Windows 7 box might have run out of video memory.  I also checked another couple of NULL dereference crashes.   Review URL: http://codereview.appspot.com/2197046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@444 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Made the API of shader translator library consistent. - We recently started using OpenGL-type enums. This CL makes all old enums consistent with the new scheme. - Renamed TBuiltInResource to ShBuiltInResources to have a consistent prefix  BUG=46 Review URL: http://codereview.appspot.com/2328041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@443 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added version number for shader translator API. BUG=45 Review URL: http://codereview.appspot.com/2234047  git-svn-id: https://angleproject.googlecode.com/svn/trunk@442 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Handled case when variable declaration contains initialization. BUG=26 Review URL: http://codereview.appspot.com/2213049  git-svn-id: https://angleproject.googlecode.com/svn/trunk@441 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented functionality to collect and return info for attributes and uniforms. BUG=26 Review URL: http://codereview.appspot.com/2206046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@440 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Built-in string for vertex shaders can be empty. Nicolas handled this case in r433 but r437 overwrote it. Review URL: http://codereview.appspot.com/2233046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@439 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Restore line endings  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@438 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
- Moved the implementation for ShCompile to the compiler class so that internal details about compiler can be encapsulated. Now we do not need to expose built-in symbol table. - Fixed a few const violations. - Added CollectAttribsUniforms class. BUG=26 Review URL: http://codereview.appspot.com/2263041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@437 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Reset a lost device before releasing it TRAC #13622 This prevents the driver from getting stuck in an undefined state and returning errors when trying to create a new device or querying capabilities. Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@436 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Empty the surface and context sets on terminate TRAC #13623 This prevents a crash when the application calls eglTerminate multiple times without destroying the contexts or surfaces. Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@435 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ensure that a surface is present before writing to it TRAC #13595 This fixes a bug where glTexSubImage is called on a mipmapped texture before calling glTexImage. Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@434 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Define vertex texture sampling intrinsics only when supported TRAC #12245 This ensures that the shader will fail to compile when using VTF when it's not supported. Previously an error was generated only at link time and it was not very descriptive. Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@433 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Allow multisampling without enabling GL_SAMPLE_COVERAGE.  This setting is only used when an application wants to control which samples are written to.  If it is disabled multisampling should just write to all samples.  BUG=38  Review URL: http://codereview.appspot.com/2194043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@431 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Allow blitting to a render texture in BlitFramebuffer.  Change the type check to allow blitting between render buffers and render textures. Store the format for render textures so that resolving to a render texture Colorbuffer will pass the format check.  BUG=37  Review URL: http://codereview.appspot.com/2205043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@430 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
I hope this will fix a generateMipmaps crash when needRenderTarget fails.  This fixes this crash in 7.0.524.0 on a user's Windows XP service pack 3 box.  0x014946f3 	[libGLESv2.dll 	- texture.cpp:1382] 	gl::Texture2D::generateMipmaps() 0x0149786f 	[libGLESv2.dll 	- libglesv2.cpp:2114] 	glGenerateMipmap 0x01c53199 	[chrome.dll 	- gles2_cmd_decoder.cc:2437] 	gpu::gles2::GLES2DecoderImpl::DoGenerateMipmap(unsigned int) 0x01c52216 	[chrome.dll 	- gles2_cmd_decoder.cc:2214] 	gpu::gles2::GLES2DecoderImpl::DoCommand(unsigned intunsigned intvoid const *) 0x01c4fa78 	[chrome.dll 	- cmd_parser.cc:56] 	gpu::CommandParser::ProcessCommand() 0x01c4f8ba 	[chrome.dll 	- gpu_processor.cc:100] 	gpu::GPUProcessor::ProcessCommands() 0x01ecdcce 	[chrome.dll 	- callback.h:119] 	CallbackImpl<BrowsingDataRemovervoid ( BrowsingDataRemover::*)(void)Tuple0>::RunWithParams(Tuple0 const &) 0x01c4f2d9 	[chrome.dll 	- callback.h:79] 	CallbackRunner<Tuple0>::Run() 0x01c4edce 	[chrome.dll 	- command_buffer_service.cc:80] 	gpu::CommandBufferService::Flush(int) 0x01d6b9b1 	[chrome.dll 	- gpu_command_buffer_stub.cc:129] 	GpuCommandBufferStub::OnFlush(intgpu::CommandBuffer::State *)  This might be glGenerateMipmaps after a device lost.   Review URL: http://codereview.appspot.com/2227044  git-svn-id: https://angleproject.googlecode.com/svn/trunk@429 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Trying to fix bug crash when eglCreateWindowSurface (or any other code that causes createDevice to be invoked) is called and CreateDevice reports DEVICELOST or NOTAVAILABLE.  This was a Windows XP service pack 3 box.  0x10002545 	[libegl.dll 	- display.cpp:340] 	egl::Display::createDevice() 0x10002912 	[libegl.dll 	- display.cpp:468] 	egl::Display::getDevice() 0x01d6a80f 	[chrome.dll 	- gpu_info_collector_win.cc:29] 	gpu_info_collector::CollectGraphicsInfo(GPUInfo *) 0x01d68eca 	[chrome.dll 	- gpu_thread.cc:104] 	GpuThread::OnEstablishChannel(int)  Previously createDevice only checked for out of memory and the ASSERT(SUCCEEDED(result)) has no effect in release builds.  I simulated the failure in a debugger and discovered a second place where a null dereference would occur in this case.  I don't think this crash is technically correct but it prevents crashes. Review URL: http://codereview.appspot.com/2217043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@428 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Texture2D::getRenderTarget does not assume that needsRenderTarget succeeded.  Specifically it checks that mTexture is not null.  This is to fix this crash that has been happening out in the wild:  0x01444822 	[libGLESv2.dll 	- texture.cpp:1417] 	gl::Texture2D::getRenderTarget(unsigned int) 0x01445615 	[libGLESv2.dll 	- texture.cpp:2048] 	gl::Texture::TextureColorbufferProxy::getRenderTarget() 0x01453bb0 	[libGLESv2.dll 	- context.cpp:1579] 	gl::Context::applyRenderTarget(bool) 0x01455395 	[libGLESv2.dll 	- context.cpp:2413] 	gl::Context::clear(unsigned int) 0x014460c4 	[libGLESv2.dll 	- libglesv2.cpp:611] 	glClear 0x01c53b75 	[chrome.dll 	- gles2_cmd_decoder.cc:3021] 	gpu::gles2::GLES2DecoderImpl::ClearUnclearedRenderbuffers(unsigned intgpu::gles2::FramebufferManager::FramebufferInfo *) 0x01c53cee 	[chrome.dll 	- gles2_cmd_decoder.cc:3078] 	gpu::gles2::GLES2DecoderImpl::DoFramebufferTexture2D(unsigned intunsigned intunsigned intunsigned intint) 0x01c57c7d 	[chrome.dll 	- gles2_cmd_decoder_autogen.h:756] 	gpu::gles2::GLES2DecoderImpl::HandleFramebufferTexture2D(unsigned intgpu::gles2::FramebufferTexture2D const &) 0x01c52197 	[chrome.dll 	- gles2_cmd_decoder.cc:2214] 	gpu::gles2::GLES2DecoderImpl::DoCommand(unsigned intunsigned intvoid const *) 0x01c4fa78 	[chrome.dll 	- cmd_parser.cc:56] 	gpu::CommandParser::ProcessCommand() 0x01c4f8ba 	[chrome.dll 	- gpu_processor.cc:100] 	gpu::GPUProcessor::ProcessCommands()  It was a Windows XP service pack 3 box with Chrome 7.0.524.0. ANGLE was at r418 in this build. I suspect it attempted to glClear after a device lost which caused needsRenderTarget to fail.  This will hopefully patch it up so it doesn't crash. We'll need to check we aren't assuming mTexture is not null elsewhere.   Review URL: http://codereview.appspot.com/2233045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@427 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed masked glClear TRAC #13577 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@426 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added API to query for active attribs and uniforms. These functions are modeled after glGetShaderiv glGetProgramiv glGetActiveAttrib and glGetActiveUniform. The main difference between this and OpenGL API is that we do not have programs - just shaders. BUG=26 Review URL: http://codereview.appspot.com/2183041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@425 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added assertion to RefCountObject destructor that mRefCount is zero.  Review URL: http://codereview.appspot.com/2180041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@424 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Changed raw pointers to RefCountObject to BindingPointers.  I suspect there is a bug whereby an owning reference to a RefCountObject is temporarily assigned to a BindingPointer causing it to be destroyed and making the owning raw pointer go dangling.  Making this change for mColorbufferProxy seemed to fix a crash in Chrome with canvas 2D.  This was previously landed in r417 and r418.  Review URL: http://codereview.appspot.com/2108047  git-svn-id: https://angleproject.googlecode.com/svn/trunk@423 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Backing out r417 and r418.  I will recommit these as two separate patches: one for ID invalidation and one for reference counting issue.  I will not recommit the FBO changes and since the GLES2 spec will soon make it undefined whether FBOs are in a shared namespace.   Review URL: http://codereview.appspot.com/2154045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@422 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix glGetActiveUniform for samplers TRAC #13522 Original patch by Jim Hauxwell fixed for full test suite conformance. Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@421 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renaming Context::mDepthStencilDirty flag to mDepthStencilInitialized to avoid breaking consistency http://codereview.appspot.com/2187041/ (Having trouble checking it in with gcl so going straight to subversion)  git-svn-id: https://angleproject.googlecode.com/svn/trunk@420 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Reset DepthStencilSurface after Context::markAllStateDirty() has been called.  Landing on Vangelis' behalf.  Original review: http://codereview.appspot.com/2184041/   git-svn-id: https://angleproject.googlecode.com/svn/trunk@419 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Missing file.  TBR=vangelis@chromium.org  Review URL: http://codereview.appspot.com/2147046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@418 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Replaced raw pointers to RefCountObject to BindingPointer.  This fixes the ANGLE crashes in Chrome when using canvas 2D.  The issue was this:  Renderbuffer *mColorbufferProxy = new RenderBuffer(...); // Reference count is zero.  BindingPointer<RenderBuffer> tempRef; tempRef.set(mColorbufferProxy); // Reference count is one.  tempRef.set(NULL); // Reference count is zero and object is destroyed leaving mColorbufferProxy dangling.  I also initially suspected the problem was that FBOs are not treated as shared and the implementation of shared FBOs is still in the patch. I believe GLES2 supports shared FBOs.  My reading of the GLES2 spec is that when a shared object is deleted it loses its id but retains its state if left bound elsewhere. I added that to RefCountObject.    Review URL: http://codereview.appspot.com/2120045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@417 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
ANGLE supports GL_OES_standard_derivatives now. BUG=25 Review URL: http://codereview.appspot.com/2122048  git-svn-id: https://angleproject.googlecode.com/svn/trunk@416 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for associating functions with extensions and performing validation when those functions are used in a shader. BUG=25 Review URL: http://codereview.appspot.com/2141046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@415 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed unnecessary member variables from TIntermAggregate. Replaced operator overloading with a proper function in TFunction. Review URL: http://codereview.appspot.com/2137043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@414 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added mechanism to predefine associated macros for extensions. Also refactored the way extension behavior is initialized and updated. Please note that I still need to add validation that appropriate extensions are enabled before using an extension function. BUG=25 Review URL: http://codereview.appspot.com/2139042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@413 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed support for unused/deprecated extension - GL_3DL_array_object. TEST=conformance tests. Review URL: http://codereview.appspot.com/2043043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@412 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removes unused IsFloatingPoint function from utilities.cpp  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@411 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Replaces Windows line endings with Unix where needed  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@410 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements support for renderable floating point textures. TRAC #12909 Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@409 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Replaces swap chain lazily when the swap interval is changed.  It does not appear to be possible to pass a presentation interval to Present() or change it after creating the swap chain short of calling Reset(). I decided to try fixing it by replacing the swap chain under the same conditions as a window resize.  I tested it with a modified version of the simple vertex shader sample passing various values to eglSwapInterval.  My reading of the EGL spec might be wrong but I believe the interval state should be associated with the surface bound to the current context rather than the display.    Review URL: http://codereview.appspot.com/2036044  git-svn-id: https://angleproject.googlecode.com/svn/trunk@408 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ensure mInfoLog is nulled out after it is deleted. Issue=27 Original-Author: Vladimir Vukicevic Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@407 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented recovering from a lost device by context recreation. TRAC #13222 Singed-off-by: Daniel Koch  Author:    Nicolas Capens <nicolas@transgaming.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@406 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented GL_NV_fence extension. I believe I have implemented all features according to the spec. The application is to allow the Chrome command buffer scheduler to be smarter about deciding which command buffer to process. For example if a WebGL app issued a call to ReadPixels the scheduler will issue a fence and defer executing the ReadPixels until the status goes true. It can continue to work on other command buffers in the meantime. I tested by modifying the vertex shader demo. After issuing the SwapBuffers i made issue a fence and loop until the status went true and verified it looped several times. I also tested that by calling FinishFence before going into the loop that is did not loop at all.  Review URL: http://codereview.appspot.com/1965043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@405 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement support for floating point textures. Trac #12909  Implements GL_OES_texture_float GL_OES_texture_half_float GL_OES_texture_float_linear and GL_OES_texture_half_float_linear when supported by the hardware.  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods <shannon.woods@transgaming.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@404 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Allow derivative functions if derivative extension is enabled. I still need to add validation for "#extension GL_OES_standard_derivatives : enable". BUG=25 Review URL: http://codereview.appspot.com/1965045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@403 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adding support for OES_standard_derivatives extension. This is not the complete implementation. Sending it to get feedback on the API. Is it OK to add extension support into TBuiltInResource? I could create a new struct for extensions but that would lead to API change. BUG=25 Review URL: http://codereview.appspot.com/1953047  git-svn-id: https://angleproject.googlecode.com/svn/trunk@402 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Changed glFlush to not wait until issued event is processed.  I think these reduced synchronization guarantees are still compliant with the spec. I found that this significantly improved the frame rate for some of our demos (40 fps to 50fps for one on my box). I will change the demo so that it does not call glFlush at all but I still think this is a valuable change.  The OpenGL ES2 spec says:  "The command  void Flush( void );  indicates that all commands that have previously been sent to the GL must complete in finite time."  My reading of it is that any GL calls previously issued will be processed at some point in the future but not necessarily prior to glFlush returning. I believe that issuing the D3D event and then calling GetData once with the flush flag should meet these requirements.  I also added some assertions to glFinish because I was paranoid that if issuing an event ever failed the spin loop might never terminate.   Review URL: http://codereview.appspot.com/1941049  git-svn-id: https://angleproject.googlecode.com/svn/trunk@401 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Cleanup TType and related classes: 1. Removed unused functions 2. Removed unnecessary virtuality of functions 3. Grouped related functions together  TEST=conformance tests Review URL: http://codereview.appspot.com/1984047  git-svn-id: https://angleproject.googlecode.com/svn/trunk@400 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Optimizes Texture::loadImageData TRAC #13046 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@399 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements a special case for temporary surface creation for DXT low mip levels. TRAC #12908 The lowest mip levels for DXT textures will have dimensions < 4 so a D3D texture cannot be created to hold them offscreen directly. Instead we must create a larger texture one of whose mip levels would be the desired dimension and store the surface from that texture for later inclusion in the final texture. Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@398 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements compressed textures. TRAC #12714 Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@397 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Allocates a texture rather than an offscreen plain surface for new textures. TRAC #12908 Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@396 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Advertises the GL_OES_rgb8_rgba8 extension.  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@395 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements support for rgb8 and rgba8 renderbuffer storage formats TRAC #12717 Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@394 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes a bug where framebuffer_multisample was not properly being added to the extension string. TRAC #12966 Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@393 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements multisample resolve capability TRAC #12716 Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@392 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements multisample fragment operations TRAC #12711 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@391 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements glRenderbufferMultisampleStorage TRAC #12714 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@390 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements blitFramebuffer TRAC #12713 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@389 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Initializes renderbuffer formats for attachments to the default framebuffer. TRAC #12864 Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@388 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Creates separate bind points for read & write framebuffers. TRAC #12712 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@387 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added runtime checks for GetClientRect errors.  I noticed that if the window handle is invalid the resulting rect will be uninitialized. This change makes it fail immediately.  Review URL: http://codereview.appspot.com/2009042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@386 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
TIntermBinary::promote() was incorrectly marking the type of result as const in some cases. The result can only be const if both operands are const. Also cleaned up the function to remove redundant/repeated checks. BUG=24 TEST=OpenGL ES 2.0 Conformance tests Review URL: http://codereview.appspot.com/1938047  git-svn-id: https://angleproject.googlecode.com/svn/trunk@385 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed crash on context lost.  This fixes the crash on lost context for vista and windows 7 if suitable drivers are available. It now uses D3D9Ex when available and this only reports lost contexts for hardware failures and suchlike.  Testing procedure was: - run simple_vertex_shader without this change. - ctrl+alt+del to lock machine. - return to desktop. - observe that simple_vertex_shader crashes. - repeat with this change and check that simple_vertex_shader is still animating. - simulate the code path that an XP machine would take using the debugger and check that old behavior is preserved.  I decided to load D3D9.DLL at runtime for a couple of reasons. First I didn't want to assume that older implementations of D3D9 would have the Direct3DCreate9Ex entry point. Second it might be advantageous for some applications to not have a load time dependency on D3D9. I didn't address this for D3DX9 because it's a little harder - there's no clear way to determine which D3DX9_x.DLL library to open. At least D3DX9_x.DLL does not seem to import D3D9.DLL and D3DX is separately redistributable so there is still some advantage to be had. Review URL: http://codereview.appspot.com/1951044  git-svn-id: https://angleproject.googlecode.com/svn/trunk@384 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added comment about return values of ShInitialize() and ShFinalize(). Review URL: http://codereview.appspot.com/1980041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@383 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed Display::initialize so it does not crash for devices that do not support PS 2.0.  The crash occurs when createDevice attempts to dereference mD3d9 which is NULL.   Review URL: http://codereview.appspot.com/1956042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@382 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed warnings about deprecated conversion from string constant to char*. Submitted by timeless. BUG=18 Review URL: http://codereview.appspot.com/1936041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@381 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Some compilers do not support standard STL allocator interface. Also removed _Charalloc function only needed by VC++6.0 which we do not support. Submitted by Eagle.Lu. BUG=19 Review URL: http://codereview.appspot.com/1913048  git-svn-id: https://angleproject.googlecode.com/svn/trunk@380 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix warnings about unused variables. Submitted by timeless. BUG=15 Review URL: http://codereview.appspot.com/1916046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@379 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix warnings about comparison/assignement between signed and unsigned types. Submitted by timeless. BUG=13 Review URL: http://codereview.appspot.com/1895051  git-svn-id: https://angleproject.googlecode.com/svn/trunk@378 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
ret = yyparse(...) is dropped in PaParseStrings. Submitted by timeless. BUG=16 Review URL: http://codereview.appspot.com/1868056  git-svn-id: https://angleproject.googlecode.com/svn/trunk@377 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix warnings about initialization order in the class initialization list. Submitted by timeless. BUG=14 Review URL: http://codereview.appspot.com/1850054  git-svn-id: https://angleproject.googlecode.com/svn/trunk@376 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Reject shaders that invoke functions hidden by variable or struct name. BUG=22 Review URL: http://codereview.appspot.com/1855057  git-svn-id: https://angleproject.googlecode.com/svn/trunk@375 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
We were trying to change a const_iterator which was rightly caught by SunStudio compiler. Submitted by Eagle.Lu. BUG=19 Review URL: http://codereview.appspot.com/1879049  git-svn-id: https://angleproject.googlecode.com/svn/trunk@374 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Replaced __inline with inline to make it compile with SunStudio compiler. Submitted by Eagle.Lu. BUG=19 Review URL: http://codereview.appspot.com/1910047  git-svn-id: https://angleproject.googlecode.com/svn/trunk@373 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adding separate license file for the preprocessor code and removing the ANGLE boilerplate license from those files.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@372 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add Al and Vlad to contributors file  git-svn-id: https://angleproject.googlecode.com/svn/trunk@371 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement EXT_texture_format_BGRA8888 and EXT_read_format_bgra Trac #13050 Issue=21 Original Author: Vladimir Vukicevic Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@370 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements fixes for problems discovered running San Angeles demo on Chrome TRAC #13077  - clamp scissor to rendertarget size  - ensure textures are renderable when required Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@369 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes erroneous copy in subImage calls after failure is already detected. TRAC #13074 Also adds initializations for missed Texture members. Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@368 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added missing sources to build_angle.gyp.  Review URL: http://codereview.appspot.com/1907043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@367 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removes Windows-style line endings from Display.cpp TRAC #12714 Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@366 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Support window resizing  TRAC #12660  Automatically resize the D3D swap chain when the eglSwapBuffers is called and the presentation window has changed size. Also change D3D device init to be performed once when the Display is created using a hidden 1x1 window.  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@365 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Sharing for buffer texture and renderbuffer objects.  TRAC #12496  Derive Renderbuffer Texture and Buffer from RefCountObject. This class keeps a reference count for all objects that need cross-context reference counting and also the object id. Restructure Renderbuffers to create a wrapper object and a storage object. Use BindingPointer for all binding points instead of binding by object id.  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@364 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Create shared contexts.  TRAC #12498  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@363 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Checks completeness of framebuffer before read operations. TRAC #12565 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@362 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes FBO completeness check  TRAC #12571 Automatically passes default framebuffer and fails framebuffers which have no color attachments. Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@361 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds resource manager class. TRAC #12493 The resource manager class is now in charge of allocation & management of objects which may be shared by multiple contexts. Signed-off-by: Andrew Lewycky Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@360 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove wrong and unnecessary check attribute check.  TRAC #12580  Wrong because it should be checking active attributes not inactive attributes. Unnecessary because when a buffer is deleted all the vertex attrib client state bindings are cleared.  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@359 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement GL_OES_packed_depth_stencil TRAC #12336 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@358 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
fix spacing issue due to manual merge  git-svn-id: https://angleproject.googlecode.com/svn/trunk@357 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renamed dx_Window to dx_Viewport TRAC #11594 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@356 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement gl_PointCoord on SM3 hardware TRAC #11594 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@355 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use TestCooperativeLevel instead of ValidateDevice to check for device loss.  TRAC #12547  ValidateDevice checks for correct rendering state as well which we don't need.  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@354 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
De-allocate memory in ShFinalize(). There still seems to be a bug here if the translator is used in a multi-threaded environment. It seems memory local to only one thread is being deallocated - the thread from which ShFinalize() is called. I will look into it closely in the next CL. Review URL: http://codereview.appspot.com/1878044  git-svn-id: https://angleproject.googlecode.com/svn/trunk@353 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Encapsulate expressions with ternary operators with brackets. This preserves the order of precedence when ternary expressions are used in a compound expression. BUG=20 Review URL: http://codereview.appspot.com/1894041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@352 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactored the way symbol tables are initialized and stored. This was done in response to the addition of EShSpec. Symbol table entries depend on three things - language spec (not now but may eventually) and built-in resources. We used to build two global symbol-tables - one for each language. During each compile one of the symbol table was copied and resource-specific stuff was added. I have moved the symbol table to TCompiler that gets initilized when compiler is created and reused for each compile. This makes it much cleaner and extensible in case a spec requires special entries to be added to the symbol table.  PS: Sorry for the long CL but all of it needed to be done in one CL. I have verified that everything still compiles and passes all conformance tests. Review URL: http://codereview.appspot.com/1864044  git-svn-id: https://angleproject.googlecode.com/svn/trunk@351 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
ReadPixels recovers from device lost error.  I found that when I switch desktops GetRenderTargetData will return D3DERR_DEVICELOST. It is unclear to me whether ReadPixels should report a GL error in this case and if so which one. I went with GL_OUT_OF_MEMORY. Let me know if that's wrong.  This change is not sufficient to make eglGetError report EGL_CONTEXT_LOST. For a program doing exclusively offscreen rendering ReadPixels might be the only place where D3DERR_DEVICELOST can be detected. The GLES code can't call egl::setCurrentError though. I'm not sure how to fix that.     Review URL: http://codereview.appspot.com/1692053  git-svn-id: https://angleproject.googlecode.com/svn/trunk@350 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Further cleanup of ShaderLang.h. Removed redundant/unused macros and enum fields. Review URL: http://codereview.appspot.com/1842046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@349 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Cleaned up translator API. Deleted unsupported dead code. BUG=9 Review URL: http://codereview.appspot.com/1665050  git-svn-id: https://angleproject.googlecode.com/svn/trunk@348 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Check for reserved prefixes (gl_ webgl_ and _webgl_) in struct and field names. GLES2 and WebGL both require this for all identifiers - variable function struct and field names. ANGLE was only validating variable and function names. BUG=11 Review URL: http://codereview.appspot.com/1856046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@347 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added checks for webgl_ and _webgl_ reserved identifiers. This currently only checks variable and function names. Struct names and field names will be added in the another CL. BUG=11 Review URL: http://codereview.appspot.com/1674050  git-svn-id: https://angleproject.googlecode.com/svn/trunk@346 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added <stdio.h> include for sprintf. It broke Chrome downstream when I bumped the rev.   Review URL: http://codereview.appspot.com/1879042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@345 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added an option for specifying language specification in preparation for supporting WebGL in addition to GLES2. This CL just replaces unused debugOptions variable with EShSpec variable. BUG=11 Review URL: http://codereview.appspot.com/1692051  git-svn-id: https://angleproject.googlecode.com/svn/trunk@344 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed compilation error on mingw. Used _MSC_VER for MSVC-specific code instead of WIN32. Recieved patch from cjacek. BUG=12 Review URL: http://codereview.appspot.com/1694049  git-svn-id: https://angleproject.googlecode.com/svn/trunk@343 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed the precision check creating spurious error messages TRAC #12641 The precision of compiler temporaries doesn't require checking and would be hard to determine at parse time. We only require correct precisions for declarations which is checked separately. So we can safely remove the check for binary operations.  Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@342 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Clear must ignore buffers that are not present.  TRAC #12643  IDirect3DDevice9::Clear will fail if asked to clear a buffer that is not present so we have to be careful what we pass to it.  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@341 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix NPOT completeness rule.  TRAC #12561  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@340 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Eliminates redundant calls to GetDeviceCaps TRAC #12283 Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@339 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added some includes.  My Unbuntu 10.04 gcc configuration seems to need <stdio.h> to use some of the string printf functions like vsnprintf. The translator is building for me now.  Review URL: http://codereview.appspot.com/1717041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@337 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added parentheses around a few operators so that if they are used in a compound statement order of operations is preserved. BUG=5 TEST=OpenGL ES 2.0 conformance tests. Review URL: http://codereview.appspot.com/1691041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@336 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Handled case where selection nodes that use ternary operators are part of a sequence. Usually they are part of an assignment. BUG=4 TEST=OpenGL ES 2.0 conformance tests specifically operators test. Review URL: http://codereview.appspot.com/1643043   git-svn-id: https://angleproject.googlecode.com/svn/trunk@335 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix build when a project patch contains spaces  Trac #11553  With improvements so it works in release mode and on Win7 as well.  Original-Author: Jim Hauxwell  git-svn-id: https://angleproject.googlecode.com/svn/trunk@334 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Workaround for drivers that apparently don't disable instancing when we ask.  TRAC #12479  This affects text rendering in Nexuiz. The text will be drawn as if the colour attribute is static rather than array and all text will be drawn using the shadow colour.  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@333 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Increase the number of supported attribs (12) and texture units (16) TRAC #12313 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@332 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix regression due to float printing changes Trac #12501  This was caused by the change from printf to iostream printing. Sets the float formatting to "default" which is neither fixed or scientific and request 8 digits of precision. This appears to be mostly equivalent to the previous "%.8g". If the non-fractional case we set it to fixed and use 1 unit of precision after the decimal.  Signed-off-by: Andrew Lewycky Signed-off-by: Shannon Woods Signed-off-by: Ken Russell  git-svn-id: https://angleproject.googlecode.com/svn/trunk@331 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't rely on (potentially) unsupported vertex attribute types.  TRAC #11391 Checks for optional vertex declaration formats and falls back to FLOAT1-4 if more direct formats are not supporte  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@330 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes double-decoration when getUniformLocation is called from defineUniform. TRAC #12437  This fixes the WebGL Teapot Per Pixel sample rendering  Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@329 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Save D3D state before altering it for masked clears TRAC #12380 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@328 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed warnings in release build. Trace was not defined properly. Review URL: http://codereview.appspot.com/1484041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@327 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved windows-only targets into OS==win conditional. Review URL: http://codereview.appspot.com/1473043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@325 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
According to spec the stencil ref is clamped to the range [02^s-1]  The clamp to zero occurs on set since negative values will never be useful. The clamp to 2^s - 1 occurs on use since it is dependant on the currently bound stencil buffer  Original-Author: Jim Hauxwell <james@dattrax.co.uk> Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@324 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed the dependency of compiler on common. This is done to make compiler self-sufficient so that it is easier to consume by external developers. I tried to replace all instances of assert by simply redefining assert(x) to ASSERT(x) but was getting a lot of compile errors. I still need to investigate that. Review URL: http://codereview.appspot.com/1461041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@323 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactored InfoSink. I have replaced most instances of sprintf with std::ostringstream to make it safer. I have made sure that everything still compiles and passes conformance tests. Review URL: http://codereview.appspot.com/1391041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@322 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for various egl Get methods Trac #12375 This patch stores the current READ/DRAW and display in the context and allows these eglGets to work.  Original-Author: Jim Hauxwell <james@dattrax.co.uk> Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@321 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Correct the eglMakeCurrent return value on lost context (syntax) TRAC #11233 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@320 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Avoid using instancing on hardware where it does not work well enough.  TRAC #12392  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@319 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Used "not" instead of "!" for vectors. Review URL: http://codereview.appspot.com/1324041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@318 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Do not write extraneous semi-colons - some glsl compilers are do not like that even though it is so easy to ignore. Review URL: http://codereview.appspot.com/1301041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@317 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
ShInitialize/ShFinalize is designed to be called once per process or it would crash at random locations. I changed ShFinalize() to properly cleanup and reset global variables so that they can be called multiple times. I think that the compiler setup is much more complicated than it needs to be. It unnecessarily uses global variables. A custom pool allocator is overkill too.  Review URL: http://codereview.appspot.com/1238045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@316 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
TextureColorbufferProxy must query the texture to get the latest width & height.  TRAC #12372  Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@315 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use instancing for non-array vertex attributes.  TRAC #12303  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@314 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add Jim Hauxwell as a contributor  git-svn-id: https://angleproject.googlecode.com/svn/trunk@313 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes query for active texture TRAC #12374  Original-Author: Jim Hauxwell <james@dattrax.co.uk> Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@312 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Report an EGL_CONTEXT_LOST error on D3DERR_DEVICELOST Trac #11233 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@311 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement scoped structure declarations TRAC# 12110 Signed-off-by: Shannon Woods Singed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@310 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed struct name lexing TRAC #12110 Unlike built-in types structs can be redefined (in a different scope). Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@309 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Detect draws that would read outside the vertex buffer.  TRAC #12340  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@308 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix FORCE_REF_RAST definition TRAC #12343 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@307 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add defines to enable the reference rasterizer TRAC #12343 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@306 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed compile error with gcc 4.4. TBR=gman@chromium.org Review URL: http://codereview.appspot.com/1199047  git-svn-id: https://angleproject.googlecode.com/svn/trunk@305 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Patching changes from thestig@chromium.org for fixing ANGLE build with gcc 4.4 on Karmic. The original CL is here: http://codereview.appspot.com/1255042/show The only changes I have maded is moved the inclusion of stdint.h from PoolAlloc.h to PoolAlloc.cpp with #ifndef _MSC_VER guard. Review URL: http://codereview.appspot.com/1220044  git-svn-id: https://angleproject.googlecode.com/svn/trunk@304 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removes check for framebuffer == 0 in glRenderbufferStorage TRAC #12346 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@303 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Give sorted configs a unique ID without changing the original set TRAC #12323 This fixes building on Visual C++ 2010 which has const iterators for STL sets as specified by C++0x. Signed-off-by: Shannon Woods Singed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@302 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Define GL_FRAGMENT_PRECISION_HIGH TRAC #12266 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@301 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix DepthRange location TRAC #12279 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@300 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use plain data arrays for Buffer storage TRAC #12299 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@299 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Caches the location of generic uniforms TRAC #12215 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@298 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Explicitly set optimizations to /O2 in Release build TRAC #12287 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@297 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Disable checked STL iterators in Release build TRAC #12287 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@296 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Inline any suitable function in Release build TRAC #12287 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@295 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Correct GLboolean handling for glColorMask and glSampleCoverage TRAC #11597 Signed-off-by: Shannon Woods Signed-off-bY: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@294 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Enforce fragment precision qualifier requirement TRAC #12156 The fragment shader has no default precision qualifier for floating-point types so compilation should fail when it's not set explicitly globally or per declaration. Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@293 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Untabify compiler code TRAC #12156 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@292 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
ensure mBaseTexture is initialized  Trac #12298 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@291 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Reduces STL size calls. TRAC #12281 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@290 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Minimizes render target changes TRAC #12154 This patch reduces calls to SetRenderTarget. Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@259 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed crash on 64-bit posix platform. stdint.h was not being included and wrong size of uintptr_t was being used. Review URL: http://codereview.appspot.com/1153044  git-svn-id: https://angleproject.googlecode.com/svn/trunk@258 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Restore state after Blit operations  TRAC #12202  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@257 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Improve performance in Surface::swap  TRAC #12145  - Create the flip RT texture once. - Use state blocks for swap and restore all previous state.  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@256 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Prevent redundant uniform updates TRAC #12154 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@255 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Changes to compile translator_glsl on linux. Review URL: http://codereview.appspot.com/1153043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@254 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
The script for flex and bison was not being generated properly on linux. Extra quotes were being generated in the command-line around output-file path. This change gets around the problem by expanding string variables instead of list. This has another nice side effect that output file path need not be repeated twice. Review URL: http://codereview.appspot.com/1163041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@253 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Optimized getPresentInterval TRAC #12180 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@252 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Mark configs with a format different from the display mode as non-conformant TRAC #12197 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@251 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't enumerate configs for depth/stencil formats not supported by any hardware TRAC #12197 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@250 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Making glsl-translator cross-platform. Removed unnecessary inclusion of windows.h. Review URL: http://codereview.appspot.com/1136042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@249 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Prevent atan2 from generating a NaN TRAC #12184 This is necessary because a NaN generated in flattened conditional code fails to get discarded on certain devices. Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@248 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Clarify config enumeration TRAC #12170 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@247 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Disable the stencil test when no stencil buffer TRAC #12181 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@246 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented inline structure construction TRAC #12109 Based on Alok Priyadarshi's approach for structure construction in OutputGLSL.cpp Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@245 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Replaces fmod with modf. Review URL: http://codereview.appspot.com/1125043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@244 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make sure that floats are written with at least one decimal point. Review URL: http://codereview.appspot.com/1144041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@243 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed all issues with variable and function argument declaration. Multiple declarations of arrays in the same line had bugs. Also sepearated out declaration of varaibles and function arguments which makes it easier to understand. Review URL: http://codereview.appspot.com/1142041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@242 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Skip drawing to a zero-area render target TRAC #12172 This also generates a GL_INVALID_FRAMEBUFFER_OPERATION error when glClear attempt to operate on an invalid or incomplete framebuffer. Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@241 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement GL_OES_element_index_uint  TRAC #11951  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@240 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
currentValueOffset can remain uninitialized  TRAC #12171  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@239 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't use a depth buffer on swap TRAC #12160 This prevents the draw call from failing when the depth buffer isn't as large as the render target. Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@238 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
fix trace for glTexParameteri Trac# 12155 Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@237 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Output final .lib and .dll files to the top-level lib/ folder Trac #11499  Signed-off-by: Andrew Lewycky Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@236 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented eglSwapInterval TRAC #12137 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@235 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed retrieving a render target interface and not releasing it TRAC #12149 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@234 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Reset mSceneStarted on Reset TRAC #12139 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@233 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Skip clear when writes masked TRAC #12157 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@232 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Minimize BeginScene / EndScene calls TRAC #12139 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@231 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix config depth bits and centralize device type control TRAC #12120 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@230 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Recursively write ConstantUnion to correctly construct structs. Review URL: http://codereview.appspot.com/1108041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@229 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed broken build. Somehow glslang.y got left out while renaming constUnion to ConstantUnion. TBR=dgkoch@transgaming.com Review URL: http://codereview.appspot.com/1116041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@228 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Renamed constUnion class to ConstantUnion. Review URL: http://codereview.appspot.com/1106042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@227 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Makes the State struct a member of Context rather than its parent. Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@226 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moves non-D3D-specific utility functions to the gl namespace. TRAC #12043 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@225 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements PACK_ALIGNMENT for ReadPixels TRAC #11484 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@224 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented eglGetProcAddress TRAC #12102 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@223 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Untabify libGLESv2.def TRAC #12102 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@222 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Correct use of anonymous / nameless struct TRAC #12108 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@221 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed multiple issues with struct declaration and construction. Review URL: http://codereview.appspot.com/1076041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@220 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented a bunch of missing constructs. Review URL: http://codereview.appspot.com/1031045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@219 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Output propagated struct constants as literals TRAC #11809 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@218 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Declare structures before uniform definitions and support varying arrays TRAC #11809 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@217 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Support anonymous structures TRAC #11809 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@216 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix parenthesis balance TRAC #11809 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@215 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix Shader compilation failures with nested #ifdefs  TRAC #12054  Don't exit from CPPelse prematurely. Clear elsedepth when entering a new #if nesting level.  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@214 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Deleting program does not delete shaders that are marked  TRAC #12012  Resolve the crash on context deletion.  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@213 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Check for multisample conformance  TRAC #11747  Only warn about sample coverage settings in a multisample context.  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@212 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Ensure ShaderBinary is conformant  TRAC #12061  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@211 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Append [0] to active array uniform names TRAC #11796 Singed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@210 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Investigate issues with transform_viewport conformance  TRAC #12035  transform_viewport failed when rendering into an Nx1 or 1xN viewport.  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@209 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements PolygonOffset TRAC #11719 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@208 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes program validation regression. TRAC #11654 The sampler validation at render time was occurring before uniforms were applied and samplers were bound to their texture units. Sampler validation now occurs after shaders and textures have been applied. Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@207 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Detect and report multiple #version directives TRAC #12072 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@206 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented support for lists of arrays TRAC #12075 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@205 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add all structure definitions to constructor map and simplify initialization TRAC #11809 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@204 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Output structure declarations and constructors in the header TRAC #11809 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@203 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactored outputTriplet to allow complex string expressions TRAC #11809 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@202 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Deleting program does not delete shaders that are marked  TRAC #12012  Also fixes failure to delete flagged program upon glUseProgram(0).  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@201 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Undecorate uniform names when computing max length TRAC #12050 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@200 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented complex vector/matrix construction TRAC #11868 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@199 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Allow matrix-in-matrix construction TRAC #11868 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@198 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Change ParseHelper.cpp indenting from tabs to spaces TRAC #11868 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@197 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements ValidateProgram TRAC #11654 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@196 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Support matrix attributes  TRAC #11095  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@195 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Allow other attachment points for glFramebufferTexture2D TRAC #12040 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@194 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Only output faceforward when needed TRAC #12042 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@193 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented querying GL_BLEND_COLOR TRAC #12039 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@192 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Support BufferData with size zero.  TRAC #12027  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@191 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements GetFramebufferAttachmentParameteriv TRAC #11876 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@190 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements support for retrieving uniforms by subscripted name. TRAC #11796 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@189 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed glGetShaderPrecisionFormat output TRAC #12041 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@188 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix matrix by matrix multiplication TRAC #11751 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@187 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed unnecessary include paths. Removed the dependency on unistd.h. Moved the generated files to intermediate directory so that the source is not polluted.  These changes only affect the gyp build system because they required flex-bison options that are not supported by old binaries in compiler/tools. Another reason to switch to gyp build system. Review URL: http://codereview.appspot.com/994041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@186 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
svn property changes to ignore: - third_party/cygwin - third_party/gyp - build/Debug - build/Release   git-svn-id: https://angleproject.googlecode.com/svn/trunk@185 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for building glsl translator on posix platforms. Review URL: http://codereview.appspot.com/958043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@184 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make all globals static TRAC #12015 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@183 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix getActiveUniform array size and refactor uniform size TRAC #11929 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@182 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented glGetActiveUniform TRAC #11929 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@181 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented glGetActiveAttrib TRAC #11929 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@180 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Wrap mode affects NPOT texture completeness  TRAC #11861  If mipmapping is enabled then each side of a texture must be a power-of-two or using CLAMP_TO_EDGE wrapping in that direction. Correct the mipmap size calculation to match the spec.  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@179 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Make it easier to disable tracing  TRAC #11979  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@178 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented aliased attributes support TRAC #11092 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@177 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement scoping TRAC #11975 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@176 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added DX SDK search paths to libGLESv2. Now it builds if these aren't in the default search path. Should it support x64 targets as well? Review URL: http://codereview.appspot.com/949041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@175 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement VertexAttrib  TRAC #11878  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@174 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement GL_LINE_LOOP primitive handling  TRAC #11823  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@173 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Support FBO attachment to cubemaps  TRAC #11364  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@172 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix more relative #include paths (mostly header files)  Trac #11408 Signed-off-by: Andrew Lewycky Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@171 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't advertise 10 10 10 2 RGBA format  TRAC #11610  The color_ramp conformance test renders each colour and reads it back to verify it but it uses ReadPixels with UNSIGNED_BYTE with does not have enough precision.  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@170 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement support for mipmap generation (CopyTexImage2D regression)  TRAC #11338  CopyTex(Sub)Image2D was broken by the coordinate space change. Render targets are rendered flipped in the Y axis.  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@169 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements GetRenderbufferParameteriv TRAC #11877 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@168 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements color renderbuffers TRAC #11890 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@167 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove usage of relative paths for #include search path Trac #11408 Signed-off-by: Andrew Lewycky Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@166 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use directory qualified #include files  Trac #11408 Signed-off-by: Andrew Lewycky Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@165 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
removed execute permissions on smoke.tga (was causing problems on windows)  git-svn-id: https://angleproject.googlecode.com/svn/trunk@164 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Only output referenced attributes uniforms and varyings TRAC #11590 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@163 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented biased textureCube sampling TRAC #11884 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@162 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement support for mipmap generation  TRAC #11338  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@161 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements GetTexParameteriv TRAC #11721 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@160 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Accidentally moved a read of translated[i].stride before the write.  TRAC #11847  (Fixes PVR-RenderToTexture regression)  Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@159 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed crashes caused by a string buffer overflow TRAC #11888 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@158 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Create unique names for unnamed parameters TRAC #11873 HLSL requires parameter names in function prototypes Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@157 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't crash on null conditional block TRAC #11871 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@156 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Initialize all shader variables TRAC #11869 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@155 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed the GLSL ES version TRAC #11867 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@154 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented gl_FrontFacing for lines and points TRAC #11419 Lines and points are always considered front-facing Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@153 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements GetVertexAttrib TRAC #11653 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@152 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements GetBufferParameteriv TRAC #11720  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@151 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Creating a 0x0 texture fails.  TRAC #11792  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@150 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Translate/lift vertex attributes when input stride or offset is not a multiple of 4.  TRAC #11847  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@149 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented short-circuiting behavior for the ternary operator TRAC #11444 This is achieved by turning the ternary operator into conditional code. The UnfoldSelect intermediate code traverser places this conditional code before the statement containing the ternary operator (aka. select). The computed value is assigned to a temporary variable. On outputting the actual statement the ternary operator is replaced by the temporary variable.  Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@148 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Clean up old comments TRAC #11444 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@147 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add NOMINMAX define to the compiler projects Trac #11859 To be consistent with the rest of the projects and GYP. Signed-off-by: Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@146 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fail compilation on empty source string TRAC #11814 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@145 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove name clash warnings TRAC #11314 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@144 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Decorate all GLSL user-defined names with an underscore to avoid name clashes TRAC #11314 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@143 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Corrects a green/blue channel swap in loadImageData TRAC #11630 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@142 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Corrects error handling in UseProgram TRAC #11666 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@141 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Corrects error handling in GetUniformLocation TRAC #11845 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@140 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes error handling in GetAttachedShaders TRAC #11846 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@139 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Store all matrices as column-major and transpose when needed TRAC #11825 Due to the difference in [][] matrix indexing between GLSL and HLSL all matrices are stored in transposed format (column-major from the HLSL point of view) and transposed back when performing matrix math. Previously some paths didn't follow this principle. Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@138 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixing compile error. GYP projects use NOMINMAX to suppress non-standard VC++ min/max. Review URL: http://codereview.appspot.com/892046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@137 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes error handling in LinkProgram TRAC #11821 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@136 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes error handling in ShaderSource TRAC #11664 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@135 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes improper error generation by DeleteShader TRAC #11662 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@134 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes error handling in CompileShader TRAC #11822 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@133 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement CopyTex(Sub)Image2D  TRAC #11474  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@132 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes error handling in BindAttribLocation TRAC #11661 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@131 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Checks link status of program before returning attribute locations. TRAC #11658 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@130 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Corrects error handling in AttachShader TRAC #11659 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@129 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes incorrect error handling in GetAttribLocation TRAC #11657 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@128 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented struct equality TRAC #11727 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@127 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - split header body and footer output TRAC #11798 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@126 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements correct error handling for DetachShader TRAC #11663 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@125 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements support for IsEnabled TRAC #11750 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@124 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements glGetUniform TRAC #11647 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@123 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements Uniform*i{v} TRAC #11649 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@122 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements support for boolean uniforms TRAC #11734 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@121 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented function prototyping and in/out parameters TRAC #11725 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@120 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented glReadPixels for the implementation-dependent format Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@119 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
update contributors list  git-svn-id: https://angleproject.googlecode.com/svn/trunk@118 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiling error in x64: WidenToFour template incorrect type.  TRAC #11811  Submitted-by: Aitor Moreno Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@117 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented support for user-defined structures TRAC #11730 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@116 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Can't change attribute locations after original link  TRAC #11290  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@115 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Associate the sample.sln file with visual C++ express. Trac #11802 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@114 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix compilation of glslang.l in release mode. Trac #11802 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@113 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Re-Associate ANGLE.sln with VC++ Express Signed-off-by: Andrew Lewycky Signed-off-by: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@112 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove GLES2/glextimg.h Trac #11785 This is not an official khronos header Signed-off-by: Andrew Lewycky Signed-off-by: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@111 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix the GL entry function prototypes to match new GLES header Trac #11785 The changes were void -> GLvoid and char -> GLchar. Signed-off-by: Andrew Lewycky Signed-off-by: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@110 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refresh KHR headers from Khronos svn@10929 Trac #11785 Signed-off-by: Andrew Lewycky Signed-off-by: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@109 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refresh GLES2 header files from Khronos svn@10929 Trac #11785 Signed-off-by: Andrew Lewycky Signed-off-by: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@108 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refresh EGL files from Khronos svn@10929 Trac #11785 Signed-off-by: Andrew Lewycky Signed-off-by: Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@107 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Resolve conflict between default cube map and 2D textures in texture map.  TRAC #11625  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@106 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Break up loops with over 255 iterations. TRAC# 11724 fixes acos/asin conformance Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@105 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Always build libEGL and libGLESv2 as shared libraries. They do not work as static libraries so there is no point in parametrizing the library type. Review URL: http://codereview.appspot.com/810045  git-svn-id: https://angleproject.googlecode.com/svn/trunk@104 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Changed the default character set to be UNICODE the same as chromium. Changes to fix compile errors and warnings. Review URL: http://codereview.appspot.com/816046  git-svn-id: https://angleproject.googlecode.com/svn/trunk@103 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements type conversion for queries. TRAC #11593 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Also adds missing query parameters.  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@102 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - Wrong Result from Matrix Multiply TRAC #11751 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@101 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added libGLESv2 libEGL and all samples to GYP. Review URL: http://codereview.appspot.com/878042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@100 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes an improper comparison in map TRAC #11649 Implementing this fix here because it's causing the glUniform conformance test not to pass. TranslatedBuffer would have problems during reloadCurrentValues because its required space and its current size were equal. Signed-off-by: Daniel Koch  Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@99 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added GYP build files. GYP files are needed for integration with chromium and cross-platform build for glsl translator. It would really be nice if we did not have to maintain two build systems. For now I have only moved the GLSL translator to gyp build system. Please note that the gyp files awkwardly have build_ prefix so they do not conflict with the manually-maintained sln files. Review URL: http://codereview.appspot.com/885043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@98 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - implement proper varying linking TRAC #11716 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@97 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - fix mat3 conformance TRAC #11723 Matrix elements are accessed as [col][row] in GLSL and [row][col] in HLSL. Fixed this by transposing all matrix uniforms so they have a row-major layout. Then transpose them in the shader every time they're used in matrix math. Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@96 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
ShaderSource does not generate needed errors TRAC #11664 Generate GL_INVALID_VALUE when shader name is 0 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@95 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - match pixel and vertex shader profiles TRAC #11717 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@94 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use the latest D3DX version for D3DXCompileShader instead of forcing D3DX9_31 TRAC #11347 Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@93 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix glGetShaderSource conformance TRAC #11718 Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@92 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for loops. Review URL: http://codereview.appspot.com/802047  git-svn-id: https://angleproject.googlecode.com/svn/trunk@91 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Changes to pass 'abs' conformance tests. Review URL: http://codereview.appspot.com/858041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@90 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Removed tabs. Fixed formatting. Only white-space changes. Review URL: http://codereview.appspot.com/849043  git-svn-id: https://angleproject.googlecode.com/svn/trunk@89 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added support for user-defined structs. And fixed a bug in function return type. Review URL: http://codereview.appspot.com/849042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@88 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - fix redeclaration of initialized globals TRAC #11617 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@87 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use unique intermediate directories for translator projects  TRAC #11635  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@86 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement glGetAttachedShaders and glGetShaderPrecisionFormat. TRAC #11599 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@85 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Support software vertex processing TRAC #11632 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@84 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Moved code to unmangle function name to a common place and used it in both OutputGLSL and OutputHLSL. Review URL: http://codereview.appspot.com/838041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@83 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added TIntermSelection::usesTernaryOperator() to distinguish between selection nodes using ternary operator and if-else. Used in both OutputGLSL and OutputHLSL. Review URL: http://codereview.appspot.com/830042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@82 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixed the title of texture-wrap sample. Review URL: http://codereview.appspot.com/834041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@81 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Support UNSIGNED_BYTE indices in DrawElements  Trac #11393 Support was added a prior patch but this wasn't activated  git-svn-id: https://angleproject.googlecode.com/svn/trunk@80 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Update .gitignore  Use better wildcards to hide files we don't commit  git-svn-id: https://angleproject.googlecode.com/svn/trunk@79 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - active uniforms and attributes  TRAC #11590 Preparation refactoring that removes UniformType since there are already GL enums for uniform types. Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@78 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - implement vector times matrix operation  TRAC #11611  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@77 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - implement shader and program queries TRAC #11599 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@76 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - only declare used HLSL functions TRAC #11315 Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@75 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
fix warning for std::copy  TRAC #11558  * VertexDataManager::internalPreRenderValidate operates directly on the output pointer.  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@74 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
fix warning from "normalized" cast  TRAC #11556  * Restore warning C4800. * Compare GLboolean normalized against GL_TRUE per the spec.  Signed-off-by: Daniel Koch Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@73 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Support translating indices.  TRAC #11393  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@72 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - implement gl_PointCoord and point size clamping  TRAC #11592 Fixed a regression caused by bad merging. Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@71 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - implement gl_PointCoord and point size clamping  TRAC #11592 Author: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@70 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added GLSL backend for ESSL translator. Review URL: http://codereview.appspot.com/698041  git-svn-id: https://angleproject.googlecode.com/svn/trunk@69 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements support for setting/getting line width.  TRAC #11531 Implements glLineWidth and provides glGet results for LINE_WIDTH and ALIASED_LINE_WIDTH_RANGE.  Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch Author:    Shannon Woods  git-svn-id: https://angleproject.googlecode.com/svn/trunk@68 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
HLSL compilation shouldn't assume a 3.0 profile  TRAC #11054 Signed-off-by: Daniel Koch Author:    Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@67 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
The trace parameter is better termed 'message' instead of 'argument'  Trac #11526 Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@66 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add smoke.tga for gles2\ParticleSystem sample  Trac #11596 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@65 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix warning from "normalized" cast.  TRAC #11556  Disable warning C4800 as it does not indicate defects in the code just the compiler.  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch Author: Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@64 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added a few samples from GLES 2.0 book.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@63 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Minor reshuffling of directory structure in preparation of ESSL to GLSL compiler work. 1. Added include/GLSLANG which includes compiler API 2. Deleted src/include and moved the header files to the same directory as the corresponding source files 3. Modied include path to be relative to src/. I have only fixed paths for files I moved. We should fix it for all new files at least. It is much easier to see where an included file is coming from.  I noticed that a few libGLESv2 source files include headers from libEGL project which seems wrong. I think we should address this issue. Next step: move compiler source files to compiler/frontend and create two new projects compiler/glsl_backend and compiler/hlsl_backend.  Review URL: http://codereview.appspot.com/662042  git-svn-id: https://angleproject.googlecode.com/svn/trunk@62 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
To output debug info use the TRACE macro instead of calling trace()  Trac #11526 Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@61 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Refactor the parenthesis from the TRACE/FIXME/ERR macros  Trac #11526 Signed-off-by: Shannon Woods Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@60 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Don't crash on a null pointer passed to glBufferData  TRAC #11528   * Initialise buffer to 0 if BufferData is called with data = NULL    (special case: if not resizing just leave the old data in place).  * BufferSubData ignores calls with data = NULL  * Replace Buffer::data_t with GLubyte.  Author:    Andrew Lewycky Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@59 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Corrects scissor & viewport initialization.  TRAC #11134 Takes viewport/scissor dimensions from surface at first makeCurrent rather than from display at context construction.  Author:    Shannon Woods Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@58 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements support for FRONT_AND_BACK culling.  TRAC #11331  Author:    Shannon Woods Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@57 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Adds support for hints  TRAC #11343 Author:    Shannon Woods Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@56 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement glPixelStorei for Tex(Sub)Image2D.  TRAC #11475  Author:    Andrew Lewycky Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@55 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Default textures to non-renderable.  TRAC #11309  * Lift getRenderTarget() into base class Texture. * Add pure virtual convertToRenderTarget() and getSurface().  Author:    Andrew Lewycky Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@54 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Partial TexSubImage after FBO rendering overwrites entire image.  TRAC #11439  * Store texel data in IDirect3DSurface9 rather than client memory. * TexSubImage uploads new data immediately. * Fix 5551 texture format conversion.  Author:    Andrew Lewycky Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@53 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix starting indices other than 0 for DrawArrays  TRAC #11495  Author:    Andrew Lewycky Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@52 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
ANGLE | Compiler - implement the ternary operator  TRAC #11421 Doesn't take short-circuiting behavior into account yet. Author:    Nicolas Capens Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@51 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
ANGLE | Don't perform any filtering when swapping  TRAC #11513 Author:    Nicolas Capens Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@50 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Delete empty folders after reorganization Trac #11406    git-svn-id: https://angleproject.googlecode.com/svn/trunk@48 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
update .gitignore file for new file locations Trac #11406 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@47 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix include paths in libEGL.vcproj Trac #11406 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@46 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix include paths for libGLESv2.vcproj Trac #11406 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@45 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix the case of all directories used by compiler.vcproj Trac #11406 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@44 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Rename Compiler.vcproj -> compiler.proj and fix solution properties Trac #11406 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@43 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
mv Include -> include Trac #11406 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@42 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
mv ANGLE.sln -> src/ANGLE.sln Trac #11406 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@41 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
mv libGLESv2 -> src/libGLESv2 Trac #11406 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@40 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
mv libEGL -> src/libEGL Trac #11406 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@39 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
mv Include/*.h -> /src/include/ Trac #11406 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@38 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
mv Compiler/* -> src/compiler/* Trac #11406 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@37 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
mv Compiler/Preprocessor -> src/compiler/preprocessor Trac #11406 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@36 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move Compiler/Tools -> src/compiler/tools Trac #11406 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@35 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Move Common -> src/common Trac #11406 Signed-off-by: Nicolas Capens  git-svn-id: https://angleproject.googlecode.com/svn/trunk@34 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add README and license information for bison and flex  Trac #11422 Signed-off-by: Shannon Woods Signed-off-by: Gavriel State  git-svn-id: https://angleproject.googlecode.com/svn/trunk@33 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implements separate stencil support to proposed WebGL limitations  TRAC #11450 Author:    Shannon Woods Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@32 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - implement break/continue  TRAC #11441 Author:  Nicolas Capens Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@31 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - implement matrix construction and equality  TRAC #11440 Author: Nicolas Capens Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@30 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Correcting un-returned depth size in utility function.  TRAC #11333 Implemented during masking conformance testing.  Author: Shannon Woods Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@29 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Creates new depthstencils for surfaces.  Trac #11396  Creates new depthstencils for new windows when multiple windows exist repurposes original depthstencil if old windows have all been destroyed. Author: Shannon Woods Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@28 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Blend conformance bugfixes.  Trac #11327  Fixes a bug where color conversion swapped blue and green values. Fixes a bug where CONSTANT_COLOR/CONSTANT_ALPHA conflict guard failed to check for ONE_MINUS variants.  Author: Shannon Woods Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@27 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Handle sampling from incomplete textures  TRAC #11321  Context owns incomplete textures of each texture type. Also fix completeness determination: check minfilter to see if mipmapping is on.  Author:    Andrew Lewycky Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@26 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Select texture type based on program usage.  TRAC #11410  Add Program::getSamplerType() and internal machinery to track the reported sampler uniforms. Make State::samplerTexture into a 2D array with a dimension for sampler type. Context::applyTextures queries the sampler type and asks for the right texture.  Author:    Andrew Lewycky Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@25 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Provide default return values for unreachable code paths.  TRAC #11414  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch Author:    Andrew Lewycky  git-svn-id: https://angleproject.googlecode.com/svn/trunk@24 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Whitespace fixes (trailing whitespace CRLF).  TRAC #11414  Author:    Andrew Lewycky Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@23 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - implement gl_FrontFacing TRAC #11368 Signed-off-by: Andrew Lewycky Signed-off-by: Daniel Koch From:    Nicolas Capens <nicolas@transgaming.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@22 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - implement gl_FragCoord TRAC #11381 Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@21 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Factor out all operators that are invalid for ES2. TRAC #11347 Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@20 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implement non-support for compressed textures.  TRAC #11339  * glCompressedTexImage2D and glCompressedTexSubImage2D verify parameters and then fail with GL_INVALID_ENUM since there are no supported formats. * glGetIntegerv recognises GL_NUM_COMPRESSED_TEXTURE_FORMATS (returns 0) and GL_COMPRESSED_TEXTURE_FORMATS (returns none).  Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Original-Author:    Andrew Lewycky <andrew.lewycky@transgaming.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@19 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Support glTexSubImage2D.  TRAC #1167  Signed-off-by: Shannon Woods Signed-off-by: Daniel Koch  Author:    Andrew Lewycky <andrew.lewycky@transgaming.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@18 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Vertex data translation broke the text in PVR samples.  TRAC #11412  Indexed rendering was always broken because the size calculated was offset incorrectly (part of a removed optimisation). copyComponents was broken when I switched from incremental addressing to explicitly-indexed addressing.  Signed-off-by: Daniel Koch  Author:    Andrew Lewycky <andrew.lewycky@transgaming.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@17 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - implement gl_DepthRange TRAC #11380 Signed-off-by: Daniel Koch  Author:    Nicolas Capens <nicolas@transgaming.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@16 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Add support for Vertex Buffer Data Translation  TRAC #11024 Signed-off-by: Nicolas Capens Signed-off-by: Daniel Koch  Author:    Andrew Lewycky <andrew.lewycky@transgaming.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@15 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - access struct fields TRAC #11379 Signed-off-by: Daniel Koch  Author:    Nicolas Capens <nicolas@transgaming.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@14 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - handle high loop iteration counts TRAC #11345 Signed-off-by: Daniel Koch  Author:    Nicolas Capens <nicolas@transgaming.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@13 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Support redefinition of textures through glTexImage2D.  TRAC #11316. Keep a dirty data flag recreate the texture when it is set. Texture now owns getTexture() and calls a virtual createTexture method when the derived classes need to recreate.  Signed-off-by: Daniel Koch  Author:    Andrew Lewycky <andrew.lewycky@transgaming.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@12 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Remove trailing whitespace.  TRAC #11024  Signed-off-by: Daniel Koch  Author:    Andrew Lewycky <andrew.lewycky@transgaming.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@11 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Use std::min/max instead of the Windows macros.  TRAC #11024  * Define NOMINMAX so that the Windows headers don't define min or max. * Use std::min/std::max where we were using the min/max macros.  Signed-off-by: Daniel Koch  Author:    Andrew Lewycky <andrew.lewycky@transgaming.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@10 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Whitespace fixes.  TRAC #11024  Signed-off-by: Daniel Koch  Author:    Andrew Lewycky <andrew.lewycky@transgaming.com>  git-svn-id: https://angleproject.googlecode.com/svn/trunk@9 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Added codereview settings file.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@6 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Implemented support for GL_STENCIL_INDEX8 renderbuffers TRAC #11366 Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@5 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Compiler - implement faceforward TRAC #11365 Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@4 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fix regression from HRESULT checking changes TRAC #11234 Signed-off-by: Daniel Koch  git-svn-id: https://angleproject.googlecode.com/svn/trunk@3 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Initial import from TransGaming  git-svn-id: https://angleproject.googlecode.com/svn/trunk@2 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Initial directory structure.  git-svn-id: https://angleproject.googlecode.com/svn/trunk@1 736b8ea6-26fd-11df-bfd4-992fa37f6226, 23355681, 619, 169, 619
Fixes for Angular 0.11.0, 15144758, 20, 11, 20
Use dev dependencies, 15144758, 20, 11, 20
bump version to 0.1.2, 15144758, 20, 11, 20
Merge pull request #1 from eee-c/patch-1  Update assignable predicate for Angular 0.9.4, 15144758, 20, 11, 20
Update assignable predicate for Angular 0.9.4  This seems to have changed somewhat recent-ish. Without this I am unable to get angular_node_bind to work with current Angular.dart, 15144758, 20, 11, 20
cleanup splitMapJoin usage, 15144758, 20, 11, 20
cleanup rename library to match package name, 15144758, 20, 11, 20
Add project files, 15144758, 20, 11, 20
Initial commit, 15144758, 20, 11, 20
Add Catch for unit testing., 60585493, 5, 0, 5
Fix MSVC builds, 60585493, 5, 0, 5
Syntax for System D., 60585493, 5, 0, 5
Clean up lexparse/ filenames., 60585493, 5, 0, 5
Separate Lua AST and use our own Source{RangeLocation}  These changes go together because otherwise we'd have a layering violation (as the AST contains locations that would have depended on bison-provided headers)., 60585493, 5, 0, 5
Add initial Lua parser., 60585493, 5, 0, 5
Remove a hyphen (and test permissions)., 60585493, 5, 0, 5
Add initial README for the project.  Includes the required disclaimer., 60585493, 5, 0, 5
Add contribution guidelines.  For now the submission instructions are a placeholder.  We can expand them once we choose a hosting site., 60585493, 5, 0, 5
Add initial LICENSE file for the project., 60585493, 5, 0, 5
Merge pull request #11 from google/langCleanup  Issue #10: Clean up style, 11430627, 26, 10, 26
Issue #10: Clean up style  Cleanup comment style move ansi_demo to bin/demo.dart update to use the new dart test library., 11430627, 26, 10, 26
Update README.md, 11430627, 26, 10, 26
Update README.md, 11430627, 26, 10, 26
Merge pull request #1 from sigmundch/master  Fix due to breaking change in unittest, 11430627, 26, 10, 26
Fix due to breaking change in unittest, 11430627, 26, 10, 26
nits, 11430627, 26, 10, 26
Nits, 11430627, 26, 10, 26
Adding src/demo.dart and updating README to reflect callable objects, 11430627, 26, 10, 26
Updated documenation and added tests (and fixes), 11430627, 26, 10, 26
Update README.md, 11430627, 26, 10, 26
Remove default files (pub publish consumes everything), 11430627, 26, 10, 26
Remove temp files., 11430627, 26, 10, 26
0.0.2: added pen.write()., 11430627, 26, 10, 26
Adding examples, 11430627, 26, 10, 26
Update README.md, 11430627, 26, 10, 26
rename to ansicolor, 11430627, 26, 10, 26
bin->lib for pub.dartlang.org, 11430627, 26, 10, 26
Ansi / xterm 256 color library for Dart., 11430627, 26, 10, 26
